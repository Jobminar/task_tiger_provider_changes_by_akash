import{A as Uk,a as Kx,b as og,c as md,d as Jx,e as e1,f as ag,l as Nk,m as sg,n as lb,s as Vk,t as cb,v as jk}from"./chunk-VFYDMS3I.js";import{i as Gk,j as vs,k as qk}from"./chunk-VR2CY5TD.js";import{A as zk,B as Bk,C as db,D as To,E as hb,F as Nt,G as ub,H as mb,I as t1,a as Ik,c as Wi,d as Tk,e as ob,f as Ek,g as ab,h as Dk,i as Xs,j as ro,k as Ak,l as oo,m as ir,n as ko,o as Pk,p as Zo,q as Io,r as sb,s as Xo,t as Ga,u as Ok,v as Rk,w as Lk,x as Fk,y as Em,z as Qo}from"./chunk-5ATCEA3X.js";import{$ as Ut,A as Nh,Aa as ln,Ab as bi,Ac as Mo,B as ya,Ba as an,Bb as gi,Bc as Vr,C as Nx,Cb as _i,Cc as fr,D as Vh,Db as va,Dc as wk,Eb as $,Ec as Ck,F as Vx,Fa as dd,Fb as Ft,Fc as Sk,G as ok,Ga as io,Gb as ki,Gc as nb,H as Ua,Ha as dk,Hb as xa,Hc as rb,Ia as Fn,Ib as tb,Ic as Mk,J as jx,Jb as pk,Jc as Zs,Kb as fk,La as ue,Lb as Ir,Lc as kk,Ma as fe,Mb as Tr,Na as km,Nb as Er,O as Ux,Oa as Uh,Ob as ys,P as ak,Pa as K0,Pb as Hn,Qa as ng,Qb as ib,R as Hx,Ra as J0,Rb as ci,S as Z0,Sa as hk,Sb as Yx,T as gs,Ta as qx,Tb as gk,U as _s,Ua as zi,Ub as _k,V as Wx,Vb as bk,W as jh,Wa as Im,Wb as Tm,Xa as Fo,Xb as Zx,Y as sk,Ya as Co,Yb as yk,_ as X0,a as fs,aa as ui,ab as Bt,bb as bn,c as uo,ca as fn,cb as Fe,db as Wa,ea as st,eb as Mi,f as En,fa as wn,fb as bs,fc as vk,g as ig,ga as Q0,gb as Dn,h as KM,ha as lk,hb as Zr,hc as xk,i as JM,ib as rg,j as ek,ja as Zi,jb as mr,jc as Xx,k as Bl,ka as _t,kb as pr,kc as mo,l as Nl,la as mi,lb as V,ma as tr,mb as j,n as sr,na as ck,nb as Me,nc as no,ob as hd,oc as Qx,pb as ud,qb as $x,r as tk,ra as wo,rb as Xt,s as Cm,sa as mt,sb as Vl,t as ik,ta as pt,tb as uk,tc as mn,u as nk,ua as cd,ub as Pe,va as Gx,vb as mk,w as $0,wa as Sm,wb as rt,x as Y0,xa as Mm,xb as Yo,y as Bx,ya as Ha,yb as So,yc as ii,z as rk,zb as eb}from"./chunk-IGDLGV62.js";import{a as pb,b as Hk,c as pd,d as Wk}from"./chunk-HJO2KOHN.js";import{a as Ji,b as ja,c as XM,d as w3,f as QM,g as Ln}from"./chunk-MON7YFGF.js";var iw=w3((ew,tw)=>{"use strict";(function(d,s){typeof ew=="object"&&typeof tw<"u"?tw.exports=s():typeof define=="function"&&define.amd?define(s):(d=typeof globalThis<"u"?globalThis:d||self,d.mapboxgl=s())})(ew,function(){"use strict";var d,s,u;function r(t,_){if(!d)d=_;else if(!s)s=_;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+d+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",I={};d(I),u=_(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}r(["exports"],function(t){var _="3.5.1";let C,I={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){let i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{C=i}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!I.API_URL)return null;try{let i=new URL(I.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function O(i){return I.API_URL_REGEX.test(i)}function N(i){return i.indexOf("mapbox:")===0}function q(i){return I.API_CDN_URL_REGEX.test(i)}function ie(i){return I.API_SPRITE_REGEX.test(i)}function de(i){return I.API_STYLE_REGEX.test(i)&&!ie(i)}let xe={create:"create",load:"load",fullLoad:"fullLoad"},ke={mark(i){performance.mark(i)},measure(i,e,n){performance.measure(i,e,n)}};function Ae(i){let e=i.name.split("?")[0];return q(e)&&e.includes("mapbox-gl.js")?"javascript":q(e)&&e.includes("mapbox-gl.css")?"css":function(n){return I.API_FONTS_REGEX.test(n)}(e)?"fontRange":ie(e)?"sprite":de(e)?"style":function(n){return I.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Xe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var qe={},ut={};Object.defineProperty(ut,"__esModule",{value:!0}),ut.setMatrixArrayType=function(i){ut.ARRAY_TYPE=wt=i},ut.toRadian=function(i){return i*Ht},ut.equals=function(i,e){return Math.abs(i-e)<=It*Math.max(1,Math.abs(i),Math.abs(e))},ut.RANDOM=ut.ARRAY_TYPE=ut.EPSILON=void 0;var It=1e-6;ut.EPSILON=It;var wt=typeof Float32Array<"u"?Float32Array:Array;ut.ARRAY_TYPE=wt;var Et=Math.random;ut.RANDOM=Et;var Ht=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Ct={};function Yt(i){return Yt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yt(i)}Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.create=function(){var i=new zt.ARRAY_TYPE(4);return zt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},Ct.clone=function(i){var e=new zt.ARRAY_TYPE(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e},Ct.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},Ct.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},Ct.fromValues=function(i,e,n,a){var c=new zt.ARRAY_TYPE(4);return c[0]=i,c[1]=e,c[2]=n,c[3]=a,c},Ct.set=function(i,e,n,a,c){return i[0]=e,i[1]=n,i[2]=a,i[3]=c,i},Ct.transpose=function(i,e){if(i===e){var n=e[1];i[1]=e[2],i[2]=n}else i[0]=e[0],i[1]=e[2],i[2]=e[1],i[3]=e[3];return i},Ct.invert=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n*m-c*a;return p?(i[0]=m*(p=1/p),i[1]=-a*p,i[2]=-c*p,i[3]=n*p,i):null},Ct.adjoint=function(i,e){var n=e[0];return i[0]=e[3],i[1]=-e[1],i[2]=-e[2],i[3]=n,i},Ct.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},Ct.multiply=Hi,Ct.rotate=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return i[0]=a*y+m*b,i[1]=c*y+p*b,i[2]=a*-b+m*y,i[3]=c*-b+p*y,i},Ct.scale=function(i,e,n){var a=e[1],c=e[2],m=e[3],p=n[0],b=n[1];return i[0]=e[0]*p,i[1]=a*p,i[2]=c*b,i[3]=m*b,i},Ct.fromRotation=function(i,e){var n=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=n,i[2]=-n,i[3]=a,i},Ct.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=e[1],i},Ct.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},Ct.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},Ct.LDU=function(i,e,n,a){return i[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-i[2]*n[1],[i,e,n]},Ct.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},Ct.subtract=cr,Ct.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},Ct.equals=function(i,e){var n=i[0],a=i[1],c=i[2],m=i[3],p=e[0],b=e[1],y=e[2],w=e[3];return Math.abs(n-p)<=zt.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-b)<=zt.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(c-y)<=zt.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(m-w)<=zt.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))},Ct.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},Ct.multiplyScalarAndAdd=function(i,e,n,a){return i[0]=e[0]+n[0]*a,i[1]=e[1]+n[1]*a,i[2]=e[2]+n[2]*a,i[3]=e[3]+n[3]*a,i},Ct.sub=Ct.mul=void 0;var zt=function(i,e){if(i&&i.__esModule)return i;if(i===null||Yt(i)!=="object"&&typeof i!="function")return{default:i};var n=Ii(void 0);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}(ut);function Ii(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ii=function(a){return a?n:e})(i)}function Hi(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return i[0]=a*b+m*y,i[1]=c*b+p*y,i[2]=a*w+m*M,i[3]=c*w+p*M,i}function cr(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}Ct.mul=Hi,Ct.sub=cr;var wi={};function dn(i){return dn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(i)}Object.defineProperty(wi,"__esModule",{value:!0}),wi.create=function(){var i=new tn.ARRAY_TYPE(6);return tn.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},wi.clone=function(i){var e=new tn.ARRAY_TYPE(6);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e},wi.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i},wi.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},wi.fromValues=function(i,e,n,a,c,m){var p=new tn.ARRAY_TYPE(6);return p[0]=i,p[1]=e,p[2]=n,p[3]=a,p[4]=c,p[5]=m,p},wi.set=function(i,e,n,a,c,m,p){return i[0]=e,i[1]=n,i[2]=a,i[3]=c,i[4]=m,i[5]=p,i},wi.invert=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=n*m-a*c;return y?(i[0]=m*(y=1/y),i[1]=-a*y,i[2]=-c*y,i[3]=n*y,i[4]=(c*b-m*p)*y,i[5]=(a*p-n*b)*y,i):null},wi.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},wi.multiply=Ur,wi.rotate=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=Math.sin(n),M=Math.cos(n);return i[0]=a*M+m*w,i[1]=c*M+p*w,i[2]=a*-w+m*M,i[3]=c*-w+p*M,i[4]=b,i[5]=y,i},wi.scale=function(i,e,n){var a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=n[0],w=n[1];return i[0]=e[0]*y,i[1]=a*y,i[2]=c*w,i[3]=m*w,i[4]=p,i[5]=b,i},wi.translate=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=n[0],M=n[1];return i[0]=a,i[1]=c,i[2]=m,i[3]=p,i[4]=a*w+m*M+b,i[5]=c*w+p*M+y,i},wi.fromRotation=function(i,e){var n=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=n,i[2]=-n,i[3]=a,i[4]=0,i[5]=0,i},wi.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=e[1],i[4]=0,i[5]=0,i},wi.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=e[0],i[5]=e[1],i},wi.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},wi.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},wi.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i},wi.subtract=Zn,wi.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i},wi.multiplyScalarAndAdd=function(i,e,n,a){return i[0]=e[0]+n[0]*a,i[1]=e[1]+n[1]*a,i[2]=e[2]+n[2]*a,i[3]=e[3]+n[3]*a,i[4]=e[4]+n[4]*a,i[5]=e[5]+n[5]*a,i},wi.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]},wi.equals=function(i,e){var n=i[0],a=i[1],c=i[2],m=i[3],p=i[4],b=i[5],y=e[0],w=e[1],M=e[2],T=e[3],E=e[4],P=e[5];return Math.abs(n-y)<=tn.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-w)<=tn.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-M)<=tn.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(m-T)<=tn.EPSILON*Math.max(1,Math.abs(m),Math.abs(T))&&Math.abs(p-E)<=tn.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(b-P)<=tn.EPSILON*Math.max(1,Math.abs(b),Math.abs(P))},wi.sub=wi.mul=void 0;var tn=function(i,e){if(i&&i.__esModule)return i;if(i===null||dn(i)!=="object"&&typeof i!="function")return{default:i};var n=jn(void 0);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}(ut);function jn(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(jn=function(a){return a?n:e})(i)}function Ur(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=n[0],M=n[1],T=n[2],E=n[3],P=n[4],R=n[5];return i[0]=a*w+m*M,i[1]=c*w+p*M,i[2]=a*T+m*E,i[3]=c*T+p*E,i[4]=a*P+m*R+b,i[5]=c*P+p*R+y,i}function Zn(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i[4]=e[4]-n[4],i[5]=e[5]-n[5],i}wi.mul=Ur,wi.sub=Zn;var Ti={};function aa(i){return aa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},aa(i)}Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.create=function(){var i=new Xn.ARRAY_TYPE(9);return Xn.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},Ti.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},Ti.clone=function(i){var e=new Xn.ARRAY_TYPE(9);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e},Ti.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},Ti.fromValues=function(i,e,n,a,c,m,p,b,y){var w=new Xn.ARRAY_TYPE(9);return w[0]=i,w[1]=e,w[2]=n,w[3]=a,w[4]=c,w[5]=m,w[6]=p,w[7]=b,w[8]=y,w},Ti.set=function(i,e,n,a,c,m,p,b,y,w){return i[0]=e,i[1]=n,i[2]=a,i[3]=c,i[4]=m,i[5]=p,i[6]=b,i[7]=y,i[8]=w,i},Ti.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Ti.transpose=function(i,e){if(i===e){var n=e[1],a=e[2],c=e[5];i[1]=e[3],i[2]=e[6],i[3]=n,i[5]=e[7],i[6]=a,i[7]=c}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},Ti.invert=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=M*p-b*w,E=-M*m+b*y,P=w*m-p*y,R=n*T+a*E+c*P;return R?(i[0]=T*(R=1/R),i[1]=(-M*a+c*w)*R,i[2]=(b*a-c*p)*R,i[3]=E*R,i[4]=(M*n-c*y)*R,i[5]=(-b*n+c*m)*R,i[6]=P*R,i[7]=(-w*n+a*y)*R,i[8]=(p*n-a*m)*R,i):null},Ti.adjoint=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8];return i[0]=p*M-b*w,i[1]=c*w-a*M,i[2]=a*b-c*p,i[3]=b*y-m*M,i[4]=n*M-c*y,i[5]=c*m-n*b,i[6]=m*w-p*y,i[7]=a*y-n*w,i[8]=n*p-a*m,i},Ti.determinant=function(i){var e=i[3],n=i[4],a=i[5],c=i[6],m=i[7],p=i[8];return i[0]*(p*n-a*m)+i[1]*(-p*e+a*c)+i[2]*(m*e-n*c)},Ti.multiply=zo,Ti.translate=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=n[0],P=n[1];return i[0]=a,i[1]=c,i[2]=m,i[3]=p,i[4]=b,i[5]=y,i[6]=E*a+P*p+w,i[7]=E*c+P*b+M,i[8]=E*m+P*y+T,i},Ti.rotate=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=Math.sin(n),P=Math.cos(n);return i[0]=P*a+E*p,i[1]=P*c+E*b,i[2]=P*m+E*y,i[3]=P*p-E*a,i[4]=P*b-E*c,i[5]=P*y-E*m,i[6]=w,i[7]=M,i[8]=T,i},Ti.scale=function(i,e,n){var a=n[0],c=n[1];return i[0]=a*e[0],i[1]=a*e[1],i[2]=a*e[2],i[3]=c*e[3],i[4]=c*e[4],i[5]=c*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},Ti.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=e[0],i[7]=e[1],i[8]=1,i},Ti.fromRotation=function(i,e){var n=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=n,i[2]=0,i[3]=-n,i[4]=a,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Ti.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=e[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Ti.fromMat2d=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=0,i[3]=e[2],i[4]=e[3],i[5]=0,i[6]=e[4],i[7]=e[5],i[8]=1,i},Ti.fromQuat=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n+n,b=a+a,y=c+c,w=n*p,M=a*p,T=a*b,E=c*p,P=c*b,R=c*y,F=m*p,B=m*b,W=m*y;return i[0]=1-T-R,i[3]=M-W,i[6]=E+B,i[1]=M+W,i[4]=1-w-R,i[7]=P-F,i[2]=E-B,i[5]=P+F,i[8]=1-w-T,i},Ti.normalFromMat4=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],B=e[14],W=e[15],J=n*b-a*p,ee=n*y-c*p,te=n*w-m*p,pe=a*y-c*b,he=a*w-m*b,ve=c*w-m*y,Ce=M*F-T*R,De=M*B-E*R,Ue=M*W-P*R,ze=T*B-E*F,$e=T*W-P*F,ot=E*W-P*B,We=J*ot-ee*$e+te*ze+pe*Ue-he*De+ve*Ce;return We?(i[0]=(b*ot-y*$e+w*ze)*(We=1/We),i[1]=(y*Ue-p*ot-w*De)*We,i[2]=(p*$e-b*Ue+w*Ce)*We,i[3]=(c*$e-a*ot-m*ze)*We,i[4]=(n*ot-c*Ue+m*De)*We,i[5]=(a*Ue-n*$e-m*Ce)*We,i[6]=(F*ve-B*he+W*pe)*We,i[7]=(B*te-R*ve-W*ee)*We,i[8]=(R*he-F*te+W*J)*We,i):null},Ti.projection=function(i,e,n){return i[0]=2/e,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/n,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},Ti.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},Ti.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},Ti.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i[8]=e[8]+n[8],i},Ti.subtract=ka,Ti.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*n,i},Ti.multiplyScalarAndAdd=function(i,e,n,a){return i[0]=e[0]+n[0]*a,i[1]=e[1]+n[1]*a,i[2]=e[2]+n[2]*a,i[3]=e[3]+n[3]*a,i[4]=e[4]+n[4]*a,i[5]=e[5]+n[5]*a,i[6]=e[6]+n[6]*a,i[7]=e[7]+n[7]*a,i[8]=e[8]+n[8]*a,i},Ti.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]},Ti.equals=function(i,e){var n=i[0],a=i[1],c=i[2],m=i[3],p=i[4],b=i[5],y=i[6],w=i[7],M=i[8],T=e[0],E=e[1],P=e[2],R=e[3],F=e[4],B=e[5],W=e[6],J=e[7],ee=e[8];return Math.abs(n-T)<=Xn.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-E)<=Xn.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(c-P)<=Xn.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(m-R)<=Xn.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(p-F)<=Xn.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(b-B)<=Xn.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(y-W)<=Xn.EPSILON*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(w-J)<=Xn.EPSILON*Math.max(1,Math.abs(w),Math.abs(J))&&Math.abs(M-ee)<=Xn.EPSILON*Math.max(1,Math.abs(M),Math.abs(ee))},Ti.sub=Ti.mul=void 0;var Xn=function(i,e){if(i&&i.__esModule)return i;if(i===null||aa(i)!=="object"&&typeof i!="function")return{default:i};var n=Ma(void 0);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}(ut);function Ma(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ma=function(a){return a?n:e})(i)}function zo(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=n[0],P=n[1],R=n[2],F=n[3],B=n[4],W=n[5],J=n[6],ee=n[7],te=n[8];return i[0]=E*a+P*p+R*w,i[1]=E*c+P*b+R*M,i[2]=E*m+P*y+R*T,i[3]=F*a+B*p+W*w,i[4]=F*c+B*b+W*M,i[5]=F*m+B*y+W*T,i[6]=J*a+ee*p+te*w,i[7]=J*c+ee*b+te*M,i[8]=J*m+ee*y+te*T,i}function ka(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i[4]=e[4]-n[4],i[5]=e[5]-n[5],i[6]=e[6]-n[6],i[7]=e[7]-n[7],i[8]=e[8]-n[8],i}Ti.mul=zo,Ti.sub=ka;var Gt={};function ec(i){return ec=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ec(i)}Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var i=new Cn.ARRAY_TYPE(16);return Cn.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},Gt.clone=function(i){var e=new Cn.ARRAY_TYPE(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},Gt.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},Gt.fromValues=function(i,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F){var B=new Cn.ARRAY_TYPE(16);return B[0]=i,B[1]=e,B[2]=n,B[3]=a,B[4]=c,B[5]=m,B[6]=p,B[7]=b,B[8]=y,B[9]=w,B[10]=M,B[11]=T,B[12]=E,B[13]=P,B[14]=R,B[15]=F,B},Gt.set=function(i,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B){return i[0]=e,i[1]=n,i[2]=a,i[3]=c,i[4]=m,i[5]=p,i[6]=b,i[7]=y,i[8]=w,i[9]=M,i[10]=T,i[11]=E,i[12]=P,i[13]=R,i[14]=F,i[15]=B,i},Gt.identity=ou,Gt.transpose=function(i,e){if(i===e){var n=e[1],a=e[2],c=e[3],m=e[6],p=e[7],b=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=n,i[6]=e[9],i[7]=e[13],i[8]=a,i[9]=m,i[11]=e[14],i[12]=c,i[13]=p,i[14]=b}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i},Gt.invert=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],B=e[14],W=e[15],J=n*b-a*p,ee=n*y-c*p,te=n*w-m*p,pe=a*y-c*b,he=a*w-m*b,ve=c*w-m*y,Ce=M*F-T*R,De=M*B-E*R,Ue=M*W-P*R,ze=T*B-E*F,$e=T*W-P*F,ot=E*W-P*B,We=J*ot-ee*$e+te*ze+pe*Ue-he*De+ve*Ce;return We?(i[0]=(b*ot-y*$e+w*ze)*(We=1/We),i[1]=(c*$e-a*ot-m*ze)*We,i[2]=(F*ve-B*he+W*pe)*We,i[3]=(E*he-T*ve-P*pe)*We,i[4]=(y*Ue-p*ot-w*De)*We,i[5]=(n*ot-c*Ue+m*De)*We,i[6]=(B*te-R*ve-W*ee)*We,i[7]=(M*ve-E*te+P*ee)*We,i[8]=(p*$e-b*Ue+w*Ce)*We,i[9]=(a*Ue-n*$e-m*Ce)*We,i[10]=(R*he-F*te+W*J)*We,i[11]=(T*te-M*he-P*J)*We,i[12]=(b*De-p*ze-y*Ce)*We,i[13]=(n*ze-a*De+c*Ce)*We,i[14]=(F*ee-R*pe-B*J)*We,i[15]=(M*pe-T*ee+E*J)*We,i):null},Gt.adjoint=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],B=e[14],W=e[15];return i[0]=b*(E*W-P*B)-T*(y*W-w*B)+F*(y*P-w*E),i[1]=-(a*(E*W-P*B)-T*(c*W-m*B)+F*(c*P-m*E)),i[2]=a*(y*W-w*B)-b*(c*W-m*B)+F*(c*w-m*y),i[3]=-(a*(y*P-w*E)-b*(c*P-m*E)+T*(c*w-m*y)),i[4]=-(p*(E*W-P*B)-M*(y*W-w*B)+R*(y*P-w*E)),i[5]=n*(E*W-P*B)-M*(c*W-m*B)+R*(c*P-m*E),i[6]=-(n*(y*W-w*B)-p*(c*W-m*B)+R*(c*w-m*y)),i[7]=n*(y*P-w*E)-p*(c*P-m*E)+M*(c*w-m*y),i[8]=p*(T*W-P*F)-M*(b*W-w*F)+R*(b*P-w*T),i[9]=-(n*(T*W-P*F)-M*(a*W-m*F)+R*(a*P-m*T)),i[10]=n*(b*W-w*F)-p*(a*W-m*F)+R*(a*w-m*b),i[11]=-(n*(b*P-w*T)-p*(a*P-m*T)+M*(a*w-m*b)),i[12]=-(p*(T*B-E*F)-M*(b*B-y*F)+R*(b*E-y*T)),i[13]=n*(T*B-E*F)-M*(a*B-c*F)+R*(a*E-c*T),i[14]=-(n*(b*B-y*F)-p*(a*B-c*F)+R*(a*y-c*b)),i[15]=n*(b*E-y*T)-p*(a*E-c*T)+M*(a*y-c*b),i},Gt.determinant=function(i){var e=i[0],n=i[1],a=i[2],c=i[3],m=i[4],p=i[5],b=i[6],y=i[7],w=i[8],M=i[9],T=i[10],E=i[11],P=i[12],R=i[13],F=i[14],B=i[15];return(e*p-n*m)*(T*B-E*F)-(e*b-a*m)*(M*B-E*R)+(e*y-c*m)*(M*F-T*R)+(n*b-a*p)*(w*B-E*P)-(n*y-c*p)*(w*F-T*P)+(a*y-c*b)*(w*R-M*P)},Gt.multiply=au,Gt.translate=function(i,e,n){var a,c,m,p,b,y,w,M,T,E,P,R,F=n[0],B=n[1],W=n[2];return e===i?(i[12]=e[0]*F+e[4]*B+e[8]*W+e[12],i[13]=e[1]*F+e[5]*B+e[9]*W+e[13],i[14]=e[2]*F+e[6]*B+e[10]*W+e[14],i[15]=e[3]*F+e[7]*B+e[11]*W+e[15]):(c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=e[9],P=e[10],R=e[11],i[0]=a=e[0],i[1]=c,i[2]=m,i[3]=p,i[4]=b,i[5]=y,i[6]=w,i[7]=M,i[8]=T,i[9]=E,i[10]=P,i[11]=R,i[12]=a*F+b*B+T*W+e[12],i[13]=c*F+y*B+E*W+e[13],i[14]=m*F+w*B+P*W+e[14],i[15]=p*F+M*B+R*W+e[15]),i},Gt.scale=function(i,e,n){var a=n[0],c=n[1],m=n[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},Gt.rotate=function(i,e,n,a){var c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he,ve,Ce,De,Ue,ze,$e=a[0],ot=a[1],We=a[2],et=Math.hypot($e,ot,We);return et<Cn.EPSILON?null:($e*=et=1/et,ot*=et,We*=et,c=Math.sin(n),m=Math.cos(n),y=e[1],w=e[2],M=e[3],E=e[5],P=e[6],R=e[7],B=e[9],W=e[10],J=e[11],ee=$e*$e*(p=1-m)+m,he=$e*ot*p-We*c,ve=ot*ot*p+m,Ce=We*ot*p+$e*c,De=$e*We*p+ot*c,Ue=ot*We*p-$e*c,ze=We*We*p+m,i[0]=(b=e[0])*ee+(T=e[4])*(te=ot*$e*p+We*c)+(F=e[8])*(pe=We*$e*p-ot*c),i[1]=y*ee+E*te+B*pe,i[2]=w*ee+P*te+W*pe,i[3]=M*ee+R*te+J*pe,i[4]=b*he+T*ve+F*Ce,i[5]=y*he+E*ve+B*Ce,i[6]=w*he+P*ve+W*Ce,i[7]=M*he+R*ve+J*Ce,i[8]=b*De+T*Ue+F*ze,i[9]=y*De+E*Ue+B*ze,i[10]=w*De+P*Ue+W*ze,i[11]=M*De+R*Ue+J*ze,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)},Gt.rotateX=function(i,e,n){var a=Math.sin(n),c=Math.cos(n),m=e[4],p=e[5],b=e[6],y=e[7],w=e[8],M=e[9],T=e[10],E=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*c+w*a,i[5]=p*c+M*a,i[6]=b*c+T*a,i[7]=y*c+E*a,i[8]=w*c-m*a,i[9]=M*c-p*a,i[10]=T*c-b*a,i[11]=E*c-y*a,i},Gt.rotateY=function(i,e,n){var a=Math.sin(n),c=Math.cos(n),m=e[0],p=e[1],b=e[2],y=e[3],w=e[8],M=e[9],T=e[10],E=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*c-w*a,i[1]=p*c-M*a,i[2]=b*c-T*a,i[3]=y*c-E*a,i[8]=m*a+w*c,i[9]=p*a+M*c,i[10]=b*a+T*c,i[11]=y*a+E*c,i},Gt.rotateZ=function(i,e,n){var a=Math.sin(n),c=Math.cos(n),m=e[0],p=e[1],b=e[2],y=e[3],w=e[4],M=e[5],T=e[6],E=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*c+w*a,i[1]=p*c+M*a,i[2]=b*c+T*a,i[3]=y*c+E*a,i[4]=w*c-m*a,i[5]=M*c-p*a,i[6]=T*c-b*a,i[7]=E*c-y*a,i},Gt.fromTranslation=function(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},Gt.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromRotation=function(i,e,n){var a,c,m,p=n[0],b=n[1],y=n[2],w=Math.hypot(p,b,y);return w<Cn.EPSILON?null:(p*=w=1/w,b*=w,y*=w,a=Math.sin(e),c=Math.cos(e),i[0]=p*p*(m=1-c)+c,i[1]=b*p*m+y*a,i[2]=y*p*m-b*a,i[3]=0,i[4]=p*b*m-y*a,i[5]=b*b*m+c,i[6]=y*b*m+p*a,i[7]=0,i[8]=p*y*m+b*a,i[9]=b*y*m-p*a,i[10]=y*y*m+c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},Gt.fromXRotation=function(i,e){var n=Math.sin(e),a=Math.cos(e);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=n,i[7]=0,i[8]=0,i[9]=-n,i[10]=a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromYRotation=function(i,e){var n=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=0,i[2]=-n,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=n,i[9]=0,i[10]=a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromZRotation=function(i,e){var n=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=n,i[2]=0,i[3]=0,i[4]=-n,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromRotationTranslation=Pd,Gt.fromQuat2=function(i,e){var n=new Cn.ARRAY_TYPE(3),a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=a*a+c*c+m*m+p*p;return T>0?(n[0]=2*(b*p+M*a+y*m-w*c)/T,n[1]=2*(y*p+M*c+w*a-b*m)/T,n[2]=2*(w*p+M*m+b*c-y*a)/T):(n[0]=2*(b*p+M*a+y*m-w*c),n[1]=2*(y*p+M*c+w*a-b*m),n[2]=2*(w*p+M*m+b*c-y*a)),Pd(i,e,n),i},Gt.getTranslation=function(i,e){return i[0]=e[12],i[1]=e[13],i[2]=e[14],i},Gt.getScaling=tc,Gt.getRotation=function(i,e){var n=new Cn.ARRAY_TYPE(3);tc(n,e);var a=1/n[0],c=1/n[1],m=1/n[2],p=e[0]*a,b=e[1]*c,y=e[2]*m,w=e[4]*a,M=e[5]*c,T=e[6]*m,E=e[8]*a,P=e[9]*c,R=e[10]*m,F=p+M+R,B=0;return F>0?(B=2*Math.sqrt(F+1),i[3]=.25*B,i[0]=(T-P)/B,i[1]=(E-y)/B,i[2]=(b-w)/B):p>M&&p>R?(B=2*Math.sqrt(1+p-M-R),i[3]=(T-P)/B,i[0]=.25*B,i[1]=(b+w)/B,i[2]=(E+y)/B):M>R?(B=2*Math.sqrt(1+M-p-R),i[3]=(E-y)/B,i[0]=(b+w)/B,i[1]=.25*B,i[2]=(T+P)/B):(B=2*Math.sqrt(1+R-p-M),i[3]=(b-w)/B,i[0]=(E+y)/B,i[1]=(T+P)/B,i[2]=.25*B),i},Gt.fromRotationTranslationScale=function(i,e,n,a){var c=e[0],m=e[1],p=e[2],b=e[3],y=c+c,w=m+m,M=p+p,T=c*y,E=c*w,P=c*M,R=m*w,F=m*M,B=p*M,W=b*y,J=b*w,ee=b*M,te=a[0],pe=a[1],he=a[2];return i[0]=(1-(R+B))*te,i[1]=(E+ee)*te,i[2]=(P-J)*te,i[3]=0,i[4]=(E-ee)*pe,i[5]=(1-(T+B))*pe,i[6]=(F+W)*pe,i[7]=0,i[8]=(P+J)*he,i[9]=(F-W)*he,i[10]=(1-(T+R))*he,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i},Gt.fromRotationTranslationScaleOrigin=function(i,e,n,a,c){var m=e[0],p=e[1],b=e[2],y=e[3],w=m+m,M=p+p,T=b+b,E=m*w,P=m*M,R=m*T,F=p*M,B=p*T,W=b*T,J=y*w,ee=y*M,te=y*T,pe=a[0],he=a[1],ve=a[2],Ce=c[0],De=c[1],Ue=c[2],ze=(1-(F+W))*pe,$e=(P+te)*pe,ot=(R-ee)*pe,We=(P-te)*he,et=(1-(E+W))*he,He=(B+J)*he,tt=(R+ee)*ve,ct=(B-J)*ve,nt=(1-(E+F))*ve;return i[0]=ze,i[1]=$e,i[2]=ot,i[3]=0,i[4]=We,i[5]=et,i[6]=He,i[7]=0,i[8]=tt,i[9]=ct,i[10]=nt,i[11]=0,i[12]=n[0]+Ce-(ze*Ce+We*De+tt*Ue),i[13]=n[1]+De-($e*Ce+et*De+ct*Ue),i[14]=n[2]+Ue-(ot*Ce+He*De+nt*Ue),i[15]=1,i},Gt.fromQuat=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n+n,b=a+a,y=c+c,w=n*p,M=a*p,T=a*b,E=c*p,P=c*b,R=c*y,F=m*p,B=m*b,W=m*y;return i[0]=1-T-R,i[1]=M+W,i[2]=E-B,i[3]=0,i[4]=M-W,i[5]=1-w-R,i[6]=P+F,i[7]=0,i[8]=E+B,i[9]=P-F,i[10]=1-w-T,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.frustum=function(i,e,n,a,c,m,p){var b=1/(n-e),y=1/(c-a),w=1/(m-p);return i[0]=2*m*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*m*y,i[6]=0,i[7]=0,i[8]=(n+e)*b,i[9]=(c+a)*y,i[10]=(p+m)*w,i[11]=-1,i[12]=0,i[13]=0,i[14]=p*m*2*w,i[15]=0,i},Gt.perspectiveNO=sa,Gt.perspectiveZO=function(i,e,n,a,c){var m,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=c*(m=1/(a-c)),i[14]=c*a*m):(i[10]=-1,i[14]=-a),i},Gt.perspectiveFromFieldOfView=function(i,e,n,a){var c=Math.tan(e.upDegrees*Math.PI/180),m=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),b=Math.tan(e.rightDegrees*Math.PI/180),y=2/(p+b),w=2/(c+m);return i[0]=y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=w,i[6]=0,i[7]=0,i[8]=-(p-b)*y*.5,i[9]=(c-m)*w*.5,i[10]=a/(n-a),i[11]=-1,i[12]=0,i[13]=0,i[14]=a*n/(n-a),i[15]=0,i},Gt.orthoNO=la,Gt.orthoZO=function(i,e,n,a,c,m,p){var b=1/(e-n),y=1/(a-c),w=1/(m-p);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=w,i[11]=0,i[12]=(e+n)*b,i[13]=(c+a)*y,i[14]=m*w,i[15]=1,i},Gt.lookAt=function(i,e,n,a){var c,m,p,b,y,w,M,T,E,P,R=e[0],F=e[1],B=e[2],W=a[0],J=a[1],ee=a[2],te=n[0],pe=n[1],he=n[2];return Math.abs(R-te)<Cn.EPSILON&&Math.abs(F-pe)<Cn.EPSILON&&Math.abs(B-he)<Cn.EPSILON?ou(i):(M=R-te,T=F-pe,E=B-he,c=J*(E*=P=1/Math.hypot(M,T,E))-ee*(T*=P),m=ee*(M*=P)-W*E,p=W*T-J*M,(P=Math.hypot(c,m,p))?(c*=P=1/P,m*=P,p*=P):(c=0,m=0,p=0),b=T*p-E*m,y=E*c-M*p,w=M*m-T*c,(P=Math.hypot(b,y,w))?(b*=P=1/P,y*=P,w*=P):(b=0,y=0,w=0),i[0]=c,i[1]=b,i[2]=M,i[3]=0,i[4]=m,i[5]=y,i[6]=T,i[7]=0,i[8]=p,i[9]=w,i[10]=E,i[11]=0,i[12]=-(c*R+m*F+p*B),i[13]=-(b*R+y*F+w*B),i[14]=-(M*R+T*F+E*B),i[15]=1,i)},Gt.targetTo=function(i,e,n,a){var c=e[0],m=e[1],p=e[2],b=a[0],y=a[1],w=a[2],M=c-n[0],T=m-n[1],E=p-n[2],P=M*M+T*T+E*E;P>0&&(M*=P=1/Math.sqrt(P),T*=P,E*=P);var R=y*E-w*T,F=w*M-b*E,B=b*T-y*M;return(P=R*R+F*F+B*B)>0&&(R*=P=1/Math.sqrt(P),F*=P,B*=P),i[0]=R,i[1]=F,i[2]=B,i[3]=0,i[4]=T*B-E*F,i[5]=E*R-M*B,i[6]=M*F-T*R,i[7]=0,i[8]=M,i[9]=T,i[10]=E,i[11]=0,i[12]=c,i[13]=m,i[14]=p,i[15]=1,i},Gt.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},Gt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},Gt.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i[8]=e[8]+n[8],i[9]=e[9]+n[9],i[10]=e[10]+n[10],i[11]=e[11]+n[11],i[12]=e[12]+n[12],i[13]=e[13]+n[13],i[14]=e[14]+n[14],i[15]=e[15]+n[15],i},Gt.subtract=Od,Gt.multiplyScalar=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*n,i[9]=e[9]*n,i[10]=e[10]*n,i[11]=e[11]*n,i[12]=e[12]*n,i[13]=e[13]*n,i[14]=e[14]*n,i[15]=e[15]*n,i},Gt.multiplyScalarAndAdd=function(i,e,n,a){return i[0]=e[0]+n[0]*a,i[1]=e[1]+n[1]*a,i[2]=e[2]+n[2]*a,i[3]=e[3]+n[3]*a,i[4]=e[4]+n[4]*a,i[5]=e[5]+n[5]*a,i[6]=e[6]+n[6]*a,i[7]=e[7]+n[7]*a,i[8]=e[8]+n[8]*a,i[9]=e[9]+n[9]*a,i[10]=e[10]+n[10]*a,i[11]=e[11]+n[11]*a,i[12]=e[12]+n[12]*a,i[13]=e[13]+n[13]*a,i[14]=e[14]+n[14]*a,i[15]=e[15]+n[15]*a,i},Gt.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},Gt.equals=function(i,e){var n=i[0],a=i[1],c=i[2],m=i[3],p=i[4],b=i[5],y=i[6],w=i[7],M=i[8],T=i[9],E=i[10],P=i[11],R=i[12],F=i[13],B=i[14],W=i[15],J=e[0],ee=e[1],te=e[2],pe=e[3],he=e[4],ve=e[5],Ce=e[6],De=e[7],Ue=e[8],ze=e[9],$e=e[10],ot=e[11],We=e[12],et=e[13],He=e[14],tt=e[15];return Math.abs(n-J)<=Cn.EPSILON*Math.max(1,Math.abs(n),Math.abs(J))&&Math.abs(a-ee)<=Cn.EPSILON*Math.max(1,Math.abs(a),Math.abs(ee))&&Math.abs(c-te)<=Cn.EPSILON*Math.max(1,Math.abs(c),Math.abs(te))&&Math.abs(m-pe)<=Cn.EPSILON*Math.max(1,Math.abs(m),Math.abs(pe))&&Math.abs(p-he)<=Cn.EPSILON*Math.max(1,Math.abs(p),Math.abs(he))&&Math.abs(b-ve)<=Cn.EPSILON*Math.max(1,Math.abs(b),Math.abs(ve))&&Math.abs(y-Ce)<=Cn.EPSILON*Math.max(1,Math.abs(y),Math.abs(Ce))&&Math.abs(w-De)<=Cn.EPSILON*Math.max(1,Math.abs(w),Math.abs(De))&&Math.abs(M-Ue)<=Cn.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ue))&&Math.abs(T-ze)<=Cn.EPSILON*Math.max(1,Math.abs(T),Math.abs(ze))&&Math.abs(E-$e)<=Cn.EPSILON*Math.max(1,Math.abs(E),Math.abs($e))&&Math.abs(P-ot)<=Cn.EPSILON*Math.max(1,Math.abs(P),Math.abs(ot))&&Math.abs(R-We)<=Cn.EPSILON*Math.max(1,Math.abs(R),Math.abs(We))&&Math.abs(F-et)<=Cn.EPSILON*Math.max(1,Math.abs(F),Math.abs(et))&&Math.abs(B-He)<=Cn.EPSILON*Math.max(1,Math.abs(B),Math.abs(He))&&Math.abs(W-tt)<=Cn.EPSILON*Math.max(1,Math.abs(W),Math.abs(tt))},Gt.sub=Gt.mul=Gt.ortho=Gt.perspective=void 0;var Cn=function(i,e){if(i&&i.__esModule)return i;if(i===null||ec(i)!=="object"&&typeof i!="function")return{default:i};var n=ru(void 0);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}(ut);function ru(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ru=function(a){return a?n:e})(i)}function ou(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function au(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=e[9],P=e[10],R=e[11],F=e[12],B=e[13],W=e[14],J=e[15],ee=n[0],te=n[1],pe=n[2],he=n[3];return i[0]=ee*a+te*b+pe*T+he*F,i[1]=ee*c+te*y+pe*E+he*B,i[2]=ee*m+te*w+pe*P+he*W,i[3]=ee*p+te*M+pe*R+he*J,i[4]=(ee=n[4])*a+(te=n[5])*b+(pe=n[6])*T+(he=n[7])*F,i[5]=ee*c+te*y+pe*E+he*B,i[6]=ee*m+te*w+pe*P+he*W,i[7]=ee*p+te*M+pe*R+he*J,i[8]=(ee=n[8])*a+(te=n[9])*b+(pe=n[10])*T+(he=n[11])*F,i[9]=ee*c+te*y+pe*E+he*B,i[10]=ee*m+te*w+pe*P+he*W,i[11]=ee*p+te*M+pe*R+he*J,i[12]=(ee=n[12])*a+(te=n[13])*b+(pe=n[14])*T+(he=n[15])*F,i[13]=ee*c+te*y+pe*E+he*B,i[14]=ee*m+te*w+pe*P+he*W,i[15]=ee*p+te*M+pe*R+he*J,i}function Pd(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=a+a,y=c+c,w=m+m,M=a*b,T=a*y,E=a*w,P=c*y,R=c*w,F=m*w,B=p*b,W=p*y,J=p*w;return i[0]=1-(P+F),i[1]=T+J,i[2]=E-W,i[3]=0,i[4]=T-J,i[5]=1-(M+F),i[6]=R+B,i[7]=0,i[8]=E+W,i[9]=R-B,i[10]=1-(M+P),i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i}function tc(i,e){var n=e[4],a=e[5],c=e[6],m=e[8],p=e[9],b=e[10];return i[0]=Math.hypot(e[0],e[1],e[2]),i[1]=Math.hypot(n,a,c),i[2]=Math.hypot(m,p,b),i}function sa(i,e,n,a,c){var m,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+a)*(m=1/(a-c)),i[14]=2*c*a*m):(i[10]=-1,i[14]=-2*a),i}function la(i,e,n,a,c,m,p){var b=1/(e-n),y=1/(a-c),w=1/(m-p);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+n)*b,i[13]=(c+a)*y,i[14]=(p+m)*w,i[15]=1,i}function Od(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i[4]=e[4]-n[4],i[5]=e[5]-n[5],i[6]=e[6]-n[6],i[7]=e[7]-n[7],i[8]=e[8]-n[8],i[9]=e[9]-n[9],i[10]=e[10]-n[10],i[11]=e[11]-n[11],i[12]=e[12]-n[12],i[13]=e[13]-n[13],i[14]=e[14]-n[14],i[15]=e[15]-n[15],i}Gt.perspective=sa,Gt.ortho=la,Gt.mul=au,Gt.sub=Od;var Qt={},Jt={};function ic(i){return ic=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ic(i)}Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=nc,Jt.clone=function(i){var e=new go.ARRAY_TYPE(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},Jt.length=rc,Jt.fromValues=function(i,e,n){var a=new go.ARRAY_TYPE(3);return a[0]=i,a[1]=e,a[2]=n,a},Jt.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},Jt.set=function(i,e,n,a){return i[0]=e,i[1]=n,i[2]=a,i},Jt.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i},Jt.subtract=Rd,Jt.multiply=Is,Jt.divide=sl,Jt.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2]),i},Jt.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2]),i},Jt.min=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i},Jt.max=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i},Jt.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i[2]=Math.round(e[2]),i},Jt.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i},Jt.scaleAndAdd=function(i,e,n,a){return i[0]=e[0]+n[0]*a,i[1]=e[1]+n[1]*a,i[2]=e[2]+n[2]*a,i},Jt.distance=oc,Jt.squaredDistance=Ld,Jt.squaredLength=ac,Jt.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i},Jt.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],i},Jt.normalize=function(i,e){var n=e[0],a=e[1],c=e[2],m=n*n+a*a+c*c;return m>0&&(m=1/Math.sqrt(m)),i[0]=e[0]*m,i[1]=e[1]*m,i[2]=e[2]*m,i},Jt.dot=sc,Jt.cross=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=n[0],b=n[1],y=n[2];return i[0]=c*y-m*b,i[1]=m*p-a*y,i[2]=a*b-c*p,i},Jt.lerp=function(i,e,n,a){var c=e[0],m=e[1],p=e[2];return i[0]=c+a*(n[0]-c),i[1]=m+a*(n[1]-m),i[2]=p+a*(n[2]-p),i},Jt.hermite=function(i,e,n,a,c,m){var p=m*m,b=p*(2*m-3)+1,y=p*(m-2)+m,w=p*(m-1),M=p*(3-2*m);return i[0]=e[0]*b+n[0]*y+a[0]*w+c[0]*M,i[1]=e[1]*b+n[1]*y+a[1]*w+c[1]*M,i[2]=e[2]*b+n[2]*y+a[2]*w+c[2]*M,i},Jt.bezier=function(i,e,n,a,c,m){var p=1-m,b=p*p,y=m*m,w=b*p,M=3*m*b,T=3*y*p,E=y*m;return i[0]=e[0]*w+n[0]*M+a[0]*T+c[0]*E,i[1]=e[1]*w+n[1]*M+a[1]*T+c[1]*E,i[2]=e[2]*w+n[2]*M+a[2]*T+c[2]*E,i},Jt.random=function(i,e){e=e||1;var n=2*go.RANDOM()*Math.PI,a=2*go.RANDOM()-1,c=Math.sqrt(1-a*a)*e;return i[0]=Math.cos(n)*c,i[1]=Math.sin(n)*c,i[2]=a*e,i},Jt.transformMat4=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=n[3]*a+n[7]*c+n[11]*m+n[15];return i[0]=(n[0]*a+n[4]*c+n[8]*m+n[12])/(p=p||1),i[1]=(n[1]*a+n[5]*c+n[9]*m+n[13])/p,i[2]=(n[2]*a+n[6]*c+n[10]*m+n[14])/p,i},Jt.transformMat3=function(i,e,n){var a=e[0],c=e[1],m=e[2];return i[0]=a*n[0]+c*n[3]+m*n[6],i[1]=a*n[1]+c*n[4]+m*n[7],i[2]=a*n[2]+c*n[5]+m*n[8],i},Jt.transformQuat=function(i,e,n){var a=n[0],c=n[1],m=n[2],p=e[0],b=e[1],y=e[2],w=c*y-m*b,M=m*p-a*y,T=a*b-c*p,E=c*T-m*M,P=m*w-a*T,R=a*M-c*w,F=2*n[3];return M*=F,T*=F,P*=2,R*=2,i[0]=p+(w*=F)+(E*=2),i[1]=b+M+P,i[2]=y+T+R,i},Jt.rotateX=function(i,e,n,a){var c=[],m=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],m[0]=c[0],m[1]=c[1]*Math.cos(a)-c[2]*Math.sin(a),m[2]=c[1]*Math.sin(a)+c[2]*Math.cos(a),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},Jt.rotateY=function(i,e,n,a){var c=[],m=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],m[0]=c[2]*Math.sin(a)+c[0]*Math.cos(a),m[1]=c[1],m[2]=c[2]*Math.cos(a)-c[0]*Math.sin(a),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},Jt.rotateZ=function(i,e,n,a){var c=[],m=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],m[0]=c[0]*Math.cos(a)-c[1]*Math.sin(a),m[1]=c[0]*Math.sin(a)+c[1]*Math.cos(a),m[2]=c[2],i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},Jt.angle=function(i,e){var n=i[0],a=i[1],c=i[2],m=e[0],p=e[1],b=e[2],y=Math.sqrt(n*n+a*a+c*c)*Math.sqrt(m*m+p*p+b*b),w=y&&sc(i,e)/y;return Math.acos(Math.min(Math.max(w,-1),1))},Jt.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},Jt.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},Jt.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},Jt.equals=function(i,e){var n=i[0],a=i[1],c=i[2],m=e[0],p=e[1],b=e[2];return Math.abs(n-m)<=go.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-p)<=go.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(c-b)<=go.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))},Jt.forEach=Jt.sqrLen=Jt.len=Jt.sqrDist=Jt.dist=Jt.div=Jt.mul=Jt.sub=void 0;var go=function(i,e){if(i&&i.__esModule)return i;if(i===null||ic(i)!=="object"&&typeof i!="function")return{default:i};var n=al(void 0);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}(ut);function al(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(al=function(a){return a?n:e})(i)}function nc(){var i=new go.ARRAY_TYPE(3);return go.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function rc(i){return Math.hypot(i[0],i[1],i[2])}function Rd(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function Is(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function sl(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i}function oc(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])}function Ld(i,e){var n=e[0]-i[0],a=e[1]-i[1],c=e[2]-i[2];return n*n+a*a+c*c}function ac(i){var e=i[0],n=i[1],a=i[2];return e*e+n*n+a*a}function sc(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}Jt.sub=Rd,Jt.mul=Is,Jt.div=sl,Jt.dist=oc,Jt.sqrDist=Ld,Jt.len=rc,Jt.sqrLen=ac;var Bo,su=(Bo=nc(),function(i,e,n,a,c,m){var p,b;for(e||(e=3),n||(n=0),b=a?Math.min(a*e+n,i.length):i.length,p=n;p<b;p+=e)Bo[0]=i[p],Bo[1]=i[p+1],Bo[2]=i[p+2],c(Bo,Bo,m),i[p]=Bo[0],i[p+1]=Bo[1],i[p+2]=Bo[2];return i});Jt.forEach=su;var ei={};function Fd(i){return Fd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fd(i)}Object.defineProperty(ei,"__esModule",{value:!0}),ei.create=ll,ei.clone=function(i){var e=new Un.ARRAY_TYPE(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e},ei.fromValues=function(i,e,n,a){var c=new Un.ARRAY_TYPE(4);return c[0]=i,c[1]=e,c[2]=n,c[3]=a,c},ei.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},ei.set=function(i,e,n,a,c){return i[0]=e,i[1]=n,i[2]=a,i[3]=c,i},ei.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},ei.subtract=Ia,ei.multiply=Ta,ei.divide=zd,ei.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2]),i[3]=Math.ceil(e[3]),i},ei.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2]),i[3]=Math.floor(e[3]),i},ei.min=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i[3]=Math.min(e[3],n[3]),i},ei.max=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i[3]=Math.max(e[3],n[3]),i},ei.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i[2]=Math.round(e[2]),i[3]=Math.round(e[3]),i},ei.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},ei.scaleAndAdd=function(i,e,n,a){return i[0]=e[0]+n[0]*a,i[1]=e[1]+n[1]*a,i[2]=e[2]+n[2]*a,i[3]=e[3]+n[3]*a,i},ei.distance=Ts,ei.squaredDistance=Es,ei.length=cc,ei.squaredLength=dc,ei.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=-e[3],i},ei.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i[2]=1/e[2],i[3]=1/e[3],i},ei.normalize=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n*n+a*a+c*c+m*m;return p>0&&(p=1/Math.sqrt(p)),i[0]=n*p,i[1]=a*p,i[2]=c*p,i[3]=m*p,i},ei.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},ei.cross=function(i,e,n,a){var c=n[0]*a[1]-n[1]*a[0],m=n[0]*a[2]-n[2]*a[0],p=n[0]*a[3]-n[3]*a[0],b=n[1]*a[2]-n[2]*a[1],y=n[1]*a[3]-n[3]*a[1],w=n[2]*a[3]-n[3]*a[2],M=e[0],T=e[1],E=e[2],P=e[3];return i[0]=T*w-E*y+P*b,i[1]=-M*w+E*p-P*m,i[2]=M*y-T*p+P*c,i[3]=-M*b+T*m-E*c,i},ei.lerp=function(i,e,n,a){var c=e[0],m=e[1],p=e[2],b=e[3];return i[0]=c+a*(n[0]-c),i[1]=m+a*(n[1]-m),i[2]=p+a*(n[2]-p),i[3]=b+a*(n[3]-b),i},ei.random=function(i,e){var n,a,c,m,p,b;e=e||1;do p=(n=2*Un.RANDOM()-1)*n+(a=2*Un.RANDOM()-1)*a;while(p>=1);do b=(c=2*Un.RANDOM()-1)*c+(m=2*Un.RANDOM()-1)*m;while(b>=1);var y=Math.sqrt((1-p)/b);return i[0]=e*n,i[1]=e*a,i[2]=e*c*y,i[3]=e*m*y,i},ei.transformMat4=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3];return i[0]=n[0]*a+n[4]*c+n[8]*m+n[12]*p,i[1]=n[1]*a+n[5]*c+n[9]*m+n[13]*p,i[2]=n[2]*a+n[6]*c+n[10]*m+n[14]*p,i[3]=n[3]*a+n[7]*c+n[11]*m+n[15]*p,i},ei.transformQuat=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=n[0],b=n[1],y=n[2],w=n[3],M=w*a+b*m-y*c,T=w*c+y*a-p*m,E=w*m+p*c-b*a,P=-p*a-b*c-y*m;return i[0]=M*w+P*-p+T*-y-E*-b,i[1]=T*w+P*-b+E*-p-M*-y,i[2]=E*w+P*-y+M*-b-T*-p,i[3]=e[3],i},ei.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},ei.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},ei.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},ei.equals=function(i,e){var n=i[0],a=i[1],c=i[2],m=i[3],p=e[0],b=e[1],y=e[2],w=e[3];return Math.abs(n-p)<=Un.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-b)<=Un.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(c-y)<=Un.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(m-w)<=Un.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))},ei.forEach=ei.sqrLen=ei.len=ei.sqrDist=ei.dist=ei.div=ei.mul=ei.sub=void 0;var Un=function(i,e){if(i&&i.__esModule)return i;if(i===null||Fd(i)!=="object"&&typeof i!="function")return{default:i};var n=lc(void 0);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}(ut);function lc(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(lc=function(a){return a?n:e})(i)}function ll(){var i=new Un.ARRAY_TYPE(4);return Un.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function Ia(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}function Ta(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i}function zd(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i[3]=e[3]/n[3],i}function Ts(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2],e[3]-i[3])}function Es(i,e){var n=e[0]-i[0],a=e[1]-i[1],c=e[2]-i[2],m=e[3]-i[3];return n*n+a*a+c*c+m*m}function cc(i){return Math.hypot(i[0],i[1],i[2],i[3])}function dc(i){var e=i[0],n=i[1],a=i[2],c=i[3];return e*e+n*n+a*a+c*c}ei.sub=Ia,ei.mul=Ta,ei.div=zd,ei.dist=Ts,ei.sqrDist=Es,ei.len=cc,ei.sqrLen=dc;var lu=function(){var i=ll();return function(e,n,a,c,m,p){var b,y;for(n||(n=4),a||(a=0),y=c?Math.min(c*n+a,e.length):e.length,b=a;b<y;b+=n)i[0]=e[b],i[1]=e[b+1],i[2]=e[b+2],i[3]=e[b+3],m(i,i,p),e[b]=i[0],e[b+1]=i[1],e[b+2]=i[2],e[b+3]=i[3];return e}}();function hc(i){return hc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hc(i)}ei.forEach=lu,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.create=uc,Qt.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},Qt.setAxisAngle=Bd,Qt.getAxisAngle=function(i,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>No.EPSILON?(i[0]=e[0]/a,i[1]=e[1]/a,i[2]=e[2]/a):(i[0]=1,i[1]=0,i[2]=0),n},Qt.getAngle=function(i,e){var n=ye(i,e);return Math.acos(2*n*n-1)},Qt.multiply=mc,Qt.rotateX=function(i,e,n){n*=.5;var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return i[0]=a*y+p*b,i[1]=c*y+m*b,i[2]=m*y-c*b,i[3]=p*y-a*b,i},Qt.rotateY=function(i,e,n){n*=.5;var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return i[0]=a*y-m*b,i[1]=c*y+p*b,i[2]=m*y+a*b,i[3]=p*y-c*b,i},Qt.rotateZ=function(i,e,n){n*=.5;var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return i[0]=a*y+c*b,i[1]=c*y-a*b,i[2]=m*y+p*b,i[3]=p*y-m*b,i},Qt.calculateW=function(i,e){var n=e[0],a=e[1],c=e[2];return i[0]=n,i[1]=a,i[2]=c,i[3]=Math.sqrt(Math.abs(1-n*n-a*a-c*c)),i},Qt.exp=Se,Qt.ln=G,Qt.pow=function(i,e,n){return G(i,e),be(i,i,n),Se(i,i),i},Qt.slerp=K,Qt.random=function(i){var e=No.RANDOM(),n=No.RANDOM(),a=No.RANDOM(),c=Math.sqrt(1-e),m=Math.sqrt(e);return i[0]=c*Math.sin(2*Math.PI*n),i[1]=c*Math.cos(2*Math.PI*n),i[2]=m*Math.sin(2*Math.PI*a),i[3]=m*Math.cos(2*Math.PI*a),i},Qt.invert=function(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n*n+a*a+c*c+m*m,b=p?1/p:0;return i[0]=-n*b,i[1]=-a*b,i[2]=-c*b,i[3]=m*b,i},Qt.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},Qt.fromMat3=ce,Qt.fromEuler=function(i,e,n,a){var c=.5*Math.PI/180;e*=c,n*=c,a*=c;var m=Math.sin(e),p=Math.cos(e),b=Math.sin(n),y=Math.cos(n),w=Math.sin(a),M=Math.cos(a);return i[0]=m*y*M-p*b*w,i[1]=p*b*M+m*y*w,i[2]=p*y*w-m*b*M,i[3]=p*y*M+m*b*w,i},Qt.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},Qt.setAxes=Qt.sqlerp=Qt.rotationTo=Qt.equals=Qt.exactEquals=Qt.normalize=Qt.sqrLen=Qt.squaredLength=Qt.len=Qt.length=Qt.lerp=Qt.dot=Qt.scale=Qt.mul=Qt.add=Qt.set=Qt.copy=Qt.fromValues=Qt.clone=void 0;var No=cl(ut),Ds=cl(Ti),Vo=cl(Jt),Pr=cl(ei);function cu(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(cu=function(a){return a?n:e})(i)}function cl(i,e){if(i&&i.__esModule)return i;if(i===null||hc(i)!=="object"&&typeof i!="function")return{default:i};var n=cu(e);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}function uc(){var i=new No.ARRAY_TYPE(4);return No.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Bd(i,e,n){n*=.5;var a=Math.sin(n);return i[0]=a*e[0],i[1]=a*e[1],i[2]=a*e[2],i[3]=Math.cos(n),i}function mc(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return i[0]=a*M+p*b+c*w-m*y,i[1]=c*M+p*y+m*b-a*w,i[2]=m*M+p*w+a*y-c*b,i[3]=p*M-a*b-c*y-m*w,i}function Se(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=Math.sqrt(n*n+a*a+c*c),b=Math.exp(m),y=p>0?b*Math.sin(p)/p:0;return i[0]=n*y,i[1]=a*y,i[2]=c*y,i[3]=b*Math.cos(p),i}function G(i,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=Math.sqrt(n*n+a*a+c*c),b=p>0?Math.atan2(p,m)/p:0;return i[0]=n*b,i[1]=a*b,i[2]=c*b,i[3]=.5*Math.log(n*n+a*a+c*c+m*m),i}function K(i,e,n,a){var c,m,p,b,y,w=e[0],M=e[1],T=e[2],E=e[3],P=n[0],R=n[1],F=n[2],B=n[3];return(m=w*P+M*R+T*F+E*B)<0&&(m=-m,P=-P,R=-R,F=-F,B=-B),1-m>No.EPSILON?(c=Math.acos(m),p=Math.sin(c),b=Math.sin((1-a)*c)/p,y=Math.sin(a*c)/p):(b=1-a,y=a),i[0]=b*w+y*P,i[1]=b*M+y*R,i[2]=b*T+y*F,i[3]=b*E+y*B,i}function ce(i,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),i[3]=.5*n,i[0]=(e[5]-e[7])*(n=.5/n),i[1]=(e[6]-e[2])*n,i[2]=(e[1]-e[3])*n;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var m=(c+1)%3,p=(c+2)%3;n=Math.sqrt(e[3*c+c]-e[3*m+m]-e[3*p+p]+1),i[c]=.5*n,i[3]=(e[3*m+p]-e[3*p+m])*(n=.5/n),i[m]=(e[3*m+c]+e[3*c+m])*n,i[p]=(e[3*p+c]+e[3*c+p])*n}return i}Qt.clone=Pr.clone,Qt.fromValues=Pr.fromValues,Qt.copy=Pr.copy,Qt.set=Pr.set,Qt.add=Pr.add,Qt.mul=mc;var be=Pr.scale;Qt.scale=be;var ye=Pr.dot;Qt.dot=ye,Qt.lerp=Pr.lerp;var Ee=Pr.length;Qt.length=Ee,Qt.len=Ee;var Ne=Pr.squaredLength;Qt.squaredLength=Ne,Qt.sqrLen=Ne;var Ie=Pr.normalize;Qt.normalize=Ie,Qt.exactEquals=Pr.exactEquals,Qt.equals=Pr.equals;var je,ft,lt,Rt=(je=Vo.create(),ft=Vo.fromValues(1,0,0),lt=Vo.fromValues(0,1,0),function(i,e,n){var a=Vo.dot(e,n);return a<-.999999?(Vo.cross(je,ft,e),Vo.len(je)<1e-6&&Vo.cross(je,lt,e),Vo.normalize(je,je),Bd(i,je,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Vo.cross(je,e,n),i[0]=je[0],i[1]=je[1],i[2]=je[2],i[3]=1+a,Ie(i,i))});Qt.rotationTo=Rt;var $t,pi,yi=($t=uc(),pi=uc(),function(i,e,n,a,c,m){return K($t,e,c,m),K(pi,n,a,m),K(i,$t,pi,2*m*(1-m)),i});Qt.sqlerp=yi;var ri,Ei=(ri=Ds.create(),function(i,e,n,a){return ri[0]=n[0],ri[3]=n[1],ri[6]=n[2],ri[1]=a[0],ri[4]=a[1],ri[7]=a[2],ri[2]=-e[0],ri[5]=-e[1],ri[8]=-e[2],Ie(i,ce(i,ri))});Qt.setAxes=Ei;var At={};function Sn(i){return Sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sn(i)}Object.defineProperty(At,"__esModule",{value:!0}),At.create=function(){var i=new Qi.ARRAY_TYPE(8);return Qi.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},At.clone=function(i){var e=new Qi.ARRAY_TYPE(8);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e},At.fromValues=function(i,e,n,a,c,m,p,b){var y=new Qi.ARRAY_TYPE(8);return y[0]=i,y[1]=e,y[2]=n,y[3]=a,y[4]=c,y[5]=m,y[6]=p,y[7]=b,y},At.fromRotationTranslationValues=function(i,e,n,a,c,m,p){var b=new Qi.ARRAY_TYPE(8);b[0]=i,b[1]=e,b[2]=n,b[3]=a;var y=.5*c,w=.5*m,M=.5*p;return b[4]=y*a+w*n-M*e,b[5]=w*a+M*i-y*n,b[6]=M*a+y*e-w*i,b[7]=-y*i-w*e-M*n,b},At.fromRotationTranslation=Hr,At.fromTranslation=function(i,e){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*e[0],i[5]=.5*e[1],i[6]=.5*e[2],i[7]=0,i},At.fromRotation=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},At.fromMat4=function(i,e){var n=Oi.create();Qn.getRotation(n,e);var a=new Qi.ARRAY_TYPE(3);return Qn.getTranslation(a,e),Hr(i,n,a),i},At.copy=Wr,At.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},At.set=function(i,e,n,a,c,m,p,b,y){return i[0]=e,i[1]=n,i[2]=a,i[3]=c,i[4]=m,i[5]=p,i[6]=b,i[7]=y,i},At.getDual=function(i,e){return i[0]=e[4],i[1]=e[5],i[2]=e[6],i[3]=e[7],i},At.setDual=function(i,e){return i[4]=e[0],i[5]=e[1],i[6]=e[2],i[7]=e[3],i},At.getTranslation=function(i,e){var n=e[4],a=e[5],c=e[6],m=e[7],p=-e[0],b=-e[1],y=-e[2],w=e[3];return i[0]=2*(n*w+m*p+a*y-c*b),i[1]=2*(a*w+m*b+c*p-n*y),i[2]=2*(c*w+m*y+n*b-a*p),i},At.translate=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=.5*n[0],y=.5*n[1],w=.5*n[2],M=e[4],T=e[5],E=e[6],P=e[7];return i[0]=a,i[1]=c,i[2]=m,i[3]=p,i[4]=p*b+c*w-m*y+M,i[5]=p*y+m*b-a*w+T,i[6]=p*w+a*y-c*b+E,i[7]=-a*b-c*y-m*w+P,i},At.rotateX=function(i,e,n){var a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*a+y*m-w*c,E=y*p+M*c+w*a-b*m,P=w*p+M*m+b*c-y*a,R=M*p-b*a-y*c-w*m;return Oi.rotateX(i,e,n),i[4]=T*(p=i[3])+R*(a=i[0])+E*(m=i[2])-P*(c=i[1]),i[5]=E*p+R*c+P*a-T*m,i[6]=P*p+R*m+T*c-E*a,i[7]=R*p-T*a-E*c-P*m,i},At.rotateY=function(i,e,n){var a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*a+y*m-w*c,E=y*p+M*c+w*a-b*m,P=w*p+M*m+b*c-y*a,R=M*p-b*a-y*c-w*m;return Oi.rotateY(i,e,n),i[4]=T*(p=i[3])+R*(a=i[0])+E*(m=i[2])-P*(c=i[1]),i[5]=E*p+R*c+P*a-T*m,i[6]=P*p+R*m+T*c-E*a,i[7]=R*p-T*a-E*c-P*m,i},At.rotateZ=function(i,e,n){var a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*a+y*m-w*c,E=y*p+M*c+w*a-b*m,P=w*p+M*m+b*c-y*a,R=M*p-b*a-y*c-w*m;return Oi.rotateZ(i,e,n),i[4]=T*(p=i[3])+R*(a=i[0])+E*(m=i[2])-P*(c=i[1]),i[5]=E*p+R*c+P*a-T*m,i[6]=P*p+R*m+T*c-E*a,i[7]=R*p-T*a-E*c-P*m,i},At.rotateByQuatAppend=function(i,e,n){var a=n[0],c=n[1],m=n[2],p=n[3],b=e[0],y=e[1],w=e[2],M=e[3];return i[0]=b*p+M*a+y*m-w*c,i[1]=y*p+M*c+w*a-b*m,i[2]=w*p+M*m+b*c-y*a,i[3]=M*p-b*a-y*c-w*m,i[4]=(b=e[4])*p+(M=e[7])*a+(y=e[5])*m-(w=e[6])*c,i[5]=y*p+M*c+w*a-b*m,i[6]=w*p+M*m+b*c-y*a,i[7]=M*p-b*a-y*c-w*m,i},At.rotateByQuatPrepend=function(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return i[0]=a*M+p*b+c*w-m*y,i[1]=c*M+p*y+m*b-a*w,i[2]=m*M+p*w+a*y-c*b,i[3]=p*M-a*b-c*y-m*w,i[4]=a*(M=n[7])+p*(b=n[4])+c*(w=n[6])-m*(y=n[5]),i[5]=c*M+p*y+m*b-a*w,i[6]=m*M+p*w+a*y-c*b,i[7]=p*M-a*b-c*y-m*w,i},At.rotateAroundAxis=function(i,e,n,a){if(Math.abs(a)<Qi.EPSILON)return Wr(i,e);var c=Math.hypot(n[0],n[1],n[2]);a*=.5;var m=Math.sin(a),p=m*n[0]/c,b=m*n[1]/c,y=m*n[2]/c,w=Math.cos(a),M=e[0],T=e[1],E=e[2],P=e[3];i[0]=M*w+P*p+T*y-E*b,i[1]=T*w+P*b+E*p-M*y,i[2]=E*w+P*y+M*b-T*p,i[3]=P*w-M*p-T*b-E*y;var R=e[4],F=e[5],B=e[6],W=e[7];return i[4]=R*w+W*p+F*y-B*b,i[5]=F*w+W*b+B*p-R*y,i[6]=B*w+W*y+R*b-F*p,i[7]=W*w-R*p-F*b-B*y,i},At.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i},At.multiply=dl,At.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i},At.lerp=function(i,e,n,a){var c=1-a;return lp(e,n)<0&&(a=-a),i[0]=e[0]*c+n[0]*a,i[1]=e[1]*c+n[1]*a,i[2]=e[2]*c+n[2]*a,i[3]=e[3]*c+n[3]*a,i[4]=e[4]*c+n[4]*a,i[5]=e[5]*c+n[5]*a,i[6]=e[6]*c+n[6]*a,i[7]=e[7]*c+n[7]*a,i},At.invert=function(i,e){var n=Nd(e);return i[0]=-e[0]/n,i[1]=-e[1]/n,i[2]=-e[2]/n,i[3]=e[3]/n,i[4]=-e[4]/n,i[5]=-e[5]/n,i[6]=-e[6]/n,i[7]=e[7]/n,i},At.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i[4]=-e[4],i[5]=-e[5],i[6]=-e[6],i[7]=e[7],i},At.normalize=function(i,e){var n=Nd(e);if(n>0){n=Math.sqrt(n);var a=e[0]/n,c=e[1]/n,m=e[2]/n,p=e[3]/n,b=e[4],y=e[5],w=e[6],M=e[7],T=a*b+c*y+m*w+p*M;i[0]=a,i[1]=c,i[2]=m,i[3]=p,i[4]=(b-a*T)/n,i[5]=(y-c*T)/n,i[6]=(w-m*T)/n,i[7]=(M-p*T)/n}return i},At.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},At.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]},At.equals=function(i,e){var n=i[0],a=i[1],c=i[2],m=i[3],p=i[4],b=i[5],y=i[6],w=i[7],M=e[0],T=e[1],E=e[2],P=e[3],R=e[4],F=e[5],B=e[6],W=e[7];return Math.abs(n-M)<=Qi.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(a-T)<=Qi.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(c-E)<=Qi.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(m-P)<=Qi.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(p-R)<=Qi.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(b-F)<=Qi.EPSILON*Math.max(1,Math.abs(b),Math.abs(F))&&Math.abs(y-B)<=Qi.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(w-W)<=Qi.EPSILON*Math.max(1,Math.abs(w),Math.abs(W))},At.sqrLen=At.squaredLength=At.len=At.length=At.dot=At.mul=At.setReal=At.getReal=void 0;var Qi=dr(ut),Oi=dr(Qt),Qn=dr(Gt);function Mn(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Mn=function(a){return a?n:e})(i)}function dr(i,e){if(i&&i.__esModule)return i;if(i===null||Sn(i)!=="object"&&typeof i!="function")return{default:i};var n=Mn(e);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}function Hr(i,e,n){var a=.5*n[0],c=.5*n[1],m=.5*n[2],p=e[0],b=e[1],y=e[2],w=e[3];return i[0]=p,i[1]=b,i[2]=y,i[3]=w,i[4]=a*w+c*y-m*b,i[5]=c*w+m*p-a*y,i[6]=m*w+a*b-c*p,i[7]=-a*p-c*b-m*y,i}function Wr(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i}function dl(i,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[4],y=n[5],w=n[6],M=n[7],T=e[4],E=e[5],P=e[6],R=e[7],F=n[0],B=n[1],W=n[2],J=n[3];return i[0]=a*J+p*F+c*W-m*B,i[1]=c*J+p*B+m*F-a*W,i[2]=m*J+p*W+a*B-c*F,i[3]=p*J-a*F-c*B-m*W,i[4]=a*M+p*b+c*w-m*y+T*J+R*F+E*W-P*B,i[5]=c*M+p*y+m*b-a*w+E*J+R*B+P*F-T*W,i[6]=m*M+p*w+a*y-c*b+P*J+R*W+T*B-E*F,i[7]=p*M-a*b-c*y-m*w+R*J-T*F-E*B-P*W,i}At.getReal=Oi.copy,At.setReal=Oi.copy,At.mul=dl;var lp=Oi.dot;At.dot=lp;var Gg=Oi.length;At.length=Gg,At.len=Gg;var Nd=Oi.squaredLength;At.squaredLength=Nd,At.sqrLen=Nd;var di={};function cp(i){return cp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cp(i)}Object.defineProperty(di,"__esModule",{value:!0}),di.create=hp,di.clone=function(i){var e=new As.ARRAY_TYPE(2);return e[0]=i[0],e[1]=i[1],e},di.fromValues=function(i,e){var n=new As.ARRAY_TYPE(2);return n[0]=i,n[1]=e,n},di.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i},di.set=function(i,e,n){return i[0]=e,i[1]=n,i},di.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i},di.subtract=up,di.multiply=mp,di.divide=pp,di.ceil=function(i,e){return i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i},di.floor=function(i,e){return i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i},di.min=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i},di.max=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i},di.round=function(i,e){return i[0]=Math.round(e[0]),i[1]=Math.round(e[1]),i},di.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},di.scaleAndAdd=function(i,e,n,a){return i[0]=e[0]+n[0]*a,i[1]=e[1]+n[1]*a,i},di.distance=fp,di.squaredDistance=gp,di.length=_p,di.squaredLength=bp,di.negate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i},di.inverse=function(i,e){return i[0]=1/e[0],i[1]=1/e[1],i},di.normalize=function(i,e){var n=e[0],a=e[1],c=n*n+a*a;return c>0&&(c=1/Math.sqrt(c)),i[0]=e[0]*c,i[1]=e[1]*c,i},di.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]},di.cross=function(i,e,n){var a=e[0]*n[1]-e[1]*n[0];return i[0]=i[1]=0,i[2]=a,i},di.lerp=function(i,e,n,a){var c=e[0],m=e[1];return i[0]=c+a*(n[0]-c),i[1]=m+a*(n[1]-m),i},di.random=function(i,e){e=e||1;var n=2*As.RANDOM()*Math.PI;return i[0]=Math.cos(n)*e,i[1]=Math.sin(n)*e,i},di.transformMat2=function(i,e,n){var a=e[0],c=e[1];return i[0]=n[0]*a+n[2]*c,i[1]=n[1]*a+n[3]*c,i},di.transformMat2d=function(i,e,n){var a=e[0],c=e[1];return i[0]=n[0]*a+n[2]*c+n[4],i[1]=n[1]*a+n[3]*c+n[5],i},di.transformMat3=function(i,e,n){var a=e[0],c=e[1];return i[0]=n[0]*a+n[3]*c+n[6],i[1]=n[1]*a+n[4]*c+n[7],i},di.transformMat4=function(i,e,n){var a=e[0],c=e[1];return i[0]=n[0]*a+n[4]*c+n[12],i[1]=n[1]*a+n[5]*c+n[13],i},di.rotate=function(i,e,n,a){var c=e[0]-n[0],m=e[1]-n[1],p=Math.sin(a),b=Math.cos(a);return i[0]=c*b-m*p+n[0],i[1]=c*p+m*b+n[1],i},di.angle=function(i,e){var n=i[0],a=i[1],c=e[0],m=e[1],p=Math.sqrt(n*n+a*a)*Math.sqrt(c*c+m*m);return Math.acos(Math.min(Math.max(p&&(n*c+a*m)/p,-1),1))},di.zero=function(i){return i[0]=0,i[1]=0,i},di.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},di.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]},di.equals=function(i,e){var n=i[0],a=i[1],c=e[0],m=e[1];return Math.abs(n-c)<=As.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-m)<=As.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))},di.forEach=di.sqrLen=di.sqrDist=di.dist=di.div=di.mul=di.sub=di.len=void 0;var As=function(i,e){if(i&&i.__esModule)return i;if(i===null||cp(i)!=="object"&&typeof i!="function")return{default:i};var n=dp(void 0);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}(ut);function dp(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(dp=function(a){return a?n:e})(i)}function hp(){var i=new As.ARRAY_TYPE(2);return As.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function up(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i}function mp(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i}function pp(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i}function fp(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1])}function gp(i,e){var n=e[0]-i[0],a=e[1]-i[1];return n*n+a*a}function _p(i){return Math.hypot(i[0],i[1])}function bp(i){var e=i[0],n=i[1];return e*e+n*n}di.len=_p,di.sub=up,di.mul=mp,di.div=pp,di.dist=fp,di.sqrDist=gp,di.sqrLen=bp;var qg=function(){var i=hp();return function(e,n,a,c,m,p){var b,y;for(n||(n=2),a||(a=0),y=c?Math.min(c*n+a,e.length):e.length,b=a;b<y;b+=n)i[0]=e[b],i[1]=e[b+1],m(i,i,p),e[b]=i[0],e[b+1]=i[1];return e}}();function pc(i){return pc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pc(i)}di.forEach=qg,Object.defineProperty(qe,"__esModule",{value:!0}),t.aA=qe.vec4=t._=qe.vec3=qe.vec2=qe.quat2=t.av=qe.quat=t.ad=qe.mat4=t.bC=qe.mat3=qe.mat2d=t.aC=qe.mat2=qe.glMatrix=void 0;var du=Ea(ut);qe.glMatrix=du;var hu=Ea(Ct);t.aC=qe.mat2=hu;var $g=Ea(wi);qe.mat2d=$g;var Yg=Ea(Ti);t.bC=qe.mat3=Yg;var Zg=Ea(Gt);t.ad=qe.mat4=Zg;var fc=Ea(Qt);t.av=qe.quat=fc;var Si=Ea(At);qe.quat2=Si;var Iy=Ea(di);qe.vec2=Iy;var Ty=Ea(Jt);t._=qe.vec3=Ty;var Ey=Ea(ei);function yp(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(yp=function(a){return a?n:e})(i)}function Ea(i,e){if(i&&i.__esModule)return i;if(i===null||pc(i)!=="object"&&typeof i!="function")return{default:i};var n=yp(e);if(n&&n.has(i))return n.get(i);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in i)if(m!=="default"&&Object.prototype.hasOwnProperty.call(i,m)){var p=c?Object.getOwnPropertyDescriptor(i,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=i[m]}return a.default=i,n&&n.set(i,a),a}t.aA=qe.vec4=Ey;var vp=Vd;function Vd(i,e,n,a){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=a}Vd.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,a=0;a<8;a++){var c=this.sampleCurveX(n)-i;if(Math.abs(c)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var p=0,b=1;for(n=i,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-i)<e));a++)i>c?p=n:b=n,n=.5*(b-p)+p;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var jd=Xe(vp),uu=hl;function hl(i,e){this.x=i,this.y=e}hl.prototype={clone:function(){return new hl(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(i,e){var n=Math.cos(i),a=Math.sin(i),c=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},hl.convert=function(i){return i instanceof hl?i:Array.isArray(i)?new hl(i[0],i[1]):i};var xt=Xe(uu);let Xg=Math.PI/180,Ud=180/Math.PI;function Di(i){return i*Xg}function Gr(i){return i*Ud}let Qg=[[0,0],[1,0],[1,1],[0,1]];function xp(i){if(i<=0)return 0;if(i>=1)return 1;let e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Hd(i,e,n,a){let c=new jd(i,e,n,a);return function(m){return c.solve(m)}}let gc=Hd(.25,.1,.25,1);function fi(i,e,n){return Math.min(n,Math.max(e,i))}function ul(i,e,n){return(n=fi((n-i)/(e-i),0,1))*n*(3-2*n)}function ml(i,e,n){let a=n-e,c=((i-e)%a+a)%a+e;return c===e?n:c}function _c(i,e,n){if(!i.length)return n(null,[]);let a=i.length,c=new Array(i.length),m=null;i.forEach((p,b)=>{e(p,(y,w)=>{y&&(m=y),c[b]=w,--a==0&&n(m,c)})})}function jo(i){let e=[];for(let n in i)e.push(i[n]);return e}function qr(i,...e){for(let n of e)for(let a in n)i[a]=n[a];return i}let Dy=1;function mu(){return Dy++}function pu(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function wp(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Cp(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function fu(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Wd(i,e){return i.indexOf(e,i.length-e.length)!==-1}function bc(i,e,n){let a={};for(let c in i)a[c]=e.call(this,i[c],c,i);return a}function pl(i,e,n){let a={};for(let c in i)e.call(this,i[c],c,i)&&(a[c]=i[c]);return a}function Da(i){return Array.isArray(i)?i.map(Da):typeof i=="object"&&i?bc(i,Da):i}let Sp={};function Kn(i){Sp[i]||(typeof console<"u"&&console.warn(i),Sp[i]=!0)}function Aa(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Qr(i){let e=0;for(let n,a,c=0,m=i.length,p=m-1;c<m;p=c++)n=i[c],a=i[p],e+=(a.x-n.x)*(n.y+a.y);return e}function Qa([i,e,n]){let a=Di(e+90),c=Di(n);return{x:i*Math.cos(a)*Math.sin(c),y:i*Math.sin(a)*Math.sin(c),z:i*Math.cos(c),azimuthal:e,polar:n}}function Or(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Mp(i){let e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,c,m)=>{let p=c||m;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let kp,gu,yc,Gd,Ka,qd,_u=null;function fl(i){try{let e=self[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function $d(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}function Ip(i,e,n,a){for(;e<n;){let c=e+n>>1;i[c]<a?e=c+1:n=c}return e}function Kg(i,e,n,a){for(;e<n;){let c=e+n>>1;i[c]<=a?e=c+1:n=c}return e}function bu(i){return i>0?1/(1.001-i):1+i}function yu(i){return i>0?1-1/(1.001-i):-i}function vc(){return kp==null&&(kp=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),kp}let Rr={now:()=>Gd!==void 0?Gd:performance.now(),setNow(i){Gd=i},restoreNow(){Gd=void 0},frame(i){let e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){let{width:n,height:a}=i;Ka||(Ka=document.createElement("canvas"));let c=Ka.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>Ka.width||a>Ka.height)&&(Ka.width=n,Ka.height=a),c.clearRect(-e,-e,n+2*e,a+2*e),c.drawImage(i,0,0,n,a),c.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:i=>(gu||(gu=document.createElement("a")),gu.href=i,gu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(yc==null&&(yc=window.matchMedia("(prefers-reduced-motion: reduce)")),yc.matches)},hasCanvasFingerprintNoise(){if(qd!==void 0)return qd;if(!vc())return qd=!1,!1;let i=new OffscreenCanvas(85,1),e=i.getContext("2d",{willReadFrequently:!0}),n=0;for(let c=0;c<i.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);let a=e.getImageData(0,0,i.width,i.height);n=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&n++!==a.data[c])return qd=!0,!0;return qd=!1,!1}};function vu(i,e){let n=i.indexOf("?");if(n<0)return`${i}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(i.slice(n));for(let c in e)a.set(c,e[c]);return`${i.slice(0,n)}?${a.toString()}`}function Tp(i,e={persistentParams:[]}){let n=i.indexOf("?");if(n<0)return i;let a=new URLSearchParams,c=new URLSearchParams(i.slice(n));for(let p of e.persistentParams){let b=c.get(p);b&&a.set(p,b)}let m=a.toString();return`${i.slice(0,n)}${m.length>0?`?${m}`:""}`}let Jg="mapbox-tiles",Ep=500,Dp=50,Ja,xu;function e_(){try{return caches}catch{}}function Yd(){let i=e_();i&&!Ja&&(Ja=i.open(Jg))}let wu=1/0,Cu={supported:!1,testSupport:function(i){!Ap&&wc&&(Pp?t_(i):xc=i)}},xc,wc,Ap=!1,Pp=!1,Op=typeof self<"u"?self:{};function t_(i){let e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,wc),i.isContextLost())return;Cu.supported=!0}catch{}i.deleteTexture(e),Ap=!0}Op.document&&(wc=Op.document.createElement("img"),wc.onload=function(){xc&&t_(xc),xc=null,Pp=!0},wc.onerror=function(){Ap=!0,xc=null},wc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Su={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Su);class Rp extends Error{constructor(e,n,a){n===401&&O(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Mu=Or()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Zd=function(i,e){if(!(/^file:/.test(n=i.url)||/^file:/.test(Mu())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){let m=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Mu(),referrerPolicy:a.referrerPolicy,signal:m.signal}),b=!1,y=!1,w=(M=p.url).indexOf("sku=")>0&&O(M);var M;a.type==="json"&&p.headers.set("Accept","application/json");let T=(P,R,F)=>{if(y)return;if(P&&P.message!=="SecurityError"&&Kn(P.toString()),R&&F)return E(R);let B=Date.now();fetch(p).then(W=>{if(W.ok){let J=w?W.clone():null;return E(W,J,B)}return c(new Rp(W.statusText,W.status,a.url))}).catch(W=>{W.name!=="AbortError"&&c(new Error(`${W.message} ${a.url}`))})},E=(P,R,F)=>{(a.type==="arrayBuffer"?P.arrayBuffer():a.type==="json"?P.json():P.text()).then(B=>{y||(R&&F&&function(W,J,ee){if(Yd(),!Ja)return;let te=Mp(J.headers.get("Cache-Control")||"");if(te["no-store"])return;let pe={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach((Ce,De)=>pe.headers.set(De,Ce)),te["max-age"]&&pe.headers.set("Expires",new Date(ee+1e3*te["max-age"]).toUTCString());let he=pe.headers.get("Expires");if(!he||new Date(he).getTime()-ee<42e4)return;let ve=Tp(W.url,{persistentParams:["language","worldview"]});if(J.status===206){let Ce=W.headers.get("Range");if(!Ce)return;pe.status=200,ve=vu(ve,{range:Ce})}(function(Ce,De){if(xu===void 0)try{new Response(new ReadableStream),xu=!0}catch{xu=!1}xu?De(Ce.body):Ce.blob().then(De)})(J,Ce=>{let De=new Response((Ue=J.status)!==200&&Ue!==404&&[101,103,204,205,304].includes(Ue)?null:Ce,pe);var Ue;Yd(),Ja&&Ja.then(ze=>ze.put(ve,De)).catch(ze=>Kn(ze.message))})}(p,R,F),b=!0,c(null,B,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(B=>{y||c(new Error(B.message))})};return w?function(P,R){if(Yd(),!Ja)return R(null);Ja.then(F=>{let B=Tp(P.url,{persistentParams:["language","worldview"]}),W=P.headers.get("Range");W&&(B=vu(B,{range:W})),F.match(B).then(J=>{let ee=function(te){if(!te)return!1;let pe=new Date(te.headers.get("Expires")||0),he=Mp(te.headers.get("Cache-Control")||"");return pe>Date.now()&&!he["no-cache"]}(J);F.delete(B),ee&&F.put(B,J.clone()),R(null,J,ee)}).catch(R)}).catch(R)}(p,T):T(null,null),{cancel:()=>{y=!0,b||m.abort()}}}(i,e);if(Or()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(a,c){let m=new XMLHttpRequest;m.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let p in a.headers)m.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=a.credentials==="include",m.onerror=()=>{c(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let p=m.response;if(a.type==="json")try{p=JSON.parse(m.response)}catch(b){return c(b)}c(null,p,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else c(new Rp(m.statusText,m.status,a.url))},m.send(a.body),{cancel:()=>m.abort()}}(i,e)},gl=function(i,e){return Zd(qr(i,{type:"arrayBuffer"}),e)};function i_(i){let e=document.createElement("a");return e.href=i,e.protocol===location.protocol&&e.host===location.host}let Lp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Xd,Qd;Xd=[],Qd=0;let Ps=function(i,e){if(Cu.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Qd>=I.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Xd.push(m),m}Qd++;let n=!1,a=()=>{if(!n)for(n=!0,Qd--;Xd.length&&Qd<I.MAX_PARALLEL_IMAGE_REQUESTS;){let m=Xd.shift(),{requestParameters:p,callback:b,cancelled:y}=m;y||(m.cancel=Ps(p,b).cancel)}},c=gl(i,(m,p,b,y)=>{a(),m?e(m):p&&(self.createImageBitmap?function(w,M){let T=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(T).then(E=>{M(null,E)}).catch(E=>{M(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,M)=>e(w,M,b,y)):function(w,M){let T=new Image;T.onload=()=>{M(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=Lp})},T.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let E=new Blob([new Uint8Array(w)],{type:"image/png"});T.src=w.byteLength?URL.createObjectURL(E):Lp}(p,(w,M)=>e(w,M,b,y)))});return{cancel:()=>{c.cancel(),a()}}},Fp="01",zp="NO_ACCESS_TOKEN",Ay=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ca(i){let e=i.match(Ay);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Cc(i){let e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}let ku="mapbox.eventData";function n_(i){if(!i)return null;let e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Kd{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=n_(I.ACCESS_TOKEN),a="";return a=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,m)=>String.fromCharCode(+("0x"+m)))):I.ACCESS_TOKEN||"",e?`${ku}.${e}:${a}`:`${ku}:${a}`}fetchEventData(){let e=fl("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let c=localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));let m=localStorage.getItem(a);m&&(this.anonId=m)}catch{Kn("Unable to read from LocalStorage")}}saveEventData(){let e=fl("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(a,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Kn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,c){if(!I.EVENTS_URL)return;let m=ca(I.EVENTS_URL);m.params.push(`access_token=${c||I.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},b=n?qr(p,n):p,y={url:Cc(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(w,M){return Zd(qr(w,{method:"POST"}),M)}(y,w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let r_=new class extends Kd{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){I.EVENTS_URL&&I.ACCESS_TOKEN&&Array.isArray(i)&&i.some(n=>N(n)||O(n))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=n_(I.ACCESS_TOKEN),n=e?e.u:I.ACCESS_TOKEN,a=n!==this.eventData.tokenU;Cp(this.anonId)||(this.anonId=pu(),a=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let m=new Date(this.eventData.lastSuccess),p=new Date(c),b=(c-this.eventData.lastSuccess)/864e5;a=a||b>=1||b<-1||m.getDate()!==p.getDate()}else a=!0;a?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:Fp,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},i):this.processRequests()}},Bp=r_.postTurnstileEvent.bind(r_),Jd=new class extends Kd{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,n,a){this.skuToken=e,this.errorCb=a,I.EVENTS_URL&&(n||I.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(zp)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Cp(this.anonId)||(this.anonId=pu()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:Fp,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},i))}remove(){this.errorCb=null}},o_=Jd.postMapLoadEvent.bind(Jd),a_=new class extends Kd{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let e=this.mapInstanceIdMap.get(i);return e||(e=pu(),this.mapInstanceIdMap.set(i,e)),e}getEventId(i){let e=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,e+1),e}postStyleLoadEvent(i,e){let{map:n,style:a,importedStyles:c}=e;if(!I.EVENTS_URL||!i&&!I.ACCESS_TOKEN)return;let m=this.getMapInstanceId(n),p={mapInstanceId:m,eventId:this.getEventId(m),style:a};c.length&&(p.importedStyles=c),this.queueRequest({timestamp:Date.now(),payload:p},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},i)}},Py=a_.postStyleLoadEvent.bind(a_),Iu=new class extends Kd{constructor(){super("gljs.performance")}postPerformanceEvent(i,e){I.EVENTS_URL&&(i||I.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),a=function(c){let m=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),b=function(P){let R={};if(P){for(let F in P)if(F!=="other")for(let B of P[F]){let W=`${F}ResolveRangeMin`,J=`${F}ResolveRangeMax`,ee=`${F}RequestCount`,te=`${F}RequestCachedCount`;R[W]=Math.min(R[W]||1/0,B.startTime),R[J]=Math.max(R[J]||-1/0,B.responseEnd);let pe=he=>{R[he]===void 0&&(R[he]=0),++R[he]};B.transferSize!==void 0&&B.transferSize===0&&pe(te),pe(ee)}}return R}(function(P,R){let F={};if(P)for(let B of P){let W=R(B);F[W]===void 0&&(F[W]=[]),F[W].push(B)}return F}(m,Ae)),y=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=w?w.effectiveType:void 0,T={counters:[],metadata:[],attributes:[]},E=(P,R,F)=>{F!=null&&P.push({name:R,value:F.toString()})};for(let P in b)E(T.counters,P,b[P]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(E(T.counters,"interactionRangeMin",c.interactionRange[0]),E(T.counters,"interactionRangeMax",c.interactionRange[1])),p)for(let P of Object.keys(xe)){let R=xe[P],F=p.find(B=>B.name===R);F&&E(T.counters,R,F.startTime)}return E(T.counters,"visibilityHidden",c.visibilityHidden),E(T.attributes,"style",function(P){if(P)for(let R of P){let F=R.name.split("?")[0];if(de(F)){let B=F.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(m)),E(T.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),E(T.attributes,"fogEnabled",c.fogEnabled?"true":"false"),E(T.attributes,"projection",c.projection),E(T.attributes,"zoom",c.zoom),E(T.metadata,"devicePixelRatio",y),E(T.metadata,"connectionEffectiveType",M),E(T.metadata,"navigatorUserAgent",navigator.userAgent),E(T.metadata,"screenWidth",window.screen.width),E(T.metadata,"screenHeight",window.screen.height),E(T.metadata,"windowWidth",window.innerWidth),E(T.metadata,"windowHeight",window.innerHeight),E(T.metadata,"mapWidth",c.width/y),E(T.metadata,"mapHeight",c.height/y),E(T.metadata,"webglRenderer",c.renderer),E(T.metadata,"webglVendor",c.vendor),E(T.metadata,"sdkVersion",_),E(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(n);for(let c of a.metadata);for(let c of a.counters);for(let c of a.attributes);this.postEvent(e,a,()=>{},i)}},Oy=Iu.postPerformanceEvent.bind(Iu),Sc=new class extends Kd{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,n,a){if(!I.API_URL||!I.SESSION_PATH)return;let c=ca(I.API_URL+I.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${a||I.ACCESS_TOKEN||""}`);let m={url:Cc(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,b){return Zd(qr(p,{method:"GET"}),b)}(m,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(i,e,n,a){this.skuToken=e,this.errorCb=a,I.SESSION_PATH&&I.API_URL&&(n||I.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(zp)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},i)}remove(){this.errorCb=null}},Tu=Sc.getSessionAPI.bind(Sc),eh=new Set;var _l={exports:{}},s_={exports:function(i,e){var n,a,c,m,p,b,y,w;for(a=i.length-(n=3&i.length),c=e,p=3432918353,b=461845907,w=0;w<a;)y=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24,++w,c=27492+(65535&(m=5*(65535&(c=(c^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*b+(((y>>>16)*b&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&i.charCodeAt(w+2))<<16;case 2:y^=(255&i.charCodeAt(w+1))<<8;case 1:c^=y=(65535&(y=(y=(65535&(y^=255&i.charCodeAt(w)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*b+(((y>>>16)*b&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}},Ry={exports:function(i,e){for(var n,a=i.length,c=e^a,m=0;a>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:c^=(255&i.charCodeAt(m+2))<<16;case 2:c^=(255&i.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}},l_=s_.exports,Np=Ry.exports;_l.exports=l_,_l.exports.murmur3=l_,_l.exports.murmur2=Np;var Mc=Xe(_l.exports);function Vp(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function kc(i,e,n){if(n&&n[i]){let a=n[i].indexOf(e);a!==-1&&n[i].splice(a,1)}}class ao{constructor(e,n={}){qr(this,n),this.type=e}}class Eu extends ao{constructor(e,n={}){super("error",qr({error:e},n))}}class bl{on(e,n){return this._listeners=this._listeners||{},Vp(e,n,this._listeners),this}off(e,n){return kc(e,n,this._listeners),kc(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Vp(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new ao(e,n||{}));let a=e.type;if(this.listens(a)){e.target=this;let c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let b of c)b.call(this,e);let m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let b of m)kc(a,b,this._oneTimeListeners),b.call(this,e);let p=this._eventedParent;p&&(qr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Eu&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}t.F=void 0;var c_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Du(i){return(i=Math.round(i))<0?0:i>255?255:i}function jp(i){return Du(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function th(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function ih(i,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?i+(e-i)*n*6:2*n<1?e:3*n<2?i+(e-i)*(2/3-n)*6:i}try{t.F={}.parseCSSColor=function(i){var e,n=i.replace(/ /g,"").toLowerCase();if(n in c_)return c_[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),c=n.indexOf(")");if(a!==-1&&c+1===n.length){var m=n.substr(0,a),p=n.substr(a+1,c-(a+1)).split(","),b=1;switch(m){case"rgba":if(p.length!==4)return null;b=th(p.pop());case"rgb":return p.length!==3?null:[jp(p[0]),jp(p[1]),jp(p[2]),b];case"hsla":if(p.length!==4)return null;b=th(p.pop());case"hsl":if(p.length!==3)return null;var y=(parseFloat(p[0])%360+360)%360/360,w=th(p[1]),M=th(p[2]),T=M<=.5?M*(w+1):M+w-M*w,E=2*M-T;return[Du(255*ih(E,T,y+1/3)),Du(255*ih(E,T,y)),Du(255*ih(E,T,y-1/3)),b];default:return null}}return null}}catch{}class Bi{constructor(e,n,a,c=1){this.r=e,this.g=n,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof Bi)return e;if(typeof e!="string")return;let n=t.F(e);return n?new Bi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,a,c]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${c})`}toRenderColor(e){let{r:n,g:a,b:c,a:m}=this;return new Ly(e,n,a,c,m)}}class Ly{constructor(e,n,a,c,m){if(e){let p=e.image.height,b=p*p;n=m===0?0:n/m*(p-1),a=m===0?0:a/m*(p-1),c=m===0?0:c/m*(p-1);let y=Math.floor(n),w=Math.floor(a),M=Math.floor(c),T=Math.ceil(n),E=Math.ceil(a),P=Math.ceil(c),R=n-y,F=a-w,B=c-M,W=e.image.data,J=4*(y+w*b+M*p),ee=4*(y+w*b+P*p),te=4*(y+E*b+M*p),pe=4*(y+E*b+P*p),he=4*(T+w*b+M*p),ve=4*(T+w*b+P*p),Ce=4*(T+E*b+M*p),De=4*(T+E*b+P*p);if(J<0||De>=W.length)throw new Error("out of range");this.r=Wt(Wt(Wt(W[J],W[ee],B),Wt(W[te],W[pe],B),F),Wt(Wt(W[he],W[ve],B),Wt(W[Ce],W[De],B),F),R)/255*m,this.g=Wt(Wt(Wt(W[J+1],W[ee+1],B),Wt(W[te+1],W[pe+1],B),F),Wt(Wt(W[he+1],W[ve+1],B),Wt(W[Ce+1],W[De+1],B),F),R)/255*m,this.b=Wt(Wt(Wt(W[J+2],W[ee+2],B),Wt(W[te+2],W[pe+2],B),F),Wt(Wt(W[he+2],W[ve+2],B),Wt(W[Ce+2],W[De+2],B),F),R)/255*m,this.a=m}else this.r=n,this.g=a,this.b=c,this.a=m}toArray(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*a/c,c]}toArray01(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,a/c,c]}toArray01Scaled(e){let{r:n,g:a,b:c,a:m}=this;return m===0?[0,0,0]:[n/m*e,a/m*e,c/m*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:a,a:c}=this;return[e,n,a,c]}toArray01Linear(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(n/c,2.2),Math.pow(a/c,2.2),c]}}function Wt(i,e,n){return i*(1-n)+e*n}function d_(i,e,n){return i.map((a,c)=>Wt(a,e[c],n))}Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1),Bi.blue=new Bi(0,0,1,1);var Au=Object.freeze({__proto__:null,array:d_,color:function(i,e,n){return new Bi(Wt(i.r,e.r,n),Wt(i.g,e.g,n),Wt(i.b,e.b,n),Wt(i.a,e.a,n))},number:Wt});function Up(i,...e){for(let n of e)for(let a in n)i[a]=n[a];return i}class Pa extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Hp{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[a,c]of n)this.bindings[a]=c}concat(e){return new Hp(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Ic={kind:"null"},Tt={kind:"number"},Ni={kind:"string"},Vi={kind:"boolean"},so={kind:"color"},Tc={kind:"object"},Li={kind:"value"},da={kind:"collator"},Ec={kind:"formatted"},Oa={kind:"resolvedImage"};function _o(i,e){return{kind:"array",itemType:i,N:e}}function Jn(i){if(i.kind==="array"){let e=Jn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}let Fy=[Ic,Tt,Ni,Vi,so,Ec,Tc,_o(Li),Oa];function nh(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!nh(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(let n of Fy)if(!nh(n,e))return null}}return`Expected ${Jn(i)} but found ${Jn(e)} instead.`}function Wp(i,e){return e.some(n=>n.kind===i.kind)}function Dc(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}class rh{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yl{constructor(e,n,a,c,m){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=c,this.textColor=m}}class $r{constructor(e){this.sections=e}static fromString(e){return new $r([new yl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof $r?e:$r.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class lo{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new lo({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function h_(i,e,n,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,n,a]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function co(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Bi||i instanceof rh||i instanceof $r||i instanceof lo)return!0;if(Array.isArray(i)){for(let e of i)if(!co(e))return!1;return!0}if(typeof i=="object"){for(let e in i)if(!co(i[e]))return!1;return!0}return!1}function hr(i){if(i===null)return Ic;if(typeof i=="string")return Ni;if(typeof i=="boolean")return Vi;if(typeof i=="number")return Tt;if(i instanceof Bi)return so;if(i instanceof rh)return da;if(i instanceof $r)return Ec;if(i instanceof lo)return Oa;if(Array.isArray(i)){let e=i.length,n;for(let a of i){let c=hr(a);if(n){if(n===c)continue;n=Li;break}n=c}return _o(n||Li,e)}return Tc}function Uo(i){let e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Bi||i instanceof $r||i instanceof lo?i.toString():JSON.stringify(i)}class es{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!co(e[1]))return n.error("invalid value");let a=e[1],c=hr(a),m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new es(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof $r?this.value.serialize():this.value}}class xr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Gp={string:Ni,number:Tt,boolean:Vi,object:Tc};class ha{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,c=1,m=e[0];if(m==="array"){let b,y;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in Gp)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=Gp[w],c++}else b=Li;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],c++}a=_o(b,y)}else a=Gp[m];let p=[];for(;c<e.length;c++){let b=n.parse(e[c],c,Li);if(!b)return null;p.push(b)}return new ha(a,p)}evaluate(e){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(e);if(!nh(this.type,hr(a)))return a;if(n===this.args.length-1)throw new xr(`Expected value to be of type ${Jn(this.type)}, but found ${Jn(hr(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);let c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(a=>a.serialize()))}}class oh{constructor(e){this.type=Ec,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let c=[],m=!1;for(let p=1;p<=e.length-1;++p){let b=e[p];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let y=null;if(b["font-scale"]&&(y=n.parse(b["font-scale"],1,Tt),!y))return null;let w=null;if(b["text-font"]&&(w=n.parse(b["text-font"],1,_o(Ni)),!w))return null;let M=null;if(b["text-color"]&&(M=n.parse(b["text-color"],1,so),!M))return null;let T=c[c.length-1];T.scale=y,T.font=w,T.textColor=M}else{let y=n.parse(e[p],1,Li);if(!y)return null;let w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:y,scale:null,font:null,textColor:null})}}return new oh(c)}evaluate(e){return new $r(this.sections.map(n=>{let a=n.content.evaluate(e);return hr(a)===Oa?new yl("",a,null,null,null):new yl(Uo(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class ah{constructor(e,n){this.type=Oa,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=n.parse(e[1],1,Ni);if(!a)return n.error("No image name provided.");if(e.length===2)return new ah(a);let c=n.parse(e[2],1,Ni);return c?new ah(a,c):n.error("Secondary image variant is not a string.")}evaluate(e){let n=lo.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function vl(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}let zy={"to-boolean":Vi,"to-color":so,"to-number":Tt,"to-string":Ni};class ua{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[0],c=[],m=Ic;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);m=_o(n.expectedType.itemType,p)}else{if(!(p>0&&co(e[1][0])))return null;m=_o(hr(e[1][0]),p)}for(let b=0;b<p;b++){let y=e[1][b],w;if(vl(y)==="array")w=n.parse(y,void 0,m.itemType);else{let M=vl(y);if(M!==m.itemType.kind)return n.error(`Expected ${m.itemType.kind} but found ${M}.`);w=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!w)return null;c.push(w)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");m=zy[a];for(let p=1;p<e.length;p++){let b=n.parse(e[p],p,Li);if(!b)return null;c.push(b)}}return new ua(m,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(let c of this.args){if(n=c.evaluate(e),a=null,n instanceof Bi)return n;if(typeof n=="string"){let m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:h_(n[0],n[1],n[2],n[3]),!a))return new Bi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new xr(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let a of this.args){if(n=a.evaluate(e),n===null)return 0;let c=Number(n);if(!isNaN(c))return c}throw new xr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?$r.fromString(Uo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?lo.fromString(Uo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Uo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new oh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ah(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let u_=["Unknown","Point","LineString","Polygon"];class m_{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?u_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Bi.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Kr{constructor(e,n,a,c,m){this.name=e,this.type=n,this._evaluate=a,this.args=c,this._overloadIndex=m}evaluate(e){if(!this._evaluate){let n=Kr.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let a=e[0],c=Kr.definitions[a];if(!c)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,b=[],y=null,w=-1;for(let[M,T]of p){if(Array.isArray(M)&&M.length!==e.length-1)continue;b.push(M),w++,y=new S_(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let E=[],P=!1;for(let R=1;R<e.length;R++){let F=e[R],B=Array.isArray(M)?M[R-1]:M.type,W=y.parse(F,1+E.length,B);if(!W){P=!0;break}E.push(W)}if(!P)if(Array.isArray(M)&&M.length!==E.length)y.error(`Expected ${M.length} arguments, but found ${E.length} instead.`);else{for(let R=0;R<E.length;R++){let F=Array.isArray(M)?M[R]:M.type,B=E[R];y.concat(R+1).checkSubtype(F,B.type)}if(y.errors.length===0)return new Kr(a,m,T,E,w)}}if(b.length===1)n.errors.push(...y.errors);else{let M=(b.length?b:p.map(([E])=>E)).map(qp).join(" | "),T=[];for(let E=1;E<e.length;E++){let P=n.parse(e[E],1+T.length);if(!P)return null;T.push(Jn(P.type))}n.error(`Expected arguments of type ${M}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){Kr.definitions=n;for(let a in n)e[a]=Kr}}function qp(i){return Array.isArray(i)?`(${i.map(Jn).join(", ")})`:`(${Jn(i.type)}...)`}class Os{constructor(e,n,a){this.type=da,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let c=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Vi);if(!c)return null;let m=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Vi);if(!m)return null;let p=null;return a.locale&&(p=n.parse(a.locale,1,Ni),!p)?null:new Os(c,m,p)}evaluate(e){return new rh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var $p={exports:{}};$p.exports=function(){function i(a,c,m,p,b){for(;p>m;){if(p-m>600){var y=p-m+1,w=c-m+1,M=Math.log(y),T=.5*Math.exp(2*M/3),E=.5*Math.sqrt(M*T*(y-T)/y)*(w-y/2<0?-1:1);i(a,c,Math.max(m,Math.floor(c-w*T/y+E)),Math.min(p,Math.floor(c+(y-w)*T/y+E)),b)}var P=a[c],R=m,F=p;for(e(a,m,c),b(a[p],P)>0&&e(a,m,p);R<F;){for(e(a,R,F),R++,F--;b(a[R],P)<0;)R++;for(;b(a[F],P)>0;)F--}b(a[m],P)===0?e(a,m,F):e(a,++F,p),F<=c&&(m=F+1),c<=F&&(p=F-1)}}function e(a,c,m){var p=a[c];a[c]=a[m],a[m]=p}function n(a,c){return a<c?-1:a>c?1:0}return function(a,c,m,p,b){i(a,c,m||0,p||a.length-1,b||n)}}();var By=Xe($p.exports);function Ny(i){let e=0;for(let n,a,c=0,m=i.length,p=m-1;c<m;p=c++)n=i[c],a=i[p],e+=(a.x-n.x)*(n.y+a.y);return e}function sh(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ac(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Vy(i,e,n){let a=i[0]-e[0],c=i[1]-e[1],m=i[0]-n[0],p=i[1]-n[1];return a*p-m*c==0&&a*m<=0&&c*p<=0}function Pc(i,e,n=!1){let a=!1;for(let b=0,y=e.length;b<y;b++){let w=e[b];for(let M=0,T=w.length,E=T-1;M<T;E=M++){let P=w[E],R=w[M];if(Vy(i,P,R))return n;(m=P)[1]>(c=i)[1]!=(p=R)[1]>c[1]&&c[0]<(p[0]-m[0])*(c[1]-m[1])/(p[1]-m[1])+m[0]&&(a=!a)}}var c,m,p;return a}function Yp(i,e,n,a){let c=a[0]-n[0],m=a[1]-n[1],p=(i[0]-n[0])*m-c*(i[1]-n[1]),b=(e[0]-n[0])*m-c*(e[1]-n[1]);return p>0&&b<0||p<0&&b>0}function Ri(i,e,n,a){return(c=[a[0]-n[0],a[1]-n[1]])[0]*(m=[e[0]-i[0],e[1]-i[1]])[1]-c[1]*m[0]!=0&&!(!Yp(i,e,n,a)||!Yp(n,a,i,e));var c,m}let ts=8192;function p_(i,e){let n=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*ts),Math.round(a*c*ts)]}function jy(i,e){for(let n=0;n<e.length;n++)if(Pc(i,e[n]))return!0;return!1}function Uy(i,e,n){for(let a of n)for(let c=0,m=a.length,p=m-1;c<m;p=c++)if(Ri(i,e,a[p],a[c]))return!0;return!1}function lh(i,e){for(let n=0;n<i.length;++n)if(!Pc(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(Uy(i[n],i[n+1],e))return!1;return!0}function Pu(i,e){for(let n=0;n<e.length;n++)if(lh(i,e[n]))return!0;return!1}function Oc(i,e,n){let a=[];for(let c=0;c<i.length;c++){let m=[];for(let p=0;p<i[c].length;p++){let b=p_(i[c][p],n);sh(e,b),m.push(b)}a.push(m)}return a}function f_(i,e,n){let a=[];for(let c=0;c<i.length;c++){let m=Oc(i[c],e,n);a.push(m)}return a}function Zp(i,e,n,a){if(i[0]<n[0]||i[0]>n[2]){let c=.5*a,m=i[0]-n[0]>c?-a:n[0]-i[0]>c?a:0;m===0&&(m=i[0]-n[2]>c?-a:n[2]-i[0]>c?a:0),i[0]+=m}sh(e,i)}function ma(i,e,n,a){let c=Math.pow(2,a.z)*ts,m=[a.x*ts,a.y*ts],p=[];if(!i)return p;for(let b of i)for(let y of b){let w=[y.x+m[0],y.y+m[1]];Zp(w,e,n,c),p.push(w)}return p}function g_(i,e,n,a){let c=Math.pow(2,a.z)*ts,m=[a.x*ts,a.y*ts],p=[];if(!i)return p;for(let y of i){let w=[];for(let M of y){let T=[M.x+m[0],M.y+m[1]];sh(e,T),w.push(T)}p.push(w)}if(e[2]-e[0]<=c/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let y of p)for(let w of y)Zp(w,e,n,c)}var b;return p}class Rs{constructor(e,n){this.type=Vi,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(co(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){let m=a.features[c].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Rs(a,a.features[c].geometry)}else if(a.type==="Feature"){let c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Rs(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Rs(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let b=Oc(a.coordinates,m,p),y=ma(n.geometry(),c,m,p);if(!Ac(c,m))return!1;for(let w of y)if(!Pc(w,b))return!1}if(a.type==="MultiPolygon"){let b=f_(a.coordinates,m,p),y=ma(n.geometry(),c,m,p);if(!Ac(c,m))return!1;for(let w of y)if(!jy(w,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let b=Oc(a.coordinates,m,p),y=g_(n.geometry(),c,m,p);if(!Ac(c,m))return!1;for(let w of y)if(!lh(w,b))return!1}if(a.type==="MultiPolygon"){let b=f_(a.coordinates,m,p),y=g_(n.geometry(),c,m,p);if(!Ac(c,m))return!1;for(let w of y)if(!Pu(w,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Ls={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ou=1/298.257223563,__=Ou*(2-Ou),ch=Math.PI/180;class dh{static fromTile(e,n,a){let c=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),m=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/ch;return new dh(m,a)}static get units(){return Ls}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Ls[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Ls).join(", ")}`);let a=6378.137*ch*(n?Ls[n]:1),c=Math.cos(e*ch),m=1/(1-__*(1-c*c)),p=Math.sqrt(m);this.kx=a*p*c,this.ky=a*p*m*(1-__)}distance(e,n){let a=Ho(e[0]-n[0])*this.kx,c=(e[1]-n[1])*this.ky;return Math.sqrt(a*a+c*c)}bearing(e,n){let a=Ho(n[0]-e[0])*this.kx;return Math.atan2(a,(n[1]-e[1])*this.ky)/ch}destination(e,n,a){let c=a*ch;return this.offset(e,Math.sin(c)*n,Math.cos(c)*n)}offset(e,n,a){return[e[0]+n/this.kx,e[1]+a/this.ky]}lineDistance(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}area(e){let n=0;for(let a=0;a<e.length;a++){let c=e[a];for(let m=0,p=c.length,b=p-1;m<p;b=m++)n+=Ho(c[m][0]-c[b][0])*(c[m][1]+c[b][1])*(a?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let a=0;if(n<=0)return e[0];for(let c=0;c<e.length-1;c++){let m=e[c],p=e[c+1],b=this.distance(m,p);if(a+=b,a>n)return hh(m,p,(n-(a-b))/b)}return e[e.length-1]}pointToSegmentDistance(e,n,a){let[c,m]=n,p=Ho(a[0]-c)*this.kx,b=(a[1]-m)*this.ky;if(p!==0||b!==0){let y=(Ho(e[0]-c)*this.kx*p+(e[1]-m)*this.ky*b)/(p*p+b*b);y>1?(c=a[0],m=a[1]):y>0&&(c+=p/this.kx*y,m+=b/this.ky*y)}return p=Ho(e[0]-c)*this.kx,b=(e[1]-m)*this.ky,Math.sqrt(p*p+b*b)}pointOnLine(e,n){let a=1/0,c=e[0][0],m=e[0][1],p=0,b=0;for(let y=0;y<e.length-1;y++){let w=e[y][0],M=e[y][1],T=Ho(e[y+1][0]-w)*this.kx,E=(e[y+1][1]-M)*this.ky,P=0;T===0&&E===0||(P=(Ho(n[0]-w)*this.kx*T+(n[1]-M)*this.ky*E)/(T*T+E*E),P>1?(w=e[y+1][0],M=e[y+1][1]):P>0&&(w+=T/this.kx*P,M+=E/this.ky*P)),T=Ho(n[0]-w)*this.kx,E=(n[1]-M)*this.ky;let R=T*T+E*E;R<a&&(a=R,c=w,m=M,p=y,b=P)}return{point:[c,m],index:p,t:Math.max(0,Math.min(1,b))}}lineSlice(e,n,a){let c=this.pointOnLine(a,e),m=this.pointOnLine(a,n);if(c.index>m.index||c.index===m.index&&c.t>m.t){let w=c;c=m,m=w}let p=[c.point],b=c.index+1,y=m.index;!Xp(a[b],p[0])&&b<=y&&p.push(a[b]);for(let w=b+1;w<=y;w++)p.push(a[w]);return Xp(a[y],m.point)||p.push(m.point),p}lineSliceAlong(e,n,a){let c=0,m=[];for(let p=0;p<a.length-1;p++){let b=a[p],y=a[p+1],w=this.distance(b,y);if(c+=w,c>e&&m.length===0&&m.push(hh(b,y,(e-(c-w))/w)),c>=n)return m.push(hh(b,y,(n-(c-w))/w)),m;c>e&&m.push(y)}return m}bufferPoint(e,n){let a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[0]+c,e[1]+a]}bufferBBox(e,n){let a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[2]+c,e[3]+a]}insideBBox(e,n){return Ho(e[0]-n[0])>=0&&Ho(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Xp(i,e){return i[0]===e[0]&&i[1]===e[1]}function hh(i,e,n){let a=Ho(e[0]-i[0]);return[i[0]+a*n,i[1]+(e[1]-i[1])*n]}function Ho(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}var uh={exports:{}};(function(i,e){i.exports=function(){var n=function(c,m){if(c===void 0&&(c=[]),m===void 0&&(m=a),this.data=c,this.length=this.data.length,this.compare=m,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function a(c,m){return c<m?-1:c>m?1:0}return n.prototype.push=function(c){this.data.push(c),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var c=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),c}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(c){for(var m=this.data,p=this.compare,b=m[c];c>0;){var y=c-1>>1,w=m[y];if(p(b,w)>=0)break;m[c]=w,c=y}m[c]=b},n.prototype._down=function(c){for(var m=this.data,p=this.compare,b=this.length>>1,y=m[c];c<b;){var w=1+(c<<1),M=m[w],T=w+1;if(T<this.length&&p(m[T],M)<0&&(w=T,M=m[T]),p(M,y)>=0)break;m[c]=M,c=w}m[c]=y},n}()})(uh);var Qp=Xe(uh.exports),gt=8192;function b_(i,e){return e.dist-i.dist}let Kp=100,Jp=50;function y_(i){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==i[n])return!1;return!0}function Ru(i){return i[1]-i[0]+1}function Ra(i,e){let n=i[1]>=i[0]&&i[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Fs(i,e){if(i[0]>i[1])return[null,null];let n=Ru(i);if(e){if(n===2)return[i,null];let a=Math.floor(n/2);return[[i[0],i[0]+a],[i[0]+a,i[1]]]}{if(n===1)return[i,null];let a=Math.floor(n/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}}function xl(i,e){let n=[1/0,1/0,-1/0,-1/0];if(!Ra(e,i.length))return n;for(let a=e[0];a<=e[1];++a)sh(n,i[a]);return n}function Lu(i){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<i.length;++n)for(let a=0;a<i[n].length;++a)sh(e,i[n][a]);return e}function zs(i,e,n){if(y_(i)||y_(e))return NaN;let a=0,c=0;return i[2]<e[0]&&(a=e[0]-i[2]),i[0]>e[2]&&(a=i[0]-e[2]),i[1]>e[3]&&(c=i[1]-e[3]),i[3]<e[1]&&(c=e[1]-i[3]),n.distance([0,0],[a,c])}function Hy(i){return 360*i-180}function Wy(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function ef(i,e){let n=Math.pow(2,e.z),a=(i.y/gt+e.y)/n;return[Hy((i.x/gt+e.x)/n),Wy(a)]}function Gy(i,e){let n=[];for(let a=0;a<i.length;++a)n.push(ef(i[a],e));return n}function v_(i,e,n){let a=n.pointOnLine(e,i).point;return n.distance(i,a)}function Bs(i,e,n,a,c){let m=n.slice(a[0],a[1]+1),p=1/0;for(let b=e[0];b<=e[1];++b)if((p=Math.min(p,v_(i[b],m,c)))===0)return 0;return p}function tf(i,e,n,a,c){let m=Math.min(c.pointToSegmentDistance(i,n,a),c.pointToSegmentDistance(e,n,a)),p=Math.min(c.pointToSegmentDistance(n,i,e),c.pointToSegmentDistance(a,i,e));return Math.min(m,p)}function qy(i,e,n,a,c){if(!Ra(e,i.length)||!Ra(a,n.length))return NaN;let m=1/0;for(let p=e[0];p<e[1];++p)for(let b=a[0];b<a[1];++b){if(Ri(i[p],i[p+1],n[b],n[b+1]))return 0;m=Math.min(m,tf(i[p],i[p+1],n[b],n[b+1],c))}return m}function x_(i,e,n,a,c){if(!Ra(e,i.length)||!Ra(a,n.length))return NaN;let m=1/0;for(let p=e[0];p<=e[1];++p)for(let b=a[0];b<=a[1];++b)if((m=Math.min(m,c.distance(i[p],n[b])))===0)return m;return m}function w_(i,e,n){if(Pc(i,e,!0))return 0;let a=1/0;for(let c of e){let m=c.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[m-1]&&(a=Math.min(a,n.pointToSegmentDistance(i,c[m-1],c[0])))===0||(a=Math.min(a,v_(i,c,n)))===0)return a}return a}function pa(i,e,n,a){if(!Ra(e,i.length))return NaN;for(let m=e[0];m<=e[1];++m)if(Pc(i[m],n,!0))return 0;let c=1/0;for(let m=e[0];m<e[1];++m)for(let p of n)for(let b=0,y=p.length,w=y-1;b<y;w=b++){if(Ri(i[m],i[m+1],p[w],p[b]))return 0;c=Math.min(c,tf(i[m],i[m+1],p[w],p[b],a))}return c}function nf(i,e){for(let n of i)for(let a=0;a<=n.length-1;++a)if(Pc(n[a],e,!0))return!0;return!1}function $y(i,e,n,a=1/0){let c=Lu(i),m=Lu(e);if(a!==1/0&&zs(c,m,n)>=a)return a;if(Ac(c,m)){if(nf(i,e))return 0}else if(nf(e,i))return 0;let p=a;for(let b of i)for(let y=0,w=b.length,M=w-1;y<w;M=y++)for(let T of e)for(let E=0,P=T.length,R=P-1;E<P;R=E++){if(Ri(b[M],b[y],T[R],T[E]))return 0;p=Math.min(p,tf(b[M],b[y],T[R],T[E],n))}return p}function mh(i,e,n,a,c,m,p){if(m===null||p===null)return;let b=zs(xl(a,m),xl(c,p),n);b<e&&i.push({dist:b,range1:m,range2:p})}function Fu(i,e,n,a,c=1/0){let m=Math.min(a.distance(i[0],n[0][0]),c);if(m===0)return m;let p=new Qp([{dist:0,range1:[0,i.length-1],range2:[0,0]}],b_),b=e?Jp:Kp,y=Lu(n);for(;p.length;){let w=p.pop();if(w.dist>=m)continue;let M=w.range1;if(Ru(M)<=b){if(!Ra(M,i.length))return NaN;if(e){let T=pa(i,M,n,a);if((m=Math.min(m,T))===0)return m}else for(let T=M[0];T<=M[1];++T){let E=w_(i[T],n,a);if((m=Math.min(m,E))===0)return m}}else{let T=Fs(M,e);if(T[0]!==null){let E=zs(xl(i,T[0]),y,a);E<m&&p.push({dist:E,range1:T[0],range2:[0,0]})}if(T[1]!==null){let E=zs(xl(i,T[1]),y,a);E<m&&p.push({dist:E,range1:T[1],range2:[0,0]})}}}return m}function C_(i,e,n,a,c,m=1/0){let p=Math.min(m,c.distance(i[0],n[0]));if(p===0)return p;let b=new Qp([{dist:0,range1:[0,i.length-1],range2:[0,n.length-1]}],b_),y=e?Jp:Kp,w=a?Jp:Kp;for(;b.length;){let M=b.pop();if(M.dist>=p)continue;let T=M.range1,E=M.range2;if(Ru(T)<=y&&Ru(E)<=w){if(!Ra(T,i.length)||!Ra(E,n.length))return NaN;if(e&&a?p=Math.min(p,qy(i,T,n,E,c)):e||a?e&&!a?p=Math.min(p,Bs(n,E,i,T,c)):!e&&a&&(p=Math.min(p,Bs(i,T,n,E,c))):p=Math.min(p,x_(i,T,n,E,c)),p===0)return p}else{let P=Fs(T,e),R=Fs(E,a);mh(b,p,c,i,n,P[0],R[0]),mh(b,p,c,i,n,P[0],R[1]),mh(b,p,c,i,n,P[1],R[0]),mh(b,p,c,i,n,P[1],R[1])}}return p}function rf(i,e,n,a,c=1/0){let m=c,p=xl(i,[0,i.length-1]);for(let b of n)if(!(m!==1/0&&zs(p,xl(b,[0,b.length-1]),a)>=m)&&(m=Math.min(m,C_(i,e,b,!0,a,m)),m===0))return m;return m}function zu(i,e,n,a,c=1/0){let m=c,p=xl(i,[0,i.length-1]);for(let b of n){if(m!==1/0&&zs(p,Lu(b),a)>=m)continue;let y=Fu(i,e,b,a,m);if(isNaN(y))return y;if((m=Math.min(m,y))===0)return m}return m}function of(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class wl{constructor(e,n){this.type=Tt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(co(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(of(a.features[c].geometry.type))return new wl(a,a.features[c].geometry)}else if(a.type==="Feature"){if(of(a.geometry.type))return new wl(a,a.geometry)}else if(of(a.type))return new wl(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(c,m,p){let b=[];for(let w of c)for(let M of w)b.push(ef(M,m));let y=new dh(b[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?C_(b,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y):p.type==="MultiLineString"?rf(b,!1,p.coordinates,y):p.type==="Polygon"||p.type==="MultiPolygon"?zu(b,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,y):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(c,m,p){let b=[];for(let w of c){let M=[];for(let T of w)M.push(ef(T,m));b.push(M)}let y=new dh(b[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return rf(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,y);if(p.type==="MultiLineString"){let w=1/0;for(let M=0;M<p.coordinates.length;M++){let T=rf(p.coordinates[M],!0,b,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}if(p.type==="Polygon"||p.type==="MultiPolygon"){let w=1/0;for(let M=0;M<b.length;M++){let T=zu(b[M],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,m,p){let b=[];for(let w of function(M,T){let E=M.length;if(E<=1)return[M];let P=[],R,F;for(let B=0;B<E;B++){let W=Ny(M[B]);W!==0&&(M[B].area=Math.abs(W),F===void 0&&(F=W<0),F===W<0?(R&&P.push(R),R=[M[B]]):R.push(M[B]))}return R&&P.push(R),P}(c)){let M=[];for(let T=0;T<w.length;++T)M.push(Gy(w[T],m));b.push(M)}let y=new dh(b[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return zu(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,y);if(p.type==="MultiLineString"){let w=1/0;for(let M=0;M<p.coordinates.length;M++){let T=zu(p.coordinates[M],!0,b,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}return p.type==="Polygon"||p.type==="MultiPolygon"?function(w,M,T){let E=1/0;for(let P of w)for(let R of M){let F=$y(P,R,T,E);if(isNaN(F))return F;if((E=Math.min(E,F))===0)return E}return E}(p.type==="Polygon"?[p.coordinates]:p.coordinates,b,y):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Rc(i,e){switch(i){case"string":return Uo(e);case"number":return+e;case"boolean":return!!e;case"color":return Bi.parse(e);case"formatted":return $r.fromString(Uo(e));case"resolvedImage":return lo.fromString(Uo(e))}return e}function ph(i,e,n,a){return a!==void 0&&(i=a*Math.round(i/a)),e!==void 0&&i<e&&(i=e),n!==void 0&&i>n&&(i=n),i}class Lr{constructor(e,n,a){this.type=e,this.key=n,this.scope=a}static parse(e,n){let a=n.expectedType;if(a==null&&(a=Li),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let c=n.parse(e[1],1);if(!(c instanceof es))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let m=n.parse(e[2],2);return m instanceof es?new Lr(a,Uo(c.value),Uo(m.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Lr(a,Uo(c.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(n);if(!a)return null;let{type:c,value:m,values:p,minValue:b,maxValue:y,stepValue:w}=a,M=a.default.evaluate(e),T=M;if(m){let E=e.scope;e.scope=(E||"").split("").slice(1).join(""),T=m.evaluate(e),e.scope=E}return c&&(T=Rc(c,T)),T===void 0||b===void 0&&y===void 0&&w===void 0||(typeof T=="number"?T=ph(T,b,y,w):Array.isArray(T)&&(T=T.map(E=>typeof E=="number"?ph(E,b,y,w):E))),m!==void 0&&T!==void 0&&p&&!p.includes(T)&&(T=M,c&&(T=Rc(c,T))),(c&&c!==this.type||T!==void 0&&hr(T)!==this.type)&&(T=Rc(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Ns(i){if(i instanceof Kr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Rs||i instanceof wl)return!1;let e=!0;return i.eachChild(n=>{e&&!Ns(n)&&(e=!1)}),e}function Bu(i){if(i instanceof Kr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!Bu(n)&&(e=!1)}),e}function af(i){if(i instanceof Lr)return!1;let e=!0;return i.eachChild(n=>{e&&!af(n)&&(e=!1)}),e}function fh(i,e){if(i instanceof Kr&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(a=>{n&&!fh(a,e)&&(n=!1)}),n}class Nu{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=e[1];return n.scope.has(a)?new Nu(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class gh{constructor(e,n=[],a,c=new Hp,m=[],p,b){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=c,this.errors=m,this.expectedType=a,this._scope=p,this.options=b}parse(e,n,a,c,m={}){return n||a?this.concat(n,a,c)._parse(e,m):this._parse(e,m)}_parse(e,n){function a(c,m,p){return p==="assert"?new ha(m,[c]):p==="coerce"?new ua(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let m=c.parse(e,this);if(!m)return null;if(this.expectedType){let p=this.expectedType,b=m.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||b.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(p,b))return null}else m=a(m,p,n.typeAnnotation||"coerce");else m=a(m,p,n.typeAnnotation||"assert")}if(!(m instanceof es)&&m.type.kind!=="resolvedImage"&&_h(m)){let p=new m_(this._scope,this.options);try{m=new es(m.type,m.evaluate(p))}catch(b){return this.error(b.message),null}}return m}return ua.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){let c=typeof e=="number"?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new gh(this.registry,c,n||null,m,this.errors,this._scope,this.options)}error(e,...n){let a=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Pa(a,e))}checkSubtype(e,n){let a=nh(e,n);return a&&this.error(a),a}}var S_=gh;function _h(i){if(i instanceof Nu)return _h(i.boundExpression);if(i instanceof Kr&&i.name==="error"||i instanceof Os||i instanceof Rs||i instanceof wl||i instanceof Lr)return!1;let e=i instanceof ua||i instanceof ha,n=!0;return i.eachChild(a=>{n=e?n&&_h(a):n&&a instanceof es}),!!n&&Ns(i)&&fh(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Vu(i,e){let n=i.length-1,a,c,m=0,p=n,b=0;for(;m<=p;)if(b=Math.floor((m+p)/2),a=i[b],c=i[b+1],a<=e){if(b===n||e<c)return b;m=b+1}else{if(!(a>e))throw new xr("Input is not a number.");p=b-1}return 0}class bh{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[c,m]of a)this.labels.push(c),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(e[1],1,Tt);if(!a)return null;let c=[],m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let p=1;p<e.length;p+=2){let b=p===1?-1/0:e[p],y=e[p+1],w=p,M=p+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let T=n.parse(y,M,m);if(!T)return null;m=m||T.type,c.push([b,T])}return new bh(m,a,c)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let m=n.length;return c>=n[m-1]?a[m-1].evaluate(e):a[Vu(n,c)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let ju=.95047,M_=1.08883,sf=4/29,Cl=6/29,k_=3*Cl*Cl,lf=Cl*Cl*Cl,Uu=Math.PI/180,I_=180/Math.PI;function cf(i){return i>lf?Math.pow(i,1/3):i/k_+sf}function Hu(i){return i>Cl?i*i*i:k_*(i-sf)}function df(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function yh(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function T_(i){let e=yh(i.r),n=yh(i.g),a=yh(i.b),c=cf((.4124564*e+.3575761*n+.1804375*a)/ju),m=cf((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*m-16,a:500*(c-m),b:200*(m-cf((.0193339*e+.119192*n+.9503041*a)/M_)),alpha:i.a}}function E_(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,a=isNaN(i.b)?e:e-i.b/200;return e=1*Hu(e),n=ju*Hu(n),a=M_*Hu(a),new Bi(df(3.2404542*n-1.5371385*e-.4985314*a),df(-.969266*n+1.8760108*e+.041556*a),df(.0556434*n-.2040259*e+1.0572252*a),i.alpha)}function Yy(i,e,n){let a=e-i;return i+n*(a>180||a<-180?a-360*Math.round(a/360):a)}let vh={forward:T_,reverse:E_,interpolate:function(i,e,n){return{l:Wt(i.l,e.l,n),a:Wt(i.a,e.a,n),b:Wt(i.b,e.b,n),alpha:Wt(i.alpha,e.alpha,n)}}},Lc={forward:function(i){let{l:e,a:n,b:a}=T_(i),c=Math.atan2(a,n)*I_;return{h:c<0?c+360:c,c:Math.sqrt(n*n+a*a),l:e,alpha:i.a}},reverse:function(i){let e=i.h*Uu,n=i.c;return E_({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:Yy(i.h,e.h,n),c:Wt(i.c,e.c,n),l:Wt(i.l,e.l,n),alpha:Wt(i.alpha,e.alpha,n)}}};var D_=Object.freeze({__proto__:null,hcl:Lc,lab:vh});class Po{constructor(e,n,a,c,m){this.type=e,this.operator=n,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(let[p,b]of m)this.labels.push(p),this.outputs.push(b)}static interpolationFactor(e,n,a,c){let m=0;if(e.name==="exponential")m=hf(n,e.base,a,c);else if(e.name==="linear")m=hf(n,1,a,c);else if(e.name==="cubic-bezier"){let p=e.controlPoints;m=new jd(p[0],p[1],p[2],p[3]).solve(hf(n,1,a,c))}return m}static parse(e,n){let[a,c,m,...p]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let w=c[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let w=c.slice(1);if(w.length!==4||w.some(M=>typeof M!="number"||M<0||M>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,Tt),!m)return null;let b=[],y=null;a==="interpolate-hcl"||a==="interpolate-lab"?y=so:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let w=0;w<p.length;w+=2){let M=p[w],T=p[w+1],E=w+3,P=w+4;if(typeof M!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(b.length&&b[b.length-1][0]>=M)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);let R=n.parse(T,P,y);if(!R)return null;y=y||R.type,b.push([M,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Po(y,a,c,m,b):n.error(`Type ${Jn(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let m=n.length;if(c>=n[m-1])return a[m-1].evaluate(e);let p=Vu(n,c),b=Po.interpolationFactor(this.interpolation,c,n[p],n[p+1]),y=a[p].evaluate(e),w=a[p+1].evaluate(e);return this.operator==="interpolate"?Au[this.type.kind.toLowerCase()](y,w,b):this.operator==="interpolate-hcl"?Lc.reverse(Lc.interpolate(Lc.forward(y),Lc.forward(w),b)):vh.reverse(vh.interpolate(vh.forward(y),vh.forward(w),b))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function hf(i,e,n,a){let c=a-n,m=i-n;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class Wu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null,c=n.expectedType;c&&c.kind!=="value"&&(a=c);let m=[];for(let b of e.slice(1)){let y=n.parse(b,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!y)return null;a=a||y.type,m.push(y)}let p=c&&m.some(b=>nh(c,b.type));return new Wu(p?Li:a,m)}evaluate(e){let n,a=null,c=0;for(let m of this.args){if(c++,a=m.evaluate(e),a&&a instanceof lo&&!a.available&&(n||(n=a),a=null,c===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Gu{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let m=1;m<e.length-1;m+=2){let p=e[m];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,m);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);let b=n.parse(e[m+1],m+1);if(!b)return null;a.push([p,b])}let c=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return c?new Gu(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class uf{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Tt),c=n.parse(e[2],2,_o(n.expectedType||Li));return a&&c?new uf(c.type.itemType,a,c):null}evaluate(e){let n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new xr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new xr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new xr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class mf{constructor(e,n){this.type=Vi,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Li),c=n.parse(e[2],2,Li);return a&&c?Wp(a.type,[Vi,Ni,Tt,Ic,Li])?new mf(a,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(a.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Dc(n,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(hr(n))} instead.`);if(!Dc(a,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Jn(hr(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class qu{constructor(e,n,a){this.type=Tt,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Li),c=n.parse(e[2],2,Li);if(!a||!c)return null;if(!Wp(a.type,[Vi,Ni,Tt,Ic,Li]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(a.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,Tt);return m?new qu(a,c,m):null}return new qu(a,c)}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Dc(n,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(hr(n))} instead.`);if(!Dc(a,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Jn(hr(a))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(e);return a.indexOf(n,c)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Fc{constructor(e,n,a,c,m,p){this.inputType=e,this.type=n,this.input=a,this.cases=c,this.outputs=m,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);let m={},p=[];for(let w=2;w<e.length-1;w+=2){let M=e[w],T=e[w+1];Array.isArray(M)||(M=[M]);let E=n.concat(w);if(M.length===0)return E.error("Expected at least one branch label.");for(let R of M){if(typeof R!="number"&&typeof R!="string")return E.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return E.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return E.error("Numeric branch labels must be integer values.");if(a){if(E.checkSubtype(a,hr(R)))return null}else a=hr(R);if(m[String(R)]!==void 0)return E.error("Branch labels must be unique.");m[String(R)]=p.length}let P=n.parse(T,w,c);if(!P)return null;c=c||P.type,p.push(P)}let b=n.parse(e[1],1,Li);if(!b)return null;let y=n.parse(e[e.length-1],e.length-1,c);return y?b.type.kind!=="value"&&n.concat(1).checkSubtype(a,b.type)?null:new Fc(a,c,b,m,p,y):null}evaluate(e){let n=this.input.evaluate(e);return(hr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],c={};for(let p of n){let b=c[this.cases[p]];b===void 0?(c[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[b][1].push(p)}let m=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,b]of a)e.push(b.length===1?m(b[0]):b.map(m)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class pf{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let c=[];for(let p=1;p<e.length-1;p+=2){let b=n.parse(e[p],p,Vi);if(!b)return null;let y=n.parse(e[p+1],p+1,a);if(!y)return null;c.push([b,y]),a=a||y.type}let m=n.parse(e[e.length-1],e.length-1,a);return m?new pf(a,c,m):null}evaluate(e){for(let[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class $u{constructor(e,n,a,c){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Li),c=n.parse(e[2],2,Tt);if(!a||!c)return null;if(!Wp(a.type,[_o(Li),Ni,Li]))return n.error(`Expected first argument to be of type array or string, but found ${Jn(a.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,Tt);return m?new $u(a.type,a,c,m):null}return new $u(a.type,a,c)}evaluate(e){let n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Dc(n,["string","array"]))throw new xr(`Expected first argument to be of type array or string, but found ${Jn(hr(n))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(e);return n.slice(a,c)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function xh(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function A_(i,e,n,a){return a.compare(e,n)===0}function Sl(i,e,n){let a=i!=="=="&&i!=="!=";return class DT{constructor(m,p,b){this.type=Vi,this.lhs=m,this.rhs=p,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||p.type.kind==="value"}static parse(m,p){if(m.length!==3&&m.length!==4)return p.error("Expected two or three arguments.");let b=m[0],y=p.parse(m[1],1,Li);if(!y)return null;if(!xh(b,y.type))return p.concat(1).error(`"${b}" comparisons are not supported for type '${Jn(y.type)}'.`);let w=p.parse(m[2],2,Li);if(!w)return null;if(!xh(b,w.type))return p.concat(2).error(`"${b}" comparisons are not supported for type '${Jn(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Jn(y.type)}' and '${Jn(w.type)}'.`);a&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new ha(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new ha(y.type,[w])));let M=null;if(m.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(m[3],3,da),!M)return null}return new DT(y,w,M)}evaluate(m){let p=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){let y=hr(p),w=hr(b);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new xr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let y=hr(p),w=hr(b);if(y.kind!=="string"||w.kind!=="string")return e(m,p,b)}return this.collator?n(m,p,b,this.collator.evaluate(m)):e(m,p,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[i];return this.eachChild(p=>{m.push(p.serialize())}),m}}}let Zy=Sl("==",function(i,e,n){return e===n},A_),P_=Sl("!=",function(i,e,n){return e!==n},function(i,e,n,a){return!A_(0,e,n,a)}),O_=Sl("<",function(i,e,n){return e<n},function(i,e,n,a){return a.compare(e,n)<0}),R_=Sl(">",function(i,e,n){return e>n},function(i,e,n,a){return a.compare(e,n)>0}),L_=Sl("<=",function(i,e,n){return e<=n},function(i,e,n,a){return a.compare(e,n)<=0}),ff=Sl(">=",function(i,e,n){return e>=n},function(i,e,n,a){return a.compare(e,n)>=0});class wh{constructor(e,n,a,c,m,p){this.type=Ni,this.number=e,this.locale=n,this.currency=a,this.unit=c,this.minFractionDigits=m,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let a=n.parse(e[1],1,Tt);if(!a)return null;let c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,Ni),!m))return null;let p=null;if(c.currency&&(p=n.parse(c.currency,1,Ni),!p))return null;let b=null;if(c.unit&&(b=n.parse(c.unit,1,Ni),!b))return null;let y=null;if(c["min-fraction-digits"]&&(y=n.parse(c["min-fraction-digits"],1,Tt),!y))return null;let w=null;return c["max-fraction-digits"]&&(w=n.parse(c["max-fraction-digits"],1,Tt),!w)?null:new wh(a,m,p,b,y,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class gf{constructor(e){this.type=Tt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Jn(a.type)} instead.`):new gf(a):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new xr(`Expected value to be of type string or array, but found ${Jn(hr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function F_(i){return function(){i=1831565813+(i|=0)|0;let e=Math.imul(i^i>>>15,1|i);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Ml={"==":Zy,"!=":P_,">":R_,"<":O_,">=":ff,"<=":L_,array:ha,at:uf,boolean:ha,case:pf,coalesce:Wu,collator:Os,format:oh,image:ah,in:mf,"index-of":qu,interpolate:Po,"interpolate-hcl":Po,"interpolate-lab":Po,length:gf,let:Gu,literal:es,match:Fc,number:ha,"number-format":wh,object:ha,slice:$u,step:bh,string:ha,"to-boolean":ua,"to-color":ua,"to-number":ua,"to-string":ua,var:Nu,within:Rs,distance:wl,config:Lr};function z_(i,[e,n,a,c]){e=e.evaluate(i),n=n.evaluate(i),a=a.evaluate(i);let m=c?c.evaluate(i):1,p=h_(e,n,a,m);if(p)throw new xr(p);return new Bi(e/255*m,n/255*m,a/255*m,m)}function B_(i,[e,n,a,c]){e=e.evaluate(i),n=n.evaluate(i),a=a.evaluate(i);let m=c?c.evaluate(i):1,p=function(w,M,T,E){return typeof w=="number"&&w>=0&&w<=360?typeof M=="number"&&M>=0&&M<=100&&typeof T=="number"&&T>=0&&T<=100?E===void 0||typeof E=="number"&&E>=0&&E<=1?null:`Invalid hsla value [${[w,M,T,E].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof E=="number"?[w,M,T,E]:[w,M,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof E=="number"?[w,M,T,E]:[w,M,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,m);if(p)throw new xr(p);let b=`hsla(${e}, ${n}%, ${a}%, ${m})`,y=Bi.parse(b);if(!y)throw new xr(`Failed to parse HSLA color: ${b}`);return y}function N_(i,e){return i in e}function _f(i,e){let n=e[i];return n===void 0?null:n}function kl(i){return{type:i}}function V_(i){return{result:"success",value:i}}function Il(i){return{result:"error",value:i}}function j_(i,e){return!!i&&!!i.parameters&&i.parameters.indexOf(e)>-1}function Yu(i){return i["property-type"]==="data-driven"}function Xy(i){return j_(i.expression,"measure-light")}function f(i){return j_(i.expression,"zoom")}function o(i){return!!i.expression&&i.expression.interpolated}function h(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function g(i){return i}function v(i,e){let n=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",c=a||!(a||i.property!==void 0),m=i.type||(o(e)?"exponential":"interval");if(n&&((i=Up({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],Bi.parse(w[1])])),i.default=Bi.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!D_[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,b,y;if(m==="exponential")p=D;else if(m==="interval")p=k;else if(m==="categorical"){p=S,b=Object.create(null);for(let w of i.stops)b[w[0]]=w[1];y=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);p=A}if(a){let w={},M=[];for(let P=0;P<i.stops.length;P++){let R=i.stops[P],F=R[0].zoom;w[F]===void 0&&(w[F]={zoom:F,type:i.type,property:i.property,default:i.default,stops:[]},M.push(F)),w[F].stops.push([R[0].value,R[1]])}let T=[];for(let P of M)T.push([w[P].zoom,v(w[P],e)]);let E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:Po.interpolationFactor.bind(void 0,E),zoomStops:T.map(P=>P[0]),evaluate:({zoom:P},R)=>D({stops:T,base:i.base},e,P).evaluate(P,R)}}if(c){let w=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Po.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>p(i,e,M,b,y)}}return{kind:"source",evaluate(w,M){let T=M&&M.properties?M.properties[i.property]:void 0;return T===void 0?x(i.default,e.default):p(i,e,T,b,y)}}}function x(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function S(i,e,n,a,c){return x(typeof n===c?a[n]:void 0,i.default,e.default)}function k(i,e,n){if(vl(n)!=="number")return x(i.default,e.default);let a=i.stops.length;if(a===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[a-1][0])return i.stops[a-1][1];let c=Vu(i.stops.map(m=>m[0]),n);return i.stops[c][1]}function D(i,e,n){let a=i.base!==void 0?i.base:1;if(vl(n)!=="number")return x(i.default,e.default);let c=i.stops.length;if(c===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[c-1][0])return i.stops[c-1][1];let m=Vu(i.stops.map(M=>M[0]),n),p=function(M,T,E,P){let R=P-E,F=M-E;return R===0?0:T===1?F/R:(Math.pow(T,F)-1)/(Math.pow(T,R)-1)}(n,a,i.stops[m][0],i.stops[m+1][0]),b=i.stops[m][1],y=i.stops[m+1][1],w=Au[e.type]||g;if(i.colorSpace&&i.colorSpace!=="rgb"){let M=D_[i.colorSpace];w=(T,E)=>M.reverse(M.interpolate(M.forward(T),M.forward(E),p))}return typeof b.evaluate=="function"?{evaluate(...M){let T=b.evaluate.apply(void 0,M),E=y.evaluate.apply(void 0,M);if(T!==void 0&&E!==void 0)return w(T,E,p)}}:w(b,y,p)}function A(i,e,n){return e.type==="color"?n=Bi.parse(n):e.type==="formatted"?n=$r.fromString(n.toString()):e.type==="resolvedImage"?n=lo.fromString(n.toString()):vl(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),x(n,i.default,e.default)}Kr.register(Ml,{error:[{kind:"error"},[Ni],(i,[e])=>{throw new xr(e.evaluate(i))}],typeof:[Ni,[Li],(i,[e])=>Jn(hr(e.evaluate(i)))],"to-rgba":[_o(Tt,4),[so],(i,[e])=>e.evaluate(i).toRenderColor(null).toArray()],rgb:[so,[Tt,Tt,Tt],z_],rgba:[so,[Tt,Tt,Tt,Tt],z_],hsl:[so,[Tt,Tt,Tt],B_],hsla:[so,[Tt,Tt,Tt,Tt],B_],has:{type:Vi,overloads:[[[Ni],(i,[e])=>N_(e.evaluate(i),i.properties())],[[Ni,Tc],(i,[e,n])=>N_(e.evaluate(i),n.evaluate(i))]]},get:{type:Li,overloads:[[[Ni],(i,[e])=>_f(e.evaluate(i),i.properties())],[[Ni,Tc],(i,[e,n])=>_f(e.evaluate(i),n.evaluate(i))]]},"feature-state":[Li,[Ni],(i,[e])=>_f(e.evaluate(i),i.featureState||{})],properties:[Tc,[],i=>i.properties()],"geometry-type":[Ni,[],i=>i.geometryType()],id:[Li,[],i=>i.id()],zoom:[Tt,[],i=>i.globals.zoom],pitch:[Tt,[],i=>i.globals.pitch||0],"distance-from-center":[Tt,[],i=>i.distanceFromCenter()],"measure-light":[Tt,[Ni],(i,[e])=>i.measureLight(e.evaluate(i))],"heatmap-density":[Tt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Tt,[],i=>i.globals.lineProgress||0],"raster-value":[Tt,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[Tt,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[Tt,[],i=>i.globals.skyRadialProgress||0],accumulated:[Li,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Tt,kl(Tt),(i,e)=>{let n=0;for(let a of e)n+=a.evaluate(i);return n}],"*":[Tt,kl(Tt),(i,e)=>{let n=1;for(let a of e)n*=a.evaluate(i);return n}],"-":{type:Tt,overloads:[[[Tt,Tt],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Tt],(i,[e])=>-e.evaluate(i)]]},"/":[Tt,[Tt,Tt],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Tt,[Tt,Tt],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Tt,[],()=>Math.LN2],pi:[Tt,[],()=>Math.PI],e:[Tt,[],()=>Math.E],"^":[Tt,[Tt,Tt],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Tt,[Tt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Tt,[Tt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Tt,[Tt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Tt,[Tt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Tt,[Tt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Tt,[Tt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Tt,[Tt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Tt,[Tt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Tt,[Tt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Tt,[Tt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Tt,kl(Tt),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[Tt,kl(Tt),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[Tt,[Tt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Tt,[Tt],(i,[e])=>{let n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Tt,[Tt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Tt,[Tt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Vi,[Ni,Li],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[Vi,[Li],(i,[e])=>i.id()===e.value],"filter-type-==":[Vi,[Ni],(i,[e])=>i.geometryType()===e.value],"filter-<":[Vi,[Ni,Li],(i,[e,n])=>{let a=i.properties()[e.value],c=n.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Vi,[Li],(i,[e])=>{let n=i.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Vi,[Ni,Li],(i,[e,n])=>{let a=i.properties()[e.value],c=n.value;return typeof a==typeof c&&a>c}],"filter-id->":[Vi,[Li],(i,[e])=>{let n=i.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Vi,[Ni,Li],(i,[e,n])=>{let a=i.properties()[e.value],c=n.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Vi,[Li],(i,[e])=>{let n=i.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Vi,[Ni,Li],(i,[e,n])=>{let a=i.properties()[e.value],c=n.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Vi,[Li],(i,[e])=>{let n=i.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Vi,[Li],(i,[e])=>e.value in i.properties()],"filter-has-id":[Vi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Vi,[_o(Ni)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Vi,[_o(Li)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Vi,[Ni,_o(Li)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Vi,[Ni,_o(Li)],(i,[e,n])=>function(a,c,m,p){for(;m<=p;){let b=m+p>>1;if(c[b]===a)return!0;c[b]>a?p=b-1:m=b+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Vi,overloads:[[[Vi,Vi],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[kl(Vi),(i,e)=>{for(let n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Vi,overloads:[[[Vi,Vi],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[kl(Vi),(i,e)=>{for(let n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[Vi,[Vi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Vi,[Ni],(i,[e])=>{let n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Ni,[Ni],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Ni,[Ni],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Ni,kl(Li),(i,e)=>e.map(n=>Uo(n.evaluate(i))).join("")],"resolved-locale":[Ni,[da],(i,[e])=>e.evaluate(i).resolvedLocale()],random:[Tt,[Tt,Tt,Li],(i,e)=>{let[n,a,c]=e.map(p=>p.evaluate(i));if(n>a||n===a)return n;let m;if(typeof c=="string")m=function(p){let b=0;if(p.length===0)return b;for(let y=0;y<p.length;y++)b=(b<<5)-b+p.charCodeAt(y),b|=0;return b}(c);else{if(typeof c!="number")throw new xr(`Invalid seed input: ${c}`);m=c}return n+F_(m)()*(a-n)}]});class L{constructor(e,n,a,c){this.expression=e,this._warningHistory={},this._evaluator=new m_(a,c),this._defaultValue=n?function(m){return m.type==="color"&&(h(m.default)||Array.isArray(m.default))?new Bi(0,0,0,0):m.type==="color"?Bi.parse(m.default)||null:m.default===void 0?null:m.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,c,m,p,b,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,c,m,p,b,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=y||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new xr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function z(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ml}function U(i,e,n,a){let c=new S_(Ml,[],e?function(p){let b={color:so,string:Ni,number:Tt,enum:Ni,boolean:Vi,formatted:Ec,resolvedImage:Oa};return p.type==="array"?_o(b[p.value]||Li,p.length):b[p.type]}(e):void 0,void 0,void 0,n,a),m=c.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?V_(new L(m,e,n,a)):Il(c.errors)}class H{constructor(e,n,a){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!Bu(n.expression),this.isConfigDependent=!af(n.expression)}evaluateWithoutErrorHandling(e,n,a,c,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,m,p)}evaluate(e,n,a,c,m,p){return this._styleExpression.evaluate(e,n,a,c,m,p)}}class Y{constructor(e,n,a,c,m){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Bu(n.expression),this.isLightConstant=m,this.isConfigDependent=!af(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,a,c,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,m,p)}evaluate(e,n,a,c,m,p){return this._styleExpression.evaluate(e,n,a,c,m,p)}interpolationFactor(e,n,a){return this.interpolationType?Po.interpolationFactor(this.interpolationType,e,n,a):0}}function Z(i,e,n,a){if((i=U(i,e,n,a)).result==="error")return i;let c=i.value.expression,m=Ns(c);if(!m&&!Yu(e))return Il([new Pa("","data expressions not supported")]);let p=fh(c,["zoom","pitch","distance-from-center"]);if(!p&&!f(e))return Il([new Pa("","zoom expressions not supported")]);let b=fh(c,["measure-light"]);if(!b&&!Xy(e))return Il([new Pa("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,w=Q(c);return w||p||y?w instanceof Pa?Il([w]):w instanceof Po&&!o(e)?Il([new Pa("",'"interpolate" expressions cannot be used with this property')]):V_(w?new Y(m?"camera":"composite",i.value,w.labels,w instanceof Po?w.interpolation:void 0,b):new H(m?"constant":"source",i.value,b)):Il([new Pa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class X{constructor(e,n){this._parameters=e,this._specification=n,Up(this,v(this._parameters,this._specification))}static deserialize(e){return new X(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Q(i){let e=null;if(i instanceof Gu)e=Q(i.result);else if(i instanceof Wu){for(let n of i.args)if(e=Q(n),e)break}else(i instanceof bh||i instanceof Po)&&i.input instanceof Kr&&i.input.name==="zoom"&&(e=i);return e instanceof Pa||i.eachChild(n=>{let a=Q(n);a instanceof Pa?e=a:e&&a&&e!==a&&(e=new Pa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var re=ae,oe=3;function ae(i,e,n){var a=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var c=new Int32Array(this.arrayBuffer);i=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var m=0;m<this.d*this.d;m++){var p=c[oe+m],b=c[oe+m+1];a.push(p===b?null:c.subarray(p,b))}var y=c[oe+a.length+1];this.keys=c.subarray(c[oe+a.length],y),this.bboxes=c.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=n,this.scale=e/i,this.uid=0;var M=n/e*i;this.min=-M,this.max=i+M}ae.prototype.insert=function(i,e,n,a,c){this._forEachCell(e,n,a,c,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c)},ae.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ae.prototype._insertCell=function(i,e,n,a,c,m){this.cells[c].push(m)},ae.prototype.query=function(i,e,n,a,c){var m=this.min,p=this.max;if(i<=m&&e<=m&&p<=n&&p<=a&&!c)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(i,e,n,a,this._queryCell,b,{},c),b},ae.prototype._queryCell=function(i,e,n,a,c,m,p,b){var y=this.cells[c];if(y!==null)for(var w=this.keys,M=this.bboxes,T=0;T<y.length;T++){var E=y[T];if(p[E]===void 0){var P=4*E;(b?b(M[P+0],M[P+1],M[P+2],M[P+3]):i<=M[P+2]&&e<=M[P+3]&&n>=M[P+0]&&a>=M[P+1])?(p[E]=!0,m.push(w[E])):p[E]=!1}}},ae.prototype._forEachCell=function(i,e,n,a,c,m,p,b){for(var y=this._convertToCellCoord(i),w=this._convertToCellCoord(e),M=this._convertToCellCoord(n),T=this._convertToCellCoord(a),E=y;E<=M;E++)for(var P=w;P<=T;P++){var R=this.d*P+E;if((!b||b(this._convertFromCellCoord(E),this._convertFromCellCoord(P),this._convertFromCellCoord(E+1),this._convertFromCellCoord(P+1)))&&c.call(this,i,e,n,a,R,m,p,b))return}},ae.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ae.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ae.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=oe+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var m=e,p=0;p<i.length;p++){var b=i[p];c[oe+p]=m,c.set(b,m),m+=b.length}return c[oe+i.length]=m,c.set(this.keys,m),c[oe+i.length+1]=m+=this.keys.length,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer};var _e=Xe(re);let ge={};function ne(i,e,n={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writable:!1}),ge[e]={klass:i,omit:n.omit||[]}}ne(Object,"Object"),_e.serialize=function(i,e){let n=i.toArrayBuffer();return e&&e.add(n),{buffer:n}},_e.deserialize=function(i){return new _e(i.buffer)},Object.defineProperty(_e,"name",{value:"Grid"}),ne(_e,"Grid"),ne(Bi,"Color"),ne(Error,"Error"),ne($r,"Formatted"),ne(yl,"FormattedSection"),ne(Rp,"AJAXError"),ne(lo,"ResolvedImage"),ne(X,"StylePropertyFunction"),ne(L,"StyleExpression",{omit:["_evaluator"]}),ne(Y,"ZoomDependentExpression"),ne(H,"ZoomConstantExpression"),ne(Kr,"CompoundExpression",{omit:["_evaluate"]});for(let i in Ml)ge[Ml[i]._classRegistryKey]||ne(Ml[i],`Expression${i}`);function se(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function le(i){return self.ImageBitmap&&i instanceof ImageBitmap}function we(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(se(i)||le(i))return e&&e.add(i),i;if(ArrayBuffer.isView(i)){let n=i;return e&&e.add(n.buffer),n}if(i instanceof ImageData)return e&&e.add(i.data.buffer),i;if(Array.isArray(i)){let n=[];for(let a of i)n.push(we(a,e));return n}if(i instanceof Map){let n={$name:"Map"};for(let[a,c]of i.entries())n[a]=we(c);return n}if(typeof i=="object"){let n=i.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let c=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(let m in i)i.hasOwnProperty(m)&&(ge[a].omit.indexOf(m)>=0||(c[m]=we(i[m],e)));i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof i)}function Re(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||se(i)||le(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Re);if(typeof i=="object"){let e=i.$name||"Object";if(e==="Map"){let c=new Map;for(let m of Object.keys(i))m!=="$name"&&c.set(m,Re(i[m]));return c}let{klass:n}=ge[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);let a=Object.create(n.prototype);for(let c of Object.keys(i))c!=="$name"&&(a[c]=Re(i[c]));return a}throw new Error("can't deserialize object of type "+typeof i)}let me={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function Le(i){for(let e of i)if(Je(e.charCodeAt(0)))return!0;return!1}function Be(i){for(let e of i)if(!Qe(e.charCodeAt(0)))return!1;return!0}function Qe(i){return!(me.Arabic(i)||me["Arabic Supplement"](i)||me["Arabic Extended-A"](i)||me["Arabic Presentation Forms-A"](i)||me["Arabic Presentation Forms-B"](i))}function Je(i){return!(i!==746&&i!==747&&(i<4352||!(me["Bopomofo Extended"](i)||me.Bopomofo(i)||me["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||me["CJK Compatibility Ideographs"](i)||me["CJK Compatibility"](i)||me["CJK Radicals Supplement"](i)||me["CJK Strokes"](i)||!(!me["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||me["CJK Unified Ideographs Extension A"](i)||me["CJK Unified Ideographs"](i)||me["Enclosed CJK Letters and Months"](i)||me["Hangul Compatibility Jamo"](i)||me["Hangul Jamo Extended-A"](i)||me["Hangul Jamo Extended-B"](i)||me["Hangul Jamo"](i)||me["Hangul Syllables"](i)||me.Hiragana(i)||me["Ideographic Description Characters"](i)||me.Kanbun(i)||me["Kangxi Radicals"](i)||me["Katakana Phonetic Extensions"](i)||me.Katakana(i)&&i!==12540||!(!me["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!me["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||me["Unified Canadian Aboriginal Syllabics"](i)||me["Unified Canadian Aboriginal Syllabics Extended"](i)||me["Vertical Forms"](i)||me["Yijing Hexagram Symbols"](i)||me["Yi Syllables"](i)||me["Yi Radicals"](i))))}function Ze(i){return!(Je(i)||function(e){return!!(me["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||me["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||me["Letterlike Symbols"](e)||me["Number Forms"](e)||me["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||me["Control Pictures"](e)&&e!==9251||me["Optical Character Recognition"](e)||me["Enclosed Alphanumerics"](e)||me["Geometric Shapes"](e)||me["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||me["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||me["CJK Symbols and Punctuation"](e)||me.Katakana(e)||me["Private Use Area"](e)||me["CJK Compatibility Forms"](e)||me["Small Form Variants"](e)||me["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Te(i){return i>=1424&&i<=2303||me["Arabic Presentation Forms-A"](i)||me["Arabic Presentation Forms-B"](i)}function Ve(i,e){return!(!e&&Te(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||me.Khmer(i))}function Ye(i){for(let e of i)if(Te(e.charCodeAt(0)))return!0;return!1}let bt="deferred",yt="loading",kt="loaded",vt=null,it="unavailable",Ge=null,Dt=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(it="error"),vt&&vt(i)};function ai(){ti.fire(new ao("pluginStateChange",{pluginStatus:it,pluginURL:Ge}))}let ti=new bl,vi=function(){return it},Ai=function(){if(it!==bt||!Ge)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");it=yt,ai(),Ge&&gl({url:Ge},i=>{i?Dt(i):(it=kt,ai())})},Ki={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>it===kt||Ki.applyArabicShaping!=null,isLoading:()=>it===yt,setState(i){it=i.pluginStatus,Ge=i.pluginURL},isParsed:()=>Ki.applyArabicShaping!=null&&Ki.processBidirectionalText!=null&&Ki.processStyledBidirectionalText!=null,getPluginURL:()=>Ge};class Kt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(let c of n)if(!Ve(c.charCodeAt(0),a))return!1;return!0}(e,Ki.isLoaded())}}class Gi{constructor(e,n,a,c){this.property=e,this.value=n,this.expression=function(m,p,b,y){if(h(m))return new X(m,p);if(z(m)||Array.isArray(m)&&m.length>0){let w=Z(m,p,b,y);if(w.result==="error")throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));return w.value}{let w=m;return typeof m=="string"&&p.type==="color"&&(w=Bi.parse(m)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(n===void 0?e.specification.default:n,e.specification,a,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class hn{constructor(e,n,a){this.property=e,this.value=new Gi(e,void 0,n,a)}transitioned(e,n){return new Ci(this.property,this.value,n,qr({},e.transition,this.transition),e.now)}untransitioned(){return new Ci(this.property,this.value,null,{},0)}}class Xi{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Da(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new hn(this._values[e].property,this._scope,this._options)),this._values[e].value=new Gi(this._values[e].property,n===null?void 0:Da(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let a=this._properties.properties;if(e)for(let c in e){let m=e[c];if(Wd(c,"-transition")){let p=c.slice(0,-11);a[p]&&this.setTransition(p,m)}else a.hasOwnProperty(c)&&this.setValue(c,m)}}getTransition(e){return Da(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new hn(this._values[e].property)),this._values[e].transition=Da(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a);let c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){let a=new ni(this._properties);for(let c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,n._values[c]);return a}untransitioned(){let e=new ni(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Ci{constructor(e,n,a,c,m){let p=c.delay||0,b=c.duration||0;m=m||0,this.property=e,this.value=n,this.begin=m+p,this.end=this.begin+b,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){let c=e.now||0,m=this.value.possiblyEvaluate(e,n,a),p=this.prior;if(p){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return p.possiblyEvaluate(e,n,a);{let b=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,a),m,xp(b))}}return m}}class ni{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){let c=new nn(this._properties);for(let m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,a);return c}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class gn{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Da(this._values[e].value)}setValue(e,n){this._values[e]=new Gi(this._values[e].property,n===null?void 0:Da(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){let c=new nn(this._properties);for(let m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,a);return c}}class xn{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,c){return this.property.evaluate(this.value,this.parameters,e,n,a,c)}}class nn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ke{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){let c=Au[this.specification.type];return c?c(e,n,a):e}}class St{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,c){return new xn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,c)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new xn(this,{kind:"constant",value:void 0},e.parameters);let c=Au[this.specification.type];return c?new xn(this,{kind:"constant",value:c(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,c,m,p){return e.kind==="constant"?e.value:e.evaluate(n,a,c,m,p)}}class An{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,c){return!!e.expression.evaluate(n,null,{},a,c)}interpolate(){return!1}}class qi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Kt(0,{});for(let a in e){let c=e[a];c.specification.overridable&&this.overridableProperties.push(a);let m=this.defaultPropertyValues[a]=new Gi(c,void 0),p=this.defaultTransitionablePropertyValues[a]=new hn(c);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=m.possiblyEvaluate(n)}}}ne(St,"DataDrivenProperty"),ne(Ke,"DataConstantProperty"),ne(An,"ColorRampProperty");var Oe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Oo(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Fr(i){if(Array.isArray(i))return i.map(Fr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let e={};for(let n in i)e[n]=Fr(i[n]);return e}return Oo(i)}function Jr(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let e of i.slice(1))if(!Jr(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function wr(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Jr(i)||(i=La(i));let n=i,a=!0;try{a=function(w){if(!Ro(w))return w;let M=Fr(w);return fa(M),M=ho(M),M}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let c=Oe[`filter_${e}`],m=U(a,c),p=null;if(m.result==="error")throw new Error(m.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,M,T)=>m.value.evaluate(w,M,{},T);let b=null,y=null;if(a!==n){let w=U(n,c);if(w.result==="error")throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));b=(M,T,E,P,R)=>w.value.evaluate(M,T,{},E,void 0,void 0,P,R),y=!Ns(w.value.expression)}return{filter:p,dynamicFilter:b||void 0,needGeometry:is(a),needFeature:!!y}}function ho(i){if(!Array.isArray(i))return i;let e=function(n){if(Vs.has(n[0])){for(let a=1;a<n.length;a++)if(Ro(n[a]))return!0}return n}(i);return e===!0?e:e.map(n=>ho(n))}function fa(i){let e=!1,n=[];if(i[0]==="case"){for(let a=1;a<i.length-1;a+=2)e=e||Ro(i[a]),n.push(i[a+1]);n.push(i[i.length-1])}else if(i[0]==="match"){e=e||Ro(i[1]);for(let a=2;a<i.length-1;a+=2)n.push(i[a+1]);n.push(i[i.length-1])}else if(i[0]==="step"){e=e||Ro(i[1]);for(let a=1;a<i.length-1;a+=2)n.push(i[a+1])}e&&(i.length=0,i.push("any",...n));for(let a=1;a<i.length;a++)fa(i[a])}function Ro(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<i.length;n++)if(Ro(i[n]))return!0;return!1}let Vs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function js(i,e){return i<e?-1:i>e?1:0}function is(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(is(i[e]))return!0;return!1}function La(i){if(!i)return!0;let e=i[0];return i.length<=1?e!=="any":e==="=="?ns(i[1],i[2],"=="):e==="!="?Tl(ns(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ns(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(La))):e==="all"?["all"].concat(i.slice(1).map(La)):e==="none"?["all"].concat(i.slice(1).map(La).map(Tl)):e==="in"?zc(i[1],i.slice(2)):e==="!in"?Tl(zc(i[1],i.slice(2))):e==="has"?Bc(i[1]):e!=="!has"||Tl(Bc(i[1]));var n}function ns(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function zc(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(js)]]:["filter-in-small",i,["literal",e]]}}function Bc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Tl(i){return["!",i]}let Nc="";function Zu(i,e){return e?`${i}${Nc}${e}`:i}let Xu="-transition",bf=new Set(["fill","line","background","hillshade","raster"]);class gr extends bl{constructor(e,n,a,c,m){if(super(),this.id=e.id,this.fqid=Zu(this.id,a),this.type=e.type,this.scope=a,this.lut=c,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new gn(n.layout,this.scope,m),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Xi(n.paint,this.scope,m);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nn(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return bf.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Wd(e,Xu)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let a=this._transitionablePaint,c=a._properties.properties;if(Wd(e,Xu)){let T=e.slice(0,-11);return c[T]&&a.setTransition(T,n||void 0),!1}if(!c[e])return!1;let m=a._values[e],p=m.value.isDataDriven(),b=m.value;a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=a._values[e].value,w=y.isDataDriven(),M=Wd(e,"pattern")||e==="line-dasharray";return w||p||M||this._handleOverridablePaintPropertyUpdate(e,b,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,a){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return pl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof xn&&Yu(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=wr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,a,c,m,p,b,y,w){}queryIntersectsMatchingFeature(e,n,a,c){}}let yf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vc{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $i(i,e=1){let n=0,a=0;return{members:i.map(c=>{let m=yf[c.type].BYTES_PER_ELEMENT,p=n=vC(n,Math.max(e,m)),b=c.components||1;return a=Math.max(a,m),n+=m*b,{name:c.name,type:c.type,components:b,offset:p}}),size:vC(n,Math.max(a,e)),alignment:e}}function vC(i,e){return Math.ceil(i/e)*e}class rs extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.int16[c+0]=n,this.int16[c+1]=a,e}}rs.prototype.bytesPerElement=4,ne(rs,"StructArrayLayout2i4");class U_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let m=3*e;return this.int16[m+0]=n,this.int16[m+1]=a,this.int16[m+2]=c,e}}U_.prototype.bytesPerElement=6,ne(U_,"StructArrayLayout3i6");class jc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=4*e;return this.int16[p+0]=n,this.int16[p+1]=a,this.int16[p+2]=c,this.int16[p+3]=m,e}}jc.prototype.bytesPerElement=8,ne(jc,"StructArrayLayout4i8");class Qy extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=5*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+3]=m,this.int16[b+4]=p,e}}Qy.prototype.bytesPerElement=10,ne(Qy,"StructArrayLayout5i10");class Ky extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=6*e,M=12*e,T=3*e;return this.int16[w+0]=n,this.int16[w+1]=a,this.uint8[M+4]=c,this.uint8[M+5]=m,this.uint8[M+6]=p,this.uint8[M+7]=b,this.float32[T+2]=y,e}}Ky.prototype.bytesPerElement=12,ne(Ky,"StructArrayLayout2i4ub1f12");class Uc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=4*e;return this.float32[p+0]=n,this.float32[p+1]=a,this.float32[p+2]=c,this.float32[p+3]=m,e}}Uc.prototype.bytesPerElement=16,ne(Uc,"StructArrayLayout4f16");class Hc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let m=3*e;return this.float32[m+0]=n,this.float32[m+1]=a,this.float32[m+2]=c,e}}Hc.prototype.bytesPerElement=12,ne(Hc,"StructArrayLayout3f12");class Wc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=6*e,y=3*e;return this.uint16[b+0]=n,this.uint16[b+1]=a,this.uint16[b+2]=c,this.uint16[b+3]=m,this.float32[y+2]=p,e}}Wc.prototype.bytesPerElement=12,ne(Wc,"StructArrayLayout4ui1f12");class H_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=a,this.uint16[p+2]=c,this.uint16[p+3]=m,e}}H_.prototype.bytesPerElement=8,ne(H_,"StructArrayLayout4ui8");class W_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,c,m,p)}emplace(e,n,a,c,m,p,b){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=c,this.int16[y+3]=m,this.int16[y+4]=p,this.int16[y+5]=b,e}}W_.prototype.bytesPerElement=12,ne(W_,"StructArrayLayout6i12");class Jy extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E){let P=this.length;return this.resize(P+1),this.emplace(P,e,n,a,c,m,p,b,y,w,M,T,E)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P){let R=12*e;return this.int16[R+0]=n,this.int16[R+1]=a,this.int16[R+2]=c,this.int16[R+3]=m,this.uint16[R+4]=p,this.uint16[R+5]=b,this.uint16[R+6]=y,this.uint16[R+7]=w,this.int16[R+8]=M,this.int16[R+9]=T,this.int16[R+10]=E,this.int16[R+11]=P,e}}Jy.prototype.bytesPerElement=24,ne(Jy,"StructArrayLayout4i4ui4i24");class ev extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,c,m,p)}emplace(e,n,a,c,m,p,b){let y=10*e,w=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=c,this.float32[w+2]=m,this.float32[w+3]=p,this.float32[w+4]=b,e}}ev.prototype.bytesPerElement=20,ne(ev,"StructArrayLayout3i3f20");class tv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}tv.prototype.bytesPerElement=4,ne(tv,"StructArrayLayout1ul4");class Ch extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Ch.prototype.bytesPerElement=4,ne(Ch,"StructArrayLayout1f4");class Gc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=a,e}}Gc.prototype.bytesPerElement=4,ne(Gc,"StructArrayLayout2ui4");class iv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,a,c,m,p,b,y,w,M,T,E,P)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R){let F=20*e,B=10*e;return this.int16[F+0]=n,this.int16[F+1]=a,this.int16[F+2]=c,this.int16[F+3]=m,this.int16[F+4]=p,this.float32[B+3]=b,this.float32[B+4]=y,this.float32[B+5]=w,this.float32[B+6]=M,this.int16[F+14]=T,this.uint32[B+8]=E,this.uint16[F+18]=P,this.uint16[F+19]=R,e}}iv.prototype.bytesPerElement=40,ne(iv,"StructArrayLayout5i4f1i1ul2ui40");class G_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=8*e;return this.int16[w+0]=n,this.int16[w+1]=a,this.int16[w+2]=c,this.int16[w+4]=m,this.int16[w+5]=p,this.int16[w+6]=b,this.int16[w+7]=y,e}}G_.prototype.bytesPerElement=16,ne(G_,"StructArrayLayout3i2i2i16");class nv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=4*e,y=8*e;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=c,this.int16[y+6]=m,this.int16[y+7]=p,e}}nv.prototype.bytesPerElement=16,ne(nv,"StructArrayLayout2f1f2i16");class rv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=12*e,b=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=a,this.float32[b+1]=c,this.float32[b+2]=m,e}}rv.prototype.bytesPerElement=12,ne(rv,"StructArrayLayout2ub2f12");class kr extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=a,this.uint16[m+2]=c,e}}kr.prototype.bytesPerElement=6,ne(kr,"StructArrayLayout3ui6");class ov extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe){let he=this.length;return this.resize(he+1),this.emplace(he,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he){let ve=30*e,Ce=15*e,De=60*e;return this.int16[ve+0]=n,this.int16[ve+1]=a,this.int16[ve+2]=c,this.float32[Ce+2]=m,this.float32[Ce+3]=p,this.uint16[ve+8]=b,this.uint16[ve+9]=y,this.uint32[Ce+5]=w,this.uint32[Ce+6]=M,this.uint32[Ce+7]=T,this.uint16[ve+16]=E,this.uint16[ve+17]=P,this.uint16[ve+18]=R,this.float32[Ce+10]=F,this.float32[Ce+11]=B,this.uint8[De+48]=W,this.uint8[De+49]=J,this.uint8[De+50]=ee,this.uint32[Ce+13]=te,this.int16[ve+28]=pe,this.uint8[De+58]=he,e}}ov.prototype.bytesPerElement=60,ne(ov,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class av extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he,ve,Ce,De,Ue,ze,$e,ot,We,et,He,tt,ct){let nt=this.length;return this.resize(nt+1),this.emplace(nt,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he,ve,Ce,De,Ue,ze,$e,ot,We,et,He,tt,ct)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he,ve,Ce,De,Ue,ze,$e,ot,We,et,He,tt,ct,nt){let Mt=22*e,at=44*e,ht=88*e;return this.float32[Mt+0]=n,this.float32[Mt+1]=a,this.int16[at+4]=c,this.int16[at+5]=m,this.int16[at+6]=p,this.int16[at+7]=b,this.int16[at+8]=y,this.int16[at+9]=w,this.int16[at+10]=M,this.int16[at+11]=T,this.int16[at+12]=E,this.uint16[at+13]=P,this.uint16[at+14]=R,this.uint16[at+15]=F,this.uint16[at+16]=B,this.uint16[at+17]=W,this.uint16[at+18]=J,this.uint16[at+19]=ee,this.uint16[at+20]=te,this.uint16[at+21]=pe,this.uint16[at+22]=he,this.uint16[at+23]=ve,this.uint16[at+24]=Ce,this.uint16[at+25]=De,this.uint16[at+26]=Ue,this.uint16[at+27]=ze,this.uint32[Mt+14]=$e,this.float32[Mt+15]=ot,this.float32[Mt+16]=We,this.float32[Mt+17]=et,this.float32[Mt+18]=He,this.float32[Mt+19]=tt,this.float32[Mt+20]=ct,this.uint8[ht+84]=nt,e}}av.prototype.bytesPerElement=88,ne(av,"StructArrayLayout2f9i15ui1ul6f1ub88");class Sh extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=5*e;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=c,this.float32[b+3]=m,this.float32[b+4]=p,e}}Sh.prototype.bytesPerElement=20,ne(Sh,"StructArrayLayout5f20");class sv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=7*e;return this.float32[w+0]=n,this.float32[w+1]=a,this.float32[w+2]=c,this.float32[w+3]=m,this.float32[w+4]=p,this.float32[w+5]=b,this.float32[w+6]=y,e}}sv.prototype.bytesPerElement=28,ne(sv,"StructArrayLayout7f28");class Qu extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.float32[c+0]=n,this.float32[c+1]=a,e}}Qu.prototype.bytesPerElement=8,ne(Qu,"StructArrayLayout2f8");class lv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=a,this.uint16[p+3]=c,this.uint16[p+4]=m,e}}lv.prototype.bytesPerElement=12,ne(lv,"StructArrayLayout1ul3ui12");class vf extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}vf.prototype.bytesPerElement=2,ne(vf,"StructArrayLayout1ui2");class cv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B){let W=this.length;return this.resize(W+1),this.emplace(W,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W){let J=16*e;return this.float32[J+0]=n,this.float32[J+1]=a,this.float32[J+2]=c,this.float32[J+3]=m,this.float32[J+4]=p,this.float32[J+5]=b,this.float32[J+6]=y,this.float32[J+7]=w,this.float32[J+8]=M,this.float32[J+9]=T,this.float32[J+10]=E,this.float32[J+11]=P,this.float32[J+12]=R,this.float32[J+13]=F,this.float32[J+14]=B,this.float32[J+15]=W,e}}cv.prototype.bytesPerElement=64,ne(cv,"StructArrayLayout16f64");class q_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=10*e,M=5*e;return this.uint16[w+0]=n,this.uint16[w+1]=a,this.uint16[w+2]=c,this.uint16[w+3]=m,this.float32[M+2]=p,this.float32[M+3]=b,this.float32[M+4]=y,e}}q_.prototype.bytesPerElement=20,ne(q_,"StructArrayLayout4ui3f20");class dv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}dv.prototype.bytesPerElement=2,ne(dv,"StructArrayLayout1i2");class hv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}hv.prototype.bytesPerElement=1,ne(hv,"StructArrayLayout1ub1");class xC extends Vc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}xC.prototype.size=40;class uv extends iv{get(e){return new xC(this,e)}}ne(uv,"CollisionBoxArray");class wC extends Vc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}wC.prototype.size=60;class CC extends ov{get(e){return new wC(this,e)}}ne(CC,"PlacedSymbolArray");class SC extends Vc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}SC.prototype.size=88;class MC extends av{get(e){return new SC(this,e)}}ne(MC,"SymbolInstanceArray");class kC extends Ch{getoffsetX(e){return this.float32[1*e+0]}}ne(kC,"GlyphOffsetArray");class IC extends rs{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ne(IC,"SymbolLineVertexArray");class TC extends Vc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}TC.prototype.size=12;class EC extends lv{get(e){return new TC(this,e)}}ne(EC,"FeatureIndexArray");class DC extends Gc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ne(DC,"FillExtrusionCentroidArray");let zA=$i([{name:"a_pos",components:2,type:"Int16"}],4),BA=$i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Pn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,c){let m=this.segments[this.segments.length-1];return e>Pn.MAX_VERTEX_ARRAY_LENGTH&&Kn(`Max vertices per segment is ${Pn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Pn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}prepareSegment(e,n,a,c){return this._prepareSegment(e,n.length,a.length,c)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,c){return new Pn([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function AC(i,e){return 256*(i=fi(Math.floor(i),0,255))+fi(Math.floor(e),0,255)}Pn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ne(Pn,"SegmentVector");let NA=$i([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),VA=$i([{name:"a_dash",components:4,type:"Uint16"}]);class xf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,c){this.ids.push(PC(e)),this.positions.push(n,a,c)}eachPosition(e,n){let a=PC(e),c=0,m=this.ids.length-1;for(;c<m;){let p=c+m>>1;this.ids[p]>=a?m=p:c=p+1}for(;this.ids[c]===a;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){let a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return mv(a,c,0,a.length-1),n&&(n.add(a.buffer),n.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){let n=new xf,a;n.ids=e.ids,n.positions=e.positions;for(let c of n.ids)c!==a&&n.uniqueIds.push(c),a=c;return n.indexed=!0,n}}function PC(i){let e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Mc(String(i))}function mv(i,e,n,a){for(;n<a;){let c=i[n+a>>1],m=n-1,p=a+1;for(;;){do m++;while(i[m]<c);do p--;while(i[p]>c);if(m>=p)break;$_(i,m,p),$_(e,3*m,3*p),$_(e,3*m+1,3*p+1),$_(e,3*m+2,3*p+2)}p-n<a-p?(mv(i,e,n,p),n=p+1):(mv(i,e,p+1,a),a=p)}}function $_(i,e,n){let a=i[e];i[e]=i[n],i[n]=a}ne(xf,"FeaturePositionMap");class El{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Y_ extends El{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class bo extends El{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Dl extends El{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class pv extends El{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class fv extends El{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class OC extends El{constructor(e){super(e),this.current=Bi.transparent.toRenderColor(null)}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let jA=new Float32Array(16);class wf extends El{constructor(e){super(e),this.current=jA}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let UA=new Float32Array(9),HA=new Float32Array(4);class gv extends El{constructor(e){super(e),this.current=HA}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function _v(i){return[AC(255*i.r,255*i.g),AC(255*i.b,255*i.a)]}class Cf{constructor(e,n,a,c){this.value=e,this.uniformNames=n.map(m=>`u_${m}`),this.type=a,this.context=c}setUniform(e,n,a,c,m){let p=c.constantOr(this.value);n.set(e,m,p instanceof Bi?p.toRenderColor(this.context.lut):p)}getBinding(e,n){return this.type==="color"?new OC(e):new bo(e)}}class Ku{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,c,m){let p=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,m,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new fv(e):new bo(e)}}class Al{constructor(e,n,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,a,c,m,p,b){let y=this.paintVertexArray.length,w=this.expression.evaluate(new Kt(0,{brightness:p}),n,{},m,c,b);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w,this.context)}updatePaintArray(e,n,a,c,m,p,b){let y=this.expression.evaluate({zoom:0,brightness:b},a,c,void 0,m);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,a,c){if(this.type==="color"){let m=_v(a.toRenderColor(c.lut));for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,m[0],m[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class os{constructor(e,n,a,c,m,p){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=a,this.useIntegerZoom=c,this.context=m,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,a,c,m,p,b){let y=this.expression.evaluate(new Kt(this.context.zoom,{brightness:p}),n,{},m,c,b),w=this.expression.evaluate(new Kt(this.context.zoom+1,{brightness:p}),n,{},m,c,b),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,y,w,this.context)}updatePaintArray(e,n,a,c,m,p,b){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:b},a,c,void 0,m),w=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},a,c,void 0,m);this._setPaintValue(e,n,y,w,this.context)}_setPaintValue(e,n,a,c,m){if(this.type==="color"){let p=_v(a.toRenderColor(m.lut)),b=_v(a.toRenderColor(m.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,p[0],p[1],b[0],b[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,c,m){let p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,b=fi(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);n.set(e,m,b)}getBinding(e,n){return new bo(e)}}class qc{constructor(e,n,a,c,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(a==="array"?VA:NA).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new c}populatePaintArray(e,n,a,c){let m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,c,m,p,b){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,n,a,c){if(!c||!a)return;let m=c[a];if(!m)return;let{tl:p,br:b,pixelRatio:y}=m;for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,p[0],p[1],b[0],b[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mh{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[],this.context=n;let c=[];for(let m in e.paint._values){let p=e.paint.get(m);if(!a(m)||!(p instanceof xn&&Yu(p.property.specification)))continue;let b=GA(m,e.type),y=p.value,w=p.property.specification.type,M=!!p.property.useIntegerZoom,T=m==="line-dasharray"||m.endsWith("pattern"),E=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||E)if(y.kind==="source"||E||T){let P=RC(m,w,"source");this.binders[m]=T?new qc(y,b,w,P,e.id):new Al(y,b,w,P),c.push(`/a_${m}`)}else{let P=RC(m,w,"composite");this.binders[m]=new os(y,b,w,M,n,P),c.push(`/z_${m}`)}else this.binders[m]=T?new Ku(y.value,b):new Cf(y.value,b,w,n),c.push(`/u_${m}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Al||n instanceof os?n.maxValue:0}populatePaintArrays(e,n,a,c,m,p,b){for(let y in this.binders){let w=this.binders[y];w.context=this.context,(w instanceof Al||w instanceof os||w instanceof qc)&&w.populatePaintArray(e,n,a,c,m,p,b)}}setConstantPatternPositions(e){for(let n in this.binders){let a=this.binders[n];a instanceof Ku&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,c,m,p,b,y){let w=!1,M=Object.keys(e),T=M.length!==0,E=T?M:n.uniqueIds;this.context.lut=m.lut;for(let P in this.binders){let R=this.binders[P];if(R.context=this.context,(R instanceof Al||R instanceof os||R instanceof qc)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let F=m.paint.get(P);R.expression=F.value;for(let B of E){let W=e[B.toString()];n.eachPosition(B,(J,ee,te)=>{let pe=c.feature(J);R.updatePaintArray(ee,te,pe,W,p,b,y)})}if(!T)for(let B of a.uniqueIds){let W=e[B.toString()];a.eachPosition(B,(J,ee,te)=>{let pe=c.feature(J);R.updatePaintArray(ee,te,pe,W,p,b,y)})}w=!0}}return w}defines(){let e=[];for(let n in this.binders){let a=this.binders[n];(a instanceof Cf||a instanceof Ku)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Al||a instanceof os||a instanceof qc)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Cf||a instanceof Ku||a instanceof os)for(let c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let a in this.binders){let c=this.binders[a];if(c instanceof Cf||c instanceof Ku||c instanceof os)for(let m of c.uniformNames)n.push({name:m,property:a,binding:c.getBinding(e,m)})}return n}setUniforms(e,n,a,c,m){for(let{name:p,property:b,binding:y}of a)this.binders[b].setUniform(e,y,m,c.get(b),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Al||n instanceof os||n instanceof qc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let a=this.binders[n];(a instanceof Al||a instanceof os||a instanceof qc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Al||n instanceof os||n instanceof qc)&&n.destroy()}}}class $c{constructor(e,n,a=()=>!0){this.programConfigurations={};for(let c of e)this.programConfigurations[c.id]=new Mh(c,n,a);this.needsUpload=!1,this._featureMap=new xf,this._featureMapWithoutIds=new xf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,c,m,p,b,y){for(let w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,n,c,m,p,b,y);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,c,m,p){for(let b of a)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,b,c,m,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let WA={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function GA(i,e){return WA[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}let qA={"line-pattern":{source:Wc,composite:Wc},"fill-pattern":{source:Wc,composite:Wc},"fill-extrusion-pattern":{source:Wc,composite:Wc},"line-dasharray":{source:H_,composite:H_}},$A={color:{source:Qu,composite:Uc},number:{source:Ch,composite:Qu}};function RC(i,e,n){let a=qA[i];return a&&a[n]||$A[e][n]}ne(Cf,"ConstantBinder"),ne(Ku,"PatternConstantBinder"),ne(Al,"SourceExpressionBinder"),ne(qc,"PatternCompositeBinder"),ne(os,"CompositeExpressionBinder"),ne(Mh,"ProgramConfiguration",{omit:["_buffers"]}),ne($c,"ProgramConfigurationSet");let yo=gt/Math.PI/2,bv=5,LC=6,YA=16383,Ju=64,yv=[Ju,32,16],Fa=-yo,za=yo;function em(i,e,n,a=yo){return n=Di(n),[i*Math.sin(n)*a,-e*a,i*Math.cos(n)*a]}function kh(i,e,n){return em(Math.cos(Di(i)),Math.sin(Di(i)),e,n)}let tm=63710088e-1,vv=2*Math.PI*tm;class Fi{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fi(ml(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,a=this.lat*n,c=e.lat*n,m=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return tm*Math.acos(Math.min(m,1))}toBounds(e=0){let n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new Yc({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return kh(this.lat,this.lng,yo+e*yo/tm)}static convert(e){if(e instanceof Fi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Fi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Fi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Yc{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof Fi?new Fi(e.lng,e.lat):Fi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Fi?new Fi(e.lng,e.lat):Fi.convert(e),this}extend(e){let n=this._sw,a=this._ne,c,m;if(e instanceof Fi)c=e,m=e;else{if(!(e instanceof Yc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Yc.convert(e)):this.extend(Fi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Fi.convert(e)):this;if(c=e._sw,m=e._ne,!c||!m)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new Fi(c.lng,c.lat),this._ne=new Fi(m.lng,m.lat)),this}getCenter(){return new Fi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Fi(this.getWest(),this.getNorth())}getSouthEast(){return new Fi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:a}=Fi.convert(e),c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return!e||e instanceof Yc?e:new Yc(e)}}var FC={};(function(i,e){(function(n){function a(m,p,b){var y=c(256*m,256*(p=Math.pow(2,b)-p-1),b),w=c(256*(m+1),256*(p+1),b);return y[0]+","+y[1]+","+w[0]+","+w[1]}function c(m,p,b){var y=2*Math.PI*6378137/256/Math.pow(2,b);return[m*y-2*Math.PI*6378137/2,p*y-2*Math.PI*6378137/2]}n.getURL=function(m,p,b,y,w,M){return M=M||{},m+"?"+["bbox="+a(b,y,w),"format="+(M.format||"image/png"),"service="+(M.service||"WMS"),"version="+(M.version||"1.1.1"),"request="+(M.request||"GetMap"),"srs="+(M.srs||"EPSG:3857"),"width="+(M.width||256),"height="+(M.height||256),"layers="+p].join("&")},n.getTileBBox=a,n.getMercCoords=c,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,FC);var ZA=FC;class Ih{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=Sf(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let a=ZA.getTileBBox(this.x,this.y,this.z),c=function(m,p,b){let y,w="";for(let M=m;M>0;M--)y=1<<M-1,w+=(p&y?1:0)+(b&y?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zC{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Sf(e,n.z,n.z,n.x,n.y)}}class _r{constructor(e,n,a,c,m){this.overscaledZ=e,this.wrap=n,this.canonical=new Ih(a,+c,+m),this.key=n===0&&e===a?this.canonical.key:Sf(n,e,a,c,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new _r(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _r(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Sf(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return Sf(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new _r(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new _r(n,this.wrap,n,a,c),new _r(n,this.wrap,n,a+1,c),new _r(n,this.wrap,n,a,c+1),new _r(n,this.wrap,n,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new _r(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new _r(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Sf(i,e,n,a,c){let m=1<<Math.min(n,22),p=m*(c%m)+a%m;return i&&n<22&&(p+=m*m*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}let XA=[i=>{let e=i.canonical.x-1,n=i.wrap;return e<0&&(e=(1<<i.canonical.z)-1,n--),new _r(i.overscaledZ,n,i.canonical.z,e,i.canonical.y)},i=>{let e=i.canonical.x+1,n=i.wrap;return e===1<<i.canonical.z&&(e=0,n++),new _r(i.overscaledZ,n,i.canonical.z,e,i.canonical.y)},i=>new _r(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new _r(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];ne(Ih,"CanonicalTileID"),ne(_r,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let QA=0,KA=25.5;function xv(i){return vv*Math.cos(i*Math.PI/180)}function Us(i){return(180+i)/360}function Hs(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function vo(i,e){return i/xv(e)}function Lo(i){return 360*i-180}function zr(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function BC(i,e){return i*xv(zr(e))}let er=85.051129;function NC(i){return Math.cos(Di(fi(i,-er,er)))}function Th(i,e){let n=fi(e,QA,KA),a=Math.pow(2,n);return NC(i)*vv/(512*a)}function VC(i){return 1/Math.cos(i*Math.PI/180)}function Z_(i,e=0){let n=Math.exp(Math.PI*(1-(i.y+e/gt)/(1<<i.z)*2));return 80150034*n/(n*n+1)/gt/(1<<i.z)}class eo{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){let a=Fi.convert(e);return new eo(Us(a.lng),Hs(a.lat),vo(n,a.lat))}toLngLat(){return new Fi(Lo(this.x),zr(this.y))}toAltitude(){return BC(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vv*VC(zr(this.y))}}function wv(i,e,n,a,c,m,p,b,y){let w=(e+a)/2,M=(n+c)/2,T=new xt(w,M);b(T),function(E,P,R,F,B,W){let J=R-B,ee=F-W;return Math.abs((F-P)*J-(R-E)*ee)/Math.hypot(J,ee)}(T.x,T.y,m.x,m.y,p.x,p.y)>=y?(wv(i,e,n,w,M,m,T,b,y),wv(i,w,M,a,c,T,p,b,y)):i.push(p)}function jC(i,e,n){let a=i[0],c=a.x,m=a.y;e(a);let p=[a];for(let b=1;b<i.length;b++){let y=i[b],{x:w,y:M}=y;e(y),wv(p,c,m,w,M,a,y,e,n),c=w,m=M,a=y}return p}function Cv(i,e,n,a){if(a(e,n)){let c=e.add(n)._mult(.5);Cv(i,e,c,a),Cv(i,c,n,a)}else i.push(n)}function JA(i,e){let n=i[0],a=[n];for(let c=1;c<i.length;c++){let m=i[c];Cv(a,n,m,e),n=m}return a}let Sv=Math.pow(2,14)-1,UC=-Sv-1;function eP(i,e){let n=Math.round(i.x*e),a=Math.round(i.y*e);return i.x=fi(n,UC,Sv),i.y=fi(a,UC,Sv),(n<i.x||n>i.x+1||a<i.y||a>i.y+1)&&Kn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function as(i,e,n){let a=i.loadGeometry(),c=i.extent,m=gt/c;if(e&&n&&n.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:b,x:y,y:w,projection:M}=n,T=E=>{let P=Lo((e.x+E.x/c)/p),R=zr((e.y+E.y/c)/p),F=M.project(P,R);E.x=(F.x*b-y)*c,E.y=(F.y*b-w)*c};for(let E=0;E<a.length;E++)if(i.type!==1)a[E]=jC(a[E],T,1);else{let P=[];for(let R of a[E])R.x<0||R.x>=c||R.y<0||R.y>=c||(T(R),P.push(R));a[E]=P}}for(let p of a)for(let b of p)eP(b,m);return a}function Pl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?as(i):[]}}function X_(i,e,n,a,c){i.emplaceBack(2*e+(a+1)/2,2*n+(c+1)/2)}function Q_(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Mv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new rs,this.indexArray=new kr,this.segments=new Pn,this.programConfigurations=new $c(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,a,c){let m=this.layers[0],p=[],b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(let{feature:w,id:M,index:T,sourceLayerIndex:E}of e){let P=this.layers[0]._featureFilter.needGeometry,R=Pl(w,P);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),R,a))continue;let F=b?b.evaluate(R,{},a):void 0,B={id:M,properties:w.properties,type:w.type,sourceLayerIndex:E,index:T,geometry:P?R.geometry:as(w,a,c),patterns:{},sortKey:F};p.push(B)}b&&p.sort((w,M)=>w.sortKey-M.sortKey);let y=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new W_,y=c.projection);for(let w of p){let{geometry:M,index:T,sourceLayerIndex:E}=w,P=e[T].feature;this.addFeature(w,M,T,n.availableImages,a,y,n.brightness),n.featureIndex.insert(P,M,T,E,this.index)}}update(e,n,a,c,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,BA.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,c,m,p,b){for(let y of n)for(let w of y){let M=w.x,T=w.y;if(M<0||M>=gt||T<0||T>=gt)continue;if(p){let R=p.projectTilePoint(M,T,m),F=p.upVector(m,M,T),B=this.globeExtVertexArray;Q_(B,R,F),Q_(B,R,F),Q_(B,R,F),Q_(B,R,F)}let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=E.vertexLength;X_(this.layoutVertexArray,M,T,-1,-1),X_(this.layoutVertexArray,M,T,1,-1),X_(this.layoutVertexArray,M,T,1,1),X_(this.layoutVertexArray,M,T,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,m,b)}}function kv(i,e){for(let n=0;n<i.length;n++)if(Zc(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Zc(i,e[n]))return!0;return!!Iv(i,e)}function tP(i,e,n){return!!Zc(i,e)||!!Tv(e,i,n)}function HC(i,e){if(i.length===1)return GC(e,i[0]);for(let n=0;n<e.length;n++){let a=e[n];for(let c=0;c<a.length;c++)if(Zc(i,a[c]))return!0}for(let n=0;n<i.length;n++)if(GC(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Iv(i,e[n]))return!0;return!1}function iP(i,e,n){if(i.length>1){if(Iv(i,e))return!0;for(let a=0;a<e.length;a++)if(Tv(e[a],i,n))return!0}for(let a=0;a<i.length;a++)if(Tv(i[a],e,n))return!0;return!1}function Iv(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){let a=i[n],c=i[n+1];for(let m=0;m<e.length-1;m++)if(nP(a,c,e[m],e[m+1]))return!0}return!1}function nP(i,e,n,a){return Aa(i,n,a)!==Aa(e,n,a)&&Aa(i,e,n)!==Aa(i,e,a)}function Tv(i,e,n){let a=n*n;if(e.length===1)return i.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(WC(i,e[c-1],e[c])<a)return!0;return!1}function WC(i,e,n){let a=e.distSqr(n);if(a===0)return i.distSqr(e);let c=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/a;return i.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function GC(i,e){let n,a,c,m=!1;for(let p=0;p<i.length;p++){n=i[p];for(let b=0,y=n.length-1;b<n.length;y=b++)a=n[b],c=n[y],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(m=!m)}return m}function Zc(i,e){let n=!1;for(let a=0,c=i.length-1;a<i.length;c=a++){let m=i[a],p=i[c];m.y>e.y!=p.y>e.y&&e.x<(p.x-m.x)*(e.y-m.y)/(p.y-m.y)+m.x&&(n=!n)}return n}function qC(i,e,n,a,c){for(let p of i)if(e<=p.x&&n<=p.y&&a>=p.x&&c>=p.y)return!0;let m=[new xt(e,n),new xt(e,c),new xt(a,c),new xt(a,n)];if(i.length>2){for(let p of m)if(Zc(i,p))return!0}for(let p=0;p<i.length-1;p++)if(rP(i[p],i[p+1],m))return!0;return!1}function rP(i,e,n){let a=n[0],c=n[2];if(i.x<a.x&&e.x<a.x||i.x>c.x&&e.x>c.x||i.y<a.y&&e.y<a.y||i.y>c.y&&e.y>c.y)return!1;let m=Aa(i,e,n[0]);return m!==Aa(i,e,n[1])||m!==Aa(i,e,n[2])||m!==Aa(i,e,n[3])}function im(i,e,n,a,c,m){let p=e.y-i.y,b=i.x-e.x;if(m=m||0){let y=p*p+b*b;if(y===0)return!0;let w=Math.sqrt(y);p/=w,b/=w}return!((n.x-i.x)*p+(n.y-i.y)*b-m<0||(a.x-i.x)*p+(a.y-i.y)*b-m<0||(c.x-i.x)*p+(c.y-i.y)*b-m<0)}function Ev(i,e,n,a,c,m,p){return!(im(i,e,a,c,m,p)||im(e,n,a,c,m,p)||im(n,i,a,c,m,p)||im(a,c,i,e,n,p)||im(c,m,i,e,n,p)||im(m,a,i,e,n,p))}function nm(i,e,n){let a=e.paint.get(i).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(i)}function K_(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function $C(i,e,n,a,c){if(!e[0]&&!e[1])return i;let m=xt.convert(e)._mult(c);n==="viewport"&&m._rotate(-a);let p=[];for(let b=0;b<i.length;b++)p.push(i[b].sub(m));return p}function YC(i,e,n,a){let c=xt.convert(i)._mult(a);return e==="viewport"&&c._rotate(-n),c}ne(Mv,"CircleBucket",{omit:["layers"]});let oP=new qi({"circle-sort-key":new St(Oe.layout_circle["circle-sort-key"]),visibility:new Ke(Oe.layout_circle.visibility)});var aP={paint:new qi({"circle-radius":new St(Oe.paint_circle["circle-radius"]),"circle-color":new St(Oe.paint_circle["circle-color"]),"circle-blur":new St(Oe.paint_circle["circle-blur"]),"circle-opacity":new St(Oe.paint_circle["circle-opacity"]),"circle-translate":new Ke(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new St(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new St(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new St(Oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ke(Oe.paint_circle["circle-emissive-strength"])}),layout:oP};class Dv{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){let c=t._.dot(n,this.dir);if(Math.abs(c)<1e-6)return!1;let m=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,a[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,n,a){if(t._.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;let[c,m,p]=this.dir,b=this.pos[0]-e[0],y=this.pos[1]-e[1],w=this.pos[2]-e[2],M=c*c+m*m+p*p,T=2*(b*c+y*m+w*p),E=T*T-4*M*(b*b+y*y+w*w-n*n);if(E<0){let P=Math.max(-T/2,0),R=b+c*P,F=y+m*P,B=w+p*P,W=Math.hypot(R,F,B);return a[0]=R*n/W,a[1]=F*n/W,a[2]=B*n/W,!1}{let P=(-T-Math.sqrt(E))/(2*M);if(P<0){let R=Math.hypot(b,y,w);return a[0]=b*n/R,a[1]=y*n/R,a[2]=w*n/R,!1}return a[0]=b+c*P,a[1]=y+m*P,a[2]=w+p*P,!0}}}class Av{constructor(e,n,a,c,m){this.TL=e,this.TR=n,this.BR=a,this.BL=c,this.horizon=m}static fromInvProjectionMatrix(e,n,a){let c=[-1,1,1],m=[1,1,1],p=[1,-1,1],b=[-1,-1,1],y=t._.transformMat4(c,c,e),w=t._.transformMat4(m,m,e),M=t._.transformMat4(p,p,e),T=t._.transformMat4(b,b,e);return new Av(y,w,M,T,n/a)}}function Mf(i,e,n){let a=1/0,c=-1/0,m=[];for(let p of i){t._.sub(m,p,e);let b=t._.dot(m,n);a=Math.min(a,b),c=Math.max(c,b)}return[a,c]}function ZC(i,e){let n=!0;for(let a=0;a<i.planes.length;a++){let c=i.planes[a],m=0;for(let p=0;p<e.length;p++)m+=t._.dot(c,e[p])+c[3]>=0;if(m===0)return 0;m!==e.length&&(n=!1)}return n?2:1}function XC(i,e){for(let n of i.projections){let a=Mf(e,i.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function QC(i,e){let n=0,a=[0,0,0,0];for(let c=0;c<i.length;c++)a[0]=i[c][0],a[1]=i[c][1],a[2]=i[c][2],a[3]=1,t.aA.dot(a,e)>=0&&n++;return n}class Pv{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=On.fromPoints(this.points),this.projections=[],this.frustumEdges=[t._.sub([],this.points[2],this.points[3]),t._.sub([],this.points[0],this.points[3]),t._.sub([],this.points[4],this.points[0]),t._.sub([],this.points[5],this.points[1]),t._.sub([],this.points[6],this.points[2]),t._.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let c=[0,-a[2],a[1]],m=[a[2],0,-a[0]];this.projections.push({axis:c,projection:Mf(this.points,this.points[0],c)}),this.projections.push({axis:m,projection:Mf(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,n,a,c){let m=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let M=t.aA.transformMat4([],w,e),T=1/M[3]/n*m;return t.aA.mul(M,M,[T,T,c?1/M[3]:T,T])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let M=t._.sub([],p[w[0]],p[w[1]]),T=t._.sub([],p[w[2]],p[w[1]]),E=t._.normalize([],t._.cross([],M,T)),P=-t._.dot(E,p[w[1]]);return E.concat(P)}),y=[];for(let w=0;w<p.length;w++)y.push([p[w][0],p[w][1],p[w][2]]);return new Pv(y,b)}intersectsPrecise(e,n,a){for(let c=0;c<n.length;c++)if(!QC(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!QC(e,this.planes[c]))return 0;for(let c of a)for(let m of this.frustumEdges){let p=t._.cross([],c,m),b=t._.length(p);if(b===0)continue;t._.scale(p,p,1/b);let y=Mf(this.points,this.points[0],p),w=Mf(e,this.points[0],p);if(y[0]>w[1]||w[0]>y[1])return 0}return 1}}class On{static fromPoints(e){let n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let c of e)t._.min(n,n,c),t._.max(a,a,c);return new On(n,a)}static fromTileIdAndHeight(e,n,a){let c=1<<e.canonical.z,m=e.canonical.x,p=e.canonical.y;return new On([m/c,p/c,n],[(m+1)/c,(p+1)/c,a])}static applyTransform(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)t._.transformMat4(a[c],a[c],n);return On.fromPoints(a)}static projectAabbCorners(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)t._.transformMat4(a[c],a[c],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=t._.scale([],t._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],a=t._.clone(this.min),c=t._.clone(this.max);for(let m=0;m<n.length;m++)a[m]=n[m]?this.min[m]:this.center[m],c[m]=n[m]?this.center[m]:this.max[m];return c[2]=this.max[2],new On(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?ZC(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?ZC(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?XC(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?XC(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ne(On,"Aabb");let sP=$i([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:J_}=sP,KC=$i([{name:"a_pos_3",components:3,type:"Int16"}]);var kf=$i([{name:"a_pos",type:"Int16",components:2}]);function e0(i){return i*yo/tm}let lP=[new On([Fa,Fa,Fa],[za,za,za]),new On([Fa,Fa,Fa],[0,0,za]),new On([0,Fa,Fa],[za,0,za]),new On([Fa,0,Fa],[0,za,za]),new On([0,0,Fa],[za,za,za])];function JC(i,e,n,a=!0){let c=t._.scale([],i._camera.position,i.worldSize),m=[e,n,1,1];t.aA.transformMat4(m,m,i.pixelMatrixInverse),t.aA.scale(m,m,1/m[3]);let p=t._.sub([],m,c),b=t._.normalize([],p),y=i.globeMatrix,w=[y[12],y[13],y[14]],M=t._.sub([],w,c),T=t._.length(M),E=t._.normalize([],M),P=i.worldSize/(2*Math.PI),R=t._.dot(E,b),F=Math.asin(P/T);if(F<Math.acos(R)){if(!a)return null;let ze=[],$e=[];t._.scale(ze,b,T/R),t._.normalize($e,t._.sub($e,ze,M)),t._.normalize(b,t._.add(b,M,t._.scale(b,$e,Math.tan(F)*T)))}let B=[];new Dv(c,b).closestPointOnSphere(w,P,B);let W=t._.normalize([],$d(y,0)),J=t._.normalize([],$d(y,1)),ee=t._.normalize([],$d(y,2)),te=t._.dot(W,B),pe=t._.dot(J,B),he=t._.dot(ee,B),ve=Gr(Math.asin(-pe/P)),Ce=Gr(Math.atan2(te,he));Ce=i.center.lng+function(ze,$e){let ot=($e-ze+180)%360-180;return ot<-180?ot+360:ot}(i.center.lng,Ce);let De=Us(Ce),Ue=fi(Hs(ve),0,1);return new eo(De,Ue)}class cP{constructor(e,n,a){this.a=t._.sub([],e,a),this.b=t._.sub([],n,a),this.center=a;let c=t._.normalize([],this.a),m=t._.normalize([],this.b);this.angle=Math.acos(t._.dot(c,m))}}function Ov(i,e){if(i.angle===0)return null;let n;return n=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),n<0||n>1?null:function(a,c,m,p){let b=Math.sin(m);return a*(Math.sin((1-p)*m)/b)+c*(Math.sin(p*m)/b)}(i.a[e],i.b[e],i.angle,fi(n,0,1))+i.center[e]}function Ws(i){if(i.z<=1)return lP[i.z+2*i.y+i.x];let e=Rv(t0(i));return On.fromPoints(e)}function Ol(i,e,n){return t._.scale(i,i,1-n),t._.scaleAndAdd(i,i,e,n)}function e2(i,e){let n=Rl(e.zoom);if(n===0)return Ws(i);let a=t0(i),c=Rv(a),m=Us(a.getWest())*e.worldSize,p=Us(a.getEast())*e.worldSize,b=Hs(a.getNorth())*e.worldSize,y=Hs(a.getSouth())*e.worldSize,w=[m,b,0],M=[p,b,0],T=[m,y,0],E=[p,y,0],P=t.ad.invert([],e.globeMatrix);return t._.transformMat4(w,w,P),t._.transformMat4(M,M,P),t._.transformMat4(T,T,P),t._.transformMat4(E,E,P),c[0]=Ol(c[0],T,n),c[1]=Ol(c[1],E,n),c[2]=Ol(c[2],M,n),c[3]=Ol(c[3],w,n),On.fromPoints(c)}function t2(i,e,n){for(let a of i)t._.transformMat4(a,a,e),t._.scale(a,a,n)}function i2(i,e,n,a){let c=e/i.worldSize,m=i.globeMatrix;if(n.z<=1){let De=Ws(n).getCorners();return t2(De,m,c),On.fromPoints(De)}let p=t0(n,a),b=Rv(p,yo+e0(i._tileCoverLift));t2(b,m,c);let y=Number.MAX_VALUE,w=[-y,-y,-y],M=[y,y,y];if(p.contains(i.center)){for(let ze of b)t._.min(M,M,ze),t._.max(w,w,ze);w[2]=0;let De=i.point,Ue=[De.x*c,De.y*c,0];return t._.min(M,M,Ue),t._.max(w,w,Ue),new On(M,w)}if(i._tileCoverLift>0){for(let De of b)t._.min(M,M,De),t._.max(w,w,De);return new On(M,w)}let T=[m[12]*c,m[13]*c,m[14]*c],E=p.getCenter(),P=fi(i.center.lat,-er,er),R=fi(E.lat,-er,er),F=Us(i.center.lng),B=Hs(P),W=F-Us(E.lng),J=B-Hs(R);W>.5?W-=1:W<-.5&&(W+=1);let ee=0;if(Math.abs(W)>Math.abs(J))ee=W>=0?1:3;else{ee=J>=0?0:2;let De=[m[4]*c,m[5]*c,m[6]*c],Ue=-Math.sin(Di(J>=0?p.getSouth():p.getNorth()))*yo;t._.scaleAndAdd(T,T,De,Ue)}let te=b[ee],pe=b[(ee+1)%4],he=new cP(te,pe,T),ve=[Ov(he,0)||te[0],Ov(he,1)||te[1],Ov(he,2)||te[2]],Ce=Rl(i.zoom);if(Ce>0){let De=function({x:ze,y:$e,z:ot},We,et,He,tt){let ct=1/(1<<ot),nt=ze*ct,Mt=nt+ct,at=$e*ct,ht=at+ct,Vt=0,Lt=(nt+Mt)/2-He;return Lt>.5?Vt=-1:Lt<-.5&&(Vt=1),nt=((nt+Vt)*We-(He*=We))*et+He,Mt=((Mt+Vt)*We-He)*et+He,at=(at*We-(tt*=We))*et+tt,ht=(ht*We-tt)*et+tt,[[nt,ht,0],[Mt,ht,0],[Mt,at,0],[nt,at,0]]}(n,e,i._pixelsPerMercatorPixel,F,B);for(let ze=0;ze<b.length;ze++)Ol(b[ze],De[ze],Ce);let Ue=t._.add([],De[ee],De[(ee+1)%4]);t._.scale(Ue,Ue,.5),Ol(ve,Ue,Ce)}for(let De of b)t._.min(M,M,De),t._.max(w,w,De);return M[2]=Math.min(te[2],pe[2]),t._.min(M,M,ve),t._.max(w,w,ve),new On(M,w)}function t0({x:i,y:e,z:n},a=!1){let c=1/(1<<n),m=new Fi(Lo(i*c),e===(1<<n)-1&&a?-90:zr((e+1)*c)),p=new Fi(Lo((i+1)*c),e===0&&a?90:zr(e*c));return new Yc(m,p)}function Rv(i,e=yo){let n=Di(i.getNorth()),a=Di(i.getSouth()),c=Math.cos(n),m=Math.cos(a),p=Math.sin(n),b=Math.sin(a),y=i.getWest(),w=i.getEast();return[em(m,b,y,e),em(m,b,w,e),em(c,p,w,e),em(c,p,y,e)]}function If(i,e,n,a){let c=1<<n.z,m=(i/gt+n.x)/c;return kh(zr((e/gt+n.y)/c),Lo(m),a)}function i0({min:i,max:e}){return YA/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}let n2=new Float64Array(16);function Tf(i){let e=i0(i),n=t.ad.fromScaling(n2,[e,e,e]);return t.ad.translate(n,n,t._.negate([],i.min))}function Lv(i){let e=t.ad.fromTranslation(n2,i.min),n=1/i0(i);return t.ad.scale(e,e,[n,n,n])}function Fv(i){let e=gt/(2*Math.PI);return i/(2*Math.PI)/e}function r2(i,e){return gt/(512*Math.pow(2,i))*i0(Ws(e))}function o2(i,e,n,a,c){let m=Fv(n),p=[i,e,-n/(2*Math.PI)],b=t.ad.identity(new Float64Array(16));return t.ad.translate(b,b,p),t.ad.scale(b,b,[m,m,m]),t.ad.rotateX(b,b,Di(-c)),t.ad.rotateY(b,b,Di(-a)),b}function Rl(i){return ul(bv,LC,i)}function a2(i,e){let n=kh(e.lat,e.lng),a=function(m){let p=kh(m._center.lat,m._center.lng),b=t._.fromValues(0,1,0),y=t._.cross([],b,p),w=t.ad.fromRotation([],-m.angle,p);y=t._.transformMat4(y,y,w),t.ad.fromRotation(w,-m._pitch,y);let M=t._.normalize([],p);return t._.scale(M,M,e0(m.cameraToCenterDistance/m.pixelsPerMeter)),t._.transformMat4(M,M,w),t._.add([],p,M)}(i),c=t._.subtract([],a,n);return t._.angle(c,n)}function zv(i,e){return a2(i,e)>Math.PI/2*1.01}let s2=Di(85),dP=Math.cos(s2),hP=Math.sin(s2),uP=t.ad.create(),l2=i=>{let e=[];return i.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function c2(i,e,n,a,c,m,p,b,y){if(m&&i.queryGeometry.isAboveHorizon)return!1;m&&(y*=i.pixelToTileUnitsFactor);let w=i.tileID.canonical,M=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(let T of e)for(let E of T){let P=E.add(b),R=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(P.x,P.y,!0):0,F=n.projection.projectTilePoint(P.x,P.y,w);if(R>0){let ee=n.projection.upVector(w,P.x,P.y);F.x+=ee[0]*M*R,F.y+=ee[1]*M*R,F.z+=ee[2]*M*R}let B=m?P:mP(F.x,F.y,F.z,a),W=m?i.tilespaceRays.map(ee=>fP(ee,R)):i.queryGeometry.screenGeometry,J=t.aA.transformMat4([],[F.x,F.y,F.z,1],a);if(!p&&m?y*=J[3]/n.cameraToCenterDistance:p&&!m&&(y*=n.cameraToCenterDistance/J[3]),m){let ee=zr((E.y/gt+w.y)/(1<<w.z));y/=n.projection.pixelsPerMeter(ee,1)/vo(1,ee)}if(tP(W,B,y))return!0}return!1}function mP(i,e,n,a){let c=t.aA.transformMat4([],[i,e,n,1],a);return new xt(c[0]/c[3],c[1]/c[3])}let d2=t._.fromValues(0,0,0),pP=t._.fromValues(0,0,1);function fP(i,e){let n=t._.create();return d2[2]=e,i.intersectsPlane(d2,pP,n),new xt(n[0],n[1])}class h2 extends Mv{}function u2(i,{width:e,height:n},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*a);return i.width=e,i.height=n,i.data=c,i}function m2(i,e,n){let{width:a,height:c}=e;a===i.width&&c===i.height||(Bv(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,a),height:Math.min(i.height,c)},n,null),i.width=a,i.height=c,i.data=e.data)}function Bv(i,e,n,a,c,m,p,b){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||n.x>i.width-c.width||n.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let y=i.data,w=e.data,M=m===4&&b;for(let T=0;T<c.height;T++){let E=((n.y+T)*i.width+n.x)*m,P=((a.y+T)*e.width+a.x)*m;if(M)for(let R=0;R<c.width;R++){let F=E+R*m+3,B=P+R*m;w[B+0]=255,w[B+1]=255,w[B+2]=255,w[B+3]=y[F]}else if(p)for(let R=0;R<c.width;R++){let F=E+R*m,B=P+R*m,W=y[F+3],J=new Bi(y[F+0]/255*W,y[F+1]/255*W,y[F+2]/255*W,W).toRenderColor(p).toArray();w[B+0]=J[0],w[B+1]=J[1],w[B+2]=J[2],w[B+3]=J[3]}else for(let R=0;R<c.width*m;R++)w[P+R]=y[E+R]}return e}ne(h2,"HeatmapBucket",{omit:["layers"]});class Xc{constructor(e,n){u2(this,e,1,n)}resize(e){m2(this,new Xc(e),1)}clone(){return new Xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,m){Bv(e,n,a,c,m,1,null)}}class ga{constructor(e,n){u2(this,e,4,n)}resize(e){m2(this,new ga(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ga({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,m,p,b){Bv(e,n,a,c,m,4,p,b)}}class p2{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}ne(Xc,"AlphaImage"),ne(ga,"RGBAImage");let gP=new qi({visibility:new Ke(Oe.layout_heatmap.visibility)});var _P={paint:new qi({"heatmap-radius":new St(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new St(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new An(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(Oe.paint_heatmap["heatmap-opacity"])}),layout:gP};function Ef(i){let e={},n=i.resolution||256,a=i.clips?i.clips.length:1,c=i.image||new ga({width:n,height:a}),m=(p,b,y)=>{e[i.evaluationKey]=y;let w=i.expression.evaluate(e);w&&(c.data[p+b+0]=Math.floor(255*w.r/w.a),c.data[p+b+1]=Math.floor(255*w.g/w.a),c.data[p+b+2]=Math.floor(255*w.b/w.a),c.data[p+b+3]=Math.floor(255*w.a))};if(i.clips)for(let p=0,b=0;p<a;++p,b+=4*n)for(let y=0,w=0;y<n;y++,w+=4){let M=y/(n-1),{start:T,end:E}=i.clips[p];m(b,w,T*(1-M)+E*M)}else for(let p=0,b=0;p<n;p++,b+=4)m(0,b,p/(n-1));return c}let bP=new qi({visibility:new Ke(Oe.layout_hillshade.visibility)});var yP={paint:new qi({"hillshade-illumination-direction":new Ke(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ke(Oe.paint_hillshade["hillshade-emissive-strength"])}),layout:bP};let vP=$i([{name:"a_pos",components:2,type:"Int16"}],4),{members:xP}=vP;function Df(i,e,n=2){let a=e&&e.length,c=a?e[0]*n:i.length,m=f2(i,0,c,n,!0),p=[];if(!m||m.next===m.prev)return p;let b,y,w;if(a&&(m=function(M,T,E,P){let R=[];for(let F=0,B=T.length;F<B;F++){let W=f2(M,T[F]*P,F<B-1?T[F+1]*P:M.length,P,!1);W===W.next&&(W.steiner=!0),R.push(EP(W))}R.sort(kP);for(let F=0;F<R.length;F++)E=IP(R[F],E);return E}(i,e,m,n)),i.length>80*n){b=1/0,y=1/0;let M=-1/0,T=-1/0;for(let E=n;E<c;E+=n){let P=i[E],R=i[E+1];P<b&&(b=P),R<y&&(y=R),P>M&&(M=P),R>T&&(T=R)}w=Math.max(M-b,T-y),w=w!==0?32767/w:0}return Af(m,p,n,b,y,w,0),p}function f2(i,e,n,a,c){let m;if(c===function(p,b,y,w){let M=0;for(let T=b,E=y-w;T<y;T+=w)M+=(p[E]-p[T])*(p[T+1]+p[E+1]),E=T;return M}(i,e,n,a)>0)for(let p=e;p<n;p+=a)m=b2(p/a|0,i[p],i[p+1],m);else for(let p=n-a;p>=e;p-=a)m=b2(p/a|0,i[p],i[p+1],m);return m&&n0(m,m.next)&&(Of(m),m=m.next),m}function Eh(i,e){if(!i)return i;e||(e=i);let n,a=i;do if(n=!1,a.steiner||!n0(a,a.next)&&br(a.prev,a,a.next)!==0)a=a.next;else{if(Of(a),a=e=a.prev,a===a.next)break;n=!0}while(n||a!==e);return e}function Af(i,e,n,a,c,m,p){if(!i)return;!p&&m&&function(y,w,M,T){let E=y;do E.z===0&&(E.z=Nv(E.x,E.y,w,M,T)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==y);E.prevZ.nextZ=null,E.prevZ=null,function(P){let R,F=1;do{let B,W=P;P=null;let J=null;for(R=0;W;){R++;let ee=W,te=0;for(let he=0;he<F&&(te++,ee=ee.nextZ,ee);he++);let pe=F;for(;te>0||pe>0&&ee;)te!==0&&(pe===0||!ee||W.z<=ee.z)?(B=W,W=W.nextZ,te--):(B=ee,ee=ee.nextZ,pe--),J?J.nextZ=B:P=B,B.prevZ=J,J=B;W=ee}J.nextZ=null,F*=2}while(R>1)}(E)}(i,a,c,m);let b=i;for(;i.prev!==i.next;){let y=i.prev,w=i.next;if(m?CP(i,a,c,m):wP(i))e.push(y.i,i.i,w.i),Of(i),i=w.next,b=w.next;else if((i=w)===b){p?p===1?Af(i=SP(Eh(i),e),e,n,a,c,m,2):p===2&&MP(i,e,n,a,c,m):Af(Eh(i),e,n,a,c,m,1);break}}}function wP(i){let e=i.prev,n=i,a=i.next;if(br(e,n,a)>=0)return!1;let c=e.x,m=n.x,p=a.x,b=e.y,y=n.y,w=a.y,M=c<m?c<p?c:p:m<p?m:p,T=b<y?b<w?b:w:y<w?y:w,E=c>m?c>p?c:p:m>p?m:p,P=b>y?b>w?b:w:y>w?y:w,R=a.next;for(;R!==e;){if(R.x>=M&&R.x<=E&&R.y>=T&&R.y<=P&&rm(c,b,m,y,p,w,R.x,R.y)&&br(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function CP(i,e,n,a){let c=i.prev,m=i,p=i.next;if(br(c,m,p)>=0)return!1;let b=c.x,y=m.x,w=p.x,M=c.y,T=m.y,E=p.y,P=b<y?b<w?b:w:y<w?y:w,R=M<T?M<E?M:E:T<E?T:E,F=b>y?b>w?b:w:y>w?y:w,B=M>T?M>E?M:E:T>E?T:E,W=Nv(P,R,e,n,a),J=Nv(F,B,e,n,a),ee=i.prevZ,te=i.nextZ;for(;ee&&ee.z>=W&&te&&te.z<=J;){if(ee.x>=P&&ee.x<=F&&ee.y>=R&&ee.y<=B&&ee!==c&&ee!==p&&rm(b,M,y,T,w,E,ee.x,ee.y)&&br(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,te.x>=P&&te.x<=F&&te.y>=R&&te.y<=B&&te!==c&&te!==p&&rm(b,M,y,T,w,E,te.x,te.y)&&br(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;ee&&ee.z>=W;){if(ee.x>=P&&ee.x<=F&&ee.y>=R&&ee.y<=B&&ee!==c&&ee!==p&&rm(b,M,y,T,w,E,ee.x,ee.y)&&br(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;te&&te.z<=J;){if(te.x>=P&&te.x<=F&&te.y>=R&&te.y<=B&&te!==c&&te!==p&&rm(b,M,y,T,w,E,te.x,te.y)&&br(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function SP(i,e){let n=i;do{let a=n.prev,c=n.next.next;!n0(a,c)&&g2(a,n,n.next,c)&&Pf(a,c)&&Pf(c,a)&&(e.push(a.i,n.i,c.i),Of(n),Of(n.next),n=i=c),n=n.next}while(n!==i);return Eh(n)}function MP(i,e,n,a,c,m){let p=i;do{let b=p.next.next;for(;b!==p.prev;){if(p.i!==b.i&&DP(p,b)){let y=_2(p,b);return p=Eh(p,p.next),y=Eh(y,y.next),Af(p,e,n,a,c,m,0),void Af(y,e,n,a,c,m,0)}b=b.next}p=p.next}while(p!==i)}function kP(i,e){return i.x-e.x}function IP(i,e){let n=function(c,m){let p=m,b=c.x,y=c.y,w,M=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){let F=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=b&&F>M&&(M=F,w=p.x<p.next.x?p:p.next,F===b))return w}p=p.next}while(p!==m);if(!w)return null;let T=w,E=w.x,P=w.y,R=1/0;p=w;do{if(b>=p.x&&p.x>=E&&b!==p.x&&rm(y<P?b:M,y,E,P,y<P?M:b,y,p.x,p.y)){let F=Math.abs(y-p.y)/(b-p.x);Pf(p,c)&&(F<R||F===R&&(p.x>w.x||p.x===w.x&&TP(w,p)))&&(w=p,R=F)}p=p.next}while(p!==T);return w}(i,e);if(!n)return e;let a=_2(n,i);return Eh(a,a.next),Eh(n,n.next)}function TP(i,e){return br(i.prev,i,e.prev)<0&&br(e.next,i,i.next)<0}function Nv(i,e,n,a,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function EP(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function rm(i,e,n,a,c,m,p,b){return(c-p)*(e-b)>=(i-p)*(m-b)&&(i-p)*(a-b)>=(n-p)*(e-b)&&(n-p)*(m-b)>=(c-p)*(a-b)}function DP(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,a){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==a.i&&c.next.i!==a.i&&g2(c,c.next,n,a))return!0;c=c.next}while(c!==n);return!1}(i,e)&&(Pf(i,e)&&Pf(e,i)&&function(n,a){let c=n,m=!1,p=(n.x+a.x)/2,b=(n.y+a.y)/2;do c.y>b!=c.next.y>b&&c.next.y!==c.y&&p<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(i,e)&&(br(i.prev,i,e.prev)||br(i,e.prev,e))||n0(i,e)&&br(i.prev,i,i.next)>0&&br(e.prev,e,e.next)>0)}function br(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function n0(i,e){return i.x===e.x&&i.y===e.y}function g2(i,e,n,a){let c=o0(br(i,e,n)),m=o0(br(i,e,a)),p=o0(br(n,a,i)),b=o0(br(n,a,e));return c!==m&&p!==b||!(c!==0||!r0(i,n,e))||!(m!==0||!r0(i,a,e))||!(p!==0||!r0(n,i,a))||!(b!==0||!r0(n,e,a))}function r0(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function o0(i){return i>0?1:i<0?-1:0}function Pf(i,e){return br(i.prev,i,i.next)<0?br(i,e,i.next)>=0&&br(i,i.prev,e)>=0:br(i,e,i.prev)<0||br(i,i.next,e)<0}function _2(i,e){let n=Vv(i.i,i.x,i.y),a=Vv(e.i,e.x,e.y),c=i.next,m=e.prev;return i.next=e,e.prev=i,n.next=c,c.prev=n,a.next=n,n.prev=a,m.next=a,a.prev=m,a}function b2(i,e,n,a){let c=Vv(i,e,n);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Of(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Vv(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function a0(i,e){let n=i.length;if(n<=1)return[i];let a=[],c,m;for(let p=0;p<n;p++){let b=Qr(i[p]);b!==0&&(i[p].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(c&&a.push(c),c=[i[p]]):c.push(i[p]))}if(c&&a.push(c),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(By(a[p],e,1,a[p].length-1,AP),a[p]=a[p].slice(0,e));return a}function AP(i,e){return e.area-i.area}function jv(i,e,n){let a=n.patternDependencies,c=!1;for(let m of e){let p=m.paint.get(`${i}-pattern`);p.isConstant()||(c=!0);let b=p.constantOr(null);b&&(c=!0,a[b]=!0)}return c}function Uv(i,e,n,a,c){let m=c.patternDependencies;for(let p of e){let b=p.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let y=b.evaluate({zoom:a},n,{},c.availableImages);y=y&&y.name?y.name:y,m[y]=!0,n.patterns[p.id]=y}}return n}class s0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rs,this.indexArray=new kr,this.indexArray2=new Gc,this.programConfigurations=new $c(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Pn,this.segments2=new Pn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,a,c){this.hasPattern=jv("fill",this.layers,n);let m=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:b,id:y,index:w,sourceLayerIndex:M}of e){let T=this.layers[0]._featureFilter.needGeometry,E=Pl(b,T);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),E,a))continue;let P=m?m.evaluate(E,{},a,n.availableImages):void 0,R={id:y,properties:b.properties,type:b.type,sourceLayerIndex:M,index:w,geometry:T?E.geometry:as(b,a,c),patterns:{},sortKey:P};p.push(R)}m&&p.sort((b,y)=>b.sortKey-y.sortKey);for(let b of p){let{geometry:y,index:w,sourceLayerIndex:M}=b;if(this.hasPattern){let T=Uv("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(T)}else this.addFeature(b,y,w,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[w].feature,y,w,M,this.index)}}update(e,n,a,c,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,c,m)}addFeatures(e,n,a,c,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,a,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,c,m,p=[],b){for(let y of a0(n,500)){let w=0;for(let F of y)w+=F.length;let M=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),T=M.vertexLength,E=[],P=[];for(let F of y){if(F.length===0)continue;F!==y[0]&&P.push(E.length/2);let B=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),W=B.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(W+F.length-1,W),E.push(F[0].x),E.push(F[0].y);for(let J=1;J<F.length;J++)this.layoutVertexArray.emplaceBack(F[J].x,F[J].y),this.indexArray2.emplaceBack(W+J-1,W+J),E.push(F[J].x),E.push(F[J].y);B.vertexLength+=F.length,B.primitiveLength+=F.length}let R=Df(E,P);for(let F=0;F<R.length;F+=3)this.indexArray.emplaceBack(T+R[F],T+R[F+1],T+R[F+2]);M.vertexLength+=w,M.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,p,c,b)}}ne(s0,"FillBucket",{omit:["layers","patternFeatures"]});let PP=new qi({"fill-sort-key":new St(Oe.layout_fill["fill-sort-key"]),visibility:new Ke(Oe.layout_fill.visibility)});var OP={paint:new qi({"fill-antialias":new Ke(Oe.paint_fill["fill-antialias"]),"fill-opacity":new St(Oe.paint_fill["fill-opacity"]),"fill-color":new St(Oe.paint_fill["fill-color"]),"fill-outline-color":new St(Oe.paint_fill["fill-outline-color"]),"fill-translate":new Ke(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new St(Oe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ke(Oe.paint_fill["fill-emissive-strength"])}),layout:PP};class Hv{constructor(e,n,a,c){if(this.triangleCount=n.length/3,this.min=new xt(0,0),this.max=new xt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[m,p]=[e[0].clone(),e[0].clone()];for(let T=1;T<e.length;++T){let E=e[T];m.x=Math.min(m.x,E.x),m.y=Math.min(m.y,E.y),p.x=Math.max(p.x,E.x),p.y=Math.max(p.y,E.y)}if(c){let T=Math.ceil(Math.max(p.x-m.x,p.y-m.y)/c);a=Math.max(a,T)}if(a===0)return;this.min=m,this.max=p;let b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);let y=Math.max(b.x,b.y)/a;this.cellsX=Math.max(1,Math.ceil(b.x/y)),this.cellsY=Math.max(1,Math.ceil(b.y/y)),this.xScale=1/y,this.yScale=1/y;let w=[];for(let T=0;T<this.triangleCount;T++){let E=e[n[3*T+0]].sub(this.min),P=e[n[3*T+1]].sub(this.min),R=e[n[3*T+2]].sub(this.min),F=Gs(Math.floor(Math.min(E.x,P.x,R.x)),this.xScale,this.cellsX),B=Gs(Math.floor(Math.max(E.x,P.x,R.x)),this.xScale,this.cellsX),W=Gs(Math.floor(Math.min(E.y,P.y,R.y)),this.yScale,this.cellsY),J=Gs(Math.floor(Math.max(E.y,P.y,R.y)),this.yScale,this.cellsY),ee=new xt(0,0),te=new xt(0,0),pe=new xt(0,0),he=new xt(0,0);for(let ve=W;ve<=J;++ve){ee.y=te.y=ve*y,pe.y=he.y=(ve+1)*y;for(let Ce=F;Ce<=B;++Ce)ee.x=pe.x=Ce*y,te.x=he.x=(Ce+1)*y,(Ev(E,P,R,ee,te,he)||Ev(E,P,R,ee,he,pe))&&w.push({cellIdx:ve*this.cellsX+Ce,triIdx:T})}}if(w.length===0)return;w.sort((T,E)=>T.cellIdx-E.cellIdx||T.triIdx-E.triIdx);let M=0;for(;M<w.length;){let T=w[M].cellIdx,E={start:this.payload.length,len:0};for(;M<w.length&&w[M].cellIdx===T;)++E.len,this.payload.push(w[M++].triIdx);this.cells[T]=E}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let a=Gs(e.x-this.min.x,this.xScale,this.cellsX),c=Gs(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[c*this.cellsX+a];if(m){this._lazyInitLookup();for(let p=0;p<m.len;p++){let b=this.payload[m.start+p],y=Math.floor(b/8),w=1<<b%8;if(!(this.lookup[y]&w)&&(this.lookup[y]|=w,n.push(b),n.length===this.triangleCount))return}}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let c=Gs(e.x-this.min.x,this.xScale,this.cellsX),m=Gs(n.x-this.min.x,this.xScale,this.cellsX),p=Gs(e.y-this.min.y,this.yScale,this.cellsY),b=Gs(n.y-this.min.y,this.yScale,this.cellsY);for(let y=p;y<=b;y++)for(let w=c;w<=m;w++){let M=this.cells[y*this.cellsX+w];if(M)for(let T=0;T<M.len;T++){let E=this.payload[M.start+T],P=Math.floor(E/8),R=1<<E%8;if(!(this.lookup[P]&R)&&(this.lookup[P]|=R,a.push(E),a.length===this.triangleCount))return}}}}function Gs(i,e,n){return Math.max(0,Math.min(n-1,Math.floor(i*e)))}ne(Hv,"TriangleGridIndex");class y2{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let a of this.footprints)n.push({footprint:a,id:e})}populate(e,n,a,c){let m=[];for(let{feature:p,id:b,index:y,sourceLayerIndex:w}of e){let M=this.layers[0]._featureFilter.needGeometry,T=Pl(p,M);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),T,a))continue;let E={id:b,properties:p.properties,type:p.type,sourceLayerIndex:w,index:y,geometry:M?T.geometry:as(p,a,c),patterns:{}};m.push(E)}for(let p of m){let{geometry:b,index:y,sourceLayerIndex:w}=p;this.addFeature(p,b,y,a,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,b,y,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,a,c,m){}destroy(){}addFeature(e,n,a,c,m,p=[],b){for(let y of a0(n,2)){let w=[],M=[],T=[],E=new xt(1/0,1/0),P=new xt(-1/0,-1/0);for(let B of y)if(B.length!==0){B!==y[0]&&T.push(M.length/2);for(let W=0;W<B.length;W++)M.push(B[W].x),M.push(B[W].y),w.push(B[W]),E.x=Math.min(E.x,B[W].x),E.y=Math.min(E.y,B[W].y),P.x=Math.max(P.x,B[W].x),P.y=Math.max(P.y,B[W].y)}let R=Df(M,T),F=new Hv(w,R,8,256);this.footprints.push({vertices:w,indices:R,grid:F,min:E,max:P})}}}ne(y2,"ClipBucket",{omit:["layers"]});let RP=new qi({"clip-layer-types":new Ke(Oe.layout_clip["clip-layer-types"])});var LP={paint:new qi({}),layout:RP};let FP=$i([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zP=$i([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),BP=$i([{name:"a_centroid_pos",components:2,type:"Uint16"}]),NP=$i([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),VP=$i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:jP}=FP;var l0={},UP=uu,v2=om;function om(i,e,n,a,c){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=c,i.readFields(HP,this,e)}function HP(i,e,n){i==1?e.id=n.readVarint():i==2?function(a,c){for(var m=a.readVarint()+a.pos;a.pos<m;){var p=c._keys[a.readVarint()],b=c._values[a.readVarint()];c.properties[p]=b}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function WP(i){for(var e,n,a=0,c=0,m=i.length,p=m-1;c<m;p=c++)a+=((n=i[p]).x-(e=i[c]).x)*(e.y+n.y);return a}om.types=["Unknown","Point","LineString","Polygon"],om.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,a=1,c=0,m=0,p=0,b=[];i.pos<n;){if(c<=0){var y=i.readVarint();a=7&y,c=y>>3}if(c--,a===1||a===2)m+=i.readSVarint(),p+=i.readSVarint(),a===1&&(e&&b.push(e),e=[]),e.push(new UP(m,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&b.push(e),b},om.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,a=0,c=0,m=0,p=1/0,b=-1/0,y=1/0,w=-1/0;i.pos<e;){if(a<=0){var M=i.readVarint();n=7&M,a=M>>3}if(a--,n===1||n===2)(c+=i.readSVarint())<p&&(p=c),c>b&&(b=c),(m+=i.readSVarint())<y&&(y=m),m>w&&(w=m);else if(n!==7)throw new Error("unknown command "+n)}return[p,y,b,w]},om.prototype.toGeoJSON=function(i,e,n){var a,c,m=this.extent*Math.pow(2,n),p=this.extent*i,b=this.extent*e,y=this.loadGeometry(),w=om.types[this.type];function M(P){for(var R=0;R<P.length;R++){var F=P[R];P[R]=[360*(F.x+p)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(a=0;a<y.length;a++)T[a]=y[a][0];M(y=T);break;case 2:for(a=0;a<y.length;a++)M(y[a]);break;case 3:for(y=function(P){var R=P.length;if(R<=1)return[P];for(var F,B,W=[],J=0;J<R;J++){var ee=WP(P[J]);ee!==0&&(B===void 0&&(B=ee<0),B===ee<0?(F&&W.push(F),F=[P[J]]):F.push(P[J]))}return F&&W.push(F),W}(y),a=0;a<y.length;a++)for(c=0;c<y[a].length;c++)M(y[a][c])}y.length===1?y=y[0]:w="Multi"+w;var E={type:"Feature",geometry:{type:w,coordinates:y},properties:this.properties};return"id"in this&&(E.id=this.id),E};var GP=v2,x2=w2;function w2(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(qP,this,e),this.length=this._features.length}function qP(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(a){for(var c=null,m=a.readVarint()+a.pos;a.pos<m;){var p=a.readVarint()>>3;c=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return c}(n))}w2.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new GP(this._pbf,e,this.extent,this._keys,this._values)};var $P=x2;function YP(i,e,n){if(i===3){var a=new $P(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var Wv=l0.VectorTile=function(i,e){this.layers=i.readFields(YP,{},e)},c0=l0.VectorTileFeature=v2;l0.VectorTileLayer=x2;class Dh extends xt{constructor(e,n,a){super(e,n),this.z=a}}class C2 extends Dh{constructor(e,n,a,c){super(e,n,a),this.w=c}}function d0(i,e,n,a){let c=[],m=a===0?(p,b,y,w,M,T)=>{p.push(new xt(T,y+(T-b)/(w-b)*(M-y)))}:(p,b,y,w,M,T)=>{p.push(new xt(b+(T-y)/(M-y)*(w-b),T))};for(let p of i){let b=[];for(let y of p){if(y.length<=2)continue;let w=[];for(let E=0;E<y.length-1;E++){let P=y[E].x,R=y[E].y,F=y[E+1].x,B=y[E+1].y,W=a===0?P:R,J=a===0?F:B;W<e?J>e&&m(w,P,R,F,B,e):W>n?J<n&&m(w,P,R,F,B,n):w.push(y[E]),J<e&&W>=e&&m(w,P,R,F,B,e),J>n&&W<=n&&m(w,P,R,F,B,n)}let M=y[y.length-1],T=a===0?M.x:M.y;T>=e&&T<=n&&w.push(M),w.length&&(M=w[w.length-1],w[0].x===M.x&&w[0].y===M.y||w.push(w[0]),b.push(w))}b.length&&c.push(b)}return c}function S2(i,e,n,a){let c=n==="x"?"y":"x",m=(a-i[n])/(e[n]-i[n]);i[c]=i[c]+(e[c]-i[c])*m,i[n]=a,i.hasOwnProperty("z")&&(i.z=Wt(i.z,e.z,m)),i.hasOwnProperty("w")&&(i.w=Wt(i.w,e.w,m))}function M2(i,e,n,a){let c=n,m=a;for(let p of["x","y"]){let b=i,y=e;b[p]>=y[p]&&(b=e,y=i),b[p]<c&&y[p]>c&&S2(b,y,p,c),b[p]<m&&y[p]>m&&S2(y,b,p,m)}}function h0(i,e){return i.x-e.x||i.y-e.y}function k2(i,e){return h0(i.min,e.min)===0&&h0(i.max,e.max)===0}function Gv(i,e){return!(i.min.x>e.max.x||i.max.x<e.min.x||i.min.y>e.max.y||i.max.y<e.min.y)}function qv(i,e){if(i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(i[n].sourceId!==e[n].sourceId||!k2(i[n],e[n])||i[n].order!==e[n].order||i[n].clipMask!==e[n].clipMask)return!1;return!0}function I2(i,e,n){let a=1/gt,c=1/(1<<n.canonical.z),m=(e.x*a+n.canonical.x)*c+n.wrap,p=(e.y*a+n.canonical.y)*c;return{min:new xt((i.x*a+n.canonical.x)*c+n.wrap,(i.y*a+n.canonical.y)*c),max:new xt(m,p)}}function ZP(i,e,n){let a=1<<n.canonical.z,c=((e.x-n.wrap)*a-n.canonical.x)*gt,m=(e.y*a-n.canonical.y)*gt;return{min:new xt(((i.x-n.wrap)*a-n.canonical.x)*gt,(i.y*a-n.canonical.y)*gt),max:new xt(c,m)}}function T2(i,e,n,a,c,m,p){let b=i.indices,y=i.vertices,w=[];for(let M=a;M<a+c;M+=3){let T=e[n[M+0]+m],E=e[n[M+1]+m],P=e[n[M+2]+m],R=Math.min(T.x,E.x,P.x),F=Math.max(T.x,E.x,P.x),B=Math.min(T.y,E.y,P.y),W=Math.max(T.y,E.y,P.y);w.length=0,i.grid.query(new xt(R,B),new xt(F,W),w);for(let J=0;J<w.length;J++){let ee=w[J];if(Ev(y[b[3*ee+0]],y[b[3*ee+1]],y[b[3*ee+2]],T,E,P,p))return!0}}return!1}function E2(i,e,n,a){if(!i||!n)return!1;let c=i.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<i.vertices.length)return E2(n,a,i,e);let m=e.canonical,p=a.canonical,b=Math.pow(2,p.z-m.z);c=i.vertices.map(y=>new xt((y.x+m.x*gt)*b-p.x*gt,(y.y+m.y*gt)*b-p.y*gt))}return T2(n,c,i.indices,0,i.indices.length,0,0)}function D2(i,e,n,a){let c=Math.pow(2,a.z-n.z);return new xt((i+n.x*gt)*c-a.x*gt,(e+n.y*gt)*c-a.y*gt)}function A2(i,e){let n=[];e.footprint.grid.queryPoint(i,n);let a=e.footprint.indices,c=e.footprint.vertices;for(let m=0;m<n.length;m++){let p=n[m];if(Zc([c[a[3*p+0]],c[a[3*p+1]],c[a[3*p+2]]],i))return!0}return!1}class P2{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function O2(i,e,n,a){let c=0,m=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(n[p]<i[p]||n[p]>e[p])return null}else{let b=1/a[p],y=(i[p]-n[p])*b,w=(e[p]-n[p])*b;if(y>w){let M=y;y=w,w=M}if(y>c&&(c=y),w<m&&(m=w),c>m)return null}return c}function R2(i,e,n,a,c,m,p,b,y,w,M){let T=a-i,E=c-e,P=m-n,R=p-i,F=b-e,B=y-n,W=M[1]*B-M[2]*F,J=M[2]*R-M[0]*B,ee=M[0]*F-M[1]*R,te=T*W+E*J+P*ee;if(Math.abs(te)<1e-15)return null;let pe=1/te,he=w[0]-i,ve=w[1]-e,Ce=w[2]-n,De=(he*W+ve*J+Ce*ee)*pe;if(De<0||De>1)return null;let Ue=ve*P-Ce*E,ze=Ce*T-he*P,$e=he*E-ve*T,ot=(M[0]*Ue+M[1]*ze+M[2]*$e)*pe;return ot<0||De+ot>1?null:(R*Ue+F*ze+B*$e)*pe}function L2(i,e,n){return(i-e)/(n-e)}function F2(i,e,n,a,c,m,p,b,y){let w=1<<n,M=m-a,T=p-c,E=(i+1)/w*M+a,P=(e+0)/w*T+c,R=(e+1)/w*T+c;b[0]=(i+0)/w*M+a,b[1]=P,y[0]=E,y[1]=R}class z2{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(m){let p=Math.ceil(Math.log2(m.dim/8)),b=[],y=Math.ceil(Math.pow(2,p)),w=1/y,M=(P,R,F,B,W)=>{let J=B?1:0,ee=(P+1)*F-J,te=R*F,pe=(R+1)*F-J;W[0]=P*F,W[1]=te,W[2]=ee,W[3]=pe},T=new P2(y),E=[];for(let P=0;P<y*y;P++){M(P%y,Math.floor(P/y),w,!1,E);let R=Qc(E[0],E[1],m),F=Qc(E[2],E[1],m),B=Qc(E[2],E[3],m),W=Qc(E[0],E[3],m);T.minimums.push(Math.min(R,F,B,W)),T.maximums.push(Math.max(R,F,B,W)),T.leaves.push(1)}for(b.push(T),y/=2;y>=1;y/=2){let P=b[b.length-1];T=new P2(y);for(let R=0;R<y*y;R++){M(R%y,Math.floor(R/y),2,!0,E);let F=P.getElevation(E[0],E[1]),B=P.getElevation(E[2],E[1]),W=P.getElevation(E[2],E[3]),J=P.getElevation(E[0],E[3]),ee=P.isLeaf(E[0],E[1]),te=P.isLeaf(E[2],E[1]),pe=P.isLeaf(E[2],E[3]),he=P.isLeaf(E[0],E[3]),ve=Math.min(F.min,B.min,W.min,J.min),Ce=Math.max(F.max,B.max,W.max,J.max),De=ee&&te&&pe&&he;T.maximums.push(Ce),T.minimums.push(ve),T.leaves.push(Ce-ve<=5&&De?1:0)}b.push(T)}return b}(this.dem),a=n.length-1,c=n[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,c,m,p,b=1){return O2([e,n,-100],[a,c,this.maximums[0]*b],m,p)}raycast(e,n,a,c,m,p,b=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,a,c,m,p,b);if(y==null)return null;let w=[],M=[],T=[],E=[],P=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;P.length>0;){let{idx:R,t:F,nodex:B,nodey:W,depth:J}=P.pop();if(this.leaves[R]){F2(B,W,J,e,n,a,c,T,E);let te=1<<J,pe=(B+0)/te,he=(B+1)/te,ve=(W+0)/te,Ce=(W+1)/te,De=Qc(pe,ve,this.dem)*b,Ue=Qc(he,ve,this.dem)*b,ze=Qc(he,Ce,this.dem)*b,$e=Qc(pe,Ce,this.dem)*b,ot=R2(T[0],T[1],De,E[0],T[1],Ue,E[0],E[1],ze,m,p),We=R2(E[0],E[1],ze,T[0],E[1],$e,T[0],T[1],De,m,p),et=Math.min(ot!==null?ot:Number.MAX_VALUE,We!==null?We:Number.MAX_VALUE);if(et!==Number.MAX_VALUE)return et;{let He=t._.scaleAndAdd([],m,p,F);if(B2(De,Ue,$e,ze,L2(He[0],T[0],E[0]),L2(He[1],T[1],E[1]))>=He[2])return F}continue}let ee=0;for(let te=0;te<this._siblingOffset.length;te++){F2((B<<1)+this._siblingOffset[te][0],(W<<1)+this._siblingOffset[te][1],J+1,e,n,a,c,T,E),T[2]=-100,E[2]=this.maximums[this.childOffsets[R]+te]*b;let pe=O2(T,E,m,p);if(pe!=null){let he=pe;w[te]=he;let ve=!1;for(let Ce=0;Ce<ee&&!ve;Ce++)he>=w[M[Ce]]&&(M.splice(Ce,0,te),ve=!0);ve||(M[ee]=te),ee++}}for(let te=0;te<ee;te++){let pe=M[te];P.push({idx:this.childOffsets[R]+pe,t:w[pe],nodex:(B<<1)+this._siblingOffset[pe][0],nodey:(W<<1)+this._siblingOffset[pe][1],depth:J+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,c,m){if(e[c].isLeaf(n,a)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let p=c-1,b=e[p],y=0,w=0;for(let M=0;M<this._siblingOffset.length;M++){let T=2*n+this._siblingOffset[M][0],E=2*a+this._siblingOffset[M][1],P=b.getElevation(T,E),R=b.isLeaf(T,E),F=this._addNode(P.min,P.max,R);R&&(y|=1<<M),w||(w=F)}for(let M=0;M<this._siblingOffset.length;M++)y&1<<M||this._construct(e,2*n+this._siblingOffset[M][0],2*a+this._siblingOffset[M][1],p,w+M)}}function B2(i,e,n,a,c,m){return Wt(Wt(i,n,m),Wt(e,a,m),c)}function Qc(i,e,n){let a=n.dim,c=fi(i*a-.5,0,a-1),m=fi(e*a-.5,0,a-1),p=Math.floor(c),b=Math.floor(m),y=Math.min(p+1,a-1),w=Math.min(b+1,a-1);return B2(n.get(p,b),n.get(y,b),n.get(p,w),n.get(y,w),c-p,m-b)}let XP={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function QP(i,e,n){return(256*i*256+256*e+n)/10-1e4}function KP(i,e,n){return 256*i+e+n/256-32768}class u0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Kn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let m=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let y=0;y<m;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(m,y)]=p[this._idx(m-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,m)]=p[this._idx(y,m-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(m,-1)]=p[this._idx(m-1,0)],p[this._idx(-1,m)]=p[this._idx(0,m-1)],p[this._idx(m,m)]=p[this._idx(m-1,m-1)]}let b=a==="terrarium"?KP:QP;for(let y=0;y<p.length;++y){let w=4*y;this.floatView[y]=b(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Rr.now()}_buildQuadTree(){this._tree=new z2(this)}get(e,n,a=!1){a&&(e=fi(e,-1,this.dim),n=fi(n,-1,this.dim));let c=this._idx(e,n);return this.floatView[c]}set(e,n,a){let c=this._idx(e,n),m=this.floatView[c];return this.floatView[c]=a,a-m}static getUnpackVector(e){return XP[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let a=[0,0,0,0],c=u0.getUnpackVector(n),m=Math.floor((e+c[3])/c[2]);return a[2]=m%256,m=Math.floor(m/256),a[1]=m%256,m=Math.floor(m/256),a[0]=m,a}getPixels(){return new p2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,p=a*this.dim,b=a*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(a){case-1:p=b-1;break;case 1:b=p+1}let y=-n*this.dim,w=-a*this.dim;for(let M=p;M<b;M++)for(let T=c;T<m;T++){let E=4*this._idx(T,M),P=4*this._idx(T+y,M+w);this.pixels[E+0]=e.pixels[P+0],this.pixels[E+1]=e.pixels[P+1],this.pixels[E+2]=e.pixels[P+2],this.pixels[E+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ne(u0,"DEMData"),ne(z2,"DemMinMaxQuadTree",{omit:["dem"]});class am{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){let c=a||e.findDEMTileFor(n);if(!c||!c.dem)return;let m=c.dem,p=c.tileID,b=1<<n.canonical.z-p.canonical.z;return new am(c,m.dim/gt/b,[(n.canonical.x/b-p.canonical.x)*m.dim,(n.canonical.y/b-p.canonical.y)*m.dim])}tileCoordToPixel(e,n){let a=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(a);return new xt(c,m)}getElevationAt(e,n,a,c){let m=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],b=Math.floor(m),y=Math.floor(p),w=this._dem;return c=!!c,a?Wt(Wt(w.get(b,y,c),w.get(b,y+1,c),p-y),Wt(w.get(b+1,y,c),w.get(b+1,y+1,c),p-y),m-b):w.get(b,y,c)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*vo(1,e)*this._dem.stride}}let N2={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},JP=c0.types,eO=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],tO=["fill-extrusion-flood-light-ground-radius"],iO=Math.pow(2,13),nO=Math.pow(2,15)-1,V2=new xt(0,1),Kc=2147483648;function Rf(i,e,n,a,c,m,p,b){i.emplaceBack((e<<1)+p,(n<<1)+m,(Math.floor(a*iO)<<1)+c,Math.round(b))}function m0(i,e,n,a,c,m){i.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+c,m)}function Lf(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class j2{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class U2{constructor(){this.centroidXY=new xt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new xt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new xt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new xt(this.max.x-this.min.x,this.max.y-this.min.y)}}class H2{constructor(){this.acc=new xt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((n.x===0||n.x===gt)&&n.x===a.x)!=((n.y===0||n.y===gt)&&n.y===a.y)&&this.processBorderOverlap(n,a),c&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Wt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>gt!=e.x>gt&&this.addBorderIntersection(1,Wt(n.y,e.y,(gt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Wt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>gt!=e.y>gt&&this.addBorderIntersection(3,Wt(n.x,e.x,(gt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new xt(0,0):new xt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function W2(i,e){let n=i.add(e)._unit(),a=fi(i.x*n.x+i.y*n.y,-1,1);var c,m,p;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*nO*((m=i).x*(p=e).y-m.y*p.x<0?-1:1)}let rO=[i=>i.x<0,i=>i.x>gt,i=>i.y<0,i=>i.y>gt];function oO(i,e,n,a){let c=[4];if(a===0)return c;n._mult(a);let m=i.sub(n),p=e.sub(n),b=[i,e,m,p];for(let y=0;y<4;y++)for(let w of b)if(rO[y](w)){c.push(y);break}return c}class G2{constructor(e){this.vertexArray=new Qy,this.indexArray=new kr,this.programConfigurations=new $c(e.layers,{zoom:e.zoom,lut:e.lut},n=>tO.includes(n)),this._segments=new Pn,this.hiddenByLandmarkVertexArray=new hv,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Pn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,c=!1){let m=e.length;if(m>2){let p=Math.max(0,this._segments.get().length-1),b=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),y;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let w=e[0],M=e[1];y=W2(w.sub(e[m-1])._perp()._unit(),M.sub(w)._perp()._unit())}for(let w=0;w<m;w++){let M=w===m-1?0:w+1,T=e[w],E=e[M],P=e[M===m-1?0:M+1],R=E.sub(T)._perp()._unit(),F=W2(R,P.sub(E)._perp()._unit()),B=y,W=F;if($v(T,E,n)||c&&Y2(T,n)&&Y2(E,n)){y=F;continue}let J=b.vertexLength;m0(this.vertexArray,T,E,1,1,B),m0(this.vertexArray,T,E,1,0,B),m0(this.vertexArray,T,E,0,1,W),m0(this.vertexArray,T,E,0,0,W),b.vertexLength+=4;let ee=oO(T,E,R,a);for(let te of ee)this._segmentToGroundQuads[p].push({id:J,region:te}),this._segmentToRegionTriCounts[p][te]+=2,b.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((c,m)=>c.region-m.region);for(let a=0;a<n;a++){let c=this._segmentToGroundQuads[a],m=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((y,w)=>y+w,0);let b=0;for(let y=0;y<=4;y++){let w=p[y];if(w!==0){let M=this.regionSegments[y];M||(M=this.regionSegments[y]=new Pn);let T={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+b,vertexLength:m.vertexLength,primitiveLength:w};M.get().push(T)}b+=w}for(let y=0;y<c.length;y++){let w=c[y].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,c,m,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,c,m,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,zP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,c,m,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,c,m,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&Kc?1:0;for(let c=e.groundVertexArrayOffset;c<n;++c)this.hiddenByLandmarkVertexArray.emplace(c,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,NP.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class p0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new kr,this.footprintVertices=new rs,this.footprintSegments=[],this.layoutVertexArray=new jc,this.centroidVertexArray=new DC,this.indexArray=new kr,this.programConfigurations=new $c(e.layers,{zoom:e.zoom,lut:e.lut},n=>eO.includes(n)),this.segments=new Pn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new G2(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,a,c){this.features=[],this.hasPattern=jv("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Z_(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:m,id:p,index:b,sourceLayerIndex:y}of e){let w=this.layers[0]._featureFilter.needGeometry,M=Pl(m,w);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),M,a))continue;let T={id:p,sourceLayerIndex:y,index:b,geometry:w?M.geometry:as(m,a,c),properties:m.properties,type:m.type,patterns:{}},E=this.layoutVertexArray.length;this.hasPattern?this.features.push(Uv("fill-extrusion",this.layers,T,this.zoom,n)):this.addFeature(T,T.geometry,b,a,{},n.availableImages,c,n.brightness),n.featureIndex.insert(m,T.geometry,b,y,this.index,E)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,c,m,p){for(let b of this.features){let{geometry:y}=b;this.addFeature(b,y,b.index,n,a,c,m,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,c,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,b,a,c,m),this.groundEffect.update(e,n,b,a,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,VP.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,BP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,c,m,p,b,y){let w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,M=[new xt(0,0),new xt(gt,gt)],T=b.projection,E=T.name==="globe",P=JP[e.type]==="Polygon",R=new H2;R.centroidDataIndex=this.centroidData.length;let F=new U2,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);F.height=W,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new W_);let J=a0(n,500);for(let Ce=J.length-1;Ce>=0;Ce--){let De=J[Ce];(De.length===0||(ee=De[0]).every(Ue=>Ue.x<=0)||ee.every(Ue=>Ue.x>=gt)||ee.every(Ue=>Ue.y<=0)||ee.every(Ue=>Ue.y>=gt))&&J.splice(Ce,1)}var ee;let te;if(E)te=K2(J,M,c);else{te=[];for(let Ce of J)te.push({polygon:Ce,bounds:M})}let pe=P?this.edgeRadius:0,he=pe>0&&this.zoom<17,ve=(Ce,De)=>{if(Ce.length===0)return!1;let Ue=Ce[Ce.length-1];return De.x===Ue.x&&De.y===Ue.y};for(let{polygon:Ce,bounds:De}of te){let Ue=0,ze=0;for(let et of Ce)P&&!et[0].equals(et[et.length-1])&&et.push(et[0]),ze+=P?et.length-1:et.length;let $e=this.segments.prepareSegment((P?5:4)*ze,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);let ot={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},We=new j2;if(We.vertexOffset=this.footprintVertices.length,We.indexOffset=3*this.footprintIndices.length,We.ringIndices=[],P){let et=[],He=[];Ue=$e.vertexLength;for(let ct=0;ct<Ce.length;ct++){let nt=Ce[ct];nt.length&&ct!==0&&He.push(et.length/2);let Mt=[],at,ht;at=nt[1].sub(nt[0])._perp()._unit(),We.ringIndices.push(nt.length-1);for(let Vt=1;Vt<nt.length;Vt++){let Lt=nt[Vt],Ot=nt[Vt===nt.length-1?1:Vt+1],dt=Lt.clone();if(pe){ht=Ot.sub(Lt)._perp()._unit();let jt=at.add(ht)._unit(),si=pe*Math.min(4,1/(at.x*jt.x+at.y*jt.y));dt.x+=si*jt.x,dt.y+=si*jt.y,dt.x=Math.round(dt.x),dt.y=Math.round(dt.y),at=ht}!B||pe!==0&&!he||ve(Mt,dt)||Mt.push(dt),Rf(this.layoutVertexArray,dt.x,dt.y,0,0,1,1,0),$e.vertexLength++,this.footprintVertices.emplaceBack(Lt.x,Lt.y),et.push(Lt.x,Lt.y),E&&Lf(this.layoutVertexExtArray,T.projectTilePoint(dt.x,dt.y,c),T.upVector(c,dt.x,dt.y))}B&&(pe===0||he)&&(Mt.length!==0&&ve(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,De,w))}let tt=Df(et,He);for(let ct=0;ct<tt.length;ct+=3)this.footprintIndices.emplaceBack(We.vertexOffset+tt[ct+0],We.vertexOffset+tt[ct+1],We.vertexOffset+tt[ct+2]),this.indexArray.emplaceBack(Ue+tt[ct],Ue+tt[ct+2],Ue+tt[ct+1]),$e.primitiveLength++;We.indexCount+=tt.length,We.vertexCount+=this.footprintVertices.length-We.vertexOffset}for(let et=0;et<Ce.length;et++){let He=Ce[et];R.startRing(F,He[0]);let tt=He.length>4&&Z2(He[He.length-2],He[0],He[1]),ct=pe?aO(He[He.length-2],He[0],He[1],pe):0,nt=[],Mt,at,ht;at=He[1].sub(He[0])._perp()._unit();let Vt=!0;for(let Lt=1,Ot=0;Lt<He.length;Lt++){let dt=He[Lt-1],jt=He[Lt],si=He[Lt===He.length-1?1:Lt+1];if(R.appendEdge(F,jt,dt),$v(jt,dt,De)){pe&&(at=si.sub(jt)._perp()._unit(),Vt=!Vt);continue}let Zt=jt.sub(dt)._perp(),hi=Zt.x/(Math.abs(Zt.x)+Math.abs(Zt.y)),li=Zt.y>0?1:0,xi=dt.dist(jt);if(Ot+xi>32768&&(Ot=0),pe){ht=si.sub(jt)._perp()._unit();let ji=$2(dt,jt,si,q2(at,ht),pe);isNaN(ji)&&(ji=0);let Pi=jt.sub(dt)._unit();dt=dt.add(Pi.mult(ct))._round(),jt=jt.add(Pi.mult(-ji))._round(),ct=ji,at=ht,B&&this.zoom>=17&&(ve(nt,dt)||nt.push(dt),ve(nt,jt)||nt.push(jt))}let qt=$e.vertexLength,on=He.length>4&&Z2(dt,jt,si),rn=X2(Ot,tt,Vt);if(Rf(this.layoutVertexArray,dt.x,dt.y,hi,li,0,0,rn),Rf(this.layoutVertexArray,dt.x,dt.y,hi,li,0,1,rn),Ot+=xi,rn=X2(Ot,on,!Vt),tt=on,Rf(this.layoutVertexArray,jt.x,jt.y,hi,li,0,0,rn),Rf(this.layoutVertexArray,jt.x,jt.y,hi,li,0,1,rn),$e.vertexLength+=4,this.indexArray.emplaceBack(qt+0,qt+1,qt+2),this.indexArray.emplaceBack(qt+1,qt+3,qt+2),$e.primitiveLength+=2,pe){let ji=Ue+(Lt===1?He.length-2:Lt-2),Pi=Lt===1?Ue:ji+1;if(this.indexArray.emplaceBack(qt+1,ji,qt+3),this.indexArray.emplaceBack(ji,Pi,qt+3),$e.primitiveLength+=2,Mt===void 0&&(Mt=qt),!$v(si,He[Lt],De)){let Ui=Lt===He.length-1?Mt:$e.vertexLength;this.indexArray.emplaceBack(qt+2,qt+3,Ui),this.indexArray.emplaceBack(qt+3,Ui+1,Ui),this.indexArray.emplaceBack(qt+3,Pi,Ui+1),$e.primitiveLength+=3}Vt=!Vt}if(E){let ji=this.layoutVertexExtArray,Pi=T.projectTilePoint(dt.x,dt.y,c),Ui=T.projectTilePoint(jt.x,jt.y,c),_n=T.upVector(c,dt.x,dt.y),un=T.upVector(c,jt.x,jt.y);Lf(ji,Pi,_n),Lf(ji,Pi,_n),Lf(ji,Ui,un),Lf(ji,Ui,un)}}P&&(Ue+=He.length-1),B&&pe&&this.zoom>=17&&(nt.length!==0&&ve(nt,nt[0])&&nt.pop(),this.groundEffect.addData(nt,De,w,pe>0))}this.footprintSegments.push(We),ot.triangleCount=this.indexArray.length-ot.triangleArrayOffset,this.polygonSegments.push(ot),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=R.borders?V2:this.encodeCentroid(R,F),this.centroidData.push(F),R.borders){this.featuresOnBorder.push(R);let Ce=this.featuresOnBorder.length-1;for(let De=0;De<R.borders.length;De++)R.borders[De][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[De].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,p,c,y),this.groundEffect.addPaintPropertiesData(e,a,m,p,c,y),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let b=0;b<this.centroidData.length;b++){let y=this.centroidData[b],w=+(y.min.y+y.max.y>gt),M=2*w+(+(y.min.x+y.max.x>gt)^w);for(let T=0;T<y.polygonSegLen;T++){let E=y.polygonSegIdx+T;e.push({centroidIdx:b,subtile:M,polygonSegmentIdx:E,triangleSegmentIdx:this.polygonSegments[E].triangleSegIdx})}}let n=new kr;e.sort((b,y)=>b.triangleSegmentIdx===y.triangleSegmentIdx?b.subtile-y.subtile:b.triangleSegmentIdx-y.triangleSegmentIdx);let a=0,c=0,m=0;for(let b of e){if(b.triangleSegmentIdx!==a)break;m++}let p=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let b=0,y=c,w=c;for(let M=y;M<m&&e[M].subtile===b;M++)w++;for(;y!==m;){let M=e[y];b=M.subtile;let T=this.centroidData[M.centroidIdx].min.clone(),E=this.centroidData[M.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=y;R<w;R++){let F=e[R],B=this.polygonSegments[F.polygonSegmentIdx],W=this.centroidData[F.centroidIdx].min,J=this.centroidData[F.centroidIdx].max,ee=this.indexArray.uint16;for(let te=B.triangleArrayOffset;te<B.triangleArrayOffset+B.triangleCount;te++)n.emplaceBack(ee[3*te],ee[3*te+1],ee[3*te+2]);P.primitiveLength+=B.triangleCount,T.x=Math.min(T.x,W.x),T.y=Math.min(T.y,W.y),E.x=Math.max(E.x,J.x),E.y=Math.max(E.y,J.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:T,max:E}),y=w;for(let R=y;R<m&&e[R].subtile===e[y].subtile;R++)w++}c=m;for(let M=c;M<p&&e[M].triangleSegmentIdx===e[c].triangleSegmentIdx;M++)m++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){let c=0,m=0,p=1<<e.canonical.z;if(n){let F=n.getMinMaxForTile(e);F&&(c=F.min,m=F.max)}m+=this.maxHeight;let b=e.toUnwrapped(),y,w=[b.canonical.x/p+b.wrap,b.canonical.y/p],M=[(b.canonical.x+1)/p+b.wrap,(b.canonical.y+1)/p],T=new Pn,E=(F,B,W)=>[F[0]*(1-W[0])+B[0]*W[0],F[1]*(1-W[1])+B[1]*W[1]],P=[],R=[];for(let F of this.triangleSubSegments){P[0]=F.min.x/gt,P[1]=F.min.y/gt,R[0]=F.max.x/gt,R[1]=F.max.y/gt;let B=E(w,M,P),W=E(w,M,R);if(new On([B[0],B[1],c],[W[0],W[1],m]).intersectsPrecise(a)===0){y&&(T.segments.push(y),y=void 0);continue}let J=F.segment;y&&y.vertexOffset!==J.vertexOffset&&(T.segments.push(y),y=void 0),y?(y.vertexLength+=J.vertexLength,y.primitiveLength+=J.primitiveLength):y={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&T.segments.push(y),T}encodeCentroid(e,n){let a=e.centroid(),c=n.span(),m=Math.min(7,Math.round(c.x*this.tileToMeter/10)),p=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new xt(fi(a.x,1,gt-1)<<3|m,fi(a.y,1,gt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new xt(0,0);let n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){let c=n[0][0]!==a?0:1;return new xt(6|(n[0][0]!==a?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{let c=n[2][0]!==a?2:3;return new xt((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=Kc,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&Kc?V2:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||m!==c.x){for(let p=n;p<a;++p)this.centroidVertexArray.emplace(p,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let c=n.getReplacementRegionsForTile(e.toUnwrapped());if(qv(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let m=[];for(let p of this.activeReplacements){if(p.order<a)continue;let b=Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&Kc||p.min.x>y.max.x||y.min.x>p.max.x||p.min.y>y.max.y||y.min.y>p.max.y))for(let w=0;w<y.footprintSegLen;w++){let M=this.footprintSegments[y.footprintSegIdx+w];if(m.length=0,sO(this.footprintVertices,M.vertexOffset,M.vertexCount,p.footprintTileId.canonical,e.canonical,m),T2(p.footprint,m,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-b)){y.flags|=Kc;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let c=!1;for(let m=0;m<a.footprintSegLen;m++){let p=this.footprintSegments[a.footprintSegIdx+m],b=0;for(let y of p.ringIndices){for(let w=b,M=y+b-1;w<y+b;M=w++){let T=this.footprintVertices.int16[2*(w+p.vertexOffset)+0],E=this.footprintVertices.int16[2*(w+p.vertexOffset)+1],P=this.footprintVertices.int16[2*(M+p.vertexOffset)+1];E>n!=P>n&&e<(this.footprintVertices.int16[2*(M+p.vertexOffset)+0]-T)*(n-E)/(P-E)+T&&(c=!c)}b=y}}return c}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,c=!0,m=4*(e+gt)*gt+(n+gt);if(this.partLookup.hasOwnProperty(m)){let p=this.partLookup[m];return p?{height:p.height,hidden:!!(p.flags&Kc)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>a&&(a=p.height,this.partLookup[m]=p,c=!!(p.flags&Kc));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[m]=void 0}}function q2(i,e){let n=i.add(e)._unit();return i.x*n.x+i.y*n.y}function aO(i,e,n,a){let c=e.sub(i)._perp()._unit(),m=n.sub(e)._perp()._unit();return $2(i,e,n,q2(c,m),a)}function $2(i,e,n,a,c){let m=Math.sqrt(1-a*a);return Math.min(i.dist(e)/3,e.dist(n)/3,c*m/a)}function $v(i,e,n){return i.x<n[0].x&&e.x<n[0].x||i.x>n[1].x&&e.x>n[1].x||i.y<n[0].y&&e.y<n[0].y||i.y>n[1].y&&e.y>n[1].y}function Y2(i,e){return i.x<e[0].x||i.x>e[1].x||i.y<e[0].y||i.y>e[1].y}function Z2(i,e,n){if(i.x<0||i.x>=gt||e.x<0||e.x>=gt||n.x<0||n.x>=gt)return!1;let a=n.sub(e),c=a.perp(),m=i.sub(e);return(a.x*m.x+a.y*m.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(m.x*m.x+m.y*m.y))>-.866&&c.x*m.x+c.y*m.y<0}function X2(i,e,n){let a=e?2|i:-3&i;return n?1|a:-2&a}function Q2(){let i=Math.PI/32,e=Math.tan(i),n=tm;return n*Math.sqrt(1+2*e*e)-n}function K2(i,e,n){let a=1<<n.z,c=Lo(n.x/a),m=Lo((n.x+1)/a),p=zr(n.y/a),b=zr((n.y+1)/a);return function(y,w,M,T,E=0,P){let R=[];if(!y.length||!M||!T)return R;let F=(he,ve)=>{for(let Ce of he)R.push({polygon:Ce,bounds:ve})},B=Math.ceil(Math.log2(M)),W=Math.ceil(Math.log2(T)),J=B-W,ee=[];for(let he=0;he<Math.abs(J);he++)ee.push(J>0?0:1);for(let he=0;he<Math.min(B,W);he++)ee.push(0),ee.push(1);let te=y;if(te=d0(te,w[0].y-E,w[1].y+E,1),te=d0(te,w[0].x-E,w[1].x+E,0),!te.length)return R;let pe=[];for(ee.length?pe.push({polygons:te,bounds:w,depth:0}):F(te,w);pe.length;){let he=pe.pop(),ve=he.depth,Ce=ee[ve],De=he.bounds[0],Ue=he.bounds[1],ze=Ce===0?De.x:De.y,$e=Ce===0?Ue.x:Ue.y,ot=P?P(Ce,ze,$e):.5*(ze+$e),We=d0(he.polygons,ze-E,ot+E,Ce),et=d0(he.polygons,ot-E,$e+E,Ce);if(We.length){let He=[De,new xt(Ce===0?ot:Ue.x,Ce===1?ot:Ue.y)];ee.length>ve+1?pe.push({polygons:We,bounds:He,depth:ve+1}):F(We,He)}if(et.length){let He=[new xt(Ce===0?ot:De.x,Ce===1?ot:De.y),Ue];ee.length>ve+1?pe.push({polygons:et,bounds:He,depth:ve+1}):F(et,He)}}return R}(i,e,Math.ceil((m-c)/11.25),Math.ceil((p-b)/11.25),1,(y,w,M)=>{if(y===0)return .5*(w+M);{let T=zr((n.y+w/gt)/a);return(Hs(.5*(zr((n.y+M/gt)/a)+T))*a-n.y)*gt}})}function sO(i,e,n,a,c,m){let p=Math.pow(2,a.z-c.z);for(let b=0;b<n;b++){let y=i.int16[2*(b+e)+0],w=i.int16[2*(b+e)+1];y=(y+c.x*gt)*p-a.x*gt,w=(w+c.y*gt)*p-a.y*gt,m.push(new xt(y,w))}}ne(p0,"FillExtrusionBucket",{omit:["layers","features"]}),ne(U2,"PartData"),ne(j2,"FootprintSegment"),ne(H2,"BorderCentroidData"),ne(G2,"GroundEffect");let lO=new qi({visibility:new Ke(Oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ke(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var cO={paint:new qi({"fill-extrusion-opacity":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new St(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new St(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new St(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new St(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new St(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new St(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ke(Oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:lO};function Ff(i,e){return i.x*e.x+i.y*e.y}function J2(i,e){if(i.length===1){let n=0,a=e[n++],c;for(;!c||a.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){let m=e[n],p=i[0],b=c.sub(a),y=m.sub(a),w=p.sub(a),M=Ff(b,b),T=Ff(b,y),E=Ff(y,y),P=Ff(w,b),R=Ff(w,y),F=M*E-T*T,B=(E*P-T*R)/F,W=(M*R-T*P)/F,J=a.z*(1-B-W)+c.z*B+m.z*W;if(isFinite(J))return J}return 1/0}{let n=1/0;for(let a of e)n=Math.min(n,a.z);return n}}function eS(i,e,n,a,c,m,p,b){let y=p*c.getElevationAt(i,e,!0,!0),w=m[0]!==0,M=w?m[1]===0?p*(m[0]/7-450):p*function(T,E,P){let R=Math.floor(E[0]/8),F=Math.floor(E[1]/8),B=10*(E[0]-8*R),W=10*(E[1]-8*F),J=T.getElevationAt(R,F,!0,!0),ee=T.getMeterToDEM(P),te=Math.floor(.5*(B*ee-1)),pe=Math.floor(.5*(W*ee-1)),he=T.tileCoordToPixel(R,F),ve=2*te+1,Ce=2*pe+1,De=function(et,He,tt,ct,nt){return[et.getElevationAtPixel(He,tt,!0),et.getElevationAtPixel(He+nt,tt,!0),et.getElevationAtPixel(He,tt+nt,!0),et.getElevationAtPixel(He+ct,tt+nt,!0)]}(T,he.x-te,he.y-pe,ve,Ce),Ue=Math.abs(De[0]-De[1]),ze=Math.abs(De[2]-De[3]),$e=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),ot=Math.min(.25,.5*ee*(Ue+ze)/ve),We=Math.min(.25,.5*ee*$e/Ce);return J+Math.max(ot*B,We*W)}(c,m,b):y;return{base:y+(n===0)?-1:n,top:w?Math.max(M+a,y+n+2):y+a}}let dO=$i([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:hO}=dO,uO=$i([{name:"a_packed",components:4,type:"Float32"}]),{members:mO}=uO,pO=$i([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:fO}=pO,gO=$i([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_O=$i([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),bO=$i([{name:"a_projected_pos",components:4,type:"Float32"}],4);$i([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Yv=$i([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),tS=$i([{name:"a_z_offset",components:1,type:"Float32"}],4),yO=$i([{name:"a_texb",components:2,type:"Uint16"}]),vO=$i([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),xO=$i([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);$i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let iS=$i([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wO=$i([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$i([{name:"triangle",components:3,type:"Uint16"}]),$i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$i([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),$i([{type:"Float32",name:"offsetX"}]),$i([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class nS{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Xc({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let a=this.getKey(e,n);return this.positions[a]}trim(){let e=this.width,n=this.height=wp(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){let c=[],m=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,b=!0;c.push({left:m,right:p,isDash:b,zeroLength:e[0]===0});let y=e[0];for(let w=1;w<e.length;w++){b=!b;let M=e[w];m=y*a,y+=M,p=y*a,c.push({left:m,right:p,isDash:b,zeroLength:M===0})}return c}addRoundDash(e,n,a){let c=n/2;for(let m=-a;m<=a;m++){let p=this.width*(this.nextRow+a+m),b=0,y=e[b];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++b]);let M=Math.abs(w-y.left),T=Math.abs(w-y.right),E=Math.min(M,T),P,R=m/a*(c+1);if(y.isDash){let F=c-Math.abs(R);P=Math.sqrt(E*E+F*F)}else P=c-Math.sqrt(E*E+R*R);this.image.data[p+w]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let w=e[y],M=e[y+1];w.zeroLength?e.splice(y,1):M&&M.isDash===w.isDash&&(M.left=w.left,e.splice(y,1))}let a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);let m=this.width*this.nextRow,p=0,b=e[p];for(let y=0;y<this.width;y++){y/b.right>1&&(b=e[++p]);let w=Math.abs(y-b.left),M=Math.abs(y-b.right),T=Math.min(w,M);this.image.data[m+y]=Math.max(0,Math.min(255,(b.isDash?T:-T)+n+128))}}addDash(e,n){let a=this.getKey(e,n);if(this.positions[a])return this.positions[a];let c=n==="round",m=c?7:0,p=2*m+1;if(this.nextRow+p>this.height)return Kn("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let M=0;M<e.length;M++)e[M]<0&&(Kn("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),b+=e[M];if(b!==0){let M=this.width/b,T=this.getDashRanges(e,this.width,M);c?this.addRoundDash(T,M,m):this.addRegularDash(T,n==="square"?.5*M:0)}let y=this.nextRow+m;this.nextRow+=p;let w={tl:[y,m],br:[b,0]};return this.positions[a]=w,w}}ne(nS,"LineAtlas");let CO=c0.types,SO=Math.cos(Math.PI/180*37.5),MO=Math.cos(Math.PI/180*5);class f0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Ky,this.layoutVertexArray2=new Uc,this.patternVertexArray=new Hc,this.indexArray=new kr,this.programConfigurations=new $c(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Pn,this.maxLineLength=0,this.zOffsetVertexArray=new Ch,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:gt/64}updateFootprints(e,n){}populate(e,n,a,c){this.hasPattern=jv("line",this.layers,n);let m=this.layers[0].layout.get("line-sort-key"),p=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!p.isConstant()||!!p.constantOr(0);let b=[];for(let{feature:T,id:E,index:P,sourceLayerIndex:R}of e){let F=this.layers[0]._featureFilter.needGeometry,B=Pl(T,F);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),B,a))continue;let W=m?m.evaluate(B,{},a):void 0,J={id:E,properties:T.properties,type:T.type,sourceLayerIndex:R,index:P,geometry:F?B.geometry:as(T,a,c),patterns:{},sortKey:W};b.push(J)}m&&b.sort((T,E)=>T.sortKey-E.sortKey);let{lineAtlas:y,featureIndex:w}=n,M=this.addConstantDashes(y);for(let T of b){let{geometry:E,index:P,sourceLayerIndex:R}=T;if(M&&this.addFeatureDashes(T,y),this.hasPattern){let F=Uv("line",this.layers,T,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(T,E,P,a,y.positions,n.availableImages,n.brightness);w.insert(e[P].feature,E,P,R,this.index)}}addConstantDashes(e){let n=!1;for(let a of this.layers){let c=a.paint.get("line-dasharray").value,m=a.layout.get("line-cap").value;if(c.kind!=="constant"||m.kind!=="constant")n=!0;else{let p=m.value,b=c.value;if(!b)continue;e.addDash(b,p)}}return n}addFeatureDashes(e,n){let a=this.zoom;for(let c of this.layers){let m=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(m.kind==="constant"&&p.kind==="constant")continue;let b,y;if(m.kind==="constant"){if(b=m.value,!b)continue}else b=m.evaluate({zoom:a},e);y=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),n.addDash(b,y),e.patterns[c.id]=n.getKey(b,y)}}update(e,n,a,c,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,c,m)}addFeatures(e,n,a,c,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,a,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,mO)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,fO)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,tS.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hO),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,c,m,p,b){let y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),M=y.get("line-cap").evaluate(e,{}),T=y.get("line-miter-limit"),E=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let P of n)this.addLine(P,e,c,w,M,T,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,p,c,b)}addLine(e,n,a,c,m,p,b){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},w=this.layers[0].layout,M=c==="none";if(this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<e.length-1;he++)this.totalDistance+=e[he].dist(e[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let T=CO[n.type]==="Polygon",E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let P=0;for(;P<E-1&&e[P].equals(e[P+1]);)P++;if(E<(T?3:2))return;c==="bevel"&&(p=1.05);let R=this.overscaling<=16?15*gt/(512*this.overscaling):0,F=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray),B,W,J,ee,te,pe;this.e1=this.e2=-1,T&&(B=e[E-2],te=e[P].sub(B)._unit()._perp());for(let he=P;he<E;he++){if(J=he===E-1?T?e[P+1]:void 0:e[he+1],J&&e[he].equals(J))continue;if(te&&(ee=te),B&&(W=B),B=e[he],this.hasZOffset){let He=w.get("line-z-offset").value;if(He.kind==="constant")pe=He.value;else{if(this.lineClips){let tt=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(tt*this.lineClips.start+this.distance+(W?W.dist(B):0))/tt}else Kn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;pe=He.evaluate(y,n)}pe=pe||0}te=J?J.sub(B)._unit()._perp():ee,ee=ee||te;let ve=W&&J,Ce=ve?c:T||M?"butt":m,De=ee.x*te.x+ee.y*te.y;if(M){let He=function(tt){if(tt.patternJoinNone){let ct=tt.segmentPoints.length/2,nt=tt.lineSoFar-tt.segmentStart;for(let Mt=0;Mt<ct;++Mt){let at=tt.segmentPoints[2*Mt+1],ht=Math.round(tt.segmentPoints[2*Mt])+.5+.25*at;tt.patternVertexArray.emplaceBack(ht,nt,tt.segmentStart),tt.patternVertexArray.emplaceBack(ht,nt,tt.segmentStart)}tt.segmentPoints.length=0}tt.e1=tt.e2=-1};if(ve&&De<MO){this.updateDistance(W,B),this.addCurrentVertex(B,ee,1,1,F,pe),He(this),this.addCurrentVertex(B,te,-1,-1,F,pe);continue}if(W){if(!J){this.updateDistance(W,B),this.addCurrentVertex(B,ee,1,1,F,pe),He(this);continue}Ce="miter"}}let Ue=ee.add(te);Ue.x===0&&Ue.y===0||Ue._unit();let ze=Ue.x*te.x+Ue.y*te.y,$e=ze!==0?1/ze:1/0,ot=2*Math.sqrt(2-2*ze),We=ze<SO&&W&&J,et=ee.x*te.y-ee.y*te.x>0;if(We&&he>P){let He=B.dist(W);if(He>2*R){let tt=B.sub(B.sub(W)._mult(R/He)._round());this.updateDistance(W,tt),this.addCurrentVertex(tt,ee,0,0,F,pe),W=tt}}if(ve&&Ce==="round"&&($e<b?Ce="miter":$e<=2&&(Ce="fakeround")),Ce==="miter"&&$e>p&&(Ce="bevel"),Ce==="bevel"&&($e>2&&(Ce="flipbevel"),$e<p&&(Ce="miter")),W&&this.updateDistance(W,B),Ce==="miter")Ue._mult($e),this.addCurrentVertex(B,Ue,0,0,F,pe);else if(Ce==="flipbevel"){if($e>100)Ue=te.mult(-1);else{let He=$e*ee.add(te).mag()/ee.sub(te).mag();Ue._perp()._mult(He*(et?-1:1))}this.addCurrentVertex(B,Ue,0,0,F,pe),this.addCurrentVertex(B,Ue.mult(-1),0,0,F,pe)}else if(Ce==="bevel"||Ce==="fakeround"){let He=-Math.sqrt($e*$e-1),tt=et?He:0,ct=et?0:He;if(W&&this.addCurrentVertex(B,ee,tt,ct,F,pe),Ce==="fakeround"){let nt=Math.round(180*ot/Math.PI/20);for(let Mt=1;Mt<nt;Mt++){let at=Mt/nt;if(at!==.5){let Vt=at-.5;at+=at*Vt*(at-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*Vt*Vt+(.848013+De*(.215638*De-1.06021)))}let ht=te.sub(ee)._mult(at)._add(ee)._unit()._mult(et?-1:1);this.addHalfVertex(B,ht.x,ht.y,!1,et,0,F,pe)}}J&&this.addCurrentVertex(B,te,-tt,-ct,F,pe)}else Ce==="butt"?this.addCurrentVertex(B,Ue,0,0,F,pe):Ce==="square"?(W||this.addCurrentVertex(B,Ue,-1,-1,F,pe),this.addCurrentVertex(B,Ue,0,0,F,pe),W&&this.addCurrentVertex(B,Ue,1,1,F,pe)):Ce==="round"&&(W&&(this.addCurrentVertex(B,ee,0,0,F,pe),this.addCurrentVertex(B,ee,1,1,F,pe,!0)),J&&(this.addCurrentVertex(B,te,-1,-1,F,pe,!0),this.addCurrentVertex(B,te,0,0,F,pe)));if(We&&he<E-1){let He=B.dist(J);if(He>2*R){let tt=B.add(J.sub(B)._mult(R/He)._round());this.updateDistance(B,tt),this.addCurrentVertex(tt,te,0,0,F,pe),B=tt}}}}addVerticesTo(e,n,a,c,m,p,b,y,w,M){let T=(n.w-e.w)/this.tessellationStep|0;if(T>1){this.lineSoFar=e.w;let E=(n.x-e.x)/T,P=(n.y-e.y)/T,R=(n.z-e.z)/T,F=(n.w-e.w)/T;for(let B=1;B<T;++B)e.x+=E,e.y+=P,e.z+=R,this.lineSoFar+=F,this.addHalfVertex(e,a,c,M,!1,b,w,e.z),this.addHalfVertex(e,m,p,M,!0,-y,w,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,a,c,M,!1,b,w,n.z),this.addHalfVertex(n,m,p,M,!0,-y,w,n.z)}addCurrentVertex(e,n,a,c,m,p,b=!1){let y=n.x+n.y*a,w=n.y-n.x*a,M=n.y*c-n.x,T=-n.y-n.x*c;if(p!=null){let P=gt+10,R=p,F=new C2(e.x,e.y,R,this.lineSoFar),B=rS(e,-10,P),W=this.lineSoFar;if(this.currentVertex)if(B){let J=this.currentVertexIsOutside,ee=this.currentVertex,te=new C2(e.x,e.y,R,this.lineSoFar);M2(ee,te,-10,P),rS(te,-10,P)||(J&&(this.e1=this.e2=-1,this.lineSoFar=ee.w,this.addHalfVertex(ee,y,w,b,!1,a,m,ee.z),this.addHalfVertex(ee,M,T,b,!0,-c,m,ee.z)),this.addVerticesTo(ee,te,y,w,M,T,a,c,m,b))}else{let J=this.currentVertex;this.currentVertexIsOutside&&(M2(J,F,-10,P),this.e1=this.e2=-1,this.lineSoFar=J.w,this.addHalfVertex(J,y,w,b,!1,a,m,J.z),this.addHalfVertex(J,M,T,b,!0,-c,m,J.z)),this.addVerticesTo(J,F,y,w,M,T,a,c,m,b)}else B||(this.addHalfVertex(e,y,w,b,!1,a,m,p),this.addHalfVertex(e,M,T,b,!0,-c,m,p));this.currentVertex=F,this.currentVertexIsOutside=B,this.lineSoFar=W}else this.addHalfVertex(e,y,w,b,!1,a,m,p),this.addHalfVertex(e,M,T,b,!0,-c,m,p)}addHalfVertex({x:e,y:n},a,c,m,p,b,y,w){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let M=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),y.primitiveLength++),p?this.e2=M:this.e1=M,w!=null&&this.zOffsetVertexArray.emplaceBack(w)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function rS(i,e,n){return i.x<e||i.x>n||i.y<e||i.y>n}ne(f0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let kO=new qi({"line-cap":new St(Oe.layout_line["line-cap"]),"line-join":new St(Oe.layout_line["line-join"]),"line-miter-limit":new Ke(Oe.layout_line["line-miter-limit"]),"line-round-limit":new Ke(Oe.layout_line["line-round-limit"]),"line-sort-key":new St(Oe.layout_line["line-sort-key"]),"line-z-offset":new St(Oe.layout_line["line-z-offset"]),visibility:new Ke(Oe.layout_line.visibility)});var g0={paint:new qi({"line-opacity":new St(Oe.paint_line["line-opacity"]),"line-color":new St(Oe.paint_line["line-color"]),"line-translate":new Ke(Oe.paint_line["line-translate"]),"line-translate-anchor":new Ke(Oe.paint_line["line-translate-anchor"]),"line-width":new St(Oe.paint_line["line-width"]),"line-gap-width":new St(Oe.paint_line["line-gap-width"]),"line-offset":new St(Oe.paint_line["line-offset"]),"line-blur":new St(Oe.paint_line["line-blur"]),"line-dasharray":new St(Oe.paint_line["line-dasharray"]),"line-pattern":new St(Oe.paint_line["line-pattern"]),"line-gradient":new An(Oe.paint_line["line-gradient"]),"line-trim-offset":new Ke(Oe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ke(Oe.paint_line["line-trim-fade-range"]),"line-trim-color":new Ke(Oe.paint_line["line-trim-color"]),"line-emissive-strength":new Ke(Oe.paint_line["line-emissive-strength"]),"line-border-width":new St(Oe.paint_line["line-border-width"]),"line-border-color":new St(Oe.paint_line["line-border-color"]),"line-occlusion-opacity":new Ke(Oe.paint_line["line-occlusion-opacity"])}),layout:kO};function oS(i,e,n){return e*(gt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function aS(i,e){return 1/oS(i,1,e.tileZoom)}function sS(i,e,n,a){return i.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let lS=i=>{let e=[];cS(i)&&e.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=i.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=i.layout.get("line-join").constantOr("miter")==="none",c=!!i.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function cS(i){let e=i.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class dS{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var IO={read:function(i,e,n,a,c){var m,p,b=8*c-a-1,y=(1<<b)-1,w=y>>1,M=-7,T=n?c-1:0,E=n?-1:1,P=i[e+T];for(T+=E,m=P&(1<<-M)-1,P>>=-M,M+=b;M>0;m=256*m+i[e+T],T+=E,M-=8);for(p=m&(1<<-M)-1,m>>=-M,M+=a;M>0;p=256*p+i[e+T],T+=E,M-=8);if(m===0)m=1-w;else{if(m===y)return p?NaN:1/0*(P?-1:1);p+=Math.pow(2,a),m-=w}return(P?-1:1)*p*Math.pow(2,m-a)},write:function(i,e,n,a,c,m){var p,b,y,w=8*m-c-1,M=(1<<w)-1,T=M>>1,E=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=a?0:m-1,R=a?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,p=M):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+T>=1?E/y:E*Math.pow(2,1-T))*y>=2&&(p++,y/=2),p+T>=M?(b=0,p=M):p+T>=1?(b=(e*y-1)*Math.pow(2,c),p+=T):(b=e*Math.pow(2,T-1)*Math.pow(2,c),p=0));c>=8;i[n+P]=255&b,P+=R,b/=256,c-=8);for(p=p<<c|b,w+=c;w>0;i[n+P]=255&p,P+=R,p/=256,w-=8);i[n+P-R]|=128*F}},hS=In,_0=IO;function In(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}In.Varint=0,In.Fixed64=1,In.Bytes=2,In.Fixed32=5;var Zv=4294967296,uS=1/Zv,mS=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ll(i){return i.type===In.Bytes?i.readVarint()+i.pos:i.pos+1}function sm(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function pS(i,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var c=n.pos-1;c>=i;c--)n.buf[c+a]=n.buf[c]}function TO(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function EO(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function DO(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function AO(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function PO(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function OO(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function RO(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function LO(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function FO(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function b0(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function lm(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function fS(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}In.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),c=a>>3,m=this.pos;this.type=7&a,i(c,e,this),this.pos===m&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=b0(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=fS(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=b0(this.buf,this.pos)+b0(this.buf,this.pos+4)*Zv;return this.pos+=8,i},readSFixed64:function(){var i=b0(this.buf,this.pos)+fS(this.buf,this.pos+4)*Zv;return this.pos+=8,i},readFloat:function(){var i=_0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=_0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(c,m,p){var b,y,w=p.buf;if(b=(112&(y=w[p.pos++]))>>4,y<128||(b|=(127&(y=w[p.pos++]))<<3,y<128)||(b|=(127&(y=w[p.pos++]))<<10,y<128)||(b|=(127&(y=w[p.pos++]))<<17,y<128)||(b|=(127&(y=w[p.pos++]))<<24,y<128)||(b|=(1&(y=w[p.pos++]))<<31,y<128))return sm(c,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&mS?function(n,a,c){return mS.decode(n.subarray(a,c))}(this.buf,e,i):function(n,a,c){for(var m="",p=a;p<c;){var b,y,w,M=n[p],T=null,E=M>239?4:M>223?3:M>191?2:1;if(p+E>c)break;E===1?M<128&&(T=M):E===2?(192&(b=n[p+1]))==128&&(T=(31&M)<<6|63&b)<=127&&(T=null):E===3?(y=n[p+2],(192&(b=n[p+1]))==128&&(192&y)==128&&((T=(15&M)<<12|(63&b)<<6|63&y)<=2047||T>=55296&&T<=57343)&&(T=null)):E===4&&(y=n[p+2],w=n[p+3],(192&(b=n[p+1]))==128&&(192&y)==128&&(192&w)==128&&((T=(15&M)<<18|(63&b)<<12|(63&y)<<6|63&w)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,E=1):T>65535&&(T-=65536,m+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),m+=String.fromCharCode(T),p+=E}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==In.Bytes)return i.push(this.readVarint(e));var n=Ll(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==In.Bytes)return i.push(this.readSVarint());var e=Ll(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==In.Bytes)return i.push(this.readBoolean());var e=Ll(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==In.Bytes)return i.push(this.readFloat());var e=Ll(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==In.Bytes)return i.push(this.readDouble());var e=Ll(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==In.Bytes)return i.push(this.readFixed32());var e=Ll(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==In.Bytes)return i.push(this.readSFixed32());var e=Ll(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==In.Bytes)return i.push(this.readFixed64());var e=Ll(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==In.Bytes)return i.push(this.readSFixed64());var e=Ll(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===In.Varint)for(;this.buf[this.pos++]>127;);else if(e===In.Bytes)this.pos=this.readVarint()+this.pos;else if(e===In.Fixed32)this.pos+=4;else{if(e!==In.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),lm(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),lm(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),lm(this.buf,-1&i,this.pos),lm(this.buf,Math.floor(i*uS),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),lm(this.buf,-1&i,this.pos),lm(this.buf,Math.floor(i*uS),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,p,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(a,0,n),function(m,p){var b=(7&m)<<4;p.buf[p.pos++]|=b|((m>>>=3)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m)))))}(c,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,c,m){for(var p,b,y=0;y<c.length;y++){if((p=c.charCodeAt(y))>55295&&p<57344){if(!b){p>56319||y+1===c.length?(a[m++]=239,a[m++]=191,a[m++]=189):b=p;continue}if(p<56320){a[m++]=239,a[m++]=191,a[m++]=189,b=p;continue}p=b-55296<<10|p-56320|65536,b=null}else b&&(a[m++]=239,a[m++]=191,a[m++]=189,b=null);p<128?a[m++]=p:(p<2048?a[m++]=p>>6|192:(p<65536?a[m++]=p>>12|224:(a[m++]=p>>18|240,a[m++]=p>>12&63|128),a[m++]=p>>6&63|128),a[m++]=63&p|128)}return m}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&pS(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),_0.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),_0.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var a=this.pos-n;a>=128&&pS(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,n){this.writeTag(i,In.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,TO,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,EO,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,PO,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,DO,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,AO,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,OO,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,RO,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,LO,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,FO,e)},writeBytesField:function(i,e){this.writeTag(i,In.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,In.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,In.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,In.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,In.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,In.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,In.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,In.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,In.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,In.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var cm=Xe(hS);let zO=["id","tile","layer","source","sourceLayer","state"];class gS{constructor(e,n,a,c,m){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=c,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of zO)this[n]!==void 0&&(e[n]=this[n]);return e}}class BO{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){let c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},qr(this.stateChanges[e][c],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(let m in this.state[e])m!==c&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(let m in this.state[e][c])a[m]||(this.deletedStates[e][c][m]=null)}else for(let m in a)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][m]===null&&delete this.deletedStates[e][c][m]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;let c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){let a=String(n),c=qr({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let m=this.deletedStates[e][n];if(m===null)return{};for(let p in m)delete c[p]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let a={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let m={};for(let p in this.stateChanges[c])this.state[c][p]||(this.state[c][p]={}),qr(this.state[c][p],this.stateChanges[c][p]),m[p]=this.state[c][p];a[c]=m}for(let c in this.deletedStates){this.state[c]=this.state[c]||{};let m={};if(this.deletedStates[c]===null)for(let p in this.state[c])m[p]={},this.state[c][p]={};else for(let p in this.deletedStates[c]){if(this.deletedStates[c][p]===null)this.state[c][p]={};else if(this.state[c][p])for(let b of Object.keys(this.deletedStates[c][p]))delete this.state[c][p][b];m[p]=this.state[c][p]}a[c]=a[c]||{},qr(a[c],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let c in e)e[c].setFeatureState(a,n)}}class _S{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new _e(gt,16,0),this.featureIndexArray=new EC,this.promoteId=n,this.is3DTile=!1}insert(e,n,a,c,m,p=0,b=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,m,p);let w=this.grid;for(let M=0;M<n.length;M++){let T=n[M],E=[1/0,1/0,-1/0,-1/0];for(let P=0;P<T.length;P++){let R=T[P];E[0]=Math.min(E[0],R.x),E[1]=Math.min(E[1],R.y),E[2]=Math.max(E[2],R.x),E[3]=Math.max(E[3],R.y)}b!==0&&(E[0]-=b,E[1]-=b,E[2]+=b,E[3]+=b),E[0]<gt&&E[1]<gt&&E[2]>=0&&E[3]>=0&&w.insert(y,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Wv(new cm(this.rawTileData)).layers,this.sourceLayerCoder=new dS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,c){this.loadVTLayers();let m=e.params||{},p=wr(m.filter),b=e.tileResult,y=e.transform,w=b.bufferedTilespaceBounds,M=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(R,F,B,W)=>qC(b.bufferedTilespaceGeometry,R,F,B,W));M.sort(NO);let T=null;y.elevation&&M.length>0&&(T=am.create(y.elevation,this.tileID));let E={},P;for(let R=0;R<M.length;R++){let F=M[R];if(F===P)continue;P=F;let B=this.featureIndexArray.get(F),W=null;if(this.is3DTile){let J=this.bucketLayerIDs[0][0],ee=n[J];if(ee.type!=="model")continue;let{queryFeature:te,intersectionZ:pe}=ee.queryIntersectsMatchingFeature(b,B.featureIndex,p,y);te&&this.appendToResult(E,J,B.featureIndex,te,pe)}else this.loadMatchingFeature(E,B,p,m.layers,m.availableImages,n,a,c,(J,ee,te,pe=0)=>(W||(W=as(J,this.tileID.canonical,e.tileTransform)),ee.queryIntersectsFeature(b,J,te,W,this.z,e.transform,e.pixelPosMatrix,T,pe)))}return E}loadMatchingFeature(e,n,a,c,m,p,b,y,w){let{featureIndex:M,bucketIndex:T,sourceLayerIndex:E,layoutVertexArrayOffset:P}=n,R=this.bucketLayerIDs[T];if(c&&!function(J,ee){for(let te=0;te<J.length;te++)if(ee.indexOf(J[te])>=0)return!0;return!1}(c,R))return;let F=this.sourceLayerCoder.decode(E),B=this.vtLayers[F].feature(M);if(a.needGeometry){let J=Pl(B,!0);if(!a.filter(new Kt(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!a.filter(new Kt(this.tileID.overscaledZ),B))return;let W=this.getId(B,F);for(let J=0;J<R.length;J++){let ee=R[J];if(c&&c.indexOf(ee)<0)continue;let te=p[ee];if(!te)continue;let pe={};W!==void 0&&y&&(pe=y.getState(te.sourceLayer||"_geojsonTileLayer",W));let he=!w||w(B,te,pe,P);if(!he)continue;let ve=new gS(B,this.z,this.x,this.y,W),Ce=qr({},b[ee]);Ce.paint=bS(Ce.paint,te.paint,B,pe,m),Ce.layout=bS(Ce.layout,te.layout,B,pe,m),ve.layer=Ce,this.appendToResult(e,ee,M,ve,he)}}appendToResult(e,n,a,c,m){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:a,feature:c,intersectionZ:m})}lookupSymbolFeatures(e,n,a,c,m,p,b,y){let w={};this.loadVTLayers();let M=wr(m);for(let T of e)this.loadMatchingFeature(w,{bucketIndex:a,sourceLayerIndex:c,featureIndex:T,layoutVertexArrayOffset:0},M,p,b,y,n);return w}loadFeature(e){let{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();let c=this.sourceLayerCoder.decode(a),m=this.vtFeatures[c];if(m[n])return m[n];let p=this.vtLayers[c].feature(n);return m[n]=p,p}hasLayer(e){for(let n of this.bucketLayerIDs)for(let a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];c!=null&&(a=e.properties[c]),typeof a=="boolean"&&(a=Number(a))}return a}}function bS(i,e,n,a,c){return bc(i,(m,p)=>{let b=e instanceof nn?e.get(p):null;return b&&b.evaluate?b.evaluate(n,a,c):b})}function NO(i,e){return e-i}ne(_S,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Yr=24;let ss=128;function Xv(i,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Kt(i+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:c}=n,m=0;for(;m<a.length&&a[m]<=i;)m++;m=Math.max(0,m-1);let p=m;for(;p<a.length&&a[p]<i+1;)p++;p=Math.min(a.length-1,p);let b=a[m],y=a[p];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:y,interpolationType:c}:{kind:"camera",minZoom:b,maxZoom:y,minSize:n.evaluate(new Kt(b)),maxSize:n.evaluate(new Kt(y)),interpolationType:c}}}function y0(i,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:c}){return i.kind==="source"?a/ss:i.kind==="composite"?Wt(a/ss,c/ss,n):e}function dm(i,e){let n=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:c,minZoom:m,maxZoom:p}=i,b=c?fi(Po.interpolationFactor(c,e,m,p),0,1):0;i.kind==="camera"?a=Wt(i.minSize,i.maxSize,b):n=b}return{uSizeT:n,uSize:a}}var VO=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ss,evaluateSizeForFeature:y0,evaluateSizeForZoom:dm,getSizeData:Xv});function jO(i,e,n){return i.sections.forEach(a=>{a.text=function(c,m,p){let b=m.layout.get("text-transform").evaluate(p,{});return b==="uppercase"?c=c.toLocaleUpperCase():b==="lowercase"&&(c=c.toLocaleLowerCase()),Ki.applyArabicShaping&&(c=Ki.applyArabicShaping(c)),c}(a.text,e,n)}),i}let zf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function UO(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function HO(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}let Qv=3;function WO(i,e,n){e.glyphs=[],i===1&&n.readMessage(GO,e)}function GO(i,e,n){if(i===3){let{id:a,bitmap:c,width:m,height:p,left:b,top:y,advance:w}=n.readMessage(qO,{});e.glyphs.push({id:a,bitmap:new Xc({width:m+2*Qv,height:p+2*Qv},c),metrics:{width:m,height:p,left:b,top:y,advance:w}})}else i===4?e.ascender=n.readSVarint():i===5&&(e.descender=n.readSVarint())}function qO(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}let yS=Qv,_a={horizontal:1,vertical:2,horizontalOnly:3};class Bf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let a=new Bf;return a.scale=e||1,a.fontStack=n,a}static forImage(e){let n=new Bf;return n.imageName=e,n}}class hm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let a=new hm;for(let c=0;c<e.sections.length;c++){let m=e.sections[c];m.image?a.addImageSection(m):a.addTextSection(m,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let c="";for(let m=0;m<n.length;m++){let p=n.charCodeAt(m+1)||null,b=n.charCodeAt(m-1)||null;c+=!a&&(p&&Ze(p)&&!zf[n[m+1]]||b&&Ze(b)&&!zf[n[m-1]])||!zf[n[m]]?n[m]:zf[n[m]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&v0[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&v0[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let a=new hm;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Bf.forText(e.scale,e.fontStack||n));let a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void Kn("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Bf.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Kn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Kv(i,e,n,a,c,m,p,b,y,w,M,T,E,P,R){let F=hm.fromFeature(i,c);T===_a.vertical&&F.verticalizePunctuation(E);let B=[],W=function(he,ve,Ce,De,Ue,ze){if(!he)return[];let $e=[],ot=function(tt,ct,nt,Mt,at,ht){let Vt=0;for(let Lt=0;Lt<tt.length();Lt++){let Ot=tt.getSection(Lt);Vt+=vS(tt.getCodePoint(Lt),Ot,Mt,at,ct,ht)}return Vt/Math.max(1,Math.ceil(Vt/nt))}(he,ve,Ce,De,Ue,ze),We=he.text.indexOf("\u200B")>=0,et=0;for(let tt=0;tt<he.length();tt++){let ct=he.getSection(tt),nt=he.getCodePoint(tt);if(v0[nt]||(et+=vS(nt,ct,De,Ue,ve,ze)),tt<he.length()-1){let Mt=!((He=nt)<11904||!(me["Bopomofo Extended"](He)||me.Bopomofo(He)||me["CJK Compatibility Forms"](He)||me["CJK Compatibility Ideographs"](He)||me["CJK Compatibility"](He)||me["CJK Radicals Supplement"](He)||me["CJK Strokes"](He)||me["CJK Symbols and Punctuation"](He)||me["CJK Unified Ideographs Extension A"](He)||me["CJK Unified Ideographs"](He)||me["Enclosed CJK Letters and Months"](He)||me["Halfwidth and Fullwidth Forms"](He)||me.Hiragana(He)||me["Ideographic Description Characters"](He)||me["Kangxi Radicals"](He)||me["Katakana Phonetic Extensions"](He)||me.Katakana(He)||me["Vertical Forms"](He)||me["Yi Radicals"](He)||me["Yi Syllables"](He)));($O[nt]||Mt||ct.imageName)&&$e.push(wS(tt+1,et,ot,$e,YO(nt,he.getCodePoint(tt+1),Mt&&We),!1))}}var He;return CS(wS(he.length(),et,ot,$e,0,!0))}(F,w,m,e,a,P),{processBidirectionalText:J,processStyledBidirectionalText:ee}=Ki;if(J&&F.sections.length===1){let he=J(F.toString(),W);for(let ve of he){let Ce=new hm;Ce.text=ve,Ce.sections=F.sections;for(let De=0;De<ve.length;De++)Ce.sectionIndex.push(0);B.push(Ce)}}else if(ee){let he=ee(F.text,F.sectionIndex,W);for(let ve of he){let Ce=new hm;Ce.text=ve[0],Ce.sectionIndex=ve[1],Ce.sections=F.sections,B.push(Ce)}}else B=function(he,ve){let Ce=[],De=he.text,Ue=0;for(let ze of ve)Ce.push(he.substring(Ue,ze)),Ue=ze;return Ue<De.length&&Ce.push(he.substring(Ue,De.length)),Ce}(F,W);let te=[],pe={positionedLines:te,text:F.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,ve,Ce,De,Ue,ze,$e,ot,We,et,He,tt){let ct=0,nt=0,Mt=0,at=ot==="right"?1:ot==="left"?0:.5,ht=!1;for(let si of Ue){let Zt=si.getSections();for(let hi of Zt){if(hi.imageName)continue;let li=ve[hi.fontStack];if(li&&(ht=li.ascender!==void 0&&li.descender!==void 0,!ht))break}if(!ht)break}let Vt=0;for(let si of Ue){si.trim();let Zt=si.getMaxScale(),hi=(Zt-1)*Yr,li={positionedGlyphs:[],lineOffset:0};he.positionedLines[Vt]=li;let xi=li.positionedGlyphs,qt=0;if(!si.length()){nt+=ze,++Vt;continue}let on=0,rn=0;for(let Pi=0;Pi<si.length();Pi++){let Ui=si.getSection(Pi),_n=si.getSectionIndex(Pi),un=si.getCodePoint(Pi),Nn=Ui.scale,Rn=null,to=null,qn=null,Tn=Yr,ur=0,Br=!(We===_a.horizontal||!He&&!Je(un)||He&&(v0[un]||(Lt=un,me.Arabic(Lt)||me["Arabic Supplement"](Lt)||me["Arabic Extended-A"](Lt)||me["Arabic Presentation Forms-A"](Lt)||me["Arabic Presentation Forms-B"](Lt))));if(Ui.imageName){let Nr=De[Ui.imageName];if(!Nr)continue;qn=Ui.imageName,he.iconsInText=he.iconsInText||!0,to=Nr.paddedRect;let pn=Nr.displaySize;Nn=Nn*Yr/tt,Rn={width:pn[0],height:pn[1],left:0,top:-yS,advance:Br?pn[1]:pn[0],localGlyph:!1},ur=ht?-Rn.height*Nn:Zt*Yr-17-pn[1]*Nn,Tn=Rn.advance;let xo=(Br?pn[0]:pn[1])*Nn-Yr*Zt;xo>0&&xo>qt&&(qt=xo)}else{let Nr=Ce[Ui.fontStack];if(!Nr)continue;Nr[un]&&(to=Nr[un]);let pn=ve[Ui.fontStack];if(!pn)continue;let xo=pn.glyphs[un];if(!xo)continue;if(Rn=xo.metrics,Tn=un!==8203?Yr:0,ht){let zl=pn.ascender!==void 0?Math.abs(pn.ascender):0,Va=pn.descender!==void 0?Math.abs(pn.descender):0,ps=(zl+Va)*Nn;on<ps&&(on=ps,rn=(zl-Va)/2*Nn),ur=-zl*Nn}else ur=(Zt-Nn)*Yr-17}Br?(he.verticalizable=!0,xi.push({glyph:un,imageName:qn,x:ct,y:nt+ur,vertical:Br,scale:Nn,localGlyph:Rn.localGlyph,fontStack:Ui.fontStack,sectionIndex:_n,metrics:Rn,rect:to}),ct+=Tn*Nn+et):(xi.push({glyph:un,imageName:qn,x:ct,y:nt+ur,vertical:Br,scale:Nn,localGlyph:Rn.localGlyph,fontStack:Ui.fontStack,sectionIndex:_n,metrics:Rn,rect:to}),ct+=Rn.advance*Nn+et)}xi.length!==0&&(Mt=Math.max(ct-et,Mt),ht?SS(xi,at,qt,rn,ze*Zt/2):SS(xi,at,qt,0,ze/2)),ct=0;let ji=ze*Zt+qt;li.lineOffset=Math.max(qt,hi),nt+=ji,++Vt}var Lt;let Ot=nt,{horizontalAlign:dt,verticalAlign:jt}=Jv($e);(function(si,Zt,hi,li,xi,qt){let on=(Zt-hi)*xi,rn=-qt*li;for(let ji of si)for(let Pi of ji.positionedGlyphs)Pi.x+=on,Pi.y+=rn})(he.positionedLines,at,dt,jt,Mt,Ot),he.top+=-jt*Ot,he.bottom=he.top+Ot,he.left+=-dt*Mt,he.right=he.left+Mt,he.hasBaseline=ht}(pe,e,n,a,B,p,b,y,T,w,E,R),!function(he){for(let ve of he)if(ve.positionedGlyphs.length!==0)return!1;return!0}(te)&&pe}let v0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$O={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vS(i,e,n,a,c,m){if(e.imageName){let p=a[e.imageName];return p?p.displaySize[0]*e.scale*Yr/m+c:0}{let p=n[e.fontStack],b=p&&p.glyphs[i];return b?b.metrics.advance*e.scale+c:0}}function xS(i,e,n,a){let c=Math.pow(i-e,2);return a?i<e?c/2:2*c:c+Math.abs(n)*n}function YO(i,e,n){let a=0;return i===10&&(a-=1e4),n&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function wS(i,e,n,a,c,m){let p=null,b=xS(e,n,c,m);for(let y of a){let w=xS(e-y.x,n,c,m)+y.badness;w<=b&&(p=y,b=w)}return{index:i,x:e,priorBreak:p,badness:b}}function CS(i){return i?CS(i.priorBreak).concat(i.index):[]}function Jv(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function SS(i,e,n,a,c){if(!(e||n||a||c))return;let m=i.length-1,p=i[m],b=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=m;y++)i[y].x-=b,i[y].y+=n+a+c}function ZO(i,e,n,a){let{horizontalAlign:c,verticalAlign:m}=Jv(a),p=n[0]-i.displaySize[0]*c,b=n[1]-i.displaySize[1]*m;return{imagePrimary:i,imageSecondary:e,top:b,bottom:b+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function MS(i,e,n,a,c,m){let p=i.imagePrimary,b;if(p.content){let B=p.content,W=p.pixelRatio||1;b=[B[0]/W,B[1]/W,p.displaySize[0]-B[2]/W,p.displaySize[1]-B[3]/W]}let y=e.left*m,w=e.right*m,M,T,E,P;n==="width"||n==="both"?(P=c[0]+y-a[3],T=c[0]+w+a[1]):(P=c[0]+(y+w-p.displaySize[0])/2,T=P+p.displaySize[0]);let R=e.top*m,F=e.bottom*m;return n==="height"||n==="both"?(M=c[1]+R-a[0],E=c[1]+F+a[2]):(M=c[1]+(R+F-p.displaySize[1])/2,E=M+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:M,right:T,bottom:E,left:P,collisionPadding:b}}class Fl extends xt{constructor(e,n,a,c,m){super(e,n),this.angle=c,this.z=a,m!==void 0&&(this.segment=m)}clone(){return new Fl(this.x,this.y,this.z,this.angle,this.segment)}}function kS(i,e,n,a,c){if(e.segment===void 0)return!0;let m=e,p=e.segment+1,b=0;for(;b>-n/2;){if(p--,p<0)return!1;b-=i[p].dist(m),m=i[p]}b+=i[p].dist(i[p+1]),p++;let y=[],w=0;for(;b<n/2;){let M=i[p],T=i[p+1];if(!T)return!1;let E=i[p-1].angleTo(M)-M.angleTo(T);for(E=Math.abs((E+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:b,angleDelta:E}),w+=E;b-y[0].distance>a;)w-=y.shift().angleDelta;if(w>c)return!1;p++,b+=M.dist(T)}return!0}function IS(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function TS(i,e,n){return i?.6*e*n:0}function ES(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function XO(i,e,n,a,c,m){let p=TS(n,c,m),b=ES(n,a)*m,y=0,w=IS(i)/2;for(let M=0;M<i.length-1;M++){let T=i[M],E=i[M+1],P=T.dist(E);if(y+P>w){let R=(w-y)/P,F=Wt(T.x,E.x,R),B=Wt(T.y,E.y,R),W=new Fl(F,B,0,E.angleTo(T),M);return!p||kS(i,W,b,p,e)?W:void 0}y+=P}}function QO(i,e,n,a,c,m,p,b,y){let w=TS(a,m,p),M=ES(a,c),T=M*p,E=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-T<e/4&&(e=T+e/4),DS(i,E?e/2*b%e:(M/2+2*m)*p*b%e,e,w,n,T,E,!1,y)}function DS(i,e,n,a,c,m,p,b,y){let w=m/2,M=IS(i),T=0,E=e-n,P=[];for(let R=0;R<i.length-1;R++){let F=i[R],B=i[R+1],W=F.dist(B),J=B.angleTo(F);for(;E+n<T+W;){E+=n;let ee=(E-T)/W,te=Wt(F.x,B.x,ee),pe=Wt(F.y,B.y,ee);if(te>=0&&te<y&&pe>=0&&pe<y&&E-w>=0&&E+w<=M){let he=new Fl(te,pe,0,J,R);a&&!kS(i,he,m,a,c)||P.push(he)}}T+=W}return b||P.length||p||(P=DS(i,T/2,n,a,c,m,p,!0,y)),P}function AS(i,e,n,a,c){let m=[];for(let p=0;p<i.length;p++){let b=i[p],y;for(let w=0;w<b.length-1;w++){let M=b[w],T=b[w+1];M.x<e&&T.x<e||(M.x<e?M=new xt(e,M.y+(e-M.x)/(T.x-M.x)*(T.y-M.y))._round():T.x<e&&(T=new xt(e,M.y+(e-M.x)/(T.x-M.x)*(T.y-M.y))._round()),M.y<n&&T.y<n||(M.y<n?M=new xt(M.x+(n-M.y)/(T.y-M.y)*(T.x-M.x),n)._round():T.y<n&&(T=new xt(M.x+(n-M.y)/(T.y-M.y)*(T.x-M.x),n)._round()),M.x>=a&&T.x>=a||(M.x>=a?M=new xt(a,M.y+(a-M.x)/(T.x-M.x)*(T.y-M.y))._round():T.x>=a&&(T=new xt(a,M.y+(a-M.x)/(T.x-M.x)*(T.y-M.y))._round()),M.y>=c&&T.y>=c||(M.y>=c?M=new xt(M.x+(c-M.y)/(T.y-M.y)*(T.x-M.x),c)._round():T.y>=c&&(T=new xt(M.x+(c-M.y)/(T.y-M.y)*(T.x-M.x),c)._round()),y&&M.equals(y[y.length-1])||(y=[M],m.push(y)),y.push(T)))))}}return m}function PS(i){let e=0,n=0;for(let p of i)e+=p.w*p.h,n=Math.max(n,p.w);i.sort((p,b)=>b.h-p.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],c=0,m=0;for(let p of i)for(let b=a.length-1;b>=0;b--){let y=a[b];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,m=Math.max(m,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===y.w&&p.h===y.h){let w=a.pop();b<a.length&&(a[b]=w)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(a.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}ne(Fl,"Anchor");let Wo=1;class ex{constructor(e,{pixelRatio:n,version:a,stretchX:c,stretchY:m,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+Wo,this.paddedRect.y+Wo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Wo,this.paddedRect.y+this.paddedRect.h-Wo]}get displaySize(){return[(this.paddedRect.w-2*Wo)/this.pixelRatio,(this.paddedRect.h-2*Wo)/this.pixelRatio]}}class OS{constructor(e,n,a){let c={},m={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,c,p),this.addImages(n,m,p);let{w:b,h:y}=PS(p),w=new ga({width:b||1,height:y||1});for(let M in e){let T=e[M],E=c[M].paddedRect;ga.copy(T.data,w,{x:0,y:0},{x:E.x+Wo,y:E.y+Wo},T.data,a,T.sdf)}for(let M in n){let T=n[M],E=m[M].paddedRect,P=E.x+Wo,R=E.y+Wo,F=T.data.width,B=T.data.height;ga.copy(T.data,w,{x:0,y:0},{x:P,y:R},T.data,a),ga.copy(T.data,w,{x:0,y:B-1},{x:P,y:R-1},{width:F,height:1},a),ga.copy(T.data,w,{x:0,y:0},{x:P,y:R+B},{width:F,height:1},a),ga.copy(T.data,w,{x:F-1,y:0},{x:P-1,y:R},{width:1,height:B},a),ga.copy(T.data,w,{x:0,y:0},{x:P+F,y:R},{width:1,height:B},a)}this.image=w,this.iconPositions=c,this.patternPositions=m}addImages(e,n,a){for(let c in e){let m=e[c],p={x:0,y:0,w:m.data.width+2*Wo,h:m.data.height+2*Wo};a.push(p),n[c]=new ex(p,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let c in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,a),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;let[c,m]=e.tl,p=!!Object.keys(this.patternPositions).length;a.update(n.data,{useMipmap:p},{x:c,y:m})}}ne(ex,"ImagePosition"),ne(OS,"ImageAtlas");let Nf=1e20;function RS(i,e,n,a,c,m,p,b,y){for(let w=e;w<e+a;w++)LS(i,n*m+w,m,c,p,b,y);for(let w=n;w<n+c;w++)LS(i,w*m+e,1,a,p,b,y)}function LS(i,e,n,a,c,m,p){m[0]=0,p[0]=-Nf,p[1]=Nf,c[0]=i[e];for(let b=1,y=0,w=0;b<a;b++){c[b]=i[e+b*n];let M=b*b;do{let T=m[y];w=(c[b]-c[T]+M-T*T)/(b-T)/2}while(w<=p[y]&&--y>-1);y++,m[y]=b,p[y]=w,p[y+1]=Nf}for(let b=0,y=0;b<a;b++){for(;p[y+1]<b;)y++;let w=m[y],M=b-w;i[e+b*n]=c[w]+M*M}}let ls=2,tx={none:0,ideographs:1,all:2};class um{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){let c=[],m=this.urls[n]||I.GLYPHS_URL;for(let p in e)for(let b of e[p])c.push({stack:p,id:b});_c(c,({stack:p,id:b},y)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=w.glyphs[b];if(M!==void 0)return void y(null,{stack:p,id:b,glyph:M});if(M=this._tinySDF(w,p,b),M)return w.glyphs[b]=M,void y(null,{stack:p,id:b,glyph:M});let T=Math.floor(b/256);if(256*T>65535)return void y(new Error("glyphs > 65535 not supported"));if(w.ranges[T])return void y(null,{stack:p,id:b,glyph:M});let E=w.requests[T];E||(E=w.requests[T]=[],um.loadGlyphRange(p,T,m,this.requestManager,(P,R)=>{if(R){w.ascender=R.ascender,w.descender=R.descender;for(let F in R.glyphs)this._doesCharSupportLocalGlyph(+F)||(w.glyphs[+F]=R.glyphs[+F]);w.ranges[T]=!0}for(let F of E)F(P,R);delete w.requests[T]})),E.push((P,R)=>{P?y(P):R&&y(null,{stack:p,id:b,glyph:R.glyphs[b]||null})})},(p,b)=>{if(p)a(p);else if(b){let y={};for(let{stack:w,id:M,glyph:T}of b)y[w]===void 0&&(y[w]={}),y[w].glyphs===void 0&&(y[w].glyphs={}),y[w].glyphs[M]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;a(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==tx.none&&(this.localGlyphMode===tx.all?!!this.localFontFamily:!!this.localFontFamily&&(me["CJK Unified Ideographs"](e)||me["Hangul Syllables"](e)||me.Hiragana(e)||me.Katakana(e)||me["CJK Symbols and Punctuation"](e)||me["CJK Unified Ideographs Extension A"](e)||me["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,a){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let m=e.tinySDF;if(!m){let F="400";/bold/i.test(n)?F="900":/medium/i.test(n)?F="500":/light/i.test(n)&&(F="200"),m=e.tinySDF=new um.TinySDF({fontFamily:c,fontWeight:F,fontSize:24*ls,buffer:3*ls,radius:8*ls}),m.fontWeight=F}if(this.localGlyphs[m.fontWeight][a])return this.localGlyphs[m.fontWeight][a];let p=String.fromCodePoint(a),{data:b,width:y,height:w,glyphWidth:M,glyphHeight:T,glyphLeft:E,glyphTop:P,glyphAdvance:R}=m.draw(p);return this.localGlyphs[m.fontWeight][a]={id:a,bitmap:new Xc({width:y,height:w},b),metrics:{width:M/ls,height:T/ls,left:E/ls,top:P/ls-27,advance:R/ls,localGlyph:!0}}}}um.loadGlyphRange=function(i,e,n,a,c){let m=256*e,p=m+255,b=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${m}-${p}`),Su.Glyphs);gl(b,(y,w)=>{if(y)c(y);else if(w){let M={},T=function(E){return new cm(E).readFields(WO,{})}(w);for(let E of T.glyphs)M[E.id]=E;c(null,{glyphs:M,ascender:T.ascender,descender:T.descender})}})},um.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:m="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;let b=this.size=i+4*e,y=this._createCanvas(b),w=this.ctx=y.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${m} ${i}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(i){let e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:m}=this.ctx.measureText(i),p=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-c))),y=Math.min(this.size-this.buffer,p+Math.ceil(a)),w=b+2*this.buffer,M=y+2*this.buffer,T=Math.max(w*M,0),E=new Uint8ClampedArray(T),P={data:E,width:w,height:M,glyphWidth:b,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(b===0||y===0)return P;let{ctx:R,buffer:F,gridInner:B,gridOuter:W}=this;R.clearRect(F,F,b,y),R.fillText(i,F,F+p);let J=R.getImageData(F,F,b,y);W.fill(Nf,0,T),B.fill(0,0,T);for(let ee=0;ee<y;ee++)for(let te=0;te<b;te++){let pe=J.data[4*(ee*b+te)+3]/255;if(pe===0)continue;let he=(ee+F)*w+te+F;if(pe===1)W[he]=0,B[he]=Nf;else{let ve=.5-pe;W[he]=ve>0?ve*ve:0,B[he]=ve<0?ve*ve:0}}RS(W,0,0,w,M,w,this.f,this.v,this.z),RS(B,F,F,b,y,w,this.f,this.v,this.z);for(let ee=0;ee<T;ee++){let te=Math.sqrt(W[ee])-Math.sqrt(B[ee]);E[ee]=Math.round(255-255*(te/this.radius+this.cutoff))}return P}};let Jc=Wo;function FS(i,e,n,a){let c=[],m=i.imagePrimary,p=m.pixelRatio,b=m.paddedRect.w-2*Jc,y=m.paddedRect.h-2*Jc,w=i.right-i.left,M=i.bottom-i.top,T=m.stretchX||[[0,b]],E=m.stretchY||[[0,y]],P=(ze,$e)=>ze+$e[1]-$e[0],R=T.reduce(P,0),F=E.reduce(P,0),B=b-R,W=y-F,J=0,ee=R,te=0,pe=F,he=0,ve=B,Ce=0,De=W;if(m.content&&a){let ze=m.content;J=x0(T,0,ze[0]),te=x0(E,0,ze[1]),ee=x0(T,ze[0],ze[2]),pe=x0(E,ze[1],ze[3]),he=ze[0]-J,Ce=ze[1]-te,ve=ze[2]-ze[0]-ee,De=ze[3]-ze[1]-pe}let Ue=(ze,$e,ot,We)=>{let et=w0(ze.stretch-J,ee,w,i.left),He=C0(ze.fixed-he,ve,ze.stretch,R),tt=w0($e.stretch-te,pe,M,i.top),ct=C0($e.fixed-Ce,De,$e.stretch,F),nt=w0(ot.stretch-J,ee,w,i.left),Mt=C0(ot.fixed-he,ve,ot.stretch,R),at=w0(We.stretch-te,pe,M,i.top),ht=C0(We.fixed-Ce,De,We.stretch,F),Vt=new xt(et,tt),Lt=new xt(nt,tt),Ot=new xt(nt,at),dt=new xt(et,at),jt=new xt(He/p,ct/p),si=new xt(Mt/p,ht/p),Zt=e*Math.PI/180;if(Zt){let rn=Math.sin(Zt),ji=Math.cos(Zt),Pi=[ji,-rn,rn,ji];Vt._matMult(Pi),Lt._matMult(Pi),dt._matMult(Pi),Ot._matMult(Pi)}let hi=ze.stretch+ze.fixed,li=ot.stretch+ot.fixed,xi=$e.stretch+$e.fixed,qt=We.stretch+We.fixed,on=i.imageSecondary;return{tl:Vt,tr:Lt,bl:dt,br:Ot,texPrimary:{x:m.paddedRect.x+Jc+hi,y:m.paddedRect.y+Jc+xi,w:li-hi,h:qt-xi},texSecondary:on?{x:on.paddedRect.x+Jc+hi,y:on.paddedRect.y+Jc+xi,w:li-hi,h:qt-xi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jt,pixelOffsetBR:si,minFontScaleX:ve/p/w,minFontScaleY:De/p/M,isSDF:n}};if(a&&(m.stretchX||m.stretchY)){let ze=zS(T,B,R),$e=zS(E,W,F);for(let ot=0;ot<ze.length-1;ot++){let We=ze[ot],et=ze[ot+1];for(let He=0;He<$e.length-1;He++)c.push(Ue(We,$e[He],et,$e[He+1]))}}else c.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:y+1}));return c}function x0(i,e,n){let a=0;for(let c of i)a+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return a}function zS(i,e,n){let a=[{fixed:-Jc,stretch:0}];for(let[c,m]of i){let p=a[a.length-1];a.push({fixed:c-p.stretch,stretch:p.stretch}),a.push({fixed:c-p.stretch,stretch:p.stretch+(m-c)})}return a.push({fixed:e+Jc,stretch:n}),a}function w0(i,e,n,a){return i/e*n+a}function C0(i,e,n,a){return i-e*n/a}function KO(i,e,n,a){let c=e+i.positionedLines[a].lineOffset;return a===0?n+c/2:n+(c+(e+i.positionedLines[a-1].lineOffset))/2}function JO(i,e=1,n=!1){let a=1/0,c=1/0,m=-1/0,p=-1/0,b=i[0];for(let P=0;P<b.length;P++){let R=b[P];(!P||R.x<a)&&(a=R.x),(!P||R.y<c)&&(c=R.y),(!P||R.x>m)&&(m=R.x),(!P||R.y>p)&&(p=R.y)}let y=Math.min(m-a,p-c),w=y/2,M=new Qp([],eR);if(y===0)return new xt(a,c);for(let P=a;P<m;P+=y)for(let R=c;R<p;R+=y)M.push(new mm(P+w,R+w,w,i));let T=function(P){let R=0,F=0,B=0,W=P[0];for(let J=0,ee=W.length,te=ee-1;J<ee;te=J++){let pe=W[J],he=W[te],ve=pe.x*he.y-he.x*pe.y;F+=(pe.x+he.x)*ve,B+=(pe.y+he.y)*ve,R+=3*ve}return new mm(F/R,B/R,0,P)}(i),E=M.length;for(;M.length;){let P=M.pop();(P.d>T.d||!T.d)&&(T=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,E)),P.max-T.d<=e||(w=P.h/2,M.push(new mm(P.p.x-w,P.p.y-w,w,i)),M.push(new mm(P.p.x+w,P.p.y-w,w,i)),M.push(new mm(P.p.x-w,P.p.y+w,w,i)),M.push(new mm(P.p.x+w,P.p.y+w,w,i)),E+=4)}return n&&(console.log(`num probes: ${E}`),console.log(`best distance: ${T.d}`)),T.p}function eR(i,e){return e.max-i.max}class mm{constructor(e,n,a,c){this.p=new xt(e,n),this.h=a,this.d=function(m,p){let b=!1,y=1/0;for(let w=0;w<p.length;w++){let M=p[w];for(let T=0,E=M.length,P=E-1;T<E;P=T++){let R=M[T],F=M[P];R.y>m.y!=F.y>m.y&&m.x<(F.x-R.x)*(m.y-R.y)/(F.y-R.y)+R.x&&(b=!b),y=Math.min(y,WC(m,R,F))}}return(b?1:-1)*Math.sqrt(y)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let ix=Number.POSITIVE_INFINITY,tR=Math.sqrt(2);function BS(i,[e,n]){let a=0,c=0;if(n===ix){e<0&&(e=0);let m=e/tR;switch(i){case"top-right":case"top-left":c=m-7;break;case"bottom-right":case"bottom-left":c=7-m;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(i){case"top-right":case"bottom-right":a=-m;break;case"top-left":case"bottom-left":a=m;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),i){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(i){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function nx(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function iR(i,e,n,a,c,m,p,b,y,w,M,T,E,P,R){let F=m.textMaxSize.evaluate(e,{},T);F===void 0&&(F=p);let B=i.layers[0].layout,W=B.get("icon-offset").evaluate(e,{},T),J=VS(n.horizontal)||n.vertical,ee=E.name==="globe",te=Yr,pe=p/te,he=i.tilePixelRatio*F/te,ve=(et=i.overscaling,i.zoom>18&&et>2&&(et>>=1),Math.max(gt/(512*et),1)*B.get("symbol-spacing")),Ce=B.get("text-padding")*i.tilePixelRatio,De=B.get("icon-padding")*i.tilePixelRatio,Ue=Di(B.get("text-max-angle")),ze=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",$e=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",ot=B.get("symbol-placement"),We=ve/2;var et;let He=B.get("icon-text-fit").evaluate(e,{},T),tt=B.get("icon-text-fit-padding").evaluate(e,{},T),ct=He!=="none",nt;i.hasAnyIconTextFit===!1&&ct&&(i.hasAnyIconTextFit=!0),a&&ct&&(i.allowVerticalPlacement&&n.vertical&&(nt=MS(a,n.vertical,He,tt,W,pe)),J&&(a=MS(a,J,He,tt,W,pe)));let Mt=(at,ht,Vt)=>{if(ht.x<0||ht.x>=gt||ht.y<0||ht.y>=gt)return;let Lt=null;if(ee){let{x:Ot,y:dt,z:jt}=E.projectTilePoint(ht.x,ht.y,Vt);Lt={anchor:new Fl(Ot,dt,jt,0,void 0),up:E.upVector(Vt,ht.x,ht.y)}}(function(Ot,dt,jt,si,Zt,hi,li,xi,qt,on,rn,ji,Pi,Ui,_n,un,Nn,Rn,to,qn,Tn,ur,Br,Nr,pn,xo,zl){let Va=Ot.addToLineVertexArray(dt,si),ps,ad,sd,Fh,jM,UM,HM,WM=0,GM=0,qM=0,$M=0,Px=-1,Ox=-1,Ys={},YM=Mc(""),zh=jt?jt.anchor:dt,Rx=qt.layout.get("icon-text-fit").evaluate(Tn,{},pn)!=="none",Lx=0,Fx=0;if(qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Lx,Fx]=qt.layout.get("text-offset").evaluate(Tn,{},pn).map(qo=>qo*Yr):(Lx=qt.layout.get("text-radial-offset").evaluate(Tn,{},pn)*Yr,Fx=ix),Ot.allowVerticalPlacement&&Zt.vertical){let qo=Zt.vertical;if(_n)UM=rx(qo),xi&&(HM=rx(xi));else{let $o=qt.layout.get("text-rotate").evaluate(Tn,{},pn)+90;sd=S0(on,zh,dt,rn,ji,Pi,qo,Ui,$o,un),xi&&(Fh=S0(on,zh,dt,rn,ji,Pi,xi,Rn,$o))}}if(hi){let qo=qt.layout.get("icon-rotate").evaluate(Tn,{},pn),$o=FS(hi,qo,Br,Rx),wm=xi?FS(xi,qo,Br,Rx):void 0;ad=S0(on,zh,dt,rn,ji,Pi,hi,Rn,qo),WM=4*$o.length;let ZM=Ot.iconSizeData,Bh=null;ZM.kind==="source"?(Bh=[ss*qt.layout.get("icon-size").evaluate(Tn,{},pn)],Bh[0]>ed&&Kn(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${Vf}. Reduce your "icon-size".`)):ZM.kind==="composite"&&(Bh=[ss*ur.compositeIconSizes[0].evaluate(Tn,{},pn),ss*ur.compositeIconSizes[1].evaluate(Tn,{},pn)],(Bh[0]>ed||Bh[1]>ed)&&Kn(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${Vf}. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,$o,Bh,qn,to,Tn,!1,jt,dt,Va.lineStartIndex,Va.lineLength,-1,Nr,pn,xo,zl),Px=Ot.icon.placedSymbolArray.length-1,wm&&(GM=4*wm.length,Ot.addSymbols(Ot.icon,wm,Bh,qn,to,Tn,_a.vertical,jt,dt,Va.lineStartIndex,Va.lineLength,-1,Nr,pn,xo,zl),Ox=Ot.icon.placedSymbolArray.length-1)}for(let qo in Zt.horizontal){let $o=Zt.horizontal[qo];ps||(YM=Mc($o.text),_n?jM=rx($o):ps=S0(on,zh,dt,rn,ji,Pi,$o,Ui,qt.layout.get("text-rotate").evaluate(Tn,{},pn),un));let wm=$o.positionedLines.length===1;if(qM+=NS(Ot,jt,dt,$o,li,qt,_n,Tn,un,Va,Zt.vertical?_a.horizontal:_a.horizontalOnly,wm?Object.keys(Zt.horizontal):[qo],Ys,Px,ur,Nr,pn,xo),wm)break}Zt.vertical&&($M+=NS(Ot,jt,dt,Zt.vertical,li,qt,_n,Tn,un,Va,_a.vertical,["vertical"],Ys,Ox,ur,Nr,pn,xo));let ld=-1,zx=(qo,$o)=>qo?Math.max(qo,$o):$o;ld=zx(jM,ld),ld=zx(UM,ld),ld=zx(HM,ld);let x3=ld>-1?1:0;Ot.glyphOffsetArray.length>=65535&&Kn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tn.sortKey!==void 0&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,Tn.sortKey),Ot.symbolInstances.emplaceBack(dt.x,dt.y,zh.x,zh.y,zh.z,Ys.right>=0?Ys.right:-1,Ys.center>=0?Ys.center:-1,Ys.left>=0?Ys.left:-1,Ys.vertical>=0?Ys.vertical:-1,Px,Ox,YM,ps!==void 0?ps:Ot.collisionBoxArray.length,ps!==void 0?ps+1:Ot.collisionBoxArray.length,sd!==void 0?sd:Ot.collisionBoxArray.length,sd!==void 0?sd+1:Ot.collisionBoxArray.length,ad!==void 0?ad:Ot.collisionBoxArray.length,ad!==void 0?ad+1:Ot.collisionBoxArray.length,Fh||Ot.collisionBoxArray.length,Fh?Fh+1:Ot.collisionBoxArray.length,rn,qM,$M,WM,GM,x3,0,Lx,Fx,ld,0,1,1,Rx?1:0)})(i,ht,Lt,at,n,a,c,nt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Ce,ze,y,0,De,$e,W,e,m,w,M,T,P,R)};if(ot==="line")for(let at of AS(e.geometry,0,0,gt,gt)){let ht=QO(at,ve,Ue,n.vertical||J,a,te,he,i.overscaling,gt);for(let Vt of ht)J&&nR(i,J.text,We,Vt)||Mt(at,Vt,T)}else if(ot==="line-center"){for(let at of e.geometry)if(at.length>1){let ht=XO(at,Ue,n.vertical||J,a,te,he);ht&&Mt(at,ht,T)}}else if(e.type==="Polygon")for(let at of a0(e.geometry,0)){let ht=JO(at,16);Mt(at[0],new Fl(ht.x,ht.y,0,0,void 0),T)}else if(e.type==="LineString")for(let at of e.geometry)Mt(at,new Fl(at[0].x,at[0].y,0,0,void 0),T);else if(e.type==="Point")for(let at of e.geometry)for(let ht of at)Mt([ht],new Fl(ht.x,ht.y,0,0,void 0),T)}let Vf=255,ed=Vf*ss;function NS(i,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W){let J=function(pe,he,ve,Ce,De,Ue,ze,$e){let ot=[];if(he.positionedLines.length===0)return ot;let We=Ce.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,et=function(Mt){let at=Mt[0],ht=Mt[1],Vt=at*ht;return Vt>0?[at,-ht]:Vt<0?[-at,ht]:at===0?[ht,at]:[ht,-at]}(ve),He=Math.abs(he.top-he.bottom);for(let Mt of he.positionedLines)He-=Mt.lineOffset;let tt=he.positionedLines.length,ct=He/tt,nt=he.top-ve[1];for(let Mt=0;Mt<tt;++Mt){let at=he.positionedLines[Mt];nt=KO(he,ct,nt,Mt);for(let ht of at.positionedGlyphs){if(!ht.rect)continue;let Vt=ht.rect||{},Lt=yS+1,Ot=!0,dt=1,jt=0;if(ht.imageName){let qn=ze[ht.imageName];if(!qn)continue;if(qn.sdf){Kn("SDF images are not supported in formatted text and will be ignored.");continue}Ot=!1,dt=qn.pixelRatio,Lt=Wo/dt}let si=(De||$e)&&ht.vertical,Zt=ht.metrics.advance*ht.scale/2,hi=ht.metrics,li=ht.rect;if(li===null)continue;$e&&he.verticalizable&&(jt=ht.imageName?Zt-ht.metrics.width*ht.scale/2:0);let xi=De?[ht.x+Zt,ht.y]:[0,0],qt=[0,0],on=[0,0],rn=!1;De||(si?(on=[ht.x+Zt+et[0],ht.y+et[1]-jt],rn=!0):qt=[ht.x+Zt+ve[0],ht.y+ve[1]-jt]);let ji=li.w*ht.scale/(dt*(ht.localGlyph?ls:1)),Pi=li.h*ht.scale/(dt*(ht.localGlyph?ls:1)),Ui,_n,un,Nn;if(si){let qn=ht.y-nt,Tn=new xt(-Zt,Zt-qn),ur=-Math.PI/2,Br=new xt(...on);Ui=new xt(-Zt+qt[0],qt[1]),Ui._rotateAround(ur,Tn)._add(Br),Ui.x+=-qn+Zt,Ui.y-=(hi.left-Lt)*ht.scale;let Nr=ht.imageName?hi.advance*ht.scale:Yr*ht.scale,pn=String.fromCodePoint(ht.glyph);UO(pn)?Ui.x+=(1-Lt)*ht.scale:HO(pn)?Ui.x+=Nr-hi.height*ht.scale+(-Lt-1)*ht.scale:Ui.x+=ht.imageName||hi.width+2*Lt===li.w&&hi.height+2*Lt===li.h?(Nr-Pi)/2:(Nr-(hi.height+2*Lt)*ht.scale)/2,_n=new xt(Ui.x,Ui.y-ji),un=new xt(Ui.x+Pi,Ui.y),Nn=new xt(Ui.x+Pi,Ui.y-ji)}else{let qn=(hi.left-Lt)*ht.scale-Zt+qt[0],Tn=(-hi.top-Lt)*ht.scale+qt[1],ur=qn+ji,Br=Tn+Pi;Ui=new xt(qn,Tn),_n=new xt(ur,Tn),un=new xt(qn,Br),Nn=new xt(ur,Br)}if(We){let qn;qn=De?new xt(0,0):rn?new xt(et[0],et[1]):new xt(ve[0],ve[1]),Ui._rotateAround(We,qn),_n._rotateAround(We,qn),un._rotateAround(We,qn),Nn._rotateAround(We,qn)}let Rn=new xt(0,0),to=new xt(0,0);ot.push({tl:Ui,tr:_n,bl:un,br:Nn,texPrimary:Vt,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:xi,sectionIndex:ht.sectionIndex,isSDF:Ot,pixelOffsetTL:Rn,pixelOffsetBR:to,minFontScaleX:0,minFontScaleY:0})}}return ot}(0,a,y,m,p,b,c,i.allowVerticalPlacement),ee=i.textSizeData,te=null;ee.kind==="source"?(te=[ss*m.layout.get("text-size").evaluate(b,{},B)],te[0]>ed&&Kn(`${i.layerIds[0]}: Value for "text-size" is >= ${Vf}. Reduce your "text-size".`)):ee.kind==="composite"&&(te=[ss*R.compositeTextSizes[0].evaluate(b,{},B),ss*R.compositeTextSizes[1].evaluate(b,{},B)],(te[0]>ed||te[1]>ed)&&Kn(`${i.layerIds[0]}: Value for "text-size" is >= ${Vf}. Reduce your "text-size".`)),i.addSymbols(i.text,J,te,y,p,b,M,e,n,w.lineStartIndex,w.lineLength,P,F,B,W,!1);for(let pe of T)E[pe]=i.text.placedSymbolArray.length-1;return 4*J.length}function VS(i){for(let e in i)return i[e];return null}function S0(i,e,n,a,c,m,p,b,y,w){let M=p.top,T=p.bottom,E=p.left,P=p.right,R=p.collisionPadding;if(R&&(E-=R[0],M-=R[1],P+=R[2],T+=R[3]),y){let F=new xt(E,M),B=new xt(P,M),W=new xt(E,T),J=new xt(P,T),ee=Di(y),te=new xt(0,0);w&&(te=new xt(w[0],w[1])),F._rotateAround(ee,te),B._rotateAround(ee,te),W._rotateAround(ee,te),J._rotateAround(ee,te),E=Math.min(F.x,B.x,W.x,J.x),P=Math.max(F.x,B.x,W.x,J.x),M=Math.min(F.y,B.y,W.y,J.y),T=Math.max(F.y,B.y,W.y,J.y)}return i.emplaceBack(e.x,e.y,e.z,n.x,n.y,E,M,P,T,b,a,c,m),i.length-1}function rx(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);let e=i.bottom-i.top;return e>0?Math.max(10,e):null}function nR(i,e,n,a){let c=i.compareText;if(e in c){let m=c[e];for(let p=m.length-1;p>=0;p--)if(a.dist(m[p])<n)return!0}else c[e]=[];return c[e].push(a),!1}function jS(i,e){let n=i.fovAboveCenter,a=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,c=(i._camera.position[2]*i.worldSize-a)/Math.cos(i._pitch),m=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-i._pitch-n,.01)),p=Math.sin(i._pitch)*m+c;return Math.min(1.01*p,c*(1/i._horizonShift))}function Ah(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};let n=Math.pow(2,-i.z),a=i.x*n,c=(i.x+1)*n,m=i.y*n,p=(i.y+1)*n,b=Lo(a),y=Lo(c),w=zr(m),M=zr(p),T=e.project(b,w),E=e.project(y,w),P=e.project(y,M),R=e.project(b,M),F=Math.min(T.x,E.x,P.x,R.x),B=Math.min(T.y,E.y,P.y,R.y),W=Math.max(T.x,E.x,P.x,R.x),J=Math.max(T.y,E.y,P.y,R.y),ee=n/16;function te(he,ve,Ce,De,Ue,ze){let $e=(Ce+Ue)/2,ot=(De+ze)/2,We=e.project(Lo($e),zr(ot)),et=Math.max(0,F-We.x,B-We.y,We.x-W,We.y-J);F=Math.min(F,We.x),W=Math.max(W,We.x),B=Math.min(B,We.y),J=Math.max(J,We.y),et>ee&&(te(he,We,Ce,De,$e,ot),te(We,ve,$e,ot,Ue,ze))}te(T,E,a,m,c,m),te(E,P,c,m,c,p),te(P,R,c,p,a,p),te(R,T,a,p,a,m),F-=ee,B-=ee,W+=ee,J+=ee;let pe=1/Math.max(W-F,J-B);return{scale:pe,x:F*pe,y:B*pe,x2:W*pe,y2:J*pe,projection:e}}function US(i,{x:e,y:n},a=0){return new xt(((e-a)*i.scale-i.x)*gt,(n*i.scale-i.y)*gt)}let rR=t.ad.identity(new Float32Array(16));class td{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Fi(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return vo(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return jS(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,c){let m=e.horizonLineFromTop(!1),p=new xt(n,Math.max(m,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,n,a){let c=new xt(n,a);if(e.elevation)return e.elevation.pointCoordinate(c);{let m=this.pointCoordinate(e,c.x,c.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return rR}createTileMatrix(e,n,a){let c,m,p,b=a.canonical,y=t.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=Ah(b,this);c=1,m=w.x+a.wrap*w.scale,p=w.y,t.ad.scale(y,y,[c/w.scale,c/w.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*a.wrap)*c,p=b.y*c;return t.ad.translate(y,y,[m,p,0]),t.ad.scale(y,y,[c/gt,c/gt,1]),y}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class oR extends td{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Di(n));this.n=(c+Math.sin(Di(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:a,c,r0:m}=this,p=Di(e-this.center[0]),b=Di(n),y=Math.sqrt(c-2*a*Math.sin(b))/a;return{x:y*Math.sin(p*a),y:y*Math.cos(p*a)-m,z:0}}unproject(e,n){let{n:a,c,r0:m}=this,p=m+n,b=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(b-=Math.PI*Math.sign(e)*Math.sign(p));let y=Di(this.center[0])*a;b=ml(b,-Math.PI-y,Math.PI-y);let w=fi(Gr(b/a)+this.center[0],-180,180),M=Math.asin(fi((c-(e*e+p*p)*a*a)/(2*a),-1,1)),T=fi(Gr(M),-er,er);return new Fi(w,T)}}let jf=1.340264,Uf=-.081106,Hf=893e-6,Wf=.003796,M0=Math.sqrt(3)/2;class aR extends td{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(M0*Math.sin(n)),c=a*a,m=c*c*c;return{x:.5*(e*Math.cos(a)/(M0*(jf+3*Uf*c+m*(7*Hf+9*Wf*c)))/Math.PI+.5),y:1-.5*(a*(jf+Uf*c+m*(Hf+Wf*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=a*a,m=c*c*c;for(let M,T,E,P=0;P<12&&(T=a*(jf+Uf*c+m*(Hf+Wf*c))-n,E=jf+3*Uf*c+m*(7*Hf+9*Wf*c),M=T/E,a=fi(a-M,-Math.PI/3,Math.PI/3),c=a*a,m=c*c*c,!(Math.abs(M)<1e-12));++P);let p=M0*e*(jf+3*Uf*c+m*(7*Hf+9*Wf*c))/Math.cos(a),b=Math.asin(Math.sin(a)/M0),y=fi(180*p/Math.PI,-180,180),w=fi(180*b/Math.PI,-er,er);return new Fi(y,w)}}class sR extends td{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let a=360*(e-.5),c=fi(360*(.5-n),-er,er);return new Fi(a,c)}}let pm=Math.PI/2;function k0(i){return Math.tan((pm+i)/2)}class lR extends td{constructor(e){super(e),this.center=e.center||[0,30];let[n,a]=this.parallels=e.parallels||[30,30],c=Di(n),m=Di(a);this.southernCenter=c+m<0,this.southernCenter&&(c=-c,m=-m);let p=Math.cos(c),b=k0(c);this.n=c===m?Math.sin(c):Math.log(p/Math.cos(m))/Math.log(k0(m)/b),this.f=p*Math.pow(k0(c),this.n)/this.n}project(e,n){n=Di(n),this.southernCenter&&(n=-n),e=Di(e-this.center[0]);let a=1e-6,{n:c,f:m}=this;m>0?n<-pm+a&&(n=-pm+a):n>pm-a&&(n=pm-a);let p=m/Math.pow(k0(n),c),b=p*Math.sin(c*e),y=m-p*Math.cos(c*e);return b=.5*(b/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:b,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:a,f:c}=this,m=c-n,p=Math.sign(m),b=Math.sign(a)*Math.sqrt(e*e+m*m),y=Math.atan2(e,Math.abs(m))*p;m*a<0&&(y-=Math.PI*Math.sign(e)*p);let w=fi(Gr(y/a)+this.center[0],-180,180),M=fi(Gr(2*Math.atan(Math.pow(c/b,1/a))-pm),-er,er);return new Fi(w,this.southernCenter?-M:M)}}class HS extends td{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Us(e),y:Hs(n),z:0}}unproject(e,n){let a=Lo(e),c=zr(n);return new Fi(a,c)}}let WS=Di(er);class cR extends td{project(e,n){let a=(n=Di(n))*n,c=a*a;return{x:.5*((e=Di(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=25,m=0,p=a*a;do{p=a*a;let w=p*p;m=(a*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-n)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),a=fi(a-m,-WS,WS)}while(Math.abs(m)>1e-6&&--c>0);p=a*a;let b=fi(Gr(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=Gr(a);return new Fi(b,y)}}let GS=Di(er);class dR extends td{project(e,n){n=Di(n),e=Di(e);let a=Math.cos(n),c=2/Math.PI,m=Math.acos(a*Math.cos(e/2)),p=Math.sin(m)/m,b=.5*(e*c+2*a*Math.sin(e/2)/p)||0,y=.5*(n+Math.sin(n)/p)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,m=25,p=1e-6,b=0,y=0;do{let w=Math.cos(c),M=Math.sin(c),T=2*M*w,E=M*M,P=w*w,R=Math.cos(a/2),F=Math.sin(a/2),B=2*R*F,W=F*F,J=1-P*R*R,ee=J?1/J:0,te=J?Math.acos(w*R)*Math.sqrt(1/J):0,pe=.5*(2*te*w*F+2*a/Math.PI)-e,he=.5*(te*M+c)-n,ve=.5*ee*(P*W+te*w*R*E)+1/Math.PI,Ce=ee*(B*T/4-te*M*F),De=.125*ee*(T*F-te*M*P*B),Ue=.5*ee*(E*R+te*W*w)+.5,ze=Ce*De-Ue*ve;b=(he*Ce-pe*Ue)/ze,y=(pe*De-he*ve)/ze,a=fi(a-b,-Math.PI,Math.PI),c=fi(c-y,-GS,GS)}while((Math.abs(b)>p||Math.abs(y)>p)&&--m>0);return new Fi(Gr(a),Gr(c))}}class qS extends td{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Di(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:a,cosPhi:c}=this;return{x:Di(e)*c*a+.5,y:-Math.sin(Di(n))/c*a+.5,z:0}}unproject(e,n){let{scale:a,cosPhi:c}=this,m=-(n-.5)/a,p=fi(Gr((e-.5)/a)/c,-180,180),b=Math.asin(fi(m*c,-1,1)),y=fi(Gr(b),-er,er);return new Fi(p,y)}}class hR extends HS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){let c=If(e,n,a),m=Tf(Ws(a));return t._.transformMat4(c,c,m),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){let a=kh(n.lat,n.lng),c=t._.normalize([],a),m=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=vo(1,0)*gt*m;t._.scaleAndAdd(a,a,c,p);let b=t.ad.identity(new Float64Array(16));return t.ad.multiply(b,e.pixelMatrix,e.globeMatrix),t._.transformMat4(a,a,b),new xt(a[0],a[1])}pixelsPerMeter(e,n){return vo(1,0)*n}pixelSpaceConversion(e,n,a){let c=vo(1,e)*n,m=Wt(vo(1,45)*n,c,a);return this.pixelsPerMeter(e,n)/m}createTileMatrix(e,n,a){let c=Lv(Ws(a.canonical));return t.ad.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){let{center:a}=e,c=Tf(Ws(n));return t.ad.rotateY(c,c,Di(a.lng)),t.ad.rotateX(c,c,Di(a.lat)),t.ad.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,a,c){return JC(e,n,a,!0)||new eo(0,0)}pointCoordinate3D(e,n,a){let c=this.pointCoordinate(e,n,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!JC(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(c,m){let p=c.cameraToCenterDistance,b=c._centerAltitude*m,y=c._camera,w=c._camera.forward(),M=t._.add([],t._.scale([],w,-p),[0,0,b]),T=c.worldSize/(2*Math.PI),E=[0,0,-T],P=c.width/c.height,R=Math.tan(c.fovAboveCenter),F=t._.scale([],y.up(),R),B=t._.scale([],y.right(),R*P),W=t._.normalize([],t._.add([],t._.add([],w,F),B)),J=[],ee;if(new Dv(M,W).closestPointOnSphere(E,T,J)){let te=t._.add([],J,E),pe=t._.sub([],te,M);ee=Math.cos(c.fovAboveCenter)*t._.length(pe)}else{let te=t._.sub([],M,E),pe=t._.sub([],E,M);t._.normalize(pe,pe);let he=t._.length(te)-T;ee=Math.sqrt(he*(he+2*T));let ve=Math.acos(ee/(T+he))-Math.acos(t._.dot(w,pe));ee*=Math.cos(ve)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Rl(e.zoom);if(a>0){let c=jS(e,vo(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Wt(n,c+m*(1-Math.cos(p)),Math.pow(a,10))}return n}upVector(e,n,a){return If(n,a,e,1)}upVectorScale(e){return{metersToTile:e0(i0(Ws(e)))}}}function $S(i){let e=i.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new HS(i);case"equirectangular":return new sR(i);case"naturalEarth":return new cR(i);case"equalEarth":return new aR(i);case"winkelTripel":return new dR(i);case"albers":return n?new qS(i):new oR(i);case"lambertConformalConic":return n?new qS(i):new lR(i);case"globe":return new hR(i)}throw new Error(`Invalid projection name: ${i.name}`)}let uR=(()=>{class i{constructor(n,a,c,m){this.id=i.uniqueIdxCounter,i.uniqueIdxCounter++,this.context=n;let p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||m||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=i.uniqueIdxCounter,i.uniqueIdxCounter++;let a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return i.uniqueIdxCounter=0,i})();class fm{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}fm.ReadOnly=!1,fm.ReadWrite=!0,fm.disabled=new fm(519,fm.ReadOnly,[0,1]);let ox=7680;class ax{constructor(e,n,a,c,m,p){this.test=e,this.ref=n,this.mask=a,this.fail=c,this.depthFail=m,this.pass=p}}ax.disabled=new ax({func:519,mask:0},0,0,ox,ox,ox);let Gf=771;class Go{constructor(e,n,a,c){this.blendFunction=e,this.blendColor=n,this.mask=a,this.blendEquation=c}}Go.Replace=[1,0,1,0],Go.disabled=new Go(Go.Replace,Bi.transparent,[!1,!1,!1,!1]),Go.unblended=new Go(Go.Replace,Bi.transparent,[!0,!0,!0,!0]),Go.alphaBlended=new Go([1,Gf,1,Gf],Bi.transparent,[!0,!0,!0,!0]),Go.alphaBlendedNonPremultiplied=new Go([770,Gf,770,Gf],Bi.transparent,[!0,!0,!0,!0]),Go.multiply=new Go([774,0,774,0],Bi.transparent,[!0,!0,!0,!0]);let sx=1029,lx=2305;class cs{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}cs.disabled=new cs(!1,sx,lx),cs.backCCW=new cs(!0,sx,lx),cs.backCW=new cs(!0,sx,2304),cs.frontCW=new cs(!0,1028,2304),cs.frontCCW=new cs(!0,1028,lx);let mR=c0.types,pR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function I0(i,e,n,a,c,m,p,b,y,w,M,T,E){let P=b?Math.min(ed,Math.round(b[0])):0,R=b?Math.min(ed,Math.round(b[1])):0;i.emplaceBack(e,n,Math.round(32*a),Math.round(32*c),m,p,(P<<1)+(y?1:0),R,16*w,16*M,256*T,256*E)}function T0(i,e,n){i.emplaceBack(e,n)}function E0(i,e,n,a,c,m,p){i.emplaceBack(e,n,a,c,m,p)}function D0(i,e,n,a,c){i.emplaceBack(e,n,a,c),i.emplaceBack(e,n,a,c),i.emplaceBack(e,n,a,c),i.emplaceBack(e,n,a,c)}function fR(i){for(let e of i.sections)if(Ye(e.text))return!0;return!1}class cx{constructor(e){this.layoutVertexArray=new Jy,this.indexArray=new kr,this.programConfigurations=e,this.segments=new Pn,this.dynamicLayoutVertexArray=new Uc,this.opacityVertexArray=new tv,this.occlusionQueryOpacityVertexArray=new Ch,this.placedSymbolArray=new CC,this.iconTransitioningVertexArray=new Gc,this.globeExtVertexArray=new ev,this.zOffsetVertexArray=new Ch}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,c,m){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,bO.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,pR,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,Yv.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,yO.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,_O.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,tS.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ne(cx,"SymbolBuffers");class dx{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new Pn,this.collisionVertexArray=new rv,this.collisionVertexArrayExt=new Uc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,vO.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,xO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ne(dx,"CollisionBuffers");class gm{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=t.ad.identity([]),this.placementViewportMatrix=t.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Xv(this.zoom,n["text-size"]),this.iconSizeData=Xv(this.zoom,n["icon-size"]);let a=this.layers[0].layout,c=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>_a[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new cx(new $c(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new cx(new $c(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new kC,this.lineVertexArray=new IC,this.symbolInstances=new MC}calculateGlyphDependencies(e,n,a,c,m){for(let p=0;p<e.length;p++){let b=e.codePointAt(p);if(b===void 0)break;if(n[b]=!0,c&&m&&b<=65535){let y=zf[e.charAt(p)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!qv(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,n,a,c){let m=this.layers[0],p=m.layout,b=this.projection.name==="globe",y=p.get("text-font"),w=p.get("text-field"),M=p.get("icon-image"),T=(w.value.kind!=="constant"||w.value.value instanceof $r&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),E=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,P=p.get("symbol-sort-key");if(this.features=[],!T&&!E)return;let R=n.iconDependencies,F=n.glyphDependencies,B=n.availableImages,W=new Kt(this.zoom);for(let{feature:J,id:ee,index:te,sourceLayerIndex:pe}of e){let he=m._featureFilter.needGeometry,ve=Pl(J,he);if(!m._featureFilter.filter(W,ve,a))continue;if(he||(ve.geometry=as(J,a,c)),b&&J.type!==1&&a.z<=5){let ze=ve.geometry,$e=.98078528056,ot=(We,et)=>{let He=If(We.x,We.y,a,1),tt=If(et.x,et.y,a,1);return t._.dot(He,tt)<$e};for(let We=0;We<ze.length;We++)ze[We]=JA(ze[We],ot)}let Ce,De;if(T){let ze=m.getValueAndResolveTokens("text-field",ve,a,B),$e=$r.factory(ze);fR($e)&&(this.hasRTLText=!0),(!this.hasRTLText||vi()==="unavailable"||this.hasRTLText&&Ki.isParsed())&&(Ce=jO($e,m,ve))}if(E){let ze=m.getValueAndResolveTokens("icon-image",ve,a,B);De=ze instanceof lo?ze:lo.fromString(ze)}if(!Ce&&!De)continue;let Ue=this.sortFeaturesByKey?P.evaluate(ve,{},a):void 0;if(this.features.push({id:ee,text:Ce,icon:De,index:te,sourceLayerIndex:pe,geometry:ve.geometry,properties:J.properties,type:mR[J.type],sortKey:Ue}),De&&(R[De.namePrimary]=!0,De.nameSecondary&&(R[De.nameSecondary]=!0)),Ce){let ze=y.evaluate(ve,{},a).join(","),$e=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_a.vertical)>=0;for(let ot of Ce.sections)if(ot.image)R[ot.image.namePrimary]=!0;else{let We=Le(Ce.toString()),et=ot.fontStack||ze,He=F[et]=F[et]||{};this.calculateGlyphDependencies(ot.text,He,$e,this.allowVerticalPlacement,We)}}}p.get("symbol-placement")==="line"&&(this.features=function(J){let ee={},te={},pe=[],he=0;function ve(ze){pe.push(J[ze]),he++}function Ce(ze,$e,ot){let We=te[ze];return delete te[ze],te[$e]=We,pe[We].geometry[0].pop(),pe[We].geometry[0]=pe[We].geometry[0].concat(ot[0]),We}function De(ze,$e,ot){let We=ee[$e];return delete ee[$e],ee[ze]=We,pe[We].geometry[0].shift(),pe[We].geometry[0]=ot[0].concat(pe[We].geometry[0]),We}function Ue(ze,$e,ot){let We=ot?$e[0][$e[0].length-1]:$e[0][0];return`${ze}:${We.x}:${We.y}`}for(let ze=0;ze<J.length;ze++){let $e=J[ze],ot=$e.geometry,We=$e.text?$e.text.toString():null;if(!We){ve(ze);continue}let et=Ue(We,ot),He=Ue(We,ot,!0);if(et in te&&He in ee&&te[et]!==ee[He]){let tt=De(et,He,ot),ct=Ce(et,He,pe[tt].geometry);delete ee[et],delete te[He],te[Ue(We,pe[ct].geometry,!0)]=ct,pe[tt].geometry=null}else et in te?Ce(et,He,ot):He in ee?De(et,He,ot):(ve(ze),ee[et]=he-1,te[He]=he-1)}return pe.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ee)=>J.sortKey-ee.sortKey)}update(e,n,a,c,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,b,a,c,m),this.icon.programConfigurations.updatePaintArrays(e,n,b,a,c,m)}updateOcclusionOpacities(e,n,a){if(!n.useOcclusionQueries)return!1;let c=this;if(c.projection.name==="globe")return!1;let m=!1;c.hasTextData()&&(m=m||c.text.occlusionQueryOpacityVertexArray.length!==0),c.hasIconData()&&(m=m||c.icon.occlusionQueryOpacityVertexArray.length!==0);let p=c.layers[0].paint,b=p.get("icon-occlusion-opacity").constantOr(0),y=p.get("text-occlusion-opacity").constantOr(0);if(!c.layers[0].hasInitialOcclusionOpacityProperties||b===1&&y===1)return!1;let w=!m;for(let P=0;P<c.symbolInstances.length;P++){let R=c.symbolInstances.get(P),F=R.occlusionOpacity;R.occlusionOpacity+=(R.occlusionState>.5?1:-1)*n.fadeSpeed*a*.001,R.occlusionOpacity=fi(R.occlusionOpacity,0,1),w=w||R.occlusionOpacity!==F}if(!w)return!1;let M=0,T=0,E=(P,R,F,B)=>{let W=0,J=0;F?(W=T,T+=B,J=T):(W=M,M+=B,J=M),J>R.occlusionQueryOpacityVertexArray.length&&R.occlusionQueryOpacityVertexArray.resize(J);let ee=P.occlusionOpacity;for(let te=0;te<B;te++)R.occlusionQueryOpacityVertexArray.emplace(te+W,ee)};for(let P=0;P<c.symbolInstances.length;P++){let R=c.symbolInstances.get(P),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:B,numIconVertices:W}=R,J=W>0;if((F>0||B>0)&&(E(R,c.text,!1,F),E(R,c.text,!1,B)),J){let{placedIconSymbolIndex:ee,verticalPlacedIconSymbolIndex:te}=R;ee>=0&&E(R,c.icon,!0,W),te>=0&&E(R,c.icon,!0,R.numVerticalIconVertices)}}return c.hasTextData()&&c.text.occlusionQueryOpacityVertexBuffer&&(c.text.occlusionQueryOpacityVertexBuffer.length<c.text.occlusionQueryOpacityVertexArray.length?c.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.text.occlusionQueryOpacityVertexArray,Yv.members,!0):c.text.occlusionQueryOpacityVertexBuffer.updateData(c.text.occlusionQueryOpacityVertexArray)),c.hasIconData()&&c.icon.occlusionQueryOpacityVertexBuffer&&(c.icon.occlusionQueryOpacityVertexBuffer.length<c.icon.occlusionQueryOpacityVertexArray.length?c.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.icon.occlusionQueryOpacityVertexArray,Yv.members,!0):c.icon.occlusionQueryOpacityVertexBuffer.updateData(c.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(m,p,b)=>{a+=p,a>m.length&&m.resize(a);for(let y=-p;y<0;y++)m.emplace(y+a,b)},n=(m,p,b)=>{c+=p,c>m.length&&m.resize(c);for(let y=-p;y<0;y++)m.emplace(y+c,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:y,numIconVertices:w}=p,M=p.zOffset,T=w>0;if((b>0||y>0)&&(e(this.text.zOffsetVertexArray,b,M),e(this.text.zOffsetVertexArray,y,M)),T){let{placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:P}=p;E>=0&&n(this.icon.zOffsetVertexArray,w,M),P>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$S(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:c,y:m}of n)this.lineVertexArray.emplaceBack(c,m);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B){let W=e.indexArray,J=e.layoutVertexArray,ee=e.globeExtVertexArray,te=e.segments.prepareSegment(4*n.length,J,W,this.canOverlap?p.sortKey:void 0),pe=this.glyphOffsetArray.length,he=te.vertexLength,ve=this.allowVerticalPlacement&&b===_a.vertical?Math.PI/2:0,Ce=p.text&&p.text.sections;for(let Ue=0;Ue<n.length;Ue++){let{tl:ze,tr:$e,bl:ot,br:We,texPrimary:et,texSecondary:He,pixelOffsetTL:tt,pixelOffsetBR:ct,minFontScaleX:nt,minFontScaleY:Mt,glyphOffset:at,isSDF:ht,sectionIndex:Vt}=n[Ue],Lt=te.vertexLength,Ot=at[1];if(I0(J,w.x,w.y,ze.x,Ot+ze.y,et.x,et.y,a,ht,tt.x,tt.y,nt,Mt),I0(J,w.x,w.y,$e.x,Ot+$e.y,et.x+et.w,et.y,a,ht,ct.x,tt.y,nt,Mt),I0(J,w.x,w.y,ot.x,Ot+ot.y,et.x,et.y+et.h,a,ht,tt.x,ct.y,nt,Mt),I0(J,w.x,w.y,We.x,Ot+We.y,et.x+et.w,et.y+et.h,a,ht,ct.x,ct.y,nt,Mt),y){let{x:dt,y:jt,z:si}=y.anchor,[Zt,hi,li]=y.up;E0(ee,dt,jt,si,Zt,hi,li),E0(ee,dt,jt,si,Zt,hi,li),E0(ee,dt,jt,si,Zt,hi,li),E0(ee,dt,jt,si,Zt,hi,li),D0(e.dynamicLayoutVertexArray,dt,jt,si,ve)}else D0(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ve);if(B){let dt=He||et;T0(e.iconTransitioningVertexArray,dt.x,dt.y),T0(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y),T0(e.iconTransitioningVertexArray,dt.x,dt.y+dt.h),T0(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y+dt.h)}W.emplaceBack(Lt,Lt+1,Lt+2),W.emplaceBack(Lt+1,Lt+2,Lt+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),Ue!==n.length-1&&Vt===n[Ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,p,p.index,{},P,R,F,Ce&&Ce[Vt])}let De=y?y.anchor:w;e.placedSymbolArray.emplaceBack(De.x,De.y,De.z,w.x,w.y,pe,this.glyphOffsetArray.length-pe,he,M,T,w.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],b,0,!1,0,E,0)}_commitLayoutVertex(e,n,a,c,m,p,b){e.emplaceBack(n,a,c,m,p,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,n,a,c,m,p,b){let y=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),w=y.vertexLength,M=b.tileAnchorX,T=b.tileAnchorY;for(let P=0;P<4;P++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,b.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new xt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new xt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new xt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new xt(e.x1,e.y2)),y.vertexLength+=4;let E=a.indexArray;E.emplaceBack(w,w+1),E.emplaceBack(w+1,w+2),E.emplaceBack(w+2,w+3),E.emplaceBack(w+3,w),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceTextSize(e,p,n,b);this._addCollisionDebugVertices(y,w,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(y,w,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dx(G_,iS.members,Gc),this.iconCollisionBox=new dx(G_,iS.members,Gc);let a=dm(this.iconSizeData,e),c=dm(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,a,c){let m=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),p=y0(this.textSizeData,e,m)/Yr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,a){let c=this.icon.placedSymbolArray.get(a),m=y0(this.iconSizeData,e,c);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,n,a,c){e.emplaceBack(n,-a,-a,c),e.emplaceBack(n,a,-a,c),e.emplaceBack(n,a,a,c),e.emplaceBack(n,-a,a,c)}_updateTextDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceTextSize(e,p,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,y.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,y.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=dm(this.iconSizeData,e),c=dm(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,c,m,p,b,y,w){let M={};if(n<a){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(n);M.textBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.textFeatureIndex=pe}if(c<m){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(c);M.verticalTextBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.verticalTextFeatureIndex=pe}if(p<b){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(p);M.iconBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.iconFeatureIndex=pe}if(y<w){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(y);M.verticalIconBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.verticalIconFeatureIndex=pe}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let a=e.placedSymbolArray.get(n),c=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),a=Math.cos(e),c=[],m=[],p=[];for(let b=0;b<this.symbolInstances.length;++b){p.push(b);let y=this.symbolInstances.get(b);c.push(0|Math.round(n*y.tileAnchorX+a*y.tileAnchorY)),m.push(y.featureIndex)}return p.sort((b,y)=>c[b]-c[y]||m[y]-m[b]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:w}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),m>=0&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),p>=0&&p!==m&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ne(gm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),gm.addDynamicAttributes=D0;class Ba{constructor(e,n,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,a){let{width:c,height:m}=e,{context:p}=this,{gl:b}=p;if(b.bindTexture(b.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===c&&this.size[1]===m){let{x:y,y:w}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)b.texSubImage2D(b.TEXTURE_2D,0,y,w,b.RGBA,b.UNSIGNED_BYTE,e);else{let M=this.format,T=b.UNSIGNED_BYTE;this.format===b.R32F&&(M=b.RED,T=b.FLOAT),b.texSubImage2D(b.TEXTURE_2D,0,y,w,c,m,M,T,e.data)}}else if(this.size=[c,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===b.R8&&(y=b.RED),b.texImage2D(b.TEXTURE_2D,0,this.format,y,b.UNSIGNED_BYTE,e)}else{let y=this.format,w=this.format,M=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(y=b.DEPTH_COMPONENT16,M=b.UNSIGNED_SHORT),this.format===b.R8&&(w=b.RED),this.format===b.R32F&&(M=b.FLOAT,w=b.RED),b.texImage2D(b.TEXTURE_2D,0,y,c,m,0,w,M,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n,a=!1){let{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,c){let{context:m}=this,{gl:p}=m;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class A0{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}let Na=32,qs=33,id=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,n=0,a=0,c=0,m=0,p=0,b=0;for(1&e?c=m=p=Na:n=a=b=Na;(e>>=1)>1;){let w=n+c>>1,M=a+m>>1;1&e?(c=n,m=a,n=p,a=b):(n=c,a=m,c=p,m=b),p=w,b=M}let y=4*i;id[y+0]=n,id[y+1]=a,id[y+2]=c,id[y+3]=m}let $s=new Uint16Array(2178),nd=new Uint8Array(1089),P0=new Uint16Array(1089);function YS(i){return i===0?-.03125:i===32?.03125:0}var O0=$i([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),gR=$i([{name:"a_index",type:"Int16",components:1}]);let ZS={type:2,extent:gt,loadGeometry:()=>[[new xt(0,0),new xt(gt+1,0),new xt(gt+1,gt+1),new xt(0,gt+1),new xt(0,0)]]};class R0{constructor(e,n,a,c,m){this.tileID=e,this.uid=mu(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,c&&c.style&&(this._lastUpdatedBrightness=c.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Rr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ah(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,m){let p={};if(!m)return p;for(let b of c){let y=b.layerIds.map(w=>m.getLayer(w)).filter(Boolean);if(y.length!==0){b.layers=y,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(w=>y.filter(M=>M.id===w)[0]));for(let w of y)p[w.fqid]=b}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let c in this.buckets){let m=this.buckets[c];if(m instanceof gm){if(this.hasSymbolBuckets=!0,!a)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let c in this.buckets){let m=this.buckets[c];if(m instanceof gm&&m.hasRTLText){this.hasRTLText=!0,Ki.isLoading()||Ki.isLoaded()||vi()!=="deferred"||Ai();break}}this.queryPadding=0;for(let c in this.buckets){let m=this.buckets[c],p=n.style.getOwnLayer(c);if(!p)continue;let b=p.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,b)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new uv}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let c in this.buckets){let m=this.buckets[c];m.uploadPending()&&m.upload(e)}let n=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){let c=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new Ba(e,a.image,n.RGBA,{useMipmap:c}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ba(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ba(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let c=n.style.getBrightness();(this._lastUpdatedBrightness||c)&&(this._lastUpdatedBrightness&&c&&Math.abs(this._lastUpdatedBrightness-c)<.001||(this._lastUpdatedBrightness=c,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,a,c,m,p,b,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:b,transform:p,params:m,tileTransform:this.tileTransform},e,n,a):{}}querySourceFeatures(e,n){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let c=a.loadVTLayers(),m=n?n.sourceLayer:"",p=c._geojsonTileLayer||c[m];if(!p)return;let b=wr(n&&n.filter),{z:y,x:w,y:M}=this.tileID.canonical,T={z:y,x:w,y:M};for(let E=0;E<p.length;E++){let P=p.feature(E);if(b.needGeometry){let B=Pl(P,!0);if(!b.filter(new Kt(this.tileID.overscaledZ),B,this.tileID.canonical))continue}else if(!b.filter(new Kt(this.tileID.overscaledZ),P))continue;let R=a.getId(P,m),F=new gS(P,y,w,M,R);F.tile=T,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let a=Mp(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let a=Date.now(),c=!1;if(this.expirationTime>a)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{let m=this.expirationTime-n;m?this.expirationTime=a+Math.max(m,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let a=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages(),m=n.style.getBrightness();for(let p in this.buckets){if(!n.style.hasLayer(p))continue;let b=this.buckets[p],y=b.layers[0].sourceLayer||"_geojsonTileLayer",w=a[y],M={};if(e&&(M=e[y],!w||!M||Object.keys(M).length===0))continue;if(b.update(M,w,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},m),b instanceof f0||b instanceof s0){let E=n.style.getOwnSourceCache(b.layers[0].source);n._terrain&&n._terrain.enabled&&E&&b.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(E.id,this.tileID)}let T=n&&n.style&&n.style.getOwnLayer(p);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Rr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Rr.now()+e}setTexture(e,n){let a=n.context,c=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Ba?this.texture.update(e,{useMipmap:!0}):(this.texture=new Ba(a,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,n){let a={};for(let c of n)a[c]=!0;this.dependencies[e]=a}hasDependency(e,n){for(let a of e){let c=this.dependencies[a];if(c){for(let m of n)if(c[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let a=as(ZS,this.tileID.canonical,this.tileTransform)[0],c=new rs,m=new vf;for(let p=0;p<a.length;p++){let{x:b,y}=a[p];c.emplaceBack(b,y),m.emplaceBack(p)}m.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(c,kf.members),this._tileDebugSegments=Pn.simpleSegment(0,0,c.length,m.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let a=as(ZS,this.tileID.canonical,this.tileTransform)[0],c,m;if(this.isRaster){let p=function(b,y){let w=Ah(b,y),M=Math.pow(2,b.z);for(let B=0;B<qs;B++)for(let W=0;W<qs;W++){let J=Lo((b.x+(W+YS(W))/Na)/M),ee=zr((b.y+(B+YS(B))/Na)/M),te=y.project(J,ee),pe=B*qs+W;$s[2*pe+0]=Math.round((te.x*w.scale-w.x)*gt),$s[2*pe+1]=Math.round((te.y*w.scale-w.y)*gt)}nd.fill(0),P0.fill(0);for(let B=2045;B>=0;B--){let W=4*B,J=id[W+0],ee=id[W+1],te=id[W+2],pe=id[W+3],he=J+te>>1,ve=ee+pe>>1,Ce=he+ve-ee,De=ve+J-he,Ue=ee*qs+J,ze=pe*qs+te,$e=ve*qs+he,ot=Math.hypot(($s[2*Ue+0]+$s[2*ze+0])/2-$s[2*$e+0],($s[2*Ue+1]+$s[2*ze+1])/2-$s[2*$e+1])>=16;nd[$e]=nd[$e]||(ot?1:0),B<1022&&(nd[$e]=nd[$e]||nd[(ee+De>>1)*qs+(J+Ce>>1)]||nd[(pe+De>>1)*qs+(te+Ce>>1)])}let T=new jc,E=new kr,P=0;function R(B,W){let J=W*qs+B;return P0[J]===0&&(T.emplaceBack($s[2*J+0],$s[2*J+1],B*gt/Na,W*gt/Na),P0[J]=++P),P0[J]-1}function F(B,W,J,ee,te,pe){let he=B+J>>1,ve=W+ee>>1;if(Math.abs(B-te)+Math.abs(W-pe)>1&&nd[ve*qs+he])F(te,pe,B,W,he,ve),F(J,ee,te,pe,he,ve);else{let Ce=R(B,W),De=R(J,ee),Ue=R(te,pe);E.emplaceBack(Ce,De,Ue)}}return F(0,0,Na,Na,Na,0),F(Na,Na,0,0,0,Na),{vertices:T,indices:E}}(this.tileID.canonical,n);c=p.vertices,m=p.indices}else{c=new jc,m=new kr;for(let{x:b,y}of a)c.emplaceBack(b,y,0,0);let p=Df(c.int16,void 0,4);for(let b=0;b<p.length;b+=3)m.emplaceBack(p[b],p[b+1],p[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,O0.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(m),this._tileBoundsSegments=Pn.simpleSegment(0,0,c.length,m.length)}_makeGlobeTileDebugBuffers(e,n){let a=n.projection;if(!a||a.name!=="globe"||n.freezeTileCoverage)return;let c=this.tileID.canonical,m=Tf(e2(c,n)),p=Rl(n.zoom),b;p>0&&(b=t.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,n,m,b,p),this._makeGlobeTileDebugTextBuffer(e,c,n,m,b,p)}_globePoint(e,n,a,c,m,p,b){let y=If(e,n,a);if(p){let w=1<<a.z,M=Us(c.center.lng),T=Hs(c.center.lat),E=(a.x+.5)/w-M,P=0;E>.5?P=-1:E<-.5&&(P=1);let R=(e/gt+a.x)/w+P,F=(n/gt+a.y)/w;R=(R-M)*c._pixelsPerMercatorPixel+M,F=(F-T)*c._pixelsPerMercatorPixel+T;let B=[R*c.worldSize,F*c.worldSize,0];t._.transformMat4(B,B,p),y=Ol(y,B,b)}return t._.transformMat4(y,y,m)}_makeGlobeTileDebugBorderBuffer(e,n,a,c,m,p){let b=new rs,y=new vf,w=new U_,M=(E,P,R,F,B)=>{let W=(R-E)/(B-1),J=(F-P)/(B-1),ee=b.length;for(let te=0;te<B;te++){let pe=E+te*W,he=P+te*J;b.emplaceBack(pe,he);let ve=this._globePoint(pe,he,n,a,c,m,p);w.emplaceBack(ve[0],ve[1],ve[2]),y.emplaceBack(ee+te)}},T=gt;M(0,0,T,0,16),M(T,0,T,T,16),M(T,T,0,T,16),M(0,T,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(b,kf.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,KC.members),this._tileDebugSegments=Pn.simpleSegment(0,0,b.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,a,c,m,p){let b=gt/4,y=new rs,w=new kr,M=new U_,T=25;w.reserve(32),y.reserve(T),M.reserve(T);let E=(P,R)=>T*P+R;for(let P=0;P<T;P++){let R=P*b;for(let F=0;F<T;F++){let B=F*b;y.emplaceBack(B,R);let W=this._globePoint(B,R,n,a,c,m,p);M.emplaceBack(W[0],W[1],W[2])}}for(let P=0;P<4;P++)for(let R=0;R<4;R++){let F=E(P,R),B=E(P,R+1),W=E(P+1,R),J=E(P+1,R+1);w.emplaceBack(F,B,W),w.emplaceBack(W,B,J)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(y,kf.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(M,KC.members),this._tileDebugTextSegments=Pn.simpleSegment(0,0,T,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Ba&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let oi={read:function(i,e){return i.readFields(oi._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(i,e,n){i===1?e.header_length=n.readFixed32():i===2?e.x=n.readVarint():i===3?e.y=n.readVarint():i===4?e.z=n.readVarint():i===5&&e.layers.push(oi.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};oi.Filter.read=function(i,e){return i.readFields(oi.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},oi.Filter._readField=function(i,e,n){i===1?(e.delta_filter=oi.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):i===2?(e.zigzag_filter=oi.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):i===3?(e.bitshuffle_filter=oi.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):i===4&&(e.byteshuffle_filter=oi.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},oi.Filter.Delta={},oi.Filter.Delta.read=function(i,e){return i.readFields(oi.Filter.Delta._readField,{block_size:0},e)},oi.Filter.Delta._readField=function(i,e,n){i===1&&(e.block_size=n.readVarint())},oi.Filter.Zigzag={},oi.Filter.Zigzag.read=function(i,e){return i.readFields(oi.Filter.Zigzag._readField,{},e)},oi.Filter.Zigzag._readField=function(i,e,n){},oi.Filter.BitShuffle={},oi.Filter.BitShuffle.read=function(i,e){return i.readFields(oi.Filter.BitShuffle._readField,{},e)},oi.Filter.BitShuffle._readField=function(i,e,n){},oi.Filter.ByteShuffle={},oi.Filter.ByteShuffle.read=function(i,e){return i.readFields(oi.Filter.ByteShuffle._readField,{},e)},oi.Filter.ByteShuffle._readField=function(i,e,n){},oi.Codec={},oi.Codec.read=function(i,e){return i.readFields(oi.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},oi.Codec._readField=function(i,e,n){i===1?(e.gzip_data=oi.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):i===2?(e.jpeg_image=oi.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):i===3?(e.webp_image=oi.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):i===4&&(e.png_image=oi.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},oi.Codec.GzipData={},oi.Codec.GzipData.read=function(i,e){return i.readFields(oi.Codec.GzipData._readField,{},e)},oi.Codec.GzipData._readField=function(i,e,n){},oi.Codec.JpegImage={},oi.Codec.JpegImage.read=function(i,e){return i.readFields(oi.Codec.JpegImage._readField,{},e)},oi.Codec.JpegImage._readField=function(i,e,n){},oi.Codec.WebpImage={},oi.Codec.WebpImage.read=function(i,e){return i.readFields(oi.Codec.WebpImage._readField,{},e)},oi.Codec.WebpImage._readField=function(i,e,n){},oi.Codec.PngImage={},oi.Codec.PngImage.read=function(i,e){return i.readFields(oi.Codec.PngImage._readField,{},e)},oi.Codec.PngImage._readField=function(i,e,n){},oi.DataIndexEntry={},oi.DataIndexEntry.read=function(i,e){return i.readFields(oi.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},oi.DataIndexEntry._readField=function(i,e,n){i===1?e.first_byte=n.readFixed64():i===2?e.last_byte=n.readFixed64():i===3?e.filters.push(oi.Filter.read(n,n.readVarint()+n.pos)):i===4?e.codec=oi.Codec.read(n,n.readVarint()+n.pos):i===5?e.offset=n.readFloat():i===6?e.scale=n.readFloat():i===7&&e.bands.push(n.readString())},oi.Layer={},oi.Layer.read=function(i,e){return i.readFields(oi.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},oi.Layer._readField=function(i,e,n){i===1?e.version=n.readVarint():i===2?e.name=n.readString():i===3?e.units=n.readString():i===4?e.tilesize=n.readVarint():i===5?e.buffer=n.readVarint():i===6?e.pixel_format=n.readVarint():i===7&&e.data_index.push(oi.DataIndexEntry.read(n,n.readVarint()+n.pos))};let ds={read:function(i,e){return i.readFields(ds._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(i,e,n){i===2?(e.uint32_values=ds.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):i===3&&(e.fixed32_values=ds.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};ds.Uint32Values.read=function(i,e){return i.readFields(ds.Uint32Values._readField,{values:[]},e)},ds.Uint32Values._readField=function(i,e,n){i===1&&(e.readValuesInto=function(a){if(a.type!==2)throw new Error(`Unsupported pbf type "${a.type}"`);let c=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(a),m=a.pos;return a.pos=c,function(p){a.pos=m;let b=0;for(;a.pos<c;){let y=a.readVarint();p[b++]=y}return p}}(n))},ds.Fixed32Values={},ds.Fixed32Values.read=function(i,e){return i.readFields(ds.Fixed32Values._readField,{values:[]},e)},ds.Fixed32Values._readField=function(i,e,n){throw new Error("Not implemented")};class _R{constructor(e=0,n=0,a=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=a,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let a=this.items[e];this.ttl>0&&a.expiry<=Date.now()?this.delete(e):(n=a.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,a=!1,c=this.resetTtl){let m;if(a||this.has(e)){if(m=this.items[e],m.value=n,a===!1&&c&&(m.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==m){let p=this.last,b=m.next,y=m.prev;this.first===m&&(this.first=m.next),m.next=null,m.prev=this.last,p.next=m,y!==null&&(y.next=b),b!==null&&(b.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),m=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=m:this.last.next=m;return this.last=m,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function bR(i,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){let c=a===1?1:0,m=a===2?1:0;for(let p=0;p<e[0];p++){let b=e[1]*p;for(let y=c;y<e[1];y++){let w=e[2]*(y+b);for(let M=m;M<e[2];M++){let T=e[3]*(M+w);for(let E=0;E<e[3];E++){let P=T+E;i[P]+=i[P-n]}}}}n*=e[a]}return i}function yR(i){for(let e=0,n=i.length;e<n;e++)i[e]=i[e]>>>1^-(1&i[e]);return i}function vR(i,e){switch(e){case"uint32":return i;case"uint16":for(let n=0;n<i.length;n+=2){let a=i[n],c=i[n+1];i[n]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,i[n+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return i;case"uint8":for(let n=0;n<i.length;n+=4){let a=i[n],c=i[n+1],m=i[n+2],p=i[n+3];i[n+0]=(192&a)>>6|(192&c)>>4|(192&m)>>2|192&p,i[n+1]=(48&a)>>4|(48&c)>>2|48&m|(48&p)<<2,i[n+2]=(12&a)>>2|12&c|(12&m)<<2|(12&p)<<4,i[n+3]=3&a|(3&c)<<2|(3&m)<<4|(3&p)<<6}return i;default:throw new Error(`Invalid pixel format, "${e}"`)}}class rd extends Error{constructor(e){super(e),this.name="MRTError"}}var ba=Uint8Array,_m=Uint16Array,xR=Int32Array,XS=new ba([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),QS=new ba([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wR=new ba([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),KS=function(i,e){for(var n=new _m(31),a=0;a<31;++a)n[a]=e+=1<<i[a-1];var c=new xR(n[30]);for(a=1;a<30;++a)for(var m=n[a];m<n[a+1];++m)c[m]=m-n[a]<<5|a;return{b:n,r:c}},JS=KS(XS,2),eM=JS.b,CR=JS.r;eM[28]=258,CR[258]=28;for(var SR=KS(QS,0).b,hx=new _m(32768),ar=0;ar<32768;++ar){var bm=(43690&ar)>>1|(21845&ar)<<1;hx[ar]=((65280&(bm=(61680&(bm=(52428&bm)>>2|(13107&bm)<<2))>>4|(3855&bm)<<4))>>8|(255&bm)<<8)>>1}var qf=function(i,e,n){for(var a=i.length,c=0,m=new _m(e);c<a;++c)i[c]&&++m[i[c]-1];var p,b=new _m(e);for(c=1;c<e;++c)b[c]=b[c-1]+m[c-1]<<1;if(n){p=new _m(1<<e);var y=15-e;for(c=0;c<a;++c)if(i[c])for(var w=c<<4|i[c],M=e-i[c],T=b[i[c]-1]++<<M,E=T|(1<<M)-1;T<=E;++T)p[hx[T]>>y]=w}else for(p=new _m(a),c=0;c<a;++c)i[c]&&(p[c]=hx[b[i[c]-1]++]>>15-i[c]);return p},$f=new ba(288);for(ar=0;ar<144;++ar)$f[ar]=8;for(ar=144;ar<256;++ar)$f[ar]=9;for(ar=256;ar<280;++ar)$f[ar]=7;for(ar=280;ar<288;++ar)$f[ar]=8;var tM=new ba(32);for(ar=0;ar<32;++ar)tM[ar]=5;var MR=qf($f,9,1),kR=qf(tM,5,1),ux=function(i){for(var e=i[0],n=1;n<i.length;++n)i[n]>e&&(e=i[n]);return e},hs=function(i,e,n){var a=e/8|0;return(i[a]|i[a+1]<<8)>>(7&e)&n},mx=function(i,e){var n=e/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(7&e)},IR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],us=function(i,e,n){var a=new Error(e||IR[i]);if(a.code=i,Error.captureStackTrace&&Error.captureStackTrace(a,us),!n)throw a;return a},TR=new ba(0),ER=typeof TextDecoder<"u"&&new TextDecoder;try{ER.decode(TR,{stream:!0})}catch{}let DR={gzip_data:"gzip"},AR={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},PR={uint32:1,uint16:2,uint8:4},OR={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class px{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new rd("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new rd(`Expected header with length >= ${a} but got buffer of length ${n.length}`);let c=new cm(n.subarray(0,a)),m=oi.read(c);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new rd(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(let p of m.layers)this.layers[p.name]=new RR(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],a=this.getLayer(e.layerName);for(let c=0;c<a.dataIndex.length;c++){let m=a.dataIndex[c],p=m.first_byte-e.firstByte,b=m.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||a._blocksInProgress.has(c))continue;let y={layerName:a.name,firstByte:p,lastByte:b,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[m.bands.length].concat(a.bandShape),buffer:a.buffer,codec:m.codec.codec,filters:m.filters.map(w=>w.filter)};a._blocksInProgress.add(c),n.push(y)}return new iM(n,()=>{n.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,m)=>{if(n.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),c)throw c;m.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class RR{constructor({version:e,name:n,units:a,tilesize:c,pixel_format:m,buffer:p,data_index:b},y){if(this.version=e,this.version!==1)throw new rd(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=c,this.buffer=p,this.pixelFormat=AR[m],this.dataIndex=b,this.bandShape=[c+2*p,c+2*p,PR[this.pixelFormat]],this._decodedBlocks=function(w=1e3,M=0,T=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(M)||M<0)throw new TypeError("Invalid ttl value");if(typeof T!="boolean")throw new TypeError("Invalid resetTtl value");return new _R(w,M,T)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[a,c]of this.dataIndex.entries()){for(let[m,p]of c.bands.entries())if(p===e)return{bandIndex:n+m,blockIndex:a,blockBandIndex:m};n+=c.bands.length}break;case"number":for(let[a,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new rd(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new rd(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,a=-1/0,c=1/0,m=-1/0;for(let p of e){let{blockIndex:b}=this.getBlockForBand(p);if(b<0)throw new rd(`Invalid band: ${JSON.stringify(p)}`);let y=this.dataIndex[b];c=Math.min(c,b),m=Math.max(m,b),n=Math.min(n,y.first_byte),a=Math.max(a,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:a,firstBlock:c,lastBlock:m}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e),c=this._decodedBlocks.get(n.toString());if(!c)throw new rd(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[n],p=this.bandShape.reduce((w,M)=>w*M,1),b=a*p,y=c.subarray(b,b+p);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:m.offset,scale:m.scale}}}class iM{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}px.performDecoding=function(i,e){return Promise.all(e.tasks.map(n=>{let{layerName:a,firstByte:c,lastByte:m,pixelFormat:p,blockShape:b,blockIndex:y,filters:w,codec:M}=n,T=new Uint8Array(i).subarray(c,m+1),E=new Uint32Array(b[0]*b[1]*b[2]),P;if(M!=="gzip_data")throw new Error(`Unhandled codec: ${M}`);return P=function(R,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((ee=function(he){he[0]==31&&he[1]==139&&he[2]==8||us(6,"invalid gzip data");var ve=he[3],Ce=10;4&ve&&(Ce+=2+(he[10]|he[11]<<8));for(var De=(ve>>3&1)+(ve>>4&1);De>0;De-=!he[Ce++]);return Ce+(2&ve)}(J=R))+8>J.length&&us(6,"invalid gzip data"),function(he,ve,Ce,De){var Ue=he.length;if(!Ue||ve.f&&!ve.l)return Ce||new ba(0);var ze=!Ce,$e=ze||ve.i!=2,ot=ve.i;ze&&(Ce=new ba(3*Ue));var We,et,He=function(ad){var sd=Ce.length;if(ad>sd){var Fh=new ba(Math.max(2*sd,ad));Fh.set(Ce),Ce=Fh}},tt=ve.f||0,ct=ve.p||0,nt=ve.b||0,Mt=ve.l,at=ve.d,ht=ve.m,Vt=ve.n,Lt=8*Ue;do{if(!Mt){tt=hs(he,ct,1);var Ot=hs(he,ct+1,3);if(ct+=3,!Ot){var dt=he[(Pi=4+((ct+7)/8|0))-4]|he[Pi-3]<<8,jt=Pi+dt;if(jt>Ue){ot&&us(0);break}$e&&He(nt+dt),Ce.set(he.subarray(Pi,jt),nt),ve.b=nt+=dt,ve.p=ct=8*jt,ve.f=tt;continue}if(Ot==1)Mt=MR,at=kR,ht=9,Vt=5;else if(Ot==2){var si=hs(he,ct,31)+257,Zt=hs(he,ct+10,15)+4,hi=si+hs(he,ct+5,31)+1;ct+=14;for(var li=new ba(hi),xi=new ba(19),qt=0;qt<Zt;++qt)xi[wR[qt]]=hs(he,ct+3*qt,7);ct+=3*Zt;var on=ux(xi),rn=(1<<on)-1,ji=qf(xi,on,1);for(qt=0;qt<hi;){var Pi,Ui=ji[hs(he,ct,rn)];if(ct+=15&Ui,(Pi=Ui>>4)<16)li[qt++]=Pi;else{var _n=0,un=0;for(Pi==16?(un=3+hs(he,ct,3),ct+=2,_n=li[qt-1]):Pi==17?(un=3+hs(he,ct,7),ct+=3):Pi==18&&(un=11+hs(he,ct,127),ct+=7);un--;)li[qt++]=_n}}var Nn=li.subarray(0,si),Rn=li.subarray(si);ht=ux(Nn),Vt=ux(Rn),Mt=qf(Nn,ht,1),at=qf(Rn,Vt,1)}else us(1);if(ct>Lt){ot&&us(0);break}}$e&&He(nt+131072);for(var to=(1<<ht)-1,qn=(1<<Vt)-1,Tn=ct;;Tn=ct){var ur=(_n=Mt[mx(he,ct)&to])>>4;if((ct+=15&_n)>Lt){ot&&us(0);break}if(_n||us(2),ur<256)Ce[nt++]=ur;else{if(ur==256){Tn=ct,Mt=null;break}var Br=ur-254;ur>264&&(Br=hs(he,ct,(1<<(xo=XS[qt=ur-257]))-1)+eM[qt],ct+=xo);var Nr=at[mx(he,ct)&qn],pn=Nr>>4;if(Nr||us(3),ct+=15&Nr,Rn=SR[pn],pn>3){var xo=QS[pn];Rn+=mx(he,ct)&(1<<xo)-1,ct+=xo}if(ct>Lt){ot&&us(0);break}$e&&He(nt+131072);var zl=nt+Br;if(nt<Rn){var Va=0-Rn,ps=Math.min(Rn,zl);for(Va+nt<0&&us(3);nt<ps;++nt)Ce[nt]=(void 0)[Va+nt]}for(;nt<zl;++nt)Ce[nt]=Ce[nt-Rn]}}ve.l=Mt,ve.p=Tn,ve.b=nt,ve.f=tt,Mt&&(tt=1,ve.m=ht,ve.d=at,ve.n=Vt)}while(!tt);return nt!=Ce.length&&ze?(We=Ce,((et=nt)==null||et>We.length)&&(et=We.length),new ba(We.subarray(0,et))):Ce.subarray(0,nt)}(J.subarray(ee,-8),{i:2},new ba(((B=J)[(W=B.length)-4]|B[W-3]<<8|B[W-2]<<16|B[W-1]<<24)>>>0))));var B,W,J,ee;let te=DR[F];if(!te)throw new Error(`Unhandled codec: ${F}`);let pe=new globalThis.DecompressionStream(te);return new Response(new Blob([R]).stream().pipeThrough(pe)).arrayBuffer().then(he=>new Uint8Array(he))}(T,M).then(R=>{let F=ds.read(new cm(R));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(E),new OR[p](E.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),P.then(R=>{for(let F=w.length-1;F>=0;F--)switch(w[F]){case"delta_filter":bR(R,b);break;case"zigzag_filter":yR(R);break;case"bitshuffle_filter":vR(R,p);break;default:throw new Error(`Unhandled filter "${w[F]}"`)}return{layerName:a,blockIndex:y,data:R}}).catch(R=>{throw R})}))};class nM extends R0{constructor(e,n,a,c,m){super(e,n,a,c,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let a=n.context,c=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Ba?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Ba(a,e,c.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let a=this._mrt=new px(30),c=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=gl(c,(m,p,b,y)=>{if(m)n(m);else try{let w=a.getHeaderLength(p);if(w>e)return void(this.request=this.fetchHeader(w,n));a.parseHeader(p),this._isHeaderLoaded=!0;let M=0;for(let T of Object.values(a.layers))M=Math.max(M,T.dataIndex[T.dataIndex.length-1].last_byte);p.byteLength>=M&&(this.entireBuffer=p),n(null,this.entireBuffer||p,b,y)}catch(w){n(w)}}),this.request}fetchBand(e,n,a){let c=this._mrt;if(!this._isHeaderLoaded||!c)return void a(new Error("Tile header is not ready"));let m=this.actor;if(!m)return void a(new Error("Can't fetch tile band without an actor"));let p,b=(T,E)=>{p.complete(T,E),T?a(T):(this.updateTextureDescriptor(e,n),a(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(T,E)=>{if(T)return a(T);let P=m.send("decodeRasterArray",{buffer:E,task:p},b,void 0,!0);this._workQueue.push(()=>{P&&P.cancel(),p.cancel()})},w=c.getLayer(e);if(!w)return void a(new Error(`Unknown sourceLayer "${e}"`));if(w.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void a(null,this.textureDescriptor?this.textureDescriptor.img:null);let M=w.getDataRange([n]);if(p=c.createDecodingTask(M),!p||p.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(M.firstByte,M.lastByte+1));else{let T=Object.assign({},this.requestParams,{headers:{Range:`bytes=${M.firstByte}-${M.lastByte}`}}),E=gl(T,y);this._fetchQueue.push(()=>{E.cancel(),p.cancel()})}else a(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let a=this._mrt.getLayer(e);if(!a||!a.hasBand(n)||!a.hasDataForBand(n))return;let{bytes:c,tileSize:m,buffer:p,offset:b,scale:y}=a.getBandView(n),w=m+2*p,M={data:c,width:w,height:w},T=this.texture;T&&T instanceof Ba&&T.update(M,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:M,buffer:p,offset:b,tileSize:m,format:a.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class LR{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){let c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);let m={value:n,timeout:void 0};if(a!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},a)),this.data[c].push(m),this.order.push(c),this.order.length>this.max){let p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let a=e.wrapped().key,c=n===void 0?0:this.data[a].indexOf(n),m=this.data[a][c];return this.data[a].splice(c,1),m.timeout&&clearTimeout(m.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(m.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let a in this.data)for(let c of this.data[a])e(c.value)||n.push(c);for(let a of n)this.remove(a.value.tileID,a)}}class Ph extends bl{constructor(e,n,a){super(),this.id=e,this._onlySymbols=a,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new LR(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new BO,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return jo(this._tiles).map(e=>e.tileID).sort(rM).map(e=>e.key)}getRenderableIds(e,n){let a=[];for(let c in this._tiles)this._isIdRenderable(+c,e,n)&&a.push(this._tiles[c]);return e?a.sort((c,m)=>{let p=c.tileID,b=m.tileID,y=new xt(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new xt(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-b.overscaledZ||w.y-y.y||w.x-y.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(rM).map(c=>c.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,e,n)))}_tileLoaded(e,n,a,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new Eu(c,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new ao("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Rr.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ao("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let c=0;c<n.length;c++){let m=n[c];if(e.neighboringTiles&&e.neighboringTiles[m]){let p=this.getTileByID(m);a(e,p),a(p,e)}}function a(c,m){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let p=m.tileID.canonical.x-c.tileID.canonical.x,b=m.tileID.canonical.y-c.tileID.canonical.y,y=Math.pow(2,c.tileID.canonical.z),w=m.tileID.key;p===0&&b===0||Math.abs(b)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),m.dem&&c.dem&&(c.dem.backfillBorder(m.dem,p,b),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,c){for(let m in this._tiles){let p=this._tiles[m];if(c[m]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>a)continue;let b=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){let w=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[w.key],p&&p.hasData()&&(b=w)}let y=b;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){c[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){let c=e.scaledTo(a),m=this._getLoadedTile(c);if(m)return m}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let a=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,m=Math.floor(a*c*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(b)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let a={};for(let c in this._tiles){let m=this._tiles[c];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),a[m.tileID.key]=m}this._tiles=a;for(let c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(let c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,a,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let m;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)m=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new _r(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,m=y.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(m.push(new _r(1,0,1,0,0)),m.push(new _r(1,0,1,1,0)),m.push(new _r(1,0,1,0,1)),m.push(new _r(1,0,1,1,1)))}else if(m=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);m=m.filter(w=>y(w))}}else m=[];if(m.length>0&&this.castsShadows&&c&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!fx(this._source.type)){let y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),w=Math.min(y,this._source.maxzoom),M=e.extendTileCoverForShadows(m,c,w);for(let T of M)this._shadowCasterTiles[T.key]=!0,m.push(T)}let p=this._updateRetainedTiles(m);if(fx(this._source.type)&&m.length!==0){let y={},w={},M=Object.keys(p);for(let E of M){let P=p[E],R=this._tiles[E];if(!R||R.fadeEndTime&&R.fadeEndTime<=Rr.now())continue;let F=this.findLoadedParent(P,Math.max(P.overscaledZ-Ph.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),w[E]=P}let T=m[m.length-1].overscaledZ;for(let E in this._tiles){let P=this._tiles[E];if(p[E]||!P.hasData())continue;let R=P.tileID;for(;R.overscaledZ>T;){R=R.scaledTo(R.overscaledZ-1);let F=this._tiles[R.key];if(F&&F.hasData()&&w[R.key]){p[E]=P.tileID;break}}}for(let E in y)p[E]||(this._coveredTiles[E]=!0,p[E]=y[E])}for(let y in p)this._tiles[y].clearFadeHold();let b=function(y,w){let M=[];for(let T in y)T in w||M.push(T);return M}(this._tiles,p);for(let y of b){let w=this._tiles[y];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let a={},c=e.reduce((w,M)=>Math.min(w,M.overscaledZ),1/0),m=e[0].overscaledZ,p=Math.max(m-Ph.maxOverzooming,this._source.minzoom),b=Math.max(m+Ph.maxUnderzooming,this._source.minzoom),y={};for(let w of e){let M=this._addTile(w);n[w.key]=w,M.hasData()||c<this._source.maxzoom&&(y[w.key]=w)}this._retainLoadedChildren(y,c,b,n);for(let w of e){let M=this._tiles[w.key];if(M.hasData())continue;if(w.canonical.z>=this._source.maxzoom){let E=w.children(this._source.maxzoom)[0],P=this.getTile(E);if(P&&P.hasData()){n[E.key]=E;continue}}else{let E=w.children(this._source.maxzoom);if(n[E[0].key]&&n[E[1].key]&&n[E[2].key]&&n[E[3].key])continue}let T=M.wasRequested();for(let E=w.overscaledZ-1;E>=p;--E){let P=w.scaledTo(E);if(a[P.key]||(a[P.key]=!0,M=this.getTile(P),!M&&T&&(M=this._addTile(P)),M&&(n[P.key]=P,T=M.wasRequested(),M.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}n.push(c.key);let m=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(m),a)break;c=m}for(let m of n)this._loadedParentTiles[m]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let a=!!n;if(!a){let c=this.map?this.map.painter:null,m=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new nM(e,m,this.transform.tileZoom,c,this._isRaster):new R0(e,m,this.transform.tileZoom,c,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,a||this._source.fire(new ao("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,a){let c=[],m=this.transform;if(!m)return c;let p=m.projection.name==="globe",b=Us(m.center.lng);for(let y in this._tiles){let w=this._tiles[y];if(a&&w.clearQueryDebugViz(),w.holdingForFade())continue;let M;if(p){let T=w.tileID.canonical;if(T.z===0){let E=[Math.abs(fi(b,...Yf(T,-1))-b),Math.abs(fi(b,...Yf(T,1))-b)];M=[0,2*E.indexOf(Math.min(...E))-1]}else{let E=[Math.abs(fi(b,...Yf(T,-1))-b),Math.abs(fi(b,...Yf(T,0))-b),Math.abs(fi(b,...Yf(T,1))-b)];M=[E.indexOf(Math.min(...E))-1]}}else M=[0];for(let T of M){let E=e.containsTile(w,m,n,T);E&&c.push(E)}}return c}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let a=this.getRenderableIds(e,n).map(m=>this._tiles[m].tileID),c=this.transform.projection.name==="globe";for(let m of a)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=c?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return a}sortCoordinatesByDistance(e){let n=e.slice(),a=this.transform._camera.position,c=this.transform._camera.forward(),m={};for(let p of n){let b=1/(1<<p.canonical.z);m[p.key]=((p.canonical.x+.5)*b+p.wrap-a[0])*c[0]+((p.canonical.y+.5)*b-a[1])*c[1]-a[2]*c[2]}return n.sort((p,b)=>m[p.key]-m[b.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(fx(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Rr.now())return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){let c=this._tiles[e];c&&c.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(let a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(e,n))};return void this._source.on("data",b)}let a=new Map,c=Array.isArray(e)?e:[e],m=this.map.painter.terrain,p=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(let b of c){let y=b.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let w of y)a.set(w.key,w);this.usedForTerrain&&b.updateElevation(!1)}_c(Array.from(a.values()),(b,y)=>{let w=new R0(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,M=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),y(M,w)})},n)}}function rM(i,e){let n=Math.abs(2*i.wrap)-+(i.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||a-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function fx(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function Yf(i,e){let n=1<<i.z;return[i.x/n+e,(i.x+1)/n+e]}Ph.maxOverzooming=10,Ph.maxUnderzooming=3;let oM=new class extends St{possiblyEvaluate(i,e){return e=new Kt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,n,a){return e=qr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,n,a)}}(g0.paint.properties["line-width"].specification);function aM(i,e){return e>0?e+2*i:i}oM.useIntegerZoom=!0;let FR=new qi({"symbol-placement":new Ke(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new St(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(Oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ke(Oe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ke(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ke(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new St(Oe.layout_symbol["icon-size"]),"icon-text-fit":new St(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new St(Oe.layout_symbol["icon-image"]),"icon-rotate":new St(Oe.layout_symbol["icon-rotate"]),"icon-padding":new Ke(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new St(Oe.layout_symbol["icon-offset"]),"icon-anchor":new St(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new St(Oe.layout_symbol["text-field"]),"text-font":new St(Oe.layout_symbol["text-font"]),"text-size":new St(Oe.layout_symbol["text-size"]),"text-max-width":new St(Oe.layout_symbol["text-max-width"]),"text-line-height":new St(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new St(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new St(Oe.layout_symbol["text-justify"]),"text-radial-offset":new St(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new St(Oe.layout_symbol["text-anchor"]),"text-max-angle":new Ke(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new St(Oe.layout_symbol["text-rotate"]),"text-padding":new Ke(Oe.layout_symbol["text-padding"]),"text-keep-upright":new Ke(Oe.layout_symbol["text-keep-upright"]),"text-transform":new St(Oe.layout_symbol["text-transform"]),"text-offset":new St(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ke(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(Oe.layout_symbol["text-optional"]),visibility:new Ke(Oe.layout_symbol.visibility)});var gx={paint:new qi({"icon-opacity":new St(Oe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new St(Oe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new St(Oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new St(Oe.paint_symbol["text-emissive-strength"]),"icon-color":new St(Oe.paint_symbol["icon-color"]),"icon-halo-color":new St(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new St(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new St(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(Oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new St(Oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new St(Oe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new St(Oe.paint_symbol["text-occlusion-opacity"]),"text-color":new St(Oe.paint_symbol["text-color"],{runtimeType:so,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new St(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new St(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new St(Oe.paint_symbol["text-halo-blur"]),"text-translate":new Ke(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(Oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ke(Oe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ke(Oe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ke(Oe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ke(Oe.paint_symbol["icon-color-brightness-max"])}),layout:FR};class sM{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ic,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ne(sM,"FormatSectionOverride",{omit:["defaultValue"]});class L0 extends gr{constructor(e,n,a,c){super(e,gx,n,a,c),this._colorAdjustmentMatrix=t.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let c=[];for(let m of a)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,c){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(m,p,b,y){m=yu(m),p=bu(p);let w=t.ad.create(),M=m/3,T=1-2*M,E=[T,M,M,0,M,T,M,0,M,M,T,0,0,0,0,1],P=.5-.5*p,R=y-b;return t.ad.multiply(w,[R,0,0,0,0,R,0,0,0,0,R,0,b,b,b,1],[p,0,0,0,0,p,0,0,0,0,p,0,P,P,P,1]),t.ad.multiply(w,w,E),w}(e,n,a,c),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,c){let m=this.layout.get(e).evaluate(n,{},a,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||z(p.value)||!m?m:function(b,y){return y.replace(/{([^{}]+)}/g,(w,M)=>M in b?String(b[M]):"")}(n.properties,m)}createBucket(e){return new gm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of gx.paint.overridableProperties){if(!L0.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),a=new sM(n),c=new L(a,n.property.specification,this.scope,this.options),m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new H("source",c):new Y("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new xn(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&L0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let a=e.get("text-field"),c=gx.paint.properties[n],m=!1,p=b=>{for(let y of b)if(c.overrides&&c.overrides.hasOverride(y))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof $r)p(a.value.value.sections);else if(a.value.kind==="source"){let b=w=>{m||(w instanceof es&&hr(w.value)===Ec?p(w.value.sections):w instanceof oh?p(w.sections):w.eachChild(b))},y=a.value;y._styleExpression&&b(y._styleExpression.expression)}return m}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),n&&a.push("symbolSDF"),a}getDefaultProgramParams(e,n,a){return{config:new Mh(this,{zoom:n,lut:a}),overrideFog:!1}}}let zR=new qi({visibility:new Ke(Oe.layout_background.visibility)});var BR={paint:new qi({"background-color":new Ke(Oe.paint_background["background-color"]),"background-pattern":new Ke(Oe.paint_background["background-pattern"]),"background-opacity":new Ke(Oe.paint_background["background-opacity"]),"background-emissive-strength":new Ke(Oe.paint_background["background-emissive-strength"])}),layout:zR};let NR=new qi({visibility:new Ke(Oe.layout_raster.visibility)});var VR={paint:new qi({"raster-opacity":new Ke(Oe.paint_raster["raster-opacity"]),"raster-color":new An(Oe.paint_raster["raster-color"]),"raster-color-mix":new Ke(Oe.paint_raster["raster-color-mix"]),"raster-color-range":new Ke(Oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ke(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(Oe.paint_raster["raster-saturation"]),"raster-contrast":new Ke(Oe.paint_raster["raster-contrast"]),"raster-resampling":new Ke(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(Oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ke(Oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ke(Oe.paint_raster["raster-array-band"]),"raster-elevation":new Ke(Oe.paint_raster["raster-elevation"])}),layout:NR};function F0(i,e,n,a,c,m,p,b){let y=[i,e,1,n,a,1,c,m,1],w=[p,b,1],M=t.bC.adjoint([],y),[T,E,P]=t._.transformMat3(w,w,M);return t.bC.multiply(y,y,[T,0,0,0,E,0,0,0,P])}function lM(i,e,n,a,c,m,p,b){let y=function(w,M,T,E,P,R,F,B){let W=F0(0,0,1,0,1,1,0,1),J=F0(w,M,T,E,P,R,F,B),ee=t.bC.adjoint([],W);return t.bC.multiply(J,J,ee)}(i,e,n,a,c,m,p,b);return[y[2]/y[8]/gt,y[5]/y[8]/gt]}function z0(i){return[i[0],Math.min(Math.max(i[1],-er),er)]}class cM extends bl{constructor(e,n,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new ao("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ps(this.map._requestManager.transformRequest(this.url,Su.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Eu(a)):c&&(this.image=c instanceof HTMLImageElement?Rr.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new A0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ao("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof A0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(let m of e)m[1]>a&&(a=m[1]),m[1]<n&&(n=m[1]);let c=(a+n)/2;if(c>er?this.onNorthPole=!0:c<-er&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=e.map(eo.fromLngLat);this.tileID=function(p){let b=1/0,y=1/0,w=-1/0,M=-1/0;for(let F of p)b=Math.min(b,F.x),y=Math.min(y,F.y),w=Math.max(w,F.x),M=Math.max(M,F.y);let T=Math.max(w-b,M-y),E=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),P=Math.pow(2,E),R=Math.floor((b+w)/2*P);return R>1&&(R-=1),new Ih(E,R,Math.floor((y+M)/2*P))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ao("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let B in this.tiles){let W=this.tiles[B];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=Ah(new Ih(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(B){let W=B[1].x-B[0].x,J=B[1].y-B[0].y,ee=B[2].x-B[1].x,te=B[2].y-B[1].y,pe=B[3].x-B[2].x,he=B[3].y-B[2].y,ve=B[0].x-B[3].x,Ce=B[0].y-B[3].y,De=W*te-ee*J,Ue=ee*he-pe*te,ze=pe*Ce-ve*he,$e=ve*J-W*Ce;return De>0&&Ue>0&&ze>0&&$e>0||De<0&&Ue<0&&ze<0&&$e<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let c=Ah(this.tileID,this.map.transform.projection),[m,p,b,y]=this.coordinates.map(B=>{let W=c.projection.project(B[0],B[1]);return US(c,W)._round()});this.perspectiveTransform=lM(m.x,m.y,p.x,p.y,b.x,b.y,y.x,y.y);let w=this._boundsArray=new jc;w.emplaceBack(m.x,m.y,0,0),w.emplaceBack(p.x,p.y,gt,0),w.emplaceBack(y.x,y.y,0,gt),w.emplaceBack(b.x,b.y,gt,gt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,O0.members),this.boundsSegments=Pn.simpleSegment(0,0,4,2);let M=[],T=function(B){return[z0(B[0]),z0(B[1]),z0(B[2]),z0(B[3])]}(this.coordinates),[E,P,R,F]=function(B){let W=B[0][0],J=W,ee=B[0][1],te=ee;for(let pe=1;pe<B.length;pe++)B[pe][0]<W?W=B[pe][0]:B[pe][0]>J&&(J=B[pe][0]),B[pe][1]<ee?ee=B[pe][1]:B[pe][1]>te&&(te=B[pe][1]);return[W,ee,J-W,te-ee]}(T);{let B=new jc,[W,J,ee,te]=function(He){let tt=He[0].x,ct=tt,nt=He[0].y,Mt=nt;for(let at=1;at<He.length;at++)He[at].x<tt?tt=He[at].x:He[at].x>ct&&(ct=He[at].x),He[at].y<nt?nt=He[at].y:He[at].y>Mt&&(Mt=He[at].y);return[tt,nt,ct-tt,Mt-nt]}(a),pe=He=>[(He.x-W)/ee,(He.y-J)/te],[he,ve,Ce,De]=a.map(pe),Ue=function(He,tt,ct,nt,Mt,at,ht,Vt){let Lt=F0(0,0,1,0,1,1,0,1),Ot=F0(He,tt,ct,nt,Mt,at,ht,Vt),dt=t.bC.adjoint([],Ot);return t.bC.multiply(Lt,Lt,dt)}(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],De[0],De[1]);this.elevatedGlobePerspectiveTransform=lM(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],De[0],De[1]);let ze=(He,tt)=>{M.push(He.lng);let ct=Math.round((He.lng-E)/R*gt),nt=Math.round((He.lat-P)/F*gt),Mt=pe(tt),at=t._.transformMat3([],[Mt[0],Mt[1],1],Ue),ht=Math.round(at[0]/at[2]*gt),Vt=Math.round(at[1]/at[2]*gt);B.emplaceBack(ct,nt,ht,Vt)},$e=a[3].x-a[0].x,ot=a[3].y-a[0].y,We=a[2].x-a[1].x,et=a[2].y-a[1].y;for(let He=0;He<65;He++){let tt=He/64,ct=[a[0].x+tt*$e,a[0].y+tt*ot],nt=[a[1].x+tt*We,a[1].y+tt*et],Mt=nt[0]-ct[0],at=nt[1]-ct[1];for(let ht=0;ht<65;ht++){let Vt=ht/64,Lt={x:ct[0]+Mt*Vt,y:ct[1]+at*Vt,z:0};ze(n.projection.unproject(Lt.x,Lt.y),Lt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(B,O0.members)}{this.maxLongitudeTriangleSize=0;let B=[],W=new kr,J=(ee,te,pe)=>{W.emplaceBack(ee,te,pe);let he=M[ee],ve=M[te],Ce=M[pe],De=Math.min(Math.min(he,ve),Ce),Ue=Math.max(Math.max(he,ve),Ce)-De;Ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ue),B.push(De+Ue/2)};for(let ee=0;ee<64;ee++)for(let te=0;te<64;te++){let pe=65*ee+te,he=pe+1,ve=pe+65,Ce=ve+1;J(pe,ve,he),J(he,ve,Ce)}[B,W]=function(ee,te){let pe=Array.from({length:ee.length},(Ce,De)=>De);pe.sort((Ce,De)=>ee[Ce]-ee[De]);let he=[],ve=new kr;for(let Ce=0;Ce<pe.length;Ce++){let De=pe[Ce];he.push(ee[De]);let Ue=3*De,ze=Ue+1;ve.emplaceBack(te.uint16[Ue],te.uint16[ze],te.uint16[ze+1])}return[he,ve]}(B,W),this.elevatedGlobeTrianglesCenterLongitudes=B,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=Pn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/gt,0,F/gt,0,0,P,E,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof A0||(this.texture?this.texture.update(this.image):(this.texture=new Ba(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,c=(m=e+180)+360*Math.round((a[0]-m)/360);var m;let p=new Pn,b=(T,E)=>{p.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:n.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=y){let T=Kg(a,0,a.length,c+y);return T===a.length||b(T,Ip(a,T+1,a.length,c+360-y)-T),p}c<a[0]&&(c+=360);let w=Ip(a,0,a.length,c-y);if(w===a.length)return b(0,a.length),p;b(0,w-0);let M=Kg(a,w+1,a.length,c+y);return M!==a.length&&b(M,a.length-M),p}}let jR=(Math.pow(256,2)-1)/16907520;class dM extends gr{constructor(e,n,a,c){super(e,VR,n,a,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof cM&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=Ef({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let UR=new qi({visibility:new Ke(Oe["layout_raster-particle"].visibility)});var HR={paint:new qi({"raster-particle-array-band":new Ke(Oe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ke(Oe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new An(Oe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ke(Oe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ke(Oe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ke(Oe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ke(Oe["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:UR};class hM extends gr{constructor(e,n,a,c){super(e,HR,n,a,c),this._updateColorRamp(),this.lastInvalidatedAt=Rr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Ef({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Rr.now()}}class WR extends gr{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let GR=new qi({visibility:new Ke(Oe.layout_sky.visibility)});var qR={paint:new qi({"sky-type":new Ke(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ke(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ke(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ke(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ke(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new An(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ke(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ke(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ke(Oe.paint_sky["sky-opacity"])}),layout:GR};function _x(i,e,n){let a=[0,0,1],c=t.av.identity([]);return t.av.rotateY(c,c,n?-Di(i)+Math.PI:Di(i)),t.av.rotateX(c,c,-Di(e)),t._.transformQuat(a,a,c),t._.normalize(a,a)}var $R={paint:new qi({})};function uM(i,e){let n=B0(i.projection,i.zoom,i.width,i.height),a=function(m,p,b,y,w){let M=new Fi(b.lng-180*od,b.lat),T=new Fi(b.lng+180*od,b.lat),E=m.project(M.lng,M.lat),P=m.project(T.lng,T.lat),R=-Math.atan2(P.y-E.y,P.x-E.x),F=eo.fromLngLat(b);F.y=fi(F.y,-1+od,1-od);let B=F.toLngLat(),W=m.project(B.lng,B.lat),J=eo.fromLngLat(B);J.x+=od;let ee=J.toLngLat(),te=m.project(ee.lng,ee.lat),pe=fM(te.x-W.x,te.y-W.y,R),he=eo.fromLngLat(B);he.y+=od;let ve=he.toLngLat(),Ce=m.project(ve.lng,ve.lat),De=fM(Ce.x-W.x,Ce.y-W.y,R),Ue=Math.abs(pe.x)/Math.abs(De.y),ze=t.ad.identity([]);t.ad.rotateZ(ze,ze,-R*(1-(w?0:y)));let $e=t.ad.identity([]);return t.ad.scale($e,$e,[1,1-(1-Ue)*y,1]),$e[4]=-De.x/De.y*y,t.ad.rotateZ($e,$e,R),t.ad.multiply($e,ze,$e),$e}(i.projection,0,i.center,n,e),c=mM(i);return t.ad.scale(a,a,[c,c,1]),a}function mM(i){let e=i.projection,n=B0(i.projection,i.zoom,i.width,i.height),a=pM(e,i.center),c=pM(e,Fi.convert(e.center));return Math.pow(2,a*n+(1-n)*c)}function B0(i,e,n,a,c=1/0){let m=i.range;if(!m)return 0;let p=Math.min(c,Math.max(n,a)),b=Math.log(p/1024)/Math.LN2;return ul(m[0]+b,m[1]+b,e)}let od=1/4e4;function pM(i,e){let n=fi(e.lat,-er,er),a=new Fi(e.lng-180*od,n),c=new Fi(e.lng+180*od,n),m=i.project(a.lng,n),p=i.project(c.lng,n),b=eo.fromLngLat(a),y=eo.fromLngLat(c),w=p.x-m.x,M=p.y-m.y,T=y.x-b.x,E=y.y-b.y,P=Math.sqrt((T*T+E*E)/(w*w+M*M));return Math.log(P)/Math.LN2}function fM(i,e,n){let a=Math.cos(n),c=Math.sin(n);return{x:i*a-e*c,y:i*c+e*a}}function gM(i,e,n){t.ad.identity(i),t.ad.rotateZ(i,i,Di(e[2])),t.ad.rotateX(i,i,Di(e[0])),t.ad.rotateY(i,i,Di(e[1])),t.ad.scale(i,i,n),t.ad.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function N0(i,e,n,a,c,m,p,b){let y=[n[0]-e[0],n[1]-e[1],0],w=[a[0]-e[0],a[1]-e[1],0];if(t._.length(y)<1e-12||t._.length(w)<1e-12)return t.av.identity(i);let M=t._.cross([],y,w);t._.normalize(M,M),t._.subtract(w,a,e),y[2]=(m-c)*b,w[2]=(p-c)*b;let T=y;return t._.cross(T,y,w),t._.normalize(T,T),t.av.rotationTo(i,M,T)}function bx(i,e,n=!1){let a=Rl(e.zoom),c=function(m,p,b){let y=p.worldSize,w=[m[12],m[13],m[14]],M=zr(w[1]/y),T=Lo(w[0]/y),E=t.ad.identity([]),P=vo(1,M)*y,R=vo(1,0)*y*Th(M,p.zoom),F=1/Fv(y),B=R*F;if(b){let te=B0(p.projection,p.zoom,p.width,p.height,1024);B=F*p.projection.pixelSpaceConversion(p.center.lat,y,te)}let W=kh(M,T);t._.add(W,W,t._.scale([],t._.normalize([],W),P*B*w[2]));let J=function(te){let pe=[te[0],te[1],te[2]],he=[0,1,0],ve=t._.cross([],he,pe);return t._.cross(he,pe,ve),t._.squaredLength(he)===0&&(he=[0,1,0],t._.cross(ve,pe,he)),t._.normalize(ve,ve),t._.normalize(he,he),t._.normalize(pe,pe),[ve[0],ve[1],ve[2],0,he[0],he[1],he[2],0,pe[0],pe[1],pe[2],0,te[0],te[1],te[2],1]}(W);t.ad.scale(E,E,[B,B,B*P]),t.ad.translate(E,E,[-w[0],-w[1],-w[2]]);let ee=t.ad.multiply([],p.globeMatrix,J);return t.ad.multiply(ee,ee,E),t.ad.multiply(ee,ee,m),ee}(i,e,n);if(a>0){let m=function(p,b){let y=b.worldSize,w=vo(1,0)*y*Th(b.center.lat,b.zoom)/Fv(y),M=vo(1,b.center.lat)*y,T=t.ad.identity([]);return t.ad.rotateY(T,T,Di(b.center.lng)),t.ad.rotateX(T,T,Di(b.center.lat)),t.ad.translate(T,T,[0,0,yo]),t.ad.scale(T,T,[w,w,w*M]),t.ad.translate(T,T,[b.point.x-.5*y,b.point.y-.5*y,0]),t.ad.multiply(T,T,p),t.ad.multiply(T,b.globeMatrix,T)}(i,e);return function(p,b,y){let w=(R,F,B)=>{let W=t._.length(R),J=t._.length(F),ee=Ol(R,F,B);return t._.scale(ee,ee,1/t._.length(ee)*Wt(W,J,B))},M=w([p[0],p[1],p[2]],[b[0],b[1],b[2]],y),T=w([p[4],p[5],p[6]],[b[4],b[5],b[6]],y),E=w([p[8],p[9],p[10]],[b[8],b[9],b[10]],y),P=Ol([p[12],p[13],p[14]],[b[12],b[13],b[14]],y);return[M[0],M[1],M[2],0,T[0],T[1],T[2],0,E[0],E[1],E[2],0,P[0],P[1],P[2],1]}(c,m,a)}return c}function _M(i,e,n,a){let c=On.projectAabbCorners(a,n),m=Number.MAX_VALUE,p=-1;for(let w=0;w<c.length;++w){let M=c[w];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<m&&(p=w,m=M[2])}let b=w=>new xt(c[w][0],c[w][1]),y;switch(p){case 0:case 6:y=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:y=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:y=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:y=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(kv(i,y))return m}let YR=$i([{name:"a_pos_3f",components:3,type:"Float32"}]),ZR=$i([{name:"a_color_3f",components:3,type:"Float32"}]),XR=$i([{name:"a_color_4f",components:4,type:"Float32"}]),QR=$i([{name:"a_uv_2f",components:2,type:"Float32"}]),KR=$i([{name:"a_normal_3f",components:3,type:"Float32"}]),JR=$i([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),e3=$i([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class V0{constructor(e,n,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function bM(i,e){let n=i.indexOf("://")===-1;try{return new URL(i,n&&e?"http://example.com":void 0),!0}catch{return!1}}class yM{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class vM{constructor(){this.instancedDataArray=new cv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class yx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,a,c){this.tileToMeter=Z_(a);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:b,index:y,sourceLayerIndex:w}of e){let M=b??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),T=Pl(p,m);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),T,a))continue;let E={id:M,sourceLayerIndex:w,index:y,geometry:m?T.geometry:as(p,a,c),properties:p.properties,type:p.type,patterns:{}},P=this.addFeature(E,E.geometry,T);P&&n.featureIndex.insert(p,E.geometry,y,w,this.index,this.instancesPerModel[P].instancedDataArray.length,gt/32)}this.lookup=null}update(e,n,a,c){for(let m in this.instancesPerModel){let p=this.instancesPerModel[m];for(let b in e)p.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(p.features[p.idToFeaturesIndex[b]],e[b],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];for(let c of a.features){let m=this.layers[0],p=c.feature,b=this.canonical,y=m.paint.get("model-rotation").evaluate(p,{},b),w=m.paint.get("model-scale").evaluate(p,{},b),M=m.paint.get("model-translation").evaluate(p,{},b);t._.exactEquals(c.rotation,y)&&t._.exactEquals(c.scale,w)&&t._.exactEquals(c.translation,M)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(qv(this.activeReplacements,c))return!1;this.activeReplacements=c;let m=!1;for(let p in this.instancesPerModel){let b=this.instancesPerModel[p],y=b.instancedDataArray;for(let w of b.features){let M=w.instancedDataOffset,T=w.instancedDataCount;for(let E=0;E<T;E++){let P=16*(E+M),R=y.float32[P+0];R=R>gt?R-gt:R;let F=Math.floor(R),B=y.float32[P+1],W=!1;for(let J of this.activeReplacements)if(!(J.order<a||J.order===1/0)&&J.clipMask&N2.Model&&!(J.min.x>F||F>J.max.x||J.min.y>B||B>J.max.y)&&(W=A2(D2(F,B,e.canonical,J.footprintTileId.canonical),J),W))break;y.float32[P]=W?R+gt:R,m=m||W}}}return m}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,JR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,a){let c=this.layers[0],m=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!m)return Kn(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),m;bM(m,!1)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new vM);let p=this.instancesPerModel[m],b=p.instancedDataArray,y=new yM(a,b.length);for(let w of n)for(let M of w){if(M.x<0||M.x>=gt||M.y<0||M.y>=gt)continue;let T=(this.lookupDim-1)/gt,E=this.lookupDim*(M.y*T|0)+M.x*T|0;if(this.lookup){if(this.lookup[E]!==0)continue;this.lookup[E]=1}this.instanceCount++;let P=b.length;b.resize(P+1),p.instancesEvaluatedElevation.push(0),b.float32[16*P]=M.x,b.float32[16*P+1]=M.y}return y.instancedDataCount=p.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(y),this.evaluate(y,{},p,!1)),m}getModelUris(){return this.modelUris}evaluate(e,n,a,c){let m=this.layers[0],p=e.feature,b=this.canonical,y=e.rotation=m.paint.get("model-rotation").evaluate(p,n,b),w=e.scale=m.paint.get("model-scale").evaluate(p,n,b),M=e.translation=m.paint.get("model-translation").evaluate(p,n,b),T=m.paint.get("model-color").evaluate(p,n,b);T.a=m.paint.get("model-color-mix-intensity").evaluate(p,n,b);let E=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),gM(E,y,w);let P=Math.round(100*T.a)+T.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let F=e.instancedDataOffset+R,B=16*F,W=a.instancedDataArray.float32,J=0;c&&(J=W[B+6]-a.instancesEvaluatedElevation[F]);let ee=0|W[B+1];W[B]=(0|W[B])+T.r/1.05,W[B+1]=ee+T.g/1.05,W[B+2]=P,W[B+3]=1/(b.z>10?this.tileToMeter:Z_(b,ee)),W[B+4]=M[0],W[B+5]=M[1],W[B+6]=M[2]+J,W[B+7]=E[0],W[B+8]=E[1],W[B+9]=E[2],W[B+10]=E[4],W[B+11]=E[5],W[B+12]=E[6],W[B+13]=E[8],W[B+14]=E[9],W[B+15]=E[10],a.instancesEvaluatedElevation[F]=M[2]}}}ne(yx,"ModelBucket",{omit:["layers"]}),ne(vM,"PerModelAttributes"),ne(yM,"ModelFeature");let t3=new qi({visibility:new Ke(Oe.layout_model.visibility),"model-id":new St(Oe.layout_model["model-id"])});var i3={paint:new qi({"model-opacity":new Ke(Oe.paint_model["model-opacity"]),"model-rotation":new St(Oe.paint_model["model-rotation"]),"model-scale":new St(Oe.paint_model["model-scale"]),"model-translation":new St(Oe.paint_model["model-translation"]),"model-color":new St(Oe.paint_model["model-color"]),"model-color-mix-intensity":new St(Oe.paint_model["model-color-mix-intensity"]),"model-type":new Ke(Oe.paint_model["model-type"]),"model-cast-shadows":new Ke(Oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ke(Oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ke(Oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new St(Oe.paint_model["model-emissive-strength"]),"model-roughness":new St(Oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new St(Oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ke(Oe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ke(Oe.paint_model["model-front-cutoff"])}),layout:t3};let Oh=64,ym={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function xM(i,e,n,a,c,m,p,b,y,w=!1){let M=n.zoom,T=n.project(a),E=Th(a.lat,M),P=1/E;t.ad.identity(i),t.ad.translate(i,i,[T.x+p[0]*P,T.y+p[1]*P,p[2]]);let R=1,F=1,B=n.worldSize;if(w){if(n.projection.name==="mercator"){let te=0;n.elevation&&(te=n.elevation.getAtPointOrZero(new eo(T.x/B,T.y/B),0));let pe=t.aA.transformMat4([],[T.x,T.y,te,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=pe,F=pe*Th(n.center.lat,M)}else if(n.projection.name==="globe"){let te=bx(i,n),pe=t.ad.multiply([],n.projMatrix,te),he=[0,0,0,1];t.aA.transformMat4(he,he,pe);let ve=he[3]/n.cameraToCenterDistance,Ce=Rl(M),De=n.projection.pixelsPerMeter(a.lat,B)*Th(a.lat,M),Ue=n.projection.pixelsPerMeter(n.center.lat,B)*Th(n.center.lat,M);R=ve/Wt(De,NC(n.center.lat),Ce),F=ve*E/De,R*=Ue,F*=Ue}}else R=P;t.ad.scale(i,i,[R,R,F]);let W=[...i],J=e.orientation,ee=[];if(gM(ee,[J[0]+c[0],J[1]+c[1],J[2]+c[2]],m),t.ad.multiply(i,W,ee),b&&n.elevation){let te=0,pe=[];if(y&&n.elevation){te=function(Ce,De,Ue,ze,$e){let ot=De.elevation;if(!ot)return 0;let We=On.projectAabbCorners(Ue,ze),et=vo(1,$e.lat)*De.worldSize,He=function(jt,si){let Zt=[0,0,1],hi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let li of hi){let xi=jt[li.corners[0]],qt=jt[li.corners[1]],on=jt[li.corners[2]],rn=[qt[0]-xi[0],qt[1]-xi[1],si*(qt[2]-xi[2])],ji=t._.cross(rn,rn,[on[0]-xi[0],on[1]-xi[1],si*(on[2]-xi[2])]);t._.normalize(ji,ji),li.dotProductWithUp=t._.dot(ji,Zt)}return hi.sort((li,xi)=>li.dotProductWithUp-xi.dotProductWithUp),hi[0].corners}(We,et),tt=We[He[0]],ct=We[He[1]],nt=We[He[2]],Mt=We[He[3]],at=ot.getAtPointOrZero(new eo(tt[0]/De.worldSize,tt[1]/De.worldSize),0),ht=ot.getAtPointOrZero(new eo(ct[0]/De.worldSize,ct[1]/De.worldSize),0),Vt=ot.getAtPointOrZero(new eo(nt[0]/De.worldSize,nt[1]/De.worldSize),0),Lt=ot.getAtPointOrZero(new eo(Mt[0]/De.worldSize,Mt[1]/De.worldSize),0),Ot=(at+Lt)/2,dt=(ht+Vt)/2;return Ot>dt?ht<Vt?N0(Ce,ct,Mt,tt,ht,Lt,at,et):N0(Ce,nt,tt,Mt,Vt,at,Lt,et):at<Lt?N0(Ce,tt,ct,nt,at,ht,Vt,et):N0(Ce,Mt,nt,ct,Lt,Vt,ht,et),Math.max(Ot,dt)}(pe,n,e.aabb,i,a);let he=t.ad.fromQuat([],pe),ve=t.ad.multiply([],he,ee);t.ad.multiply(i,W,ve)}else te=n.elevation.getAtPointOrZero(new eo(T.x/B,T.y/B),0);te!==0&&(i[14]+=te)}}function Zf(i,e,n=!1){i.uploaded||(i.gfxTexture=new Ba(e,i.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:i.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function n3(i,e,n){i.indexBuffer=e.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=e.createVertexBuffer(i.vertexArray,YR.members,!1,!0),i.normalArray&&(i.normalBuffer=e.createVertexBuffer(i.normalArray,KR.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=e.createVertexBuffer(i.texcoordArray,QR.members,!1,!0)),i.colorArray&&(i.colorBuffer=e.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?ZR:XR).members,!1,!0)),i.featureArray&&(i.pbrBuffer=e.createVertexBuffer(i.featureArray,e3.members,!0)),i.segments=Pn.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);let a=i.material;a.pbrMetallicRoughness.baseColorTexture&&Zf(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Zf(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Zf(a.normalTexture,e),a.occlusionTexture&&Zf(a.occlusionTexture,e,n),a.emissionTexture&&Zf(a.emissionTexture,e)}function vx(i,e,n){if(i.meshes)for(let a of i.meshes)n3(a,e,n);if(i.children)for(let a of i.children)vx(a,e,n)}function j0(i){if(i.meshes)for(let e of i.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(i.children)for(let e of i.children)j0(e)}function xx(i){if(i.meshes)for(let n of i.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(i.children)for(let n of i.children)xx(n)}class r3{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class o3{constructor(){this.tasks={},this.taskQueue=[],fu(["process"],this),this.invoker=new r3(this.process),this.nextId=0}add(e,n){let a=this.nextId++,c=function({type:m,isSymbolTile:p,zoom:b}){return b=b||0,m==="message"?0:m!=="maybePrepare"||p?m!=="parseTile"||p?m==="parseTile"&&p?300-b:m==="maybePrepare"&&p?400-b:500:200-b:100-b}(n);if(c===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){let m=this.tasks[this.taskQueue[c]];m.priority<n&&(n=m.priority,e=c)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class wM{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},fu(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new o3}send(e,n,a,c,m=!1,p){let b=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[b]=a);let y=new Set;return this.target.postMessage({id:b,type:e,hasCallback:!!a,targetMapId:c,mustQueue:m,sourceMapId:this.mapId,data:we(n,y)},y),{cancel:()=>{a&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){let n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(n.mustQueue||Or()){let c=this.callbacks[a],m=this.scheduler.add(()=>this.processTask(a,n),c&&c.metadata||{type:"message"});m&&(this.cancelCallbacks[a]=m)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(Re(n.error)):a(null,Re(n.data)))}else{let a=new Set,c=n.hasCallback?(p,b)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?we(p):null,data:we(b,a)},a)}:p=>{},m=Re(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,m,c);else if(this.parent.getWorkerSource){let p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],m.source,m.scope)[p[1]](m,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let wx=(()=>{class i{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=mu();let c=this.workerPool.acquire(this.id);for(let m=0;m<c.length;m++){let p=new i.Actor(c[m],a,this.id);p.name=`Worker ${m}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,c){_c(this.actors,(m,p)=>{m.send(n,a,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return i.Actor=wM,i})();var Xf={workerUrl:"",workerClass:null,workerParams:void 0};function a3(){return Xf.workerClass!=null?new Xf.workerClass:new self.Worker(Xf.workerUrl,Xf.workerParams)}let Cx="mapboxgl_preloaded_worker_pool";class Qf{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Qf.workerCount;)this.workers.push(new a3);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Cx]}numActive(){return Object.keys(this.active).length}}let Kf;function U0(){return Kf||(Kf=new Qf),Kf}Qf.workerCount=2;let H0,Sx,ms,vm,Mx,xm=null;function CM(){return Or()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Sx||I.DRACO_URL}function SM(){if(Or()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(vm)return vm;let i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return vm=WebAssembly.validate(i)?I.MESHOPT_SIMD_URL:I.MESHOPT_URL,vm}let W0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},s3={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Jf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function MM(i,e,n){let a=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:c,byteLength:i.byteLength},n.buffers[c]=i}let kx="KHR_draco_mesh_compression";function l3(i,e){let n=i.extensions&&i.extensions[kx];if(!n)return;let a=new ms.Decoder,c=EM(e,n.bufferView),m=new ms.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,m))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[i.indices],b=W0[p.componentType],y=p.count*b.BYTES_PER_ELEMENT,w=ms._malloc(y);b===Uint16Array?a.GetTrianglesUInt16Array(m,y,w):a.GetTrianglesUInt32Array(m,y,w),MM(ms.memory.buffer.slice(w,w+y),p,e),ms._free(w);for(let M of Object.keys(n.attributes)){let T=a.GetAttributeByUniqueId(m,n.attributes[M]),E=e.json.accessors[i.attributes[M]],P=s3[E.componentType],R=E.count*Jf[E.type]*W0[E.componentType].BYTES_PER_ELEMENT,F=ms._malloc(R);a.GetAttributeDataArrayForAllPoints(m,T,ms[P],R,F),MM(ms.memory.buffer.slice(F,F+R),E,e),ms._free(F)}a.destroy(),m.destroy(),delete i.extensions[kx]}let G0="EXT_meshopt_compression";function c3(i,e){if(!i.extensions||!i.extensions[G0])return;let n=i.extensions[G0],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);Mx.decodeGltfBuffer(c,n.count,n.byteStride,a,n.mode,n.filter),i.buffer=e.buffers.length,i.byteOffset=0,e.buffers[i.buffer]=c.buffer,delete i.extensions[G0]}let kM=1179937895,IM=new TextDecoder("utf8");function TM(i,e){return new URL(i,e).href}function d3(i,e,n,a){return fetch(TM(i.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function EM(i,e){let n=i.json.bufferViews[e];return new Uint8Array(i.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function h3(i,e,n,a){if(i.uri){let c=TM(i.uri,a);return fetch(c).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[n]=m})}if(i.bufferView!==void 0){let c=EM(e,i.bufferView),m=new Blob([c],{type:i.mimeType});return createImageBitmap(m).then(p=>{e.images[n]=p})}}function DM(i,e=0,n){let a={json:null,images:[],buffers:[]};if(new Uint32Array(i,e,1)[0]===kM){let M=new Uint32Array(i,e),T=2,E=(M[T++]>>2)-3,P=M[T++]>>2;if(T++,a.json=JSON.parse(IM.decode(M.subarray(T,T+P))),T+=P,T<E){let R=M[T++];T++;let F=e+(T<<2);a.buffers[0]=i.slice(F,F+R)}}else a.json=JSON.parse(IM.decode(new Uint8Array(i,e)));let{buffers:c,images:m,meshes:p,extensionsUsed:b,bufferViews:y}=a.json,w=Promise.resolve();if(c){let M=[];for(let T=0;T<c.length;T++){let E=c[T];E.uri?M.push(d3(E,a,T,n)):a.buffers[T]||(a.buffers[T]=null)}w=Promise.all(M)}return w.then(()=>{let M=[],T=b&&b.includes(kx),E=b&&b.includes(G0);if(T&&M.push(function(){if(!ms)return H0||(H0=function(P){let R,F=null;function B(){R=new Uint8Array(F.buffer)}function W(){throw new Error("Unexpected Draco error.")}let J={a:{a:W,d:function(ee,te,pe){return R.copyWithin(ee,te,te+pe)},c:function(ee){let te=R.length,pe=Math.max(ee>>>0,Math.ceil(1.2*te)),he=Math.ceil((pe-te)/65536);try{return F.grow(he),B(),!0}catch{return!1}},b:W}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,J):P.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,J))).then(ee=>{let{Rb:te,Qb:pe,P:he,T:ve,X:Ce,Ja:De,La:Ue,Qa:ze,Va:$e,Wa:ot,eb:We,jb:et,f:He,e:tt,yb:ct,zb:nt,Ab:Mt,Bb:at,Db:ht,Gb:Vt}=ee.instance.exports;F=tt;let Lt=(()=>{let Ot=0,dt=0,jt=0,si=0;return Zt=>{jt&&(te(si),te(Ot),dt+=jt,jt=Ot=0),Ot||(dt+=128,Ot=pe(dt));let hi=Zt.length+7&-8,li=Ot;hi>=dt&&(jt=hi,li=si=pe(hi));for(let xi=0;xi<Zt.length;xi++)R[li+xi]=Zt[xi];return li}})();return B(),He(),{memory:tt,_free:te,_malloc:pe,Mesh:class{constructor(){this.ptr=he()}destroy(){ve(this.ptr)}},Decoder:class{constructor(){this.ptr=De()}destroy(){et(this.ptr)}DecodeArrayToMesh(Ot,dt,jt){let si=Lt(Ot),Zt=Ue(this.ptr,si,dt,jt.ptr);return!!Ce(Zt)}GetAttributeByUniqueId(Ot,dt){return{ptr:ze(this.ptr,Ot.ptr,dt)}}GetTrianglesUInt16Array(Ot,dt,jt){$e(this.ptr,Ot.ptr,dt,jt)}GetTrianglesUInt32Array(Ot,dt,jt){ot(this.ptr,Ot.ptr,dt,jt)}GetAttributeDataArrayForAllPoints(Ot,dt,jt,si,Zt){We(this.ptr,Ot.ptr,dt.ptr,jt,si,Zt)}},DT_INT8:ct(),DT_UINT8:nt(),DT_INT16:Mt(),DT_UINT16:at(),DT_UINT32:ht(),DT_FLOAT32:Vt()}})}(fetch(CM())),H0.then(P=>{ms=P,H0=void 0}))}()),E&&M.push(function(){if(Mx)return;let P=function(R){let F,B=WebAssembly.instantiateStreaming(R,{}).then(ee=>{F=ee.instance,F.exports.__wasm_call_ctors()}),W={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(ee,te,pe,he,ve,Ce){(function(De,Ue,ze,$e,ot,We,et){let He=De.exports.sbrk,tt=$e+3&-4,ct=He(tt*ot),nt=He(We.length),Mt=new Uint8Array(De.exports.memory.buffer);Mt.set(We,nt);let at=Ue(ct,$e,ot,nt,We.length);if(at===0&&et&&et(ct,tt,ot),ze.set(Mt.subarray(ct,ct+$e*ot)),He(ct-He(0)),at!==0)throw new Error(`Malformed buffer data: ${at}`)})(F,F.exports[J[ve]],ee,te,pe,he,F.exports[W[Ce]])}}}(fetch(SM()));return P.ready.then(()=>{Mx=P})}()),m)for(let P=0;P<m.length;P++)M.push(h3(m[P],a,P,n));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(T&&p)for(let{primitives:P}of p)for(let R of P)l3(R,a);if(E&&p&&y)for(let P of y)c3(P,a);return a})})}function Rh(i,e){let n=i.json.bufferViews[e.bufferView],a=W0[e.componentType];return new a(i.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Jf[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:Jf[e.type]))}function Ix(i,e,n,a){let c=W0[e.componentType],m=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),p=i.json.bufferViews[e.bufferView],b=p.byteStride?p.byteStride/c.BYTES_PER_ELEMENT:Jf[e.type],y=n.float32,w=y.length/n.capacity;for(let M=0,T=0;M<e.count*b;M+=b,T+=w)for(let E=0;E<w;E++)y[T+E]=a[M+E]*m;n._trim()}function u3(i,e,n){let a=i.indices,c=i.attributes,m={};m.indexArray=new kr;let p=e.json.accessors[a],b=p.count/3;m.indexArray.reserve(b);let y=Rh(e,p);for(let E=0;E<b;E++)m.indexArray.emplaceBack(y[3*E],y[3*E+1],y[3*E+2]);m.indexArray._trim(),m.vertexArray=new Hc;let w=e.json.accessors[c.POSITION];m.vertexArray.reserve(w.count);let M=Rh(e,w);for(let E=0;E<w.count;E++)m.vertexArray.emplaceBack(M[3*E],M[3*E+1],M[3*E+2]);if(m.vertexArray._trim(),m.aabb=new On(w.min,w.max),m.centroid=function(E,P){let R=[0,0,0],F=E.length;if(F>0){for(let B=0;B<F;B++){let W=3*E[B];R[0]+=P[W],R[1]+=P[W+1],R[2]+=P[W+2]}R[0]/=F,R[1]/=F,R[2]/=F}return R}(y,M),c.COLOR_0!==void 0){let E=e.json.accessors[c.COLOR_0],P=Jf[E.type],R=Rh(e,E);m.colorArray=P===3?new Hc:new Uc,m.colorArray.resize(E.count),Ix(e,E,m.colorArray,R)}if(c.NORMAL!==void 0){m.normalArray=new Hc;let E=e.json.accessors[c.NORMAL];m.normalArray.resize(E.count);let P=Rh(e,E);Ix(e,E,m.normalArray,P)}if(c.TEXCOORD_0!==void 0&&n.length>0){m.texcoordArray=new Qu;let E=e.json.accessors[c.TEXCOORD_0];m.texcoordArray.resize(E.count);let P=Rh(e,E);Ix(e,E,m.texcoordArray,P)}if(c._FEATURE_ID_RGBA4444!==void 0){let E=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Rh(e,E))}c._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Rh(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));let T=i.material;return m.material=function(E,P){let{emissiveFactor:R=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:B=.5,normalTexture:W,occlusionTexture:J,emissiveTexture:ee,doubleSided:te}=E,{baseColorFactor:pe=[1,1,1,1],metallicFactor:he=1,roughnessFactor:ve=1,baseColorTexture:Ce,metallicRoughnessTexture:De}=E.pbrMetallicRoughness||{},Ue=J?P[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&Ue){let ze=J.extensions.KHR_texture_transform;Ue.offsetScale=[ze.offset[0],ze.offset[1],ze.scale[0],ze.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Bi(...pe),metallicFactor:he,roughnessFactor:ve,baseColorTexture:Ce?P[Ce.index]:void 0,metallicRoughnessTexture:De?P[De.index]:void 0},doubleSided:te,emissiveFactor:R,alphaMode:F,alphaCutoff:B,normalTexture:W?P[W.index]:void 0,occlusionTexture:Ue,emissionTexture:ee?P[ee.index]:void 0,defined:E.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},n),m}function AM(i,e,n){let{matrix:a,rotation:c,translation:m,scale:p,mesh:b,extras:y,children:w}=i,M={};if(M.matrix=a||t.ad.fromRotationTranslationScale([],c||[0,0,0,1],m||[0,0,0],p||[1,1,1]),b!==void 0){M.meshes=n[b];let T=M.anchor=[0,0];for(let E of M.meshes){let{min:P,max:R}=E.aabb;T[0]+=P[0]+R[0],T[1]+=P[1]+R[1]}T[0]=Math.floor(T[0]/M.meshes.length/2),T[1]=Math.floor(T[1]/M.meshes.length/2)}if(y&&(y.id&&(M.id=y.id),y.lights&&(M.lights=function(T){if(!T.length)return[];let E=function(W){let J=atob(W),ee=new Uint8Array(J.length);for(let te=0;te<J.length;te++)ee[te]=J.codePointAt(te);return ee}(T),P=[],R=E.length/24,F=new Uint16Array(E.buffer),B=new Float32Array(E.buffer);for(let W=0;W<R;W++){let J=F[2*W*6]/30,ee=F[2*W*6+1]/30,te=F[2*W*6+10]/100,pe=B[6*W+1],he=B[6*W+2],ve=B[6*W+3],Ce=B[6*W+4],De=ve-pe,Ue=Ce-he,ze=Math.hypot(De,Ue);P.push({pos:[pe+.5*De,he+.5*Ue,ee],normal:[Ue/ze,-De/ze,0],width:ze,height:J,depth:te,points:[pe,he,ve,Ce]})}return P}(y.lights))),w){let T=[];for(let E of w)T.push(AM(e.json.nodes[E],e,n));M.children=T}return M}function m3(i){if(i.vertices.length===0||i.indices.length===0)return null;let e=new Hv(i.vertices,i.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:e,min:n,max:a}}function p3(i){if(!i.extras||!i.extras.ground)return null;let e=i.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let a=[];for(let p of n){if(!Array.isArray(p)||p.length!==2)continue;let b=p[0],y=p[1];typeof b=="number"&&typeof y=="number"&&a.push(new xt(b,y))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let p=0;p<a.length;p++){let b=a[p],y=a[(p+1)%a.length],w=a[(p+2)%a.length];c+=(b.x-y.x)*(w.y-y.y)-(w.x-y.x)*(b.y-y.y)}c>0&&a.reverse();let m=Df(a.flatMap(p=>[p.x,p.y]),[]);return m.length===0?null:{vertices:a,indices:m}}function f3(i,e){let n=[],a=[],c=0,m=[];for(let p of i){c=n.length;let b=p.vertexArray.float32,y=p.indexArray.uint16;for(let w=0;w<p.vertexArray.length;w++)m[0]=b[3*w+0],m[1]=b[3*w+1],m[2]=b[3*w+2],t._.transformMat4(m,m,e),n.push(new xt(m[0],m[1]));for(let w=0;w<3*p.indexArray.length;w++)a.push(y[w]+c)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){let b=n[a[p+0]],y=n[a[p+1]],w=n[a[p+2]];(b.x-y.x)*(w.y-y.y)-(w.x-y.x)*(b.y-y.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:n,indices:a}}function PM(i){let e=function(y,w){let M=[],T=WebGL2RenderingContext;if(y.json.textures)for(let E of y.json.textures){let P={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};E.sampler!==void 0&&Object.assign(P,y.json.samplers[E.sampler]),M.push({image:w[E.source],sampler:P,uploaded:!1})}return M}(i,i.images),n=function(y,w){let M=[];for(let T of y.json.meshes){let E=[];for(let P of T.primitives)E.push(u3(P,y,w));M.push(E)}return M}(i,e),{scenes:a,scene:c,nodes:m}=i.json,p=a?a[c||0].nodes:m,b=[];for(let y of p)b.push(AM(m[y],i,n));return function(y,w,M){let T={},E=new Set;for(let P=0;P<y.length;P++){let R=M[w[P]];if(!R.extras)continue;let F=R.extras["mapbox:footprint:version"],B=R.extras["mapbox:footprint:id"];(F||B)&&E.add(P),F==="1.0.0"&&B&&(T[B]=P)}for(let P=0;P<y.length;P++){if(E.has(P))continue;let R=y[P],F=M[w[P]];if(!F.extras)continue;let B=null;R.id in T&&(B=f3(y[T[R.id]].meshes,R.matrix)),B||(B=p3(F)),B&&(R.footprint=m3(B))}if(E.size>0){let P=Array.from(E.values()).sort((R,F)=>R-F);for(let R=P.length-1;R>=0;R--)y.splice(P[R],1)}}(b,p,i.json.nodes),b}function g3(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);let e=i.vertexArray.float32,n=i.aabb.min[0]-1,a=i.aabb.min[1]-1,c=Oh/(i.aabb.max[0]-n+2),m=Oh/(i.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){let b=e[p+2],y=(e[p+0]-n)*c|0,w=(e[p+1]-a)*m|0;b>i.heightmap[w*Oh+y]&&(i.heightmap[w*Oh+y]=b)}}function _3(i,e){let n={};n.indexArray=new kr,n.indexArray.reserve(4*i.length),n.vertexArray=new Hc,n.vertexArray.reserve(10*i.length),n.colorArray=new Uc,n.vertexArray.reserve(10*i.length);let a=0;for(let p of i){let b=Math.min(10,Math.max(4,1.3*p.height))*e,y=[-p.normal[1],p.normal[0],0],w=Math.min(.29,.1*p.width/p.depth),M=p.width-2*p.depth*e*(w+.01),T=t._.scaleAndAdd([],p.pos,y,M/2),E=t._.scaleAndAdd([],p.pos,y,-M/2),P=[T[0],T[1],T[2]+p.height],R=[E[0],E[1],E[2]+p.height],F=t._.scaleAndAdd([],p.normal,y,w);t._.scale(F,F,b);let B=t._.scaleAndAdd([],p.normal,y,-w);t._.scale(B,B,b),t._.add(F,T,F),t._.add(B,E,B),T[2]+=.1,E[2]+=.1,n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]);let W=M/b/2;n.colorArray.emplaceBack(-W-w,-1,W,.8),n.colorArray.emplaceBack(W+w,-1,W,.8),n.colorArray.emplaceBack(-W,0,W,1.3),n.colorArray.emplaceBack(W,0,W,1.3),n.colorArray.emplaceBack(W+w,-.8,W,.7),n.colorArray.emplaceBack(W+w,-.8,W,.7),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(W+w,-1.2,W,.8),n.colorArray.emplaceBack(W+w,-1.2,W,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let c={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=Bi.white,c.pbrMetallicRoughness=m,n.material=c,n.aabb=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let Tx=new Float32Array(262144),Lh=new Uint8Array(262144);function OM(i){let e=0;if(i.meshes)for(let n of i.meshes)e=Math.max(e,n.aabb.max[2]);if(i.children)for(let n of i.children)e=Math.max(e,OM(n));return e}function RM(i,e,n){if(i.meshes)for(let a of i.meshes)a.aabb.min[0]!==1/0&&n.insert(e,a.aabb.min[0],a.aabb.min[1],a.aabb.max[0],a.aabb.max[1]);if(i.children)for(let a of i.children)RM(a,e,n)}let LM=["","wall","door","roof","window","lamp","logo"];class FM{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:OM(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=On.applyTransform(a.aabb,this.node.matrix),n.encapsulate(a.transformedAabb)),e++;this.aabb=n}return this.aabb}}class q0{constructor(e,n,a,c,m,p){this.id=n,this.modelTraits|=ym.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=ym.HasMapboxMeshFeatures),c&&(this.modelTraits|=ym.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let b of e)this.nodesInfo.push(new FM(b)),RM(b,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let a of this.getNodesInfo()){let c=a.node;c.footprint&&n.push({footprint:c.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let a of n){let c=a.node;this.uploaded?this.updatePbrBuffer(c):vx(c,e,!0)}for(let a of n)j0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){let c=e.transform.projectionOptions,m=e.style.getBrightness(),p=this.brightness!==m;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||eg(a.paint.get("model-color").value,p)||eg(a.paint.get("model-color-mix-intensity").value,p)||eg(a.paint.get("model-roughness").value,p)||eg(a.paint.get("model-emissive-strength").value,p)||eg(a.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=c,this.brightness=m,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),c=this.id.canonical;for(let m of a){let p=m.feature;m.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},c)}}evaluate(e){let n=this.getNodesInfo();for(let a of n){if(!a.node.meshes)continue;let c=a.feature,m=a.node.meshes&&a.node.meshes[0].featureData,p=a.evaluatedColor[2],b=a.evaluatedRMEA[2],y=this.id.canonical;if(a.hasTranslucentParts=!1,m){for(let w=0;w<LM.length;w++){let M=LM[w];M.length&&(c.properties.part=M);let T=e.paint.get("model-color").evaluate(c,{},y).toRenderColor(null),E=e.paint.get("model-color-mix-intensity").evaluate(c,{},y);a.evaluatedColor[w]=[T.r,T.g,T.b,E],a.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(c,{},y),a.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y),a.evaluatedRMEA[w][3]=T.a,a.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},y),!a.hasTranslucentParts&&T.a<1&&(a.hasTranslucentParts=!0)}delete c.properties.part,y3(a,p!==a.evaluatedColor[2]||b!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y);a.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},y),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,c){let m=e.findDEMTileFor(a);if(m&&(m.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let p=am.create(e,a,m);if(!p)return;this.modelTraits&ym.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,c);for(let b of this.getNodesInfo()){let y=b.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let w=y.footprint.vertices,M=p.getElevationAt(w[0].x,w[0].y,!0,!0);for(let T=1;T<w.length;T++)M=Math.min(M,p.getElevationAt(w[T].x,w[T].y,!0,!0));y.elevation=M}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,c){let m=n._dem._modifiedForSources[c];if(m===void 0&&(n._dem._modifiedForSources[c]=[],m=n._dem._modifiedForSources[c]),m.includes(a.canonical))return;let p=n._dem.dim;m.push(a.canonical);let b=!1;for(let y of this.getNodesInfo()){let w=y.node;if(!w.footprint||!w.footprint.grid)continue;let M=w.footprint.grid,T=n.tileCoordToPixel(M.min.x,M.min.y),E=n.tileCoordToPixel(M.max.x,M.max.y),P=Math.min(Math.min(p-E.y,T.x),Math.min(T.y,p-E.x));if(P<0)continue;let R=fi(P,2,5),F=Math.max(0,T.x-R),B=Math.max(0,T.y-R),W=Math.min(E.x+R,p-1),J=Math.min(E.y+R,p-1);for(let he=B;he<=J;++he)for(let ve=F;ve<=W;++ve)Lh[he*p+ve]=255;let ee=0,te=0;for(let he=0;he<M.cellsY;++he)for(let ve=0;ve<M.cellsX;++ve){if(!M.cells[he*M.cellsX+ve])continue;let Ce=n.tileCoordToPixel(M.min.x+ve/M.xScale,M.min.y+he/M.yScale),De=n.tileCoordToPixel(M.min.x+(ve+1)/M.xScale,M.min.y+(he+1)/M.yScale);for(let Ue=Ce.y;Ue<=Math.min(De.y+1,p-1);++Ue)for(let ze=Ce.x;ze<=Math.min(De.x+1,p-1);++ze)Lh[Ue*p+ze]===255&&(Lh[Ue*p+ze]=0,ee+=n.getElevationAtPixel(ze,Ue),te++)}let pe=ee/te;F=Math.max(1,T.x-R),B=Math.max(1,T.y-R),W=Math.min(E.x+R,p-2),J=Math.min(E.y+R,p-2),b=!0;for(let he=B;he<=J;++he)for(let ve=F;ve<=W;++ve)Lh[he*p+ve]===0&&(Tx[he*p+ve]=n._dem.set(ve,he,pe));for(let he=1;he<R;++he){F=Math.max(1,T.x-he),B=Math.max(1,T.y-he),W=Math.min(E.x+he,p-2),J=Math.min(E.y+he,p-2);for(let ve=B;ve<=J;++ve)for(let Ce=F;Ce<=W;++Ce){let De=ve*p+Ce;if(Lh[De]===255){let Ue=0,ze=0,$e=-1,ot=-1;for(let We=-1;We<=1;++We)for(let et=-1;et<=1;++et){let He=(ve+We)*p+Ce+et;if(Lh[He]>=he)continue;let tt=Tx[He],ct=Math.abs(tt);ct>ze&&(Ue=tt,ze=ct,$e=et,ot=We)}if(ze>.1){let We=1-(he+.5*Math.abs($e*ot))/R,et=n._dem.get(Ce,ve)+Ue*We,He=n._dem.get(Ce+$e,ve+ot),tt=n._dem.get(Ce-$e,ve-ot,!0);(et-He)*(et-tt)>0&&(et=(He+tt)/2),Tx[De]=n._dem.set(Ce,ve,et),Lh[De]=he}}}}}b&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Rr.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)j0(n.node),xx(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){let p=c[m].node;c[m].hiddenByReplacement=!!p.footprint&&!a.find(b=>b.footprint===p.footprint)}}getHeightAtTileCoord(e,n){let a=this.getNodesInfo(),c=[],m=[0,0,0],p=t.ad.identity([]);for(let b=0;b<this.nodesInfo.length;b++){let y=a[b],w=y.node.meshes[0],M=w.transformedAabb;if(e<M.min[0]||n<M.min[1]||e>M.max[0]||n>M.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};t.ad.invert(p,y.node.matrix),m[0]=e,m[1]=n,t._.transformMat4(m,m,p);let T=(m[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*Oh|0,E=Math.min(63,(m[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*Oh|0)*Oh+Math.min(63,T),P=w.heightmap[E];if(!(P<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:P,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new xt(e,n),new xt(e,n),c),c.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function eg(i,e){return!i.isLightConstant&&e}function b3(i,e,n,a,c,m,p,b){let y=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;n[3]>0&&(y=Wt(y,255*n[0],n[3]),w=Wt(w,255*n[1],n[3]),M=Wt(M,255*n[2],n[3]));let T=y<<8|w,E=M<<8|Math.floor(255*a[3]),P=function(he){let ve=fi(he,0,2);return Math.min(Math.round(.5*ve*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],R=fi(c[0],0,1),F=fi(c[1],0,1),B=fi(c[2],0,1),W=fi(c[3],0,1),J,ee,te,pe;if(R!==F&&p!==m&&F!==R){let he=p-m;ee=1/(he*(F-R)),te=-(m+he*R)/(he*(F-R));let ve=fi(c[4],-1,1);pe=Math.pow(10,ve),J=255*B<<8|255*W}else J=65535,ee=0,te=1,pe=1;if(i.emplaceBack(T,E,P,J,ee,te,pe),b){let he=b.length;b.clear();for(let ve=0;ve<he;ve++)b.emplaceBack(T,E,P,J,ee,te,pe)}}function y3(i,e,n){let a=i.node,c=0,m=n&ym.HasMeshoptCompression;for(let p of a.meshes){if(a.lights&&a.lightMeshIndex===c||!p.featureData)continue;p.featureArray=new q_,p.featureArray.reserve(p.featureData.length);let b=e;for(let y of p.featureData){let w=m?65535&y:y>>16&65535,M=m?y>>16&65535:65535&y,T=(15&M)<8?15&M:0,E=i.evaluatedRMEA[T],P=i.evaluatedColor[T],R=i.emissionHeightBasedParams[T],F;if(b&&T===2&&a.lights&&(F=new q_,F.resize(10*a.lights.length)),b3(p.featureArray,w,P,E,R,p.aabb.min[2],p.aabb.max[2],F),F&&b){b=!1;let B=a.meshes[a.lightMeshIndex];B.featureArray=F,B.featureArray._trim()}}p.featureArray._trim(),c++}}function zM(i,e,n,a){let c=1<<i.z;e.lat=zr((a/gt+i.y)/c),e.lng=Lo((n/gt+i.x)/c)}ne(q0,"Tiled3dModelBucket",{omit:["layers"]}),ne(FM,"Tiled3dModelFeature");let v3={circle:class extends gr{constructor(i,e,n,a){super(i,aP,e,n,a)}createBucket(i){return new Mv(i)}queryRadius(i){let e=i;return nm("circle-radius",this,e)+nm("circle-stroke-width",this,e)+K_(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,a,c,m,p,b){let y=YC(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return c2(i,a,m,p,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,e,n){let a=l2(this);return{config:new Mh(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}},heatmap:class extends gr{createBucket(i){return new h2(i)}constructor(i,e,n,a){super(i,_P,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ef({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return nm("heatmap-radius",this,i)}queryIntersectsFeature(i,e,n,a,c,m,p,b){let y=this.paint.get("heatmap-radius").evaluate(e,n);return c2(i,a,m,p,b,!0,!0,new xt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,e,n){return i==="heatmap"?{config:new Mh(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends gr{constructor(i,e,n,a){super(i,yP,e,n,a)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,e,n){return{overrideFog:!1}}},fill:class extends gr{constructor(i,e,n,a){super(i,OP,e,n,a)}getProgramIds(){let i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(i,e,n){return{config:new Mh(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(i,e){super.recalculate(i,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new s0(i)}queryRadius(){return K_(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,a,c,m){return!i.queryGeometry.isAboveHorizon&&HC($C(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends gr{constructor(i,e,n,a){super(i,cO,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new p0(i)}queryRadius(){return K_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,e,n,a,c,m,p,b,y){let w=YC(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,n),T=this.paint.get("fill-extrusion-base").evaluate(e,n),E=[0,0],P=b&&m.elevation,R=m.elevation?m.elevation.exaggeration():1,F=i.tile.getBucket(this);if(P&&F instanceof p0){let te=F.centroidVertexArray,pe=y+1;pe<te.length&&(E[0]=te.geta_centroid_pos0(pe),E[1]=te.geta_centroid_pos1(pe))}if(E[0]===0&&E[1]===1)return!1;m.projection.name==="globe"&&(a=K2([a],[new xt(0,0),new xt(gt,gt)],i.tileID.canonical).map(te=>te.polygon).flat());let B=P?b:null,[W,J]=function(te,pe,he,ve,Ce,De,Ue,ze,$e,ot,We){return te.projection.name==="globe"?function(et,He,tt,ct,nt,Mt,at,ht,Vt,Lt,Ot){let dt=[],jt=[],si=et.projection.upVectorScale(Ot,et.center.lat,et.worldSize).metersToTile,Zt=[0,0,0,1],hi=[0,0,0,1],li=(qt,on,rn,ji)=>{qt[0]=on,qt[1]=rn,qt[2]=ji,qt[3]=1},xi=Q2();tt>0&&(tt+=xi),ct+=xi;for(let qt of He){let on=[],rn=[];for(let ji of qt){let Pi=ji.x+nt.x,Ui=ji.y+nt.y,_n=et.projection.projectTilePoint(Pi,Ui,Ot),un=et.projection.upVector(Ot,ji.x,ji.y),Nn=tt,Rn=ct;if(at){let to=eS(Pi,Ui,tt,ct,at,ht,Vt,Lt);Nn+=to.base,Rn+=to.top}tt!==0?li(Zt,_n.x+un[0]*si*Nn,_n.y+un[1]*si*Nn,_n.z+un[2]*si*Nn):li(Zt,_n.x,_n.y,_n.z),li(hi,_n.x+un[0]*si*Rn,_n.y+un[1]*si*Rn,_n.z+un[2]*si*Rn),t._.transformMat4(Zt,Zt,Mt),t._.transformMat4(hi,hi,Mt),on.push(new Dh(Zt[0],Zt[1],Zt[2])),rn.push(new Dh(hi[0],hi[1],hi[2]))}dt.push(on),jt.push(rn)}return[dt,jt]}(te,pe,he,ve,Ce,De,Ue,ze,$e,ot,We):Ue?function(et,He,tt,ct,nt,Mt,at,ht,Vt){let Lt=[],Ot=[],dt=[0,0,0,1];for(let jt of et){let si=[],Zt=[];for(let hi of jt){let li=hi.x+ct.x,xi=hi.y+ct.y,qt=eS(li,xi,He,tt,Mt,at,ht,Vt);dt[0]=li,dt[1]=xi,dt[2]=qt.base,dt[3]=1,t.aA.transformMat4(dt,dt,nt),dt[3]=Math.max(dt[3],1e-5);let on=new Dh(dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]);dt[0]=li,dt[1]=xi,dt[2]=qt.top,dt[3]=1,t.aA.transformMat4(dt,dt,nt),dt[3]=Math.max(dt[3],1e-5);let rn=new Dh(dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]);si.push(on),Zt.push(rn)}Lt.push(si),Ot.push(Zt)}return[Lt,Ot]}(pe,he,ve,Ce,De,Ue,ze,$e,ot):function(et,He,tt,ct,nt){let Mt=[],at=[],ht=nt[8]*He,Vt=nt[9]*He,Lt=nt[10]*He,Ot=nt[11]*He,dt=nt[8]*tt,jt=nt[9]*tt,si=nt[10]*tt,Zt=nt[11]*tt;for(let hi of et){let li=[],xi=[];for(let qt of hi){let on=qt.x+ct.x,rn=qt.y+ct.y,ji=nt[0]*on+nt[4]*rn+nt[12],Pi=nt[1]*on+nt[5]*rn+nt[13],Ui=nt[2]*on+nt[6]*rn+nt[14],_n=nt[3]*on+nt[7]*rn+nt[15],un=ji+ht,Nn=Pi+Vt,Rn=Ui+Lt,to=Math.max(_n+Ot,1e-5),qn=ji+dt,Tn=Pi+jt,ur=Ui+si,Br=Math.max(_n+Zt,1e-5);li.push(new Dh(un/to,Nn/to,Rn/to)),xi.push(new Dh(qn/Br,Tn/Br,ur/Br))}Mt.push(li),at.push(xi)}return[Mt,at]}(pe,he,ve,Ce,De)}(m,a,T,M,w,p,B,E,R,m.center.lat,i.tileID.canonical),ee=i.queryGeometry;return function(te,pe,he){let ve=1/0;HC(he,pe)&&(ve=J2(he,pe[0]));for(let Ce=0;Ce<pe.length;Ce++){let De=pe[Ce],Ue=te[Ce];for(let ze=0;ze<De.length-1;ze++){let $e=De[ze],ot=[$e,De[ze+1],Ue[ze+1],Ue[ze],$e];kv(he,ot)&&(ve=Math.min(ve,J2(he,ot)))}}return ve!==1/0&&ve}(W,J,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends gr{constructor(i,e,n,a){super(i,g0,e,n,a),g0.layout&&(this.layout=new nn(g0.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof bh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=oM.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new f0(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,e,n){let a=lS(this);return{config:new Mh(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}queryRadius(i){let e=i,n=aM(nm("line-width",this,e),nm("line-gap-width",this,e)),a=nm("line-offset",this,e);return n/2+Math.abs(a)+K_(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,a,c,m){if(i.queryGeometry.isAboveHorizon)return!1;let p=$C(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),b=i.pixelToTileUnitsFactor/2*aM(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(a=function(w,M){let T=[],E=new xt(0,0);for(let P=0;P<w.length;P++){let R=w[P],F=[];for(let B=0;B<R.length;B++){let W=R[B],J=R[B+1],ee=B===0?E:W.sub(R[B-1])._unit()._perp(),te=B===R.length-1?E:J.sub(W)._unit()._perp(),pe=ee._add(te)._unit();pe._mult(1/(pe.x*te.x+pe.y*te.y)),F.push(pe._mult(M)._add(W))}T.push(F)}return T}(a,y*i.pixelToTileUnitsFactor)),function(w,M,T){for(let E=0;E<M.length;E++){let P=M[E];if(w.length>=3){for(let R=0;R<P.length;R++)if(Zc(w,P[R]))return!0}if(iP(w,P,T))return!0}return!1}(p,a,b)}isTileClipped(){return!0}isDraped(i){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:L0,background:class extends gr{constructor(i,e,n,a){super(i,BR,e,n,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,e,n){return{overrideFog:!1}}},raster:dM,"raster-particle":hM,sky:class extends gr{constructor(i,e,n,a){super(i,qR,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ef({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),c=!a,m=i.style.light,p=m.properties.get("position");return c&&m.properties.get("anchor")==="viewport"&&Kn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?_x(p.azimuthal,90-p.polar,e):_x(a[0],90-a[1],e)}let n=this.paint.get("sky-gradient-center");return _x(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends gr{constructor(i,e,n,a){super(i,$R,e,null)}},model:class extends gr{constructor(i,e,n,a){super(i,i3,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new yx(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof q0?gt-1:0}queryIntersectsFeature(i,e,n,a,c,m){if(!this.modelManager)return!1;let p=this.modelManager,b=i.tile.getBucket(this);if(!(b&&b instanceof yx))return!1;let y=b;for(let w in y.instancesPerModel){let M=y.instancesPerModel[w],T=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(T)){let E=M.features[M.idToFeaturesIndex[T]],P=p.getModel(w,this.scope);if(!P)return!1;let R=t.ad.create(),F=new Fi(0,0),B=y.canonical,W=Number.MAX_VALUE;for(let J=0;J<E.instancedDataCount;++J){let ee=16*(E.instancedDataOffset+J),te=M.instancedDataArray.float32,pe=[te[ee+4],te[ee+5],te[ee+6]];zM(B,F,te[ee],0|te[ee+1]),xM(R,P,m,F,E.rotation,E.scale,pe,!1,!1,!1),m.projection.name==="globe"&&(R=bx(R,m));let he=t.ad.multiply([],m.projMatrix,R),ve=i.queryGeometry,Ce=_M(ve.isPointQuery()?ve.screenBounds:ve.screenGeometry,m,he,P.aabb);Ce!=null&&(W=Math.min(Ce,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(i,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){let e=this._transitionablePaint._values[i];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Y}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,e,n,a){let c=i.tile,m=c.getBucket(this),p=null,b=Number.MAX_VALUE;if(!(m&&m instanceof q0))return{queryFeature:p,intersectionZ:b};let y=m.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new Kt(c.tileID.overscaledZ),y.feature,c.tileID.canonical))return{queryFeature:p,intersectionZ:b};let w=y.node,M=a.calculatePosMatrix(c.tileID.toUnwrapped(),a.worldSize),T=y.evaluatedScale,E=0;a.elevation&&w.elevation&&(E=w.elevation*a.elevation.exaggeration()),t.ad.translate(M,M,[(w.anchor?w.anchor[0]:0)*(T[0]-1),(w.anchor?w.anchor[1]:0)*(T[1]-1),E]),t.ad.scale(M,M,T),t.ad.multiply(M,M,w.matrix);let P=i.queryGeometry,R=P.isPointQuery()?P.screenBounds:P.screenGeometry,F=function(W){let J=t.ad.multiply([],M,W.matrix),ee=t.ad.multiply(J,a.expandedFarZProjMatrix,J);for(let te=0;te<W.meshes.length;++te){let pe=W.meshes[te];if(te===W.lightMeshIndex)continue;let he=_M(R,a,ee,pe.aabb);he!=null&&(b=Math.min(he,b))}if(W.children)for(let te of W.children)F(te)};if(F(w),b===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:b};let B=new Fi(0,0);return zM(c.tileID.canonical,B,y.node.anchor[0],y.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[B.lng,B.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:b}}},clip:class extends gr{constructor(i,e,n,a){super(i,LP,e,n,a)}recalculate(i,e){super.recalculate(i,e)}createBucket(i){return new y2(i)}isTileClipped(){return!0}is3D(){return!0}}};ne(iM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let BM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ex{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let m=BM[15&a];if(!m)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new Ex(b,p,m,e)}constructor(e,n=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let m=BM.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+b+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Dx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:p,nodeSize:b}=this,y=[0,m.length-1,0],w=[];for(;y.length;){let M=y.pop()||0,T=y.pop()||0,E=y.pop()||0;if(T-E<=b){for(let B=E;B<=T;B++){let W=p[2*B],J=p[2*B+1];W>=e&&W<=a&&J>=n&&J<=c&&w.push(m[B])}continue}let P=E+T>>1,R=p[2*P],F=p[2*P+1];R>=e&&R<=a&&F>=n&&F<=c&&w.push(m[P]),(M===0?e<=R:n<=F)&&(y.push(E),y.push(P-1),y.push(1-M)),(M===0?a>=R:c>=F)&&(y.push(P+1),y.push(T),y.push(1-M))}return w}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:m,nodeSize:p}=this,b=[0,c.length-1,0],y=[],w=a*a;for(;b.length;){let M=b.pop()||0,T=b.pop()||0,E=b.pop()||0;if(T-E<=p){for(let B=E;B<=T;B++)VM(m[2*B],m[2*B+1],e,n)<=w&&y.push(c[B]);continue}let P=E+T>>1,R=m[2*P],F=m[2*P+1];VM(R,F,e,n)<=w&&y.push(c[P]),(M===0?e-a<=R:n-a<=F)&&(b.push(E),b.push(P-1),b.push(1-M)),(M===0?e+a>=R:n+a>=F)&&(b.push(P+1),b.push(T),b.push(1-M))}return y}}function Dx(i,e,n,a,c,m){if(c-a<=n)return;let p=a+c>>1;NM(i,e,p,a,c,m),Dx(i,e,n,a,p-1,1-m),Dx(i,e,n,p+1,c,1-m)}function NM(i,e,n,a,c,m){for(;c>a;){if(c-a>600){let w=c-a+1,M=n-a+1,T=Math.log(w),E=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*E*(w-E)/w)*(M-w/2<0?-1:1);NM(i,e,n,Math.max(a,Math.floor(n-M*E/w+P)),Math.min(c,Math.floor(n+(w-M)*E/w+P)),m)}let p=e[2*n+m],b=a,y=c;for(tg(i,e,a,n),e[2*c+m]>p&&tg(i,e,a,c);b<y;){for(tg(i,e,b,y),b++,y--;e[2*b+m]<p;)b++;for(;e[2*y+m]>p;)y--}e[2*a+m]===p?tg(i,e,a,y):(y++,tg(i,e,y,c)),y<=n&&(a=y+1),n<=y&&(c=y-1)}}function tg(i,e,n,a){Ax(i,n,a),Ax(e,2*n,2*a),Ax(e,2*n+1,2*a+1)}function Ax(i,e,n){let a=i[e];i[e]=i[n],i[n]=a}function VM(i,e,n,a){let c=i-n,m=e-a;return c*c+m*m}t.$=ul,t.A=fh,t.B=Ns,t.C=Bi,t.D=Kr,t.E=bl,t.G=Jr,t.H=h,t.I=uR,t.J=Xy,t.K=function(i){let e=i.value,n=[];if(!e)return n;let a=vl(e);return a!=="string"?(n=n.concat([new V0(i.key,e,`string expected, "${a}" found`)]),n):(bM(e,!0)||(n=n.concat([new V0(i.key,e,`invalid url "${e}"`)])),n)},t.L=Oe,t.M=class{constructor(i,e,n,a){this.id=i,this.position=e!=null?new Fi(e[0],e[1]):new Fi(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,e){if(t.ad.multiply(i.matrix,e,i.matrix),i.meshes)for(let n of i.meshes){let a=On.applyTransform(n.aabb,i.matrix);this.aabb.encapsulate(a)}if(i.children)for(let n of i.children)this._applyTransformations(n,i.matrix)}computeBoundsAndApplyParent(){let i=t.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,i)}computeModelMatrix(i,e,n,a,c,m,p=!1){xM(this.matrix,this,i.transform,this.position,e,n,a,c,m,p)}upload(i){if(!this.uploaded){for(let e of this.nodes)vx(e,i);for(let e of this.nodes)j0(e);this.uploaded=!0}}destroy(){for(let i of this.nodes)xx(i)}},t.N=qi,t.O=Ke,t.P=xt,t.Q=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return Qa(i.expression.evaluate(e))}interpolate(i,e,n){return{x:Wt(i.x,e.x,n),y:Wt(i.y,e.y,n),z:Wt(i.z,e.z,n),azimuthal:Wt(i.azimuthal,e.azimuthal,n),polar:Wt(i.polar,e.polar,n)}}},t.R=Su,t.S=dv,t.T=Ba,t.U=Xi,t.V=V0,t.W=qr,t.X=Kt,t.Y=eo,t.Z=Y,t.a=Go,t.a$=function(i){let{x:e,y:n}=i.point,{lng:a,lat:c}=i._center;return o2(e,n,i.worldSize,a,c)},t.a0=nn,t.a1=Rl,t.a2=Wt,t.a3=gt,t.a4=d_,t.a5=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return function([n,a]){let c=Qa([1,n,a]);return{x:c.x,y:c.y,z:c.z}}(i.expression.evaluate(e))}interpolate(i,e,n){return{x:Wt(i.x,e.x,n),y:Wt(i.y,e.y,n),z:Wt(i.z,e.z,n)}}},t.a6=wf,t.a7=Y_,t.a8=Dl,t.a9=OC,t.aB=function(i,e){let{x:n,y:a}=i.point,c=o2(n,a,i.worldSize/i._pixelsPerMercatorPixel,0,0);return t.ad.multiply(c,c,Lv(Ws(e)))},t.aD=dm,t.aE=_a,t.aF=y0,t.aG=function(i,e,n,a,c){let m=5*e+2;i.float32[m+0]=n,i.float32[m+1]=a,i.float32[m+2]=c},t.aH=D0,t.aI=Fi,t.aJ=$S,t.aK=zC,t.aL=_r,t.aM=Pv,t.aN=mM,t.aO=Ih,t.aP=i2,t.aQ=function(i,e,n,a,c,m,p,b,y){if(y.name==="globe")return i2(i,e,new Ih(n,a,c),!1);let w=Ah({z:n,x:a,y:c},y);return new On([(m+w.x/w.scale)*e,e*(w.y/w.scale),p],[(m+w.x2/w.scale)*e,e*(w.y2/w.scale),b])},t.aR=function(i,e,n){let a=0;for(let c=0;c<2;++c)i[c]>0&&(a+=(i[c]-0)*(i[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},t.aS=er,t.aT=Dv,t.aU=LC,t.aV=function(i){let e=t.ad.identity(new Float64Array(16));t.ad.multiply(e,i.pixelMatrix,i.globeMatrix);let n=[0,Fa,0],a=[0,za,0];return t._.transformMat4(n,n,e),t._.transformMat4(a,a,e),[n[0]>0&&n[0]<=i.width&&n[1]>0&&n[1]<=i.height&&!zv(i,new Fi(i.center.lat,90)),a[0]>0&&a[0]<=i.width&&a[1]>0&&a[1]<=i.height&&!zv(i,new Fi(i.center.lat,-90))]},t.aW=function(i,e){let{scale:n}=i.tileTransform,a=n*gt/(i.tileSize*Math.pow(2,e.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return t.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},t.aX=B0,t.aY=uM,t.aZ=function(i){let e=uM(i,!0);return t.aC.invert([],[e[0],e[1],e[4],e[5]])},t.a_=Av,t.aa=bo,t.ab=Di,t.ac=function(i,e,n){let a=Math.sqrt(i*i+e*e+n*n),c=a>0?Math.acos(n/a)*Ud:0,m=i!==0||e!==0?Math.atan2(-e,-i)*Ud+90:0;return m<0&&(m+=360),[a,m,c]},t.ae=fm,t.af=cs,t.ag=ax,t.ah=function(i,e){let n={};for(let a=0;a<e.length;a++){let c=e[a];c in i&&(n[c]=i[c])}return n},t.ai=Yc,t.aj=Us,t.ak=Hs,t.al=Zu,t.am=function(i){wu++,wu>Dp&&(i.getActor().send("enforceCacheSizeLimit",Ep),wu=0)},t.an=Bp,t.ao=class{constructor(i){this.entries={},this.scheduler=i}request(i,e,n,a){let c=this.entries[i]=this.entries[i]||{callbacks:[]};if(c.result){let[m,p]=c.result;return this.scheduler?this.scheduler.add(()=>{a(m,p)},e):a(m,p),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=n((m,p)=>{c.result=[m,p];for(let b of c.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,p)},e):b(m,p);setTimeout(()=>delete this.entries[i],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(m=>m!==a),c.callbacks.length||(c.cancel(),delete this.entries[i]))}}},t.ap=function(i,e,n){let a=JSON.stringify(i.request);return i.data&&(this.deduped.entries[a]={result:[null,i.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},c=>{let m=gl(i.request,(p,b,y,w)=>{p?c(p):b&&c(null,{vectorTile:n?void 0:new Wv(new cm(b)),rawData:b,cacheControl:y,expires:w})});return()=>{m.cancel(),c()}},e)},t.aq=pv,t.ar=class extends El{constructor(i){super(i),this.current=UA}set(i,e,n){if(this.fetchUniformLocation(i,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},t.as=fv,t.at=fi,t.au=ml,t.aw=$d,t.ax=vo,t.ay=zr,t.az=function(i,e,n){i[4*e+0]=n[0],i[4*e+1]=n[1],i[4*e+2]=n[2],i[4*e+3]=n[3]},t.b=Pn,t.b$=Kc,t.b0=Gr,t.b1=bv,t.b2=function(i){let e=Math.round((i+45+360)%360/90)%4;return Qg[e]},t.b3=45,t.b4=xv,t.b5=Z_,t.b6=On,t.b7=Qa,t.b8=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},t.b9=xp,t.bA=function(i,e){return[Math.pow(i[0],2.2)*e,Math.pow(i[1],2.2)*e,Math.pow(i[2],2.2)*e]},t.bB=oS,t.bD=r2,t.bE=yu,t.bF=bu,t.bG=256,t.bH=function(i,e){let n=[0,0,0],a=Tf(Ws(e.canonical));return t._.transformMat4(n,n,a),t._.transformMat4(n,n,i),n},t.bI=i=>({u_camera_to_center_distance:new bo(i),u_extrude_scale:new gv(i),u_device_pixel_ratio:new bo(i),u_matrix:new wf(i),u_inv_rot_matrix:new wf(i),u_merc_center:new Dl(i),u_tile_id:new pv(i),u_zoom_transition:new bo(i),u_up_dir:new pv(i),u_emissive_strength:new bo(i)}),t.bJ=i=>({u_matrix:new wf(i),u_pixels_to_tile_units:new gv(i),u_device_pixel_ratio:new bo(i),u_units_to_pixels:new Dl(i),u_dash_image:new Y_(i),u_gradient_image:new Y_(i),u_image_height:new bo(i),u_texsize:new Dl(i),u_tile_units_to_pixels:new bo(i),u_alpha_discard_threshold:new bo(i),u_trim_offset:new Dl(i),u_trim_fade_range:new Dl(i),u_trim_color:new fv(i),u_emissive_strength:new bo(i)}),t.bK=i=>({u_matrix:new wf(i),u_texsize:new Dl(i),u_pixels_to_tile_units:new gv(i),u_device_pixel_ratio:new bo(i),u_image:new Y_(i),u_units_to_pixels:new Dl(i),u_tile_units_to_pixels:new bo(i),u_alpha_discard_threshold:new bo(i),u_trim_offset:new Dl(i)}),t.bL=nv,t.bM=wO,t.bN=Yr,t.bO=VO,t.bP=BS,t.bQ=Jv,t.bR=l2,t.bS=(i,e,n,a,c,m)=>{let p=i.transform,b=p.projection.name==="globe",y;if(m.paint.get("circle-pitch-alignment")==="map")if(b){let M=r2(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;y=Float32Array.from([M,0,0,M])}else y=p.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let w={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(p.projection),u_matrix:i.translatePosMatrix(e.projMatrix,n,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Rr.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:uP,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(b){w.u_inv_rot_matrix=a,w.u_merc_center=c,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Rl(p.zoom);let M=c[0]*gt,T=c[1]*gt;w.u_up_dir=p.projection.upVector(new Ih(0,0,0),M,T)}return w},t.bT=lS,t.bU=(i,e,n,a,c,m)=>{let p=i.transform;return{u_matrix:sS(i,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:aS(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m}},t.bV=(i,e,n,a,c,m,p)=>{let b=i.transform,y=b.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:sS(i,e,n,a),u_pixels_to_tile_units:y,u_device_pixel_ratio:m,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:cS(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:aS(e,i.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},t.bW=wp,t.bX=Ef,t.bY=Q2,t.bZ=XA,t.b_=p0,t.ba=function(i,e,n){let a=Rl(n.zoom),c=i.style.map._antialias,m=e.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return a===0&&!c&&!m},t.bb=function(i){let e=i.pixelsPerMeter,n=e/vo(1,i.center.lat),a=t.ad.identity(new Float64Array(16));return t.ad.translate(a,a,[i.point.x,i.point.y,0]),t.ad.scale(a,a,[n,n,e]),Float32Array.from(a)},t.bc=t0,t.bd=function(i){let e=er-5;i=fi(i,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(Di(i))),3);return Math.round(n*(yv.length-1))},t.be=function(i,e,n,a){let c=e.getNorth(),m=e.getSouth(),p=e.getWest(),b=e.getEast(),y=1<<i.z,w=b-p,M=c-m,T=w/Ju,E=-M/yv[n],P=[0,T,0,E,0,0,c,p,0];if(i.z>0){let R=180/a;t.bC.multiply(P,P,[R/w+1,0,0,0,R/M+1,0,-.5*R/T,.5*R/E,1])}return P[2]=y,P[5]=i.x,P[8]=i.y,P},t.bf=Tf,t.bg=Ws,t.bh=function(i,e,n){let a=t.ad.identity(new Float64Array(16)),c=(e/(1<<i)-.5)*Math.PI*2;return t.ad.rotateY(a,n.globeMatrix,c),Float32Array.from(a)},t.bi=vc,t.bj=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},t.bk=dM,t.bl=hM,t.bm=cM,t.bn=function(i,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<i.length;a++){let c=document.createElement("source");i_(i[a])||(n.crossOrigin="Anonymous"),c.src=i[a],n.appendChild(c)}return{cancel:()=>{}}},t.bo=A0,t.bp=fu,t.bq=class{isDataAvailableAtPoint(i){let e=this._source();if(this.isUsingMockSource()||!e||i.y<0||i.y>1)return!1;let n=e.getSource().maxzoom,a=1<<n,c=Math.floor(i.x),m=Math.floor((i.x-c)*a),p=Math.floor(i.y*a),b=this.findDEMTileFor(new _r(n,c,n,m,p));return!(!b||!b.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||i.y<0||i.y>1)return e;let c=a.getSource().maxzoom,m=1<<c,p=Math.floor(i.x),b=i.x-p,y=new _r(c,p,c,Math.floor(b*m),Math.floor(i.y*m)),w=this.findDEMTileFor(y);if(!w||!w.dem)return e;let M=w.dem,T=1<<w.tileID.canonical.z,E=(b*T-w.tileID.canonical.x)*M.dim,P=(i.y*T-w.tileID.canonical.y)*M.dim,R=Math.floor(E),F=Math.floor(P);return(n?this.exaggeration():1)*Wt(Wt(M.get(R,F),M.get(R,F+1),P-F),Wt(M.get(R+1,F),M.get(R+1,F+1),P-F),E-R)}getAtTileOffset(i,e,n){let a=1<<i.canonical.z;return this.getAtPointOrZero(new eo(i.wrap+(i.canonical.x+e/gt)/a,(i.canonical.y+n/gt)/a))}getAtTileOffsetFunc(i,e,n,a){return c=>{let m=this.getAtTileOffset(i,c.x,c.y),p=a.upVector(i.canonical,c.x,c.y),b=a.upVectorScale(i.canonical,e,n).metersToTile;return t._.scale(p,p,m*b),p}}getForTilePoints(i,e,n,a){if(this.isUsingMockSource())return!1;let c=am.create(this,i,a);return!!c&&(e.forEach(m=>{m[2]=this.exaggeration()*c.getElevationAt(m[0],m[1],n)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(i);if(!e||!e.dem)return null;let n=e.dem.tree,a=e.tileID,c=1<<i.canonical.z-a.canonical.z,m=i.canonical.x/c-a.canonical.x,p=i.canonical.y/c-a.canonical.y,b=0;for(let y=0;y<i.canonical.z-a.canonical.z&&!n.leaves[b];y++){m*=2,p*=2;let w=2*Math.floor(p)+Math.floor(m);b=n.childOffsets[b]+w,m%=1,p%=1}return{min:this.exaggeration()*n.minimums[b],max:this.exaggeration()*n.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let i=this.visibleDemTiles;if(i.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let c of i){let m=this.getMinMaxForTile(c.tileID);m&&(n=Math.min(n,m.min),a=Math.max(a,m.max),e=!0)}return e?{min:n,max:a}:null}},t.br=kf,t.bs=e0,t.bt=rs,t.bu=kr,t.bv=Ph,t.bw=wx,t.bx=U0,t.by=R0,t.bz=p2,t.c=PM,t.c$=Zd,t.c0=450,t.c1=7,t.c2=jR,t.c3=nM,t.c4=256,t.c5=e2,t.c6=Lv,t.c7=$i,t.c8=Hc,t.c9=Sh,t.cA=function(i){let e=1/0,n=1/0,a=-1/0,c=-1/0;for(let m of i)e=Math.min(e,m.x),n=Math.min(n,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return{min:new xt(e,n),max:new xt(a,c)}},t.cB=Zc,t.cC=jC,t.cD=yo,t.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.cF=AS,t.cG=kv,t.cH=D2,t.cI=A2,t.cJ=nx,t.cK=Ex,t.cL=function(i){return i({pluginStatus:it,pluginURL:Ge}),ti.on("pluginStateChange",i),i},t.cM=um,t.cN=tx,t.cO=Mu,t.cP=Dt,t.cQ=N,t.cR=Tp,t.cS=Mc,t.cT=Da,t.cU=function(i){let e=i.indexOf(Nc);return e>=0?i.slice(0,e):i},t.cV=function(i){return i.indexOf(Nc)>=0},t.cW=function(i){let e=i.indexOf(Nc);return e>=0?i.slice(e+1):""},t.cX=function(i){let e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},t.cY=function(i,e,n,a){return i.type==="custom"?new WR(i,e):new v3[i.type](i,e,n,a)},t.cZ=pl,t.c_=ti,t.ca=1,t.cb=Gf,t.cc=0,t.cd=sv,t.ce=function(i,e,n,a,c){return fi((i-e)/(n-e)*(c-a)+a,a,c)},t.cf=F_,t.cg=Th,t.ch=class{constructor(i,e,n,a){this.context=i,this.format=a,this.size=n,this.texture=i.gl.createTexture();let[c,m,p]=this.size,{gl:b}=i;b.bindTexture(b.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,w=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(y=b.DEPTH_COMPONENT16,w=b.UNSIGNED_SHORT),this.format===b.R8&&(a=b.RED),this.format===b.R32F&&(w=b.FLOAT,a=b.RED),b.texImage3D(b.TEXTURE_3D,0,y,c,m,p,0,a,w,e.data)}bind(i,e){let{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_3D,this.texture),i!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,i),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,i),this.minFilter=i),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},t.ci=bx,t.cj=[1,1,1],t.ck=am,t.cl=ym,t.cm=Gc,t.cn=Qu,t.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new xt(1/0,1/0),max:new xt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,e=!1){let n=I2(new xt(0,0),new xt(gt,gt),i),a=[];if(e&&!Gv(n,this._globalClipBounds))return a;for(let c of this._activeRegions){if(c.hiddenByOverlap||!Gv(n,c))continue;let m=ZP(c.min,c.max,i);a.push({min:m.min,max:m.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask})}return a}setSources(i){this._setSources(i.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let a of e.cache.getVisibleCoordinates()){let c=e.cache.getTile(a).buckets[e.layer];c&&c.updateFootprints(a.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(i){let e=i.getFootprints();if(e.length===0)return;let n=i.getOrder(),a=i.getClipMask();for(let c of e){if(!c.footprint)continue;let m=I2(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:n,clipMask:a})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||h0(e.min,n.min)||h0(e.max,n.max));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let e=0;for(;!i&&e!==this._activeRegions.length;){let n=this._activeRegions[e],a=this._prevRegions[e];i=n.priority!==a.priority||!k2(n,a)||n.order!==a.order||n.clipMask!==a.clipMask,++e}}if(i){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let a=this._activeRegions;if(n>=a.length)return n;let c=a[n].priority;for(;n<a.length&&a[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let c=n,m=n;for(;c!==a;){let p=this._activeRegions[c];p.hiddenByOverlap=!1;for(let b=0;b<m;b++){let y=this._activeRegions[b];if(!y.hiddenByOverlap&&p.order===1/0&&Gv(p,y)&&(p.hiddenByOverlap=E2(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++c}n=a,a=e(n)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=i.length-1;e>=0;e--)this._addSource(i[e]);this._computeReplacement()}},t.cp=jc,t.cq=O0,t.cr=vf,t.cs=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let i of this._poleSegments)i.destroy();for(let i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,e){let n=new rs,a=new kr,c=[],m=i+1+2,p=e[0]+1,b=e[0]+1+(1+e.length),y=(w,M,T)=>{let E=w===m-1?w-2:w===0?w:w-1;return E+=T?24575:0,[E,M]};for(let w=0;w<m;++w)n.emplaceBack(...y(w,0,!0));for(let w=0;w<p;++w)for(let M=0;M<m;++M)n.emplaceBack(...y(M,w,(M===0||M===m-1)&&!0));for(let w=0;w<e.length;++w){let M=e[w];for(let T=0;T<m;++T)n.emplaceBack(...y(T,M,!0))}for(let w=0;w<e.length;++w){let M=a.length,T=e[w]+1+2,E=new kr;for(let F=0;F<T-1;F++){let B=F===T-2,W=B?m*(b-e.length+w-F):m;for(let J=0;J<m-1;J++){let ee=F*m+J;F===0||B||J===0||J===m-2?(E.emplaceBack(ee+1,ee,ee+W),E.emplaceBack(ee+W,ee+W+1,ee+1)):(a.emplaceBack(ee+1,ee,ee+W),a.emplaceBack(ee+W,ee+W+1,ee+1))}}let P=Pn.simpleSegment(0,M,n.length,a.length-M);for(let F=0;F<E.uint16.length;F+=3)a.emplaceBack(E.uint16[F],E.uint16[F+1],E.uint16[F+2]);let R=Pn.simpleSegment(0,M,n.length,a.length-M);c.push({withoutSkirts:P,withSkirts:R})}return{vertices:n,indices:a,segments:c}}_createGrid(i){let e=this._fillGridMeshWithLods(Ju,yv);this._gridSegments=e.segments,this._gridBuffer=i.createVertexBuffer(e.vertices,kf.members),this._gridIndexBuffer=i.createIndexBuffer(e.indices,!0)}_createPoles(i){let e=new kr;for(let p=0;p<=Ju;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);let n=new Sh,a=new Sh,c=new Sh,m=new Sh;this._poleSegments=[];for(let p=0,b=0;p<bv;p++){let y=360/(1<<p);n.emplaceBack(0,-yo,0,.5,0),a.emplaceBack(0,-yo,0,.5,1),c.emplaceBack(0,-yo,0,.5,.5),m.emplaceBack(0,-yo,0,.5,.5);for(let w=0;w<=Ju;w++){let M=w/Ju,T=0,E=Wt(0,y,M),[P,R,F]=em(dP,hP,E,yo);n.emplaceBack(P,R,F,M,T),a.emplaceBack(P,R,F,M,1-T);let B=Di(E);M=.5+.5*Math.sin(B),T=.5+.5*Math.cos(B),c.emplaceBack(P,R,F,M,T),m.emplaceBack(P,R,F,M,1-T)}this._poleSegments.push(Pn.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(n,J_,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(a,J_,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(c,J_,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(m,J_,!1)}getGridBuffers(i,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},t.ct=function(i){return eh.has(i)},t.cu=N2,t.cv=function(i,e,n=0,a=!0){let c=new xt(n,n),m=i.sub(c),p=e.add(c),b=[m,new xt(p.x,m.y),p,new xt(m.x,p.y)];return a&&b.push(m.clone()),b},t.cw=function(i,e){let n=[];for(let a=0;a<i.length;a++){let c=ml(a-1,-1,i.length-1),m=ml(a+1,-1,i.length-1),p=i[a],b=i[m],y=i[c].sub(p).unit(),w=b.sub(p).unit(),M=w.angleWithSep(y.x,y.y),T=y.add(w).unit().mult(-1*e/Math.sin(M/2));n.push(p.add(T))}return n},t.cx=US,t.cy=qC,t.cz=function(i,e,n=0){return t._.fromValues(((e.x-n)*i.scale-i.x)*gt,(e.y*i.scale-i.y)*gt,BC(e.z,e.y))},t.d=Eu,t.d$=uu,t.d0=Hd,t.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.d2=gc,t.d3=VC,t.d4=kh,t.d5=function([i,e,n]){let a=Math.hypot(i,e,n),c=Math.atan2(i,n),m=.5*Math.PI-Math.acos(-e/a);return new Fi(Gr(c),Gr(m))},t.d6=Lo,t.d7=tm,t.d8=I,t.d9=zv,t.dA=function(i){let e=e_();if(!e)return;let n=e.delete(Jg);i&&n.catch(i).then(()=>i())},t.dB=Xf,t.dC=CM,t.dD=function(i){Sx=Rr.resolveURL(i),xm||(xm=new wx(U0(),new bl)),xm.broadcast("setDracoUrl",Sx)},t.dE=SM,t.dF=function(i){vm=Rr.resolveURL(i),xm||(xm=new wx(U0(),new bl)),xm.broadcast("setMeshoptUrl",vm)},t.dG=jo,t.dH=ne,t.dI=Xc,t.dJ=ls,t.dK=Ah,t.dL=uv,t.dM=dS,t.dN=_S,t.dO=nS,t.dP=bc,t.dQ=OS,t.dR=gm,t.dS=function(i,e,n,a,c,m,p,b,y,w,M){i.createArrays(),i.tilePixelRatio=gt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;let T=i.layers[0].layout,E=i.layers[0]._unevaluatedLayout._values,P={};if(i.textSizeData.kind==="composite"){let{minZoom:W,maxZoom:J}=i.textSizeData;P.compositeTextSizes=[E["text-size"].possiblyEvaluate(new Kt(W),b),E["text-size"].possiblyEvaluate(new Kt(J),b)]}if(i.iconSizeData.kind==="composite"){let{minZoom:W,maxZoom:J}=i.iconSizeData;P.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new Kt(W),b),E["icon-size"].possiblyEvaluate(new Kt(J),b)]}P.layoutTextSize=E["text-size"].possiblyEvaluate(new Kt(y+1),b),P.layoutIconSize=E["icon-size"].possiblyEvaluate(new Kt(y+1),b),P.textMaxSize=E["text-size"].possiblyEvaluate(new Kt(18),b);let R=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",F=T.get("text-size"),B=!1;for(let W of i.features)if(W.icon&&W.icon.nameSecondary){B=!0;break}for(let W of i.features){let J=T.get("text-font").evaluate(W,{},b).join(","),ee=F.evaluate(W,{},b),te=P.layoutTextSize.evaluate(W,{},b),pe=(P.layoutIconSize.evaluate(W,{},b),{horizontal:{},vertical:void 0}),he=W.text,ve,Ce=[0,0];if(he){let ze=he.toString(),$e=T.get("text-letter-spacing").evaluate(W,{},b)*Yr,ot=T.get("text-line-height").evaluate(W,{},b)*Yr,We=Be(ze)?$e:0,et=T.get("text-anchor").evaluate(W,{},b),He=T.get("text-variable-anchor");if(!He){let at=T.get("text-radial-offset").evaluate(W,{},b);Ce=at?BS(et,[at*Yr,ix]):T.get("text-offset").evaluate(W,{},b).map(ht=>ht*Yr)}let tt=R?"center":T.get("text-justify").evaluate(W,{},b),ct=T.get("symbol-placement")==="point",nt=ct?T.get("text-max-width").evaluate(W,{},b)*Yr:1/0,Mt=at=>{i.allowVerticalPlacement&&Le(ze)&&(pe.vertical=Kv(he,e,n,c,J,nt,ot,et,at,We,Ce,_a.vertical,!0,te,ee))};if(!R&&He){let at=tt==="auto"?He.map(Vt=>nx(Vt)):[tt],ht=!1;for(let Vt=0;Vt<at.length;Vt++){let Lt=at[Vt];if(!pe.horizontal[Lt])if(ht)pe.horizontal[Lt]=pe.horizontal[0];else{let Ot=Kv(he,e,n,c,J,nt,ot,"center",Lt,We,Ce,_a.horizontal,!1,te,ee);Ot&&(pe.horizontal[Lt]=Ot,ht=Ot.positionedLines.length===1)}}Mt("left")}else{if(tt==="auto"&&(tt=nx(et)),ct||T.get("text-writing-mode").indexOf("horizontal")>=0||!Le(ze)){let at=Kv(he,e,n,c,J,nt,ot,et,tt,We,Ce,_a.horizontal,!1,te,ee);at&&(pe.horizontal[tt]=at)}Mt(ct?"left":tt)}}let De=!1;if(W.icon&&W.icon.namePrimary){let ze=a[W.icon.namePrimary];ze&&(ve=ZO(c[W.icon.namePrimary],W.icon.nameSecondary?c[W.icon.nameSecondary]:void 0,T.get("icon-offset").evaluate(W,{},b),T.get("icon-anchor").evaluate(W,{},b)),De=ze.sdf,i.sdfIcons===void 0?i.sdfIcons=ze.sdf:i.sdfIcons!==ze.sdf&&Kn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==i.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}let Ue=VS(pe.horizontal)||pe.vertical;i.iconsInText||(i.iconsInText=!!Ue&&Ue.iconsInText),(Ue||ve)&&iR(i,W,pe,ve,a,P,te,0,Ce,De,p,b,w,M,B)}m&&i.generateCollisionDebugBuffers(y,i.collisionBoxArray)},t.dT=f0,t.dU=s0,t.dV=Wv,t.dW=cm,t.dX=u0,t.dY=px,t.dZ=c0,t.d_=l0,t.da=a2,t.db=function(i){let e=[0,0,0],n=t.ad.identity(new Float64Array(16));return t.ad.multiply(n,i.pixelMatrix,i.globeMatrix),t._.transformMat4(e,e,n),new xt(e[0],e[1])},t.dc=ke,t.dd=xe,t.de=function(i){let e=i.navigator?i.navigator.userAgent:null;return!!function(n){if(_u==null){let a=n.navigator?n.navigator.userAgent:null;_u=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return _u}(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.df=mu,t.dg=class{constructor(i,e,n){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let i=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Fp,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!N(i))return i;let n=ca(i);return n.params.push(`sdk=js-${_}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!N(i))return i;let n=ca(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(i,e){if(!N(i))return i;let n=ca(i);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(i,e,n,a){if(!N(i))return i;let c=ca(i);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(i,e,n,a){let c=ca(i);return N(i)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${e}${n}`,Cc(c))}normalizeTileURL(i,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!N(i))return i;let a=ca(i);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${Cu.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${I.RASTER_URL_PREFIX}${a.path}`:a.authority==="rasterarrays"?a.path=`/${I.RASTERARRAYS_URL_PREFIX}${a.path}`:a.authority==="3dtiles"?a.path=`/${I.TILES3D_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${I.TILE_URL_VERSION}${a.path}`);let c=this._customAccessToken||function(m){for(let p of m){let b=p.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(a.params)||I.ACCESS_TOKEN;return I.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(i,e){let n=ca(i);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${I.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?a+=`rasterarrays/${n.path.replace(`/${I.RASTERARRAYS_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${I.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(m=>!m.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(i,e){let n=!!e&&N(e),a=[];for(let c of i.tiles||[])O(c)?a.push(this.canonicalizeTileURL(c,n)):a.push(c);return a}_makeAPIURL(i,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=ca(I.API_URL);if(i.protocol=a.protocol,i.authority=a.authority,i.protocol==="http"){let c=i.params.indexOf("secure");c>=0&&i.params.splice(c,1)}if(a.path!=="/"&&(i.path=`${a.path}${i.path}`),!I.REQUIRE_ACCESS_TOKEN)return Cc(i);if(e=e||I.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(c=>c.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Cc(i)}},t.dh=function(i,e){e?eh.add(i):eh.delete(i)},t.di=Cu,t.dj=Oy,t.dk=Tu,t.dl=zp,t.dm=o_,t.dn=Py,t.dp=function(i){eh.delete(i)},t.dq=Sc,t.dr=Jd,t.ds=_c,t.dt=_,t.du=function(i,e){Ep=i,Dp=e},t.dv=function(i,e,n=!1){if(it===bt||it===yt||it===kt)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ge=Rr.resolveURL(i),it=bt,vt=e,ai(),n||Ai()},t.dw=vi,t.dx=function(){U0().acquire(Cx)},t.dy=function(){let i=Kf;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(Cx),Kf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dz=Qf,t.e=Rr,t.e0=hS,t.e1=Xe,t.e2=gl,t.e3=function(i){let e=0;if(new Uint32Array(i,0,1)[0]!==kM){let n=new Uint32Array(i,0,7),[,,a,c,m,p]=n;e=n.byteLength+c+m+p+m,(a!==i.byteLength||e>=i.byteLength)&&Kn("Invalid b3dm header information.")}return DM(i,e)},t.e4=function(i,e){let n=PM(i);for(let a of n){for(let c of a.meshes)g3(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(_3(a.lights,e)))}return n},t.e5=q0,t.e6=wM,t.e7=Ki,t.e8=function(i){Yd(),Ja&&Ja.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-i;a++)e.delete(n[a])})})},t.f=ao,t.g=function(i,e){return Zd(qr(i,{type:"json"}),e)},t.h=Ps,t.i=ga,t.j=PS,t.k=ex,t.l=function(i){return fetch(i).then(e=>e.arrayBuffer()).then(e=>DM(e,0,i))},t.m=class extends V0{},t.n=vl,t.o=Up,t.p=gR,t.q=Yu,t.r=f,t.s=o,t.t=z,t.u=Oo,t.v=Fr,t.w=Kn,t.x=Z,t.y=U,t.z=Bu}),r(["./shared"],function(t){function _(Se){let G=Se?Se.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function C(Se){if(typeof Se=="number"||typeof Se=="boolean"||typeof Se=="string"||Se==null)return JSON.stringify(Se);if(Array.isArray(Se)){let K="[";for(let ce of Se)K+=`${C(ce)},`;return`${K}]`}let G="{";for(let K of Object.keys(Se).sort())G+=`${K}:${C(Se[K])},`;return`${G}}`}function I(Se){let G="";for(let K of t.cE)G+=`/${C(Se[K])}`;return G}class O{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,K){this._layerConfigs={},this._layers={},this.update(G,[],K)}update(G,K,ce){this._options=ce;for(let ye of G)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=t.cY(ye,this.scope,null,this._options)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(let ye of K)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};let be=function(ye,Ee){let Ne={};for(let je=0;je<ye.length;je++){let ft=Ee&&Ee[ye[je].id]||I(ye[je]);Ee&&(Ee[ye[je].id]=ft);let lt=Ne[ft];lt||(lt=Ne[ft]=[]),lt.push(ye[je])}let Ie=[];for(let je in Ne)Ie.push(Ne[je]);return Ie}(t.dG(this._layerConfigs),this.keyCache);for(let ye of be){let Ee=ye.map(Rt=>this._layers[Rt.id]),Ne=Ee[0];if(Ne.visibility==="none")continue;let Ie=Ne.source||"",je=this.familiesBySource[Ie];je||(je=this.familiesBySource[Ie]={});let ft=Ne.sourceLayer||"_geojsonTileLayer",lt=je[ft];lt||(lt=je[ft]=[]),lt.push(Ee)}}}let N=1*t.dJ;class q{constructor(G){let K={},ce=[];for(let Ne in G){let Ie=G[Ne],je=K[Ne]={};for(let ft in Ie.glyphs){let lt=Ie.glyphs[+ft];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;let Rt=lt.metrics.localGlyph?N:1,$t={x:0,y:0,w:lt.bitmap.width+2*Rt,h:lt.bitmap.height+2*Rt};ce.push($t),je[ft]=$t}}let{w:be,h:ye}=t.j(ce),Ee=new t.dI({width:be||1,height:ye||1});for(let Ne in G){let Ie=G[Ne];for(let je in Ie.glyphs){let ft=Ie.glyphs[+je];if(!ft||ft.bitmap.width===0||ft.bitmap.height===0)continue;let lt=K[Ne][je],Rt=ft.metrics.localGlyph?N:1;t.dI.copy(ft.bitmap,Ee,{x:0,y:0},{x:lt.x+Rt,y:lt.y+Rt},ft.bitmap)}}this.image=Ee,this.positions=K}}t.dH(q,"GlyphAtlas");class ie{constructor(G){this.tileID=new t.aL(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=t.dK(G.tileID.canonical,G.projection),this.projection=G.projection,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep}parse(G,K,ce,be,ye){this.status="parsing",this.data=G,this.collisionBoxArray=new t.dL;let Ee=new t.dM(Object.keys(G.layers).sort()),Ne=new t.dN(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];let Ie={},je=new t.dO(256,256),ft={featureIndex:Ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:je,availableImages:ce,brightness:this.brightness},lt=K.familiesBySource[this.source];for(let At in lt){let Sn=G.layers[At];if(!Sn)continue;let Qi=!1,Oi=!1,Qn=!1;for(let Hr of lt[At])Hr[0].type==="symbol"?Qi=!0:Oi=!0,Hr[0].is3D()&&Hr[0].type!=="model"&&(Qn=!0);if(this.extraShadowCaster&&!Qn||this.isSymbolTile===!0&&!Qi||this.isSymbolTile===!1&&!Oi)continue;Sn.version===1&&t.w(`Vector tile source "${this.source}" layer "${At}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Mn=Ee.encode(At),dr=[];for(let Hr=0;Hr<Sn.length;Hr++){let Wr=Sn.feature(Hr),dl=Ne.getId(Wr,At);dr.push({feature:Wr,id:dl,index:Hr,sourceLayerIndex:Mn})}for(let Hr of lt[At]){let Wr=Hr[0];(!this.extraShadowCaster||Wr.is3D()&&Wr.type!=="model")&&(this.isSymbolTile!==void 0&&Wr.type==="symbol"!==this.isSymbolTile||Wr.minzoom&&this.zoom<Math.floor(Wr.minzoom)||Wr.maxzoom&&this.zoom>=Wr.maxzoom||Wr.visibility!=="none"&&(de(Hr,this.zoom,ft.brightness,ce),(Ie[Wr.id]=Wr.createBucket({index:Ne.bucketLayerIDs.length,layers:Hr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(dr,ft,this.tileID.canonical,this.tileTransform),Ne.bucketLayerIDs.push(Hr.map(dl=>dl.id))))}}let Rt,$t,pi,yi;je.trim();let ri={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ei=()=>{if(Rt)return this.status="done",ye(Rt);if(this.extraShadowCaster)this.status="done",ye(null,{buckets:t.dG(Ie).filter(At=>!At.isEmpty()),featureIndex:Ne,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ft.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if($t&&pi&&yi){let At=new q($t),Sn=new t.dQ(pi,yi,this.lut);for(let Qi in Ie){let Oi=Ie[Qi];Oi instanceof t.dR?(de(Oi.layers,this.zoom,ft.brightness,ce),t.dS(Oi,$t,At.positions,pi,Sn.iconPositions,this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Oi.hasPattern&&(Oi instanceof t.dT||Oi instanceof t.dU||Oi instanceof t.b_)&&(de(Oi.layers,this.zoom,ft.brightness,ce),Oi.addFeatures(ft,this.tileID.canonical,Sn.patternPositions,ce,this.tileTransform,this.brightness))}this.status="done",ye(null,{buckets:t.dG(Ie).filter(Qi=>!Qi.isEmpty()),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:At.image,lineAtlas:je,imageAtlas:Sn,brightness:ft.brightness})}};if(!this.extraShadowCaster){let At=t.dP(ft.glyphDependencies,Oi=>Object.keys(Oi).map(Number));Object.keys(At).length?be.send("getGlyphs",{uid:this.uid,stacks:At,scope:this.scope},(Oi,Qn)=>{Rt||(Rt=Oi,$t=Qn,Ei())},void 0,!1,ri):$t={};let Sn=Object.keys(ft.iconDependencies);Sn.length?be.send("getImages",{icons:Sn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Oi,Qn)=>{Rt||(Rt=Oi,pi=Qn,Ei())},void 0,!1,ri):pi={};let Qi=Object.keys(ft.patternDependencies);Qi.length?be.send("getImages",{icons:Qi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Oi,Qn)=>{Rt||(Rt=Oi,yi=Qn,Ei())},void 0,!1,ri):yi={}}Ei()}}function de(Se,G,K,ce){let be=new t.X(G,{brightness:K});for(let ye of Se)ye.recalculate(be,ce)}class xe extends t.E{constructor(G,K,ce,be,ye,Ee){super(),this.actor=G,this.layerIndex=K,this.availableImages=ce,this.loadVectorData=ye||t.ap,this.loading={},this.loaded={},this.deduped=new t.ao(G.scheduler),this.isSpriteLoaded=be,this.scheduler=G.scheduler,this.brightness=Ee}loadTile(G,K){let ce=G.uid,be=G&&G.request,ye=be&&be.collectResourceTiming,Ee=this.loading[ce]=new ie(G);Ee.abort=this.loadVectorData(G,(Ne,Ie)=>{let je=!this.loading[ce];if(delete this.loading[ce],je||Ne||!Ie)return Ee.status="done",je||(this.loaded[ce]=Ee),K(Ne);let ft=Ie.rawData,lt={};Ie.expires&&(lt.expires=Ie.expires),Ie.cacheControl&&(lt.cacheControl=Ie.cacheControl),Ee.vectorTile=Ie.vectorTile||new t.dV(new t.dW(ft));let Rt=()=>{Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,($t,pi)=>{if($t||!pi)return K($t);let yi={};if(ye){let ri=_(be);ri.length>0&&(yi.resourceTiming=JSON.parse(JSON.stringify(ri)))}K(null,t.W({rawTileData:ft.slice(0)},pi,lt,yi))})};this.isSpriteLoaded?Rt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Rt,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):Rt()}),this.loaded=this.loaded||{},this.loaded[ce]=Ee})}reloadTile(G,K){let ce=this.loaded,be=G.uid;if(ce&&ce[be]){let ye=ce[be];ye.showCollisionBoxes=G.showCollisionBoxes,ye.projection=G.projection,ye.brightness=G.brightness,ye.tileTransform=t.dK(G.tileID.canonical,G.projection),ye.extraShadowCaster=G.extraShadowCaster,ye.lut=G.lut;let Ee=(Ne,Ie)=>{let je=ye.reloadCallback;je&&(delete ye.reloadCallback,ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,je)),K(Ne,Ie)};ye.status==="parsing"?ye.reloadCallback=Ee:ye.status==="done"&&(ye.vectorTile?ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,Ee):Ee())}else K(null,void 0)}abortTile(G,K){let ce=G.uid,be=this.loading[ce];be&&(be.abort&&be.abort(),delete this.loading[ce]),K()}removeTile(G,K){let ce=this.loaded,be=G.uid;ce&&ce[be]&&delete ce[be],K()}}class ke{loadTile(G,K){let{uid:ce,encoding:be,rawImageData:ye,padding:Ee}=G,Ne=ImageBitmap&&ye instanceof ImageBitmap?this.getImageData(ye,Ee):ye;K(null,new t.dX(ce,Ne,be,Ee<1))}getImageData(G,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);let ce=this.offscreenCanvasContext.getImageData(-K,-K,G.width+2*K,G.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}class Ae{decodeRasterArray({task:G,buffer:K},ce){t.dY.performDecoding(K,G).then(be=>{ce(null,be)},be=>{ce(be)})}}let Xe=t.dZ.prototype.toGeoJSON,qe=class{constructor(Se){this._feature=Se,this.extent=t.a3,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){let Se=[];for(let G of this._feature.geometry)Se.push([new t.P(G[0],G[1])]);return Se}{let Se=[];for(let G of this._feature.geometry){let K=[];for(let ce of G)K.push(new t.P(ce[0],ce[1]));Se.push(K)}return Se}}toGeoJSON(Se,G,K){return Xe.call(this,Se,G,K)}},ut=class{constructor(Se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.a3,this.length=Se.length,this._features=Se}feature(Se){return new qe(this._features[Se])}},It=64/4096;class wt{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],K){for(let ce of G){let be=ce.id;if(be==null)continue;let ye=this.features.get(be);ye&&this.updateCache(ye,K),ce.geometry?(ye=Ht(ce),this.updateCache(ye,K),this.features.set(be,ye)):this.features.delete(be),this.updateCache(ye,K)}}updateCache(G,K){for(let{canonical:ce,uid:be}of Object.values(K)){let{z:ye,x:Ee,y:Ne}=ce;Et(G,Math.pow(2,ye),Ee,Ne)&&delete K[be]}}getTile(G,K,ce){let be=Math.pow(2,G),ye=[];for(let Ee of this.features.values())Et(Ee,be,K,ce)&&ye.push(Ii(Ee,be,K,ce));return{features:ye}}getFeatures(){return[...this.features.values()]}}function Et({minX:Se,minY:G,maxX:K,maxY:ce},be,ye,Ee){return Se<(ye+1+It)/be&&G<(Ee+1+It)/be&&K>(ye-It)/be&&ce>(Ee-It)/be}function Ht(Se){let{id:G,geometry:K,properties:ce}=Se;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:be,coordinates:ye}=K,Ee={id:G,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ne=Ee.geometry;if(be==="Point")Ct(ye,Ne,Ee);else if(be==="MultiPoint")for(let Ie of ye)Ct(Ie,Ne,Ee);else if(be==="LineString")Ee.type=2,Yt(ye,Ne,Ee);else if(be==="MultiLineString")Ee.type=2,zt(ye,Ne,Ee);else if(be==="Polygon")Ee.type=3,zt(ye,Ne,Ee,!0);else{if(be!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ee.type=3;for(let Ie of ye)zt(Ie,Ne,Ee,!0)}return Ee}function Ct([Se,G],K,ce){let be=t.aj(Se),ye=t.ak(G);ye=ye<0?0:ye>1?1:ye,K.push(be,ye),ce.minX=Math.min(ce.minX,be),ce.minY=Math.min(ce.minY,ye),ce.maxX=Math.max(ce.maxX,be),ce.maxY=Math.max(ce.maxY,ye)}function Yt(Se,G,K,ce=!1,be=!1){let ye=[];for(let Ee of Se)Ct(Ee,ye,K);G.push(ye),ce&&function(Ee,Ne){let Ie=0;for(let je=0,ft=Ee.length,lt=ft-2;je<ft;lt=je,je+=2)Ie+=(Ee[je]-Ee[lt])*(Ee[je+1]+Ee[lt+1]);if(Ie>0===Ne)for(let je=0,ft=Ee.length;je<ft/2;je+=2){let lt=Ee[je],Rt=Ee[je+1];Ee[je]=Ee[ft-2-je],Ee[je+1]=Ee[ft-1-je],Ee[ft-2-je]=lt,Ee[ft-1-je]=Rt}}(ye,be)}function zt(Se,G,K,ce=!1){for(let be=0;be<Se.length;be++)Yt(Se[be],G,K,ce,be===0)}function Ii(Se,G,K,ce){let{id:be,type:ye,geometry:Ee,tags:Ne}=Se,Ie=[];if(ye===1)Hi(Ee,G,K,ce,Ie);else for(let je of Ee)Ie.push(Hi(je,G,K,ce));return{id:be,type:ye,geometry:Ie,tags:Ne}}function Hi(Se,G,K,ce,be=[]){for(let ye=0;ye<Se.length;ye+=2)be.push(cr(Se[ye],Se[ye+1],G,K,ce));return be}function cr(Se,G,K,ce,be){return[Math.round(t.a3*(Se*K-ce)),Math.round(t.a3*(G*K-be))]}var wi={exports:{}},dn=t.d$,tn=t.d_.VectorTileFeature,jn=Ur;function Ur(Se,G){this.options=G||{},this.features=Se,this.length=Se.length}function Zn(Se,G){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=G||4096}Ur.prototype.feature=function(Se){return new Zn(this.features[Se],this.options.extent)},Zn.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var G=0;G<Se.length;G++){for(var K=Se[G],ce=[],be=0;be<K.length;be++)ce.push(new dn(K[be][0],K[be][1]));this.geometry.push(ce)}return this.geometry},Zn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,G=1/0,K=-1/0,ce=1/0,be=-1/0,ye=0;ye<Se.length;ye++)for(var Ee=Se[ye],Ne=0;Ne<Ee.length;Ne++){var Ie=Ee[Ne];G=Math.min(G,Ie.x),K=Math.max(K,Ie.x),ce=Math.min(ce,Ie.y),be=Math.max(be,Ie.y)}return[G,ce,K,be]},Zn.prototype.toGeoJSON=tn.prototype.toGeoJSON;var Ti=t.e0,aa=jn;function Xn(Se){var G=new Ti;return function(K,ce){for(var be in K.layers)ce.writeMessage(3,Ma,K.layers[be])}(Se,G),G.finish()}function Ma(Se,G){var K;G.writeVarintField(15,Se.version||1),G.writeStringField(1,Se.name||""),G.writeVarintField(5,Se.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<Se.length;K++)ce.feature=Se.feature(K),G.writeMessage(2,zo,ce);var be=ce.keys;for(K=0;K<be.length;K++)G.writeStringField(3,be[K]);var ye=ce.values;for(K=0;K<ye.length;K++)G.writeMessage(4,ru,ye[K])}function zo(Se,G){var K=Se.feature;K.id!==void 0&&G.writeVarintField(1,K.id),G.writeMessage(2,ka,Se),G.writeVarintField(3,K.type),G.writeMessage(4,Cn,K)}function ka(Se,G){var K=Se.feature,ce=Se.keys,be=Se.values,ye=Se.keycache,Ee=Se.valuecache;for(var Ne in K.properties){var Ie=K.properties[Ne],je=ye[Ne];if(Ie!==null){je===void 0&&(ce.push(Ne),ye[Ne]=je=ce.length-1),G.writeVarint(je);var ft=typeof Ie;ft!=="string"&&ft!=="boolean"&&ft!=="number"&&(Ie=JSON.stringify(Ie));var lt=ft+":"+Ie,Rt=Ee[lt];Rt===void 0&&(be.push(Ie),Ee[lt]=Rt=be.length-1),G.writeVarint(Rt)}}}function Gt(Se,G){return(G<<3)+(7&Se)}function ec(Se){return Se<<1^Se>>31}function Cn(Se,G){for(var K=Se.loadGeometry(),ce=Se.type,be=0,ye=0,Ee=K.length,Ne=0;Ne<Ee;Ne++){var Ie=K[Ne],je=1;ce===1&&(je=Ie.length),G.writeVarint(Gt(1,je));for(var ft=ce===3?Ie.length-1:Ie.length,lt=0;lt<ft;lt++){lt===1&&ce!==1&&G.writeVarint(Gt(2,ft-1));var Rt=Ie[lt].x-be,$t=Ie[lt].y-ye;G.writeVarint(ec(Rt)),G.writeVarint(ec($t)),be+=Rt,ye+=$t}ce===3&&G.writeVarint(Gt(7,1))}}function ru(Se,G){var K=typeof Se;K==="string"?G.writeStringField(1,Se):K==="boolean"?G.writeBooleanField(7,Se):K==="number"&&(Se%1!=0?G.writeDoubleField(3,Se):Se<0?G.writeSVarintField(6,Se):G.writeVarintField(5,Se))}wi.exports=Xn,wi.exports.fromVectorTileJs=Xn,wi.exports.fromGeojsonVt=function(Se,G){G=G||{};var K={};for(var ce in Se)K[ce]=new aa(Se[ce].features,G),K[ce].name=ce,K[ce].version=G.version,K[ce].extent=G.extent;return Xn({layers:K})},wi.exports.GeoJSONWrapper=aa;var ou=t.e1(wi.exports);let au={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},Pd=Math.fround||(tc=new Float32Array(1),Se=>(tc[0]=+Se,tc[0]));var tc;let sa=3,la=5,Od=6;class Qt{constructor(G){this.options=Object.assign(Object.create(au),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){let{log:K,minZoom:ce,maxZoom:be}=this.options;K&&console.time("total time");let ye=`prepare ${G.length} points`;K&&console.time(ye),this.points=G;let Ee=[];for(let Ie=0;Ie<G.length;Ie++){let je=G[Ie];if(!je.geometry)continue;let[ft,lt]=je.geometry.coordinates,Rt=Pd(go(ft)),$t=Pd(al(lt));Ee.push(Rt,$t,1/0,Ie,-1,1),this.options.reduce&&Ee.push(0)}let Ne=this.trees[be+1]=this._createTree(Ee);K&&console.timeEnd(ye);for(let Ie=be;Ie>=ce;Ie--){let je=+Date.now();Ne=this.trees[Ie]=this._createTree(this._cluster(Ne,Ie)),K&&console.log("z%d: %d clusters in %dms",Ie,Ne.numItems,+Date.now()-je)}return K&&console.timeEnd("total time"),this}getClusters(G,K){let ce=((G[0]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,G[1])),ye=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ee=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ce=-180,ye=180;else if(ce>ye){let lt=this.getClusters([ce,be,180,Ee],K),Rt=this.getClusters([-180,be,ye,Ee],K);return lt.concat(Rt)}let Ne=this.trees[this._limitZoom(K)],Ie=Ne.range(go(ce),al(Ee),go(ye),al(be)),je=Ne.data,ft=[];for(let lt of Ie){let Rt=this.stride*lt;ft.push(je[Rt+la]>1?Jt(je,Rt,this.clusterProps):this.points[je[Rt+sa]])}return ft}getChildren(G){let K=this._getOriginId(G),ce=this._getOriginZoom(G),be="No cluster with the specified id.",ye=this.trees[ce];if(!ye)throw new Error(be);let Ee=ye.data;if(K*this.stride>=Ee.length)throw new Error(be);let Ne=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Ie=ye.within(Ee[K*this.stride],Ee[K*this.stride+1],Ne),je=[];for(let ft of Ie){let lt=ft*this.stride;Ee[lt+4]===G&&je.push(Ee[lt+la]>1?Jt(Ee,lt,this.clusterProps):this.points[Ee[lt+sa]])}if(je.length===0)throw new Error(be);return je}getLeaves(G,K,ce){let be=[];return this._appendLeaves(be,G,K=K||10,ce=ce||0,0),be}getTile(G,K,ce){let be=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:Ee,radius:Ne}=this.options,Ie=Ne/Ee,je=(ce-Ie)/ye,ft=(ce+1+Ie)/ye,lt={features:[]};return this._addTileFeatures(be.range((K-Ie)/ye,je,(K+1+Ie)/ye,ft),be.data,K,ce,ye,lt),K===0&&this._addTileFeatures(be.range(1-Ie/ye,je,1,ft),be.data,ye,ce,ye,lt),K===ye-1&&this._addTileFeatures(be.range(0,je,Ie/ye,ft),be.data,-1,ce,ye,lt),lt.features.length?lt:null}getClusterExpansionZoom(G){let K=this._getOriginZoom(G)-1;for(;K<=this.options.maxZoom;){let ce=this.getChildren(G);if(K++,ce.length!==1)break;G=ce[0].properties.cluster_id}return K}_appendLeaves(G,K,ce,be,ye){let Ee=this.getChildren(K);for(let Ne of Ee){let Ie=Ne.properties;if(Ie&&Ie.cluster?ye+Ie.point_count<=be?ye+=Ie.point_count:ye=this._appendLeaves(G,Ie.cluster_id,ce,be,ye):ye<be?ye++:G.push(Ne),G.length===ce)break}return ye}_createTree(G){let K=new t.cK(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<G.length;ce+=this.stride)K.add(G[ce],G[ce+1]);return K.finish(),K.data=G,K}_addTileFeatures(G,K,ce,be,ye,Ee){for(let Ne of G){let Ie=Ne*this.stride,je=K[Ie+la]>1,ft,lt,Rt;if(je)ft=ic(K,Ie,this.clusterProps),lt=K[Ie],Rt=K[Ie+1];else{let yi=this.points[K[Ie+sa]];ft=yi.properties;let[ri,Ei]=yi.geometry.coordinates;lt=go(ri),Rt=al(Ei)}let $t={type:1,geometry:[[Math.round(this.options.extent*(lt*ye-ce)),Math.round(this.options.extent*(Rt*ye-be))]],tags:ft},pi;pi=je||this.options.generateId?K[Ie+sa]:this.points[K[Ie+sa]].id,pi!==void 0&&($t.id=pi),Ee.features.push($t)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,K){let{radius:ce,extent:be,reduce:ye,minPoints:Ee}=this.options,Ne=ce/(be*Math.pow(2,K)),Ie=G.data,je=[],ft=this.stride;for(let lt=0;lt<Ie.length;lt+=ft){if(Ie[lt+2]<=K)continue;Ie[lt+2]=K;let Rt=Ie[lt],$t=Ie[lt+1],pi=G.within(Ie[lt],Ie[lt+1],Ne),yi=Ie[lt+la],ri=yi;for(let Ei of pi){let At=Ei*ft;Ie[At+2]>K&&(ri+=Ie[At+la])}if(ri>yi&&ri>=Ee){let Ei,At=Rt*yi,Sn=$t*yi,Qi=-1,Oi=(lt/ft<<5)+(K+1)+this.points.length;for(let Qn of pi){let Mn=Qn*ft;if(Ie[Mn+2]<=K)continue;Ie[Mn+2]=K;let dr=Ie[Mn+la];At+=Ie[Mn]*dr,Sn+=Ie[Mn+1]*dr,Ie[Mn+4]=Oi,ye&&(Ei||(Ei=this._map(Ie,lt,!0),Qi=this.clusterProps.length,this.clusterProps.push(Ei)),ye(Ei,this._map(Ie,Mn)))}Ie[lt+4]=Oi,je.push(At/ri,Sn/ri,1/0,Oi,-1,ri),ye&&je.push(Qi)}else{for(let Ei=0;Ei<ft;Ei++)je.push(Ie[lt+Ei]);if(ri>1)for(let Ei of pi){let At=Ei*ft;if(!(Ie[At+2]<=K)){Ie[At+2]=K;for(let Sn=0;Sn<ft;Sn++)je.push(Ie[At+Sn])}}}}return je}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,K,ce){if(G[K+la]>1){let Ee=this.clusterProps[G[K+Od]];return ce?Object.assign({},Ee):Ee}let be=this.points[G[K+sa]].properties,ye=this.options.map(be);return ce&&ye===be?Object.assign({},ye):ye}}function Jt(Se,G,K){return{type:"Feature",id:Se[G+sa],properties:ic(Se,G,K),geometry:{type:"Point",coordinates:[(ce=Se[G],360*(ce-.5)),nc(Se[G+1])]}};var ce}function ic(Se,G,K){let ce=Se[G+la],be=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,ye=Se[G+Od],Ee=ye===-1?{}:Object.assign({},K[ye]);return Object.assign(Ee,{cluster:!0,cluster_id:Se[G+sa],point_count:ce,point_count_abbreviated:be})}function go(Se){return Se/360+.5}function al(Se){let G=Math.sin(Se*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function nc(Se){let G=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function rc(Se,G,K,ce){let be=ce,ye=G+(K-G>>1),Ee,Ne=K-G,Ie=Se[G],je=Se[G+1],ft=Se[K],lt=Se[K+1];for(let Rt=G+3;Rt<K;Rt+=3){let $t=Rd(Se[Rt],Se[Rt+1],Ie,je,ft,lt);if($t>be)Ee=Rt,be=$t;else if($t===be){let pi=Math.abs(Rt-ye);pi<Ne&&(Ee=Rt,Ne=pi)}}be>ce&&(Ee-G>3&&rc(Se,G,Ee,ce),Se[Ee+2]=be,K-Ee>3&&rc(Se,Ee,K,ce))}function Rd(Se,G,K,ce,be,ye){let Ee=be-K,Ne=ye-ce;if(Ee!==0||Ne!==0){let Ie=((Se-K)*Ee+(G-ce)*Ne)/(Ee*Ee+Ne*Ne);Ie>1?(K=be,ce=ye):Ie>0&&(K+=Ee*Ie,ce+=Ne*Ie)}return Ee=Se-K,Ne=G-ce,Ee*Ee+Ne*Ne}function Is(Se,G,K,ce){let be={id:Se??null,type:G,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")sl(be,K);else if(G==="Polygon")sl(be,K[0]);else if(G==="MultiLineString")for(let ye of K)sl(be,ye);else if(G==="MultiPolygon")for(let ye of K)sl(be,ye[0]);return be}function sl(Se,G){for(let K=0;K<G.length;K+=3)Se.minX=Math.min(Se.minX,G[K]),Se.minY=Math.min(Se.minY,G[K+1]),Se.maxX=Math.max(Se.maxX,G[K]),Se.maxY=Math.max(Se.maxY,G[K+1])}function oc(Se,G,K,ce){if(!G.geometry)return;let be=G.geometry.coordinates;if(be&&be.length===0)return;let ye=G.geometry.type,Ee=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Ne=[],Ie=G.id;if(K.promoteId?Ie=G.properties[K.promoteId]:K.generateId&&(Ie=ce||0),ye==="Point")Ld(be,Ne);else if(ye==="MultiPoint")for(let je of be)Ld(je,Ne);else if(ye==="LineString")ac(be,Ne,Ee,!1);else if(ye==="MultiLineString"){if(K.lineMetrics){for(let je of be)Ne=[],ac(je,Ne,Ee,!1),Se.push(Is(Ie,"LineString",Ne,G.properties));return}sc(be,Ne,Ee,!1)}else if(ye==="Polygon")sc(be,Ne,Ee,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(let je of G.geometry.geometries)oc(Se,{id:Ie,geometry:je,properties:G.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let je of be){let ft=[];sc(je,ft,Ee,!0),Ne.push(ft)}}Se.push(Is(Ie,ye,Ne,G.properties))}function Ld(Se,G){G.push(Bo(Se[0]),su(Se[1]),0)}function ac(Se,G,K,ce){let be,ye,Ee=0;for(let Ie=0;Ie<Se.length;Ie++){let je=Bo(Se[Ie][0]),ft=su(Se[Ie][1]);G.push(je,ft,0),Ie>0&&(Ee+=ce?(be*ft-je*ye)/2:Math.sqrt(Math.pow(je-be,2)+Math.pow(ft-ye,2))),be=je,ye=ft}let Ne=G.length-3;G[2]=1,rc(G,0,Ne,K),G[Ne+2]=1,G.size=Math.abs(Ee),G.start=0,G.end=G.size}function sc(Se,G,K,ce){for(let be=0;be<Se.length;be++){let ye=[];ac(Se[be],ye,K,ce),G.push(ye)}}function Bo(Se){return Se/360+.5}function su(Se){let G=Math.sin(Se*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function ei(Se,G,K,ce,be,ye,Ee,Ne){if(ce/=G,ye>=(K/=G)&&Ee<ce)return Se;if(Ee<K||ye>=ce)return null;let Ie=[];for(let je of Se){let ft=je.geometry,lt=je.type,Rt=be===0?je.minX:je.minY,$t=be===0?je.maxX:je.maxY;if(Rt>=K&&$t<ce){Ie.push(je);continue}if($t<K||Rt>=ce)continue;let pi=[];if(lt==="Point"||lt==="MultiPoint")Fd(ft,pi,K,ce,be);else if(lt==="LineString")Un(ft,pi,K,ce,be,!1,Ne.lineMetrics);else if(lt==="MultiLineString")ll(ft,pi,K,ce,be,!1);else if(lt==="Polygon")ll(ft,pi,K,ce,be,!0);else if(lt==="MultiPolygon")for(let yi of ft){let ri=[];ll(yi,ri,K,ce,be,!0),ri.length&&pi.push(ri)}if(pi.length){if(Ne.lineMetrics&&lt==="LineString"){for(let yi of pi)Ie.push(Is(je.id,lt,yi,je.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(pi.length===1?(lt="LineString",pi=pi[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=pi.length===3?"Point":"MultiPoint"),Ie.push(Is(je.id,lt,pi,je.tags))}}return Ie.length?Ie:null}function Fd(Se,G,K,ce,be){for(let ye=0;ye<Se.length;ye+=3){let Ee=Se[ye+be];Ee>=K&&Ee<=ce&&Ia(G,Se[ye],Se[ye+1],Se[ye+2])}}function Un(Se,G,K,ce,be,ye,Ee){let Ne=lc(Se),Ie=be===0?Ta:zd,je,ft,lt=Se.start;for(let ri=0;ri<Se.length-3;ri+=3){let Ei=Se[ri],At=Se[ri+1],Sn=Se[ri+2],Qi=Se[ri+3],Oi=Se[ri+4],Qn=be===0?Ei:At,Mn=be===0?Qi:Oi,dr=!1;Ee&&(je=Math.sqrt(Math.pow(Ei-Qi,2)+Math.pow(At-Oi,2))),Qn<K?Mn>K&&(ft=Ie(Ne,Ei,At,Qi,Oi,K),Ee&&(Ne.start=lt+je*ft)):Qn>ce?Mn<ce&&(ft=Ie(Ne,Ei,At,Qi,Oi,ce),Ee&&(Ne.start=lt+je*ft)):Ia(Ne,Ei,At,Sn),Mn<K&&Qn>=K&&(ft=Ie(Ne,Ei,At,Qi,Oi,K),dr=!0),Mn>ce&&Qn<=ce&&(ft=Ie(Ne,Ei,At,Qi,Oi,ce),dr=!0),!ye&&dr&&(Ee&&(Ne.end=lt+je*ft),G.push(Ne),Ne=lc(Se)),Ee&&(lt+=je)}let Rt=Se.length-3,$t=Se[Rt],pi=Se[Rt+1],yi=be===0?$t:pi;yi>=K&&yi<=ce&&Ia(Ne,$t,pi,Se[Rt+2]),Rt=Ne.length-3,ye&&Rt>=3&&(Ne[Rt]!==Ne[0]||Ne[Rt+1]!==Ne[1])&&Ia(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&G.push(Ne)}function lc(Se){let G=[];return G.size=Se.size,G.start=Se.start,G.end=Se.end,G}function ll(Se,G,K,ce,be,ye){for(let Ee of Se)Un(Ee,G,K,ce,be,ye,!1)}function Ia(Se,G,K,ce){Se.push(G,K,ce)}function Ta(Se,G,K,ce,be,ye){let Ee=(ye-G)/(ce-G);return Ia(Se,ye,K+(be-K)*Ee,1),Ee}function zd(Se,G,K,ce,be,ye){let Ee=(ye-K)/(be-K);return Ia(Se,G+(ce-G)*Ee,ye,1),Ee}function Ts(Se,G){let K=[];for(let ce=0;ce<Se.length;ce++){let be=Se[ce],ye=be.type,Ee;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ee=Es(be.geometry,G);else if(ye==="MultiLineString"||ye==="Polygon"){Ee=[];for(let Ne of be.geometry)Ee.push(Es(Ne,G))}else if(ye==="MultiPolygon"){Ee=[];for(let Ne of be.geometry){let Ie=[];for(let je of Ne)Ie.push(Es(je,G));Ee.push(Ie)}}K.push(Is(be.id,ye,Ee,be.tags))}return K}function Es(Se,G){let K=[];K.size=Se.size,Se.start!==void 0&&(K.start=Se.start,K.end=Se.end);for(let ce=0;ce<Se.length;ce+=3)K.push(Se[ce]+G,Se[ce+1],Se[ce+2]);return K}function cc(Se,G){if(Se.transformed)return Se;let K=1<<Se.z,ce=Se.x,be=Se.y;for(let ye of Se.features){let Ee=ye.geometry,Ne=ye.type;if(ye.geometry=[],Ne===1)for(let Ie=0;Ie<Ee.length;Ie+=2)ye.geometry.push(dc(Ee[Ie],Ee[Ie+1],G,K,ce,be));else for(let Ie=0;Ie<Ee.length;Ie++){let je=[];for(let ft=0;ft<Ee[Ie].length;ft+=2)je.push(dc(Ee[Ie][ft],Ee[Ie][ft+1],G,K,ce,be));ye.geometry.push(je)}}return Se.transformed=!0,Se}function dc(Se,G,K,ce,be,ye){return[Math.round(K*(Se*ce-be)),Math.round(K*(G*ce-ye))]}function lu(Se,G,K,ce,be){let ye=G===be.maxZoom?0:be.tolerance/((1<<G)*be.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Se.length,source:null,x:K,y:ce,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ne of Se)hc(Ee,Ne,ye,be);return Ee}function hc(Se,G,K,ce){let be=G.geometry,ye=G.type,Ee=[];if(Se.minX=Math.min(Se.minX,G.minX),Se.minY=Math.min(Se.minY,G.minY),Se.maxX=Math.max(Se.maxX,G.maxX),Se.maxY=Math.max(Se.maxY,G.maxY),ye==="Point"||ye==="MultiPoint")for(let Ne=0;Ne<be.length;Ne+=3)Ee.push(be[Ne],be[Ne+1]),Se.numPoints++,Se.numSimplified++;else if(ye==="LineString")No(Ee,be,Se,K,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Ne=0;Ne<be.length;Ne++)No(Ee,be[Ne],Se,K,ye==="Polygon",Ne===0);else if(ye==="MultiPolygon")for(let Ne=0;Ne<be.length;Ne++){let Ie=be[Ne];for(let je=0;je<Ie.length;je++)No(Ee,Ie[je],Se,K,!0,je===0)}if(Ee.length){let Ne=G.tags||null;if(ye==="LineString"&&ce.lineMetrics){Ne={};for(let je in G.tags)Ne[je]=G.tags[je];Ne.mapbox_clip_start=be.start/be.size,Ne.mapbox_clip_end=be.end/be.size}let Ie={geometry:Ee,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Ne};G.id!==null&&(Ie.id=G.id),Se.features.push(Ie)}}function No(Se,G,K,ce,be,ye){let Ee=ce*ce;if(ce>0&&G.size<(be?Ee:ce))return void(K.numPoints+=G.length/3);let Ne=[];for(let Ie=0;Ie<G.length;Ie+=3)(ce===0||G[Ie+2]>Ee)&&(K.numSimplified++,Ne.push(G[Ie],G[Ie+1])),K.numPoints++;be&&function(Ie,je){let ft=0;for(let lt=0,Rt=Ie.length,$t=Rt-2;lt<Rt;$t=lt,lt+=2)ft+=(Ie[lt]-Ie[$t])*(Ie[lt+1]+Ie[$t+1]);if(ft>0===je)for(let lt=0,Rt=Ie.length;lt<Rt/2;lt+=2){let $t=Ie[lt],pi=Ie[lt+1];Ie[lt]=Ie[Rt-2-lt],Ie[lt+1]=Ie[Rt-1-lt],Ie[Rt-2-lt]=$t,Ie[Rt-1-lt]=pi}}(Ne,ye),Se.push(Ne)}let Ds={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Vo{constructor(G,K){let ce=(K=this.options=function(ye,Ee){for(let Ne in Ee)ye[Ne]=Ee[Ne];return ye}(Object.create(Ds),K)).debug;if(ce&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let be=function(ye,Ee){let Ne=[];if(ye.type==="FeatureCollection")for(let Ie=0;Ie<ye.features.length;Ie++)oc(Ne,ye.features[Ie],Ee,Ie);else oc(Ne,ye.type==="Feature"?ye:{geometry:ye},Ee);return Ne}(G,K);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),be=function(ye,Ee){let Ne=Ee.buffer/Ee.extent,Ie=ye,je=ei(ye,1,-1-Ne,Ne,0,-1,2,Ee),ft=ei(ye,1,1-Ne,2+Ne,0,-1,2,Ee);return(je||ft)&&(Ie=ei(ye,1,-Ne,1+Ne,0,-1,2,Ee)||[],je&&(Ie=Ts(je,1).concat(Ie)),ft&&(Ie=Ie.concat(Ts(ft,-1)))),Ie}(be,K),be.length&&this.splitTile(be,0,0,0),ce&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,K,ce,be,ye,Ee,Ne){let Ie=[G,K,ce,be],je=this.options,ft=je.debug;for(;Ie.length;){be=Ie.pop(),ce=Ie.pop(),K=Ie.pop(),G=Ie.pop();let lt=1<<K,Rt=Pr(K,ce,be),$t=this.tiles[Rt];if(!$t&&(ft>1&&console.time("creation"),$t=this.tiles[Rt]=lu(G,K,ce,be,je),this.tileCoords.push({z:K,x:ce,y:be}),ft)){ft>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ce,be,$t.numFeatures,$t.numPoints,$t.numSimplified),console.timeEnd("creation"));let dr=`z${K}`;this.stats[dr]=(this.stats[dr]||0)+1,this.total++}if($t.source=G,ye==null){if(K===je.indexMaxZoom||$t.numPoints<=je.indexMaxPoints)continue}else{if(K===je.maxZoom||K===ye)continue;if(ye!=null){let dr=ye-K;if(ce!==Ee>>dr||be!==Ne>>dr)continue}}if($t.source=null,G.length===0)continue;ft>1&&console.time("clipping");let pi=.5*je.buffer/je.extent,yi=.5-pi,ri=.5+pi,Ei=1+pi,At=null,Sn=null,Qi=null,Oi=null,Qn=ei(G,lt,ce-pi,ce+ri,0,$t.minX,$t.maxX,je),Mn=ei(G,lt,ce+yi,ce+Ei,0,$t.minX,$t.maxX,je);G=null,Qn&&(At=ei(Qn,lt,be-pi,be+ri,1,$t.minY,$t.maxY,je),Sn=ei(Qn,lt,be+yi,be+Ei,1,$t.minY,$t.maxY,je),Qn=null),Mn&&(Qi=ei(Mn,lt,be-pi,be+ri,1,$t.minY,$t.maxY,je),Oi=ei(Mn,lt,be+yi,be+Ei,1,$t.minY,$t.maxY,je),Mn=null),ft>1&&console.timeEnd("clipping"),Ie.push(At||[],K+1,2*ce,2*be),Ie.push(Sn||[],K+1,2*ce,2*be+1),Ie.push(Qi||[],K+1,2*ce+1,2*be),Ie.push(Oi||[],K+1,2*ce+1,2*be+1)}}getTile(G,K,ce){G=+G,K=+K,ce=+ce;let be=this.options,{extent:ye,debug:Ee}=be;if(G<0||G>24)return null;let Ne=1<<G,Ie=Pr(G,K=K+Ne&Ne-1,ce);if(this.tiles[Ie])return cc(this.tiles[Ie],ye);Ee>1&&console.log("drilling down to z%d-%d-%d",G,K,ce);let je,ft=G,lt=K,Rt=ce;for(;!je&&ft>0;)ft--,lt>>=1,Rt>>=1,je=this.tiles[Pr(ft,lt,Rt)];return je&&je.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",ft,lt,Rt),console.time("drilling down")),this.splitTile(je.source,ft,lt,Rt,G,K,ce),Ee>1&&console.timeEnd("drilling down"),this.tiles[Ie]?cc(this.tiles[Ie],ye):null):null}}function Pr(Se,G,K){return 32*((1<<Se)*K+G)+Se}function cu(Se,G){let K=Se.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);let ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return G(null,null);let be=new ut(ce.features),ye=ou(be);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),G(null,{vectorTile:be,rawData:ye.buffer})}class cl extends xe{constructor(G,K,ce,be,ye,Ee){super(G,K,ce,be,cu,Ee),ye&&(this.loadGeoJSON=ye),this._dynamicIndex=new wt}loadData(G,K){let ce=G&&G.request,be=ce&&ce.collectResourceTiming;this.loadGeoJSON(G,(ye,Ee)=>{if(ye||!Ee)return K(ye);if(typeof Ee!="object")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){let Ie=t.y(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(je=>`${je.key}: ${je.message}`).join(", "));Ee.features=Ee.features.filter(je=>Ie.value.evaluate({zoom:0},je))}G.dynamic?(Ee.type==="Feature"&&(Ee={type:"FeatureCollection",features:[Ee]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ee.features,this.loaded),G.cluster&&(Ee.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new Qt(function({superclusterOptions:Ie,clusterProperties:je}){if(!je||!Ie)return Ie;let ft={},lt={},Rt={accumulated:null,zoom:0},$t={properties:null},pi=Object.keys(je);for(let yi of pi){let[ri,Ei]=je[yi],At=t.y(Ei),Sn=t.y(typeof ri=="string"?[ri,["accumulated"],["get",yi]]:ri);ft[yi]=At.value,lt[yi]=Sn.value}return Ie.map=yi=>{$t.properties=yi;let ri={};for(let Ei of pi)ri[Ei]=ft[Ei].evaluate(Rt,$t);return ri},Ie.reduce=(yi,ri)=>{$t.properties=ri;for(let Ei of pi)Rt.accumulated=yi[Ei],yi[Ei]=lt[Ei].evaluate(Rt,$t)},Ie}(G)).load(Ee.features):G.dynamic?this._dynamicIndex:function(Ie,je){return new Vo(Ie,je)}(Ee,G.geojsonVtOptions)}catch(Ie){return K(Ie)}let Ne={};if(be){let Ie=_(ce);Ie&&(Ne.resourceTiming={},Ne.resourceTiming[G.source]=JSON.parse(JSON.stringify(Ie)))}K(null,Ne)}})}reloadTile(G,K){let ce=this.loaded;return ce&&ce[G.uid]?G.partial?K(null,void 0):super.reloadTile(G,K):this.loadTile(G,K)}loadGeoJSON(G,K){if(G.request)t.g(G.request,K);else{if(typeof G.data!="string")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(G.data))}catch{return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ce){K(ce)}}getClusterChildren(G,K){try{K(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ce){K(ce)}}getClusterLeaves(G,K){try{K(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ce){K(ce)}}}class uc{constructor(G,K){this.tileID=new t.aL(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=K}parse(G,K,ce,be){this.status="parsing";let ye=new t.aL(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Ee={},Ne=K.familiesBySource[ce.source],Ie=new t.dN(ye,ce.promoteId);return Ie.bucketLayerIDs=[],Ie.is3DTile=!0,t.e3(G).then(je=>{if(!je)return be(new Error("Could not parse tile"));let ft=t.e4(je,1/t.b5(ce.tileID.canonical)),lt=je.json.extensionsUsed&&je.json.extensionsUsed.includes("MAPBOX_mesh_features")||je.json.asset.extras&&je.json.asset.extras.MAPBOX_mesh_features,Rt=je.json.extensionsUsed&&je.json.extensionsUsed.includes("EXT_meshopt_compression"),$t=new t.X(this.zoom,{brightness:this.brightness});for(let pi in Ne)for(let yi of Ne[pi]){let ri=yi[0];Ie.bucketLayerIDs.push(yi.map(At=>At.id)),ri.recalculate($t,[]);let Ei=new t.e5(ft,ye,lt,Rt,this.brightness,Ie);lt||(Ei.needsUpload=!0),Ee[ri.fqid]=Ei,Ei.evaluate(ri)}this.status="done",be(null,{buckets:Ee,featureIndex:Ie})}).catch(je=>be(new Error(je.message)))}}class Bd{constructor(G,K,ce,be,ye,Ee){this.actor=G,this.layerIndex=K,this.brightness=Ee,this.loading={},this.loaded={}}loadTile(G,K){let ce=G.uid,be=this.loading[ce]=new uc(G,this.brightness);t.e2(G.request,(ye,Ee)=>{let Ne=!this.loading[ce];return delete this.loading[ce],Ne||ye?(be.status="done",Ne||(this.loaded[ce]=be),K(ye)):Ee&&Ee.byteLength!==0?void be.parse(Ee,this.layerIndex,G,(Ie,je)=>{be.status="done",this.loaded=this.loaded||{},this.loaded[ce]=be,Ie||!je?K(Ie):K(null,je)}):(be.status="done",this.loaded[ce]=be,K())})}reloadTile(G,K){let ce=this.loaded,be=G.uid;if(ce&&ce[be]){let ye=ce[be];ye.projection=G.projection,ye.brightness=G.brightness;let Ee=(Ne,Ie)=>{ye.reloadCallback&&(delete ye.reloadCallback,this.loadTile(G,K)),K(Ne,Ie)};ye.status==="parsing"?ye.reloadCallback=Ee:ye.status==="done"&&this.loadTile(G,K)}}abortTile(G,K){let ce=G.uid;this.loading[ce]&&delete this.loading[ce],K()}removeTile(G,K){let ce=this.loaded,be=G.uid;ce&&ce[be]&&delete ce[be],K()}}class mc{constructor(G){this.self=G,this.actor=new t.e6(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.aJ({name:"mercator"}),this.workerSourceTypes={vector:xe,geojson:cl,"batched-model":Bd},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(t.e7.isParsed())throw new Error("RTL text plugin already registered.");t.e7.applyArabicShaping=K.applyArabicShaping,t.e7.processBidirectionalText=K.processBidirectionalText,t.e7.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(G,K,ce){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],delete this.rasterArrayWorkerSource,ce()}checkIfReady(G,K,ce){ce()}setReferrer(G,K){this.referrer=K}spriteLoaded(G,{scope:K,isLoaded:ce}){if(this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),this.isSpriteLoaded[G][K]=ce,this.workerSources[G]&&this.workerSources[G][K])for(let be in this.workerSources[G][K]){let ye=this.workerSources[G][K][be];for(let Ee in ye){let Ne=ye[Ee];Ne instanceof xe&&(Ne.isSpriteLoaded=ce,Ne.fire(new t.f("isSpriteLoaded")))}}}setImages(G,{scope:K,images:ce},be){if(this.availableImages[G]||(this.availableImages[G]={}),this.availableImages[G][K]=ce,this.workerSources[G]&&this.workerSources[G][K]){for(let ye in this.workerSources[G][K]){let Ee=this.workerSources[G][K][ye];for(let Ne in Ee)Ee[Ne].availableImages=ce}be()}else be()}setProjection(G,K){this.projections[G]=t.aJ(K)}setBrightness(G,K,ce){this.brightness=K,ce()}setLayers(G,K,ce){this.getLayerIndex(G,K.scope).replace(K.layers,K.options),ce()}updateLayers(G,K,ce){this.getLayerIndex(G,K.scope).update(K.layers,K.removedIds,K.options),ce()}loadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).loadTile(K,ce)}loadDEMTile(G,K,ce){this.getDEMWorkerSource(G,K.source,K.scope).loadTile(K,ce)}decodeRasterArray(G,K,ce){this.getRasterArrayWorkerSource().decodeRasterArray(K,ce)}reloadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).reloadTile(K,ce)}abortTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).abortTile(K,ce)}removeTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).removeTile(K,ce)}removeSource(G,K,ce){if(!(this.workerSources[G]&&this.workerSources[G][K.scope]&&this.workerSources[G][K.scope][K.type]&&this.workerSources[G][K.scope][K.type][K.source]))return;let be=this.workerSources[G][K.scope][K.type][K.source];delete this.workerSources[G][K.scope][K.type][K.source],be.removeSource!==void 0?be.removeSource(K,ce):ce()}loadWorkerSource(G,K,ce){try{this.self.importScripts(K.url),ce()}catch(be){ce(be.toString())}}syncRTLPluginState(G,K,ce){try{t.e7.setState(K);let be=t.e7.getPluginURL();if(t.e7.isLoaded()&&!t.e7.isParsed()&&be!=null){this.self.importScripts(be);let ye=t.e7.isParsed();ce(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${be}`),ye)}}catch(be){ce(be.toString())}}setDracoUrl(G,K){this.dracoUrl=K}getAvailableImages(G,K){this.availableImages[G]||(this.availableImages[G]={});let ce=this.availableImages[G][K];return ce||(ce=[]),ce}getLayerIndex(G,K){this.layerIndexes[G]||(this.layerIndexes[G]={});let ce=this.layerIndexes[G][K];return ce||(ce=this.layerIndexes[G][K]=new O,ce.scope=K),ce}getWorkerSource(G,K,ce,be){return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][be]||(this.workerSources[G][be]={}),this.workerSources[G][be][K]||(this.workerSources[G][be][K]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),this.workerSources[G][be][K][ce]||(this.workerSources[G][be][K][ce]=new this.workerSourceTypes[K]({send:(ye,Ee,Ne,Ie,je,ft)=>{this.actor.send(ye,Ee,Ne,G,je,ft)},scheduler:this.actor.scheduler},this.getLayerIndex(G,be),this.getAvailableImages(G,be),this.isSpriteLoaded[G][be],void 0,this.brightness)),this.workerSources[G][be][K][ce]}getDEMWorkerSource(G,K,ce){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][ce]||(this.demWorkerSources[G][ce]={}),this.demWorkerSources[G][ce][K]||(this.demWorkerSources[G][ce][K]=new ke),this.demWorkerSources[G][ce][K]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ae),this.rasterArrayWorkerSource}enforceCacheSizeLimit(G,K){t.e8(K)}getWorkerPerformanceMetrics(G,K,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new mc(self)),mc}),r(["./shared"],function(t){function _(f,o){if(Array.isArray(f)){if(!Array.isArray(o)||f.length!==o.length)return!1;for(let h=0;h<f.length;h++)if(!_(f[h],o[h]))return!1;return!0}if(typeof f=="object"&&f!==null&&o!==null){if(typeof o!="object"||Object.keys(f).length!==Object.keys(o).length)return!1;for(let h in f)if(!_(f[h],o[h]))return!1;return!0}return f===o}var C=I;function I(f){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,x=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(x);try{v=new Worker(S),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(S),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===g.width}()?(O[h=o&&o.failIfMajorPerformanceCaveat]===void 0&&(O[h]=function(g){var v,x=function(S){var k=document.createElement("canvas"),D=Object.create(I.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=S,k.getContext("webgl2",D)}(g);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(h)),O[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(f)}var O={};function N(f,o,h){let g=document.createElement(f);return o!=null&&(g.className=o),h&&h.appendChild(g),g}function q(f,o,h){let g=document.createElementNS("http://www.w3.org/2000/svg",f);for(let v of Object.keys(o))g.setAttributeNS(null,v,String(o[v]));return h&&h.appendChild(g),g}I.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ie=typeof document<"u"?document.documentElement&&document.documentElement.style:null,de=ie&&ie.userSelect!==void 0?"userSelect":"WebkitUserSelect",xe;function ke(){ie&&de&&(xe=ie[de],ie[de]="none")}function Ae(){ie&&de&&(ie[de]=xe)}function Xe(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Xe,!0)}function qe(){window.addEventListener("click",Xe,!0),window.setTimeout(()=>{window.removeEventListener("click",Xe,!0)},0)}function ut(f,o){let h=f.getBoundingClientRect();return Et(f,h,o)}function It(f,o){let h=f.getBoundingClientRect(),g=[];for(let v=0;v<o.length;v++)g.push(Et(f,h,o[v]));return g}function wt(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Et(f,o,h){let g=f.offsetWidth===o.width?1:f.offsetWidth/o.width;return new t.P((h.clientX-o.left)*g,(h.clientY-o.top)*g)}class Ht{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,h){this._updatedSourceCaches[o]=h,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){let h=o.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(o.id),this.setDirty()}removeLayer(o){let h=o.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][o.id]=o,this._updatedLayers[h].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){let o={};for(let h in this._updatedLayers)o[h]=o[h]||{},o[h].updatedIds=Array.from(this._updatedLayers[h].values());for(let h in this._removedLayers)o[h]=o[h]||{},o[h].removedIds=Object.keys(this._removedLayers[h]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(o){this._updatedImages.add(o),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let Ct={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yt{constructor(o,h,g,v,x,S){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.instanceCount=S,this.context=o;let k=o.gl;this.buffer=k.createBuffer(),o.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||x||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let g=0;g<this.attributes.length;g++){let v=h.attributes[this.attributes[g].name];v!==void 0&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,h,g){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],S=h.attributes[x.name];S!==void 0&&o.vertexAttribPointer(S,x.components,o[Ct[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(o,h,g){for(let v=0;v<this.attributes.length;v++){let x=h.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(x,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ii extends zt{getDefault(){return t.C.transparent}set(o){let h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Hi extends zt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class cr extends zt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class wi extends zt{getDefault(){return[!0,!0,!0,!0]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class dn extends zt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class tn extends zt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class jn extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Ur extends zt{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Zn extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ti extends zt{getDefault(){return[0,1]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class aa extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Xn extends zt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Ma extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class zo extends zt{getDefault(){let o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ka extends zt{getDefault(){return t.C.transparent}set(o){let h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Gt extends zt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class ec extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class Cn extends zt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class ru extends zt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let ou=class extends zt{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class au extends zt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Pd extends zt{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class tc extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class sa extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class la extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Od extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Qt extends zt{getDefault(){return null}set(o){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Jt extends zt{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class ic extends zt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class go extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class al extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class nc extends zt{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class rc extends nc{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Rd extends nc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Is extends nc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class sl extends Rd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class oc{constructor(o,h,g,v,x){this.context=o,this.width=h,this.height=g;let S=this.framebuffer=o.gl.createFramebuffer();v&&(this.colorAttachment=new rc(o,S)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Rd(o,S):new Is(o,S))}destroy(){let o=this.context.gl;if(this.colorAttachment){let h=this.colorAttachment.get();h&&o.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let h=this.depthAttachment.get();h&&o.deleteRenderbuffer(h)}else{let h=this.depthAttachment.get();h&&o.deleteTexture(h)}o.deleteFramebuffer(this.framebuffer)}}class Ld{constructor(o,h){this.gl=o,this.clearColor=new Ii(this),this.clearDepth=new Hi(this),this.clearStencil=new cr(this),this.colorMask=new wi(this),this.depthMask=new dn(this),this.stencilMask=new tn(this),this.stencilFunc=new jn(this),this.stencilOp=new Ur(this),this.stencilTest=new Zn(this),this.depthRange=new Ti(this),this.depthTest=new aa(this),this.depthFunc=new Xn(this),this.blend=new Ma(this),this.blendFunc=new zo(this),this.blendColor=new ka(this),this.blendEquation=new Gt(this),this.cullFace=new ec(this),this.cullFaceSide=new Cn(this),this.frontFace=new ru(this),this.program=new ou(this),this.activeTexture=new au(this),this.viewport=new Pd(this),this.bindFramebuffer=new tc(this),this.bindRenderbuffer=new sa(this),this.bindTexture=new la(this),this.bindVertexBuffer=new Od(this),this.bindElementBuffer=new Qt(this),this.bindVertexArrayOES=new Jt(this),this.pixelStoreUnpack=new ic(this),this.pixelStoreUnpackPremultiplyAlpha=new go(this),this.pixelStoreUnpackFlipY=new al(this),this.options=h?Ji({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h,g){return new t.I(this,o,h,g)}createVertexBuffer(o,h,g,v,x){return new Yt(this,o,h,g,v,x)}createRenderbuffer(o,h,g){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,o,h,g),this.bindRenderbuffer.set(null),x}createFramebuffer(o,h,g,v){return new oc(this,o,h,g,v)}clear({color:o,depth:h,stencil:g,colorMask:v}){let x=this.gl,S=0;o&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set(v||[!0,!0,!0,!0])),h!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(S)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){_(o.blendFunction,t.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ac{constructor(o){this._gl=o.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let o=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,o}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class sc{constructor(o){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,o.registerParameter(this,["Symbols"],"useOcclusionQueries"),o.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),o.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),o.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),o.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class Bo{constructor(o,h,g,v){let x={width:g[0],height:g[1],data:null},S=o.gl;this.targetColorTexture=new t.T(o,x,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new t.T(o,x,S.RGBA,{useMipmap:!1}),this.context=o,this.updateParticleTexture(h,v),this.lastInvalidatedAt=0}updateParticleTexture(o,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let g=this.context.gl,v=h.width*h.height;this.particleTexture0=new t.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1});let x=new t.S;x.reserve(v);for(let S=0;S<v;S++)x.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(x,t.p.members,!0),this.particleSegment=t.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=t.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class su extends t.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.numModelsLoading={}}loadModel(o,h){return t.l(this.requestManager.transformRequest(h,t.R.Model).url).then(g=>{if(!g)return;let v=t.c(g),x=new t.M(o,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(g=>{if(g&&g.status===404)return null;this.fire(new t.d(new Error(`Could not load model ${o} from ${h}: ${g.message}`)))})}load(o,h){this.models[h]||(this.models[h]={});let g=Object.keys(o);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+g.length;let v=[];for(let x of g)v.push(this.loadModel(x,o[x]));Promise.allSettled(v).then(x=>{for(let S=0;S<x.length;S++){let{status:k,value:D}=x[S];k==="fulfilled"&&D&&(this.models[h][g[S]]={model:D,numReferences:1})}this.numModelsLoading[h]-=g.length,this.fire(new t.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new t.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,h){return!!this.getModel(o,h)}getModel(o,h){return this.models[h]||(this.models[h]={}),this.models[h][o]?this.models[h][o].model:void 0}addModel(o,h,g){this.models[g]||(this.models[g]={}),this.hasModel(o,g)&&this.models[g][o].numReferences++,this.load({[o]:this.requestManager.normalizeModelURL(h)},g)}addModels(o,h){this.models[h]||(this.models[h]={});let g={};for(let v in o)this.models[h][v]={},g[v]=this.requestManager.normalizeModelURL(o[v]);this.load(g,h)}addModelsFromBucket(o,h){this.models[h]||(this.models[h]={});let g={};for(let v of o)this.hasModel(v,h)?this.models[h][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,h)}removeModel(o,h){if(this.models[h]&&this.models[h][o]&&(this.models[h][o].numReferences--,this.models[h][o].numReferences===0)){let g=this.models[h][o].model;delete this.models[h][o],g.destroy()}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,h){this.models[h]||(this.models[h]={});for(let g in this.models[h])this.models[h][g].model&&this.models[h][g].model.upload(o.context)}}function ei(f){let{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}class Fd extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(o){this.images[o]={},this.loaded[o]=!1,this.updatedImages[o]={},this.patterns[o]={},this.callbackDispatchedThisFrame[o]={},this.atlasImage[o]=new t.i({width:1,height:1})}isLoaded(){for(let o in this.loaded)if(!this.loaded[o])return!1;return!0}setLoaded(o,h){if(this.loaded[h]!==o&&(this.loaded[h]=o,o)){for(let{ids:g,callback:v}of this.requestors)this._notify(g,h,v);this.requestors=[]}}hasImage(o,h){return!!this.getImage(o,h)}getImage(o,h){return this.images[h][o]}addImage(o,h,g){this._validate(o,g)&&(this.images[h][o]=g)}_validate(o,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new t.d(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new t.d(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new t.d(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,h){if(!o)return!0;let g=0;for(let v of o){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h,g){g.version=this.images[h][o].version+1,this.images[h][o]=g,this.updatedImages[h][o]=!0}removeImage(o,h){let g=this.images[h][o];delete this.images[h][o],delete this.patterns[h][o],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(o){return Object.keys(this.images[o])}getImages(o,h,g){let v=!0,x=!!this.loaded[h];if(!x)for(let S of o)this.images[h][S]||(v=!1);x||v?this._notify(o,h,g):this.requestors.push({ids:o,scope:h,callback:g})}getUpdatedImages(o){return this.updatedImages[o]}_notify(o,h,g){let v={};for(let x of o){this.images[h][x]||this.fire(new t.f("styleimagemissing",{id:x}));let S=this.images[h][x];S?v[x]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:t.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(o){let{width:h,height:g}=this.atlasImage[o];return{width:h,height:g}}getPattern(o,h,g){let v=this.patterns[h][o],x=this.getImage(o,h);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},k=new t.k(S,x);this.patterns[h][o]={bin:S,position:k}}return this._updatePatternAtlas(h,g),this.patterns[h][o].position}bind(o,h){let g=o.gl,v=this.atlasTexture[h];v?this.dirty&&(v.update(this.atlasImage[h]),this.dirty=!1):(v=new t.T(o,this.atlasImage[h],g.RGBA),this.atlasTexture[h]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(o,h){let g=[];for(let k in this.patterns[o])g.push(this.patterns[o][k].bin);let{w:v,h:x}=t.j(g),S=this.atlasImage[o];S.resize({width:v||1,height:x||1});for(let k in this.patterns[o]){let{bin:D}=this.patterns[o][k],A=D.x+1,L=D.y+1,z=this.images[o][k].data,U=z.width,H=z.height;t.i.copy(z,S,{x:0,y:0},{x:A,y:L},{width:U,height:H},h),t.i.copy(z,S,{x:0,y:H-1},{x:A,y:L-1},{width:U,height:1},h),t.i.copy(z,S,{x:0,y:0},{x:A,y:L+H},{width:U,height:1},h),t.i.copy(z,S,{x:U-1,y:0},{x:A-1,y:L},{width:1,height:H},h),t.i.copy(z,S,{x:0,y:0},{x:A+U,y:L},{width:1,height:H},h)}this.dirty=!0}beginFrame(){for(let o in this.images)this.callbackDispatchedThisFrame[o]={}}dispatchRenderCallbacks(o,h){for(let g of o){if(this.callbackDispatchedThisFrame[h][g])continue;this.callbackDispatchedThisFrame[h][g]=!0;let v=this.images[h][g];ei(v)&&this.updateImage(g,h,v)}}}function Un(f){let o=f.key,h=f.value,g=f.valueSpec||{},v=f.objectElementValidators||{},x=f.style,S=f.styleSpec,k=[],D=t.n(h);if(D!=="object")return[new t.V(o,h,`object expected, ${D} found`)];for(let A in h){let L=A.split(".")[0],z;v[L]?z=v[L]:g[L]?z=G:v["*"]?z=v["*"]:g["*"]&&(z=G),z?k=k.concat(z({key:(o&&`${o}.`)+A,value:h[A],valueSpec:g[L]||g["*"],style:x,styleSpec:S,object:h,objectKey:A},h)):k.push(new t.m(o,h[A],`unknown property "${A}"`))}for(let A in g)v[A]||g[A].required&&g[A].default===void 0&&h[A]===void 0&&k.push(new t.V(o,h,`missing required property "${A}"`));return k}function lc(f){let o=f.value,h=f.valueSpec,g=f.style,v=f.styleSpec,x=f.key,S=f.arrayElementValidator||G;if(t.n(o)!=="array")return[new t.V(x,o,`array expected, ${t.n(o)} found`)];if(h.length&&o.length!==h.length)return[new t.V(x,o,`array length ${h.length} expected, length ${o.length} found`)];if(h["min-length"]&&o.length<h["min-length"])return[new t.V(x,o,`array length at least ${h["min-length"]} expected, length ${o.length} found`)];let k={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};v.$version<7&&(k.function=h.function),t.n(h.value)==="object"&&(k=h.value);let D=[];for(let A=0;A<o.length;A++)D=D.concat(S({array:o,arrayIndex:A,value:o[A],valueSpec:k,style:g,styleSpec:v,key:`${x}[${A}]`},!0));return D}function ll(f){let o=f.key,h=f.value,g=f.valueSpec,v=t.n(h);if(v==="number"&&h!=h&&(v="NaN"),v!=="number")return[new t.V(o,h,`number expected, ${v} found`)];if("minimum"in g){let x=g.minimum;if(t.n(g.minimum)==="array"&&(x=g.minimum[f.arrayIndex]),h<x)return[new t.V(o,h,`${h} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(t.n(g.maximum)==="array"&&(x=g.maximum[f.arrayIndex]),h>x)return[new t.V(o,h,`${h} is greater than the maximum value ${x}`)]}return[]}function Ia(f){let o=f.valueSpec,h=t.u(f.value.type),g,v,x,S={},k=h!=="categorical"&&f.value.property===void 0,D=!k,A=t.n(f.value.stops)==="array"&&t.n(f.value.stops[0])==="array"&&t.n(f.value.stops[0][0])==="object",L=Un({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(H){if(h==="identity")return[new t.V(H.key,H.value,'identity function may not have a "stops" property')];let Y=[],Z=H.value;return Y=Y.concat(lc({key:H.key,value:Z,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:z})),t.n(Z)==="array"&&Z.length===0&&Y.push(new t.V(H.key,Z,"array must have at least one stop")),Y},default:function(H){return G({key:H.key,value:H.value,valueSpec:o,style:H.style,styleSpec:H.styleSpec})}}});return h==="identity"&&k&&L.push(new t.V(f.key,f.value,'missing required property "property"')),h==="identity"||f.value.stops||L.push(new t.V(f.key,f.value,'missing required property "stops"')),h==="exponential"&&f.valueSpec.expression&&!t.s(f.valueSpec)&&L.push(new t.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(D&&!t.q(f.valueSpec)?L.push(new t.V(f.key,f.value,"property functions not supported")):k&&!t.r(f.valueSpec)&&L.push(new t.V(f.key,f.value,"zoom functions not supported"))),h!=="categorical"&&!A||f.value.property!==void 0||L.push(new t.V(f.key,f.value,'"property" property is required')),L;function z(H){let Y=[],Z=H.value,X=H.key;if(t.n(Z)!=="array")return[new t.V(X,Z,`array expected, ${t.n(Z)} found`)];if(Z.length!==2)return[new t.V(X,Z,`array length 2 expected, length ${Z.length} found`)];if(A){if(t.n(Z[0])!=="object")return[new t.V(X,Z,`object expected, ${t.n(Z[0])} found`)];if(Z[0].zoom===void 0)return[new t.V(X,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new t.V(X,Z,"object stop key must have value")];let Q=t.u(Z[0].zoom);if(typeof Q!="number")return[new t.V(X,Z[0].zoom,"stop zoom values must be numbers")];if(x&&x>Q)return[new t.V(X,Z[0].zoom,"stop zoom values must appear in ascending order")];Q!==x&&(x=Q,v=void 0,S={}),Y=Y.concat(Un({key:`${X}[0]`,value:Z[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:ll,value:U}}))}else Y=Y.concat(U({key:`${X}[0]`,value:Z[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},Z));return t.t(t.v(Z[1]))?Y.concat([new t.V(`${X}[1]`,Z[1],"expressions are not allowed in function stops.")]):Y.concat(G({key:`${X}[1]`,value:Z[1],valueSpec:o,style:H.style,styleSpec:H.styleSpec}))}function U(H,Y){let Z=t.n(H.value),X=t.u(H.value),Q=H.value!==null?H.value:Y;if(g){if(Z!==g)return[new t.V(H.key,Q,`${Z} stop domain type must match previous stop domain type ${g}`)]}else g=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new t.V(H.key,Q,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&h!=="categorical"){let re=`number expected, ${Z} found`;return t.q(o)&&h===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(H.key,Q,re)]}return h!=="categorical"||Z!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?h!=="categorical"&&Z==="number"&&typeof X=="number"&&typeof v=="number"&&v!==void 0&&X<v?[new t.V(H.key,Q,"stop domain values must appear in ascending order")]:(v=X,h==="categorical"&&X in S?[new t.V(H.key,Q,"stop domain values must be unique")]:(S[X]=!0,[])):[new t.V(H.key,Q,`integer expected, found ${String(X)}`)]}}function Ta(f){let o=(f.expressionContext==="property"?t.x:t.y)(t.v(f.value),f.valueSpec);if(o.result==="error")return o.value.map(g=>new t.V(`${f.key}${g.key}`,f.value,g.message));let h=o.value.expression||o.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!h.outputDefined())return[new t.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!t.z(h))return[new t.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return zd(h,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!t.A(h,["zoom","feature-state"]))return[new t.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!t.B(h))return[new t.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zd(f,o){let h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(let v of o.valueSpec.expression.parameters)h.delete(v);if(h.size===0)return[];let g=[];return f instanceof t.D&&h.has(f.name)?[new t.V(o.key,o.value,`["${f.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(f.eachChild(v=>{g.push(...zd(v,o))}),g)}function Ts(f){let o=f.key,h=f.value,g=f.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(t.u(h))===-1&&v.push(new t.V(o,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(t.u(h))===-1&&v.push(new t.V(o,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function Es(f){return t.G(t.v(f.value))?Ta(t.o({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):cc(f)}function cc(f){let o=f.value,h=f.key;if(t.n(o)!=="array")return[new t.V(h,o,`array expected, ${t.n(o)} found`)];let g=f.styleSpec,v,x=[];if(o.length<1)return[new t.V(h,o,"filter array must have at least 1 element")];switch(x=x.concat(Ts({key:`${h}[0]`,value:o[0],valueSpec:g.filter_operator,style:f.style,styleSpec:f.styleSpec})),t.u(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&t.u(o[1])==="$type"&&x.push(new t.V(h,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&x.push(new t.V(h,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(v=t.n(o[1]),v!=="string"&&x.push(new t.V(`${h}[1]`,o[1],`string expected, ${v} found`)));for(let S=2;S<o.length;S++)v=t.n(o[S]),t.u(o[1])==="$type"?x=x.concat(Ts({key:`${h}[${S}]`,value:o[S],valueSpec:g.geometry_type,style:f.style,styleSpec:f.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new t.V(`${h}[${S}]`,o[S],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let S=1;S<o.length;S++)x=x.concat(cc({key:`${h}[${S}]`,value:o[S],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":v=t.n(o[1]),o.length!==2?x.push(new t.V(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new t.V(`${h}[1]`,o[1],`string expected, ${v} found`))}return x}function dc(f,o){let h=f.key,g=f.style,v=f.layer,x=f.styleSpec,S=f.value,k=f.objectKey,D=x[`${o}_${f.layerType}`];if(!D)return[];let A=k.match(/^(.*)-transition$/);if(o==="paint"&&A&&D[A[1]]&&D[A[1]].transition)return G({key:h,value:S,valueSpec:x.transition,style:g,styleSpec:x});let L=f.valueSpec||D[k];if(!L)return[new t.m(h,S,`unknown property "${k}"`)];let z;if(t.n(S)==="string"&&t.q(L)&&!L.tokens&&(z=/^{([^}]+)}$/.exec(S))){let H=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new t.V(h,S,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${H}.`)]}let U=[];if(f.layerType==="symbol")k!=="text-field"||!g||g.glyphs||g.imports||U.push(new t.V(h,S,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&t.H(t.v(S))&&t.u(S.type)==="identity"&&U.push(new t.V(h,S,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&o==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&t.q(L)&&(t.J(L)||t.r(L))){let H=t.x(t.v(S),L),Y=H.value.expression||H.value._styleExpression.expression;Y&&!t.A(Y,["measure-light"])&&(k==="model-emissive-strength"&&t.B(Y)&&t.z(Y)||U.push(new t.V(h,S,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(G({key:f.key,value:S,valueSpec:L,style:g,styleSpec:x,expressionContext:"property",propertyType:o,propertyKey:k}))}function lu(f){return dc(f,"paint")}function hc(f){return dc(f,"layout")}function No(f){let o=[],h=f.value,g=f.key,v=f.style,x=f.styleSpec;h.type||h.ref||o.push(new t.V(g,h,'either "type" or "ref" is required'));let S=t.u(h.type),k=t.u(h.ref);if(h.id){let D=t.u(h.id);for(let A=0;A<f.arrayIndex;A++){let L=v.layers[A];t.u(L.id)===D&&o.push(new t.V(g,h.id,`duplicate layer id "${h.id}", previously used at line ${L.id.__line__}`))}}if("ref"in h){let D;["type","source","source-layer","filter","layout"].forEach(A=>{A in h&&o.push(new t.V(g,h[A],`"${A}" is prohibited for ref layers`))}),v.layers.forEach(A=>{t.u(A.id)===k&&(D=A)}),D?D.ref?o.push(new t.V(g,h.ref,"ref cannot reference another ref layer")):S=t.u(D.type):typeof k=="string"&&o.push(new t.V(g,h.ref,`ref layer "${k}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(h.source){let D=v.sources&&v.sources[h.source],A=D&&t.u(D.type);D?A==="vector"&&S==="raster"?o.push(new t.V(g,h.source,`layer "${h.id}" requires a raster source`)):A==="raster"&&S!=="raster"?o.push(new t.V(g,h.source,`layer "${h.id}" requires a vector source`)):A!=="vector"||h["source-layer"]?A==="raster-dem"&&S!=="hillshade"?o.push(new t.V(g,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||A==="geojson"&&D.lineMetrics?S==="raster-particle"&&A!=="raster-array"&&o.push(new t.V(g,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):o.push(new t.V(g,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new t.V(g,h.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new t.V(g,h,`layer "${h.id}" must specify a "source-layer"`)):o.push(new t.V(g,h.source,`source "${h.source}" not found`))}else o.push(new t.V(g,h,'missing required property "source"'));return o=o.concat(Un({key:g,value:h,valueSpec:x.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>G({key:`${g}.type`,value:h.type,valueSpec:x.layer.type,style:f.style,styleSpec:f.styleSpec,object:h,objectKey:"type"}),filter:D=>Es(t.o({layerType:S},D)),layout:D=>Un({layer:h,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>hc(t.o({layerType:S},A))}}),paint:D=>Un({layer:h,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>lu(t.o({layerType:S,layer:h},A))}})}})),o}function Ds(f){let o=f.value,h=f.key,g=t.n(o);return g!=="string"?[new t.V(h,o,`string expected, ${g} found`)]:[]}let Vo={promoteId:function({key:f,value:o}){if(t.n(o)==="string")return Ds({key:f,value:o});{let h=[];for(let g in o)h.push(...Ds({key:`${f}.${g}`,value:o[g]}));return h}}};function Pr(f){let o=f.value,h=f.key,g=f.styleSpec,v=f.style;if(!o.type)return[new t.V(h,o,'"type" is required')];let x=t.u(o.type),S=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(o.url||o.tiles||S.push(new t.m(h,o,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Un({key:h,value:o,valueSpec:g[`source_${x.replace("-","_")}`],style:f.style,styleSpec:g,objectElementValidators:Vo})),S;case"geojson":if(S=Un({key:h,value:o,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:Vo}),o.cluster)for(let k in o.clusterProperties){let[D,A]=o.clusterProperties[k],L=typeof D=="string"?[D,["accumulated"],["get",k]]:D;S.push(...Ta({key:`${h}.${k}.map`,value:A,expressionContext:"cluster-map"})),S.push(...Ta({key:`${h}.${k}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return S;case"video":return Un({key:h,value:o,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return Un({key:h,value:o,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new t.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ts({key:`${h}.type`,value:o.type,valueSpec:{values:cu(g)},style:v,styleSpec:g})}}function cu(f){return f.source.reduce((o,h)=>{let g=f[h];return g.type.type==="enum"&&(o=o.concat(Object.keys(g.type.values))),o},[])}function cl(f){let o=f.value,h=f.styleSpec,g=h.light,v=f.style,x=[],S=t.n(o);if(o===void 0)return x;if(S!=="object")return x=x.concat([new t.V("light",o,`object expected, ${S} found`)]),x;for(let k in o){let D=k.match(/^(.*)-transition$/);x=x.concat(D&&g[D[1]]&&g[D[1]].transition?G({key:k,value:o[k],valueSpec:h.transition,style:v,styleSpec:h}):g[k]?G({key:k,value:o[k],valueSpec:g[k],style:v,styleSpec:h}):[new t.V(k,o[k],`unknown property "${k}"`)])}return x}function uc(f){let o=f.value,h=[];if(!o)return h;let g=t.n(o);if(g!=="object")return h=h.concat([new t.V("light-3d",o,`object expected, ${g} found`)]),h;let v=f.styleSpec,x=v["light-3d"],S=f.key,k=f.style,D=f.style.lights;for(let z of["type","id"])if(!(z in o))return h=h.concat([new t.V("light-3d",o,`missing property ${z} on light`)]),h;if(o.type&&D)for(let z=0;z<f.arrayIndex;z++){let U=t.u(o.type),H=D[z];t.u(H.type)===U&&h.push(new t.V(S,o.id,`duplicate light type "${o.type}", previously defined at line ${H.id.__line__}`))}let A=`properties_light_${o.type}`;if(!(A in v))return h=h.concat([new t.V("light-3d",o,`Invalid light type ${o.type}`)]),h;let L=v[A];for(let z in o)if(z==="properties"){let U=o[z],H=t.n(U);if(H!=="object")return h=h.concat([new t.V("properties",U,`object expected, ${H} found`)]),h;for(let Y in U)h=h.concat(L[Y]?G({key:Y,value:U[Y],valueSpec:L[Y],style:k,styleSpec:v}):[new t.m(f.key,U[Y],`unknown property "${Y}"`)])}else{let U=z.match(/^(.*)-transition$/);h=h.concat(U&&x[U[1]]&&x[U[1]].transition?G({key:z,value:o[z],valueSpec:v.transition,style:k,styleSpec:v}):x[z]?G({key:z,value:o[z],valueSpec:x[z],style:k,styleSpec:v}):[new t.m(z,o[z],`unknown property "${z}"`)])}return h}function Bd(f){let o=f.value,h=f.key,g=f.style,v=f.styleSpec,x=v.terrain,S=[],k=t.n(o);if(o===void 0||k==="null")return S;if(k!=="object")return S=S.concat([new t.V("terrain",o,`object expected, ${k} found`)]),S;for(let D in o){let A=D.match(/^(.*)-transition$/);S=S.concat(A&&x[A[1]]&&x[A[1]].transition?G({key:D,value:o[D],valueSpec:v.transition,style:g,styleSpec:v}):x[D]?G({key:D,value:o[D],valueSpec:x[D],style:g,styleSpec:v}):[new t.m(D,o[D],`unknown property "${D}"`)])}if(o.source){let D=g.sources&&g.sources[o.source],A=D&&t.u(D.type);D?A!=="raster-dem"&&S.push(new t.V(h,o.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):S.push(new t.V(h,o.source,`source "${o.source}" not found`))}else S.push(new t.V(h,o,'terrain is missing required property "source"'));return S}function mc(f){let o=f.value,h=f.style,g=f.styleSpec,v=g.fog,x=[],S=t.n(o);if(o===void 0)return x;if(S!=="object")return x=x.concat([new t.V("fog",o,`object expected, ${S} found`)]),x;for(let k in o){let D=k.match(/^(.*)-transition$/);x=x.concat(D&&v[D[1]]&&v[D[1]].transition?G({key:k,value:o[k],valueSpec:g.transition,style:h,styleSpec:g}):v[k]?G({key:k,value:o[k],valueSpec:v[k],style:h,styleSpec:g}):[new t.m(k,o[k],`unknown property "${k}"`)])}return x}let Se={"*":()=>[],array:lc,boolean:function(f){let o=f.value,h=f.key,g=t.n(o);return g!=="boolean"?[new t.V(h,o,`boolean expected, ${g} found`)]:[]},number:ll,color:function(f){let o=f.key,h=f.value,g=t.n(h);return g!=="string"?[new t.V(o,h,`color expected, ${g} found`)]:t.F(h)===null?[new t.V(o,h,`color expected, "${h}" found`)]:[]},enum:Ts,filter:Es,function:Ia,layer:No,object:Un,source:Pr,model:t.K,light:cl,"light-3d":uc,terrain:Bd,fog:mc,string:Ds,formatted:function(f){return Ds(f).length===0?[]:Ta(f)},resolvedImage:function(f){return Ds(f).length===0?[]:Ta(f)},projection:function(f){let o=f.value,h=f.styleSpec,g=h.projection,v=f.style,x=[],S=t.n(o);if(S==="object")for(let k in o)x=x.concat(G({key:k,value:o[k],valueSpec:g[k],style:v,styleSpec:h}));else S!=="string"&&(x=x.concat([new t.V("projection",o,`object or string expected, ${S} found`)]));return x},import:function(f){let{value:o,styleSpec:h}=f,S=o,{data:g}=S,v=XM(S,["data"]);Object.defineProperty(v,"__line__",{value:o.__line__,enumerable:!1});let x=Un(t.o({},f,{value:v,valueSpec:h.import}));return t.u(v.id)===""&&x.push(new t.V(`${f.key}.id`,v,"import id can't be an empty string")),g&&(x=x.concat(ce(g,h,{key:`${f.key}.data`}))),x}};function G(f,o=!1){let h=f.value,g=f.valueSpec,v=f.styleSpec;if(g.expression&&t.H(t.u(h)))return Ia(f);if(g.expression&&t.t(t.v(h)))return Ta(f);if(g.type&&Se[g.type]){let x=Se[g.type](f);return o===!0&&x.length>0&&t.n(f.value)==="array"?Ta(f):x}return Un(t.o({},f,{valueSpec:g.type?v[g.type]:g}))}function K(f){let o=f.value,h=f.key,g=Ds(f);return g.length||(o.indexOf("{fontstack}")===-1&&g.push(new t.V(h,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&g.push(new t.V(h,o,'"glyphs" url must include a "{range}" token'))),g}function ce(f,o=t.L,h={}){return G({key:h.key||"",value:f,valueSpec:o.$root,styleSpec:o,style:f,objectElementValidators:{glyphs:K,"*":()=>[]}})}function be(f,o=t.L){return yi(ce(f,o))}let ye=f=>yi(Pr(f)),Ee=f=>yi(cl(f)),Ne=f=>yi(uc(f)),Ie=f=>yi(Bd(f)),je=f=>yi(mc(f)),ft=f=>yi(No(f)),lt=f=>yi(Es(f)),Rt=f=>yi(lu(f)),$t=f=>yi(hc(f)),pi=f=>yi(t.K(f));function yi(f){return f.slice().sort((o,h)=>o.line&&h.line?o.line-h.line:0)}function ri(f,o){let h=!1;if(o&&o.length)for(let g of o)g instanceof t.m?t.w(g.message):(f.fire(new t.d(new Error(g.message))),h=!0);return h}let Ei=new t.N({anchor:new t.O(t.L.light.anchor),position:new t.Q(t.L.light.position),color:new t.O(t.L.light.color),intensity:new t.O(t.L.light.intensity)});class At extends t.E{constructor(o,h="flat"){super(),this._transitionable=new t.U(Ei),this.setLight(o,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h,g={}){this._validate(Ee,o,g)||(this._transitionable.setTransitionOrValue(o),this.id=h)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,g){return(!g||g.validate!==!1)&&ri(this,o.call(be,t.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}let Sn=new t.N({source:new t.O(t.L.terrain.source),exaggeration:new t.O(t.L.terrain.exaggeration)}),Qi=class extends t.E{constructor(f,o,h,g){super(),this.scope=h,this._transitionable=new t.U(Sn,h,g),this._transitionable.setTransitionOrValue(f,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(f,o){this._transitionable.setTransitionOrValue(f,o)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new t.X(f)).get("exaggeration")}isZoomDependent(){let f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof t.Z}},Oi=45,Qn=65,Mn=.05;function dr(f,o,h,g){let v=t.$(Oi,Qn,h),[x,S]=Hr(f,g),k=1-Math.min(1,Math.exp((o-x)/(S-x)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*f.alpha}function Hr(f,o){let h=.5/Math.tan(.5*o);return[f.range[0]+h,f.range[1]+h]}function Wr(f,o,h,g,v){let x=t._.transformMat4([],[o,h,g],v.mercatorFogMatrix);return dr(f,t._.length(x),v.pitch,v._fov)}function dl(f,o,h,g,v,x,S){let k=[[h,g,0],[v,g,0],[v,x,0],[h,x,0]],D=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let L of k){let z=t._.transformMat4([],L,o),U=t._.length(z);D=Math.min(D,U),A=Math.max(A,U)}return[dr(f,D,S.pitch,S._fov),dr(f,A,S.pitch,S._fov)]}let lp=new t.N({range:new t.O(t.L.fog.range),color:new t.O(t.L.fog.color),"high-color":new t.O(t.L.fog["high-color"]),"space-color":new t.O(t.L.fog["space-color"]),"horizon-blend":new t.O(t.L.fog["horizon-blend"]),"star-intensity":new t.O(t.L.fog["star-intensity"]),"vertical-range":new t.O(t.L.fog["vertical-range"])});class Gg extends t.E{constructor(o,h,g,v){super(),this._transitionable=new t.U(lp,g,new Map(v)),this.set(o,v),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new t.a0(lp),this.scope=g}get state(){let o=this._transform,h=o.projection.name==="globe",g=t.a1(o.zoom),v=this.properties.get("range"),x=[.5,3];return{range:h?[t.a2(x[0],v[0],g),t.a2(x[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,h,g={}){if(this._validate(je,o,g))return;let v=t.W({},o);for(let x of Object.keys(t.L.fog))v[x]===void 0&&(v[x]=t.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.$(Oi,Qn,o))*h.a}getOpacityAtLatLng(o,h){return this._transform.projection.supportsFog?function(g,v,x){let S=t.Y.fromLngLat(v),k=x.elevation?x.elevation.getAtPointOrZero(S):0;return Wr(g,S.x,S.y,k,x)}(this.state,o,h):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];let h=this._transform.calculateFogTileMatrix(o.toUnwrapped());return dl(this.state,h,0,0,t.a3,t.a3,this._transform)}getOpacityForBounds(o,h,g,v,x){return this._transform.projection.supportsFog?dl(this.state,o,h,g,v,x,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Hr(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;let h=[4,5,6,7];for(let g of h){let v=o.points[g],x;if(v[2]>=0)x=v;else{let S=o.points[g-4];x=t.a4(S,v,S[2]/(S[2]-v[2]))}if(Wr(this.state,x[0],x[1],0,this._transform)>=Mn)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,g){return(!g||g.validate!==!1)&&ri(this,o.call(be,t.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.L})))}}class Nd extends t.E{constructor(o,h,g,v){super(),this.scope=g,this._options=o,this.properties=new t.a0(h),this._transitionable=new t.U(h,g,new Map(v)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,h){this._options=o,this._transitionable.setTransitionOrValue(o.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let di=new t.N({color:new t.O(t.L.properties_light_ambient.color),intensity:new t.O(t.L.properties_light_ambient.intensity)}),cp=new t.N({direction:new t.a5(t.L.properties_light_directional.direction),color:new t.O(t.L.properties_light_directional.color),intensity:new t.O(t.L.properties_light_directional.intensity),"cast-shadows":new t.O(t.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new t.O(t.L.properties_light_directional["shadow-intensity"])});var As=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,dp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,hp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,up="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",mp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,pp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,fp=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,gp=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,_p=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,bp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,qg=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let pc=[];fc(As,pc),fc(hp,pc),fc(dp,pc);let du={"_prelude_fog.vertex.glsl":pp,"_prelude_terrain.vertex.glsl":mp,"_prelude_shadow.vertex.glsl":bp,"_prelude_fog.fragment.glsl":fp,"_prelude_shadow.fragment.glsl":qg,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":gp,"_prelude_raster_particle.glsl":_p},hu={};Si("",mp),Si(fp,pp),Si(qg,bp),Si(gp,""),Si(_p,"");let $g=Si(dp,hp),Yg=As;var Zg={background:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Si("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Si(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Si(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Si("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Si("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Si("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Si(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Si(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Si(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Si("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Si("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Si(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Si(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Si(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Si(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Si("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Si(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,up),skyboxGradient:Si(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,up),skyboxCapture:Si(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Si(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Si(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Si("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function fc(f,o){let h=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=g.split(" ");for(let x of v)o.includes(x)||o.push(x)}}function Si(f,o){let h=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(A=>{let L=A.split(" ");return L[L.length-1]}),v=[...new Set(v)]);let x={},S=[],k=[];if(f=f.replace(h,(A,L)=>(k.push(L),"")),(o=o.replace(h,(A,L)=>(S.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...pc];fc(f,D),fc(o,D);for(let A of[...S,...k])du[A]||console.error(`Undefined include: ${A}`),hu[A]||(hu[A]=[],fc(du[A],hu[A])),D=[...D,...hu[A]];return{fragmentSource:f=f.replace(g,(A,L,z,U,H)=>(x[H]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${z} ${U} ${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${H}
    ${z} ${U} ${H} = u_${H};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${z} ${U} ${H};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(g,(A,L,z,U,H)=>{let Y=U==="float"?"vec2":U,Z=H.match(/color/)?"color":Y;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${H}
in ${z} ${U} a_${H};
#endif
`:x[H]?L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${z} ${Y} a_${H};
out ${z} ${U} ${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${z} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${Z}(a_${H}, u_${H}_t);
#else
    ${z} ${U} ${H} = u_${H};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${z} ${U} a_${H};
    out ${z} ${U} ${H};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${H} = a_${H};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${z} ${Y} a_${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${H}0;
in vec4 a_${H}1;
in vec4 a_${H}2;
in vec4 a_${H}3;
#else
uniform ${z} ${U} u_${H};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${Y} a_${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${z} ${U} ${H} = a_${H};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${U} ${H} = a_${H};
#else
    ${z} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${U} ${H} = unpack_mix_${Z}(a_${H}, u_${H}_t);
#else
    ${z} ${U} ${H} = u_${H};
#endif
`}),staticAttributes:v,usedDefines:D,vertexIncludes:S,fragmentIncludes:k}}class Iy{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,h,g,v,x,S,k,D){this.context=o;let A=this.boundPaintVertexBuffers.length!==v.length;for(let z=0;!A&&z<v.length;z++)this.boundPaintVertexBuffers[z]!==v[z]&&(A=!0);let L=this.boundDynamicVertexBuffers.length!==k.length;for(let z=0;!L&&z<k.length;z++)this.boundDynamicVertexBuffers[z]!==k[z]&&(L=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||A||L||this.boundIndexBuffer!==x||this.boundVertexOffset!==S)this.freshBind(h,g,v,x,S,k,D);else{o.bindVertexArrayOES.set(this.vao);for(let z of k)z&&(z.bind(),D&&z.instanceCount&&z.setVertexAttribDivisor(o.gl,h,D));x&&x.dynamicDraw&&x.bind()}}freshBind(o,h,g,v,x,S,k){let D=o.numAttributes,A=this.context,L=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=S,h.enableAttributes(L,o),h.bind(),h.setVertexAttribPointers(L,o,x);for(let z of g)z.enableAttributes(L,o),z.bind(),z.setVertexAttribPointers(L,o,x);for(let z of S)z&&(z.enableAttributes(L,o),z.bind(),z.setVertexAttribPointers(L,o,x),k&&z.instanceCount&&z.setVertexAttribDivisor(L,o,k));v&&v.bind(),A.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ty(f,o){let h=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new t.Y(0,g/h).toLngLat().lat,new t.Y(0,(g+1)/h).toLngLat().lat]}function Ey(f,o,h,g,v,x,S){let k=f.context,D=k.gl,A=h.hillshadeFBO;if(!A)return;f.prepareDrawTile();let L=f.isTileAffectedByFog(o),z=f.getOrCreateProgram("hillshade",{overrideFog:L});k.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,A.colorAttachment.get());let U=((X,Q,re,oe)=>{let ae=re.paint.get("hillshade-shadow-color"),_e=re.paint.get("hillshade-highlight-color"),ge=re.paint.get("hillshade-accent-color"),ne=re.paint.get("hillshade-emissive-strength"),se=t.ab(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")se-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){let we=X.style.directionalLight.properties.get("direction"),Re=t.ac(we.x,we.y,we.z);se=t.ab(Re[1])}let le=!X.options.moving;return{u_matrix:oe||X.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),le),u_image:0,u_latrange:Ty(0,Q.tileID),u_light:[re.paint.get("hillshade-exaggeration"),se],u_shadow:ae.toRenderColor(re.lut),u_highlight:_e.toRenderColor(re.lut),u_emissive_strength:ne,u_accent:ge.toRenderColor(re.lut)}})(f,h,g,f.terrain?o.projMatrix:null);f.uploadCommonUniforms(k,z,o.toUnwrapped());let{tileBoundsBuffer:H,tileBoundsIndexBuffer:Y,tileBoundsSegments:Z}=f.getTileBoundsBuffers(h);z.draw(f,D.TRIANGLES,v,x,S,t.af.disabled,U,g.id,H,Y,Z)}function yp(f,o,h){if(!o.needsDEMTextureUpload)return;let g=f.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(h.stride);let x=h.getPixels();o.demTexture?o.demTexture.update(x,{premultiply:!1}):o.demTexture=new t.T(g,x,v.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Ea(f,o,h){let g=f.context,v=g.gl;if(!o.dem)return;let x=o.dem;if(g.activeTexture.set(v.TEXTURE1),yp(f,o,x),!o.demTexture)return;o.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let S=x.dim;g.activeTexture.set(v.TEXTURE0);let k=o.hillshadeFBO;if(!k){let U=new t.T(g,{width:S,height:S,data:null},v.RGBA);U.bind(v.LINEAR,v.CLAMP_TO_EDGE),k=o.hillshadeFBO=g.createFramebuffer(S,S,!0,"renderbuffer"),k.colorAttachment.set(U.texture)}g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,S,S]);let{tileBoundsBuffer:D,tileBoundsIndexBuffer:A,tileBoundsSegments:L}=f.getMercatorTileBoundsBuffers(),z=[];f.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(f,v.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,((U,H)=>{let Y=H.stride,Z=t.ad.create();return t.ad.ortho(Z,0,t.a3,-t.a3,0,0,1),t.ad.translate(Z,Z,[0,-t.a3,0]),{u_matrix:Z,u_image:1,u_dimension:[Y,Y],u_zoom:U.overscaledZ}})(o.tileID,x),h.id,D,A,L),o.needsHillshadePrepare=!1}function vp(f,o,h,g,v){let x=function(S,k){if(S)return v(S);if(k){if(f.url&&k.tiles&&f.tiles&&delete f.tiles,k.variants){if(!Array.isArray(k.variants))return v(new Error("variants must be an array"));for(let A of k.variants){if(A==null||typeof A!="object"||A.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(A.capabilities))return v(new Error("capabilities must be an array"));if(A.capabilities.length===1&&A.capabilities[0]==="meshopt"){k=t.W(k,A);break}}}let D=t.ah(t.W(k,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(D.vectorLayers=k.vector_layers,D.vectorLayerIds=D.vectorLayers.map(A=>A.id)),k.raster_layers&&(D.rasterLayers=k.raster_layers,D.rasterLayerIds=D.rasterLayers.map(A=>A.id)),D.tiles=o.canonicalizeTileset(D,f.url),v(null,D)}};return f.url?t.g(o.transformRequest(o.normalizeSourceURL(f.url,null,h,g),t.R.Source),x):t.e.frame(()=>x(null,f))}class Vd{constructor(o,h,g){this.bounds=t.ai.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){let h=Math.pow(2,o.z),g=Math.floor(t.aj(this.bounds.getWest())*h),v=Math.floor(t.ak(this.bounds.getNorth())*h),x=Math.ceil(t.aj(this.bounds.getEast())*h),S=Math.ceil(t.ak(this.bounds.getSouth())*h);return o.x>=g&&o.x<x&&o.y>=v&&o.y<S}}class jd extends t.E{constructor(o,h,g,v){super(),this.id=o,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.W({type:"raster"},h),t.W(this,t.ah(h,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._tileJSONRequest=vp(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new t.d(h)):g&&(t.W(this,g),g.bounds&&(this.tileBounds=new Vd(g.bounds,this.minzoom,this.maxzoom)),t.an(g.tiles),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),o&&o(h)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=t.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){let g=t.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=t.h(this.map._requestManager.transformRequest(v,t.R.Tile),(x,S,k,D)=>(delete o.request,o.aborted?(o.state="unloaded",h(null)):x?(o.state="errored",h(x)):S?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:k,expires:D}),o.setTexture(S,this.map.painter),o.state="loaded",t.am(this.dispatcher),void h(null)):h(null)))}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h&&h()}unloadTile(o,h){o.texture&&o.texture instanceof t.T?(o.destroy(!0),o.texture&&o.texture instanceof t.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class uu extends t.E{constructor(o,h,g,v){if(super(),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.W(this,t.ah(h,["url","scheme","tileSize","promoteId"])),this._options=t.W({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new t.ao}load(o){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=vp(this._options,this.map._requestManager,h,g,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new t.d(v))):x&&(t.W(this,x),x.bounds&&(this.tileBounds=new Vd(x.bounds,this.minzoom,this.maxzoom)),t.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),o&&o(v)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=t.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return t.W({},this._options)}loadTile(o,h){let g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(g,t.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,S={request:v,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",S,k.bind(this));else if(o.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",S,k.bind(this),void 0,!0);else{let D=t.ap.call({deduped:this._deduped},S,(A,L)=>{A||!L?k.call(this,A):(S.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},o.actor&&o.actor.send("loadTile",S,k.bind(this),void 0,!0))},!0);o.request={cancel:D}}function k(D,A){return delete o.request,o.aborted?h(null):D&&D.status!==404?h(D):(A&&A.resourceTiming&&(o.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&o.setExpiryData(A),o.loadVectorData(A,this.map.painter),t.am(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,h){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let hl=f=>({u_matrix:new t.a6(f),u_image0:new t.a7(f),u_skirt_height:new t.aa(f),u_ground_shadow_factor:new t.aq(f)}),xt=(f,o,h)=>({u_matrix:f,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:h}),Xg=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:S,u_frustum_tr:k,u_frustum_br:D,u_frustum_bl:A,u_globe_pos:L,u_globe_radius:z,u_viewport:U,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:Y});class Ud{constructor(o=0,h=0,g=0,v=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=g,this.right=v}interpolate(o,h,g){return h.top!=null&&o.top!=null&&(this.top=t.a2(o.top,h.top,g)),h.bottom!=null&&o.bottom!=null&&(this.bottom=t.a2(o.bottom,h.bottom,g)),h.left!=null&&o.left!=null&&(this.left=t.a2(o.left,h.left,g)),h.right!=null&&o.right!=null&&(this.right=t.a2(o.right,h.right,g)),this}getCenter(o,h){let g=t.at((this.left+o-this.right)/2,0,o),v=t.at((this.top+h-this.bottom)/2,0,h);return new t.P(g,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Ud(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Di(f,o){let h=t.aw(f,3);t.ad.fromQuat(f,o),t.az(f,3,h)}function Gr(f,o){let h=t.av.identity([]);return t.av.rotateZ(h,h,-o),t.av.rotateX(h,h,-f),h}function Qg(f,o){let h=[f[0],f[1],0],g=[o[0],o[1],0];if(t._.length(h)>=1e-15){let S=t._.normalize([],h);t._.scale(g,S,t._.dot(g,S)),o[0]=g[0],o[1]=g[1]}let v=t._.cross([],o,f);if(t._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return Gr(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class xp{constructor(o,h){this.position=o,this.orientation=h}get position(){return this._position}set position(o){if(o){let h=o instanceof t.Y?o:new t.Y(o[0],o[1],o[2]);this._renderWorldCopies&&(h.x=t.au(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(o,h){if(this.orientation=null,!this.position)return;let g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(t.Y.fromLngLat(o)):0,x=t.Y.fromLngLat(o,v),S=[x.x-g.x,x.y-g.y,x.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Qg(S,h)}setPitchBearing(o,h){this.orientation=Gr(t.ab(o),t.ab(-h))}}class Hd{constructor(o,h){this._transform=t.ad.identity([]),this.orientation=h,this.position=o}get mercatorPosition(){let o=this.position;return new t.Y(o[0],o[1],o[2])}get position(){let o=t.aw(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var h;o&&t.az(this._transform,3,[(h=o)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||t.av.identity([]),o&&Di(this._transform,this._orientation)}getPitchBearing(){let o=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,h){this._orientation=Gr(o,h),Di(this._transform,this._orientation)}forward(){let o=t.aw(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){let o=t.aw(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){let o=t.aw(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,h){let g=new Float64Array(16);return t.ad.invert(g,this.getWorldToCamera(o,h)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,h,g){let v=this.position;t._.scale(v,v,-o);let x=new Float64Array(16);return t.ad.fromScaling(x,[g,g,g]),t.ad.translate(x,x,v),x[10]*=h,x}getWorldToCamera(o,h){let g=new Float64Array(16),v=new Float64Array(4),x=this.position;return t.av.conjugate(v,this._orientation),t._.scale(x,x,-o),t.ad.fromQuat(g,v),t.ad.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(o,h,g,v){let x=new Float64Array(16);return t.ad.perspective(x,o,h,g,v),x}getCameraToClipOrthographic(o,h,g,v,x,S){let k=new Float64Array(16);return t.ad.ortho(k,o,h,g,v,x,S),k}getDistanceToElevation(o,h=!1){let g=o===0?0:t.ax(o,h?t.ay(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new Hd([...this.position],[...this.orientation])}}let gc={unknown:0,flipRequired:1,flipNotRequired:2},fi=Math.tan(85*Math.PI/180);function ul(f,o,h,g,v,x,S){let k=t.ad.create();if(h)if(x.name==="globe"){let D=t.aB(v,o);t.ad.multiply(k,k,D)}else{let D=t.aC.invert([],S);k[0]=D[0],k[1]=D[1],k[4]=D[2],k[5]=D[3],g||t.ad.rotateZ(k,k,v.angle)}else t.ad.multiply(k,v.labelPlaneMatrix,f);return k}function ml(f,o,h,g,v,x,S){let k=ul(f,o,h,g,v,x,S);return x.name==="globe"&&h||(k[2]=k[6]=k[10]=k[14]=0),k}function _c(f,o,h,g,v,x,S){if(h){if(x.name==="globe"){let k=ul(f,o,h,g,v,x,S);return t.ad.invert(k,k),t.ad.multiply(k,f,k),k}{let k=t.ad.clone(f),D=t.ad.identity([]);return D[0]=S[0],D[1]=S[1],D[4]=S[2],D[5]=S[3],t.ad.multiply(k,k,D),g||t.ad.rotateZ(k,k,-v.angle),k}}return v.glCoordMatrix}function jo(f,o,h,g){let v=[f,o,h,1];h?t.aA.transformMat4(v,v,g):Da(v,v,g);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function qr(f,o){return Math.min(.5+f/o*.5,1.5)}function Dy(f,o){let h=f[0]/f[3],g=f[1]/f[3];return h>=-o[0]&&h<=o[0]&&g>=-o[1]&&g<=o[1]}function mu(f,o,h,g,v,x,S,k,D,A){let L=h.transform,z=g?f.textSizeData:f.iconSizeData,U=t.aD(z,h.transform.zoom),H=L.projection.name==="globe",Y=[256/h.width*2+1,256/h.height*2+1],Z=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Z.clear();let X=null;H&&(X=g?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let Q=f.lineVertexArray,re=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,oe=h.transform.width/h.transform.height,ae,_e=!1;for(let ge=0;ge<re.length;ge++){let ne=re.get(ge),{numGlyphs:se,writingMode:le}=ne;if(le!==t.aE.vertical||_e||ae===t.aE.horizontal||(_e=!0),ae=le,(ne.hidden||le===t.aE.vertical)&&!_e){pl(se,Z);continue}_e=!1;let we=new t.P(ne.tileAnchorX,ne.tileAnchorY),{x:Re,y:me,z:Le}=L.projection.projectTilePoint(we.x,we.y,A.canonical);if(D){let[kt,vt,it]=D(we);Re+=kt,me+=vt,Le+=it}let Be=[Re,me,Le,1];if(t.aA.transformMat4(Be,Be,o),!Dy(Be,Y)){pl(se,Z);continue}let Qe=Be[3],Je=qr(h.transform.getCameraToCenterDistance(L.projection),Qe),Ze=t.aF(z,U,ne),Te=S?Ze/Je:Ze*Je,Ve=jo(Re,me,Le,v);if(Ve[3]<=0){pl(se,Z);continue}let Ye={},bt=S?null:D,yt=Cp(ne,Te,!1,k,o,v,x,f.glyphOffsetArray,Q,Z,X,Ve,we,Ye,oe,bt,L.projection,A,S);_e=yt.useVertical,bt&&yt.needsFlipping&&(Ye={}),(yt.notEnoughRoom||_e||yt.needsFlipping&&Cp(ne,Te,!0,k,o,v,x,f.glyphOffsetArray,Q,Z,X,Ve,we,Ye,oe,bt,L.projection,A,S).notEnoughRoom)&&pl(se,Z)}g?(f.text.dynamicLayoutVertexBuffer.updateData(Z),X&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(X)):(f.icon.dynamicLayoutVertexBuffer.updateData(Z),X&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(X))}function pu(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z){let{lineStartIndex:X,glyphStartIndex:Q,segment:re}=k,oe=Q+k.numGlyphs,ae=X+k.lineLength,_e=o.getoffsetX(Q),ge=o.getoffsetX(oe-1),ne=bc(f*_e,h,g,v,x,S,re,X,ae,D,A,L,z,U,!0,H,Y,Z);if(!ne)return null;let se=bc(f*ge,h,g,v,x,S,re,X,ae,D,A,L,z,U,!0,H,Y,Z);return se?{first:ne,last:se}:null}function wp(f,o,h,g){return f===t.aE.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:f===t.aE.vertical?g>0?{needsFlipping:!0}:null:o!==gc.unknown&&function(v,x){return v===0||Math.abs(x/v)>fi}(h,g)?o===gc.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Cp(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q,re){let oe=o/24,ae=f.lineOffsetX*oe,_e=f.lineOffsetY*oe,{lineStartIndex:ge,glyphStartIndex:ne,numGlyphs:se,segment:le,writingMode:we,flipState:Re}=f,me=ge+f.lineLength,Le=Be=>{if(L){let[Te,Ve,Ye]=Be.up,bt=A.length;t.aG(L,bt+0,Te,Ve,Ye),t.aG(L,bt+1,Te,Ve,Ye),t.aG(L,bt+2,Te,Ve,Ye),t.aG(L,bt+3,Te,Ve,Ye)}let[Qe,Je,Ze]=Be.point;t.aH(A,Qe,Je,Ze,Be.angle)};if(se>1){let Be=pu(oe,k,ae,_e,h,z,U,f,D,x,H,Z,!1,X,Q,re);if(!Be)return{notEnoughRoom:!0};if(g&&!h){let[Qe,Je,Ze]=Be.first.point,[Te,Ve,Ye]=Be.last.point;[Qe,Je]=jo(Qe,Je,Ze,S),[Te,Ve]=jo(Te,Ve,Ye,S);let bt=wp(we,Re,(Te-Qe)*Y,Ve-Je);if(f.flipState=bt&&bt.needsFlipping?gc.flipRequired:gc.flipNotRequired,bt)return bt}Le(Be.first);for(let Qe=ne+1;Qe<ne+se-1;Qe++){let Je=bc(oe*k.getoffsetX(Qe),ae,_e,h,z,U,le,ge,me,D,x,H,Z,!1,!1,X,Q,re);if(!Je)return A.length-=4*(Qe-ne),{notEnoughRoom:!0};Le(Je)}Le(Be.last)}else{if(g&&!h){let Qe=jo(U.x,U.y,0,v),Je=ge+le+1,Ze=new t.P(D.getx(Je),D.gety(Je)),Te=jo(Ze.x,Ze.y,0,v),Ve=Te[3]>0?Te:Wd(U,Ze,Qe,1,v,void 0,X,Q.canonical),Ye=wp(we,Re,(Ve[0]-Qe[0])*Y,Ve[1]-Qe[1]);if(f.flipState=Ye&&Ye.needsFlipping?gc.flipRequired:gc.flipNotRequired,Ye)return Ye}let Be=bc(oe*k.getoffsetX(ne),ae,_e,h,z,U,le,ge,me,D,x,H,Z,!1,!1,X,Q,re);if(!Be)return{notEnoughRoom:!0};Le(Be)}return{}}function fu(f,o,h,g,v){let{x,y:S,z:k}=g.projectTilePoint(f.x,f.y,o);if(!v)return jo(x,S,k,h);let[D,A,L]=v(f);return jo(x+D,S+A,k+L,h)}function Wd(f,o,h,g,v,x,S,k){let D=fu(f.sub(o)._unit()._add(f),k,v,S,x);return t._.sub(D,h,D),t._.normalize(D,D),t._.scaleAndAdd(D,h,D,g)}function bc(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q){let re=g?f-o:f+o,oe=re>0?1:-1,ae=0;g&&(oe*=-1,ae=Math.PI),oe<0&&(ae+=Math.PI);let _e=k+S+(oe>0?0:1)|0,ge=v,ne=v,se=0,le=0,we=Math.abs(re),Re=[],me=[],Le=x,Be=Le,Qe=()=>Wd(Be,Le,ne,we-se+1,L,U,Z,X.canonical);for(;se+le<=we;){if(_e+=oe,_e<k||_e>=D)return null;if(ne=ge,Be=Le,Re.push(ne),H&&me.push(Be),Le=new t.P(A.getx(_e),A.gety(_e)),ge=z[_e],!ge){let vt=fu(Le,X.canonical,L,Z,U);ge=vt[3]>0?z[_e]=vt:Qe()}se+=le,le=t._.distance(ne,ge)}Y&&U&&(z[_e]&&(ge=Qe(),le=t._.distance(ne,ge)),z[_e]=ge);let Je=(we-se)/le,Ze=Le.sub(Be)._mult(Je)._add(Be),Te=t._.sub([],ge,ne),Ve=t._.scaleAndAdd([],ne,Te,Je),Ye=[0,0,1],bt=Te[0],yt=Te[1];if(Q&&(Ye=Z.upVector(X.canonical,Ze.x,Ze.y),Ye[0]!==0||Ye[1]!==0||Ye[2]!==1)){let vt=[Ye[2],0,-Ye[0]],it=t._.cross([],Ye,vt);t._.normalize(vt,vt),t._.normalize(it,it),bt=t._.dot(Te,vt),yt=t._.dot(Te,it)}if(h){let vt=t._.cross([],Ye,Te);t._.normalize(vt,vt),t._.scaleAndAdd(Ve,Ve,vt,h*oe)}let kt=ae+Math.atan2(yt,bt);return Re.push(Ve),H&&me.push(Ze),{point:Ve,angle:kt,path:Re,tilePath:me,up:Ye}}function pl(f,o){let h=o.length,g=h+4*f;o.resize(g),o.float32.fill(-1/0,4*h,4*g)}function Da(f,o,h){let g=o[0],v=o[1];return f[0]=h[0]*g+h[4]*v+h[12],f[1]=h[1]*g+h[5]*v+h[13],f[3]=h[3]*g+h[7]*v+h[15],f}let Sp=(f,o,h)=>(1-h)*f+h*o,Kn=f=>f*f*f*f*f;class Aa{constructor(o,h,g,v,x,S,k){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(S),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new t.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ud,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Hd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let o=new Aa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,h=!1){let g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(o||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return t.ah(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=t.aJ(this.projectionOptions);let g=!_(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){let o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.aJ({name:"mercator"});let h=o!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.au(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){let h=-o*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=t.aC.create(),t.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){let h=t.at(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=t.ab(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){let h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){let o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let g=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let o=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop(),v=0,x=0;for(let S=0;S<h.length;S++){let k=new t.P(h[S][0]*this.width,g+h[S][1]*(this.height-g)),D=o.pointCoordinate(k);if(!D)continue;let A=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);v+=D[3]*A,x+=A}return x===0?NaN:v/x}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let o=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(o),x=this._mercatorZfromZoom(this._maxZoom),S=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude())),g;g=o.z<this._camera.position[2]?[h.x,h.y,h.z]:[o.x,o.y,o.z];let v=t._.length(t._.sub([],this._camera.position,g));return t.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let h=!1;if(o.orientation&&!t.av.exactEquals(o.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(o.orientation)),o.position){let g=[o.position.x,o.position.y,o.position.z];t._.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let o=this._camera.position,h=new xp;return h.position=new t.Y(o[0],o[1],o[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(o){if(!t.av.length(o))return!1;t.av.normalize(o,o);let h=t._.transformQuat([],[0,0,-1],o),g=t._.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;let v=Qg(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(o){let h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;o[2]=t.at(o[2],v/g,v/h),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,g){this._unmodified=!1,this._edgeInsets.interpolate(o,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){let h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){let h=[new t.aK(0,o)];if(this.renderWorldCopies){let g=this.pointCoordinate(new t.P(0,0)),v=this.pointCoordinate(new t.P(this.width,0)),x=this.pointCoordinate(new t.P(this.width,this.height)),S=this.pointCoordinate(new t.P(0,this.height)),k=Math.floor(Math.min(g.x,v.x,x.x,S.x)),D=Math.floor(Math.max(g.x,v.x,x.x,S.x)),A=1;for(let L=k-A;L<=D+A;L++)L!==0&&h.push(new t.aK(L,o))}return h}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(o,h,g){let v=[];if(h[0]===0&&h[1]===0)return v;for(let S of o){let k=S.canonical,D=S.overscaledZ,A=S.wrap,L=1<<k.z,z=k.x+1<L,U=k.x>0,H=k.y+1<L,Y=k.y>0,Z=S.wrap-(U?0:1),X=S.wrap+(z?0:1),Q=U?k.x-1:L-1,re=z?k.x+1:0;h[0]<0?(v.push(new t.aL(D,X,k.z,re,k.y)),h[1]<0&&H&&(v.push(new t.aL(D,A,k.z,k.x,k.y+1)),v.push(new t.aL(D,X,k.z,re,k.y+1))),h[1]>0&&Y&&(v.push(new t.aL(D,A,k.z,k.x,k.y-1)),v.push(new t.aL(D,X,k.z,re,k.y-1)))):h[0]>0?(v.push(new t.aL(D,Z,k.z,Q,k.y)),h[1]<0&&H&&(v.push(new t.aL(D,A,k.z,k.x,k.y+1)),v.push(new t.aL(D,Z,k.z,Q,k.y+1))),h[1]>0&&Y&&(v.push(new t.aL(D,A,k.z,k.x,k.y-1)),v.push(new t.aL(D,Z,k.z,Q,k.y-1)))):h[1]<0&&H?v.push(new t.aL(D,A,k.z,k.x,k.y+1)):Y&&v.push(new t.aL(D,A,k.z,k.x,k.y-1))}if(v.length>1){v.sort((D,A)=>D.overscaledZ-A.overscaledZ||D.wrap-A.wrap||D.canonical.z-A.canonical.z||D.canonical.x-A.canonical.x||D.canonical.y-A.canonical.y);let S=0,k=0;for(;k<v.length;)v[k].equals(v[S])?++k:v[++S]=v[k++];v.length=S+1}let x=[];for(let S of v)v.some(k=>S.isChildOf(k))||x.push(S);return v=x.filter(S=>!o.some(k=>!!(S.overscaledZ<g&&k.isChildOf(S))||S.equals(k)||S.isChildOf(k))),v}coveringTiles(o){let h=this.coveringZoomLevel(o),g=h,v=this.elevation&&this.elevation.exaggeration(),x=v&&!o.isTerrainDEM,S=this.projection.name==="mercator";if(o.minzoom!==void 0&&h<o.minzoom)return[];o.maxzoom!==void 0&&h>o.maxzoom&&(h=o.maxzoom);let k=this.locationCoordinate(this.center),D=this.center.lat,A=1<<h,L=[A*k.x,A*k.y,0],z=this.projection.name==="globe",U=!z,H=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,U),Y=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=A*t.ax(1,this.center.lat),X=this._camera.position[2]/t.ax(1,this.center.lat),Q=[A*Y.x,A*Y.y,X*(U?1:Z)],re=z||v,oe=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),ae=this.isLODDisabled(!0)?h:0,_e;if(this._elevation&&o.isTerrainDEM)_e=1e4*this._elevation.exaggeration();else if(this._elevation){let Te=this._elevation.getMinMaxForVisibleTiles();_e=Te?Te.max:this._centerAltitude}else _e=this._centerAltitude;let ge=o.isTerrainDEM?-_e:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?t.aN(this):1,se=Te=>{let Ye=new t.Y(Te.x+25e-6,Te.y,Te.z),bt=new t.Y(Te.x,Te.y+25e-6,Te.z),yt=Te.toLngLat(),kt=Ye.toLngLat(),vt=bt.toLngLat(),it=this.locationCoordinate(yt),Ge=this.locationCoordinate(kt),Dt=this.locationCoordinate(vt),ai=Math.hypot(Ge.x-it.x,Ge.y-it.y),ti=Math.hypot(Dt.x-it.x,Dt.y-it.y);return Math.sqrt(ai*ti)*ne/25e-6},le=Te=>{let Ve=_e,Ye=ge;return{aabb:t.aQ(this,A,0,0,0,Te,Ye,Ve,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:Ve,wrap:Te,fullyVisible:!1}},we=[],Re=[],me=h,Le=o.reparseOverscaled?g:h,Be=Te=>Te*Te,Qe=Be((X-this._centerAltitude)*Z),Je=Te=>{if(!this._elevation||!Te.tileID||!S)return;let Ve=this._elevation.getMinMaxForTile(Te.tileID),Ye=Te.aabb;Ve?(Ye.min[2]=Ve.min,Ye.max[2]=Ve.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Te.shouldSplit=Ze(Te),Te.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},Ze=Te=>{if(Te.zoom<ae)return!0;if(Te.zoom===me)return!1;if(Te.shouldSplit!=null)return Te.shouldSplit;let Ve=Te.aabb.distanceX(Q),Ye=Te.aabb.distanceY(Q),bt=Qe,yt=1;if(z){bt=Be(Te.aabb.distanceZ(Q));let it=Math.pow(2,Te.zoom),Ge=t.ay((Te.y+1)/it),Dt=t.ay(Te.y/it),ai=Math.min(Math.max(D,Ge),Dt),ti=t.b4(ai)/t.b4(D);if(yt=ai===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ti/this._mercatorScaleRatio),this.zoom<=t.b1&&Te.zoom===me-1&&ti>=.9)return!0}else if(x&&(bt=Be(Te.aabb.distanceZ(Q)*Z)),this.projection.isReprojectedInTileSpace&&g<=5){let it=Math.pow(2,Te.zoom),Ge=se(new t.Y((Te.x+.5)/it,(Te.y+.5)/it));yt=Ge>.85?1:Ge}let kt=Ve*Ve+Ye*Ye+bt,vt=Be((1<<me-Te.zoom)*oe*yt*((it,Ge)=>{if(Ge*Be(.707)<it)return 1;let Dt=Math.sqrt(Ge/it);return Dt/(1.4144271570014144+(Math.pow(1.1,Dt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(bt,Qe),kt));return kt<vt};if(this.renderWorldCopies)for(let Te=1;Te<=3;Te++)we.push(le(-Te)),we.push(le(Te));for(we.push(le(0));we.length>0;){let Te=we.pop(),Ve=Te.x,Ye=Te.y,bt=Te.fullyVisible,yt=()=>this.projection.name==="globe"&&(Te.y===0||Te.y===(1<<Te.zoom)-1);if(!bt){let kt=re?Te.aabb.intersects(H):Te.aabb.intersectsFlat(H);if(kt===0&&yt()){let vt=new t.aO(Te.zoom,Ve,Ye);kt=t.aP(this,A,vt,!0).intersects(H)}if(kt===0)continue;bt=kt===2}if(Te.zoom!==me&&Ze(Te))for(let kt=0;kt<4;kt++){let vt=(Ve<<1)+kt%2,it=(Ye<<1)+(kt>>1),Ge={aabb:S?Te.aabb.quadrant(kt):t.aQ(this,A,Te.zoom+1,vt,it,Te.wrap,Te.minZ,Te.maxZ,this.projection),zoom:Te.zoom+1,x:vt,y:it,wrap:Te.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:Te.minZ,maxZ:Te.maxZ};x&&!z&&(Ge.tileID=new t.aL(Te.zoom+1===me?Le:Te.zoom+1,Te.wrap,Te.zoom+1,vt,it),Je(Ge)),we.push(Ge)}else{let kt=Te.zoom===me?Le:Te.zoom;if(o.minzoom&&o.minzoom>kt)continue;if(!bt){let Dt=re?Te.aabb.intersectsPrecise(H):Te.aabb.intersectsPreciseFlat(H);if(Dt===0&&yt()){let ai=new t.aO(Te.zoom,Ve,Ye);Dt=t.aP(this,A,ai,!0).intersectsPrecise(H)}if(Dt===0)continue}let vt=L[0]-(.5+Ve+(Te.wrap<<Te.zoom))*(1<<h-Te.zoom),it=L[1]-.5-Ye,Ge=Te.tileID?Te.tileID:new t.aL(kt,Te.wrap,Te.zoom,Ve,Ye);Re.push({tileID:Ge,distanceSq:vt*vt+it*it})}}if(this.fogCullDistSq){let Te=this.fogCullDistSq,Ve=this.horizonLineFromTop();Re=Re.filter(Ye=>{let bt=[0,0,0,1],yt=[t.a3,t.a3,0,1],kt=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());t.aA.transformMat4(bt,bt,kt),t.aA.transformMat4(yt,yt,kt);let vt=t.aA.min([],bt,yt),it=t.aA.max([],bt,yt),Ge=t.aR(vt,it);if(Ge===0)return!0;let Dt=!1,ai=this._elevation;if(ai&&Ge>Te&&Ve!==0){let ti=this.calculateProjMatrix(Ye.tileID.toUnwrapped()),vi;o.isTerrainDEM||(vi=ai.getMinMaxForTile(Ye.tileID)),vi||(vi={min:ge,max:_e});let Ai=t.b2(this.rotation),Ki=[Ai[0]*t.a3,Ai[1]*t.a3,vi.max];t._.transformMat4(Ki,Ki,ti),Dt=(1-Ki[1])*this.height*.5<Ve}return Ge<Te||Dt})}return Re.sort((Te,Ve)=>Te.distanceSq-Ve.distanceSq).map(Te=>Te.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){let h=t.at(o.lat,-t.aS,t.aS),g=this.projection.project(o.lng,h);return new t.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,h){let g,v,x=this.centerPoint;if(this.projection.name==="globe"){let k=this.worldSize;g=(h.x-x.x)/k,v=(h.y-x.y)/k}else{let k=this.pointCoordinate(h),D=this.pointCoordinate(x);g=k.x-D.x,v=k.y-D.y}let S=this.locationCoordinate(o);this.setLocation(new t.Y(S.x-g,S.y-v))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,h){let g=h?t.ax(h,o.lat):void 0,v=this.projection.project(o.lng,o.lat);return new t.Y(v.x,v.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,h){let g=h??this._centerAltitude,v=[o.x,o.y,0,1],x=[o.x,o.y,1,1];t.aA.transformMat4(v,v,this.pixelMatrixInverse),t.aA.transformMat4(x,x,this.pixelMatrixInverse);let S=x[3];t.aA.scale(v,v,1/v[3]),t.aA.scale(x,x,1/S);let k=v[2],D=x[2];return{p0:v,p1:x,t:k===D?0:(g-k)/(D-k)}}screenPointToMercatorRay(o){let h=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return t.aA.transformMat4(h,h,this.pixelMatrixInverse),t.aA.transformMat4(g,g,this.pixelMatrixInverse),t.aA.scale(h,h,1/h[3]),t.aA.scale(g,g,1/g[3]),h[2]=t.ax(h[2],this._center.lat)*this.worldSize,g[2]=t.ax(g[2],this._center.lat)*this.worldSize,t.aA.scale(h,h,1/this.worldSize),t.aA.scale(g,g,1/this.worldSize),new t.aT([h[0],h[1],h[2]],t._.normalize([],t._.sub([],g,h)))}rayIntersectionCoordinate(o){let{p0:h,p1:g,t:v}=o,x=t.ax(h[2],this._center.lat),S=t.ax(g[2],this._center.lat);return new t.Y(t.a2(h[0],g[0],v)/this.worldSize,t.a2(h[1],g[1],v)/this.worldSize,t.a2(x,S,v))}pointCoordinate(o,h=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,h)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let h=this.projection.pointCoordinate3D(this,o.x,o.y);if(h)return new t.Y(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(o.y>v)return this.pointCoordinate(o);let x=.02*v,S=o.clone();for(let k=0;k<10&&v-g>x;k++){S.y=t.a2(g,v,.66);let D=this.projection.pointCoordinate3D(this,S.x,S.y);D?(v=S.y,h=D):g=S.y}return h?new t.Y(h[0],h[1],h[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=t.aU)return!this.isPointAboveHorizon(o);let h=this.pointCoordinate(o);return h.y>=0&&h.y<=1}_coordinatePoint(o,h){let g=h&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,v=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return t.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new t.P(v[0]/v[3],v[1]/v[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:o,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new t.P(h,o)),S=this.pointLocation3D(new t.P(v,o)),k=this.pointLocation3D(new t.P(v,g)),D=this.pointLocation3D(new t.P(h,g)),A=Math.min(x.lng,S.lng,k.lng,D.lng),L=Math.max(x.lng,S.lng,k.lng,D.lng),z=Math.min(x.lat,S.lat,k.lat,D.lat),U=Math.max(x.lat,S.lat,k.lat,D.lat),H=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,Z=(X,Q,re,oe,ae)=>{let _e=(X+re)/2,ge=(Q+oe)/2,ne=new t.P(_e,ge),{lng:se,lat:le}=this.pointLocation3D(ne),we=Math.max(0,A-se,z-le,se-L,le-U);A=Math.min(A,se),L=Math.max(L,se),z=Math.min(z,le),U=Math.max(U,le),(ae<Y||we>H)&&(Z(X,Q,_e,ge,ae+1),Z(_e,ge,re,oe,ae+1))};if(Z(h,o,v,o,1),Z(v,o,v,g,1),Z(v,g,h,g,1),Z(h,g,h,o,1),this.projection.name==="globe"){let[X,Q]=t.aV(this);X?(U=90,L=180,A=-180):Q&&(z=-90,L=180,A=-180)}return new t.ai(new t.aI(A,z),new t.aI(L,U))}_getBoundsRectangular(o,h){let{top:g,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,k=new t.P(v,g),D=new t.P(S,g),A=new t.P(S,x),L=new t.P(v,x),z=this.pointCoordinate(k,o),U=this.pointCoordinate(D,o),H=this.pointCoordinate(A,h),Y=this.pointCoordinate(L,h),Z=(X,Q)=>(Q.y-X.y)/(Q.x-X.x);return z.y>1&&U.y>=0?z=new t.Y((1-Y.y)/Z(Y,z)+Y.x,1):z.y<0&&U.y<=1&&(z=new t.Y(-Y.y/Z(Y,z)+Y.x,0)),U.y>1&&z.y>=0?U=new t.Y((1-H.y)/Z(H,U)+H.x,1):U.y<0&&z.y<=1&&(U=new t.Y(-H.y/Z(H,U)+H.x,0)),new t.ai().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){let o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);let h=o.visibleDemTiles.reduce((g,v)=>{if(v.dem){let x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*o.exaggeration(),h.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-t.aS,this.maxLat=t.aS,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.aj(this.minLng)*this.tileSize,this.worldMaxX=t.aj(this.maxLng)*this.tileSize,this.worldMinY=t.ak(this.maxLat)*this.tileSize,this.worldMaxY=t.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,h){return this.projection.createTileMatrix(this,h,o)}calculateDistanceTileData(o){let h=o.key,g=this._distanceTileDataCache;if(g[h])return g[h];let v=o.canonical,x=1/this.height,S=this.cameraWorldSize,k=S/this.zoomScale(v.z),D=(v.x+Math.pow(2,v.z)*o.wrap)*k,A=v.y*k,L=this.point;L.x*=S/this.worldSize,L.y*=S/this.worldSize;let z=this.angle,U=Math.sin(-z),H=-Math.cos(-z);return g[h]={bearing:[U,H],center:[(L.x-D)*x,(L.y-A)*x],scale:k/t.a3*x},g[h]}calculateFogTileMatrix(o){let h=o.key,g=this._fogTileMatrixCache;if(g[h])return g[h];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return t.ad.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(o,h=!1,g=!1){let v=o.key,x;if(x=g?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let S=this.calculatePosMatrix(o,this.worldSize),k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,t.ad.multiply(S,k,S),x[v]=new Float32Array(S),x[v]}calculatePixelsToTileUnitsMatrix(o){let h=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];let v=t.aW(o,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let o=1/this.worldSize,h=t.ad.fromScaling([],[o,o,o]);return t.ad.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let o=this._elevation;this._updateCameraState();let h=t.ax(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),x=t.ax(1,this._center.lat);g[2]/=x,v[2]/=x,t._.normalize(v,v);let S=o.raycast(g,v,o.exaggeration());if(S){let k=t._.scaleAndAdd([],g,v,S),D=new t.Y(k[0],k[1],t.ax(k[2],t.ay(k[1]))),A=(D.z+t._.length([D.x-g[0],D.y-g[1],D.z-g[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;let h=this._elevation,g=t.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),x=h.getAtPointOrZero(new t.Y(...v)),S=this.pixelsPerMeter/this.worldSize*x,k=this._minimumHeightOverTerrain(),D=v[2]-S;if(D<=k)if(D<0||o){let A=this.locationCoordinate(this._center,this._centerAltitude),L=[v[0],v[1],A.z-v[2]],z=t._.length(L);L[2]-=(k-D)/this._pixelsPerMercatorPixel;let U=t._.length(L);if(U===0)return;t._.scale(L,L,z/U*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],A.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){let U=this.center;return U.lat=t.at(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(U.lng=t.at(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}let h=this._unmodified,{x:g,y:v}=this.point,x=0,S=g,k=v,D=this.width/2,A=this.height/2,L=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(v-A<L&&(k=L+A),v+A>z&&(k=z-A),z-L<this.height&&(x=Math.max(x,this.height/(z-L)),k=(z+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let U=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,Y=this.worldSize/2-(U+H)/2;S=(g+Y+this.worldSize)%this.worldSize-Y,S-D<U&&(S=U+D),S+D>H&&(S=H-D),H-U<this.width&&(x=Math.max(x,this.width/(H-U)),S=(H+U)/2)}S===g&&k===v||(this.center=this.unproject(new t.P(S,k))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let o=this.centerOffset,h=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.ax(1,this.center.lat)/t.ax(1,t.b3));let v=t.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?g:1,S=this._camera.getWorldToCamera(this.worldSize,x),k,D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-o.x/this.width,D[9]=2*o.y/this.height,this.isOrthographic){let le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),we=le*this.aspect,Re=-we,me=-le;we-=o.x,Re-=o.x,le+=o.y,me+=o.y,k=this._camera.getCameraToClipOrthographic(Re,we,me,le,this._nearZ,this._farZ),((Le,Be,Qe,Je)=>{for(let Ze=0;Ze<16;Ze++)Le[Ze]=Sp(Be[Ze],Qe[Ze],Je)})(k,k,D,Kn(this.pitch>=15?1:this.pitch/15))}else k=D;let A=t.ad.mul([],D,S),L=t.ad.mul([],k,S);if(this.projection.isReprojectedInTileSpace){let le=this.locationCoordinate(this.center),we=t.ad.identity([]);t.ad.translate(we,we,[le.x*this.worldSize,le.y*this.worldSize,0]),t.ad.multiply(we,we,t.aY(this)),t.ad.translate(we,we,[-le.x*this.worldSize,-le.y*this.worldSize,0]),t.ad.multiply(L,L,we),t.ad.multiply(A,A,we),this.inverseAdjustmentMatrix=t.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.ad.scale([],L,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=L,this.invProjMatrix=t.ad.invert(new Float64Array(16),this.projMatrix),h){let le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);le[8]=2*-o.x/this.width,le[9]=2*o.y/this.height,this.expandedFarZProjMatrix=t.ad.mul([],le,S)}else this.expandedFarZProjMatrix=this.projMatrix;let z=t.ad.invert([],k);this.frustumCorners=t.a_.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);let U=new Float32Array(16);t.ad.identity(U),t.ad.scale(U,U,[1,-1,1]),t.ad.rotateX(U,U,this._pitch),t.ad.rotateZ(U,U,this.angle);let H=t.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.ad.clone(H);let Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-o.x/this.width,H[9]=2*(o.y+Y)/this.height,this.skyboxMatrix=t.ad.multiply(U,H,U);let Z=this.point,X=Z.x,Q=Z.y,re=this.width%2/2,oe=this.height%2/2,ae=Math.cos(this.angle),_e=Math.sin(this.angle),ge=X-Math.round(X)+ae*re+_e*oe,ne=Q-Math.round(Q)+ae*oe+_e*re,se=new Float64Array(L);if(t.ad.translate(se,se,[ge>.5?ge-1:ge,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=se,L=t.ad.create(),t.ad.scale(L,L,[this.width/2,-this.height/2,1]),t.ad.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=t.ad.create(),t.ad.scale(L,L,[1,-1,1]),t.ad.translate(L,L,[-1,-1,0]),t.ad.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=t.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,A),this._calcFogMatrices(),this._distanceTileDataCache={},L=t.ad.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.a$(this);let le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t._.transformMat4(le,le,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let o=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[o,o,h];t._.scale(x,x,v),t._.scale(g,g,-1),t._.multiply(g,g,x);let S=t.ad.create();t.ad.translate(S,S,g),t.ad.scale(S,S,x),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,h,v)}_computeCameraPosition(o){let h=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-o/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*x,v.y/this.worldSize-g[1]*x,o/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=o[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((h-g)/v,1)),this._camera.position=t._.scaleAndAdd([],this._camera.position,o,x),this._updateStateFromCamera()}_updateStateFromCamera(){let o=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=t.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.ab(this._maxPitch)),k=Math.max((o[2]-x)/Math.cos(g),S),D=this._zoomFromMercatorZ(k);t._.scaleAndAdd(o,o,h,k),this._pitch=t.at(g,t.ab(this.minPitch),t.ab(this.maxPitch)),this.angle=t.au(v,-Math.PI,Math.PI),this._setZoom(t.at(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.Y(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){let o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let h=0,g=t.aU,v=0,x=1/0;for(;g-h>1e-6&&g>h;){let S=h+.5*(g-h),k=this.tileSize*Math.pow(2,S),D=this.getCameraToCenterDistance(this.projection,S,k),A=this.scaleZoom(D/(o*this.tileSize)),L=Math.abs(S-A);L<x&&(x=L,v=S),S<A?h=S:g=S}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,h){let g=Math.min(o.x,h.x),v=Math.max(o.x,h.x),x=Math.min(o.y,h.y),S=Math.max(o.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let k=[new t.P(g,x),new t.P(v,S),new t.P(g,S),new t.P(v,x)],D=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(let L of k){let z=this.pointRayIntersection(L);if(z.t<0)return!0;let U=this.rayIntersectionCoordinate(z);if(U.x<D||U.y<0||U.x>A||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(o,h){let g=t._.length(t._.sub([],this._camera.position,o)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let o=function([h,g,v],x){let S=[h,g,v,1];t.aA.transformMat4(S,S,x);let k=S[3]=Math.max(S[3],1e-6);return S[0]/=k,S[1]/=k,S[2]/=k,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(o[0],o[1])}{let o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,o))}}getCameraToCenterDistance(o,h=this.zoom,g=this.worldSize){let v=t.aX(o,h,this.width,this.height,1024),x=o.pixelSpaceConversion(this.center.lat,g,v),S=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(S=Sp(1,S,Kn(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){let o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&t.ad.multiply(o,o,this.globeMatrix),o}getFrustum(o){return t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}let Qr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Qa=(f,o)=>{if(o>0&&f.terrain&&t.w("Cutoff is currently disabled on terrain"),o<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let h=f.transform,g=Math.max(Math.abs(h._zoom-(f.minCutoffZoom-1)),1),v=h.isLODDisabled(!1)?t.$(60,45,h.pitch):t.$(30,15,h.pitch),x=h._farZ-h._nearZ,S=o*h.height,k=((1-(D=v))*h.cameraToCenterDistance+D*(h._farZ+S))*g;var D;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(k-h._nearZ)/x,(k-S-h._nearZ)/x]}}},Or={cascadeCount:2,shadowMapResolution:2048};class Mp{constructor(o,h){this.aabb=o,this.lastCascade=h}}class kp{add(o,h){let g=this.receivers[o.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],h.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],h.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],h.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],h.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],h.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],h.max[2])):this.receivers[o.key]=new Mp(h,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,h,g){let v=t.b6.fromPoints(o.points),x=0;for(let S in this.receivers){let k=this.receivers[S];if(!k||!v.intersectsAabb(k.aabb))continue;k.aabb.min=v.closestPoint(k.aabb.min),k.aabb.max=v.closestPoint(k.aabb.max);let D=k.aabb.getCorners();for(let A=0;A<g.length;A++){let L=!0;for(let z of D){let U=[z[0]*h,z[1]*h,z[2]];if(t._.transformMat4(U,U,g[A].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){L=!1;break}}if(k.lastCascade=A,x=Math.max(x,A),L)break}}return x+1}}class gu{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new kp,this._depthMode=new t.ae(o.context.gl.LEQUAL,t.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(Or,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(Or,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,h){let g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;let v=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((Y,Z)=>{let X=g.style._mergedLayers[Z];return Y+(X.hasShadowPass()&&!X.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=g.context,S=Or.shadowMapResolution,k=Or.shadowMapResolution;if(this._cascades.length===0||Or.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<Or.cascadeCount;++Y){let Z=g._shadowMapDebug,X=x.gl,Q=x.createFramebuffer(S,k,Z,"texture"),re=new t.T(x,{width:S,height:k,data:null},X.DEPTH_COMPONENT);if(Q.depthAttachment.set(re.texture),Z){let oe=new t.T(x,{width:S,height:k,data:null},X.RGBA);Q.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:Q,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.aM,scale:0})}}this.shadowDirection=Gd(h);let D=0;if(o.elevation){let Y=o.elevation,Z=[1e4,-1e4];Y.visibleDemTiles.filter(X=>X.dem).forEach(X=>{let Q=X.dem.tree;Z[0]=Math.min(Z[0],Q.minimums[0]),Z[1]=Math.max(Z[1],Q.maximums[0])}),Z[0]!==1e4&&(D=(Z[1]-Z[0])*Y.exaggeration())}let A=1.5*o.cameraToCenterDistance,L=3*A,z=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){let Z=this._cascades[Y],X=o.height/50,Q=1;Or.cascadeCount===1?Q=L:Y===0?Q=A:(X=A,Q=L);let[re,oe]=qd(o,this.shadowDirection,X,Q,Or.shadowMapResolution,D);Z.scale=o.scale,Z.matrix=re,Z.boundingSphereRadius=oe,t.ad.invert(z,Z.matrix),Z.frustum=t.aM.fromInvProjectionMatrix(z,1,0,!0),Z.far=Q}let U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Or.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Or.shadowMapResolution,this._uniformValues.u_shadowmap_0=Qr.ShadowMap0,this._uniformValues.u_shadowmap_1=Qr.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let H=g.transform.elevation;for(let Y of this._groundShadowTiles){let Z={min:0,max:0};if(H){let X=H.getMinMaxForTile(Y);X&&(Z=X)}this.addShadowReceiver(Y.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,h){if(!this.enabled)return;let g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,Or.shadowMapResolution,Or.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){g.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:t.C.white,depth:1});for(let S of o.order){let k=o._mergedLayers[S];if(!k.hasShadowPass()||k.isHidden(g.transform.zoom))continue;let D=o.getLayerSourceCache(k),A=D?h[D.id]:void 0;(k.type==="model"||A&&A.length)&&g.renderLayer(g,D,k,A)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let o=this.painter,h=o.style,g=o.context,v=h.directionalLight,x=h.ambientLight;if(!v||!x)return;let S=[],k=Qa(o,o.longestCutoffRange);k.shouldRenderCutoff&&S.push("RENDER_CUTOFF");let D=Ka(h,v,x),A=new t.ae(g.gl.LEQUAL,t.ae.ReadOnly,o.depthRangeFor3D);for(let L of this._groundShadowTiles){let z=L.toUnwrapped(),U=o.isTileAffectedByFog(L),H=o.getOrCreateProgram("groundShadow",{defines:S,overrideFog:U});this.setupShadows(z,H),o.uploadCommonUniforms(g,H,z,null,k);let Y={u_matrix:o.transform.calculateProjMatrix(z),u_ground_shadow_factor:D};H.draw(o,g.gl.TRIANGLES,A,t.ag.disabled,t.a.multiply,t.af.disabled,Y,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,{},o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?t.a.unblended:t.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){let h=this.painter.transform,g=h.calculatePosMatrix(o,h.worldSize);return t.ad.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(o){return t.ad.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,h,g,v=0){if(!this.enabled)return;let x=this.painter.transform,S=this.painter.context,k=S.gl,D=this._uniformValues,A=new Float64Array(16),L=x.calculatePosMatrix(o,x.worldSize);for(let z=0;z<this._cascades.length;z++)t.ad.multiply(A,this._cascades[z].matrix,L),D[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),S.activeTexture.set(k.TEXTURE0+Qr.ShadowMap0+z),this._cascades[z].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){let z=t.b5(o.canonical),U=2/x.tileSize*t.a3/Or.shadowMapResolution,H=U*this._cascades[0].boundingSphereRadius,Y=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(g==="vector-tile"?1:3)/Math.pow(2,v-o.canonical.z-(1-x.zoom+Math.floor(x.zoom)));D.u_shadow_normal_offset=[z,H*Z,Y*Z],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(S,D)}setupShadowsFromMatrix(o,h,g=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,S=this._uniformValues,k=new Float64Array(16);for(let D=0;D<Or.cascadeCount;D++)t.ad.multiply(k,this._cascades[D].matrix,o),S[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),v.activeTexture.set(x.TEXTURE0+Qr.ShadowMap0+D),this._cascades[D].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(S.u_shadow_normal_offset=[1,5,5],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(v,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,h,g,v){if(v[2]>=0)return{};let x=function(D,A,L){let z=L/(1<<D.canonical.z);return new t.b6([D.canonical.x*z+D.wrap*L,D.canonical.y*z+D.wrap*L,0],[(D.canonical.x+1)*z+D.wrap*L,(D.canonical.y+1)*z+D.wrap*L,A])}(o,h,g).getCorners(),S=h/-v[2];v[0]<0?(t._.add(x[0],x[0],[v[0]*S,0,0]),t._.add(x[3],x[3],[v[0]*S,0,0])):v[0]>0&&(t._.add(x[1],x[1],[v[0]*S,0,0]),t._.add(x[2],x[2],[v[0]*S,0,0])),v[1]<0?(t._.add(x[0],x[0],[0,v[1]*S,0]),t._.add(x[1],x[1],[0,v[1]*S,0])):v[1]>0&&(t._.add(x[2],x[2],[0,v[1]*S,0]),t._.add(x[3],x[3],[0,v[1]*S,0]));let k={};return k.vertices=x,k.planes=[yc(x[1],x[0],x[4]),yc(x[2],x[1],x[5]),yc(x[3],x[2],x[6]),yc(x[0],x[3],x[7])],k}addShadowReceiver(o,h,g){this._receivers.add(o,t.b6.fromTileIdAndHeight(o,h,g))}getMaxCascadeForTile(o){let h=this._receivers.get(o);return h&&h.lastCascade?h.lastCascade:0}}function yc(f,o,h){let g=t._.sub([],h,o),v=t._.sub([],f,o),x=t._.cross([],g,v),S=t._.length(x);return S===0?[0,0,1,0]:(t._.scale(x,x,1/S),[x[0],x[1],x[2],-t._.dot(x,o)])}function Gd(f){let o=f.properties.get("direction"),h=t.ac(o.x,o.y,o.z);h[2]=t.at(h[2],0,75);let g=t.b7([h[0],h[1],h[2]]);return t._.fromValues(g.x,g.y,g.z)}function Ka(f,o,h){let g=o.properties.get("color"),v=o.properties.get("intensity"),x=o.properties.get("direction"),S=[x.x,x.y,x.z],k=h.properties.get("color"),D=h.properties.get("intensity"),A=Math.max(t._.dot([0,0,1],S),0),L=[0,0,0];t._.scale(L,k.toRenderColor(f.getLut(o.scope)).toArray01Linear().slice(0,3),D);let z=[0,0,0];return t._.scale(z,g.toRenderColor(f.getLut(h.scope)).toArray01Linear().slice(0,3),A*v),t.b8([L[0]>0?L[0]/(L[0]+z[0]):0,L[1]>0?L[1]/(L[1]+z[1]):0,L[2]>0?L[2]/(L[2]+z[2]):0])}function qd(f,o,h,g,v,x){let S=f.zoom,k=f.scale,D=f.worldSize,A=1/D,L=f.aspect,z=Math.sqrt(1+L*L)*Math.tan(.5*f.fovX),U=z*z,H=g-h,Y=g+h,Z,X;U>H/Y?(Z=g,X=g*z):(Z=.5*Y*(1+U),X=.5*Math.sqrt(H*H+2*(g*g+h*h)*U+Y*Y*U*U));let Q=f.projection.pixelsPerMeter(f.center.lat,D),re=f._camera.getCameraToWorldMercator(),oe=[0,0,-Z*A];t._.transformMat4(oe,oe,re);let ae=X*A,_e=f._edgeInsets;if(!(_e.left===0&&_e.top===0&&_e.right===0&&_e.bottom===0||_e.left===_e.right&&_e.top===_e.bottom)){let bt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?Q:1),yt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,h,g);yt[8]=2*-f.centerOffset.x/f.width,yt[9]=2*f.centerOffset.y/f.height;let kt=new Float64Array(16);t.ad.mul(kt,yt,bt);let vt=new Float64Array(16);t.ad.invert(vt,kt);let it=t.aM.fromInvProjectionMatrix(vt,D,S,!0);for(let Ge of it.points){let Dt=((ge=Ge)[0]/=k,ge[1]/=k,ge[2]=t.ax(ge[2],f._center.lat),ge);ae=Math.max(ae,t._.len(t._.subtract([],oe,Dt)))}}var ge;ae*=v/(v-1);let ne=Math.acos(o[2]),se=Math.atan2(-o[0],-o[1]),le=new Hd;le.position=oe,le.setPitchBearing(ne,se);let we=le.getWorldToCamera(D,Q),Re=ae*D,me=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*Re),Le=le.getCameraToClipOrthographic(-Re,Re,-Re,Re,me,(Re+x*Q)/o[2]),Be=new Float64Array(16);t.ad.multiply(Be,Le,we);let Qe=t._.fromValues(Math.floor(1e6*oe[0])/1e6*D,Math.floor(1e6*oe[1])/1e6*D,0),Je=.5*v,Ze=[0,0,0];t._.transformMat4(Ze,Qe,Be),t._.scale(Ze,Ze,Je);let Te=[Math.floor(Ze[0]),Math.floor(Ze[1]),Math.floor(Ze[2])],Ve=[0,0,0];t._.sub(Ve,Ze,Te),t._.scale(Ve,Ve,-1/Je);let Ye=new Float64Array(16);return t.ad.identity(Ye),t.ad.translate(Ye,Ye,Ve),t.ad.multiply(Be,Ye,Be),[Be,Re]}function _u(f,o){return f!=null&&o!=null&&!(!f.hasData()||!o.hasData())&&f.demTexture!=null&&o.demTexture!=null&&f.tileID.key!==o.tileID.key}let fl=new class{constructor(){this.operations={}}newMorphing(f,o,h,g,v){if(f in this.operations){let x=this.operations[f];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[f]={startTime:g,phase:0,duration:v,from:o,to:h,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let o=this.operations[f];return{from:o.from,to:o.to,phase:o.phase}}update(f){for(let o in this.operations){let h=this.operations[o];for(h.phase=(f-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,f)){delete this.operations[o];break}}}_nextOp(f,o){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=o,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},$d={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ip(f,o,h){if(o===0)return 0;let g=o<1&&h===514?.25/o:1;return 6*Math.pow(1.5,22-f)*Math.max(o,1)*g}function Kg(f,o){let h=1<<f.z;return!o&&(f.x===0||f.x===h-1)||f.y===0||f.y===h-1}let bu=f=>({u_matrix:f});function yu(f,o,h,g,v){if(v>0){let x=t.e.now(),S=(x-f.timeAdded)/v,k=o?(x-o.timeAdded)/v:-1,D=h.getSource(),A=g.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),L=!o||Math.abs(o.tileID.overscaledZ-A)>Math.abs(f.tileID.overscaledZ-A),z=L&&f.refreshedUponExpiration?1:t.at(L?S:1-k,0,1);return f.refreshedUponExpiration&&S>=1&&(f.refreshedUponExpiration=!1),o?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class vc extends jd{constructor(o,h,g,v){super(o,h,g,v),this.type="raster-array",this.maxzoom=22,this._options=t.W({type:"raster-array"},h)}triggerRepaint(o){let h=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);h&&h.enabled&&g&&h._clearRenderCacheForTile(g.id,o.tileID),this.map.triggerRepaint()}loadTile(o,h){let g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,t.R.Tile);o.requestParams=v,o.actor||(o.actor=this.dispatcher.getActor()),o.request=o.fetchHeader(void 0,(x,S,k,D)=>{if(delete o.request,o.aborted)return o.state="unloaded",h(null);if(x)return x.code===20?void 0:(o.state="errored",h(x));this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:k,expires:D}),o.state="empty",h(null)})}unloadTile(o,h){let g=o.texture;g&&g instanceof t.T?(o.destroy(!0),this.map.painter.saveTileTexture(g)):(o.destroy(),o.flushQueues(),o._isHeaderLoaded=!1,delete o._mrt,delete o.textureDescriptor),o.fbo&&(o.fbo.destroy(),delete o.fbo),delete o.request,delete o.requestParams,delete o.neighboringTiles,o.state="unloaded"}prepareTile(o,h,g){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBand(h,g,(v,x)=>{if(v)return o.state="errored",this.fire(new t.d(v)),void this.triggerRepaint(o);x&&(o.setTexture(x,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;let h=this.rasterLayers.find(({id:x})=>x===o),g=h&&h.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(o,h,g){if(!o)return;let v=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;h instanceof t.bk?x=h.paint.get("raster-array-band"):h instanceof t.bl&&(x=h.paint.get("raster-particle-array-band"));let S=x||this.getInitialBand(v);if(S!=null)if(o.textureDescriptor){if(!o.updateNeeded(v,S)||g)return Object.assign({},o.textureDescriptor,{texture:o.texture})}else this.prepareTile(o,v,S)}}let Rr={vector:uu,raster:jd,"raster-dem":class extends jd{constructor(f,o,h,g){super(f,o,h,g),this.type="raster-dem",this.maxzoom=22,this._options=t.W({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(f,o){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(f.state="errored",o(v)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",o(null))}f.request=t.h(this.map._requestManager.transformRequest(h,t.R.Tile),(function(v,x,S,k){if(delete f.request,f.aborted)f.state="unloaded",o(null);else if(v)f.state="errored",o(v);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:S,expires:k});let D=ImageBitmap&&x instanceof ImageBitmap&&t.bi(),A=1-(x.width-t.bj(x.width))/2;A<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let L=D?x:t.e.getImageData(x,A),z={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:A};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",z,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){let o=f.canonical,h=Math.pow(2,o.z),g=(o.x-1+h)%h,v=o.x===0?f.wrap-1:f.wrap,x=(o.x+1+h)%h,S=o.x+1===h?f.wrap+1:f.wrap,k={};return k[new t.aL(f.overscaledZ,v,o.z,g,o.y).key]={backfilled:!1},k[new t.aL(f.overscaledZ,S,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(k[new t.aL(f.overscaledZ,v,o.z,g,o.y-1).key]={backfilled:!1},k[new t.aL(f.overscaledZ,f.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},k[new t.aL(f.overscaledZ,S,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<h&&(k[new t.aL(f.overscaledZ,v,o.z,g,o.y+1).key]={backfilled:!1},k[new t.aL(f.overscaledZ,f.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},k[new t.aL(f.overscaledZ,S,o.z,x,o.y+1).key]={backfilled:!1}),k}},"raster-array":vc,geojson:class extends t.E{constructor(f,o,h,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=o.data,this._options=t.W({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let v=t.a3/this.tileSize;this.workerOptions=t.W({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*v,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*v,extent:t.a3,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:t.a3,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*v,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){return this._options.dynamic?typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection")?this.fire(new t.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...f.features):this._data=f,this._updateWorkerData(!0),this):this.fire(new t.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(f,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterChildren(f,o){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterLeaves(f,o,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:o,offset:h},g),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.f("dataloading",{dataType:"source"})),this._loaded=!1;let o=t.W({append:f},this.workerOptions);o.scope=this.scope;let h=this._data;typeof h=="string"?(o.request=this.map._requestManager.transformRequest(t.e.resolveURL(h),t.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new t.d(g));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new t.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,o){let h=f.actor?"reloadTile":"loadTile";f.actor=this.actor;let g=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g?{image:g.image.clone()}:null,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};f.request=this.actor.send(h,x,(S,k)=>v&&!k?(f.state="loaded",o(null)):(delete f.request,f.destroy(),f.aborted?o(null):S?o(S):(f.loadVectorData(k,this.map.painter,h==="reloadTile"),o(null))),void 0,h==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,o){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.bm{constructor(f,o,h,g){super(f,o,h,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let o of f.urls)this.urls.push(this.map._requestManager.transformRequest(o,t.R.Source).url);t.bn(this.urls,(o,h)=>{this._loaded=!0,o?this.fire(new t.d(o)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let o=this.video.seekable;f<o.start(0)||f>o.end(0)?this.fire(new t.d(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,o=f.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(f,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.bm,model:class extends t.E{constructor(f,o,h,g){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){let f=[];for(let o in this._options.models){let h=this._options.models[o],g=t.l(this.map._requestManager.transformRequest(h.uri,t.R.Model).url).then(v=>{if(!v)return;let x=t.c(v),S=new t.M(o,h.position,h.orientation,x);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(v=>{this.fire(new t.d(new Error(`Could not load model ${o} from ${h.uri}: ${v.message}`)))});f.push(g)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this.fire(new t.d(new Error(`Could not load models: ${o.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,o){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(f,o,h,g){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=vp(this._options,this.map._requestManager,o,h,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new t.d(g))):v&&(t.W(this,v),v.bounds&&(this.tileBounds=new Vd(v.bounds,this.minzoom,this.maxzoom)),t.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))),f&&f(g)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,o){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,t.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=o;else{if(f.buckets){let x=Object.values(f.buckets);for(let S of x)S.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",g,v.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(x,S){return f.aborted?o(null):x&&x.status!==404?o(x):(S&&(S.resourceTiming&&(f.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(S),f.buckets=Ji(Ji({},f.buckets),S.buckets),S.featureIndex&&(f.latestFeatureIndex=S.featureIndex)),f.state="loaded",void o(null))}}serialize(){return t.W({},this._options)}},canvas:class extends t.bm{constructor(f,o,h,g){super(f,o,h,g),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new t.d(new t.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.d(new t.V(`sources.${f}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new t.d(new t.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new t.d(new t.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.d(new t.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof t.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends t.E{constructor(f,o,h,g){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Vd(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),t.W(this,t.ah(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new t.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:o,y:h,z:g}=f.canonical;return this._implementation.hasTile({x:o,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,o){let{x:h,y:g,z:v}=f.tileID.canonical,x=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:x.signal})).then((function(S){return delete f.request,f.aborted?(f.state="unloaded",o(null)):S===void 0?(f.state="errored",o(null)):S===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",o(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(S)?(this.loadTileData(f,S),f.state="loaded",void o(null)):(f.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(f.state="errored",o(S))}),f.request.cancel=()=>x.abort()}loadTileData(f,o){f.setTexture(o,this._map.painter)}unloadTile(f,o){if(f.texture&&f.texture instanceof t.T?(f.destroy(!0),f.texture&&f.texture instanceof t.T&&this._map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){let{x:h,y:g,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}o&&o()}abortTile(f,o){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){let f=t.al(this.id,this.scope);this._map.style.clearSource(f)}_update(){this.fire(new t.f("data",{dataType:"source",sourceDataType:"content"}))}}},vu=function(f,o,h,g){let v=new Rr[o.type](f,o,h,g);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return t.bp(["load","abort","unload","serialize","prepare"],v),v};class Tp extends t.bv{constructor(o){let h={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new t.bw(t.bx(),null),v=vu("mock-dem",h,g,o.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,h){o.state="loaded",h(null)}}class Jg extends t.bv{constructor(o){let h=vu("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new t.bw(t.bx(),null),o.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,h,g){if(o.freezeTileCoverage)return;this.transform=o;let v=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,S)=>{if(x[S.key]="",!this._tiles[S.key]){let k=new t.by(S,this._source.tileSize*S.overscaleFactor(),o.tileZoom);k.state="loaded",this._tiles[S.key]=k}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(o){let h=this.proxyCachedFBO[o];if(h!==void 0){let g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ep extends t.aL{constructor(o,h,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class Dp extends t.bq{constructor(o,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[g,v,x]=function(D){let A=new t.bt,L=new t.bu,z=131;A.reserve(17161),L.reserve(33800);let U=t.a3/128,H=t.a3+U/2,Y=H+U;for(let X=-U;X<Y;X+=U)for(let Q=-U;Q<Y;Q+=U){let re=Q<0||Q>H||X<0||X>H?24575:0,oe=t.at(Math.round(Q),0,t.a3),ae=t.at(Math.round(X),0,t.a3);A.emplaceBack(oe+re,ae)}let Z=(X,Q)=>{let re=Q*z+X;L.emplaceBack(re+1,re,re+z),L.emplaceBack(re+z,re+z+1,re+1)};for(let X=1;X<129;X++)for(let Q=1;Q<129;Q++)Z(Q,X);return[0,129].forEach(X=>{for(let Q=0;Q<130;Q++)Z(Q,X),Z(X,Q)}),[A,L,32768]}(),S=o.context;this.gridBuffer=S.createVertexBuffer(g,t.br.members),this.gridIndexBuffer=S.createIndexBuffer(v),this.gridSegments=t.b.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=t.b.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Jg(h.map),this.orthoMatrix=t.ad.create(),t.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,t.a3,0,t.a3,0,1);let k=S.gl;this._overlapStencilMode=new t.ag({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Tp(h.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,h,g){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);let v=o.terrain.properties,x=o.terrain.drapeRenderMode===0,S=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.e.now();let k=o.terrain&&o.terrain.scope,D=v.get("source"),A=x?this._mockSourceCache:o.getSourceCache(D,k);if(!A)return void t.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=A,this._exaggeration=S?this.calculateExaggeration(h):v.get("exaggeration"),!h.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;let L=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let z=this.getScaledDemTileSize();this.sourceCache.update(h,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(o){let h=this._previousCameraAltitude,g=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=g;let v=h!=null?g-h:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=o.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(x);let k=x-this._previousZoom,D=this._previousUpdateTimestamp,A=x;this._evaluationZoom!=null&&(A=this._evaluationZoom,Math.abs(x-A)>.5&&(k=.5*(x-A+k)),k*v<0&&(A+=k)),this._evaluationZoom=A;let L=S.getExaggeration(A),z=L===S.getExaggeration(Math.max(0,A-.1));if(z&&Math.abs(L-this._exaggeration)<.01)return L;let U=Math.min(.1,.00375*(this._updateTimestamp-D));return(z||L<.1||Math.abs(k)<1e-4)&&(U=Math.min(.2,4*U)),t.a2(this._exaggeration,L,U)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(t.Y.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=h.getIds().map(D=>{let A=h.getTileByID(D).tileID;return A.projMatrix=g.calculateProjMatrix(A.toUnwrapped()),A});(function(D,A){let L=A.transform.pointCoordinate(A.transform.getCameraPoint()),z=new t.P(L.x,L.y);D.sort((U,H)=>{if(H.overscaledZ-U.overscaledZ)return H.overscaledZ-U.overscaledZ;let Y=new t.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Z=new t.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),X=z.mult(1<<U.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(Y)-X.distSqr(Z)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};let S=this._style._mergedSourceCaches;for(let D in S){let A=S[D];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,o[D],x),A.usedForTerrain))continue;let L=o[D];A.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[h.id]=v.map(D=>new Ep(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let k={};this._visibleDemTiles=[];for(let D of this.proxyCoords){let A=this.terrainTileForTile[D.key];if(!A)continue;let L=A.tileID.key;L in k||(this._visibleDemTiles.push(A),k[L]=L)}}_assignTerrainTiles(o){this._initializing||o.forEach(h=>{if(this.terrainTileForTile[h.key])return;let g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){let o=this.painter.context,h=o.gl;for(let g in this.terrainTileForTile){let v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(o.activeTexture.set(h.TEXTURE1),yp(this.painter,v,x))}}_prepareDemTileUniforms(o,h,g,v){if(!h||h.demTexture==null)return!1;let x=o.tileID.canonical,S=Math.pow(2,h.tileID.canonical.z-x.z),k=v||"";return g[`u_dem_tl${k}`]=[x.x*S%1,x.y*S%1],g[`u_dem_scale${k}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let o=this.painter.context,h=o.gl;if(!this._emptyDepthBufferTexture){let g=new t.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.T(o,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0,h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;let x=v.dem.tree.minimums[0];return x>0&&o++,g+x},0);return o?h/o:0}_updateEmptyDEMTexture(){let o=this.painter.context,h=o.gl;o.activeTexture.set(h.TEXTURE2);let g=this._getLoadedAreaMinimum(),[v,x]=(()=>{let k=new t.bz({width:1,height:1},new Float32Array([g]));return[h.R32F,k]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new t.T(o,x,v,{premultiply:!1}),S}setupElevationDraw(o,h,g){let v=this.painter.context,x=v.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};S.u_exaggeration=this.exaggeration();let k=null,D=null,A=1;if(g&&g.morphing&&this._useVertexMorphing){let H=g.morphing.srcDemTile,Y=g.morphing.dstDemTile;A=g.morphing.phase,H&&Y&&(this._prepareDemTileUniforms(o,H,S,"_prev")&&(D=H),this._prepareDemTileUniforms(o,Y,S)&&(k=Y))}let L=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,z=null;var U;if(this.enabled?D&&k?(z=k.demTexture,v.activeTexture.set(x.TEXTURE4),D.demTexture.bind(L(D),x.CLAMP_TO_EDGE),S.u_dem_lerp=A):(k=this.terrainTileForTile[o.tileID.key],z=this._prepareDemTileUniforms(o,k,S)?k.demTexture:this.emptyDEMTexture):z=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),z&&(S.u_dem_size=(U=z).size[0]===1?1:U.size[0]-2,z.bind(L(k),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&k){let H=(1<<k.tileID.canonical.z)*t.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=H}if(g&&g.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,S),this.painter.transform.projection.name==="globe"){let H=this.globeUniformValues(this.painter.transform,o.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,H)}}globeUniformValues(o,h,g){let v=o.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,t.a3,0),u_tile_br_up:v.upVector(h,t.a3,t.a3),u_tile_bl_up:v.upVector(h,0,t.a3),u_tile_up_scale:g?t.bs(1):v.upVectorScale(h,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){let h=this.painter,g=this.painter.context;o.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,S,k,D){if(v.transform.projection.name==="globe")(function(A,L,z,U,H){let Y=A.context,Z=Y.gl,X,Q,re=A.transform,oe=t.ba(A,Y,re),ae=(Le,Be)=>{if(Q===Be)return;let Qe=[$d[Be],"PROJECTION_GLOBE_VIEW"];oe&&Qe.push("CUSTOM_ANTIALIASING");let Je=A.isTileAffectedByFog(Le);X=A.getOrCreateProgram("globeRaster",{defines:Qe,overrideFog:Je}),Q=Be},_e=A.colorModeForRenderPass(),ge=new t.ae(Z.LEQUAL,t.ae.ReadWrite,A.depthRangeFor3D);fl.update(H);let ne=t.bb(re),se=[t.aj(re.center.lng),t.ak(re.center.lat)],le=A.globeSharedBuffers,we=[re.width*t.e.devicePixelRatio,re.height*t.e.devicePixelRatio],Re=Float32Array.from(re.globeMatrix),me={useDenormalizedUpVectorScale:!0};{let Le=A.transform,Be=Ip(Le.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Q=-1;let Qe=Z.TRIANGLES;for(let Je of U){let Ze=z.getTile(Je),Te=t.ag.disabled,Ve=L.prevTerrainTileForTile[Je.key],Ye=L.terrainTileForTile[Je.key];_u(Ve,Ye)&&fl.newMorphing(Je.key,Ve,Ye,H,250),Y.activeTexture.set(Z.TEXTURE0),Ze.texture&&Ze.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let bt=fl.getMorphValuesForProxy(Je.key),yt=bt?1:0;bt&&t.o(me,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:t.b9(bt.phase)}});let kt=t.bc(Je.canonical),vt=t.bd(kt.getCenter().lat),it=t.be(Je.canonical,kt,vt,Le.worldSize/Le._pixelsPerMercatorPixel),Ge=t.bf(t.bg(Je.canonical)),Dt=Xg(Le.expandedFarZProjMatrix,Re,ne,Ge,t.a1(Le.zoom),se,Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.globeCenterInViewSpace,Le.globeRadius,we,Be,Le._farZ,it);if(ae(Je,yt),X&&(L.setupElevationDraw(Ze,X,me),A.uploadCommonUniforms(Y,X,Je.toUnwrapped()),le)){let[ai,ti,vi]=le.getGridBuffers(vt,Be!==0);X.draw(A,Qe,ge,Te,_e,t.af.backCCW,Dt,"globe_raster",ai,ti,vi)}}}if(le&&(A.renderDefaultNorthPole||A.renderDefaultSouthPole)){let Le=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Le.push("CUSTOM_ANTIALIASING"),X=A.getOrCreateProgram("globeRaster",{defines:Le});for(let Be of U){let{x:Qe,y:Je,z:Ze}=Be.canonical,Te=Je===0,Ve=Je===(1<<Ze)-1,[Ye,bt,yt,kt]=le.getPoleBuffers(Ze,!1);if(kt&&(Te||Ve)){let vt=z.getTile(Be);Y.activeTexture.set(Z.TEXTURE0),vt.texture&&vt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let it=t.bh(Ze,Qe,re),Ge=t.bf(t.bg(Be.canonical)),Dt=(ai,ti)=>ai.draw(A,Z.TRIANGLES,ge,t.ag.disabled,_e,t.af.disabled,Xg(re.expandedFarZProjMatrix,it,it,Ge,0,se,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,we,0,re._farZ),"globe_pole_raster",ti,yt,kt);L.setupElevationDraw(vt,X,me),A.uploadCommonUniforms(Y,X,Be.toUnwrapped()),Te&&A.renderDefaultNorthPole&&Dt(X,Ye),Ve&&A.renderDefaultSouthPole&&(it=t.ad.scale(t.ad.create(),it,[1,-1,1]),Dt(X,bt))}}}})(v,x,S,k,D);else{let A=v.context,L=A.gl,z,U,H=v.shadowRenderer,Y=Qa(v,v.longestCutoffRange),Z=_e=>{if(U===_e)return;let ge=[];ge.push($d[_e]),Y.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),z=v.getOrCreateProgram("terrainRaster",{defines:ge}),U=_e},X=v.colorModeForRenderPass(),Q=new t.ae(L.LEQUAL,t.ae.ReadWrite,v.depthRangeFor3D);fl.update(D);let re=v.transform,oe=Ip(re.zoom,x.exaggeration(),x.sourceCache._source.tileSize),ae=[0,0,0];if(H){let _e=v.style.directionalLight,ge=v.style.ambientLight;_e&&ge&&(ae=Ka(v.style,_e,ge))}{U=-1;let _e=L.TRIANGLES,[ge,ne]=[x.gridIndexBuffer,x.gridSegments];for(let se of k){let le=S.getTile(se),we=t.ag.disabled,Re=x.prevTerrainTileForTile[se.key],me=x.terrainTileForTile[se.key];_u(Re,me)&&fl.newMorphing(se.key,Re,me,D,250),A.activeTexture.set(L.TEXTURE0),le.texture&&le.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);let Le=fl.getMorphValuesForProxy(se.key),Be=Le?1:0,Qe;Le&&(Qe={morphing:{srcDemTile:Le.from,dstDemTile:Le.to,phase:t.b9(Le.phase)}});let Je=xt(se.projMatrix,Kg(se.canonical,re.renderWorldCopies)?oe/10:oe,ae);if(Z(Be),!z)continue;x.setupElevationDraw(le,z,Qe);let Ze=se.toUnwrapped();H&&H.setupShadows(Ze,z),v.uploadCommonUniforms(A,z,Ze,null,Y),z.draw(v,_e,Q,we,X,t.af.backCCW,Je,"terrain_raster",x.gridBuffer,ge,ne)}}}}(h,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;let h=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],S=this._drapedRenderBatches.shift(),k=h.style.order,D=[],A=0;for(let L of x){let z=v.getTileByID(L.proxyTileKey),U=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][o]:void 0,H=U!==void 0?v.renderCache[U]:this.pool[A++],Y=U!==void 0;if(z.texture=H.tex,Y&&!H.dirty){D.push(z.tileID);continue}let Z;g.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(g.clear({color:t.C.transparent,stencil:0}),H.dirty=!1);for(let X=S.start;X<=S.end;++X){let Q=h.style._mergedLayers[k[X]];if(Q.isHidden(h.transform.zoom))continue;let re=h.style.getLayerSourceCache(Q),oe=re?this.proxyToSource[L.key][re.id]:[L];if(!oe)continue;let ae=oe;g.viewport.set([0,0,H.fb.width,H.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(H,oe,Q,re),Z=re?re.id:null),h.renderLayer(h,re,Q,ae)}if(this._drapedRenderBatches.length===0)for(let X of this._pendingGroundEffectLayers){let Q=h.style._mergedLayers[k[X]];if(Q.isHidden(h.transform.zoom))continue;let re=h.style.getLayerSourceCache(Q),oe=re?this.proxyToSource[L.key][re.id]:[L];if(!oe)continue;let ae=oe;g.viewport.set([0,0,H.fb.width,H.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(H,oe,Q,re),Z=re?re.id:null),h.renderLayer(h,re,Q,ae)}this.renderedToTile?(H.dirty=!0,D.push(z.tileID)):Y||--A,A===5&&(A=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),S.end+1}postRender(){}isLayerOrderingCorrect(o){let h=o.order.length,g=-1,v=h;for(let x=0;x<h;++x)this._style.isLayerDraped(o._mergedLayers[o.order[x]])?g=Math.max(g,x):v=Math.min(v,x);return v>g}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{o=Math.min(o,h.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,h,g){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let S=x.tileID,k=1<<S.overscaledZ,{x:D,y:A}=S.canonical,L=D/k,z=(D+1)/k,U=A/k,H=(A+1)/k;return{minx:L,miny:U,maxx:z,maxy:H,t:x.dem.tree.raycastRoot(L,U,z,H,o,h,g),tile:x}});v.sort((x,S)=>(x.t!==null?x.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let S=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,o,h,g);if(S!=null)return S}return null}_createFBO(){let o=this.painter.context,h=o.gl,g=this.drapeBufferSize;o.activeTexture.set(h.TEXTURE0);let v=new t.T(o,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);let x=o.createFramebuffer(g[0],g[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new sl(o,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{let h=this._style._mergedLayers[o],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(let g of this._style.getSources())if(g instanceof uu){o=!0;break}if(!o)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(x&&!h[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof t.Z){h[x.id]=!0;for(let S of this.proxyCoords){let k=this.proxyToSource[S.key][x.id];if(k)for(let D of k)this._clearRenderCacheForTile(x.id,D)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(let g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof jd){o=!0;break}if(!o)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(!x||h[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let S=v.paint.get("raster-fade-duration");for(let k of this.proxyCoords){let D=this.proxyToSource[k.key][x.id];if(D)for(let A of D){let L=yu(x.getTile(A),x.findLoadedParent(A,0),x,this.painter.transform,S);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(x.id,A)}}}}_setupDrapedRenderBatches(){let o=this._style.order,h=o.length;if(h===0)return;let g=[];this._pendingGroundEffectLayers=[];let v,x=0,S=this._style._mergedLayers[o[x]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++x<h;)S=this._style._mergedLayers[o[x]];for(;x<h;++x){let k=this._style._mergedLayers[o[x]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?v===void 0&&(v=x):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(g.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:x-1}),g.length!==0){let k=g[g.length-1];this._pendingGroundEffectLayers.every(D=>D>k.end)||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(o){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let S=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let k=0;k<S.length;++k){let D=Object.values(S[k]);h.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();let g=this.proxyCoords,v=this._tilesDirty;for(let S=g.length-1;S>=0;S--){let k=g[S];if(h.getTileByID(k.key),h.proxyCachedFBO[k.key]!==void 0){let D=o[k.key],A=this.proxyToSource[k.key],L=0;for(let z in A){let U=A[z],H=D[z];if(!H||H.length!==U.length||U.some((Y,Z)=>Y!==H[Z]||v[z]&&v[z].hasOwnProperty(Y.key))){L=-1;break}++L}for(let z in h.proxyCachedFBO[k.key])h.renderCache[h.proxyCachedFBO[k.key][z]].dirty=L<0||L!==Object.values(D).length}}let x=[...this._drapedRenderBatches];x.sort((S,k)=>k.end-k.start-(S.end-S.start));for(let S of x)for(let k of g){if(h.proxyCachedFBO[k.key])continue;let D=h.renderCachePool.pop();D===void 0&&h.renderCache.length<50&&(D=h.renderCache.length,h.renderCache.push(this._createFBO())),D!==void 0&&(h.proxyCachedFBO[k.key]={},h.proxyCachedFBO[k.key][S.start]=D,h.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(o,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,S=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let k;if(g.isTileClipped())k=h.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):t.ag.disabled}_renderTileClippingMasks(o,h){let g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(t.a.disabled),v.setDepthMode(t.ae.disabled);let S=g.getOrCreateProgram("clippingMask");for(let k of o){let D=g._tileClippingMaskIDs[k.key]=--h;S.draw(g,x.TRIANGLES,t.ae.disabled,new t.ag({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),t.a.disabled,t.af.disabled,bu(k.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){let h=this.painter.transform;if(o.x<0||o.x>h.width||o.y<0||o.y>h.height)return null;let g=[o.x,o.y,1,1];t.aA.transformMat4(g,g,h.pixelMatrixInverse),t.aA.scale(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;let v=h._camera.position,x=t.ax(1,h.center.lat),S=[v[0],v[1],v[2]/x,0],k=t._.subtract([],g.slice(0,3),S);t._.normalize(k,k);let D=this.raycast(S,k,this._exaggeration);return D!==null&&D?(t._.scaleAndAdd(S,S,k,D),S[3]=S[2],S[2]*=x,S):null}drawDepth(){let o=this.painter,h=o.context,g=this.proxySourceCache,v=Math.ceil(o.width),x=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let S=h.gl,k=h.createFramebuffer(v,x,!0,"renderbuffer");h.activeTexture.set(S.TEXTURE0);let D=new t.T(h,{width:v,height:x,data:null},S.RGBA);D.bind(S.NEAREST,S.CLAMP_TO_EDGE),k.colorAttachment.set(D.texture);let A=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,x);k.depthAttachment.set(A),this._depthFBO=k,this._depthTexture=D}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,x]),function(S,k,D,A){if(S.transform.projection.name==="globe")return;let L=S.context,z=L.gl;L.clear({depth:1});let U=S.getOrCreateProgram("terrainDepth"),H=new t.ae(z.LESS,t.ae.ReadWrite,S.depthRangeFor3D);for(let Y of A){let Z=D.getTile(Y),X=xt(Y.projMatrix,0,[0,0,0]);k.setupElevationDraw(Z,U),U.draw(S,z.TRIANGLES,H,t.ag.disabled,t.a.unblended,t.af.backCCW,X,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,h,g){if(o.getSource()instanceof t.bm)return this._setupProxiedCoordsForImageSource(o,h,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};let v=this.proxiedCoords[o.id]=[],x=this.proxyCoords;for(let D=0;D<x.length;D++){let A=x[D],L=this._findTileCoveringTileID(A,o);if(L){let z=this._createProxiedId(A,L,g[A.key]&&g[A.key][o.id]);v.push(z),this.proxyToSource[A.key][o.id]=[z]}}let S=!1,k=new Set;for(let D=0;D<h.length;D++){let A=o.getTile(h[D]);if(!A||!A.hasData())continue;let L=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==A.tileID.canonical.z){let z=this.proxyToSource[L.tileID.key][o.id],U=this._createProxiedId(L.tileID,A,g[L.tileID.key]&&g[L.tileID.key][o.id]);z?z.splice(z.length-1,0,U):this.proxyToSource[L.tileID.key][o.id]=[U];let H=this.proxyToSource[L.tileID.key][o.id];k.has(H)||k.add(H),v.push(U),S=!0}}if(this._sourceTilesOverlap[o.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(let D of k)D.sort((A,L)=>L.overscaledZ-A.overscaledZ)}_setupProxiedCoordsForImageSource(o,h,g){if(!o.getSource().loaded())return;let v=this.proxiedCoords[o.id]=[],x=this.proxyCoords,S=o.getSource(),k=S.tileID;if(!k)return;let D=new t.P(k.x,k.y)._div(1<<k.z),A=S.coordinates.map(t.Y.fromLngLat).reduce((z,U)=>(z.min.x=Math.min(z.min.x,U.x-D.x),z.min.y=Math.min(z.min.y,U.y-D.y),z.max.x=Math.max(z.max.x,U.x-D.x),z.max.y=Math.max(z.max.y,U.y-D.y),z),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(z,U)=>{let H=z.wrap+z.canonical.x/(1<<z.canonical.z),Y=z.canonical.y/(1<<z.canonical.z),Z=t.a3/(1<<z.canonical.z),X=U.wrap+U.canonical.x/(1<<U.canonical.z),Q=U.canonical.y/(1<<U.canonical.z);return H+Z<X+A.min.x||H>X+A.max.x||Y+Z<Q+A.min.y||Y>Q+A.max.y};for(let z=0;z<x.length;z++){let U=x[z];for(let H=0;H<h.length;H++){let Y=o.getTile(h[H]);if(!Y||!Y.hasData()||L(U,Y.tileID))continue;let Z=this._createProxiedId(U,Y,g[U.key]&&g[U.key][o.id]),X=this.proxyToSource[U.key][o.id];X?X.push(Z):this.proxyToSource[U.key][o.id]=[Z],v.push(Z)}}}_createProxiedId(o,h,g){let v=this.orthoMatrix;if(g){let x=g.find(S=>S.key===h.tileID.key);if(x)return x}if(h.tileID.key!==o.key){let x=o.canonical.z-h.tileID.canonical.z,S,k,D;v=t.ad.create();let A=h.tileID.wrap-o.wrap<<o.overscaledZ;x>0?(S=t.a3>>x,k=S*((h.tileID.canonical.x<<x)-o.canonical.x+A),D=S*((h.tileID.canonical.y<<x)-o.canonical.y)):(S=t.a3<<-x,k=t.a3*(h.tileID.canonical.x-(o.canonical.x+A<<-x)),D=t.a3*(h.tileID.canonical.y-(o.canonical.y<<-x))),t.ad.ortho(v,0,S,0,S,0,1),t.ad.translate(v,v,[k,D,0])}return new Ep(h.tileID,o.key,v)}_findTileCoveringTileID(o,h){let g=h.getTile(o);if(g&&g.hasData())return g;let v=this._findCoveringTileCache[h.id],x=v[o.key];if(g=x?h.getTileByID(x):null,g&&g.hasData()||x===null)return g;let S=g?g.tileID:o,k=S.overscaledZ,D=h.getSource().minzoom,A=[];if(!x){let z=h.getSource().maxzoom;if(o.canonical.z>=z){let U=o.canonical.z-z;h.getSource().reparseOverscaled?(k=Math.max(o.canonical.z+2,h.transform.tileZoom),S=new t.aL(k,o.wrap,z,o.canonical.x>>U,o.canonical.y>>U)):U!==0&&(k=z,S=new t.aL(k,o.wrap,z,o.canonical.x>>U,o.canonical.y>>U))}S.key!==o.key&&(A.push(S.key),g=h.getTile(S))}let L=z=>{A.forEach(U=>{v[U]=z}),A.length=0};for(k-=1;k>=D&&(!g||!g.hasData());k--){g&&L(g.tileID.key);let z=S.calculateScaledKey(k);if(g=h.getTileByID(z),g&&g.hasData())break;let U=v[z];if(U===null)break;U===void 0?A.push(z):g=h.getTileByID(U)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,h){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[h.key]=!0}}function Ja(f,o,h){let g=function(k,D,A){let L=t._.dot(D,k),z=t._.dot(A,[.2126,.7152,.0722]),U=(Y,Z,X)=>(1-X)*Y+X*Z,H=U(1-.3*Math.min(z,1),1,Math.min(L+1,1));return U(.92,1,Math.asin(t.at(D[2],-1,1))/Math.PI+.5)*H}(f,[0,0,1],o),v=[0,0,0];t._.scale(v,h.slice(0,3),g);let x=[0,0,0];t._.scale(x,o.slice(0,3),f[2]);let S=[0,0,0];return t._.add(S,v,x),t.b8(S)}let xu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],e_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Yd{static cacheKey(o,h,g,v){let x=`${h}${v?v.cacheKey:""}`;for(let S of g)o.usedDefines.includes(S)&&(x+=`/${S}`);return x}constructor(o,h,g,v,x,S){let k=o.gl;this.program=k.createProgram(),this.configuration=v,this.name=h,this.fixedDefines=[...S];let D=v?v.getBinderAttributes():[],A=(g.staticAttributes||[]).concat(D),L=v?v.defines():[];L=L.concat(S.map(X=>`#define ${X}`));let z=`#version 300 es
`,U=z+L.concat("precision mediump float;",Yg,$g.fragmentSource).join(`
`);for(let X of g.fragmentIncludes)U+=`
${du[X]}`;U+=`
${g.fragmentSource}`;let H=z+L.concat("precision highp float;",Yg,$g.vertexSource).join(`
`);for(let X of g.vertexIncludes)H+=`
${du[X]}`;H+=`
${g.vertexSource}`;let Y=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(Y,U),k.compileShader(Y),k.attachShader(this.program,Y);let Z=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(Z,H),k.compileShader(Z),k.attachShader(this.program,Z),this.attributes={},this.numAttributes=A.length;for(let X=0;X<this.numAttributes;X++)if(A[X]){let Q=A[X].startsWith("a_")?A[X]:`a_${A[X]}`;k.bindAttribLocation(this.program,X,Q),this.attributes[Q]=X}k.linkProgram(this.program),k.deleteShader(Z),k.deleteShader(Y),this.fixedUniforms=x(o),this.binderUniforms=v?v.getUniforms(o):[],S.includes("TERRAIN")&&(this.terrainUniforms=(X=>({u_dem:new t.a7(X),u_dem_prev:new t.a7(X),u_dem_tl:new t.a8(X),u_dem_scale:new t.aa(X),u_dem_tl_prev:new t.a8(X),u_dem_scale_prev:new t.aa(X),u_dem_size:new t.aa(X),u_dem_lerp:new t.aa(X),u_exaggeration:new t.aa(X),u_depth:new t.a7(X),u_depth_size_inv:new t.a8(X),u_meter_to_dem:new t.aa(X),u_label_plane_matrix_inv:new t.a6(X)}))(o)),S.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new t.aq(X),u_tile_tr_up:new t.aq(X),u_tile_br_up:new t.aq(X),u_tile_bl_up:new t.aq(X),u_tile_up_scale:new t.aa(X)}))(o)),S.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new t.a6(X),u_fog_range:new t.a8(X),u_fog_color:new t.as(X),u_fog_horizon_blend:new t.aa(X),u_fog_vertical_limit:new t.a8(X),u_fog_temporal_offset:new t.aa(X),u_frustum_tl:new t.aq(X),u_frustum_tr:new t.aq(X),u_frustum_br:new t.aq(X),u_frustum_bl:new t.aq(X),u_globe_pos:new t.aq(X),u_globe_radius:new t.aa(X),u_globe_transition:new t.aa(X),u_is_globe:new t.a7(X),u_viewport:new t.a8(X)}))(o)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new t.as(X)}))(o)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new t.aq(X),u_lighting_directional_dir:new t.aq(X),u_lighting_directional_color:new t.aq(X),u_ground_radiance:new t.aq(X)}))(o)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new t.a6(X),u_light_matrix_1:new t.a6(X),u_fade_range:new t.a8(X),u_shadow_normal_offset:new t.aq(X),u_shadow_intensity:new t.aa(X),u_shadow_texel_size:new t.aa(X),u_shadow_map_resolution:new t.aa(X),u_shadow_direction:new t.aq(X),u_shadow_bias:new t.aq(X),u_shadowmap_0:new t.a7(X),u_shadowmap_1:new t.a7(X)}))(o))}}setTerrainUniformValues(o,h){if(!this.terrainUniforms)return;let g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(o,h){if(!this.globeUniforms)return;let g=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(o,h){if(!this.fogUniforms)return;let g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setCutoffUniformValues(o,h){if(!this.cutoffUniforms)return;let g=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setLightsUniformValues(o,h){if(!this.lightsUniforms)return;let g=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setShadowUniformValues(o,h){if(this.failedToCreate||!this.shadowUniforms)return;let g=this.shadowUniforms;o.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}_drawDebugWireframe(o,h,g,v,x,S,k,D,A,L){let z=o.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;let U=o.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||o._terrain&&o._terrain.renderingToTexture||!xu.includes(this.name))||!(!z.layers3D||!e_.includes(this.name))))return;let H=U.gl,Y=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,x,U);if(!Y)return;let Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");let X=o.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});U.program.set(X.program);let Q=(ae,_e,ge)=>{if(_e[ae]&&ge[ae])for(let ne in _e[ae])ge[ae][ne]&&ge[ae][ne].set(ge.program,ne,_e[ae][ne].current)};A&&A.setUniforms(X.program,U,X.binderUniforms,k,{zoom:D}),Q("fixedUniforms",this,X),Q("terrainUniforms",this,X),Q("globeUniforms",this,X),Q("fogUniforms",this,X),Q("lightsUniforms",this,X),Q("shadowUniforms",this,X),Y.bind(),U.setColorMode(new t.a([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],t.C.transparent,[!0,!0,!0,!1])),U.setDepthMode(new t.ae(h.func===H.LESS?H.LEQUAL:h.func,t.ae.ReadOnly,h.range)),U.setStencilMode(t.ag.disabled);let re=3*S.primitiveLength*2,oe=3*S.primitiveOffset*2*2;L&&L>1?H.drawElementsInstanced(H.LINES,re,H.UNSIGNED_SHORT,oe,L):H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,oe),x.bind(),U.program.set(this.program),U.setDepthMode(h),U.setStencilMode(g),U.setColorMode(v)}draw(o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X){let Q=o.context,re=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(g),Q.setStencilMode(v),Q.setColorMode(x),Q.setCullFace(S);for(let _e of Object.keys(this.fixedUniforms))this.fixedUniforms[_e].set(this.program,_e,k[_e]);Y&&Y.setUniforms(this.program,Q,this.binderUniforms,U,{zoom:H});let oe={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[h],ae=X&&X>0?1:void 0;for(let _e of z.get()){let ge=_e.vaos||(_e.vaos={});(ge[D]||(ge[D]=new Iy)).bind(Q,this,A,Y?Y.getPaintVertexBuffers():[],L,_e.vertexOffset,Z||[],ae),X&&X>1?re.drawElementsInstanced(h,_e.primitiveLength*oe,re.UNSIGNED_SHORT,_e.primitiveOffset*oe*2,X):L?re.drawElements(h,_e.primitiveLength*oe,re.UNSIGNED_SHORT,_e.primitiveOffset*oe*2):re.drawArrays(h,_e.vertexOffset,_e.vertexLength),h===re.TRIANGLES&&L&&this._drawDebugWireframe(o,g,v,x,L,_e,U,H,Y,X)}}}function wu(f,o){let h=Math.pow(2,o.tileID.overscaledZ),g=o.tileSize*Math.pow(2,f.transform.tileZoom)/h,v=g*(o.tileID.canonical.x+o.tileID.wrap*h),x=g*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.bB(o,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let Cu=t.ad.create(),xc=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z)=>{let X=o.style.light,Q=X.properties.get("position"),re=[Q.x,Q.y,Q.z],oe=t.bC.create();X.properties.get("anchor")==="viewport"&&(t.bC.fromRotation(oe,-o.transform.angle),t._.transformMat3(re,re,oe));let ae=X.properties.get("color"),_e=o.transform,ge={u_matrix:f,u_lightpos:re,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:z,u_vertical_scale:U,u_flood_light_intensity:H,u_ground_shadow_factor:Y,u_emissive_strength:Z};return _e.projection.name==="globe"&&(ge.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],ge.u_zoom_transition=D,ge.u_inv_rot_matrix=L,ge.u_merc_center=A,ge.u_up_dir=_e.projection.upVector(new t.aO(0,0,0),A[0]*t.a3,A[1]*t.a3),ge.u_height_lift=k),ge},wc=(f,o,h)=>({u_matrix:f,u_edge_radius:o,u_vertical_scale:h}),Ap=(f,o,h,g,v,x,S,k,D,A,L,z,U,H)=>{let Y=xc(f,o,h,g,v,x,S,D,A,L,z,U,H,1,[0,0,0],0),Z={u_height_factor:-Math.pow(2,S.overscaledZ)/k.tileSize/8};return t.W(Y,wu(o,k),Z)},Pp=(f,o)=>({u_matrix:f,u_emissive_strength:o}),Op=(f,o,h,g)=>t.W(Pp(f,o),wu(h,g)),t_=(f,o,h)=>({u_matrix:f,u_world:h,u_emissive_strength:o}),Su=(f,o,h,g,v)=>t.W(Op(f,o,h,g),{u_world:v}),Rp=(f,o,h,g)=>{let v=t.a3/h.tileSize;return{u_matrix:f,u_camera_to_center_distance:o.getCameraToCenterDistance(g),u_extrude_scale:[o.pixelsToGLUnits[0]/v,o.pixelsToGLUnits[1]/v]}},Mu=(f,o,h=1)=>({u_matrix:f,u_color:o.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),Zd=t.ad.create(),gl=(f,o,h,g,v,x,S)=>{let k=f.transform,D=k.projection.name==="globe",A=D?t.bD(k.zoom,o.canonical)*k._pixelsPerMercatorPixel:t.bB(h,1,x),L={u_matrix:o.projMatrix,u_extrude_scale:A,u_intensity:S,u_inv_rot_matrix:Zd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){L.u_inv_rot_matrix=g,L.u_merc_center=v,L.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],L.u_zoom_transition=t.a1(k.zoom);let z=v[0]*t.a3,U=v[1]*t.a3;L.u_up_dir=k.projection.upVector(new t.aO(0,0,0),z,U)}return L};function i_(f,[o,h,g,v],[x,S]){if(x===S)return[0,0,0,0];let k=255*(f-1)/(f*(S-x));return[o*k,h*k,g*k,v*k]}function Lp(f,o,[h,g]){return h===g?0:.5/f+(o-h)*(f-1)/(f*(g-h))}let Xd=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q,re,oe,ae)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:t.bE(z.paint.get("raster-saturation")),u_contrast_factor:t.bF(z.paint.get("raster-contrast")),u_spin_weights:Qd(z.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:H,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:D,u_colorization_mix:i_(t.bG,Z,Q),u_colorization_offset:Lp(t.bG,X,Q),u_color_ramp:Y,u_texture_offset:[oe/(re+2*oe),re/(re+2*oe)],u_texture_res:[re+2*oe,re+2*oe],u_emissive_strength:ae});function Qd(f){f*=Math.PI/180;let o=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}let Ps=.15,Fp=(f,o,h,g,v,x,S,k,D,A,L,z)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:D}),zp=(f,o,h,g,v,x,S,k,D,A)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_tile_offset:h,u_velocity:g,u_color_ramp:x,u_velocity_res:v,u_max_speed:S,u_uv_offset:k,u_data_scale:D,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Ps,Ps]}),Ay=(f,o,h,g,v,x,S,k,D,A)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_velocity:h,u_velocity_res:g,u_max_speed:v,u_speed_factor:x,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:D,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Ps,Ps]}),ca=t.ad.create(),Cc=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q)=>{let re=v.transform,oe={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:re.getCameraToCenterDistance(Z),u_rotate_symbol:+h,u_aspect_ratio:re.width/re.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+D,u_pitch_with_map:+g,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ca,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ca,u_up_vector:[0,-1,0],u_color_adj_mat:X,u_icon_transition:Q||0};return Z.name==="globe"&&(oe.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],oe.u_zoom_transition=z,oe.u_inv_rot_matrix=H,oe.u_merc_center=U,oe.u_camera_forward=re._camera.forward(),oe.u_ecef_origin=t.bH(re.globeMatrix,L.toUnwrapped()),oe.u_tile_matrix=Float32Array.from(re.globeMatrix),oe.u_up_vector=Y),oe},ku=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X)=>t.W(Cc(f,o,h,g,v,x,S,k,D,A,z,U,H,Y,Z,X),{u_gamma_scale:g?v.transform.getCameraToCenterDistance(X)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:t.e.devicePixelRatio,u_is_halo:+L,undefined:void 0}),n_=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z)=>t.W(ku(f,o,h,g,v,x,S,k,!0,D,!0,L,z,U,H,Y,Z),{u_texsize_icon:A,u_texture_icon:1}),Kd=(f,o,h,g)=>({u_matrix:f,u_emissive_strength:o,u_opacity:h,u_color:g}),r_=(f,o,h,g,v,x,S,k)=>t.W(function(D,A,L,z,U){let{width:H,height:Y}=z.imageManager.getPixelSize(A),Z=Math.pow(2,U.tileID.overscaledZ),X=U.tileSize*Math.pow(2,z.transform.tileZoom)/Z,Q=X*(U.tileID.canonical.x+U.tileID.wrap*Z),re=X*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[H,Y],u_pattern_size:L.displaySize,u_tile_units_to_pixels:1/t.bB(U,1,z.transform.tileZoom),u_pixel_coord_upper:[Q>>16,re>>16],u_pixel_coord_lower:[65535&Q,65535&re]}}(0,x,S,g,k),{u_matrix:f,u_emissive_strength:o,u_opacity:h}),Bp=new Float32Array(t.ad.identity([])),Jd=(f,o,h,g,v,x,S,k,D,A,L,z,U,H=[0,0,0],Y)=>{let Z=v.style.light,X=Z.properties.get("position"),Q=[-X.x,-X.y,X.z],re=t.bC.create();Z.properties.get("anchor")==="viewport"&&(t.bC.fromRotation(re,-v.transform.angle),t._.transformMat3(Q,Q,re));let oe=L.alphaMode==="MASK",ae=Z.properties.get("color").toRenderColor(null),_e=U.paint.get("model-ambient-occlusion-intensity"),ge=U.paint.get("model-color").constantOr(t.C.white).toRenderColor(null),ne=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:o,u_normal_matrix:h,u_node_matrix:g||Bp,u_lightpos:Q,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_camera_pos:H,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+oe,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:D,u_roughnessFactor:A,u_baseColorTexture:Qr.BaseColor,u_metallicRoughnessTexture:Qr.MetallicRoughness,u_normalTexture:Qr.Normal,u_occlusionTexture:Qr.Occlusion,u_emissionTexture:Qr.Emission,u_lutTexture:Qr.LUT,u_color_mix:[ge.r,ge.g,ge.b,ne],u_aoIntensity:_e,u_emissive_strength:z,u_occlusionTextureTransform:Y||[0,0,0,0]}},o_=(f,o=Bp,h=Bp)=>({u_matrix:f,u_instance:o,u_node_matrix:h}),a_=(f,o,h,g,v)=>({u_matrix:Float32Array.from(f),u_anchorPos:o,u_screenSizePx:h,u_occluderSizePx:g,u_color:v}),Py={fillExtrusion:f=>({u_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_vertical_gradient:new t.aa(f),u_opacity:new t.aa(f),u_edge_radius:new t.aa(f),u_ao:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_up_dir:new t.aq(f),u_height_lift:new t.aa(f),u_flood_light_color:new t.aq(f),u_vertical_scale:new t.aa(f),u_flood_light_intensity:new t.aa(f),u_ground_shadow_factor:new t.aq(f),u_emissive_strength:new t.aa(f)}),fillExtrusionDepth:f=>({u_matrix:new t.a6(f),u_edge_radius:new t.aa(f),u_vertical_scale:new t.aa(f)}),fillExtrusionPattern:f=>({u_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_vertical_gradient:new t.aa(f),u_height_factor:new t.aa(f),u_edge_radius:new t.aa(f),u_ao:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_up_dir:new t.aq(f),u_height_lift:new t.aa(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f),u_opacity:new t.aa(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new t.a6(f),u_opacity:new t.aa(f),u_ao_pass:new t.aa(f),u_meter_to_tile:new t.aa(f),u_ao:new t.a8(f),u_flood_light_intensity:new t.aa(f),u_flood_light_color:new t.aq(f),u_attenuation:new t.aa(f),u_edge_radius:new t.aa(f),u_fb:new t.a7(f),u_fb_size:new t.aa(f)}),fill:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f)}),fillPattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),fillOutline:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_world:new t.a8(f)}),fillOutlinePattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_world:new t.a8(f),u_image:new t.a7(f),u_texsize:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),circle:t.bI,collisionBox:f=>({u_matrix:new t.a6(f),u_camera_to_center_distance:new t.aa(f),u_extrude_scale:new t.a8(f)}),collisionCircle:f=>({u_matrix:new t.a6(f),u_inv_matrix:new t.a6(f),u_camera_to_center_distance:new t.aa(f),u_viewport_size:new t.a8(f)}),debug:f=>({u_color:new t.a9(f),u_matrix:new t.a6(f),u_overlay:new t.a7(f),u_overlay_scale:new t.aa(f)}),clippingMask:f=>({u_matrix:new t.a6(f)}),heatmap:f=>({u_extrude_scale:new t.aa(f),u_intensity:new t.aa(f),u_matrix:new t.a6(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_up_dir:new t.aq(f)}),heatmapTexture:f=>({u_image:new t.a7(f),u_color_ramp:new t.a7(f),u_opacity:new t.aa(f)}),hillshade:f=>({u_matrix:new t.a6(f),u_image:new t.a7(f),u_latrange:new t.a8(f),u_light:new t.a8(f),u_shadow:new t.a9(f),u_highlight:new t.a9(f),u_emissive_strength:new t.aa(f),u_accent:new t.a9(f)}),hillshadePrepare:f=>({u_matrix:new t.a6(f),u_image:new t.a7(f),u_dimension:new t.a8(f),u_zoom:new t.aa(f)}),line:t.bJ,linePattern:t.bK,raster:f=>({u_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_grid_matrix:new t.ar(f),u_tl_parent:new t.a8(f),u_scale_parent:new t.aa(f),u_fade_t:new t.aa(f),u_opacity:new t.aa(f),u_image0:new t.a7(f),u_image1:new t.a7(f),u_brightness_low:new t.aa(f),u_brightness_high:new t.aa(f),u_saturation_factor:new t.aa(f),u_contrast_factor:new t.aa(f),u_spin_weights:new t.aq(f),u_perspective_transform:new t.a8(f),u_raster_elevation:new t.aa(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_cutoff_params:new t.as(f),u_colorization_mix:new t.as(f),u_colorization_offset:new t.aa(f),u_color_ramp:new t.a7(f),u_texture_offset:new t.a8(f),u_texture_res:new t.a8(f),u_emissive_strength:new t.aa(f)}),rasterParticle:f=>({u_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_grid_matrix:new t.ar(f),u_tl_parent:new t.a8(f),u_scale_parent:new t.aa(f),u_fade_t:new t.aa(f),u_opacity:new t.aa(f),u_image0:new t.a7(f),u_image1:new t.a7(f),u_raster_elevation:new t.aa(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_cutoff_params:new t.as(f)}),rasterParticleTexture:f=>({u_texture:new t.a7(f),u_opacity:new t.aa(f)}),rasterParticleDraw:f=>({u_particle_texture:new t.a7(f),u_particle_texture_side_len:new t.aa(f),u_tile_offset:new t.a8(f),u_velocity:new t.a7(f),u_color_ramp:new t.a7(f),u_velocity_res:new t.a8(f),u_max_speed:new t.aa(f),u_uv_offset:new t.a8(f),u_data_scale:new t.as(f),u_data_offset:new t.aa(f),u_particle_pos_scale:new t.aa(f),u_particle_pos_offset:new t.a8(f)}),rasterParticleUpdate:f=>({u_particle_texture:new t.a7(f),u_particle_texture_side_len:new t.aa(f),u_velocity:new t.a7(f),u_velocity_res:new t.a8(f),u_max_speed:new t.aa(f),u_speed_factor:new t.aa(f),u_reset_rate:new t.aa(f),u_rand_seed:new t.aa(f),u_uv_offset:new t.a8(f),u_data_scale:new t.as(f),u_data_offset:new t.aa(f),u_particle_pos_scale:new t.aa(f),u_particle_pos_offset:new t.a8(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_camera_forward:new t.aq(f),u_tile_matrix:new t.a6(f),u_up_vector:new t.aq(f),u_ecef_origin:new t.aq(f),u_texture:new t.a7(f),u_icon_transition:new t.aa(f),u_color_adj_mat:new t.a6(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_texture:new t.a7(f),u_gamma_scale:new t.aa(f),u_device_pixel_ratio:new t.aa(f),u_tile_id:new t.aq(f),u_zoom_transition:new t.aa(f),u_inv_rot_matrix:new t.a6(f),u_merc_center:new t.a8(f),u_camera_forward:new t.aq(f),u_tile_matrix:new t.a6(f),u_up_vector:new t.aq(f),u_ecef_origin:new t.aq(f),u_is_halo:new t.a7(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new t.a7(f),u_is_size_feature_constant:new t.a7(f),u_size_t:new t.aa(f),u_size:new t.aa(f),u_camera_to_center_distance:new t.aa(f),u_rotate_symbol:new t.a7(f),u_aspect_ratio:new t.aa(f),u_fade_change:new t.aa(f),u_matrix:new t.a6(f),u_label_plane_matrix:new t.a6(f),u_coord_matrix:new t.a6(f),u_is_text:new t.a7(f),u_pitch_with_map:new t.a7(f),u_texsize:new t.a8(f),u_texsize_icon:new t.a8(f),u_texture:new t.a7(f),u_texture_icon:new t.a7(f),u_gamma_scale:new t.aa(f),u_device_pixel_ratio:new t.aa(f),u_is_halo:new t.a7(f)}),background:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_opacity:new t.aa(f),u_color:new t.a9(f)}),backgroundPattern:f=>({u_matrix:new t.a6(f),u_emissive_strength:new t.aa(f),u_opacity:new t.aa(f),u_image:new t.a7(f),u_pattern_tl:new t.a8(f),u_pattern_br:new t.a8(f),u_texsize:new t.a8(f),u_pattern_size:new t.a8(f),u_pixel_coord_upper:new t.a8(f),u_pixel_coord_lower:new t.a8(f),u_tile_units_to_pixels:new t.aa(f)}),terrainRaster:hl,terrainDepth:hl,skybox:f=>({u_matrix:new t.a6(f),u_sun_direction:new t.aq(f),u_cubemap:new t.a7(f),u_opacity:new t.aa(f),u_temporal_offset:new t.aa(f)}),skyboxGradient:f=>({u_matrix:new t.a6(f),u_color_ramp:new t.a7(f),u_center_direction:new t.aq(f),u_radius:new t.aa(f),u_opacity:new t.aa(f),u_temporal_offset:new t.aa(f)}),skyboxCapture:f=>({u_matrix_3f:new t.ar(f),u_sun_direction:new t.aq(f),u_sun_intensity:new t.aa(f),u_color_tint_r:new t.as(f),u_color_tint_m:new t.as(f),u_luminance:new t.aa(f)}),globeRaster:f=>({u_proj_matrix:new t.a6(f),u_globe_matrix:new t.a6(f),u_normalize_matrix:new t.a6(f),u_merc_matrix:new t.a6(f),u_zoom_transition:new t.aa(f),u_merc_center:new t.a8(f),u_image0:new t.a7(f),u_grid_matrix:new t.ar(f),u_skirt_height:new t.aa(f),u_far_z_cutoff:new t.aa(f),u_frustum_tl:new t.aq(f),u_frustum_tr:new t.aq(f),u_frustum_br:new t.aq(f),u_frustum_bl:new t.aq(f),u_globe_pos:new t.aq(f),u_globe_radius:new t.aa(f),u_viewport:new t.a8(f)}),globeAtmosphere:f=>({u_frustum_tl:new t.aq(f),u_frustum_tr:new t.aq(f),u_frustum_br:new t.aq(f),u_frustum_bl:new t.aq(f),u_horizon:new t.aa(f),u_transition:new t.aa(f),u_fadeout_range:new t.aa(f),u_color:new t.as(f),u_high_color:new t.as(f),u_space_color:new t.as(f),u_temporal_offset:new t.aa(f),u_horizon_angle:new t.aa(f)}),model:f=>({u_matrix:new t.a6(f),u_lighting_matrix:new t.a6(f),u_normal_matrix:new t.a6(f),u_node_matrix:new t.a6(f),u_lightpos:new t.aq(f),u_lightintensity:new t.aa(f),u_lightcolor:new t.aq(f),u_camera_pos:new t.aq(f),u_opacity:new t.aa(f),u_baseColorFactor:new t.as(f),u_emissiveFactor:new t.as(f),u_metallicFactor:new t.aa(f),u_roughnessFactor:new t.aa(f),u_baseTextureIsAlpha:new t.a7(f),u_alphaMask:new t.a7(f),u_alphaCutoff:new t.aa(f),u_baseColorTexture:new t.a7(f),u_metallicRoughnessTexture:new t.a7(f),u_normalTexture:new t.a7(f),u_occlusionTexture:new t.a7(f),u_emissionTexture:new t.a7(f),u_lutTexture:new t.a7(f),u_color_mix:new t.as(f),u_aoIntensity:new t.aa(f),u_emissive_strength:new t.aa(f),u_occlusionTextureTransform:new t.as(f)}),modelDepth:f=>({u_matrix:new t.a6(f),u_instance:new t.a6(f),u_node_matrix:new t.a6(f)}),groundShadow:f=>({u_matrix:new t.a6(f),u_ground_shadow_factor:new t.aq(f)}),stars:f=>({u_matrix:new t.a6(f),u_up:new t.aq(f),u_right:new t.aq(f),u_intensity_multiplier:new t.aa(f)}),occlusion:f=>({u_matrix:new t.a6(f),u_anchorPos:new t.aq(f),u_screenSizePx:new t.a8(f),u_occluderSizePx:new t.a8(f),u_color:new t.as(f)})};function Iu(f,o,h){let g=o.createTileMatrix(f,f.worldSize,h.toUnwrapped());return t.ad.multiply(new Float32Array(16),f.projMatrix,g)}function Oy(f,o,h){if(o.projection.name===h.projection.name)return f.projMatrix;let g=h.clone();return g.setProjection(o.projection),Iu(g,o.getProjection(),f)}function Sc(f,o,h){return o.name===h.projection.name?f.projMatrix:Iu(h,o,f)}let Tu;function eh(f,o,h,g,v,x,S){let k=f.context,D=k.gl,A=f.transform,L=f.getOrCreateProgram("collisionBox"),z=[],U=0,H=0;for(let ae=0;ae<g.length;ae++){let _e=g[ae],ge=o.getTile(_e),ne=ge.getBucket(h);if(!ne)continue;let se=Oy(_e,ne,A),le=se;v[0]===0&&v[1]===0||(le=f.translatePosMatrix(se,ge,v,x));let we=S?ne.textCollisionBox:ne.iconCollisionBox,Re=ne.collisionCircleArray;if(Re.length>0){let me=t.ad.create(),Le=le;t.ad.mul(me,ne.placementInvProjMatrix,A.glCoordMatrix),t.ad.mul(me,me,ne.placementViewportMatrix),z.push({circleArray:Re,circleOffset:H,transform:Le,invTransform:me,projection:ne.getProjection()}),U+=Re.length/4,H=U}we&&(f.terrain&&f.terrain.setupElevationDraw(ge,L),L.draw(f,D.LINES,t.ae.disabled,t.ag.disabled,f.colorModeForRenderPass(),t.af.disabled,Rp(le,A,ge,ne.getProjection()),h.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,A.zoom,null,[we.collisionVertexBuffer,we.collisionVertexBufferExt]))}if(!S||!z.length)return;let Y=f.getOrCreateProgram("collisionCircle"),Z=new t.bL;Z.resize(4*U),Z._trim();let X=0;for(let ae of z)for(let _e=0;_e<ae.circleArray.length/4;_e++){let ge=4*_e,ne=ae.circleArray[ge+0],se=ae.circleArray[ge+1],le=ae.circleArray[ge+2],we=ae.circleArray[ge+3];Z.emplace(X++,ne,se,le,we,0),Z.emplace(X++,ne,se,le,we,1),Z.emplace(X++,ne,se,le,we,2),Z.emplace(X++,ne,se,le,we,3)}(!Tu||Tu.length<2*U)&&(Tu=function(ae){let _e=2*ae,ge=new t.bu;ge.resize(_e),ge._trim();for(let ne=0;ne<_e;ne++){let se=6*ne;ge.uint16[se+0]=4*ne+0,ge.uint16[se+1]=4*ne+1,ge.uint16[se+2]=4*ne+2,ge.uint16[se+3]=4*ne+2,ge.uint16[se+4]=4*ne+3,ge.uint16[se+5]=4*ne+0}return ge}(U));let Q=k.createIndexBuffer(Tu,!0),re=k.createVertexBuffer(Z,t.bM.members,!0);for(let ae of z){let _e={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(oe=A).getCameraToCenterDistance(ae.projection),u_viewport_size:[oe.width,oe.height]};Y.draw(f,D.TRIANGLES,t.ae.disabled,t.ag.disabled,f.colorModeForRenderPass(),t.af.disabled,_e,h.id,re,Q,t.b.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,A.zoom)}var oe;re.destroy(),Q.destroy()}let _l=t.ad.create();function s_(f){let o=f._camera.getWorldToCamera(f.worldSize,1),h=t.ad.multiply([],o,f.globeMatrix);t.ad.invert(h,h);let g=[0,0,0],v=[0,1,0,0];return t.aA.transformMat4(v,v,h),g[0]=v[0],g[1]=v[1],g[2]=v[2],t._.normalize(g,g),g}function Ry({width:f,height:o,anchor:h,textOffset:g,textScale:v},x){let{horizontalAlign:S,verticalAlign:k}=t.bQ(h),D=-(S-.5)*f,A=-(k-.5)*o,L=t.bP(h,g);return new t.P((D/v+L[0])*x,(A/v+L[1])*x)}function l_(f,o,h,g,v,x,S,k,D,A,L){let z=f.text.placedSymbolArray,U=f.text.dynamicLayoutVertexArray,H=f.icon.dynamicLayoutVertexArray,Y={},Z=f.getProjection(),X=Sc(k,Z,x),Q=x.elevation,re=Z.upVectorScale(k.canonical,x.center.lat,x.worldSize).metersToTile;U.clear();for(let oe=0;oe<z.length;oe++){let ae=z.get(oe),{tileAnchorX:_e,tileAnchorY:ge,numGlyphs:ne}=ae,se=ae.hidden||!ae.crossTileID||f.allowVerticalPlacement&&!ae.placedOrientation?null:g[ae.crossTileID];if(se){let le=0,we=0,Re=0;if(Q){let Ye=Q?Q.getAtTileOffset(k,_e,ge):0,[bt,yt,kt]=Z.upVector(k.canonical,_e,ge);le=Ye*bt*re,we=Ye*yt*re,Re=Ye*kt*re}let[me,Le,Be,Qe]=jo(ae.projectedAnchorX+le,ae.projectedAnchorY+we,ae.projectedAnchorZ+Re,h?X:S),Je=qr(x.getCameraToCenterDistance(Z),Qe),Ze=v.evaluateSizeForFeature(f.textSizeData,A,ae)*Je/t.bN;h&&(Ze*=f.tilePixelRatio/D);let Te=Ry(se,Ze);h?({x:me,y:Le,z:Be}=Z.projectTilePoint(_e+Te.x,ge+Te.y,k.canonical),[me,Le,Be]=jo(me+le,Le+we,Be+Re,S)):(o&&Te._rotate(-x.angle),me+=Te.x,Le+=Te.y,Be=0);let Ve=f.allowVerticalPlacement&&ae.placedOrientation===t.aE.vertical?Math.PI/2:0;for(let Ye=0;Ye<ne;Ye++)t.aH(U,me,Le,Be,Ve);L&&ae.associatedIconIndex>=0&&(Y[ae.associatedIconIndex]={x:me,y:Le,z:Be,angle:Ve})}else pl(ne,U)}if(L){H.clear();let oe=f.icon.placedSymbolArray;for(let ae=0;ae<oe.length;ae++){let _e=oe.get(ae),{numGlyphs:ge}=_e,ne=Y[ae];if(_e.hidden||!ne)pl(ge,H);else{let{x:se,y:le,z:we,angle:Re}=ne;for(let me=0;me<ge;me++)t.aH(H,se,le,we,Re)}}f.icon.dynamicLayoutVertexBuffer.updateData(H)}f.text.dynamicLayoutVertexBuffer.updateData(U)}function Np(f,o,h,g,v,x,S={}){let k=h.paint.get("icon-translate"),D=h.paint.get("text-translate"),A=h.paint.get("icon-translate-anchor"),L=h.paint.get("text-translate-anchor"),z=h.layout.get("icon-rotation-alignment"),U=h.layout.get("text-rotation-alignment"),H=h.layout.get("icon-pitch-alignment"),Y=h.layout.get("text-pitch-alignment"),Z=h.layout.get("icon-keep-upright"),X=h.layout.get("text-keep-upright"),Q=h.paint.get("icon-color-saturation"),re=h.paint.get("icon-color-contrast"),oe=h.paint.get("icon-color-brightness-min"),ae=h.paint.get("icon-color-brightness-max"),_e=h.paint.get("icon-occlusion-opacity").constantOr(0),ge=h.paint.get("text-occlusion-opacity").constantOr(0),ne=f.context,se=ne.gl,le=f.transform,we=z==="map",Re=U==="map",me=H==="map",Le=Y==="map",Be=_e!==1,Qe=ge!==1,Je=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ze=!1,Te=f.depthModeForSublayer(0,t.ae.ReadOnly),Ve=[t.aj(le.center.lng),t.ak(le.center.lat)],Ye=h.layout.get("text-variable-anchor"),bt=le.projection.name==="globe",yt=[],kt=[0,-1,0];for(let vt of g){let it=o.getTile(vt),Ge=it.getBucket(h);if(!Ge||Ge.projection.name==="mercator"&&bt||Ge.fullyClipped)continue;let Dt=Ge.projection.name==="globe",ai=Dt?t.a1(le.zoom):0,ti=Sc(vt,Ge.getProjection(),le),vi=le.calculatePixelsToTileUnitsMatrix(it),Ai=Ye&&Ge.hasTextData(),Ki=Ge.hasIconTextFit()&&Ai&&Ge.hasIconData(),Kt=Ge.getProjection().createInversionMatrix(le,vt.canonical),Gi=()=>{let Ke=we&&h.layout.get("symbol-placement")!=="point",St=[];h.hasInitialOcclusionOpacityProperties&&Be&&f.symbolParams.useOcclusionQueries&&!Dt&&!bt&&St.push("OCCLUSION_QUERIES"),h.hasInitialOcclusionOpacityProperties||St.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");let An=Ke||Ki,qi=h.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&me&&St.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(St.push("PROJECTION_GLOBE_VIEW"),An&&St.push("PROJECTED_POS_ON_VIEWPORT")),qi>0&&St.push("ICON_TRANSITION"),Ge.icon.zOffsetVertexBuffer&&St.push("Z_OFFSET"),Q===0&&re===0&&oe===0&&ae===1||St.push("COLOR_ADJUSTMENT");let Oe=Ge.icon.programConfigurations.get(h.id),Oo=f.getOrCreateProgram(Ge.sdfIcons?"symbolSDF":"symbolIcon",{config:Oe,defines:St}),Fr,Jr=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],wr=Ge.iconSizeData,ho=t.aD(wr,le.zoom),fa=me||le.pitch!==0,Ro=ul(ti,it.tileID.canonical,me,we,le,Ge.getProjection(),vi),Vs=_c(ti,it.tileID.canonical,me,we,le,Ge.getProjection(),vi),js=f.translatePosMatrix(Vs,it,k,A,!0),is=f.translatePosMatrix(ti,it,k,A),La=An?_l:Ro,ns=we&&!me&&!Ke,zc=kt;!bt&&!le.mercatorFromTransition||we||(zc=s_(le));let Bc=Dt?zc:kt;if(Ge.sdfIcons&&!Ge.iconsInText)Fr=ku(wr.kind,ho,ns,me,f,is,La,js,!1,Jr,!0,vt,ai,Ve,Kt,Bc,Ge.getProjection());else{let gr=h.getColorAdjustmentMatrix(Q,re,oe,ae);Fr=Cc(wr.kind,ho,ns,me,f,is,La,js,!1,Jr,vt,ai,Ve,Kt,Bc,Ge.getProjection(),gr,qi)}let Tl=it.imageAtlasTexture?it.imageAtlasTexture:null,Nc=h.layout.get("icon-size").constantOr(0)!==1||Ge.iconsNeedLinear,Zu=Ge.sdfIcons||f.options.rotating||f.options.zooming||Nc||fa?se.LINEAR:se.NEAREST,Xu=Ge.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,bf=f.terrain&&me&&Ke?t.ad.invert(t.ad.create(),Ro):_l;if(Ke&&Ge.icon){let gr=le.elevation,yf=gr?gr.getAtTileOffsetFunc(vt,le.center.lat,le.worldSize,Ge.getProjection()):null,Vc=ml(ti,it.tileID.canonical,me,we,le,Ge.getProjection(),vi);mu(Ge,ti,f,!1,Vc,Vs,me,Z,yf,vt)}return{program:Oo,buffers:Ge.icon,uniformValues:Fr,atlasTexture:Tl,atlasTextureIcon:null,atlasInterpolation:Zu,atlasInterpolationIcon:null,isSDF:Ge.sdfIcons,hasHalo:Xu,tile:it,labelPlaneMatrixInv:bf}},hn=()=>{let Ke=Re&&h.layout.get("symbol-placement")!=="point",St=[],An=Ke||Ye||Ki;h.hasInitialOcclusionOpacityProperties&&Qe&&f.symbolParams.useOcclusionQueries&&!Dt&&!bt&&St.push("OCCLUSION_QUERIES"),h.hasInitialOcclusionOpacityProperties||St.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),f.terrainRenderModeElevated()&&Le&&St.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(St.push("PROJECTION_GLOBE_VIEW"),An&&St.push("PROJECTED_POS_ON_VIEWPORT")),Ge.text.zOffsetVertexBuffer&&St.push("Z_OFFSET");let qi=Ge.text.programConfigurations.get(h.id),Oe=f.getOrCreateProgram(Ge.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:qi,defines:St}),Oo,Fr=[0,0],Jr=null,wr=Ge.textSizeData;Ge.iconsInText&&(Fr=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],Jr=it.imageAtlasTexture?it.imageAtlasTexture:null,Oo=Le||le.pitch!==0||f.options.rotating||f.options.zooming||wr.kind==="composite"||wr.kind==="camera"?se.LINEAR:se.NEAREST);let ho=it.glyphAtlasTexture?it.glyphAtlasTexture.size:[0,0],fa=t.aD(wr,le.zoom),Ro=ul(ti,it.tileID.canonical,Le,Re,le,Ge.getProjection(),vi),Vs=_c(ti,it.tileID.canonical,Le,Re,le,Ge.getProjection(),vi),js=f.translatePosMatrix(Vs,it,D,L,!0),is=f.translatePosMatrix(ti,it,D,L),La=An?_l:Ro,ns=Re&&!Le&&!Ke,zc=kt;!bt&&!le.mercatorFromTransition||Re||(zc=s_(le));let Bc=Dt?zc:kt,Tl;Tl=Ge.iconsInText?n_(wr.kind,fa,ns,Le,f,is,La,js,ho,Fr,vt,ai,Ve,Kt,Bc,Ge.getProjection()):ku(wr.kind,fa,ns,Le,f,is,La,js,!0,ho,!0,vt,ai,Ve,Kt,Bc,Ge.getProjection());let Nc=it.glyphAtlasTexture?it.glyphAtlasTexture:null,Zu=se.LINEAR,Xu=h.paint.get("text-halo-width").constantOr(1)!==0,bf=f.terrain&&Le&&Ke?t.ad.invert(t.ad.create(),Ro):_l;if(Ke&&Ge.text){let gr=le.elevation,yf=gr?gr.getAtTileOffsetFunc(vt,le.center.lat,le.worldSize,Ge.getProjection()):null,Vc=ml(ti,it.tileID.canonical,Le,Re,le,Ge.getProjection(),vi);mu(Ge,ti,f,!0,Vc,Vs,Le,X,yf,vt)}return{program:Oe,buffers:Ge.text,uniformValues:Tl,atlasTexture:Nc,atlasTextureIcon:Jr,atlasInterpolation:Zu,atlasInterpolationIcon:Oo,isSDF:!0,hasHalo:Xu,tile:it,labelPlaneMatrixInv:bf}},Xi=Ge.icon.segments.get().length,Ci=Ge.text.segments.get().length,ni=Xi&&!S.onlyText?Gi():null,gn=Ci&&!S.onlyIcons?hn():null,xn=h.paint.get("icon-opacity").constantOr(1),nn=h.paint.get("text-opacity").constantOr(1);if(Je&&Ge.canOverlap){Ze=!0;let Ke=xn&&!S.onlyText?Ge.icon.segments.get():[],St=nn&&!S.onlyIcons?Ge.text.segments.get():[];for(let An of Ke)yt.push({segments:new t.b([An]),sortKey:An.sortKey,state:ni});for(let An of St)yt.push({segments:new t.b([An]),sortKey:An.sortKey,state:gn})}else S.onlyText||yt.push({segments:xn?Ge.icon.segments:new t.b([]),sortKey:0,state:ni}),S.onlyIcons||yt.push({segments:nn?Ge.text.segments:new t.b([]),sortKey:0,state:gn})}Ze&&yt.sort((vt,it)=>vt.sortKey-it.sortKey);for(let vt of yt){let it=vt.state;if(it)if(f.terrain&&f.terrain.setupElevationDraw(it.tile,it.program,{useDepthForOcclusion:!h.hasInitialOcclusionOpacityProperties&&le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:it.labelPlaneMatrixInv}),ne.activeTexture.set(se.TEXTURE0),it.atlasTexture&&it.atlasTexture.bind(it.atlasInterpolation,se.CLAMP_TO_EDGE,!0),it.atlasTextureIcon&&(ne.activeTexture.set(se.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,se.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,it.program),it.hasHalo){let Ge=it.uniformValues;Ge.u_is_halo=1,Mc(it.buffers,vt.segments,h,f,it.program,Te,v,x,Ge,2),Ge.u_is_halo=0}else{if(it.isSDF){let Ge=it.uniformValues;it.hasHalo&&(Ge.u_is_halo=1,Mc(it.buffers,vt.segments,h,f,it.program,Te,v,x,Ge,1)),Ge.u_is_halo=0}Mc(it.buffers,vt.segments,h,f,it.program,Te,v,x,it.uniformValues,1)}}}function Mc(f,o,h,g,v,x,S,k,D,A){let L=g.context.gl,z=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];f.occlusionQueryOpacityVertexBuffer.length>0&&z.push(f.occlusionQueryOpacityVertexBuffer),v.draw(g,L.TRIANGLES,x,S,k,t.af.disabled,D,h.id,f.layoutVertexBuffer,f.indexBuffer,o,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),z,A)}function Vp(f,o,h,g,v,x,S){let k=f.context.gl,D=h.paint.get("fill-pattern"),A=D&&D.constantOr(1),L,z,U,H,Y;S?(z=A&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=k.LINES):(z=A?"fillPattern":"fill",L=k.TRIANGLES);for(let Z of g){let X=o.getTile(Z);if(A&&!X.patternsLoaded())continue;let Q=X.getBucket(h);if(!Q)continue;f.prepareDrawTile();let re=Q.programConfigurations.get(h.id),oe=f.isTileAffectedByFog(Z),ae=f.getOrCreateProgram(z,{config:re,overrideFog:oe});A&&(f.context.activeTexture.set(k.TEXTURE0),X.imageAtlasTexture&&X.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),re.updatePaintBuffers());let _e=D.constantOr(null);if(_e&&X.imageAtlas){let se=X.imageAtlas.patternPositions[_e.toString()];se&&re.setConstantPatternPositions(se)}let ge=f.translatePosMatrix(Z.projMatrix,X,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),ne=h.paint.get("fill-emissive-strength");if(S){H=Q.indexBuffer2,Y=Q.segments2;let se=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];U=z==="fillOutlinePattern"&&A?Su(ge,ne,f,X,se):t_(ge,ne,se)}else H=Q.indexBuffer,Y=Q.segments,U=A?Op(ge,ne,f,X):Pp(ge,ne);f.uploadCommonUniforms(f.context,ae,Z.toUnwrapped()),ae.draw(f,L,v,f.stencilModeForClipping(Z),x,t.af.disabled,U,h.id,Q.layoutVertexBuffer,H,Y,h.paint,f.transform.zoom,re,void 0)}}function kc(f,o,h,g,v,x,S,k){h.resetLayerRenderingStats(f);let D=f.context,A=D.gl,L=f.transform,z=h.paint.get("fill-extrusion-pattern"),U=z.constantOr(1),H=h.paint.get("fill-extrusion-opacity"),Y=f.style.enable3dLights(),Z=h.paint.get(Y&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],Q=h.layout.get("fill-extrusion-edge-radius"),re=Q>0&&!h.paint.get("fill-extrusion-rounded-roof"),oe=re?0:Q,ae=L.projection.name==="globe"?t.bY():0,_e=L.projection.name==="globe",ge=_e?t.a1(L.zoom):0,ne=[t.aj(L.center.lng),t.ak(L.center.lat)],se=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),le=h.paint.get("fill-extrusion-flood-light-intensity"),we=h.paint.get("fill-extrusion-vertical-scale"),Re=Qa(f,h.paint.get("fill-extrusion-cutoff-fade-range")),me=h.paint.get("fill-extrusion-emissive-strength"),Le=[],Be;_e&&Le.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&Le.push("FAUX_AO"),re&&Le.push("ZERO_ROOF_RADIUS"),k&&Le.push("HAS_CENTROID"),le>0&&Le.push("FLOOD_LIGHT"),Re.shouldRenderCutoff&&Le.push("RENDER_CUTOFF");let Qe=f.renderPass==="shadow",Je=f.shadowRenderer,Ze=Qe&&!!Je;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Te=[0,0,0];if(Je){let bt=f.style.directionalLight,yt=f.style.ambientLight;bt&&yt&&(Te=Ka(f.style,bt,yt)),Be=Le.concat(["SHADOWS_SINGLE_CASCADE"])}let Ve=Ze?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",Ye=h.getLayerRenderingStats();for(let bt of g){let yt=o.getTile(bt),kt=yt.getBucket(h);if(!kt||kt.projection.name!==L.projection.name)continue;let vt=!1;Je&&(vt=Je.getMaxCascadeForTile(bt.toUnwrapped())===0);let it=f.isTileAffectedByFog(bt),Ge=kt.programConfigurations.get(h.id),Dt=f.getOrCreateProgram(Ve,{config:Ge,defines:vt?Be:Le,overrideFog:it});if(f.terrain&&f.terrain.setupElevationDraw(yt,Dt,{useMeterToDem:!0}),!kt.centroidVertexBuffer){let Kt=Dt.attributes.a_centroid_pos;Kt!==void 0&&A.vertexAttrib2f(Kt,0,0)}!Qe&&Je&&Je.setupShadows(yt.tileID.toUnwrapped(),Dt,"vector-tile",yt.tileID.overscaledZ),U&&(f.context.activeTexture.set(A.TEXTURE0),yt.imageAtlasTexture&&yt.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Ge.updatePaintBuffers());let ai=z.constantOr(null);if(ai&&yt.imageAtlas){let Kt=yt.imageAtlas.patternPositions[ai.toString()];Kt&&Ge.setConstantPatternPositions(Kt)}let ti=h.paint.get("fill-extrusion-vertical-gradient"),vi;if(Qe&&Je){if(jp(yt.tileID,kt,f))continue;let Kt=Je.calculateShadowPassMatrixFromTile(yt.tileID.toUnwrapped());vi=wc(Kt,oe,we)}else{let Kt=f.translatePosMatrix(bt.expandedProjMatrix,yt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Gi=L.projection.createInversionMatrix(L,bt.canonical);vi=U?Ap(Kt,f,ti,H,X,oe,bt,yt,ae,ge,ne,Gi,se,we):xc(Kt,f,ti,H,X,oe,bt,ae,ge,ne,Gi,se,we,le,Te,me)}f.uploadCommonUniforms(D,Dt,bt.toUnwrapped(),null,Re);let Ai=kt.segments;if(L.projection.name==="mercator"&&!Qe&&(Ai=kt.getVisibleSegments(yt.tileID,f.terrain,f.transform.getFrustum(0)),!Ai.get().length))continue;if(Ye)if(Qe)for(let Kt of Ai.get())Ye.numRenderedVerticesInShadowPass+=Kt.primitiveLength;else for(let Kt of Ai.get())Ye.numRenderedVerticesInTransparentPass+=Kt.primitiveLength;let Ki=[];(f.terrain||k)&&Ki.push(kt.centroidVertexBuffer),_e&&Ki.push(kt.layoutVertexExtBuffer),Dt.draw(f,D.gl.TRIANGLES,v,x,S,t.af.backCCW,vi,h.id,kt.layoutVertexBuffer,kt.indexBuffer,Ai,h.paint,f.transform.zoom,Ge,Ki)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function ao(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q,re){let oe=f.context,ae=oe.gl,_e=f.transform,ge=f.transform.zoom,ne=[],se=Qa(f,h.paint.get("fill-extrusion-cutoff-fade-range"));A==="clear"?(ne.push("CLEAR_SUBPASS"),re&&(ne.push("CLEAR_FROM_TEXTURE"),oe.activeTexture.set(ae.TEXTURE0),re.bind(ae.LINEAR,ae.CLAMP_TO_EDGE))):A==="sdf"&&ne.push("SDF_SUBPASS"),X&&ne.push("HAS_CENTROID"),se.shouldRenderCutoff&&ne.push("RENDER_CUTOFF");let le=h.layout.get("fill-extrusion-edge-radius"),we=(Re,me,Le,Be,Qe)=>{let Je=me.programConfigurations.get(h.id),Ze=f.isTileAffectedByFog(Re),Te=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Je,defines:ne,overrideFog:Ze}),Ve=((bt,yt,kt,vt,it,Ge,Dt,ai,ti,vi,Ai)=>({u_matrix:yt,u_opacity:kt,u_ao_pass:vt?1:0,u_meter_to_tile:it,u_ao:Ge,u_flood_light_intensity:Dt,u_flood_light_color:ai,u_attenuation:ti,u_edge_radius:vi,u_fb:0,u_fb_size:Ai}))(0,Be,L,D,Qe,[z,U*Qe],H,Y,Z,ge>=17?0:le*Qe,re?re.size[0]:0),Ye=[];X&&Ye.push(me.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(oe,Te,Re.toUnwrapped(),null,se),Te.draw(f,oe.gl.TRIANGLES,v,x,S,k,Ve,h.id,me.vertexBuffer,me.indexBuffer,Le,h.paint,ge,Je,Ye)};for(let Re of g){let me=o.getTile(Re),Le=me.getBucket(h);if(!Le||Le.projection.name!==_e.projection.name||!Le.groundEffect||Le.groundEffect&&!Le.groundEffect.hasData())continue;let Be=Le.groundEffect,Qe=1/Le.tileToMeter;{let Je=f.translatePosMatrix(Re.projMatrix,me,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ze=Be.getDefaultSegment();we(Re,Be,Ze,Je,Qe)}if(Q)for(let Je=0;Je<4;Je++){let Ze=t.bZ[Je](Re),Te=o.getTile(Ze);if(!Te)continue;let Ve=Te.getBucket(h);if(!Ve||Ve.projection.name!==_e.projection.name||!Ve.groundEffect||Ve.groundEffect&&!Ve.groundEffect.hasData())continue;let Ye=Ve.groundEffect,bt,yt;Je===0?(bt=[-t.a3,0,0],yt=1):Je===1?(bt=[t.a3,0,0],yt=0):Je===2?(bt=[0,-t.a3,0],yt=3):(bt=[0,t.a3,0],yt=2);let kt=Ye.regionSegments[yt];if(!kt)continue;let vt=new Float32Array(16);t.ad.translate(vt,Re.projMatrix,bt),we(Re,Ye,kt,f.translatePosMatrix(vt,me,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Qe)}}}function Eu(f,o,h,g,v,x,S){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();let k=x?x.findDEMTileFor(h):null;if(!(k&&k.dem||S))return;let D=Q=>new t.P(Math.ceil((Q+t.c0)*t.c1),0),A=Q=>{let re=o.getSource().minzoom,oe=_e=>{let ge=o.getTileByID(_e);if(ge&&ge.hasData())return ge.getBucket(v)},ae=[0,-1,1];for(let _e of ae){if(Q.overscaledZ+_e<re)continue;let ge=oe(Q.calculateScaledKey(Q.overscaledZ+_e));if(ge)return ge}},L=[0,0,0],z=(Q,re)=>(L[0]=Math.min(Q.min.y,re.min.y),L[1]=Math.max(Q.max.y,re.max.y),L[2]=t.a3-re.min.x>Q.max.x?re.min.x-t.a3:Q.max.x,L),U=(Q,re)=>(L[0]=Math.min(Q.min.x,re.min.x),L[1]=Math.max(Q.max.x,re.max.x),L[2]=t.a3-re.min.y>Q.max.y?re.min.y-t.a3:Q.max.y,L),H=[(Q,re)=>z(Q,re),(Q,re)=>z(re,Q),(Q,re)=>U(Q,re),(Q,re)=>U(re,Q)],Y=(Q,re,oe,ae,_e,ge,ne)=>{if(!x)return 0;let se=[[ge?oe:Q,ge?Q:oe,0],[ge?oe:re,ge?re:oe,0]],le=ne<0?t.a3+ne:ne,we=[ge?le:(Q+re)/2,ge?(Q+re)/2:le,0];return oe===0&&ne<0||oe!==0&&ne>0?x.getForTilePoints(_e,[we],!0,ae):se.push(we),x.getForTilePoints(h,se,!0,k),Math.max(se[0][2],se[1][2],we[2])/x.exaggeration()};for(let Q=0;Q<4;Q++){let re=g.borderFeatureIndices[Q];if(re.length===0)continue;let oe=t.bZ[Q](h),ae=A(oe);if(!(ae&&ae instanceof t.b_)||g.borderDoneWithNeighborZ[Q]===ae.canonical.z)continue;ae.centroidVertexArray.length===0&&ae.createCentroidsBuffer();let _e=x?x.findDEMTileFor(oe):null;if(!(_e&&_e.dem||S))continue;let ge=(Q<2?1:5)-Q,ne=ae.borderDoneWithNeighborZ[ge]!==g.canonical.z,se=ae.borderFeatureIndices[ge],le=0;if(g.canonical.z!==ae.canonical.z){for(let we of re)g.showCentroid(g.featuresOnBorder[we]);if(ne)for(let we of se)ae.showCentroid(ae.featuresOnBorder[we]);g.borderDoneWithNeighborZ[Q]=ae.canonical.z,ae.borderDoneWithNeighborZ[ge]=g.canonical.z}for(let we of re){let Re=g.featuresOnBorder[we],me=g.centroidData[Re.centroidDataIndex],Le=Re.borders[Q],Be;for(;le<se.length;){Be=ae.featuresOnBorder[se[le]];let Qe=Be.borders[ge];if(Qe[1]>Le[0]+3||Qe[0]>Le[0]-3)break;ae.showCentroid(Be),le++}if(Be&&le<se.length){let Qe=le,Je=0;for(;!(Be.borders[ge][0]>Le[1]-3)&&(Je++,++le!==se.length);)Be=ae.featuresOnBorder[se[le]];if(Be=ae.featuresOnBorder[se[Qe]],Je>1){let Ve=Be.borders[ge];Math.abs(Le[0]-Ve[0])<3&&Math.abs(Le[1]-Ve[1])<3&&(Je=1,le=Qe+1)}else if(Je===0){g.showCentroid(Re);continue}let Ze=ae.centroidData[Be.centroidDataIndex];S&&Je===1&&(((Z=me).flags|(X=Ze).flags)&t.b$?(Z.flags|=t.b$,X.flags|=t.b$):(Z.flags&=~t.b$,X.flags&=~t.b$));let Te=Re.intersectsCount()>1||Be.intersectsCount()>1;if(Je>1)le=Qe,me.centroidXY=Ze.centroidXY=new t.P(0,0);else if(_e&&_e.dem&&!Te){let Ve=H[Q](me,Ze),Ye=Q%2?t.a3-1:0,bt=Y(Ve[0],Math.min(t.a3-1,Ve[1]),Ye,_e,oe,Q<2,Ve[2]);me.centroidXY=Ze.centroidXY=D(bt)}else Te?me.centroidXY=Ze.centroidXY=new t.P(0,0):(me.centroidXY=g.encodeBorderCentroid(Re),Ze.centroidXY=ae.encodeBorderCentroid(Be));g.writeCentroidToBuffer(me),ae.writeCentroidToBuffer(Ze)}else g.showCentroid(Re)}g.borderDoneWithNeighborZ[Q]=ae.canonical.z,ae.borderDoneWithNeighborZ[ge]=g.canonical.z}var Z,X;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(f)}let bl=[1,0,0],c_=[0,1,0],Du=[0,0,1];function jp(f,o,h){let g=h.transform,v=h.shadowRenderer;if(!v)return!0;let x=f.toUnwrapped(),S=g.tileSize*v._cascades[h.currentShadowCascade].scale,k=o.maxHeight;if(g.elevation){let Z=g.elevation.getMinMaxForTile(f);Z&&(k+=Z.max)}let D=[...v.shadowDirection];D[2]=-D[2];let A=v.computeSimplifiedTileShadowVolume(x,k,S,D);if(!A)return!1;let L=[bl,c_,Du,D,[D[0],0,D[2]],[0,D[1],D[2]]],z=g.projection.name==="globe",U=g.scaleZoom(S),H=t.aM.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,U,!z),Y=v.getCurrentCascadeFrustum();return H.intersectsPrecise(A.vertices,A.planes,L)===0||Y.intersectsPrecise(A.vertices,A.planes,L)===0}function th(f){return[f[0]*t.c2,f[1]*t.c2,f[2]*t.c2,0]}function ih(f,o,h,g,v,x,S,k,D){let A=g.getSource(),L=h.globeSharedBuffers;if(!L)return;let z,U,H;if(o&&(z=g.getTile(o)),A instanceof t.bm?(U=A.texture,H=t.bh(0,0,h.transform)):z&&o&&(U=z.texture,H=t.bh(o.canonical.z,o.canonical.x,h.transform)),!U||!H)return;f||(H=t.ad.scale(t.ad.create(),H,[1,-1,1]));let Y=h.context,Z=Y.gl,X=v.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,Q=h.colorModeForDrapableLayerRenderPass(x),re=S.defines;re.push("GLOBE_POLES");let oe=new t.ae(Z.LEQUAL,t.ae.ReadWrite,h.depthRangeFor3D),ae=Float32Array.from(h.transform.expandedFarZProjMatrix),_e=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),Y.activeTexture.set(Z.TEXTURE0),U.bind(X,Z.CLAMP_TO_EDGE),Y.activeTexture.set(Z.TEXTURE1),U.bind(X,Z.CLAMP_TO_EDGE),U.useMipmap&&Y.extTextureFilterAnisotropic&&h.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);let[ge,ne,se,le]=o?L.getPoleBuffers(o.canonical.z,!1):L.getPoleBuffers(0,!0),we=v.paint.get("raster-elevation"),Re;f?(Re=ge,h.renderDefaultNorthPole=we!==0):(Re=ne,h.renderDefaultSouthPole=we!==0);let me=th(S.mix),Le=((Qe,Je,Ze,Te,Ve,Ye,bt,yt,kt,vt,it,Ge,Dt)=>Xd(Qe,Je,Ze,new Float32Array(16),new Float32Array(9),[0,0],Te,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ye,[0,0],yt,2,vt,it,Ge,1,0,Dt))(ae,_e,H,t.a1(h.transform.zoom),0,v,0,we,0,me,S.offset,S.range,x),Be=h.getOrCreateProgram("raster",{defines:re});h.uploadCommonUniforms(Y,Be,null),Be.draw(h,Z.TRIANGLES,oe,D,Q,k,Le,v.id,Re,se,le)}function Bi(f){let o=f._nearZ,h=f.projection.farthestPixelDistance(f),g=h-o,v=.2*f.height,x=o+v;return[o,h,(x-v-o)/g,(x-o)/g]}function Ly(f,o,h,g){if(f)return o instanceof vc&&f instanceof t.c3?o.getTextureDescriptor(f,h,!0):{texture:f.texture,mix:th(g.mix),offset:g.offset,buffer:0,tileSize:1}}function Wt(f,o,h){if(!f)return null;let g=o.getTextureDescriptor(f,h,!0);if(!g)return null;let{texture:v,mix:x,offset:S,tileSize:k,buffer:D,format:A}=g;if(!v||!A)return null;let L=!1;return A==="uint32"&&(L=!0,x[3]=0,x=i_(t.c4,x,[0,h.paint.get("raster-particle-max-speed")]),S=Lp(t.c4,S,[0,h.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[D/(k+2*D),k/(k+2*D)],tileSize:k,scalarData:L,scale:x,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[A]]}}function d_(f){let o=f._nearZ,h=f.projection.farthestPixelDistance(f),g=h-o,v=.2*f.height,x=o+v;return[o,h,(x-v-o)/g,(x-o)/g]}let Au=new t.C(1,0,0,1),Up=new t.C(0,1,0,1),Pa=new t.C(0,0,1,1),Hp=new t.C(1,0,1,1),Ic=new t.C(0,1,1,1);function Tt(f,o,h,g,v,x,S){let k=f.context,D=f.transform,A=k.gl,L=D.projection.name==="globe",z=L?["PROJECTION_GLOBE_VIEW"]:[],U=t.ad.clone(h.projMatrix);if(L&&t.a1(D.zoom)>0){let me=t.c5(h.canonical,D),Le=t.c6(me);U=t.ad.multiply(new Float32Array(16),D.globeMatrix,Le),t.ad.multiply(U,D.projMatrix,U)}let H=t.ad.create();H[12]+=2*v/(t.e.devicePixelRatio*D.width),H[13]+=2*x/(t.e.devicePixelRatio*D.height),t.ad.multiply(U,H,U);let Y=f.getOrCreateProgram("debug",{defines:z}),Z=o.getTileByID(h.key);f.terrain&&f.terrain.setupElevationDraw(Z,Y);let X=t.ae.disabled,Q=t.ag.disabled,re=f.colorModeForRenderPass(),oe="$debug";k.activeTexture.set(A.TEXTURE0),f.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),L?Z._makeGlobeTileDebugBuffers(f.context,D):Z._makeDebugTileBoundsBuffers(f.context,D.projection);let ae=Z._tileDebugBuffer||f.debugBuffer,_e=Z._tileDebugIndexBuffer||f.debugIndexBuffer,ge=Z._tileDebugSegments||f.debugSegments;if(Y.draw(f,A.LINE_STRIP,X,Q,re,t.af.disabled,Mu(U,g),oe,ae,_e,ge,null,null,null,[Z._globeTileDebugBorderBuffer]),S){let me=Z.latestRawTileData,Le=Math.floor((me&&me.byteLength||0)/1024),Be=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Be+=` => ${h.overscaledZ}`),Be+=` ${Z.state}`,Be+=` ${Le}kb`,function(Qe,Je){Qe.initDebugOverlayCanvas();let Ze=Qe.debugOverlayCanvas,Te=Qe.context.gl,Ve=Qe.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,Ze.width,Ze.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(Je,5,5),Ve.strokeText(Je,5,5),Qe.debugOverlayTexture.update(Ze),Qe.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}(f,Be)}let ne=o.getTile(h).tileSize,se=512/Math.min(ne,512)*(h.overscaledZ/D.zoom)*.5,le=Z._tileDebugTextBuffer||f.debugBuffer,we=Z._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Re=Z._tileDebugTextSegments||f.debugSegments;Y.draw(f,A.TRIANGLES,X,Q,t.a.alphaBlended,t.af.disabled,Mu(U,t.C.transparent,se),oe,le,we,Re,null,null,null,[Z._globeTileDebugTextBuffer])}function Ni(f,o,h,g){so(f,0,o+h/2,f.transform.width,h,g)}function Vi(f,o,h,g){so(f,o-h/2,0,h,f.transform.height,g)}function so(f,o,h,g,v,x){let S=f.context,k=S.gl;k.enable(k.SCISSOR_TEST),k.scissor(o*t.e.devicePixelRatio,h*t.e.devicePixelRatio,g*t.e.devicePixelRatio,v*t.e.devicePixelRatio),S.clear({color:x}),k.disable(k.SCISSOR_TEST)}let Tc=t.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Li}=Tc;function da(f,o,h,g){f.emplaceBack(o,h,g)}class Ec{constructor(o){this.vertexArray=new t.c8,this.indices=new t.bu,da(this.vertexArray,-1,-1,1),da(this.vertexArray,1,-1,1),da(this.vertexArray,-1,1,1),da(this.vertexArray,1,1,1),da(this.vertexArray,-1,-1,-1),da(this.vertexArray,1,-1,-1),da(this.vertexArray,-1,1,-1),da(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Li),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=t.b.simpleSegment(0,0,36,12)}}function Oa(f,o,h,g,v,x){let S=f.context.gl,k=o.paint.get("sky-atmosphere-color"),D=o.paint.get("sky-atmosphere-halo-color"),A=o.paint.get("sky-atmosphere-sun-intensity"),L=((z,U,H,Y,Z)=>({u_matrix_3f:z,u_sun_direction:U,u_sun_intensity:H,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(t.bC.fromMat4(t.bC.create(),g),v,A,k,D);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+x,o.skyboxTexture,0),h.draw(f,S.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.frontCW,L,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}let _o=t.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Jn{constructor(o){let h=new t.c9;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let g=new t.bu;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(h,_o.members),this.indexBuffer=o.createIndexBuffer(g),this.segments=t.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Fy=t.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class nh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Wp{constructor(o){this.colorModeAlphaBlendedWriteRGB=new t.a([t.ca,t.cb,t.ca,t.cb],t.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new t.a([t.ca,t.cc,t.ca,t.cc],t.C.transparent,[!1,!1,!1,!0]),this.params=new nh,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){let h=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Jn(h);let g=this.params.sizeRange,v=this.params.intensityRange,x=function(L){let z=t.cf(30),U=[];for(let H=0;H<L;++H){let Y=2*Math.PI*z(),Z=Math.acos(1-2*z())-.5*Math.PI;U.push(t._.fromValues(Math.cos(Z)*Math.cos(Y),Math.cos(Z)*Math.sin(Y),Math.sin(Z)))}return U}(this.params.starsCount),S=t.cf(300),k=new t.cd,D=new t.bu,A=0;for(let L=0;L<x.length;++L){let z=t._.scale([],x[L],200),U=Math.max(0,1+.01*g*(1*S()-.5)),H=Math.max(0,1+.01*v*(1*S()-.5));k.emplaceBack(z[0],z[1],z[2],-1,-1,U,H),k.emplaceBack(z[0],z[1],z[2],1,-1,U,H),k.emplaceBack(z[0],z[1],z[2],1,1,U,H),k.emplaceBack(z[0],z[1],z[2],-1,1,U,H),D.emplaceBack(A+0,A+1,A+2),D.emplaceBack(A+0,A+2,A+3),A+=4}this.starsVx=h.createVertexBuffer(k,Fy.members),this.starsIdx=h.createIndexBuffer(D),this.starsSegments=t.b.simpleSegment(0,0,k.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,h){let g=o.context,v=g.gl,x=o.transform,S=new t.ae(v.LEQUAL,t.ae.ReadOnly,[0,1]),k=t.a1(x.zoom),D=o.style.getLut(h.scope),A=h.properties.get("color").toRenderColor(D).toArray01(),L=h.properties.get("high-color").toRenderColor(D).toArray01(),z=h.properties.get("space-color").toRenderColor(D).toArray01PremultipliedAlpha(),U=5e-4,H=t.ce(h.properties.get("horizon-blend"),0,1,U,.25),Y=t.ba(o,g,x)&&H===U?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,Z=o.frameCounter/1e3%1,X=t._.length(x.globeCenterInViewSpace),Q=Math.sqrt(Math.pow(X,2)-Math.pow(Y,2)),re=Math.acos(Q/X),oe=ae=>{let _e=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ae&&_e.push("ALPHA_PASS");let ge=o.getOrCreateProgram("globeAtmosphere",{defines:_e}),ne=((le,we,Re,me,Le,Be,Qe,Je,Ze,Te,Ve,Ye)=>({u_frustum_tl:le,u_frustum_tr:we,u_frustum_br:Re,u_frustum_bl:me,u_horizon:Le,u_transition:Be,u_fadeout_range:Qe,u_color:Je,u_high_color:Ze,u_space_color:Te,u_temporal_offset:Ve,u_horizon_angle:Ye}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,k,H,A,L,z,Z,re);o.uploadCommonUniforms(g,ge);let se=this.atmosphereBuffer;se&&ge.draw(o,v.TRIANGLES,S,t.ag.disabled,ae?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,t.af.backCW,ne,ae?"atmosphere_glow_alpha":"atmosphere_glow",se.vertexBuffer,se.indexBuffer,se.segments)};oe(!1),oe(!0)}drawStars(o,h){let g=t.at(h.properties.get("star-intensity"),0,1);if(g===0)return;let v=o.context,x=v.gl,S=o.transform,k=o.getOrCreateProgram("stars"),D=t.av.identity([]);t.av.rotateX(D,D,-S._pitch),t.av.rotateZ(D,D,-S.angle),t.av.rotateX(D,D,t.ab(S._center.lat)),t.av.rotateY(D,D,-t.ab(S._center.lng));let A=t.ad.fromQuat(new Float32Array(16),D),L=t.ad.multiply([],S.starsProjMatrix,A),z=t.bC.fromMat4([],A),U=t.bC.invert([],z),H=[0,1,0];t._.transformMat3(H,H,U),t._.scale(H,H,this.params.sizeMultiplier);let Y=[1,0,0];t._.transformMat3(Y,Y,U),t._.scale(Y,Y,this.params.sizeMultiplier);let Z=(X=H,Q=Y,re=g,{u_matrix:Float32Array.from(L),u_up:X,u_right:Q,u_intensity_multiplier:re});var X,Q,re;o.uploadCommonUniforms(v,k),this.starsVx&&this.starsIdx&&k.draw(o,x.TRIANGLES,t.ae.disabled,t.ag.disabled,this.colorModeAlphaBlendedWriteRGB,t.af.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Dc(f,o){let h=[...f],g=o.cameraWorldSizeForFog/o.worldSize,v=t.ad.identity([]);return t.ad.scale(v,v,[g,g,1]),t.ad.multiply(h,v,h),t.ad.multiply(h,o.worldToFogMatrix,h),h}function rh(f,o,h,g,v){let x=h.material,S=g.context,{baseColorTexture:k,metallicRoughnessTexture:D}=x.pbrMetallicRoughness,{normalTexture:A,occlusionTexture:L,emissionTexture:z}=x;function U(H,Y,Z){if(H&&(f.push(Y),S.activeTexture.set(S.gl.TEXTURE0+Z),H.gfxTexture)){let{minFilter:X,magFilter:Q,wrapS:re,wrapT:oe}=H.sampler;H.gfxTexture.bindExtraParam(X,Q,re,oe)}}U(k,"HAS_TEXTURE_u_baseColorTexture",Qr.BaseColor),U(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Qr.MetallicRoughness),U(A,"HAS_TEXTURE_u_normalTexture",Qr.Normal),U(L,"HAS_TEXTURE_u_occlusionTexture",Qr.Occlusion),U(z,"HAS_TEXTURE_u_emissionTexture",Qr.Emission),v&&(v.texture||(v.texture=new t.ch(g.context,v.image,[v.image.height,v.image.height,v.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Qr.LUT),v.texture&&v.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(h.texcoordBuffer)),h.colorBuffer&&(f.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(h.colorBuffer)),h.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(h.normalBuffer)),h.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(h.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function yl(f,o,h,g,v,x){let S=h.paint.get("model-opacity"),k=o.context,D=new t.ae(o.context.gl.LEQUAL,t.ae.ReadWrite,o.depthRangeFor3D),A=o.transform,L=f.mesh,z=L.material,U=z.pbrMetallicRoughness,H=o.style.fog,Y;Y=o.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:t.ad.multiply([],g.zScaleMatrix,f.nodeModelMatrix),t.ad.multiply(Y,g.negCameraPosMatrix,Y);let Z=t.ad.invert([],Y);t.ad.transpose(Z,Z);let X=h.paint.get("model-emissive-strength").constantOr(0),Q=Jd(new Float32Array(f.worldViewProjection),new Float32Array(Y),new Float32Array(Z),null,o,S,U.baseColorFactor.toRenderColor(null),z.emissiveFactor,U.metallicFactor,U.roughnessFactor,z,X,h),re={defines:[]},oe=[];rh(re.defines,oe,L,o,h.lut);let ae=o.shadowRenderer;ae&&(ae.useNormalOffset=!1);let _e=null;if(H){let se=Dc(f.nodeModelMatrix,o.transform);if(_e=new Float32Array(se),A.projection.name!=="globe"){let le=L.aabb.min,we=L.aabb.max,[Re,me]=H.getOpacityForBounds(se,le[0],le[1],we[0],we[1]);re.overrideFog=Re>=Mn||me>=Mn}}let ge=Qa(o,h.paint.get("model-cutoff-fade-range"));ge.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");let ne=o.getOrCreateProgram("model",re);o.uploadCommonUniforms(k,ne,null,_e,ge),o.renderPass!=="shadow"&&ae&&ae.setupShadowsFromMatrix(f.nodeModelMatrix,ne),ne.draw(o,k.gl.TRIANGLES,D,v,x,L.material.doubleSided?t.af.disabled:t.af.backCCW,Q,h.id,L.vertexBuffer,L.indexBuffer,L.segments,h.paint,o.transform.zoom,void 0,oe)}function $r(f,o,h,g,v,x,S){let k;k=f.projection.name==="globe"?t.ci(h,f):[...h],t.ad.multiply(k,k,o.matrix);let D=t.ad.multiply([],g,k);if(o.meshes)for(let A of o.meshes){if(A.material.alphaMode!=="BLEND"){S.push({mesh:A,depth:0,modelIndex:v,worldViewProjection:D,nodeModelMatrix:k});continue}let L=t._.transformMat4([],A.centroid,D);L[2]>0&&x.push({mesh:A,depth:L[2],modelIndex:v,worldViewProjection:D,nodeModelMatrix:k})}if(o.children)for(let A of o.children)$r(f,A,h,g,v,x,S)}function lo(f,o,h,g){let v=h.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),S=v.getShadowPassColorMode(),k=v.calculateShadowPassMatrixFromMatrix(o),D=o_(k);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,x,t.ag.disabled,S,t.af.backCCW,D,g.id,f.vertexBuffer,f.indexBuffer,f.segments,g.paint,h.transform.zoom,void 0,void 0)}function h_(f,o,h){let g=o.updateZoomBasedPaintProperties(),v=function(x,S,k){let D,A,L,z=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&z>0){let U=x.terrain,H=U.findDEMTileFor(k);H&&H.dem?D=t.ck.create(U,k,H):z=0}if(z===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),z===S.validForExaggeration&&(z===0||D&&D._demTile&&D._demTile.tileID===S.validForDEMTile.id&&D._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(let U in S.instancesPerModel){let H=S.instancesPerModel[U];for(let Y=0;Y<H.instancedDataArray.length;++Y){let Z=(D?z*D.getElevationAt(0|H.instancedDataArray.float32[16*Y],0|H.instancedDataArray.float32[16*Y+1],!0,!0):0)+H.instancesEvaluatedElevation[Y];H.instancedDataArray.float32[16*Y+6]=Z,A=A?Math.min(S.terrainElevationMin,Z):Z,L=L?Math.max(S.terrainElevationMax,Z):Z}}return S.terrainElevationMin=A||0,S.terrainElevationMax=L||0,S.validForExaggeration=z,S.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,o,h);(g||v)&&(o.uploaded=!1,o.upload(f.context))}let co={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.b6([0,0,0],[t.a3,t.a3,0])};function hr(f,o){let h=1<<f.canonical.z,g=o.getFreeCameraOptions().position,v=o.elevation,x=f.canonical.x/h,S=(f.canonical.x+1)/h,k=f.canonical.y/h,D=(f.canonical.y+1)/h,A=o._centerAltitude;if(v){let H=v.getMinMaxForTile(f);H&&H.max>A&&(A=H.max)}let L=t.at(g.x,x,S)-g.x,z=t.at(g.y,k,D)-g.y,U=t.ax(A,o.center.lat)-g.z;return o._zoomFromMercatorZ(Math.sqrt(L*L+z*z+U*U))}function Uo(f,o,h,g,v,x,S){let k=f.context,D=f.renderPass==="shadow",A=f.shadowRenderer,L=D&&A?A.getShadowPassDepthMode():new t.ae(k.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D),z=f.isTileAffectedByFog(x);if(h.meshes)for(let U of h.meshes){let H=["MODEL_POSITION_ON_GPU"],Y=[],Z,X,Q;g.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");let re=Qa(f,o.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),D&&A)Z=f.getOrCreateProgram("modelDepth",{defines:H}),X=o_(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(h.matrix)),Q=A.getShadowPassColorMode();else{rh(H,Y,U,f,o.lut),Z=f.getOrCreateProgram("model",{defines:H,overrideFog:z});let ae=U.material,_e=ae.pbrMetallicRoughness,ge=o.paint.get("model-opacity"),ne=o.paint.get("model-emissive-strength").constantOr(0);X=Jd(x.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,f,ge,_e.baseColorFactor.toRenderColor(null),ae.emissiveFactor,_e.metallicFactor,_e.roughnessFactor,ae,ne,o,v),A&&(S.shadowUniformsInitialized?Z.setShadowUniformValues(k,A.getShadowUniformValues()):(A.setupShadows(x.toUnwrapped(),Z,"model-tile",x.overscaledZ),S.shadowUniformsInitialized=!0)),Q=re.shouldRenderCutoff||ge<1||ae.alphaMode!=="OPAQUE"?t.a.alphaBlended:t.a.unblended}f.uploadCommonUniforms(k,Z,x.toUnwrapped(),null,re);let oe=U.material.doubleSided?t.af.disabled:t.af.backCCW;if(g.instancedDataArray.length>20)Y.push(g.instancedDataBuffer),Z.draw(f,k.gl.TRIANGLES,L,t.ag.disabled,Q,oe,X,o.id,U.vertexBuffer,U.indexBuffer,U.segments,o.paint,f.transform.zoom,void 0,Y,g.instancedDataArray.length);else{let ae=D?"u_instance":"u_normal_matrix";for(let _e=0;_e<g.instancedDataArray.length;++_e)X[ae]=new Float32Array(g.instancedDataArray.arrayBuffer,64*_e,16),Z.draw(f,k.gl.TRIANGLES,L,t.ag.disabled,Q,oe,X,o.id,U.vertexBuffer,U.indexBuffer,U.segments,o.paint,f.transform.zoom,void 0,Y)}}if(h.children)for(let U of h.children)Uo(f,o,U,g,v,x,S)}let es=[1,-1,1];function xr(f,o,h,g){if(!h.modelManager)return!0;let v=h.modelManager;if(!h.shadowRenderer)return!0;let x=h.shadowRenderer,S=o.aabb,k=!0,D=f.maxHeight;if(D===0){let L=0;for(let z in f.instancesPerModel){let U=v.getModel(z,g);U?L=Math.max(L,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):k=!1}D=f.maxScale*L*1.41+f.maxVerticalOffset,k&&(f.maxHeight=D)}S.max[2]=D,S.min[2]+=f.terrainElevationMin,S.max[2]+=f.terrainElevationMax,t._.transformMat4(S.min,S.min,o.tileMatrix),t._.transformMat4(S.max,S.max,o.tileMatrix);let A=S.intersects(x.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=A===2),A===0}function Gp(f,o){let h=f.uniformValues.u_cutoff_params[0],g=f.uniformValues.u_cutoff_params[1],v=f.uniformValues.u_cutoff_params[2],x=f.uniformValues.u_cutoff_params[3];return g===h||x===v?1:t.at(((o-h)/(g-h)-v)/(x-v),0,1)}function ha(f,o,h,g){if(o.pitch<20)return 1;let v=o.getWorldToCameraMatrix(),x=t.ad.multiply([],v,f),S=[...h.min,1],k=t.aA.transformMat4([],S,x),D=k,A=k;S[1]=h.max[1],k=t.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A,S[0]=h.max[0],k=t.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A,S[1]=h.min[1],k=t.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A;let L=t.at(g[0],0,1),z=100*o.pixelsPerMeter*t.at(g[1],0,1),U=t.at(g[2],0,1),H=t._.lerp([],D,A,L),Y=Math.tan(.5*o.fovX),Z=-H[2]*Y;if(z===0)return H[1]<-Math.abs(Z)?U:1;let X=(-Math.abs(Z)-H[1])/z,Q=(oe,ae,_e)=>(1-_e)*oe+_e*ae,re=t.at(Q(1,U,X),U,1);return Q(1,re,t.at((o.pitch-20)/20,0,1))}class oh{}class ah{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,h,g){{let z=this._storage.get(h.id);if(z)return z.lastUsedFrameIdx=o,z.buf}let v=g.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),S=new ArrayBuffer(x),k=new Int16Array(S);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));let D=new t.cm;for(let z=0;z<x/2;z+=3){let U=k[z],H=k[z+1],Y=k[z+2];D.emplaceBack(U,H),D.emplaceBack(H,Y),D.emplaceBack(Y,U)}let A=g.bindVertexArrayOES.current,L=new oh;return L.buf=new t.I(g,D),L.lastUsedFrameIdx=o,this._storage.set(h.id,L),g.bindVertexArrayOES.set(A),L.buf}update(o){for(let[h,g]of this._storage)o-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(h))}destroy(){for(let[o,h]of this._storage)h.buf.destroy(),this._storage.delete(o)}}let vl=t.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class zy{constructor(o){let h=new t.cn,g=new t.bu;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1),g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),this.segments=t.b.simpleSegment(0,0,h.length,g.length),this.vx=o.createVertexBuffer(h,vl.members),this.idx=o.createIndexBuffer(g)}destroy(){this.vx.destroy(),this.idx.destroy()}}let ua={symbol:function(f,o,h,g,v){if(f.renderPass!=="translucent")return;let x=t.ag.disabled,S=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,L,z,U,H,Y,Z){let X=L.transform,Q=H==="map",re=Y==="map";for(let oe of A){let ae=U.getTile(oe),_e=ae.getBucket(z);if(!_e||!_e.text||!_e.text.segments.get().length)continue;let ge=t.aD(_e.textSizeData,X.zoom),ne=Sc(oe,_e.getProjection(),X),se=X.calculatePixelsToTileUnitsMatrix(ae),le=ul(ne,ae.tileID.canonical,re,Q,X,_e.getProjection(),se),we=_e.hasIconTextFit()&&_e.hasIconData();if(ge){let Re=Math.pow(2,X.zoom-ae.tileID.overscaledZ);l_(_e,Q,re,Z,t.bO,X,le,oe,Re,ge,we)}}}(g,f,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v);let k=h.paint.get("icon-opacity").constantOr(1)!==0,D=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||D)?Np(f,o,h,g,x,S):(k&&Np(f,o,h,g,x,S,{onlyIcons:!0}),D&&Np(f,o,h,g,x,S,{onlyText:!0}),function(A,L,z,U){if(!A.symbolParams.useOcclusionQueries)return;let H=A.context.gl,Y=A.transform,Z=z.paint,X=Z.get("icon-occlusion-opacity").constantOr(0),Q=Z.get("text-occlusion-opacity").constantOr(0);if(!z.hasInitialOcclusionOpacityProperties||X===1&&Q===1)return;let re=Y.projection.name==="globe";for(let oe of U){let ae=L.getTile(oe),_e=ae.getBucket(z);if(!_e||_e.projection.name==="mercator"&&re||_e.fullyClipped)continue;if(_e.projection.name==="globe"){t.w(`Occlusion not supported for globe mode. Layer: ${z.type}`);continue}let ge=Sc(oe,_e.getProjection(),Y),ne=t.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,A.symbolParams.depthOffset,1),se=t.ad.multiply([],ne,ge),le=A.symbolParams.visualizeOcclusions!=="none"?1:A.symbolParams.occlusionQueryFrameWindow;for(let we=0;we<_e.symbolInstances.length;we++){let Re=_e.symbolInstances.get(we),me=A.style.placement.opacities[Re.crossTileID];if(me&&me.isHidden()||(A.frameCounter+we)%le!=0)continue;let Le=Re.tileAnchorX,Be=Re.tileAnchorY,Qe=Re.zOffset,Je;if(A.symbolParams.visualizeOcclusions==="none"){let bt=_e.queries.get(we);if(bt){if(!bt.isFree()){if(!bt.isResultAvailable())continue;let yt=bt.consumeResult();Re.occlusionState=yt===0?0:1;continue}Je=bt}else Je=new ac(A.context),_e.queries.set(we,Je)}let Ze=A.getOrCreateProgram("occlusion"),Te=A.symbolParams.occluderSize,Ve=a_(se,[Le,Be,Qe],[Y.width,Y.height],[Te,Te],A.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);A.terrain&&A.terrain.setupElevationDraw(ae,Ze,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),A.symbolParams.visualizeOcclusions==="none"&&Je&&Je.begin();let Ye=new t.ae(A.symbolParams.visualizeOcclusions==="zPass"?A.context.gl.ALWAYS:A.context.gl.LEQUAL,t.ae.ReadOnly,A.depthRangeFor3D);Ze.draw(A,H.TRIANGLES,Ye,t.ag.disabled,A.symbolParams.visualizeOcclusions!=="none"?t.a.alphaBlendedNonPremultiplied:t.a.disabled,t.af.disabled,Ve,"occlusion",A.occlusionBuffers.vx,A.occlusionBuffers.idx,A.occlusionBuffers.segments),A.symbolParams.visualizeOcclusions==="none"&&Je&&Je.end()}}}(f,o,h,g)),o.map.showCollisionBoxes&&(eh(f,o,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),eh(f,o,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,h,g){if(f.renderPass!=="translucent")return;let v=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),S=h.paint.get("circle-stroke-opacity"),k=h.layout.get("circle-sort-key").constantOr(1)!==void 0,D=h.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||S.constantOr(1)===0))return;let A=f.context,L=A.gl,z=f.transform,U=f.depthModeForSublayer(0,t.ae.ReadOnly),H=t.ag.disabled,Y=f.colorModeForDrapableLayerRenderPass(D),Z=z.projection.name==="globe",X=[t.aj(z.center.lng),t.ak(z.center.lat)],Q=[];for(let oe=0;oe<g.length;oe++){let ae=g[oe],_e=o.getTile(ae),ge=_e.getBucket(h);if(!ge||ge.projection.name!==z.projection.name)continue;let ne=ge.programConfigurations.get(h.id),se=t.bR(h),le=f.isTileAffectedByFog(ae);Z&&se.push("PROJECTION_GLOBE_VIEW");let we=f.getOrCreateProgram("circle",{config:ne,defines:se,overrideFog:le}),Re=ge.layoutVertexBuffer,me=ge.globeExtVertexBuffer,Le=ge.indexBuffer,Be=z.projection.createInversionMatrix(z,ae.canonical),Qe={programConfiguration:ne,program:we,layoutVertexBuffer:Re,globeExtVertexBuffer:me,indexBuffer:Le,uniformValues:t.bS(f,ae,_e,Be,X,h),tile:_e};if(k){let Je=ge.segments.get();for(let Ze of Je)Q.push({segments:new t.b([Ze]),sortKey:Ze.sortKey,state:Qe})}else Q.push({segments:ge.segments,sortKey:0,state:Qe})}k&&Q.sort((oe,ae)=>oe.sortKey-ae.sortKey);let re={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(let oe of Q){let{programConfiguration:ae,program:_e,layoutVertexBuffer:ge,globeExtVertexBuffer:ne,indexBuffer:se,uniformValues:le,tile:we}=oe.state,Re=oe.segments;f.terrain&&f.terrain.setupElevationDraw(we,_e,re),f.uploadCommonUniforms(A,_e,we.tileID.toUnwrapped()),_e.draw(f,L.TRIANGLES,U,H,Y,t.af.disabled,le,h.id,ge,se,Re,h.paint,z.zoom,ae,[ne])}},heatmap:function(f,o,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let v=f.context,x=v.gl,S=t.ag.disabled,k=new t.a([x.ONE,x.ONE,x.ONE,x.ONE],t.C.transparent,[!0,!0,!0,!0]);(function(H,Y,Z,X){let Q=H.gl,re=Y.width*X,oe=Y.height*X;H.activeTexture.set(Q.TEXTURE1),H.viewport.set([0,0,re,oe]);let ae=Z.heatmapFbo;if(!ae||ae&&(ae.width!==re||ae.height!==oe)){ae&&ae.destroy();let _e=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,_e),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),ae=Z.heatmapFbo=H.createFramebuffer(re,oe,!0,null),function(ge,ne,se,le,we,Re){let me=ge.gl;me.texImage2D(me.TEXTURE_2D,0,ge.extRenderToTextureHalfFloat?me.RGBA16F:me.RGBA,we,Re,0,me.RGBA,ge.extRenderToTextureHalfFloat?me.HALF_FLOAT:me.UNSIGNED_BYTE,null),le.colorAttachment.set(se)}(H,0,_e,ae,re,oe)}else Q.bindTexture(Q.TEXTURE_2D,ae.colorAttachment.get()),H.bindFramebuffer.set(ae.framebuffer)})(v,f,h,f.transform.projection.name==="globe"?.5:.25),v.clear({color:t.C.transparent});let D=f.transform,A=D.projection.name==="globe",L=A?["PROJECTION_GLOBE_VIEW"]:[],z=A?t.af.frontCCW:t.af.disabled,U=[t.aj(D.center.lng),t.ak(D.center.lat)];for(let H=0;H<g.length;H++){let Y=g[H];if(o.hasRenderableParent(Y))continue;let Z=o.getTile(Y),X=Z.getBucket(h);if(!X||X.projection.name!==D.projection.name)continue;let Q=f.isTileAffectedByFog(Y),re=X.programConfigurations.get(h.id),oe=f.getOrCreateProgram("heatmap",{config:re,defines:L,overrideFog:Q}),{zoom:ae}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Z,oe),f.uploadCommonUniforms(v,oe,Y.toUnwrapped());let _e=D.projection.createInversionMatrix(D,Y.canonical);oe.draw(f,x.TRIANGLES,t.ae.disabled,S,k,z,gl(f,Y,Z,_e,U,ae,h.paint.get("heatmap-intensity")),h.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,h.paint,f.transform.zoom,re,A?[X.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,x){let S=v.context,k=S.gl,D=x.heatmapFbo;if(!D)return;S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,D.colorAttachment.get()),S.activeTexture.set(k.TEXTURE1);let A=x.colorRampTexture;A||(A=x.colorRampTexture=new t.T(S,x.colorRamp,k.RGBA)),A.bind(k.LINEAR,k.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,k.TRIANGLES,t.ae.disabled,t.ag.disabled,v.colorModeForRenderPass(),t.af.disabled,((L,z,U,H)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(f,h))},line:function(f,o,h,g){if(f.renderPass!=="translucent")return;let v=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let S=h.paint.get("line-emissive-strength"),k=h.paint.get("line-occlusion-opacity"),D=f.context,A=D.gl,L=h.layout.get("line-z-offset"),z=!L.isConstant()||!!L.constantOr(0),U=z?new t.ae(f.depthOcclusion?A.GREATER:A.LEQUAL,t.ae.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,t.ae.ReadOnly),H=f.colorModeForDrapableLayerRenderPass(S),Y=f.terrain&&f.terrain.renderingToTexture,Z=Y?1:t.e.devicePixelRatio,X=h.paint.get("line-dasharray"),Q=X.constantOr(1),re=h.layout.get("line-cap"),oe=X.constantOr(null),ae=re.constantOr(null),_e=h.paint.get("line-pattern"),ge=_e.constantOr(1),ne=_e.constantOr(null),se=h.paint.get("line-opacity").constantOr(1),le=!ge&&se!==1||f.depthOcclusion&&k>0&&k<1,we=h.paint.get("line-gradient"),Re=ge?"linePattern":"line",me=t.bT(h),Le;if(Y&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(le=!1),k!==0&&f.depthOcclusion){let Qe=h.paint._values["line-opacity"];Qe&&Qe.value&&Qe.value.kind==="constant"?Le=Qe.value:t.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(z&&(f.forceTerrainMode=!0),!z&&k!==0&&f.terrain&&!Y)return void t.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Be=le&&z?f.stencilModeFor3D():t.ag.disabled;for(let Qe of g){let Je=o.getTile(Qe);if(ge&&!Je.patternsLoaded())continue;let Ze=Je.getBucket(h);if(!Ze)continue;f.prepareDrawTile();let Te=Ze.programConfigurations.get(h.id),Ve=f.isTileAffectedByFog(Qe),Ye=f.getOrCreateProgram(Re,{config:Te,defines:z?[...me,"ELEVATED"]:me,overrideFog:Ve});if(ne&&Je.imageAtlas){let Ge=Je.imageAtlas.patternPositions[ne.toString()];Ge&&Te.setConstantPatternPositions(Ge)}if(!ge&&oe&&ae&&Je.lineAtlas){let Ge=Je.lineAtlas.getDash(oe,ae);Ge&&Te.setConstantPatternPositions(Ge)}let[bt,yt]=h.paint.get("line-trim-offset");(ae==="round"||ae==="square")&&bt!==yt&&(bt===0&&(bt-=1),yt===1&&(yt+=1));let kt=Y?Qe.projMatrix:null,vt=ge?t.bU(f,Je,h,kt,Z,[bt,yt]):t.bV(f,Je,h,kt,Ze.lineClipsArray.length,Z,[bt,yt]);if(we){let Ge=Ze.gradients[h.id],Dt=Ge.texture;if(h.gradientVersion!==Ge.version){let ai=256;if(h.stepInterpolant){let ti=o.getSource().maxzoom,vi=Qe.canonical.z===ti?Math.ceil(1<<f.transform.maxZoom-Qe.canonical.z):1;ai=t.at(t.bW(Ze.maxLineLength/t.a3*1024*vi),256,D.maxTextureSize)}Ge.gradient=t.bX({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:ai,image:Ge.gradient||void 0,clips:Ze.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new t.T(D,Ge.gradient,A.RGBA),Ge.version=h.gradientVersion,Dt=Ge.texture}D.activeTexture.set(A.TEXTURE1),Dt.bind(h.stepInterpolant?A.NEAREST:A.LINEAR,A.CLAMP_TO_EDGE)}Q&&(D.activeTexture.set(A.TEXTURE0),Je.lineAtlasTexture&&Je.lineAtlasTexture.bind(A.LINEAR,A.REPEAT),Te.updatePaintBuffers()),ge&&(D.activeTexture.set(A.TEXTURE0),Je.imageAtlasTexture&&Je.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Te.updatePaintBuffers()),z&&f.terrain.setupElevationDraw(Je,Ye),f.uploadCommonUniforms(D,Ye,Qe.toUnwrapped());let it=Ge=>{Le!=null&&(Le.value=se*k),Ye.draw(f,A.TRIANGLES,U,Ge,H,t.af.disabled,vt,h.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,h.paint,f.transform.zoom,Te,[Ze.layoutVertexBuffer2,Ze.patternVertexBuffer,Ze.zOffsetVertexBuffer]),Le!=null&&(Le.value=se)};if(le&&!z){let Ge=f.stencilModeForClipping(Qe).ref;Ge===0&&Y&&D.clear({stencil:0});let Dt={func:A.EQUAL,mask:255};vt.u_alpha_discard_threshold=.8,it(new t.ag(Dt,Ge,255,A.KEEP,A.KEEP,A.INVERT)),vt.u_alpha_discard_threshold=0,it(new t.ag(Dt,Ge,255,A.KEEP,A.KEEP,A.KEEP))}else le&&z&&(vt.u_alpha_discard_threshold=.001),it(z?Be:f.stencilModeForClipping(Qe))}le&&(f.resetStencilClippingMasks(),Y&&D.clear({stencil:0})),k===0||f.depthOcclusion||Y||f.layersWithOcclusionOpacity.push(f.currentLayer),z&&(f.forceTerrainMode=!1)},fill:function(f,o,h,g){let v=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let S=h.paint.get("fill-emissive-strength"),k=f.colorModeForDrapableLayerRenderPass(S),D=h.paint.get("fill-pattern"),A=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&v.constantOr(t.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===A){let L=f.depthModeForSublayer(1,f.renderPass==="opaque"?t.ae.ReadWrite:t.ae.ReadOnly);Vp(f,o,h,g,L,k,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){let L=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,t.ae.ReadOnly);Vp(f,o,h,g,L,k,!0)}},"fill-extrusion":function(f,o,h,g){let v=h.paint.get("fill-extrusion-opacity"),x=f.context,S=x.gl,k=f.terrain,D=k&&k.renderingToTexture;if(v===0)return;let A=f.conflationActive&&f.style.isLayerClipped(h,o.getSource()),L=f.style.order.indexOf(h.fqid);if(A&&function(z,U,H,Y,Z){for(let X of Y){let Q=U.getTile(X).getBucket(H);Q&&(Q.updateReplacement(X,z.replacementSource,Z),Q.uploadCentroid(z.context))}}(f,o,h,g,L),k||A)for(let z of g){let U=o.getTile(z).getBucket(h);U&&Eu(f.context,o,z,U,h,k,A)}if(f.renderPass==="shadow"&&f.shadowRenderer){let z=f.shadowRenderer;if(k&&v<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.Z)return;let U=z.getShadowPassDepthMode(),H=z.getShadowPassColorMode();kc(f,o,h,g,U,t.ag.disabled,H,A)}else if(f.renderPass==="translucent"){let z=!h.paint.get("fill-extrusion-pattern").constantOr(1),U=h.paint.get("fill-extrusion-color").constantOr(t.C.white);if(!D&&U.a!==0){let H=new t.ae(f.context.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D);v===1&&z?kc(f,o,h,g,H,t.ag.disabled,t.a.unblended,A):(kc(f,o,h,g,H,t.ag.disabled,t.a.disabled,A),kc(f,o,h,g,H,f.stencilModeFor3D(),f.colorModeForRenderPass(),A),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&z&&(!k&&f.transform.projection.name!=="globe"||D)){let H=h.paint.get("fill-extrusion-opacity"),Y=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=h.paint.get("fill-extrusion-flood-light-intensity"),Q=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),re=Y>0&&Z>0,oe=X>0,ae=(ge,ne,se)=>(1-se)*ge+se*ne,_e=ge=>{let ne=f.depthModeForSublayer(1,t.ae.ReadOnly,S.LEQUAL,!0),se=h.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),le=ae(.1,3,se),we=f._showOverdrawInspector;if(!we){let Re=new t.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),me=new t.a([S.ONE,S.ONE,S.ONE,S.ONE],t.C.transparent,[!1,!1,!1,!0],S.MIN);ao(f,o,h,g,ne,Re,me,t.af.disabled,ge,"sdf",H,Y,Z,X,Q,le,A,!1)}{let Re=we?t.ag.disabled:new t.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),me=we?f.colorModeForRenderPass():new t.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],t.C.transparent,[!0,!0,!0,!0]);ao(f,o,h,g,ne,Re,me,t.af.disabled,ge,"color",H,Y,Z,X,Q,le,A,!1)}};if(D){let ge=(ne,se,le)=>{let we=f.depthModeForSublayer(1,t.ae.ReadOnly,S.LEQUAL,!1),Re=h.paint.get(ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),me=ae(.1,3,Re);{let Le=new t.a([S.ONE,S.ONE,S.ONE,S.ONE],t.C.transparent,[!1,!1,!1,!0]);ao(f,o,h,g,we,t.ag.disabled,Le,t.af.disabled,ne,"clear",H,Y,Z,X,Q,me,A,se)}{let Le=new t.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Be=new t.a([S.ONE,S.ONE,S.ONE,S.ONE],t.C.transparent,[!1,!1,!1,!0],S.MIN);ao(f,o,h,g,we,Le,Be,t.af.disabled,ne,"sdf",H,Y,Z,X,Q,me,A,se)}{let Le=ne?S.ZERO:S.ONE_MINUS_DST_ALPHA,Be=new t.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Qe=new t.a([Le,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],t.C.transparent,[!0,!0,!0,!0]);ao(f,o,h,g,we,Be,Qe,t.af.disabled,ne,"color",H,Y,Z,X,Q,me,A,se)}{let Le=new t.a([S.ONE,S.ONE,S.ONE,ne?S.ZERO:S.ONE],t.C.transparent,[!1,!1,!1,!0],ne?S.FUNC_ADD:S.MAX);ao(f,o,h,g,we,t.ag.disabled,Le,t.af.disabled,ne,"clear",H,Y,Z,X,Q,me,A,se,le)}};if(re||oe){let ne;if(f.prepareDrawTile(),k){let se=k.drapeBufferSize[0],le=k.drapeBufferSize[1];ne=k.framebufferCopyTexture,ne&&(!ne||ne.size[0]===se&&ne.size[1]===le)||(ne&&ne.destroy(),ne=k.framebufferCopyTexture=new t.T(x,new t.i({width:se,height:le}),S.RGBA)),ne.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,se,le,0)}re&&ge(!0,!1,ne),oe&&ge(!1,!0,ne)}}else re&&_e(!0),oe&&_e(!1)}}},hillshade:function(f,o,h,g){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;let v=f.context,x=f.terrain&&f.terrain.renderingToTexture,[S,k]=f.renderPass!=="translucent"||x?[{},g]:f.stencilConfigForOverlap(g);for(let D of k){let A=o.getTile(D);if(A.needsHillshadePrepare&&f.renderPass==="offscreen")Ea(f,A,h);else if(f.renderPass==="translucent"){let L=f.depthModeForSublayer(0,t.ae.ReadOnly),z=h.paint.get("hillshade-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(z),H=x&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):S[D.overscaledZ];Ey(f,D,A,h,L,H,U)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,o,h,g,v,x){if(f.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;let S=f.transform.projection.name==="globe",k=h.paint.get("raster-elevation")!==0,D=k&&S;if(f.renderElevatedRasterBackface&&!D)return;let A=f.context,L=A.gl,z=o.getSource(),U=function(ge,ne,se,le){let we=ne.paint.get("raster-color"),Re=ge.type==="raster-array",me=[],Le=ne.paint.get("raster-resampling"),Be=ne.paint.get("raster-color-mix"),Qe=ne.paint.get("raster-color-range"),Je=[Be[0],Be[1],Be[2],0],Ze=Be[3],Te=Le==="nearest"?le.NEAREST:le.LINEAR;if(Re&&(me.push("RASTER_ARRAY"),we||me.push("RASTER_COLOR"),Le==="linear"&&me.push("RASTER_ARRAY_LINEAR"),Te=le.NEAREST,!Qe&&ge.rasterLayers)){let Ve=ge.rasterLayers.find(({id:Ye})=>Ye===ne.sourceLayer);Ve&&Ve.fields&&Ve.fields.range&&(Qe=Ve.fields.range)}if(Qe=Qe||[0,1],we){me.push("RASTER_COLOR"),se.activeTexture.set(le.TEXTURE2),ne.updateColorRamp(Qe);let Ve=ne.colorRampTexture;Ve||(Ve=ne.colorRampTexture=new t.T(se,ne.colorRamp,le.RGBA)),Ve.bind(le.LINEAR,le.CLAMP_TO_EDGE)}return{mix:Je,range:Qe,offset:Ze,defines:me,resampling:Te}}(z,h,A,L);if(z instanceof t.bm&&!g.length&&!S)return;let H=h.paint.get("raster-emissive-strength"),Y=f.colorModeForDrapableLayerRenderPass(H),Z=f.terrain&&f.terrain.renderingToTexture,X=!f.options.moving,Q=h.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(z instanceof t.bm&&!g.length&&(z.onNorthPole||z.onSouthPole)){let ge=k?f.stencilModeFor3D():t.ag.disabled;return void ih(!!z.onNorthPole,null,f,o,h,H,U,t.af.disabled,ge)}if(!g.length)return;let[re,oe]=z instanceof t.bm||Z?[{},g]:f.stencilConfigForOverlap(g),ae=oe[oe.length-1].overscaledZ;D&&U.defines.push("PROJECTION_GLOBE_VIEW"),k&&U.defines.push("RENDER_CUTOFF");let _e=(ge,ne,se)=>{for(let le of ge){let we=le.toUnwrapped(),Re=o.getTile(le);if(Z&&(!Re||!Re.hasData()))continue;A.activeTexture.set(L.TEXTURE0);let me=Ly(Re,z,h,U);if(!me||!me.texture)continue;let{texture:Le,mix:Be,offset:Qe,tileSize:Je,buffer:Ze}=me,Te,Ve;Z?(Te=t.ae.disabled,Ve=le.projMatrix):k?(Te=new t.ae(L.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D),Ve=S?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(we,X)):(Te=f.depthModeForSublayer(le.overscaledZ-ae,h.paint.get("raster-opacity")===1?t.ae.ReadWrite:t.ae.ReadOnly,L.LESS),Ve=f.transform.calculateProjMatrix(we,X));let Ye=f.terrain&&Z?f.terrain.stencilModeForRTTOverlap(le):re[le.overscaledZ],bt=x?0:h.paint.get("raster-fade-duration");Re.registerFadeDuration(bt);let yt=o.findLoadedParent(le,0),kt=yu(Re,yt,o,f.transform,bt),vt,it;f.terrain&&f.terrain.prepareDrawTile(),A.activeTexture.set(L.TEXTURE0),Le.bind(Q,L.CLAMP_TO_EDGE),A.activeTexture.set(L.TEXTURE1),yt?(yt.texture&&yt.texture.bind(Q,L.CLAMP_TO_EDGE),vt=Math.pow(2,yt.tileID.overscaledZ-Re.tileID.overscaledZ),it=[Re.tileID.canonical.x*vt%1,Re.tileID.canonical.y*vt%1]):Le.bind(Q,L.CLAMP_TO_EDGE),Le.useMipmap&&A.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);let Ge=f.transform,Dt,ai=k?Bi(Ge):[0,0,0,0],ti,vi,Ai,Ki,Kt,Gi=0;if(D&&z instanceof t.bm&&z.coordinates.length>3)ti=Float32Array.from(t.bf(t.bg(new t.aO(0,0,0)))),vi=Float32Array.from(Ge.globeMatrix),Ai=Float32Array.from(t.bb(Ge)),Ki=[t.aj(Ge.center.lng),t.ak(Ge.center.lat)],Dt=z.elevatedGlobePerspectiveTransform,Kt=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){let ni=t.bc(le.canonical);Gi=t.bd(ni.getCenter().lat),ti=Float32Array.from(t.bf(t.bg(le.canonical))),vi=Float32Array.from(Ge.globeMatrix),Ai=Float32Array.from(t.bb(Ge)),Ki=[t.aj(Ge.center.lng),t.ak(Ge.center.lat)],Dt=[0,0],Kt=Float32Array.from(t.be(le.canonical,ni,Gi,Ge.worldSize/Ge._pixelsPerMercatorPixel))}else Dt=z instanceof t.bm?z.perspectiveTransform:[0,0],ti=new Float32Array(16),vi=new Float32Array(9),Ai=new Float32Array(16),Ki=[0,0],Kt=new Float32Array(9);let hn=Xd(Ve,ti,vi,Ai,Kt,it||[0,0],t.a1(f.transform.zoom),Ki,ai,vt||1,kt,h,Dt,k?h.paint.get("raster-elevation"):0,2,Be,Qe,U.range,Je,Ze,H),Xi=f.isTileAffectedByFog(le),Ci=f.getOrCreateProgram("raster",{defines:U.defines,overrideFog:Xi});if(f.uploadCommonUniforms(A,Ci,we),z instanceof t.bm){let ni=z.elevatedGlobeVertexBuffer,gn=z.elevatedGlobeIndexBuffer;if(Z||!S)z.boundsBuffer&&z.boundsSegments&&Ci.draw(f,L.TRIANGLES,Te,t.ag.disabled,Y,t.af.disabled,hn,h.id,z.boundsBuffer,f.quadTriangleIndexBuffer,z.boundsSegments);else if(ni&&gn){let xn=Ge.zoom<=t.b1?z.elevatedGlobeSegments:z.getSegmentsForLongitude(Ge.center.lng);xn&&Ci.draw(f,L.TRIANGLES,Te,t.ag.disabled,Y,ne,hn,h.id,ni,gn,xn)}}else if(D){Te=new t.ae(L.LEQUAL,t.ae.ReadOnly,f.depthRangeFor3D);let ni=f.globeSharedBuffers;if(ni){let[gn,xn,nn]=ni.getGridBuffers(Gi,!1);Ci.draw(f,L.TRIANGLES,Te,se||Ye,f.colorModeForRenderPass(),ne,hn,h.id,gn,xn,nn)}}else{let{tileBoundsBuffer:ni,tileBoundsIndexBuffer:gn,tileBoundsSegments:xn}=f.getTileBoundsBuffers(Re);Ci.draw(f,L.TRIANGLES,Te,Ye,Y,t.af.disabled,hn,h.id,ni,gn,xn)}}if(!(z instanceof t.bm)&&D)for(let le of ge){let we=le.canonical.y===(1<<le.canonical.z)-1;le.canonical.y===0&&ih(!0,le,f,o,h,H,U,ne,se||t.ag.disabled),we&&ih(!1,le,f,o,h,H,U,ne===t.af.frontCW?t.af.backCW:t.af.frontCW,se||t.ag.disabled)}};D?_e(oe,f.renderElevatedRasterBackface?t.af.backCW:t.af.frontCW,f.stencilModeFor3D()):_e(oe,t.af.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,o,h,g,v,x){f.renderPass==="offscreen"&&function(S,k,D,A){if(!A.length)return;let L=S.context,z=L.gl,U=k.getSource();if(!(U instanceof vc))return;let H=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count"))),Y=D.particlePositionRGBAImage;if(!Y||Y.width!==H){let oe=function(ae){let _e=ae*ae,ge=new Uint8Array(4*_e),ne=function(le){return le|=0,le=Math.imul(2747636419^le,2654435769),le=Math.imul(le^le>>>16,2654435769),((le=Math.imul(le^le>>>16,2654435769))>>>0)/4294967296},se=1/1.3;for(let le=0;le<_e;le++){let we=se*(ne(2*le+0)+Ps),Re=se*(ne(2*le+1)+Ps),me=255*we%1,Le=255*Re%1,Be=me,Qe=Re-Le/255,Je=Le;ge[4*le+0]=255*(we-me/255),ge[4*le+1]=255*Be,ge[4*le+2]=255*Qe,ge[4*le+3]=255*Je}return ge}(H);Y=D.particlePositionRGBAImage=new t.i({width:H,height:H},oe)}let Z=D.particleFramebuffer;Z?Z.width!==H&&(Z.destroy(),Z=D.particleFramebuffer=L.createFramebuffer(H,H,!0,null)):Z=D.particleFramebuffer=L.createFramebuffer(H,H,!0,null);let X=[];for(let oe of A){let ae=k.getTile(oe);if(!(ae instanceof t.c3))continue;let _e=Wt(ae,U,D);if(!_e)continue;let ge=[ae.tileSize,ae.tileSize],ne=D.tileFramebuffer;ne||(ne=D.tileFramebuffer=L.createFramebuffer(ge[0],ge[1],!0,null));let se=ae.rasterParticleState;se||(se=ae.rasterParticleState=new Bo(L,oe,ge,Y));let le=se.update(D.lastInvalidatedAt);se.particleTextureDimension!==H&&se.updateParticleTexture(oe,Y);let we=se.targetColorTexture;se.targetColorTexture=se.backgroundColorTexture,se.backgroundColorTexture=we;let Re=se.particleTexture0;se.particleTexture0=se.particleTexture1,se.particleTexture1=Re,X.push([oe,_e,se,le])}if(X.length===0)return;let Q=t.e.now(),re=D.previousDrawTimestamp?.001*(Q-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=Q,D.hasColorMap()){L.activeTexture.set(z.TEXTURE0+2);let oe=D.colorRampTexture;oe||(oe=D.colorRampTexture=new t.T(L,D.colorRamp,z.RGBA)),oe.bind(z.LINEAR,z.CLAMP_TO_EDGE)}L.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(oe,ae,_e){let ge=oe.context,ne=ge.gl,se=ae.tileFramebuffer;ge.activeTexture.set(ne.TEXTURE0);let le={u_texture:0,u_opacity:1.05*(Re=ae.paint.get("raster-particle-fade-opacity-factor"))/(Re+.05)},we=oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Re;for(let me of _e){let[,,Le,Be]=me;se.colorAttachment.set(Le.targetColorTexture.texture),ge.viewport.set([0,0,se.width,se.height]),ge.clear({color:t.C.transparent}),Be&&(Le.backgroundColorTexture.bind(ne.NEAREST,ne.CLAMP_TO_EDGE),we.draw(oe,ne.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,le,ae.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments))}}(S,D,X),function(oe,ae,_e,ge){let ne=oe.context,se=ne.gl,le=_e.tileFramebuffer,we=oe.transform.projection.name==="globe",Re=_e.paint.get("raster-particle-max-speed");for(let me of ge){let[Le,Be,Qe]=me;ne.activeTexture.set(se.TEXTURE0+0),Be.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE),le.colorAttachment.set(Qe.targetColorTexture.texture);let Je=oe.getOrCreateProgram("rasterParticleDraw",{defines:Be.defines,overrideFog:!1});ne.activeTexture.set(se.TEXTURE0+1);let Ze=Be.scalarData?[]:[0,1,2,3].map(Ye=>t.bZ[Ye](Le));Ze.push(Le);let Te=Le.canonical.x,Ve=Le.canonical.y;for(let Ye of Ze){let bt=ae.getTile(we?Ye.wrapped():Ye);if(!bt)continue;let yt=bt.rasterParticleState;if(!yt)continue;let kt=Ye.canonical.x+(1<<Ye.canonical.z)*(Ye.wrap-Le.wrap),vt=Ye.canonical.y;yt.particleTexture0.bind(se.NEAREST,se.CLAMP_TO_EDGE);let it=zp(1,yt.particleTexture0.size[0],[kt-Te,vt-Ve],0,Be.texture.size,2,Re,Be.textureOffset,Be.scale,Be.offset);Je.draw(oe,se.POINTS,t.ae.disabled,t.ag.disabled,t.a.alphaBlended,t.af.disabled,it,_e.id,yt.particleIndexBuffer,void 0,yt.particleSegment)}}}(S,k,D,X),L.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(oe,ae,_e,ge){let ne=oe.context,se=ne.gl,le=ae.paint.get("raster-particle-max-speed"),we=ge*ae.paint.get("raster-particle-speed-factor")*.15,Re=function(Le){return Math.pow(Le,6)}(.01+1*ae.paint.get("raster-particle-reset-rate-factor")),me=ae.particleFramebuffer;ne.viewport.set([0,0,me.width,me.height]);for(let Le of _e){let[,Be,Qe]=Le;ne.activeTexture.set(se.TEXTURE0+0),Be.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE),ne.activeTexture.set(se.TEXTURE0+1);let Je=Qe.particleTexture0;Je.bind(se.NEAREST,se.CLAMP_TO_EDGE);let Ze=Ay(1,Je.size[0],0,Be.texture.size,le,we,Re,Be.textureOffset,Be.scale,Be.offset);me.colorAttachment.set(Qe.particleTexture1.texture),ne.clear({color:t.C.transparent}),oe.getOrCreateProgram("rasterParticleUpdate",{defines:Be.defines}).draw(oe,se.TRIANGLES,t.ae.disabled,t.ag.disabled,t.a.unblended,t.af.disabled,Ze,ae.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments)}}(S,D,X,re)}(f,o,h,g),f.renderPass==="translucent"&&(function(S,k,D,A,L){let z=S.context,U=z.gl,H=!S.options.moving,Y=S.transform.projection.name==="globe";if(!A.length)return;let[Z,X]=S.stencilConfigForOverlap(A),Q=[];Y&&Q.push("PROJECTION_GLOBE_VIEW");let re=S.stencilModeFor3D();for(let oe of X){let ae=oe.toUnwrapped(),_e=k.getTile(oe);if(!_e.rasterParticleState)continue;let ge=_e.rasterParticleState,ne=100;_e.registerFadeDuration(ne);let se=k.findLoadedParent(oe,0),le=yu(_e,se,k,S.transform,ne),we,Re;S.terrain&&S.terrain.prepareDrawTile(),z.activeTexture.set(U.TEXTURE0),ge.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),z.activeTexture.set(U.TEXTURE1),se&&se.rasterParticleState?(se.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),we=Math.pow(2,se.tileID.overscaledZ-_e.tileID.overscaledZ),Re=[_e.tileID.canonical.x*we%1,_e.tileID.canonical.y*we%1]):ge.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let me=Y?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(ae,H),Le=S.transform,Be=d_(Le),Qe=t.bc(oe.canonical),Je=t.bd(Qe.getCenter().lat),Ze,Te,Ve,Ye,bt;Y?(Ze=Float32Array.from(t.bf(t.bg(oe.canonical))),Te=Float32Array.from(Le.globeMatrix),Ve=Float32Array.from(t.bb(Le)),Ye=[t.aj(Le.center.lng),t.ak(Le.center.lat)],bt=Float32Array.from(t.be(oe.canonical,Qe,Je,Le.worldSize/Le._pixelsPerMercatorPixel))):(Ze=new Float32Array(16),Te=new Float32Array(9),Ve=new Float32Array(16),Ye=[0,0],bt=new Float32Array(9));let yt=Fp(me,Ze,Te,Ve,bt,Re||[0,0],t.a1(S.transform.zoom),Ye,Be,we||1,le,250),kt=S.isTileAffectedByFog(oe),vt=S.getOrCreateProgram("rasterParticle",{defines:Q,overrideFog:kt});if(S.uploadCommonUniforms(z,vt,ae),Y){let it=new t.ae(U.LEQUAL,t.ae.ReadWrite,S.depthRangeFor3D),Ge=0,Dt=S.globeSharedBuffers;if(Dt){let[ai,ti,vi]=Dt.getGridBuffers(Je,Ge!==0);vt.draw(S,U.TRIANGLES,it,re,t.a.alphaBlended,t.af.backCCW,yt,D.id,ai,ti,vi)}}else{let it=S.depthModeForSublayer(0,t.ae.ReadOnly),Ge=Z[oe.overscaledZ],{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:ai,tileBoundsSegments:ti}=S.getTileBoundsBuffers(_e);vt.draw(S,U.TRIANGLES,it,Ge,t.a.alphaBlended,t.af.disabled,yt,D.id,Dt,ai,ti)}}S.resetStencilClippingMasks()}(f,o,h,g),f.style.map.triggerRepaint())},background:function(f,o,h,g){let v=h.paint.get("background-color"),x=h.paint.get("background-opacity"),S=h.paint.get("background-emissive-strength");if(x===0)return;let k=f.context,D=k.gl,A=f.transform,L=A.tileSize,z=h.paint.get("background-pattern"),U;if(z!==void 0&&(z===null||(U=f.imageManager.getPattern(z.toString(),h.scope,f.style.getLut(h.scope)),!U)))return;let H=!z&&v.a===1&&x===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==H)return;let Y=t.ag.disabled,Z=f.depthModeForSublayer(0,H==="opaque"?t.ae.ReadWrite:t.ae.ReadOnly),X=f.colorModeForDrapableLayerRenderPass(S),Q=z?"backgroundPattern":"background",re,oe=g;oe||(re=f.getBackgroundTiles(),oe=Object.values(re).map(ae=>ae.tileID)),z&&(k.activeTexture.set(D.TEXTURE0),f.imageManager.bind(f.context,h.scope));for(let ae of oe){let _e=f.isTileAffectedByFog(ae),ge=f.getOrCreateProgram(Q,{overrideFog:_e}),ne=ae.toUnwrapped(),se=g?ae.projMatrix:f.transform.calculateProjMatrix(ne);f.prepareDrawTile();let le=o?o.getTile(ae):re?re[ae.key]:new t.by(ae,L,A.zoom,f),we=z?r_(se,S,x,f,0,h.scope,U,{tileID:ae,tileSize:L}):Kd(se,S,x,v.toRenderColor(h.lut));f.uploadCommonUniforms(k,ge,ne);let{tileBoundsBuffer:Re,tileBoundsIndexBuffer:me,tileBoundsSegments:Le}=f.getTileBoundsBuffers(le);ge.draw(f,D.TRIANGLES,Z,Y,X,t.af.disabled,we,h.id,Re,me,Le)}},sky:function(f,o,h){let g=f._atmosphere?t.a1(f.transform.zoom):1,v=h.paint.get("sky-opacity")*g;if(v===0)return;let x=f.context,S=h.paint.get("sky-type"),k=new t.ae(x.gl.LEQUAL,t.ae.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?h.needsSkyboxCapture(f)&&(function(A,L,z,U){let H=A.context,Y=H.gl,Z=L.skyboxFbo;if(!Z){Z=L.skyboxFbo=H.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Ec(H),L.skyboxTexture=H.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,L.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let oe=0;oe<6;++oe)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(Z.framebuffer),H.viewport.set([0,0,32,32]);let X=L.getCenter(A,!0),Q=A.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);t.ad.identity(re),t.ad.rotateY(re,re,.5*-Math.PI),Oa(A,L,Q,re,X,0),t.ad.identity(re),t.ad.rotateY(re,re,.5*Math.PI),Oa(A,L,Q,re,X,1),t.ad.identity(re),t.ad.rotateX(re,re,.5*-Math.PI),Oa(A,L,Q,re,X,2),t.ad.identity(re),t.ad.rotateX(re,re,.5*Math.PI),Oa(A,L,Q,re,X,3),t.ad.identity(re),Oa(A,L,Q,re,X,4),t.ad.identity(re),t.ad.rotateY(re,re,Math.PI),Oa(A,L,Q,re,X,5),H.viewport.set([0,0,A.width,A.height])}(f,h),h.markSkyboxValid(f)):f.renderPass==="sky"&&function(A,L,z,U,H){let Y=A.context,Z=Y.gl,X=A.transform,Q=A.getOrCreateProgram("skybox");Y.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,L.skyboxTexture);let re=((oe,ae,_e,ge,ne)=>({u_matrix:oe,u_sun_direction:ae,u_cubemap:0,u_opacity:ge,u_temporal_offset:ne}))(X.skyboxMatrix,L.getCenter(A,!1),0,U,H);A.uploadCommonUniforms(Y,Q),Q.draw(A,Z.TRIANGLES,z,t.ag.disabled,A.colorModeForRenderPass(),t.af.backCW,re,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,h,k,v,D):S==="gradient"&&f.renderPass==="sky"&&function(A,L,z,U,H){let Y=A.context,Z=Y.gl,X=A.transform,Q=A.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Ec(Y)),Y.activeTexture.set(Z.TEXTURE0);let re=L.colorRampTexture;re||(re=L.colorRampTexture=new t.T(Y,L.colorRamp,Z.RGBA)),re.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let oe=((ae,_e,ge,ne,se)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:_e,u_radius:t.ab(ge),u_opacity:ne,u_temporal_offset:se}))(X.skyboxMatrix,L.getCenter(A,!1),L.paint.get("sky-gradient-radius"),U,H);A.uploadCommonUniforms(Y,Q),Q.draw(A,Z.TRIANGLES,z,t.ag.disabled,A.colorModeForRenderPass(),t.af.backCW,oe,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,h,k,v,D)},debug:function(f,o,h,g,v,x){for(let S=0;S<h.length;S++)if(v){let A=new t.C(g.r*.8,g.g*.8,g.b*.8,1);Tt(f,o,h[S],g,-1,-1,x),Tt(f,o,h[S],g,-1,1,x),Tt(f,o,h[S],g,1,1,x),Tt(f,o,h[S],g,1,-1,x),Tt(f,o,h[S],A,0,0,x)}else Tt(f,o,h[S],g,0,0,x)},custom:function(f,o,h,g){let v=f.context,x=h.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&h.isDraped(o)){if(f.renderPass==="offscreen"){let S=x.prerender;if(S){if(f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){let k=f.transform.pointMerc;S.call(x,v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),t.a1(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else S.call(x,v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){let k=x.renderToTile;if(k){let D=g[0].canonical,A=new t.Y(D.x+g[0].wrap*(1<<D.z),D.y,D.z);v.setDepthMode(t.ae.disabled),v.setStencilMode(t.ag.disabled),v.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),k.call(x,v.gl,A),v.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),v.setStencilMode(t.ag.disabled);let S=x.renderingMode==="3d"?new t.ae(f.context.gl.LEQUAL,t.ae.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,t.ae.ReadOnly);if(v.setDepthMode(S),f.transform.projection.name==="globe"){let k=f.transform.pointMerc;x.render(v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),t.a1(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else x.render(v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState(),v.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,o,h,g){if(f.renderPass==="opaque")return;let v=h.paint.get("model-opacity");if(v===0)return;let x=h.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!x||f.terrain&&v<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof t.Z))return;let S=f.shadowRenderer,k=h.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,k||(S.enabled=!1));let D=()=>{S&&(S.useNormalOffset=!0,k||(S.enabled=!0))},A=o.getSource();if(f.renderPass==="light-beam"&&A.type!=="batched-model")return;if(A.type==="vector"||A.type==="geojson")return function(Q,re,oe,ae,_e){let ge=Q.transform;if(ge.projection.name!=="mercator")return void t.w(`Drawing 3D models for ${ge.projection.name} projection is not yet implemented`);let ne=ge.getFreeCameraOptions().position;if(!Q.modelManager)return;let se=Q.modelManager;oe.modelManager=se;let le=Q.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let we=oe._unevaluatedLayout._values["model-id"],Re=Ji({},oe.layout.get("model-id").parameters),me=Q.style.order.indexOf(oe.fqid);for(let Le of ae){let Be=re.getTile(Le).getBucket(oe);if(!Be||Be.projection.name!==ge.projection.name)continue;let Qe=Be.getModelUris();Qe&&!Be.modelsRequested&&(se.addModelsFromBucket(Qe,_e),Be.modelsRequested=!0);let Je=hr(Le,ge);Re.zoom=Je;let Ze=we.possiblyEvaluate(Re);if(h_(Q,Be,Le),co.shadowUniformsInitialized=!1,co.useSingleShadowCascade=!!le&&le.getMaxCascadeForTile(Le.toUnwrapped())===0,Q.renderPass==="shadow"&&le){if(Q.currentShadowCascade===1&&Be.isInsideFirstShadowMapFrustum)continue;let Ye=ge.calculatePosMatrix(Le.toUnwrapped(),ge.worldSize);if(co.tileMatrix.set(Ye),co.shadowTileMatrix=Float32Array.from(le.calculateShadowPassMatrixFromMatrix(Ye)),co.aabb.min.fill(0),co.aabb.max[0]=co.aabb.max[1]=t.a3,co.aabb.max[2]=0,xr(Be,co,Q,oe.scope))continue}let Te=1<<Le.canonical.z,Ve=[((ne.x-Le.wrap)*Te-Le.canonical.x)*t.a3,(ne.y*Te-Le.canonical.y)*t.a3,ne.z*Te*t.a3];Q.conflationActive&&Object.keys(Be.instancesPerModel).length>0&&Q.style.isLayerClipped(oe,re.getSource())&&Be.updateReplacement(Le,Q.replacementSource,me)&&(Be.uploaded=!1,Be.upload(Q.context));for(let Ye in Be.instancesPerModel){let bt=Be.instancesPerModel[Ye];bt.features.length>0&&(Ye=Ze.evaluate(bt.features[0].feature,{}));let yt=se.getModel(Ye,_e);if(yt&&yt.uploaded)for(let kt of yt.nodes)Uo(Q,oe,kt,bt,Ve,Le,co)}}}(f,o,h,g,A.type==="vector"?h.scope:""),void D();if(!A.loaded())return;if(A.type==="batched-model")return function(Q,re,oe,ae){oe.resetLayerRenderingStats(Q);let _e=Q.context,ge=Q.transform,ne=Q.style.fog,se=Q.shadowRenderer;if(ge.projection.name!=="mercator")return void t.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);let le=Q.transform.getFreeCameraOptions().position,we=t._.scale([],[le.x,le.y,le.z],Q.transform.worldSize);t._.negate(we,we);let Re=t.ad.identity([]),me=t.cg(ge.center.lat,ge.zoom),Le=t.ad.fromScaling([],[1,1,1/me]);t.ad.translate(Re,Re,we);let Be=oe.paint.get("model-opacity"),Qe=new t.ae(_e.gl.LEQUAL,t.ae.ReadWrite,Q.depthRangeFor3D),Je=new t.ae(_e.gl.LEQUAL,t.ae.ReadOnly,Q.depthRangeFor3D),Ze=new t.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Te=Q.renderPass==="shadow",Ve=Te&&se?se.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),Ye=oe.paint.get("model-front-cutoff"),bt=Ye[2]<1,yt=Qa(Q,oe.paint.get("model-cutoff-fade-range")),kt=oe.getLayerRenderingStats();(function(vt,it,Ge,Dt){let ai=vt.terrain?vt.terrain.exaggeration():0,ti=vt.transform.zoom;for(let vi of Dt){let Ai=it.getTile(vi).getBucket(Ge);Ai&&(vt.conflationActive&&Ai.updateReplacement(vi,vt.replacementSource),Ai.evaluateScale(vt,Ge),vt.terrain&&ai>0&&Ai.elevationUpdate(vt.terrain,ai,vi,Ge.source),Ai.needsReEvaluation(vt,ti,Ge)&&Ai.evaluate(Ge))}})(Q,re,oe,ae),function(){let vt,it,Ge;bt?(vt=ae.length-1,it=-1,Ge=-1):(vt=0,it=ae.length,Ge=1);for(let Dt=vt;Dt!==it;Dt+=Ge){let ai=ae[Dt],ti=re.getTile(ai).getBucket(oe);if(!ti||!ti.uploaded)continue;let vi=!1;se&&(vi=se.getMaxCascadeForTile(ai.toUnwrapped())===0);let Ai=ge.calculatePosMatrix(ai.toUnwrapped(),ge.worldSize),Ki=ti.modelTraits,Kt=[];for(let Gi of ti.getNodesInfo()){if(Gi.hiddenByReplacement||!Gi.node.meshes)continue;let hn=Gi.node,Xi=0;Q.terrain&&hn.elevation&&(Xi=hn.elevation*Q.terrain.exaggeration());let Ci=Gi.evaluatedScale;if(Ci[0]<=1&&Ci[1]<=1&&Ci[2]<=1&&(()=>{let Oe=Gi.aabb;return Ze.min=[...Oe.min],Ze.max=[...Oe.max],Ze.min[2]+=Xi,Ze.max[2]+=Xi,t._.transformMat4(Ze.min,Ze.min,Ai),t._.transformMat4(Ze.max,Ze.max,Ai),Ze})().intersects(Ve)===0)continue;let ni=[...Ai],gn=hn.anchor?hn.anchor[0]:0,xn=hn.anchor?hn.anchor[1]:0;t.ad.translate(ni,ni,[gn*(Ci[0]-1),xn*(Ci[1]-1),Xi]),t._.exactEquals(Ci,t.cj)||t.ad.scale(ni,ni,Ci);let nn=t.ad.multiply([],ni,hn.matrix),Ke=t.ad.multiply([],ge.expandedFarZProjMatrix,nn),St=t.ad.multiply([],ge.expandedFarZProjMatrix,ni),An=t.aA.transformMat4([],[gn,xn,Xi,1],Ke)[2];hn.hidden=!1;let qi=Be;Te||(bt&&(qi*=ha(ni,ge,Gi.aabb,Ye)),qi*=Gp(yt,An)),qi!==0?Kt.push({nodeInfo:Gi,depth:An,opacity:qi,wvpForNode:Ke,wvpForTile:St,nodeModelMatrix:nn,tileModelMatrix:ni}):hn.hidden=!0}Te||Kt.sort((Gi,hn)=>!bt||Gi.opacity===1&&hn.opacity===1?Gi.depth<hn.depth?-1:1:Gi.opacity===1?-1:hn.opacity===1?1:Gi.depth>hn.depth?-1:1);for(let Gi of Kt){let hn=Gi.nodeInfo,Xi=hn.node,Ci=t.ad.multiply([],Le,Gi.tileModelMatrix);t.ad.multiply(Ci,Re,Ci);let ni=t.ad.invert([],Ci);t.ad.transpose(ni,ni),t.ad.scale(ni,ni,es),Ci=t.ad.multiply(Ci,Ci,Xi.matrix);let gn=Q.renderPass==="light-beam",xn=Ki&t.cl.HasMapboxMeshFeatures,nn=xn?0:hn.evaluatedRMEA[0][2];for(let Ke=0;Ke<Xi.meshes.length;++Ke){let St=Xi.meshes[Ke],An=Ke===Xi.lightMeshIndex,qi=Gi.wvpForNode;if(An){if(!gn&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}qi=Gi.wvpForTile}else if(gn)continue;let Oe={defines:[]},Oo=[];if(rh(Oe.defines,Oo,St,Q,oe.lut),xn||Oe.defines.push("DIFFUSE_SHADED"),vi&&Oe.defines.push("SHADOWS_SINGLE_CASCADE"),kt&&(Te?kt.numRenderedVerticesInShadowPass+=St.vertexArray.length:kt.numRenderedVerticesInTransparentPass+=St.vertexArray.length),Te){lo(St,Gi.nodeModelMatrix,Q,oe);continue}let Fr=null;if(ne){let Vs=Dc(Gi.nodeModelMatrix,Q.transform);if(Fr=new Float32Array(Vs),ge.projection.name!=="globe"){let js=St.aabb.min,is=St.aabb.max,[La,ns]=ne.getOpacityForBounds(Vs,js[0],js[1],is[0],is[1]);Oe.overrideFog=La>=Mn||ns>=Mn}}let Jr=St.material,wr;Jr.occlusionTexture&&Jr.occlusionTexture.offsetScale&&(wr=Jr.occlusionTexture.offsetScale,Oe.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Te&&se&&(se.useNormalOffset=!!St.normalBuffer);let ho=Q.getOrCreateProgram("model",Oe);!Te&&se&&se.setupShadowsFromMatrix(Gi.tileModelMatrix,ho,se.useNormalOffset),Q.uploadCommonUniforms(_e,ho,null,Fr);let fa=Jr.pbrMetallicRoughness;fa.metallicFactor=.9,fa.roughnessFactor=.5;let Ro=Jd(new Float32Array(qi),new Float32Array(Ci),new Float32Array(ni),new Float32Array(Xi.matrix),Q,Gi.opacity,fa.baseColorFactor.toRenderColor(null),Jr.emissiveFactor,fa.metallicFactor,fa.roughnessFactor,Jr,nn,oe,[0,0,0],wr);!An&&(hn.hasTranslucentParts||Gi.opacity<1)&&ho.draw(Q,_e.gl.TRIANGLES,Qe,t.ag.disabled,t.a.disabled,t.af.backCCW,Ro,oe.id,St.vertexBuffer,St.indexBuffer,St.segments,oe.paint,Q.transform.zoom,void 0,Oo),ho.draw(Q,_e.gl.TRIANGLES,An?Je:Qe,t.ag.disabled,An||Gi.opacity<1||hn.hasTranslucentParts?t.a.alphaBlended:t.a.unblended,t.af.backCCW,Ro,oe.id,St.vertexBuffer,St.indexBuffer,St.segments,oe.paint,Q.transform.zoom,void 0,Oo)}}}}()}(f,o,h,g),void D();let L=A.getModels(),z=[],U=f.transform.getFreeCameraOptions().position,H=t._.scale([],[U.x,U.y,U.z],f.transform.worldSize);t._.negate(H,H);let Y=[],Z=[],X=0;for(let Q of L){let re=h.paint.get("model-rotation").constantOr(null),oe=h.paint.get("model-scale").constantOr(null),ae=h.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(f,re,oe,ae,!0,!0,!1);let _e=t.ad.identity([]),ge=t.cg(Q.position.lat,f.transform.zoom),ne=t.ad.fromScaling([],[1,1,1/ge]);t.ad.translate(_e,_e,H),z.push({zScaleMatrix:ne,negCameraPosMatrix:_e});for(let se of Q.nodes)$r(f.transform,se,Q.matrix,f.transform.expandedFarZProjMatrix,X,Y,Z);X++}if(Y.sort((Q,re)=>re.depth-Q.depth),f.renderPass!=="shadow"){if(v===1)for(let Q of Z)yl(Q,f,h,z[Q.modelIndex],t.ag.disabled,f.colorModeForRenderPass());else{for(let Q of Z)yl(Q,f,h,z[Q.modelIndex],t.ag.disabled,t.a.disabled);for(let Q of Z)yl(Q,f,h,z[Q.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(let Q of Y)yl(Q,f,h,z[Q.modelIndex],t.ag.disabled,f.colorModeForRenderPass());D()}else{for(let Q of Z)lo(Q.mesh,Q.nodeModelMatrix,f,h);for(let Q of Y)lo(Q.mesh,Q.nodeModelMatrix,f,h);D()}}},u_={model:function(f,o,h){let g=o.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,g.type==="vector"?f.scope:""));if(g.type==="batched-model")return;let v=g.getModels();for(let x of v)x.upload(h.context)},raster:function(f,o,h){let g=o.getSource();if(!(g instanceof vc&&g.loaded()))return;let v=f.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=f.paint.get("raster-array-band")||g.getInitialBand(v);if(x==null)return;let S=o.getIds().map(k=>o.getTileByID(k));for(let k of S)k.updateNeeded(v,x)&&g.prepareTile(k,v,x)},"raster-particle":function(f,o,h){let g=o.getSource();if(!(g instanceof vc&&g.loaded()))return;let v=f.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=f.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(x==null)return;let S=o.getIds().map(k=>o.getTileByID(k));for(let k of S)k.updateNeeded(v,x)&&g.prepareTile(k,v,x)}};class m_{constructor(o,h,g,v){this.context=new Ld(o,h),this.occlusionBuffers=new zy(this.context),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=t.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let S of x)this._debugParams.enabledLayers[S]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let S of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.symbolParams=new sc(v),this.setup(),this.numSublayers=t.bv.maxUnderzooming+t.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new gu(this),this._wireframeDebugCache=new ah,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(o,h){let g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Dp(this,o));let v=this._terrain;this.transform.elevation=g?v:null,v.update(o,this.transform,h),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(o){let h=o.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);let x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Dp(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,h){if(this.width=o*t.e.devicePixelRatio,this.height=h*t.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style.order)this.style._mergedLayers[g].resize()}setup(){let o=this.context,h=new t.bt;h.emplaceBack(0,0),h.emplaceBack(t.a3,0),h.emplaceBack(0,t.a3),h.emplaceBack(t.a3,t.a3),this.tileExtentBuffer=o.createVertexBuffer(h,t.br.members),this.tileExtentSegments=t.b.simpleSegment(0,0,4,2);let g=new t.bt;g.emplaceBack(0,0),g.emplaceBack(t.a3,0),g.emplaceBack(0,t.a3),g.emplaceBack(t.a3,t.a3),this.debugBuffer=o.createVertexBuffer(g,t.br.members),this.debugSegments=t.b.simpleSegment(0,0,4,5);let v=new t.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,t.br.members),this.viewportSegments=t.b.simpleSegment(0,0,4,2);let x=new t.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(t.a3,0,t.a3,0),x.emplaceBack(0,t.a3,0,t.a3),x.emplaceBack(t.a3,t.a3,t.a3,t.a3),this.mercatorBoundsBuffer=o.createVertexBuffer(x,t.cq.members),this.mercatorBoundsSegments=t.b.simpleSegment(0,0,4,2);let S=new t.bu;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(S);let k=new t.cr;for(let A of[0,1,3,2,0])k.emplaceBack(A);this.debugIndexBuffer=o.createIndexBuffer(k),this.emptyTexture=new t.T(o,new t.i({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=t.ad.create();let D=this.context.gl;this.stencilClearMode=new t.ag({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,t.ae.disabled,this.stencilClearMode,t.a.disabled,t.af.disabled,bu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,h,g){if(!h||this.currentStencilSource===h.id||!o.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(let D of g)if(this._tileClippingMaskIDs[D.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=h.id;let v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(t.a.disabled),v.setDepthMode(t.ae.disabled);let S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let k of g){let D=h.getTile(k),A=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:z,tileBoundsSegments:U}=this.getTileBoundsBuffers(D);S.draw(this,x.TRIANGLES,t.ae.disabled,new t.ag({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),t.a.disabled,t.af.disabled,bu(k.projMatrix),"$clipping",L,z,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,h=this.context.gl;return new t.ag({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);let h=this.context.gl;return new t.ag({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){let h=this.context.gl,g=o.sort((S,k)=>k.overscaledZ-S.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let S={};for(let k=0;k<x;k++)S[k+v]=new t.ag({func:h.GEQUAL,mask:255},k+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[S,g]}return[{[v]:t.ag.disabled},g]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new t.a([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new t.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?t.a.unblended:t.a.alphaBlended}colorModeForDrapableLayerRenderPass(o){let h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new t.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new t.C(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,h,g,v=!1){if(this.depthOcclusion)return new t.ae(this.context.gl.GREATER,t.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return t.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new t.ae(g||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,h)=>o+h/this._fpsHistory.length,0))}render(o,h){let g=t.e.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=h;let v=this.style._mergedLayers,x=this.style.order.filter(se=>{let le=v[se];return!(le.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[le.type]}),S=x.map(se=>v[se]),k=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(t.e.now()),this.imageManager.beginFrame();let D=0,A=!1;for(let se in k){let le=k[se];le.used&&(le.prepare(this.context),le.getSource().usedInConflation&&++D)}let L=!1;for(let se of S)se.isHidden(this.transform.zoom)||(se.type==="clip"&&(L=!0),this.prepareLayer(se));let z={},U={},H={},Y={},Z={};for(let se in k){let le=k[se];z[se]=le.getVisibleCoordinates(),U[se]=z[se].slice().reverse(),H[se]=le.getVisibleCoordinates(!0).reverse(),Y[se]=le.getShadowCasterCoordinates(),Z[se]=le.sortCoordinatesByDistance(z[se])}let X=se=>{let le=this.style.getLayerSourceCache(se);return le&&le.used?le.getSource():null};if(D||L){let se=[],le=[],we=0;for(let Re of S)this.isSourceForClippingOrConflation(Re,X(Re))&&(se.push(Re),le.push(we)),we++;if(se&&(L||se.length>1)){let Re=[];for(let me=0;me<se.length;me++){let Le=se[me],Be=le[me],Qe=this.style.getLayerSourceCache(Le);if(!Qe||!Qe.used||!Qe.getSource().usedInConflation&&Le.type!=="clip")continue;let Je=1/0,Ze=t.cu.None;if(Le.type==="clip"){Je=Be;for(let Te of Le.layout.get("clip-layer-types"))Ze|=Te==="model"?t.cu.Model:Te==="symbol"?t.cu.Symbol:t.cu.FillExtrusion}Re.push({layer:Le.fqid,cache:Qe,order:Je,clipMask:Ze})}this.replacementSource.setSources(Re),A=!0}}A||this.replacementSource.clear(),this.conflationActive=A,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let se=0;se<S.length;se++){let le=S[se],we=le.cutoffRange();if(this.longestCutoffRange=Math.max(we,this.longestCutoffRange),we>0){let Re=X(le);Re&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom)),le.minzoom&&(this.minCutoffZoom=Math.max(le.minzoom,this.minCutoffZoom))}le.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=se),this._lastOcclusionLayer=se)}let Q=this.style&&this.style.fog;Q?(this._fogVisible=Q.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Q.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(H),this.opaquePassCutoff=0);let re=this._shadowRenderer;if(re){re.updateShadowParameters(this.transform,this.style.directionalLight);for(let se in k)for(let le of z[se]){let we={min:0,max:0};this.terrain&&(we=this.terrain.getMinMaxForTile(le)||we),re.addShadowReceiver(le.toUnwrapped(),we.min,we.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Wp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!t.ct(this.context.gl))return;this.renderPass="offscreen";for(let se of S){let le=o.getLayerSourceCache(se);if(!se.hasOffscreenPass()||se.isHidden(this.transform.zoom))continue;let we=le?U[le.id]:void 0;(se.type==="custom"||se.type==="raster"||se.type==="raster-particle"||se.isSky()||we&&we.length)&&this.renderLayer(this,le,se,we)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];let oe=this.terrain;oe&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&oe.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Y)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),_e=(()=>{if(h.showOverdrawInspector)return t.C.black;let se=this.style.fog;if(se&&this.transform.projection.supportsFog){let le=this.style.getLut(se.scope);if(!ae){let we=se.properties.get("color").toRenderColor(le).toArray01();return new t.C(...we)}if(ae){let we=se.properties.get("space-color").toRenderColor(le).toArray01();return new t.C(...we)}}return t.C.transparent})();if(this.context.clear({color:_e,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let se=S[this.currentLayer],le=o.getLayerSourceCache(se);if(se.isSky())continue;let we=le?(se.is3D()?Z:U)[le.id]:void 0;this._renderTileClippingMasks(se,le,we),this.renderLayer(this,le,se,we)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let se=S[this.currentLayer],le=o.getLayerSourceCache(se);se.isSky()&&this.renderLayer(this,le,se,le?U[le.id]:void 0)}function ge(se,le){let we;return le&&(we=(se.type==="symbol"?H:se.is3D()?Z:U)[le.id]),we}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let se=S[this.currentLayer];if(se.type==="raster"){let le=o.getLayerSourceCache(se);this.renderLayer(this,le,se,ge(se,le))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ne=0;for(re&&(ne=re.getShadowCastingLayerCount());this.currentLayer<x.length;){let se=S[this.currentLayer],le=o.getLayerSourceCache(se);if(se.isSky())++this.currentLayer;else if(oe&&this.style.isLayerDraped(se)){if(se.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=oe.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(se.is3D()||this.terrain||this._renderTileClippingMasks(se,le,le?z[le.id]:void 0),this.renderLayer(this,le,se,ge(se,le)),!oe&&re&&ne>0&&se.hasShadowPass()&&--ne==0&&(re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let we=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=we;this.currentLayer++){let Re=S[this.currentLayer];if(!Re.hasLightBeamPass())continue;let me=o.getLayerSourceCache(Re);this.renderLayer(this,me,Re,me?U[me.id]:void 0)}this.currentLayer=we,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let we=this.currentLayer;this.depthOcclusion=!0;for(let Re of this.layersWithOcclusionOpacity){this.currentLayer=Re;let me=S[this.currentLayer],Le=o.getLayerSourceCache(me),Be=Le?U[Le.id]:void 0;me.is3D()||this.terrain||this._renderTileClippingMasks(me,Le,Le?z[Le.id]:void 0),this.renderLayer(this,Le,me,Be)}this.depthOcclusion=!1,this.currentLayer=we,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let se=null;S.forEach(le=>{let we=o.getLayerSourceCache(le);we&&!le.isHidden(this.transform.zoom)&&we.getVisibleCoordinates().length&&(!se||se.getSource().maxzoom<we.getSource().maxzoom)&&(se=we)}),se&&this.options.showTileBoundaries&&ua.debug(this,se,se.getVisibleCoordinates(),t.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ua.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(se){let le=se.transform.padding;Ni(se,se.transform.height-(le.top||0),3,Au),Ni(se,le.bottom||0,3,Up),Vi(se,le.left||0,3,Pa),Vi(se,se.transform.width-(le.right||0),3,Hp);let we=se.transform.centerPoint;(function(Re,me,Le,Be){so(Re,me-1,Le-10,2,20,Be),so(Re,me-10,Le-1,20,2,Be)})(se,we.x,se.transform.height-we.y,Ic)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),A||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);let{unsupportedLayers:h}=this.transform.projection,g=!h||!h.includes(o.type);if(u_[o.type]&&(g||this.terrain&&o.type==="custom")){let v=this.style.getLayerSourceCache(o);u_[o.type](o,v,this)}this.gpuTimingEnd()}renderLayer(o,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)&&(!o.terrain||g.type!=="custom")||g.type==="clip"||ua[g.type](o,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,g=this.context.gl,v=this.gpuTimers[o.id];v||(v=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(h.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let o=this.context.extTimerQuery,h=this.context.gl,g=h.createQuery();this.deferredRenderGpuTimeQueries.push(g),h.beginQuery(o.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){let o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){let h={};for(let g in o){let v=o[g],x=this.context.extTimerQuery,S=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),h[g]=S}return h}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,g=this.context.gl,v=0;for(let x of o)v+=h.getQueryParameter(x,g.QUERY_RESULT)/1e6,h.deleteQueryEXT(x);return v}translatePosMatrix(o,h,g,v,x){if(!g[0]&&!g[1])return o;let S=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(S){let A=Math.sin(S),L=Math.cos(S);g=[g[0]*L-g[1]*A,g[0]*A+g[1]*L]}let k=[x?g[0]:t.bB(h,g[0],this.transform.zoom),x?g[1]:t.bB(h,g[1],this.transform.zoom),0],D=new Float32Array(16);return t.ad.translate(D,o,k),D}saveTileTexture(o){let h=o.size[0],g=this._tileTextures[h];g?g.push(o):this._tileTextures[h]=[o]}getTileTexture(o){let h=this._tileTextures[o];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,h,g){let v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,x=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||h!==void 0&&!h||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(o,h){this.cache=this.cache||{};let g=h&&h.defines||[],v=h&&h.config,x=this.currentGlobalDefines(o,h&&h.overrideFog,h&&h.overrideRtt).concat(g),S=Yd.cacheKey(Zg[o],o,x,v);return this.cache[S]||(this.cache[S]=new Yd(this.context,o,Zg[o],v,Py[o],x)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,h){if(this.style.enable3dLights()){let g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){let x=((S,k,D)=>{let A=S.properties.get("direction"),L=S.properties.get("color").toRenderColor(D.getLut(S.scope)).toArray01(),z=S.properties.get("intensity"),U=k.properties.get("color").toRenderColor(D.getLut(k.scope)).toArray01(),H=k.properties.get("intensity"),Y=[A.x,A.y,A.z],Z=t.bA(U,H),X=t.bA(L,z);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:Y,u_lighting_directional_color:X,u_ground_radiance:Ja(Y,X,Z)}})(g,v,this.style);h.setLightsUniformValues(o,x)}}}uploadCommonUniforms(o,h,g,v,x){if(this.uploadCommonLightUniforms(o,h),this.terrain&&this.terrain.renderingToTexture)return;let S=this.style.fog;if(S){let k=S.getOpacity(this.transform.pitch),D=((A,L,z,U,H,Y,Z,X,Q,re,oe,ae)=>{let _e=A.transform,ge=L.properties.get("color").toRenderColor(A.style.getLut(L.scope)).toArray01();ge[3]=U;let ne=A.frameCounter/1e3%1,[se,le]=L.properties.get("vertical-range");return{u_fog_matrix:z?_e.calculateFogTileMatrix(z):ae||A.identityMat,u_fog_range:L.getFovAdjustedRange(_e._fov),u_fog_color:ge,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(se,le),le],u_fog_temporal_offset:ne,u_frustum_tl:H,u_frustum_tr:Y,u_frustum_br:Z,u_frustum_bl:X,u_globe_pos:Q,u_globe_radius:re,u_viewport:oe,u_globe_transition:t.a1(_e.zoom),u_is_globe:+(_e.projection.name==="globe")}})(this,S,g,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.e.devicePixelRatio,this.transform.height*t.e.devicePixelRatio],v);h.setFogUniformValues(o,D)}x&&h.setCutoffUniformValues(o,x.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){let o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){let o=this.context.gl,h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let o=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(let v of g)h[v.key]=o[v.key]||new t.by(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,h){return!(!o.is3D()||o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||o.sourceLayer!=="building")&&o.type!=="clip"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[o.key];return h||(this._cachedTileFogOpacities[o.key]=h=this.style.fog.getOpacityForTile(o)),h[0]>=Mn||h[1]>=Mn}}class Kr{constructor(o,h,g,v){this.screenBounds=o,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(o,h){let g,v;if(o instanceof t.P||typeof o[0]=="number"){let x=t.P.convert(o);g=[x],v=h.isPointAboveHorizon(x)}else{let x=t.P.convert(o[0]),S=t.P.convert(o[1]);g=[x,S],v=t.cv(x,S).every(k=>h.isPointAboveHorizon(k))}return new Kr(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return t.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],v=t.cv(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),t.cw(v,o)}bufferedCameraGeometryGlobe(o){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],v=t.cv(h,g,o),x=this.cameraPoint.clone();switch(3*((x.y>h.y)+(x.y>g.y))+((x.x>h.x)+(x.x>g.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(o,h,g,v=0){let x=o.queryPadding/h._pixelsPerMercatorPixel+1,S=g?this._bufferedCameraMercator(x,h):this._bufferedScreenMercator(x,h),k=o.tileID.wrap+(S.unwrapped?v:0),D=S.polygon.map(X=>t.cx(o.tileTransform,X,k));if(!t.cy(D,0,0,t.a3,t.a3))return;k=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let A=this.screenGeometryMercator.polygon.map(X=>t.cz(o.tileTransform,X,k)),L=A.map(X=>new t.P(X[0],X[1])),z=h.getFreeCameraOptions().position||new t.Y(0,0,0),U=t.cz(o.tileTransform,z,k),H=A.map(X=>{let Q=t._.sub(X,X,U);return t._.normalize(Q,Q),new t.aT(U,Q)}),Y=t.bB(o,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:H,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(Z=t.cA(D),Z.min.x=t.at(Z.min.x,0,t.a3),Z.min.y=t.at(Z.min.y,0,t.a3),Z.max.x=t.at(Z.max.x,0,t.a3),Z.max.y=t.at(Z.max.y,0,t.a3),Z),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:Y};var Z}_bufferedScreenMercator(o,h){let g=$p(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),h):{polygon:this.bufferedScreenGeometry(o).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(o,h){let g=$p(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),h):{polygon:this.bufferedCameraGeometry(o).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(o,h){let g=function(x,S){let k=t.ad.multiply([],S.pixelMatrix,S.globeMatrix),D=[0,-t.cD,0,1],A=[0,t.cD,0,1],L=[0,0,0,1];t.aA.transformMat4(D,D,k),t.aA.transformMat4(A,A,k),t.aA.transformMat4(L,L,k);let z=new t.P(D[0]/D[3],D[1]/D[3]),U=new t.P(A[0]/A[3],A[1]/A[3]),H=t.cB(x,z)&&D[3]<L[3],Y=t.cB(x,U)&&A[3]<L[3];if(!H&&!Y)return null;let Z=function(ne,se,le){for(let we=1;we<ne.length;we++){let Re=Os(se.pointCoordinate3D(ne[we-1]).x),me=Os(se.pointCoordinate3D(ne[we]).x);if(le<0){if(Re<me)return{idx:we,t:-Re/(me-1-Re)}}else if(me<Re)return{idx:we,t:(1-Re)/(me+1-Re)}}return null}(x,S,H?-1:1);if(!Z)return null;let{idx:X,t:Q}=Z,re=X>1?qp(x.slice(0,X),S):[],oe=X<x.length?qp(x.slice(X),S):[];re=re.map(ne=>new t.P(Os(ne.x),ne.y)),oe=oe.map(ne=>new t.P(Os(ne.x),ne.y));let ae=[...re];ae.length===0&&ae.push(oe[oe.length-1]);let _e=t.a2(ae[ae.length-1].y,(oe.length===0?re[0]:oe[0]).y,Q),ge;return ge=H?[new t.P(0,_e),new t.P(0,0),new t.P(1,0),new t.P(1,_e)]:[new t.P(1,_e),new t.P(1,1),new t.P(0,1),new t.P(0,_e)],ae.push(...ge),oe.length===0?ae.push(re[0]):ae.push(...oe),{polygon:ae.map(ne=>new t.Y(ne.x,ne.y)),unwrapped:!1}}(o,h);if(g)return g;let v=function(x,S){let k=!1,D=-1/0,A=0;for(let z=0;z<x.length-1;z++)x[z].x>D&&(D=x[z].x,A=z);for(let z=0;z<x.length-1;z++){let U=(A+z)%(x.length-1),H=x[U],Y=x[U+1];Math.abs(H.x-Y.x)>.5&&(H.x<Y.x?(H.x+=1,U===0&&(x[x.length-1].x+=1)):(Y.x+=1,U+1===x.length-1&&(x[0].x+=1)),k=!0)}let L=t.aj(S.center.lng);return k&&L<Math.abs(L-1)&&x.forEach(z=>{z.x-=1}),{polygon:x,unwrapped:k}}(qp(o,h).map(x=>new t.P(Os(x.x),x.y)),h);return{polygon:v.polygon.map(x=>new t.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function qp(f,o){return t.cC(f,h=>{let g=o.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function Os(f){return f<0?1+f%1:f%1}function $p(f){return 100*f|0}function By(f,o){let h=t.ad.identity([]);return t.ad.scale(h,h,[.5*f.width,.5*-f.height,1]),t.ad.translate(h,h,[1,-1,0]),t.ad.multiply(h,h,f.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(h)}function Ny(f,o,h,g,v,x,S,k=!1){let D=f.tilesIn(g,S,k);D.sort(Ac);let A=[];for(let z of D)A.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(o,h,f._state,z,v,x,By(f.transform,z.tile.tileID),k)});let L=function(z){let U={},H={};for(let Y of z){let Z=Y.queryResults,X=Y.wrappedTileID,Q=H[X]=H[X]||{};for(let re in Z){let oe=Z[re],ae=Q[re]=Q[re]||{},_e=U[re]=U[re]||[];for(let ge of oe)ae[ge.featureIndex]||(ae[ge.featureIndex]=!0,_e.push(ge))}}return U}(A);for(let z in L)L[z].forEach(U=>{let H=U.feature,Y=H.layer;Y&&Y.type!=="background"&&Y.type!=="sky"&&Y.type!=="slot"&&(H.source=Y.source,Y["source-layer"]&&(H.sourceLayer=Y["source-layer"]),H.state=H.id!==void 0?f.getFeatureState(Y["source-layer"],H.id):{})});return L}function sh(f,o){let h=f.getRenderableIds().map(x=>f.getTileByID(x)),g=[],v={};for(let x=0;x<h.length;x++){let S=h[x],k=S.tileID.canonical.key;v[k]||(v[k]=!0,S.querySourceFeatures(g,o))}return g}function Ac(f,o){let h=f.tileID,g=o.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}class Vy{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let o=!1,h=!1;for(let g in this.style._mergedLayers){let v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:o,visibilityChanged:h});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:o,visibilityChanged:h})}}}onNewFrame(o){this.layersGotHidden=!1;for(let h of this.layers){let g=h.layer,v=!1;g.type==="fill-extrusion"?v=!g.isHidden(o)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(o)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&h.visible,h.visible=v}}updateZOffset(o,h){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,S=this.style.getLayerSourceCache(x),k=1;x.type==="fill-extrusion"&&(k=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let D=S?S.getTile(h):null;if(!D&&S&&h.canonical.z>S.getSource().minzoom){let A=h.scaledTo(Math.min(S.getSource().maxzoom,h.overscaledZ-1));for(;A.overscaledZ>=S.getSource().minzoom&&(D=S.getTile(A),!D&&A.overscaledZ!==0);)A=A.scaledTo(A.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(x):null,tileID:D?D.tileID:h,verticalScale:k})}o.hasAnyZOffset=!1;let g=!1;for(let v=0;v<o.symbolInstances.length;v++){let x=o.symbolInstances.get(v),S=x.zOffset,k=this._getHeightAtTileOffset(h,x.tileAnchorX,x.tileAnchorY);x.zOffset=k!==Number.NEGATIVE_INFINITY?k:S,g||S===x.zOffset||(g=!0),o.hasAnyZOffset||x.zOffset===0||(o.hasAnyZOffset=!0)}g&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,h,g,v){let x=h,S=g;if(o.canonical.z!==v.canonical.z){let k=v.canonical,D=1/(1<<o.canonical.z-k.z);x=(h+o.canonical.x*t.a3)*D-k.x*t.a3|0,S=(g+o.canonical.y*t.a3)*D-k.y*t.a3|0}return{tileX:x,tileY:S}}_getHeightAtTileOffset(o,h,g){let v,x;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;let{bucket:k,tileID:D,verticalScale:A}=this.currentBuildingBuckets[S];if(!k)continue;let{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(o,h,g,D),U=k.getHeightAtTileCoord(L,z);U&&U.height!==void 0&&(U.hidden?v=U.height:x=Math.max(U.height*A,x||0))}if(x!==void 0)return x;for(let S=0;S<this.layers.length;++S){let k=this.layers[S];if(k.layer.type!=="model"||!k.visible)continue;let{bucket:D,tileID:A}=this.currentBuildingBuckets[S];if(!D)continue;let{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(o,h,g,A),U=D.getHeightAtTileCoord(L,z);if(U&&!U.hidden)return U.height===void 0&&v!==void 0?Math.min(U.maxHeight,v)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Pc(f,o){let h={};for(let g in f)g!=="ref"&&(h[g]=f[g]);return t.cE.forEach(g=>{g in o&&(h[g]=o[g])}),h}function Yp(f){f=f.slice();let o=Object.create(null);for(let h=0;h<f.length;h++)o[f[h].id]=f[h];for(let h=0;h<f.length;h++)"ref"in f[h]&&(f[h]=Pc(f[h],o[f[h].ref]));return f}let Ri={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ts(f,o,h){h.push({command:Ri.addSource,args:[f,o[f]]})}function p_(f,o,h){o.push({command:Ri.removeSource,args:[f]}),h[f]=!0}function jy(f,o,h,g){p_(f,h,g),ts(f,o,h)}function Uy(f,o,h){let g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!_(f[h][g],o[h][g]))return!1;for(g in o[h])if(o[h].hasOwnProperty(g)&&g!=="data"&&!_(f[h][g],o[h][g]))return!1;return!0}function lh(f,o,h,g,v,x){let S;for(S in o=o||{},f=f||{})f.hasOwnProperty(S)&&(_(f[S],o[S])||h.push({command:x,args:[g,S,o[S],v]}));for(S in o)o.hasOwnProperty(S)&&!f.hasOwnProperty(S)&&(_(f[S],o[S])||h.push({command:x,args:[g,S,o[S],v]}))}function Pu(f){return f.id}function Oc(f,o){return f[o.id]=o,f}class f_{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=t.at(o,0,1);let h=1,g=this._distances[h],v=o*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];let x=h-1,S=this._distances[x],k=g-S,D=k>0?(v-S)/k:0;return this.points[x].mult(1-D).add(this.points[h].mult(D))}}class Zp{constructor(o,h,g){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(h/g);for(let S=0;S<this.xCellCount*this.yCellCount;S++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,g,v,x){this._forEachCell(h,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(o,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(o,h,g,v,x,S){this.boxCells[x].push(S)}_insertCircleCell(o,h,g,v,x,S){this.circleCells[x].push(S)}_query(o,h,g,v,x,S){if(g<0||o>this.width||v<0||h>this.height)return!x&&[];let k=[];if(o<=0&&h<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let D=0;D<this.boxKeys.length;D++)k.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){let A=this.circles[3*D],L=this.circles[3*D+1],z=this.circles[3*D+2];k.push({key:this.circleKeys[D],x1:A-z,y1:L-z,x2:A+z,y2:L+z})}return S?k.filter(S):k}return this._forEachCell(o,h,g,v,this._queryCell,k,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?k.length>0:k}_queryCircle(o,h,g,v,x){let S=o-g,k=o+g,D=h-g,A=h+g;if(k<0||S>this.width||A<0||D>this.height)return!v&&[];let L=[];return this._forEachCell(S,D,k,A,this._queryCellCircle,L,{hitTest:v,circle:{x:o,y:h,radius:g},seenUids:{box:{},circle:{}}},x),v?L.length>0:L}query(o,h,g,v,x){return this._query(o,h,g,v,!1,x)}hitTest(o,h,g,v,x){return this._query(o,h,g,v,!0,x)}hitTestCircle(o,h,g,v){return this._queryCircle(o,h,g,!0,v)}_queryCell(o,h,g,v,x,S,k,D){let A=k.seenUids,L=this.boxCells[x];if(L!==null){let U=this.bboxes;for(let H of L)if(!A.box[H]){A.box[H]=!0;let Y=4*H;if(o<=U[Y+2]&&h<=U[Y+3]&&g>=U[Y+0]&&v>=U[Y+1]&&(!D||D(this.boxKeys[H]))){if(k.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[H],x1:U[Y],y1:U[Y+1],x2:U[Y+2],y2:U[Y+3]})}}}let z=this.circleCells[x];if(z!==null){let U=this.circles;for(let H of z)if(!A.circle[H]){A.circle[H]=!0;let Y=3*H;if(this._circleAndRectCollide(U[Y],U[Y+1],U[Y+2],o,h,g,v)&&(!D||D(this.circleKeys[H]))){if(k.hitTest)return S.push(!0),!0;{let Z=U[Y],X=U[Y+1],Q=U[Y+2];S.push({key:this.circleKeys[H],x1:Z-Q,y1:X-Q,x2:Z+Q,y2:X+Q})}}}}}_queryCellCircle(o,h,g,v,x,S,k,D){let A=k.circle,L=k.seenUids,z=this.boxCells[x];if(z!==null){let H=this.bboxes;for(let Y of z)if(!L.box[Y]){L.box[Y]=!0;let Z=4*Y;if(this._circleAndRectCollide(A.x,A.y,A.radius,H[Z+0],H[Z+1],H[Z+2],H[Z+3])&&(!D||D(this.boxKeys[Y])))return S.push(!0),!0}}let U=this.circleCells[x];if(U!==null){let H=this.circles;for(let Y of U)if(!L.circle[Y]){L.circle[Y]=!0;let Z=3*Y;if(this._circlesCollide(H[Z],H[Z+1],H[Z+2],A.x,A.y,A.radius)&&(!D||D(this.circleKeys[Y])))return S.push(!0),!0}}}_forEachCell(o,h,g,v,x,S,k,D){let A=this._convertToXCellCoord(o),L=this._convertToYCellCoord(h),z=this._convertToXCellCoord(g),U=this._convertToYCellCoord(v);for(let H=A;H<=z;H++)for(let Y=L;Y<=U;Y++)if(x.call(this,o,h,g,v,this.xCellCount*Y+H,S,k,D))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,g,v,x,S){let k=v-o,D=x-h,A=g+S;return A*A>k*k+D*D}_circleAndRectCollide(o,h,g,v,x,S,k){let D=(S-v)/2,A=Math.abs(o-(v+D));if(A>D+g)return!1;let L=(k-x)/2,z=Math.abs(h-(x+L));if(z>L+g)return!1;if(A<=D||z<=L)return!0;let U=A-D,H=z-L;return U*U+H*H<=g*g}}let ma=100;class g_{constructor(o,h,g=new Zp(o.width+200,o.height+200,25),v=new Zp(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+ma,this.screenBottomBoundary=o.height+ma,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=h}placeCollisionBox(o,h,g,v,x,S,k,D){let A=g.projectedAnchorX,L=g.projectedAnchorY,z=g.projectedAnchorZ,U=g.elevation,H=g.tileID,Y=o.getProjection();if(U&&H){let[ge,ne,se]=Y.upVector(H.canonical,g.tileAnchorX,g.tileAnchorY),le=Y.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=ge*U*le,L+=ne*U*le,z+=se*U*le}let Z=this.projectAndGetPerspectiveRatio(k,A,L,z,g.tileID,Y.name==="globe"||!!U||this.transform.pitch>0,Y),X=S*Z.perspectiveRatio,Q=(g.x1*h+v.x-g.padding)*X+Z.point.x,re=(g.y1*h+v.y-g.padding)*X+Z.point.y,oe=(g.x2*h+v.x+g.padding)*X+Z.point.x,ae=(g.y2*h+v.y+g.padding)*X+Z.point.y,_e=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(Q,re,oe,ae)||!x&&this.grid.hitTest(Q,re,oe,ae,D)||_e?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[Q,re,oe,ae],offscreen:this.isOffscreen(Q,re,oe,ae),occluded:!1}}placeCollisionCircles(o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z){let X=[],Q=this.transform.elevation,re=o.getProjection(),oe=Q?Q.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,re):null,ae=new t.P(g.tileAnchorX,g.tileAnchorY),{x:_e,y:ge,z:ne}=re.projectTilePoint(ae.x,ae.y,Z.canonical);if(oe){let[Ze,Te,Ve]=oe(ae);_e+=Ze,ge+=Te,ne+=Ve}let se=re.name==="globe",le=this.projectAndGetPerspectiveRatio(k,_e,ge,ne,Z,se||!!Q||this.transform.pitch>0,re),{perspectiveRatio:we}=le,Re=(z?S/we:S*we)/t.bN,me=jo(_e,ge,ne,D),Le=le.signedDistanceFromCamera>0?pu(Re,x,g.lineOffsetX*Re,g.lineOffsetY*Re,!1,me,ae,g,v,D,{},Q&&!z?oe:null,z&&!!Q,re,Z,z):null,Be=!1,Qe=!1,Je=!0;if(Le&&!le.occluded){let Ze=.5*H*we+Y,Te=new t.P(-100,-100),Ve=new t.P(this.screenRightBoundary,this.screenBottomBoundary),Ye=new f_,{first:bt,last:yt}=Le,kt=bt.path.length,vt=[];for(let Dt=kt-1;Dt>=1;Dt--)vt.push(bt.path[Dt]);for(let Dt=1;Dt<yt.path.length;Dt++)vt.push(yt.path[Dt]);let it=2.5*Ze;A&&(vt=vt.map(([Dt,ai,ti],vi)=>(oe&&!se&&(ti=oe(vi<kt-1?bt.tilePath[kt-1-vi]:yt.tilePath[vi-kt+2])[2]),jo(Dt,ai,ti,A))),vt.some(Dt=>Dt[3]<=0)&&(vt=[]));let Ge=[];if(vt.length>0){let Dt=1/0,ai=-1/0,ti=1/0,vi=-1/0;for(let Ai of vt)Dt=Math.min(Dt,Ai[0]),ti=Math.min(ti,Ai[1]),ai=Math.max(ai,Ai[0]),vi=Math.max(vi,Ai[1]);ai>=Te.x&&Dt<=Ve.x&&vi>=Te.y&&ti<=Ve.y&&(Ge=[vt.map(Ai=>new t.P(Ai[0],Ai[1]))],(Dt<Te.x||ai>Ve.x||ti<Te.y||vi>Ve.y)&&(Ge=t.cF(Ge,Te.x,Te.y,Ve.x,Ve.y)))}for(let Dt of Ge){Ye.reset(Dt,.25*Ze);let ai=0;ai=Ye.length<=.5*Ze?1:Math.ceil(Ye.paddedLength/it)+1;for(let ti=0;ti<ai;ti++){let vi=ti/Math.max(ai-1,1),Ai=Ye.lerp(vi),Ki=Ai.x+ma,Kt=Ai.y+ma;X.push(Ki,Kt,Ze,0);let Gi=Ki-Ze,hn=Kt-Ze,Xi=Ki+Ze,Ci=Kt+Ze;if(Je=Je&&this.isOffscreen(Gi,hn,Xi,Ci),Qe=Qe||this.isInsideGrid(Gi,hn,Xi,Ci),!h&&this.grid.hitTestCircle(Ki,Kt,Ze,U)&&(Be=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!L&&Be||!Qe?[]:X,offscreen:Je,collisionDetected:Be,occluded:le.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],g=1/0,v=1/0,x=-1/0,S=-1/0;for(let L of o){let z=new t.P(L.x+ma,L.y+ma);g=Math.min(g,z.x),v=Math.min(v,z.y),x=Math.max(x,z.x),S=Math.max(S,z.y),h.push(z)}let k=this.grid.query(g,v,x,S).concat(this.ignoredGrid.query(g,v,x,S)),D={},A={};for(let L of k){let z=L.key;if(D[z.bucketInstanceId]===void 0&&(D[z.bucketInstanceId]={}),D[z.bucketInstanceId][z.featureIndex])continue;let U=[new t.P(L.x1,L.y1),new t.P(L.x2,L.y1),new t.P(L.x2,L.y2),new t.P(L.x1,L.y2)];t.cG(h,U)&&(D[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(o,h,g,v,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,g,v,x){let S=h?this.ignoredGrid:this.grid,k={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let D=0;D<o.length;D+=4)S.insertCircle(k,o[D],o[D+1],o[D+2])}projectAndGetPerspectiveRatio(o,h,g,v,x,S,k){let D=[h,g,v,1],A=!1;v||this.transform.pitch>0?(t.aA.transformMat4(D,D,o),this.fogState&&x&&k.name!=="globe"&&(A=function(U,H,Y,Z,X,Q){let re=Q.calculateFogTileMatrix(X),oe=[H,Y,Z];return t._.transformMat4(oe,oe,re),dr(U,t._.length(oe),Q.pitch,Q._fov)}(this.fogState,h,g,v,x.toUnwrapped(),this.transform)>.9)):Da(D,D,o);let L=D[3];return{point:new t.P((D[0]/L+1)/2*this.transform.width+ma,(-D[1]/L+1)/2*this.transform.height+ma),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/L*.5,1.5),signedDistanceFromCamera:L,occluded:S&&D[2]>L||A}}isOffscreen(o,h,g,v){return g<ma||o>=this.screenRightBoundary||v<ma||h>this.screenBottomBoundary}isInsideGrid(o,h,g,v){return g>=0&&o<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let o=t.ad.identity([]);return t.ad.translate(o,o,[-100,-100,0]),o}}class Rs{constructor(o,h,g,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Ls{constructor(o,h,g,v,x,S=!1){this.text=new Rs(o?o.text:null,h,g,x),this.icon=new Rs(o?o.icon:null,h,v,x),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ou{constructor(o,h,g,v=!1){this.text=o,this.icon=h,this.skipFade=g,this.clipped=v}}class __{constructor(){this.invProjMatrix=t.ad.create(),this.viewportMatrix=t.ad.create(),this.circles=[]}}class ch{constructor(o,h,g,v,x){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class dh{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[o]}}function Xp(f,o,h,g,v){let{horizontalAlign:x,verticalAlign:S}=t.bQ(f),k=-(x-.5)*o,D=-(S-.5)*h,A=t.bP(f,g);return new t.P(k+A[0]*v,D+A[1]*v)}function hh(f,o,h,g,v){let x=new t.P(f,o);return h&&x._rotate(g?v:-v),x}class Ho{constructor(o,h,g,v,x,S){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new g_(this.transform,x),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new dh(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,g,v){let x=g.getBucket(h),S=g.latestFeatureIndex;if(!x||!S||h.fqid!==x.layerIds[0])return;let k=x.layers[0].layout,D=g.collisionBoxArray,A=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/t.a3,z=g.tileID.toUnwrapped();this.transform.setProjection(x.projection);let U=(H=g.tileID,Y=x.getProjection(),Z=this.transform,Y.name===this.projection?Z.calculateProjMatrix(H.toUnwrapped()):Iu(Z,Y,H));var H,Y,Z;let X=k.get("text-pitch-alignment")==="map",Q=k.get("text-rotation-alignment")==="map";h.compileFilter();let re=h.dynamicFilter(),oe=h.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(g),_e=ml(U,g.tileID.canonical,X,Q,this.transform,x.getProjection(),ae),ge=null;if(X){let le=_c(U,g.tileID.canonical,X,Q,this.transform,x.getProjection(),ae);ge=t.ad.multiply([],this.transform.labelPlaneMatrix,le)}let ne=null;re&&g.latestFeatureIndex&&(ne={unwrappedTileID:z,dynamicFilter:re,dynamicFilterNeedsFeature:oe,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new ch(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,g.tileID);let se={bucket:x,layout:k,posMatrix:U,textLabelPlaneMatrix:_e,labelToScreenMatrix:ge,clippingData:ne,scale:A,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:t.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let le of x.sortKeyRanges){let{sortKey:we,symbolInstanceStart:Re,symbolInstanceEnd:me}=le;o.push({sortKey:we,symbolInstanceStart:Re,symbolInstanceEnd:me,parameters:se})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:se})}attemptAnchorPlacement(o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q,re){let{textOffset0:oe,textOffset1:ae,crossTileID:_e}=U,ge=[oe,ae],ne=Xp(o,g,v,ge,x),se=this.collisionIndex.placeCollisionBox(Y,x,h,hh(ne.x,ne.y,S,k,this.transform.angle),z,D,A,L.predicate);if(X){let le=Y.getSymbolInstanceIconSize(re,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,le,X,hh(ne.x,ne.y,S,k,this.transform.angle),z,D,A,L.predicate).box.length===0)return}if(se.box.length>0){let le;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(le=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:ge,width:g,height:v,anchor:o,textScale:x,prevAnchor:le},this.markUsedJustification(Y,o,U,Z),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,Z,U),this.placedOrientations[_e]=Z),{shift:ne,placedGlyphBoxes:se}}}placeLayerBucketPart(o,h,g,v){let{bucket:x,layout:S,posMatrix:k,textLabelPlaneMatrix:D,labelToScreenMatrix:A,clippingData:L,textPixelRatio:z,holdingForFade:U,collisionBoxArray:H,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:Z,collisionGroup:X}=o.parameters,Q=S.get("text-optional"),re=S.get("icon-optional"),oe=S.get("text-allow-overlap"),ae=S.get("icon-allow-overlap"),_e=S.get("text-rotation-alignment")==="map",ge=S.get("text-pitch-alignment")==="map",ne=S.get("symbol-z-order")==="viewport-y",se=S.get("symbol-z-elevate");this.transform.setProjection(x.projection);let le=oe&&(ae||!x.hasIconData()||re),we=ae&&(oe||!x.hasTextData()||Q);!x.collisionArrays&&H&&x.deserializeCollisionBoxes(H),g&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,H);let Re=(me,Le,Be)=>{let{crossTileID:Qe,numVerticalGlyphVertices:Je}=me;if(L){let Xi={zoom:this.transform.zoom,pitch:this.transform.pitch},Ci=null;if(L.dynamicFilterNeedsFeature){let ni=this.retainedQueryData[x.bucketInstanceId];Ci=L.featureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:ni.bucketIndex,sourceLayerIndex:ni.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Xi,Ci,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new t.P(me.tileAnchorX,me.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Qe]=new Ou(!1,!1,!1,!0),void h.add(Qe)}if(h.has(Qe))return;if(U)return void(this.placements[Qe]=new Ou(!1,!1,!1));let Ze=!1,Te=!1,Ve=!0,Ye=!1,bt=!1,yt=null,kt={box:null,offscreen:null,occluded:null},vt={box:null,offscreen:null,occluded:null},it=null,Ge=null,Dt=null,ai=0,ti=0,vi=0;Be.textFeatureIndex?ai=Be.textFeatureIndex:me.useRuntimeCollisionCircles&&(ai=me.featureIndex),Be.verticalTextFeatureIndex&&(ti=Be.verticalTextFeatureIndex);let Ai=Xi=>{Xi.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let Ci=this.transform.elevation;Xi.elevation=me.zOffset+(Ci?Ci.getAtTileOffset(Xi.tileID,Xi.tileAnchorX,Xi.tileAnchorY):0)},Ki=Be.textBox;if(Ki){Ai(Ki);let Xi=ni=>{let gn=t.aE.horizontal;if(x.allowVerticalPlacement&&!ni&&this.prevPlacement){let xn=this.prevPlacement.placedOrientations[Qe];xn&&(this.placedOrientations[Qe]=xn,gn=xn,this.markUsedOrientation(x,gn,me))}return gn},Ci=(ni,gn)=>{if(x.allowVerticalPlacement&&Je>0&&Be.verticalTextBox){for(let xn of x.writingModes)if(xn===t.aE.vertical?(kt=gn(),vt=kt):kt=ni(),kt&&kt.box&&kt.box.length)break}else kt=ni()};if(S.get("text-variable-anchor")){let ni=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Qe]){let nn=this.prevPlacement.variableOffsets[Qe];ni.indexOf(nn.anchor)>0&&(ni=ni.filter(Ke=>Ke!==nn.anchor),ni.unshift(nn.anchor))}let gn=(nn,Ke,St)=>{let An=x.getSymbolInstanceTextSize(Y,me,this.transform.zoom,Le),qi=(nn.x2-nn.x1)*An+2*nn.padding,Oe=(nn.y2-nn.y1)*An+2*nn.padding,Oo=me.hasIconTextFit&&!ae?Ke:null;Oo&&Ai(Oo);let Fr={box:[],offscreen:!1,occluded:!1},Jr=oe?2*ni.length:ni.length;for(let wr=0;wr<Jr;++wr){let ho=this.attemptAnchorPlacement(ni[wr%ni.length],nn,qi,Oe,An,_e,ge,z,k,X,wr>=ni.length,me,Le,x,St,Oo,Y,Z);if(ho&&(Fr=ho.placedGlyphBoxes,Fr&&Fr.box&&Fr.box.length)){Ze=!0,yt=ho.shift;break}}return Fr};Ci(()=>gn(Ki,Be.iconBox,t.aE.horizontal),()=>{let nn=Be.verticalTextBox;return nn&&Ai(nn),x.allowVerticalPlacement&&!(kt&&kt.box&&kt.box.length)&&Je>0&&nn?gn(nn,Be.verticalIconBox,t.aE.vertical):{box:null,offscreen:null,occluded:null}}),kt&&(Ze=kt.box,Ve=kt.offscreen,Ye=kt.occluded);let xn=Xi(!(!kt||!kt.box));if(!Ze&&this.prevPlacement){let nn=this.prevPlacement.variableOffsets[Qe];nn&&(this.variableOffsets[Qe]=nn,this.markUsedJustification(x,nn.anchor,me,xn))}}else{let ni=(gn,xn)=>{let nn=x.getSymbolInstanceTextSize(Y,me,this.transform.zoom,Le),Ke=this.collisionIndex.placeCollisionBox(x,nn,gn,new t.P(0,0),oe,z,k,X.predicate);return Ke&&Ke.box&&Ke.box.length&&(this.markUsedOrientation(x,xn,me),this.placedOrientations[Qe]=xn),Ke};Ci(()=>ni(Ki,t.aE.horizontal),()=>{let gn=Be.verticalTextBox;return x.allowVerticalPlacement&&Je>0&&gn?(Ai(gn),ni(gn,t.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Xi(!!(kt&&kt.box&&kt.box.length))}}if(it=kt,Ze=it&&it.box&&it.box.length>0,Ve=it&&it.offscreen,Ye=it&&it.occluded,me.useRuntimeCollisionCircles){let Xi=x.text.placedSymbolArray.get(me.centerJustifiedTextSymbolIndex>=0?me.centerJustifiedTextSymbolIndex:me.verticalPlacedTextSymbolIndex),Ci=t.aF(x.textSizeData,Y,Xi),ni=S.get("text-padding");Ge=this.collisionIndex.placeCollisionCircles(x,oe,Xi,x.lineVertexArray,x.glyphOffsetArray,Ci,k,D,A,g,ge,X.predicate,me.collisionCircleDiameter*Ci/t.bN,ni,this.retainedQueryData[x.bucketInstanceId].tileID),Ze=oe||Ge.circles.length>0&&!Ge.collisionDetected,Ve=Ve&&Ge.offscreen,Ye=Ge.occluded}if(Be.iconFeatureIndex&&(vi=Be.iconFeatureIndex),Be.iconBox){let Xi=Ci=>{Ai(Ci);let ni=me.hasIconTextFit&&yt?hh(yt.x,yt.y,_e,ge,this.transform.angle):new t.P(0,0),gn=x.getSymbolInstanceIconSize(Z,this.transform.zoom,me.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,gn,Ci,ni,ae,z,k,X.predicate)};vt&&vt.box&&vt.box.length&&Be.verticalIconBox?(Dt=Xi(Be.verticalIconBox),Te=Dt.box.length>0):(Dt=Xi(Be.iconBox),Te=Dt.box.length>0),Ve=Ve&&Dt.offscreen,bt=Dt.occluded}let Kt=Q||me.numHorizontalGlyphVertices===0&&Je===0,Gi=re||me.numIconVertices===0;if(Kt||Gi?Gi?Kt||(Te=Te&&Ze):Ze=Te&&Ze:Te=Ze=Te&&Ze,Ze&&it&&it.box&&this.collisionIndex.insertCollisionBox(it.box,S.get("text-ignore-placement"),x.bucketInstanceId,vt&&vt.box&&ti?ti:ai,X.ID),Te&&Dt&&this.collisionIndex.insertCollisionBox(Dt.box,S.get("icon-ignore-placement"),x.bucketInstanceId,vi,X.ID),Ge&&(Ze&&this.collisionIndex.insertCollisionCircles(Ge.circles,S.get("text-ignore-placement"),x.bucketInstanceId,ai,X.ID),g)){let Xi=x.bucketInstanceId,Ci=this.collisionCircleArrays[Xi];Ci===void 0&&(Ci=this.collisionCircleArrays[Xi]=new __);for(let ni=0;ni<Ge.circles.length;ni+=4)Ci.circles.push(Ge.circles[ni+0]),Ci.circles.push(Ge.circles[ni+1]),Ci.circles.push(Ge.circles[ni+2]),Ci.circles.push(Ge.collisionDetected?1:0)}let hn=x.projection.name!=="globe";le=le&&(hn||!Ye),we=we&&(hn||!bt),this.placements[Qe]=new Ou(Ze||le,Te||we,Ve||x.justReloaded),h.add(Qe)};if(se&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),ne){let me=x.getSortedSymbolIndexes(this.transform.angle);for(let Le=me.length-1;Le>=0;--Le){let Be=me[Le];Re(x.symbolInstances.get(Be),Be,x.collisionArrays[Be])}x.hasAnyZOffset&&t.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let me=x.getSortedIndexesByZOffset();for(let Le=0;Le<me.length;++Le){let Be=me[Le];Re(x.symbolInstances.get(Be),Be,x.collisionArrays[Be])}}else for(let me=o.symbolInstanceStart;me<o.symbolInstanceEnd;me++)Re(x.symbolInstances.get(me),me,x.collisionArrays[me]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){let me=this.collisionCircleArrays[x.bucketInstanceId];t.ad.invert(me.invProjMatrix,k),me.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(o,h,g,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:D,crossTileID:A}=g,L=t.cJ(h),z=v===t.aE.vertical?D:L==="left"?x:L==="center"?S:L==="right"?k:-1;x>=0&&(o.text.placedSymbolArray.get(x).crossTileID=z>=0&&x!==z?0:A),S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=z>=0&&S!==z?0:A),k>=0&&(o.text.placedSymbolArray.get(k).crossTileID=z>=0&&k!==z?0:A),D>=0&&(o.text.placedSymbolArray.get(D).crossTileID=z>=0&&D!==z?0:A)}markUsedOrientation(o,h,g){let v=h===t.aE.horizontal||h===t.aE.horizontalOnly?h:0,x=h===t.aE.vertical?h:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:A}=g,L=o.text.placedSymbolArray;S>=0&&(L.get(S).placedOrientation=v),k>=0&&(L.get(k).placedOrientation=v),D>=0&&(L.get(D).placedOrientation=v),A>=0&&(L.get(A).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let v=h?h.symbolFadeChange(o):1,x=h?h.opacities:{},S=h?h.variableOffsets:{},k=h?h.placedOrientations:{};for(let D in this.placements){let A=this.placements[D],L=x[D];L?(this.opacities[D]=new Ls(L,v,A.text,A.icon,null,A.clipped),g=g||A.text!==L.text.placed||A.icon!==L.icon.placed):(this.opacities[D]=new Ls(null,v,A.text,A.icon,A.skipFade,A.clipped),g=g||A.text||A.icon)}for(let D in x){let A=x[D];if(!this.opacities[D]){let L=new Ls(A,v,!1,!1);L.isHidden()||(this.opacities[D]=L,g=g||A.text.placed||A.icon.placed)}}for(let D in S)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=S[D]);for(let D in k)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=k[D]);g?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h,g,v){let x=new Set;for(let S of h){let k=S.getBucket(o);k&&S.latestFeatureIndex&&o.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,x,S.collisionBoxArray,g,v,S.tileID),k.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(k,S.tileID),k.updateZOffset()))}}updateBucketOpacities(o,h,g,v,x,S){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let k=o.layers[0].layout,D=!!o.layers[0].dynamicFilter(),A=new Ls(null,0,!1,!1,!0),L=k.get("text-allow-overlap"),z=k.get("icon-allow-overlap"),U=k.get("text-variable-anchor"),H=k.get("text-rotation-alignment")==="map",Y=k.get("text-pitch-alignment")==="map",Z=new Ls(null,0,L&&(z||!o.hasIconData()||k.get("icon-optional")),z&&(L||!o.hasTextData()||k.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);let X=(re,oe,ae)=>{for(let _e=0;_e<oe/4;_e++)re.opacityVertexArray.emplaceBack(ae)},Q=0;x&&o.updateReplacement(S,x);for(let re=0;re<o.symbolInstances.length;re++){let oe=o.symbolInstances.get(re),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:_e,crossTileID:ge,numIconVertices:ne,tileAnchorX:se,tileAnchorY:le}=oe,we=h.has(ge),Re=this.opacities[ge];we?Re=A:Re||(Re=Z,this.opacities[ge]=Re),h.add(ge);let me=ae>0||_e>0,Le=ne>0,Be=this.placedOrientations[ge],Qe=Be===t.aE.vertical,Je=Be===t.aE.horizontal||Be===t.aE.horizontalOnly;!me&&!Le||Re.isHidden()||Q++;let Ze=!1;if((me||Le)&&x)for(let Te of o.activeReplacements){if(Te.order<v||Te.order===1/0||!(Te.clipMask&t.cu.Symbol)||Te.min.x>se||se>Te.max.x||Te.min.y>le||le>Te.max.y)continue;let Ve=t.cH(se,le,S.canonical,Te.footprintTileId.canonical);if(Ze=t.cI(Ve,Te),Ze)break}if(me){let Te=Ze?Fs:Ra(Re.text);X(o.text,ae,Qe?Fs:Te),X(o.text,_e,Je?Fs:Te);let Ve=Re.text.isHidden(),{leftJustifiedTextSymbolIndex:Ye,centerJustifiedTextSymbolIndex:bt,rightJustifiedTextSymbolIndex:yt,verticalPlacedTextSymbolIndex:kt}=oe,vt=o.text.placedSymbolArray,it=Ve||Qe?1:0;Ye>=0&&(vt.get(Ye).hidden=it),bt>=0&&(vt.get(bt).hidden=it),yt>=0&&(vt.get(yt).hidden=it),kt>=0&&(vt.get(kt).hidden=Ve||Je?1:0);let Ge=this.variableOffsets[ge];Ge&&this.markUsedJustification(o,Ge.anchor,oe,Be);let Dt=this.placedOrientations[ge];Dt&&(this.markUsedJustification(o,"left",oe,Dt),this.markUsedOrientation(o,Dt,oe))}if(Le){let Te=Ze?Fs:Ra(Re.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:Ye}=oe,bt=o.icon.placedSymbolArray,yt=Re.icon.isHidden()?1:0;Ve>=0&&(X(o.icon,ne,Qe?Fs:Te),bt.get(Ve).hidden=yt),Ye>=0&&(X(o.icon,oe.numVerticalIconVertices,Je?Fs:Te),bt.get(Ye).hidden=yt)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let Te=o.collisionArrays[re];if(Te){let Ve=new t.P(0,0),Ye=!0;if(Te.textBox||Te.verticalTextBox){if(U){let yt=this.variableOffsets[ge];yt?(Ve=Xp(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textScale),H&&Ve._rotate(Y?this.transform.angle:-this.transform.angle)):Ye=!1}D&&(Ye=!Re.clipped),Te.textBox&&uh(o.textCollisionBox.collisionVertexArray,Re.text.placed,!Ye||Qe,Ve.x,Ve.y),Te.verticalTextBox&&uh(o.textCollisionBox.collisionVertexArray,Re.text.placed,!Ye||Je,Ve.x,Ve.y)}let bt=Ye&&!!(!Je&&Te.verticalIconBox);Te.iconBox&&uh(o.iconCollisionBox.collisionVertexArray,Re.icon.placed,bt,oe.hasIconTextFit?Ve.x:0,oe.hasIconTextFit?Ve.y:0),Te.verticalIconBox&&uh(o.iconCollisionBox.collisionVertexArray,Re.icon.placed,!bt,oe.hasIconTextFit?Ve.x:0,oe.hasIconTextFit?Ve.y:0)}}}if(o.fullyClipped=Q===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){let re=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=re.invProjMatrix,o.placementViewportMatrix=re.viewportMatrix,o.collisionCircleArray=re.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){let g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function uh(f,o,h,g,v){f.emplaceBack(o?1:0,h?1:0,g||0,v||0),f.emplaceBack(o?1:0,h?1:0,g||0,v||0),f.emplaceBack(o?1:0,h?1:0,g||0,v||0),f.emplaceBack(o?1:0,h?1:0,g||0,v||0)}let Qp=Math.pow(2,25),gt=Math.pow(2,24),b_=Math.pow(2,17),Kp=Math.pow(2,16),Jp=Math.pow(2,9),y_=Math.pow(2,8),Ru=Math.pow(2,1);function Ra(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let o=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Qp+o*gt+h*b_+o*Kp+h*Jp+o*y_+h*Ru+o}let Fs=0;class xl{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,h,g,v,x){let S=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(S,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((k,D)=>k.sortKey-D.sortKey));this._currentPartIndex<S.length;){let k=S[this._currentPartIndex];if(h.placeLayerBucketPart(k,this._seenCrossTileIDs,g,k.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Lu{constructor(o,h,g,v,x,S,k,D,A){this.placement=new Ho(o,x,S,k,D,A),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,h,g,v){let x=t.e.now(),S=()=>{let k=t.e.now()-x;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){let k=h[o[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=D)&&(!k.maxzoom||k.maxzoom>D)){let A=k,L=A.layout.get("symbol-z-elevate"),z=this._inProgressLayer=this._inProgressLayer||new xl(A),U=t.al(k.source,k.scope);if(z.continuePlacement(L?v[U]:g[U],this.placement,this._showCollisionBoxes,k,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let zs=512/t.a3/2;class Hy{constructor(o,h,g){this.tileID=o,this.bucketInstanceId=g,this.index=new t.cK(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=o.canonical.x*t.a3,x=o.canonical.y*t.a3;for(let S=0;S<h.length;S++){let{key:k,crossTileID:D,tileAnchorX:A,tileAnchorY:L}=h.get(S),z=Math.floor((v+A)*zs),U=Math.floor((x+L)*zs);this.index.add(z,U),this.keys.push(k),this.crossTileIDs.push(D)}this.index.finish()}findMatches(o,h,g){let v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),x=zs/Math.pow(2,h.canonical.z-this.tileID.canonical.z),S=h.canonical.x*t.a3,k=h.canonical.y*t.a3;for(let D=0;D<o.length;D++){let A=o.get(D);if(A.crossTileID)continue;let{key:L,tileAnchorX:z,tileAnchorY:U}=A,H=Math.floor((S+z)*x),Y=Math.floor((k+U)*x),Z=this.index.range(H-v,Y-v,H+v,Y+v);for(let X of Z){let Q=this.crossTileIDs[X];if(this.keys[X]===L&&!g.has(Q)){g.add(Q),A.crossTileID=Q;break}}}}}class Wy{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ef{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let h=Math.round((o-this.lng)/360);if(h!==0)for(let g in this.indexes){let v=this.indexes[g],x={};for(let S in v){let k=v[S];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+h),x[k.tileID.key]=k}this.indexes[g]=x}this.lng=o}addBucket(o,h,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);let v=this.usedCrossTileIDs[o.overscaledZ];for(let x in this.indexes){let S=this.indexes[x];if(Number(x)>o.overscaledZ)for(let k in S){let D=S[k];D.tileID.isChildOf(o)&&D.findMatches(h.symbolInstances,o,v)}else{let k=S[o.scaledTo(Number(x)).key];k&&k.findMatches(h.symbolInstances,o,v)}}for(let x=0;x<h.symbolInstances.length;x++){let S=h.symbolInstances.get(x);S.crossTileID||(S.crossTileID=g.generate(),v.add(S.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Hy(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(let g of h.crossTileIDs)this.usedCrossTileIDs[o].delete(g)}removeStaleBuckets(o){let h=!1;for(let g in this.indexes){let v=this.indexes[g];for(let x in v)o[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],h=!0)}return h}}class Gy{constructor(){this.layerIndexes={},this.crossTileIDs=new Wy,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,g,v){let x=this.layerIndexes[o.fqid];x===void 0&&(x=this.layerIndexes[o.fqid]=new ef);let S=!1,k={};v.name!=="globe"&&x.handleWrapJump(g);for(let D of h){let A=D.getBucket(o);A&&o.fqid===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(D.tileID,A,this.crossTileIDs)&&(S=!0),k[A.bucketInstanceId]=!0)}return x.removeStaleBuckets(k)&&(S=!0),S}pruneUnusedLayers(o){let h={};o.forEach(g=>{h[g]=!0});for(let g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}let v_=new t.N({data:new t.O(t.L.colorTheme.data)}),Bs=(f,o)=>ri(f,o&&o.filter(h=>h.identifier!=="source.canvas")),tf=t.ah(Ri,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),qy=t.ah(Ri,["setCenter","setZoom","setBearing","setPitch"]),x_={version:8,layers:[],sources:{}},w_={duration:300,delay:0};class pa extends t.E{constructor(o,h={}){super(),this.map=o,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=t.W({},w_),this._buildingIndex=new Vy(this),this.crossTileSymbolIndex=new Gy,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Ht,this.dispatcher=h.dispatcher?h.dispatcher:new t.bw(t.bx(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Fd,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new t.cM(o._requestManager,h.localFontFamily?t.cN.all:h.localIdeographFontFamily?t.cN.ideographs:t.cN.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new su(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",t.cO());let g=this;this._rtlTextPluginCallback=pa.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,S)=>{if(t.cP(x),S&&S.every(k=>k))for(let k in g._sourceCaches){let D=g._sourceCaches[k],A=D.getSource().type;A!=="vector"&&A!=="geojson"||D.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let S in this._layers){let k=this._layers[S];k.source===x.id&&this._validateLayer(k)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(t.cQ(o))return o;let h=t.cR(o);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${t.cS(JSON.stringify(o))}`}_diffStyle(o,h,g){this.globalId=this._getGlobalId(o);let v=(x,S)=>{try{S(null,this.setState(x,g))}catch(k){S(k,!1)}};if(typeof o=="string"){let x=this.map._requestManager.normalizeStyleURL(o),S=this.map._requestManager.transformRequest(x,t.R.Style);t.g(S,(k,D)=>{k?this.fire(new t.d(k)):D&&v(D,h)})}else typeof o=="object"&&v(o,h)}loadURL(o,h={}){this.fire(new t.f("dataloading",{dataType:"style"}));let g=typeof h.validate=="boolean"?h.validate:!t.cQ(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,h.accessToken),this.resolvedImports.add(o);let v=this.importsCache.get(o);if(v)return this._load(v,g);let x=this.map._requestManager.transformRequest(o,t.R.Style);this._request=t.g(x,(S,k)=>{if(this._request=null,S)this.fire(new t.d(S));else if(k)return this.importsCache.set(o,k),this._load(k,g)})}loadJSON(o,h={}){this.fire(new t.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=t.e.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new t.f("dataloading",{dataType:"style"})),this._load(x_,!1)}_loadImports(o,h,g){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of o){let S=this._createFragmentStyle(x),k=new Promise(L=>{S.once("style.import.load",L),S.once("error",L)}).then(()=>this.mergeAll());if(v.push(k),this.resolvedImports.has(x.url)){S.loadEmpty();continue}let D=x.data||this.importsCache.get(x.url);D?(S.loadJSON(D,{validate:h}),this._isInternalStyle(D)&&(S.globalId=null)):x.url?S.loadURL(x.url,{validate:h}):S.loadEmpty();let A={style:S,id:x.id,config:x.config};if(g){let L=this.fragments.findIndex(({id:z})=>z===g);this.fragments=this.fragments.slice(0,L).concat(A).concat(this.fragments.slice(L))}else this.fragments.push(A)}return Promise.allSettled(v)}getImportGlobalIds(o=this,h=new Set){for(let g of o.fragments)g.style.globalId&&h.add(g.style.globalId),this.getImportGlobalIds(g.style,h);return[...h.values()]}_createFragmentStyle(o){let h=this.scope?t.al(o.id,this.scope):o.id,g,v=this._initialConfig&&this._initialConfig[h];(o.config||v)&&(g=t.W({},o.config,v));let x=new pa(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,h){let g=o.schema;if(this._isInternalStyle(o)){let S=t.W({},x_,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(S,h)}if(this.updateConfig(this._config,g),h&&Bs(this,be(o)))return;this._loaded=!0,this.stylesheet=t.cT(o);let v=()=>{for(let A in o.sources)this.addSource(A,o.sources[A],{validate:!1,isInitialLoad:!0});o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(o.glyphs,this.scope);let S=Yp(this.stylesheet.layers);if(this._order=S.map(A=>A.id),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let A=this.stylesheet.lights[0];this.light=new At(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new At(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let A of S){let L=t.cY(A,this.scope,this._styleColorTheme.lut,this.options);L.isConfigDependent&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L,this._serializedLayers[L.id]=L.serialize();let z=this.getOwnLayerSourceCache(L),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&L.canCastShadows()&&U&&(z.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.f("data",{dataType:"style"}));let D=this.isRootStyle();o.imports?this._loadImports(o.imports,h).then(()=>{this._reloadImports(),this.fire(new t.f(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new t.f(D?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let S=this._evaluateColorThemeData(x);this._loadColorTheme(S).then(()=>{v()}).catch(k=>{t.w(`Couldn't load color theme from the stylesheet: ${k}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,h,g,v,x,S,k,D,A={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(L=>{if(L.stylesheet){if(L.light!=null&&(o=L.light),L.stylesheet.lights)for(let z of L.stylesheet.lights)z.type==="ambient"&&L.ambientLight!=null&&(h=L.ambientLight),z.type==="directional"&&L.directionalLight!=null&&(g=L.directionalLight);v=this._prioritizeTerrain(v,L.terrain,L.stylesheet.terrain),L.stylesheet.fog&&L.fog!=null&&(x=L.fog),L.stylesheet.camera!=null&&(D=L.stylesheet.camera),L.stylesheet.projection!=null&&(S=L.stylesheet.projection),L.stylesheet.transition!=null&&(k=L.stylesheet.transition),A[L.scope]=L._styleColorTheme}}),this.light=o,this.ambientLight=h,this.directionalLight=g,this.fog=x,this._styleColorThemeForScope=A,v===null?delete this.terrain:this.terrain=v,this.camera=D||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=t.W({},w_,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){let h=g=>{for(let v of g.fragments)h(v.style);o(g)};h(this)}_prioritizeTerrain(o,h,g){let v=o&&o.drapeRenderMode===0;return g===null?h&&h.drapeRenderMode===0?h:v?o:null:h!=null&&(!o||v||h&&h.drapeRenderMode===1)?h:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{o=this._prioritizeTerrain(o,h.terrain,h.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(o=h.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){let o={},h={},g={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let S=t.al(x,v.scope);o[S]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let S=t.al(x,v.scope);h[S]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let S=t.al(x,v.scope);g[S]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=g}mergeLayers(){let o={},h=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(let k of S._order){let D=S._layers[k];if(D.type==="slot"){let A=t.cU(k);if(o[A])continue;o[A]=[]}D.slot&&o[D.slot]?o[D.slot].push(D):h.push(D)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(S=[])=>{for(let k of S)if(k.type==="slot"){let D=t.cU(k.id);o[D]&&x(o[D]),this._mergedSlots.push(D)}else{let D=t.al(k.id,k.scope);this._mergedOrder.push(D),g[D]=k,k.is3D()&&(this._has3DLayers=!0),k.type==="circle"&&(this._hasCircleLayers=!0),k.type==="symbol"&&(this._hasSymbolLayers=!0),k.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(h),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=t.W({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(h,g,v){let x=t.W({},g);for(let k of Object.keys(t.L.colorTheme))x[k]===void 0&&(x[k]=t.L.colorTheme[k].default);let S=new t.U(v_,h,new Map(v));return S.setTransitionOrValue(x,v),S.untransitioned().possiblyEvaluate(new t.X(0))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){return this._styleColorTheme.lutLoading=!0,new Promise((h,g)=>{let v="data:image/png;base64,";if(o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();o.startsWith(v)||(o=v+o);let x="mapbox-reserved-lut",S=new Image;S.src=o,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},S.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:k,height:D,data:A}=t.e.getImageData(S);if(D>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==D*D)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new t.i({width:k,height:D},A),pixelRatio:1,sdf:!1,version:0});let L=this.imageManager.getImage(x,this.scope);L?(this._styleColorTheme.lut={image:L.data,data:o},h()):g(new Error("Missing LUT image."))}})}getLut(o){let h=this._styleColorThemeForScope[o];return h?h.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(h,g,v){let x,S,k,D=t.e.devicePixelRatio>1?"@2x":"",A=t.g(g.transformRequest(g.normalizeSpriteURL(h,D,".json"),t.R.SpriteJSON),(U,H)=>{A=null,k||(k=U,x=H,z())}),L=t.h(g.transformRequest(g.normalizeSpriteURL(h,D,".png"),t.R.SpriteImage),(U,H)=>{L=null,k||(k=U,S=H,z())});function z(){if(k)v(k);else if(x&&S){let U=t.e.getImageData(S),H={};for(let Y in x){let{width:Z,height:X,x:Q,y:re,sdf:oe,pixelRatio:ae,stretchX:_e,stretchY:ge,content:ne}=x[Y],se=new t.i({width:Z,height:X});t.i.copy(U,se,{x:Q,y:re},{x:0,y:0},{width:Z,height:X},null),H[Y]={data:se,pixelRatio:ae,sdf:oe,stretchX:_e,stretchY:ge,content:ne}}v(null,H)}}return{cancel(){A&&(A.cancel(),A=null),L&&(L.cancel(),L=null)}}}(o,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new t.d(h));else if(g)for(let v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.f("data",{dataType:"style"}))})}_validateLayer(o){let h=this.getOwnSource(o.source);if(!h)return;let g=o.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new t.d(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,h)=>{let g=this.fragments[h];return g&&g.style&&(o.data=g.style.serialize()),o})}_serializeSources(){let o={};for(let h in this._sourceCaches){let g=this._sourceCaches[h].getSource();o[g.id]||(o[g.id]=g.serialize())}return o}_serializeLayers(o){let h=[];for(let g of o){let v=this._layers[g];v&&v.type!=="custom"&&h.push(v.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(let o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){let h=this.getOwnLayer(o);if(h)return h;this.fire(new t.d(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){let h=this.getOwnSource(o);if(h)return h;this.fire(new t.d(new Error(`The source '${o}' does not exist in the map's style.`)))}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);let h=this.calculateLightsBrightness();o.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));let g=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let S=this._changes.getLayerUpdatesByScope();for(let k in S){let{updatedIds:D,removedIds:A}=S[k];(D||A)&&(this._updateWorkerLayers(k,D,A),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._changes.reset()}let x={};for(let S in this._mergedSourceCaches){let k=this._mergedSourceCaches[S];x[S]=k.used,k.used=!1,k.tileCoverLift=0}for(let S of this._mergedOrder){let k=this._mergedLayers[S];if(k.recalculate(o,this._availableImages),!k.isHidden(o.zoom)){let D=this.getLayerSourceCache(k);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,k.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let D=k.minzoom||0;D<(k.maxzoom||25.5);D++){let A=this.map.painter;if(A){let L=k.getProgramIds();if(!L)continue;for(let z of L){let U=k.getDefaultProgramParams(z,o.zoom,this._styleColorTheme.lut);U&&(A.style=this,this.fog&&(A._fogVisible=!0,U.overrideFog=!0,A.getOrCreateProgram(z,U)),A._fogVisible=!1,U.overrideFog=!1,A.getOrCreateProgram(z,U),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(U.overrideRtt=!0,A.getOrCreateProgram(z,U)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let S in x){let k=this._mergedSourceCaches[S];x[S]!==k.used&&k.getSource().fire(new t.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new t.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let o=this._changes.getUpdatedImages();if(o.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changes.resetUpdatedImages()}}_updateWorkerLayers(o,h,g){let v=this.getFragmentStyle(o);v&&this.dispatcher.broadcast("updateLayers",{layers:h?v._serializeLayers(h):[],scope:o,removedIds:g||[],options:v.options})}setState(o,h){if(this._checkLoaded(),Bs(this,be(o)))return!1;(o=t.cT(o)).layers=Yp(o.layers);let g=function(S,k){if(!S)return[{command:Ri.setStyle,args:[k]}];let D=[];try{if(!_(S.version,k.version))return[{command:Ri.setStyle,args:[k]}];if(_(S.center,k.center)||D.push({command:Ri.setCenter,args:[k.center]}),_(S.zoom,k.zoom)||D.push({command:Ri.setZoom,args:[k.zoom]}),_(S.bearing,k.bearing)||D.push({command:Ri.setBearing,args:[k.bearing]}),_(S.pitch,k.pitch)||D.push({command:Ri.setPitch,args:[k.pitch]}),_(S.sprite,k.sprite)||D.push({command:Ri.setSprite,args:[k.sprite]}),_(S.glyphs,k.glyphs)||D.push({command:Ri.setGlyphs,args:[k.glyphs]}),_(S.imports,k.imports)||function(H=[],Y=[],Z){Y=Y||[];let X=(H=H||[]).map(Pu),Q=Y.map(Pu),re=H.reduce(Oc,{}),oe=Y.reduce(Oc,{}),ae=X.slice(),_e,ge,ne,se;for(_e=0,ge=0;_e<X.length;_e++)ne=X[_e],oe.hasOwnProperty(ne)?ge++:(Z.push({command:Ri.removeImport,args:[ne]}),ae.splice(ae.indexOf(ne,ge),1));for(_e=0,ge=0;_e<Q.length;_e++)ne=Q[Q.length-1-_e],ae[ae.length-1-_e]!==ne&&(re.hasOwnProperty(ne)?(Z.push({command:Ri.removeImport,args:[ne]}),ae.splice(ae.lastIndexOf(ne,ae.length-ge),1)):ge++,se=ae[ae.length-_e],Z.push({command:Ri.addImport,args:[oe[ne],se]}),ae.splice(ae.length-_e,0,ne));for(let le of Y){let we=re[le.id];we&&!_(we,le)&&Z.push({command:Ri.updateImport,args:[le.id,le]})}}(S.imports,k.imports,D),_(S.transition,k.transition)||D.push({command:Ri.setTransition,args:[k.transition]}),_(S.light,k.light)||D.push({command:Ri.setLight,args:[k.light]}),_(S.fog,k.fog)||D.push({command:Ri.setFog,args:[k.fog]}),_(S.projection,k.projection)||D.push({command:Ri.setProjection,args:[k.projection]}),_(S.lights,k.lights)||D.push({command:Ri.setLights,args:[k.lights]}),_(S.camera,k.camera)||D.push({command:Ri.setCamera,args:[k.camera]}),!_(S["color-theme"],k["color-theme"]))return[{command:Ri.setStyle,args:[k]}];let A={},L=[];(function(H,Y,Z,X){let Q;for(Q in Y=Y||{},H=H||{})H.hasOwnProperty(Q)&&(Y.hasOwnProperty(Q)||p_(Q,Z,X));for(Q in Y){if(!Y.hasOwnProperty(Q))continue;let re=Y[Q];H.hasOwnProperty(Q)?_(H[Q],re)||(H[Q].type==="geojson"&&re.type==="geojson"&&Uy(H,Y,Q)?Z.push({command:Ri.setGeoJSONSourceData,args:[Q,re.data]}):jy(Q,Y,Z,X)):ts(Q,Y,Z)}})(S.sources,k.sources,L,A);let z=[];S.layers&&S.layers.forEach(H=>{H.source&&A[H.source]?D.push({command:Ri.removeLayer,args:[H.id]}):z.push(H)});let U=S.terrain;U&&A[U.source]&&(D.push({command:Ri.setTerrain,args:[void 0]}),U=void 0),D=D.concat(L),_(U,k.terrain)||D.push({command:Ri.setTerrain,args:[k.terrain]}),function(H,Y,Z){Y=Y||[];let X=(H=H||[]).map(Pu),Q=Y.map(Pu),re=H.reduce(Oc,{}),oe=Y.reduce(Oc,{}),ae=X.slice(),_e=Object.create(null),ge,ne,se,le,we,Re,me;for(ge=0,ne=0;ge<X.length;ge++)se=X[ge],oe.hasOwnProperty(se)?ne++:(Z.push({command:Ri.removeLayer,args:[se]}),ae.splice(ae.indexOf(se,ne),1));for(ge=0,ne=0;ge<Q.length;ge++)se=Q[Q.length-1-ge],ae[ae.length-1-ge]!==se&&(re.hasOwnProperty(se)?(Z.push({command:Ri.removeLayer,args:[se]}),ae.splice(ae.lastIndexOf(se,ae.length-ne),1)):ne++,Re=ae[ae.length-ge],Z.push({command:Ri.addLayer,args:[oe[se],Re]}),ae.splice(ae.length-ge,0,se),_e[se]=!0);for(ge=0;ge<Q.length;ge++)if(se=Q[ge],le=re[se],we=oe[se],!_e[se]&&!_(le,we))if(_(le.source,we.source)&&_(le["source-layer"],we["source-layer"])&&_(le.type,we.type)){for(me in lh(le.layout,we.layout,Z,se,null,Ri.setLayoutProperty),lh(le.paint,we.paint,Z,se,null,Ri.setPaintProperty),_(le.slot,we.slot)||Z.push({command:Ri.setSlot,args:[se,we.slot]}),_(le.filter,we.filter)||Z.push({command:Ri.setFilter,args:[se,we.filter]}),_(le.minzoom,we.minzoom)&&_(le.maxzoom,we.maxzoom)||Z.push({command:Ri.setLayerZoomRange,args:[se,we.minzoom,we.maxzoom]}),le)le.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?lh(le[me],we[me],Z,se,me.slice(6),Ri.setPaintProperty):_(le[me],we[me])||Z.push({command:Ri.setLayerProperty,args:[se,me,we[me]]}));for(me in we)we.hasOwnProperty(me)&&!le.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?lh(le[me],we[me],Z,se,me.slice(6),Ri.setPaintProperty):_(le[me],we[me])||Z.push({command:Ri.setLayerProperty,args:[se,me,we[me]]}))}else Z.push({command:Ri.removeLayer,args:[se]}),Re=ae[ae.lastIndexOf(se)+1],Z.push({command:Ri.addLayer,args:[we,Re]})}(z,k.layers,D)}catch(A){console.warn("Unable to compute style diff:",A),D=[{command:Ri.setStyle,args:[k]}]}return D}(this.serialize(),o).filter(S=>!(S.command in qy));if(g.length===0)return!1;let v=g.filter(S=>!(S.command in tf));if(v.length>0)throw new Error(`Unimplemented: ${v.map(S=>S.command).join(", ")}.`);let x=[];return g.forEach(S=>{x.push(this[S.command].apply(this,S.args))}),h&&Promise.all(x).then(h),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(o,h){return this.getImage(o)?this.fire(new t.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,this.scope,h),this._afterImageUpdated(o),this)}updateImage(o,h){this.imageManager.updateImage(o,this.scope,h)}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._afterImageUpdated(o),this):this.fire(new t.d(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(o),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(o,h,g={}){return this._checkLoaded(),this._validate(pi,`models.${o}`,h,null,g)||(this.modelManager.addModel(o,h,this.scope),this._changes.setDirty()),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this):this.fire(new t.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,h,g={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(ye,`sources.${o}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let v=vu(o,h,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=S=>{let k=(S?"symbol:":"other:")+v.id,D=t.al(k,this.scope),A=this._sourceCaches[k]=new t.bv(D,v,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=A,A.onAdd(this.map)};x(!1),h.type!=="vector"&&h.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();let h=this.getOwnSource(o);if(!h)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===o)return this.fire(new t.d(new Error(`Source "${o}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new t.d(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));let g=this.getOwnSourceCaches(o);for(let v of g){let x=t.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new t.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,h){this._checkLoaded(),this.getOwnSource(o).setData(h),this._changes.setDirty()}getOwnSource(o){let h=this.getOwnSourceCache(o);return h&&h.getSource()}getOwnSources(){let o=[];for(let h in this._otherSourceCaches){let g=this.getOwnSourceCache(h);g&&o.push(g.getSource())}return o}areTilesLoaded(){let o=this._mergedSourceCaches;for(let h in o){let g=o[h]._tiles;for(let v in g){let x=g[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;let h=this._getTransitionParameters();for(let v of o){if(this._validate(Ne,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(h)}else this.ambientLight=new Nd(v,di,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(h)}else this.directionalLight=new Nd(v,cp,this.scope,this.options)}}let g=new t.X(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let o=this.directionalLight,h=this.ambientLight;if(!o||!h)return;let g=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),v=o.properties.get("color").toRenderColor(null).toArray01(),x=o.properties.get("intensity"),S=o.properties.get("direction"),k=1-t.ac(S.x,S.y,S.z)[2]/90,D=g(v)*x*k,A=h.properties.get("color").toRenderColor(null).toArray01(),L=h.properties.get("intensity");return(D+g(A)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(!o)return this;if(t.cV(o)){let h=t.cW(o),g=this.fragments.find(({id:x})=>x===h);if(!g)throw new Error(`Style import not found: ${o}`);let v=t.cU(o);return g.style.getFragmentStyle(v)}{let h=this.fragments.find(({id:g})=>g===o);if(!h)throw new Error(`Style import not found: ${o}`);return h.style}}getConfigProperty(o,h){let g=this.getFragmentStyle(o);if(!g)return null;let v=t.al(h,g.scope),x=g.options.get(v),S=x?x.value||x.default:null;return S?S.serialize():null}setConfigProperty(o,h,g){let v=this.getFragmentStyle(o);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[h])return;let S=t.y(g);if(S.result!=="success")return void Bs(this,S.value);let k=S.value.expression,D=t.al(h,v.scope),A=v.options.get(D);if(!A)return;let L,{minValue:z,maxValue:U,stepValue:H,type:Y,values:Z}=x[h],X=t.y(x[h].default);X.result==="success"&&(L=X.value.expression),L?(this.options.set(D,ja(Ji({},A),{value:k,default:L,minValue:z,maxValue:U,stepValue:H,type:Y,values:Z})),this.updateConfigDependencies()):this.fire(new t.d(new Error(`No schema defined for the config option "${h}" in the "${o}" fragment.`)))}getConfig(o){let h=this.getFragmentStyle(o);if(!h)return null;let g=h.stylesheet.schema;if(!g)return null;let v={};for(let x in g){let S=t.al(x,h.scope),k=h.options.get(S),D=k?k.value||k.default:null;v[x]=D?D.serialize():null}return v}setConfig(o,h){let g=this.getFragmentStyle(o);g&&(g.updateConfig(h,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){let h=this.getFragmentStyle(o);return h?h.stylesheet.schema:null}setSchema(o,h){let g=this.getFragmentStyle(o);g&&(g.stylesheet.schema=h,g.updateConfig(g._config,h),this.updateConfigDependencies())}updateConfig(o,h){if(this._config=o,o||h)if(h)for(let g in h){let v,x,S=t.y(h[g].default);if(S.result==="success"&&(v=S.value.expression),o&&o[g]!==void 0){let U=t.y(o[g]);U.result==="success"&&(x=U.value.expression)}let{minValue:k,maxValue:D,stepValue:A,type:L,values:z}=h[g];if(v){let U=t.al(g,this.scope);this.options.set(U,{default:v,value:x,minValue:k,maxValue:D,stepValue:A,type:L,values:z})}else this.fire(new t.d(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new t.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let o of this._configDependentLayers){let h=this.getLayer(o);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(o=>{if(o._styleColorTheme.colorTheme){let h=o._evaluateColorThemeData(o._styleColorTheme.colorTheme);(!o._styleColorTheme.lut||o._styleColorTheme.lut&&h!==o._styleColorTheme.lut.data)&&o.setColorTheme(o._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(o,h,g={}){this._checkLoaded();let v=o.id;if(this._layers[v])return void this.fire(new t.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(o.type==="custom"){if(Bs(this,t.cX(o)))return;x=t.cY(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(v,o.source),o=t.cT(o),o=t.W(o,{source:v})),this._validate(ft,`layers.${v}`,o,{arrayIndex:-1},g))return;x=t.cY(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let S=this._order.length;if(h){let L=this._order.indexOf(h);if(L===-1)return void this.fire(new t.d(new Error(`Layer with id "${h}" does not exist on this map.`)));x.slot===this._layers[h].slot?S=L:t.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let k=this.getOwnLayerSourceCache(x),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&x.canCastShadows()&&D&&(k.castsShadows=!0);let A=this._changes.getRemovedLayer(x);if(A&&x.source&&k&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let L=t.al(x.source,x.scope);A.type!==x.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),k.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(o,h){this._checkLoaded();let g=this._checkLayer(o);if(!g||o===h)return;let v=this._order.indexOf(o);this._order.splice(v,1);let x=this._order.length;if(h){let S=this._order.indexOf(h);if(S===-1)return void this.fire(new t.d(new Error(`Layer with id "${h}" does not exist on this map.`)));g.slot===this._layers[h].slot?x=S:t.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();let h=this._checkLayer(o);if(!h)return;h.setEventedParent(null);let g=this._order.indexOf(o);this._order.splice(g,1),delete this._layers[o],delete this._serializedLayers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);let v=this.getOwnLayerSourceCache(h);if(v&&v.castsShadows){let x=!1;for(let S in this._layers)if(this._layers[S].source===h.source&&this._layers[S].canCastShadows()){x=!0;break}v.castsShadows=x}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(let h in this._layers)if(this._layers[h].type===o)return!0;return!1}setLayerZoomRange(o,h,g){this._checkLoaded();let v=this._checkLayer(o);v&&(v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,h){this._checkLoaded();let g=this._checkLayer(o);g&&g.slot!==h&&(g.slot=h,this._updateLayer(g))}setFilter(o,h,g={}){this._checkLoaded();let v=this._checkLayer(o);if(v&&!_(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(lt,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=t.cT(h),this._updateLayer(v)))}getFilter(o){let h=this._checkLayer(o);if(h)return t.cT(h.filter)}setLayoutProperty(o,h,g,v={}){this._checkLoaded();let x=this._checkLayer(o);if(x&&!_(x.getLayoutProperty(h),g)){if(g!=null&&(!v||v.validate!==!1)&&Bs(x,$t.call(be,{key:`layers.${o}.layout.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:t.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(h,g),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(o,h){let g=this._checkLayer(o);if(g)return g.getLayoutProperty(h)}setPaintProperty(o,h,g,v={}){this._checkLoaded();let x=this._checkLayer(o);if(!x||_(x.getPaintProperty(h),g)||g!=null&&(!v||v.validate!==!1)&&Bs(x,Rt.call(be,{key:`layers.${o}.paint.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:t.L})))return;let S=x.setPaintProperty(h,g);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),S&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(o,h){let g=this._checkLayer(o);if(g)return g.getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();let g=o.source,v=o.sourceLayer,x=this._checkSource(g);if(!x)return;let S=x.type;if(S==="geojson"&&v)return void this.fire(new t.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!v)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new t.d(new Error("The feature id parameter must be provided.")));let k=this.getOwnSourceCaches(g);for(let D of k)D.setFeatureState(v,o.id,h)}removeFeatureState(o,h){this._checkLoaded();let g=o.source,v=this._checkSource(g);if(!v)return;let x=v.type,S=x==="vector"?o.sourceLayer:void 0;if(x==="vector"&&!S)return void this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new t.d(new Error("A feature id is required to remove its specific state property.")));let k=this.getOwnSourceCaches(g);for(let D of k)D.removeFeatureState(S,o.id,h)}getFeatureState(o){this._checkLoaded();let h=o.source,g=o.sourceLayer,v=this._checkSource(h);if(v){if(v.type!=="vector"||g)return o.id===void 0&&this.fire(new t.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,o.id);this.fire(new t.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=t.W({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return t.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let o=this.getTerrain(),h=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return t.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(o){this._changes.updateLayer(o);let h=this.getLayerSourceCache(o),g=t.al(o.source,o.scope),v=this._changes.getUpdatedSourceCaches();o.source&&!v[g]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),h.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){let h=k=>this._mergedLayers[k].type==="fill-extrusion"||this._mergedLayers[k].type==="model",g=this.order,v={},x=[];for(let k=g.length-1;k>=0;k--){let D=g[k];if(h(D)){v[D]=k;for(let A of o){let L=A[D];if(L)for(let z of L)x.push(z)}}}x.sort((k,D)=>D.intersectionZ-k.intersectionZ);let S=[];for(let k=g.length-1;k>=0;k--){let D=g[k];if(h(D))for(let A=x.length-1;A>=0;A--){let L=x[A].feature;if(L.layer&&v[L.layer.id]<k)break;S.push(L),x.pop()}else for(let A of o){let L=A[D];if(L)for(let z of L)S.push(z.feature)}}return S}queryRenderedFeatures(o,h,g){h&&h.filter&&this._validate(lt,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;let v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new t.d(new Error("parameters.layers must be an Array."))),[];for(let A of h.layers){let L=this._mergedLayers[A];if(!L)return this.fire(new t.d(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];v[L.source]=!0}}let x=[],S=h.serializedLayers||{},k=h&&h.layers?h.layers.some(A=>{let L=this.getLayer(A);return L&&L.is3D()}):this.has3DLayers(),D=Kr.createFromScreenPoints(o,g);for(let A in this._mergedSourceCaches){let L=this._mergedSourceCaches[A].getSource();if(!L||L.scope!==h.scope)continue;let z=this._mergedSourceCaches[A].getSource().id;h.layers&&!v[z]||x.push(Ny(this._mergedSourceCaches[A],this._mergedLayers,S,D,h,g,k,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,L,z,U,H,Y,Z){let X={},Q=Y.queryRenderedSymbols(U),re=[];for(let oe of Object.keys(Q).map(Number))re.push(Z[oe]);re.sort(Ac);for(let oe of re){let ae=oe.featureIndex.lookupSymbolFeatures(Q[oe.bucketInstanceId],L,oe.bucketIndex,oe.sourceLayerIndex,H.filter,H.layers,H.availableImages,A);for(let _e in ae){let ge=X[_e]=X[_e]||[],ne=ae[_e];ne.sort((se,le)=>{let we=oe.featureSortOrder;if(we){let Re=we.indexOf(se.featureIndex);return we.indexOf(le.featureIndex)-Re}return le.featureIndex-se.featureIndex});for(let se of ne)ge.push(se)}}for(let oe in X)X[oe].forEach(ae=>{let _e=ae.feature,ge=z(A[oe]);if(!ge)return;let ne=ge.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=ne});return X}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),D.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,h){h&&h.filter&&this._validate(lt,"querySourceFeatures.filter",h.filter,null,h);let g=this.getOwnSourceCaches(o),v=[];for(let x of g)v=v.concat(sh(x,h));return v}addSourceType(o,h,g){return pa.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(pa.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,h,g={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let k in o)if(!_(o[k],v[k])){x=!0;break}if(!x)return;let S=this._getTransitionParameters();this.light.setLight(o,h,g),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=t.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,h=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()&&h!==0||delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=o,v=o.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){let k="terrain-dem-src";this.addSource(k,g.source),g=t.cT(g),g=t.W(g,{source:k})}let x=t.W({},g),S={};if(this.terrain&&v){x.source=this.terrain.get().source;let k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(S.style=k.serialize())}if(this._validate(Ie,"terrain",x,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h),this.fire(new t.f("data",{dataType:"style"}))}else{let x=this.terrain,S=x.get();for(let k of Object.keys(t.L.terrain))!g.hasOwnProperty(k)&&t.L.terrain[k].default&&(g[k]=t.L.terrain[k].default);for(let k in o)if(!_(o[k],S[k])){x.set(o,this.options),this.stylesheet.terrain=o;let D=this._getTransitionParameters({duration:0});x.updateTransitions(D),this.fire(new t.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){let h=this.fog=new Gg(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog;if(!_(h.get(),o)){h.set(o,this.options),this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createFog(o);this._markersNeedUpdate=!0}setColorTheme(o){this._checkLoaded();let h=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=o,!o)return this._styleColorTheme.lut=null,void h();let g=this._evaluateColorThemeData(o);this._loadColorTheme(g).then(()=>{h()}).catch(v=>{t.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(o){return{now:t.e.now(),transition:t.W(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;let o=[],h=[];for(let g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?o.push(g):h.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...h)}_createTerrain(o,h){let g=this.terrain=new Qi(o,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(let o in this._layers){let h=this._layers[o];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let o in this._layers){let h=this._layers[o];h.type==="symbol"&&this._updateLayer(h)}}_validate(o,h,g,v,x={}){if(x&&x.validate===!1)return!1;let S=t.W({},this.serialize());return Bs(this,o.call(be,t.W({key:h,style:S,value:g,styleSpec:t.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(o){let h=this.getSourceCaches(o);for(let g of h)g.clearTiles()}clearSources(){for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){let h=this.getSourceCaches(o);for(let g of h)g.resume(),g.reload()}reloadSources(){for(let o of this.getSources())o.reload&&o.reload()}updateSources(o){let h;this.directionalLight&&(h=Gd(this.directionalLight));for(let g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(o,void 0,void 0,h)}_generateCollisionBoxes(){for(let o in this._sourceCaches){let h=this._sourceCaches[o];h.resume(),h.reload()}}_updatePlacement(o,h,g,v,x,S,k=!1){let D=!1,A=!1,L={},z={};for(let H of this._mergedOrder){let Y=this._mergedLayers[H];if(Y.type!=="symbol")continue;let Z=t.al(Y.source,Y.scope),X=L[Z];if(!X){let re=this.getLayerSourceCache(Y);if(!re)continue;let oe=re.getRenderableIds(!0).map(ae=>re.getTileByID(ae));z[Z]=oe.slice(),X=L[Z]=oe.sort((ae,_e)=>_e.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(_e.tileID)?-1:1))}let Q=this.crossTileSymbolIndex.addLayer(Y,X,h.center.lng,h.projection);D=D||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new t.f("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.e.now(),h.zoom))&&(this.pauseablePlacement=new Lu(h,this._mergedOrder,k,g,v,x,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.e.now()),A=!0),D&&this.pauseablePlacement.placement.setStale()),A||D){this._buildingIndex.onNewFrame(h.zoom);for(let H=0;H<this._mergedOrder.length;H++){let Y=this._mergedLayers[this._mergedOrder[H]];if(Y.type!=="symbol")continue;let Z=this.isLayerClipped(Y)&&this._clipLayerIndices.some(X=>H<X);this.placement.updateLayerOpacities(Y,L[t.al(Y.source,Y.scope)],H,Z?S:null)}}let U=!1;for(let H of this._mergedOrder){let Y=this._mergedLayers[H];if(Y.type!=="symbol")continue;let Z=L[t.al(Y.source,Y.scope)];for(let X of Z){let Q=X.getBucket(Y);Q&&X.latestFeatureIndex&&Y.fqid===Q.layerIds[0]&&(U=Q.updateOcclusionOpacities(o.context,o.symbolParams,o._dt)||U)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.e.now())||U,occlusionQueryBasedOpacityChanged:U}}_releaseSymbolFadeTiles(){for(let o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,h){this._checkLoaded();let g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:x})=>x===o.id)!==-1)return void this.fire(new t.d(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!h)return g.push(o),this._loadImports([o],!0);let v=g.findIndex(({id:x})=>x===h);return v===-1&&this.fire(new t.d(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(o).concat(g.slice(v)),this._loadImports([o],!0,h)}updateImport(o,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(o);return v===-1?this:typeof h=="string"?(this.setImportUrl(o,h),this):(h.url&&h.url!==g[v].url&&this.setImportUrl(o,h.url),_(h.config,g[v].config)||this.setImportConfig(o,h.config),_(h.data,g[v].data)||this.setImportData(o,h.data),this)}moveImport(o,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(o);if(v===-1)return this;let x=this.getImportIndex(h);if(x===-1)return this;let S=g[v],k=this.fragments[v];return g=g.filter(({id:D})=>D!==o),this.fragments=this.fragments.filter(({id:D})=>D!==o),this.stylesheet.imports=g.slice(0,x).concat(S).concat(g.slice(x)),this.fragments=this.fragments.slice(0,x).concat(k).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(o,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(o);if(v===-1)return this;g[v].url=h;let x=this.fragments[v];return x.style=this._createFragmentStyle(g[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(h),this}setImportData(o,h){this._checkLoaded();let g=this.getImportIndex(o),v=this.stylesheet.imports||[];return g===-1?this:h?(this.fragments[g].style.setState(h),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(o,v[g].url))}setImportConfig(o,h){this._checkLoaded();let g=this.getImportIndex(o),v=this.stylesheet.imports||[];if(g===-1)return this;h?v[g].config=h:delete v[g].config;let x=this.fragments[g],S=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=h,x.style.updateConfig(h,S),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(o);g!==-1&&(h.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(o){let h=(this.stylesheet.imports||[]).findIndex(g=>g.id===o);return h===-1&&this.fire(new t.d(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),h}getLayer(o){return this._mergedLayers[o]}getSources(){let o=[];for(let h in this._mergedOtherSourceCaches){let g=this._mergedOtherSourceCaches[h];g&&o.push(g.getSource())}return o}getSource(o,h){let g=this.getSourceCache(o,h);return g&&g.getSource()}getLayerSource(o){let h=this.getLayerSourceCache(o);return h&&h.getSource()}getSourceCache(o,h){let g=t.al(o,h);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(o){let h=t.al(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);let h=[];return this._mergedOtherSourceCaches[o]&&h.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&h.push(this._mergedSymbolSourceCaches[o]),h}updateSourceCaches(){let o=this._changes.getUpdatedSourceCaches();for(let h in o){let g=o[h];g==="reload"?this.reloadSource(h):g==="clear"&&this.clearSource(h)}}updateLayers(o){let h=this._changes.getUpdatedPaintProperties();for(let g of h){let v=this.getLayer(g);v&&v.updateTransitions(o)}}getImages(o,h,g){this.imageManager.getImages(h.icons,h.scope,g),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(o,h,g){this.glyphManager.getGlyphs(h.stacks,h.scope,g)}getResource(o,h,g){return t.c$(h,g)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){let h=[];return this._otherSourceCaches[o]&&h.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&h.push(this._symbolSourceCaches[o]),h}_isSourceCacheLoaded(o){let h=this.getOwnSourceCaches(o);return h.length===0?(this.fire(new t.d(new Error(`There is no source with ID '${o}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,h){if(this._clipLayerIndices.length===0&&o.type!=="fill-extrusion")return!1;let g=o.type==="fill-extrusion"&&o.sourceLayer==="building",v=0;if(o.is3D()){if(g||h&&h.type==="batched-model")return!0;o.type==="model"&&(v=t.cu.Model)}else o.type==="symbol"&&(v=t.cu.Symbol);for(let x of this._clipLayerIndices){let S=this._mergedLayers[this._mergedOrder[x]];if(!S)continue;let k=[];for(let D of S.layout.get("clip-layer-types"))k.push(D==="model"?t.cu.Model:D==="symbol"?t.cu.Symbol:t.cu.FillExtrusion);for(let D of k)if(v&D)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function nf(f,o){let h=!1,g=null,v=()=>{g=null,h&&(f(),g=setTimeout(v,o),h=!1)};return()=>(h=!0,g||v(),g)}pa.getSourceType=function(f){return Rr[f]},pa.setSourceType=function(f,o){Rr[f]=o},pa.registerForPluginStateChange=t.cL;class $y{constructor(o){this._hashName=o&&encodeURIComponent(o),t.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=nf(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let o=this._map;if(!o)return"";let h=mh(o);if(this._hashName){let g=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(S=>{let k=S.split("=")[0];return k===g?(v=!0,`${k}=${h}`):S}).filter(S=>S);return v||x.push(`${g}=${h}`),`#${x.join("&")}`}return`#${h}`}_getCurrentHash(){let o=location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){let o=this._map;if(!o)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){let g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(h[3]||0):o.getBearing();return o.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function mh(f,o){let h=f.getCenter(),g=Math.round(100*f.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),S=Math.round(h.lng*x)/x,k=Math.round(h.lat*x)/x,D=f.getBearing(),A=f.getPitch(),L=o?`/${S}/${k}/${g}`:`${g}/${k}/${S}`;return(D||A)&&(L+="/"+Math.round(10*D)/10),A&&(L+=`/${Math.round(A)}`),L}let Fu={linearity:.3,easing:t.d0(0,0,.3,1)},C_=t.W({deceleration:2500,maxSpeed:1400},Fu),rf=t.W({deceleration:20,maxSpeed:1400},Fu),zu=t.W({deceleration:1e3,maxSpeed:360},Fu),of=t.W({deceleration:1e3,maxSpeed:90},Fu);class wl{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.e.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,h=t.e.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let h={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);let g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){let x=ph(h.pan.mag(),g,t.W({},C_,o||{}));v.offset=h.pan.mult(x.amount/h.pan.mag()),v.center=this._map.transform.center,Rc(v,x)}if(h.zoom){let x=ph(h.zoom,g,rf);v.zoom=this._map.transform.zoom+x.amount,Rc(v,x)}if(h.bearing){let x=ph(h.bearing,g,zu);v.bearing=this._map.transform.bearing+t.at(x.amount,-179,179),Rc(v,x)}if(h.pitch){let x=ph(h.pitch,g,of);v.pitch=this._map.transform.pitch+x.amount,Rc(v,x)}if(v.zoom||v.bearing){let x=h.pinchAround===void 0?h.around:h.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Rc(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function ph(f,o,h){let{maxSpeed:g,linearity:v,deceleration:x}=h,S=t.at(f*v/(o/1e3),-g,g),k=Math.abs(S)/(x*v);return{easing:h.easing,duration:1e3*k,amount:S*(k/2)}}class Lr extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g,v={}){let x=ut(h.getCanvasContainer(),g),S=h.unproject(x);super(o,t.W({point:x,lngLat:S,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class Ns extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g){let v=o==="touchend"?g.changedTouches:g.touches,x=It(h.getCanvasContainer(),v),S=x.map(D=>h.unproject(D)),k=x.reduce((D,A,L,z)=>D.add(A.div(z.length)),new t.P(0,0));super(o,{points:x,point:k,lngLats:S,lngLat:h.unproject(k),originalEvent:g}),this._defaultPrevented=!1}}class Bu extends t.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class af{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Bu(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new Lr(o.type,this._map,o))}mouseup(o){this._map.fire(new Lr(o.type,this._map,o))}preclick(o){let h=t.W({},o);h.type="preclick",this._map.fire(new Lr(h.type,this._map,h))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Lr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Lr(o.type,this._map,o))}mouseover(o){this._map.fire(new Lr(o.type,this._map,o))}mouseout(o){this._map.fire(new Lr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Ns(o.type,this._map,o))}touchmove(o){this._map.fire(new Ns(o.type,this._map,o))}touchend(o){this._map.fire(new Ns(o.type,this._map,o))}touchcancel(o){this._map.fire(new Ns(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fh{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Lr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Lr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nu{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(ke(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;let g=h,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=N("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));let S=Math.min(v.x,g.x),k=Math.max(v.x,g.x),D=Math.min(v.y,g.y),A=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${D}px)`,this._box.style.width=k-S+"px",this._box.style.height=A-D+"px")})}mouseupWindow(o,h){if(!this._active)return;let g=this._startPos,v=h;if(g&&o.button===0){if(this.reset(),qe(),g.x!==v.x||g.y!==v.y)return this._map.fire(new t.f("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new t.f(o,{originalEvent:h}))}}function gh(f,o){let h={};for(let g=0;g<f.length;g++)h[f[g].identifier]=o[g];return h}class S_{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){let x=new t.P(0,0);for(let S of v)x._add(S);return x.div(v.length)}(h),this.touches=gh(g,h)))}touchmove(o,h,g){if(this.aborted||!this.centroid)return;let v=gh(g,h);for(let x in this.touches){let S=v[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(o,h,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class _h{constructor(o){this.singleTap=new S_(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,h,g){this.singleTap.touchstart(o,h,g)}touchmove(o,h,g){this.singleTap.touchmove(o,h,g)}touchend(o,h,g){let v=this.singleTap.touchend(o,h,g);if(v){let x=o.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(v)<30;if(x&&S||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Vu{constructor(){this._zoomIn=new _h({numTouches:1,numTaps:2}),this._zoomOut=new _h({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,g){this._zoomIn.touchstart(o,h,g),this._zoomOut.touchstart(o,h,g)}touchmove(o,h,g){this._zoomIn.touchmove(o,h,g),this._zoomOut.touchmove(o,h,g)}touchend(o,h,g){let v=this._zoomIn.touchend(o,h,g),x=this._zoomOut.touchend(o,h,g);return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(v)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let bh={0:1,2:2};class ju{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;let g=wt(o);this._correctButton(o,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(o,h){let g=this._lastPoint;if(g){if(o.preventDefault(),this._eventButton!=null&&function(v,x){let S=bh[x];return v.buttons===void 0||(v.buttons&S)!==S}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(o){this._lastPoint&&wt(o)===this._eventButton&&(this._moved&&qe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class M_ extends ju{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class sf extends ju{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){let g=.8*(h.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class Cl extends ju{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){let g=-.5*(h.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class k_{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),t.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(o,h,g){return this._calculateTransform(o,h,g)}touchmove(o,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!t.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,h,g)}}touchend(o,h,g){this._calculateTransform(o,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,g){g.length>0&&(this._active=!0);let v=gh(g,h),x=new t.P(0,0),S=new t.P(0,0),k=0;for(let A in v){let L=v[A],z=this._touches[A];z&&(x._add(L),S._add(L.sub(z)),k++,v[A]=L)}if(this._touches=v,k<this._minTouches||!S.mag())return;let D=S.div(k);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(k),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class lf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,h,g){return{}}touchstart(o,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,g){let v=this._firstTwoTouches;if(!v)return;o.preventDefault();let[x,S]=v,k=Uu(g,h,x),D=Uu(g,h,S);if(!k||!D)return;let A=this._aroundCenter?null:k.add(D).div(2);return this._move([k,D],A,o)}touchend(o,h,g){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,S=Uu(g,h,v),k=Uu(g,h,x);S&&k||(this._active&&qe(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Uu(f,o,h){for(let g=0;g<f.length;g++)if(f[g].identifier===h)return o[g]}function I_(f,o){return Math.log(f/o)/Math.LN2}class cf extends lf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){let g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(I_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:I_(this._distance,g),pinchAround:h}}}function Hu(f,o){return 180*f.angleWith(o)/Math.PI}class df extends lf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){let g=this._vector;if(this._vector=o[0].sub(o[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Hu(this._vector,g),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;let v=Hu(o,g);return Math.abs(v)<h}}function yh(f){return Math.abs(f.y)>Math.abs(f.x)}class T_ extends lf{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,yh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,g){let v=this._lastPoints;if(!v)return;let x=o[0].sub(v[0]),S=o[1].sub(v[1]);return this._map._cooperativeGestures&&!t.d1()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(x,S,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5})}gestureBeginsVertically(o,h,g){if(this._valid!==void 0)return this._valid;let v=o.mag()>=2,x=h.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;let S=o.y>0==h.y>0;return yh(o)&&yh(h)&&S}}let E_={panStep:100,bearingStep:15,pitchStep:10};class Yy{constructor(){let o=E_;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,g=0,v=0,x=0,S=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),S=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:k=>{let D=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:vh,zoom:h?Math.round(D)+h*(o.shiftKey?2:1):D,bearing:k.getBearing()+g*this._bearingStep,pitch:k.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-S*this._panStep],center:k.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function vh(f){return f*(2-f)}let Lc=4.000244140625,D_=1/450;class Po{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=D_,t.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||t.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,g=t.e.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%Lc==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=ut(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let h=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){let A=this._type==="wheel"&&Math.abs(this._delta)>Lc?this._wheelZoomRate:this._defaultZoomRate,L=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&L!==0&&(L=1/L);let z=h(),U=Math.pow(2,z),H=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(H*L))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,x=this._easing,S,k=!1;if(this._type==="wheel"&&v&&x){let A=Math.min((t.e.now()-this._lastWheelEventTime)/200,1),L=x(A);S=t.a2(v,g,L),A<1?this._frameId||(this._frameId=!0):k=!0}else S=g,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=S-h();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=t.d2;if(this._prevEase){let g=this._prevEase,v=(t.e.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),S=.27/Math.sqrt(x*x+1e-4)*.01,k=Math.sqrt(.0729-S*S);h=t.d0(S,k,.25,1)}return this._prevEase={start:t.e.now(),duration:o,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class hf{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,h){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gu{constructor(){this._tap=new _h({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,h,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,h,g))}touchmove(o,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;let v=h[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,h,g)}touchend(o,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(o,h,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uf{constructor(o,h,g){this._el=o,this._mousePan=h,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class mf{constructor(o,h,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qu{constructor(o,h,g,v){this._el=o,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Fc=f=>f.zoom||f.drag||f.pitch||f.rotate;class pf extends t.f{}class $u{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,h){let g=t._.sub([],h,o);this.radius=t._.length(g[2]<0?t._.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){t._.div(o,o,this.constants),t._.normalize(o,o),t._.mul(o,o,this.constants);let h=t._.scale([],o,this.radius);if(h[2]>0){let g=t._.scale([],[0,0,1],t._.dot(h,[0,0,1])),v=t._.scale([],t._.normalize([],[h[0],h[1],0]),this.radius),x=t._.add([],h,t._.scale([],t._.sub([],t._.add([],v,g),h),2));h[0]=x[0],h[1]=x[1]}return h}}function xh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class A_{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wl(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new $u,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),t.bp(["handleEvent","handleWindowEvent"],this);let g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,S]of this._listeners){let k=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,k,S)}}destroy(){for(let[o,h,g]of this._listeners){let v=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(h,v,g)}}_addDefaultHandlers(o){let h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new af(h,o));let v=h.boxZoom=new Nu(h,o);this._add("boxZoom",v);let x=new Vu,S=new Wu;h.doubleClickZoom=new hf(S,x),this._add("tapZoom",x),this._add("clickZoom",S);let k=new Gu;this._add("tapDragZoom",k);let D=h.touchPitch=new T_(h);this._add("touchPitch",D);let A=new sf(o),L=new Cl(o);h.dragRotate=new mf(o,A,L),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);let z=new M_(o),U=new k_(h,o);h.dragPan=new uf(g,z,U),this._add("mousePan",z),this._add("touchPan",U,["touchZoom","touchRotate"]);let H=new df,Y=new cf;h.touchZoomRotate=new qu(g,Y,H,k),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new fh(h));let Z=h.scrollZoom=new Po(h,this);this._add("scrollZoom",Z,["mousePan"]);let X=h.keyboard=new Yy;this._add("keyboard",X);for(let Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[Q]&&h[Q].enable(o[Q])}_add(o,h,g){this._handlers.push({handlerName:o,handler:h,allowed:g}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,h,g){for(let v in o)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){let h=[];for(let g of o)this._el.contains(g.target)&&h.push(g);return h}handleEvent(o,h){this._updatingCamera=!0;let g=o.type==="renderFrame",v=g?void 0:o,x={needsRenderFrame:!1},S={},k={},D=o.touches?this._getMapTouches(o.touches):void 0,A=D?It(this._el,D):g?void 0:ut(this._el,o);for(let{handlerName:U,handler:H,allowed:Y}of this._handlers){if(!H.isEnabled())continue;let Z;this._blockedByActive(k,Y,U)?H.reset():H[h||o.type]&&(Z=H[h||o.type](o,A,D),this.mergeHandlerResult(x,S,Z,U,v),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||H.isActive())&&(k[U]=H)}let L={};for(let U in this._previousActiveHandlers)k[U]||(L[U]=v);this._previousActiveHandlers=k,(Object.keys(L).length||xh(x))&&(this._changes.push([x,S,L]),this._triggerRenderFrame()),(Object.keys(k).length||xh(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:z}=x;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(o,h,g,v,x){if(!g)return;t.W(o,g);let S={handlerName:v,originalEvent:g.originalEvent||x};g.zoomDelta!==void 0&&(h.zoom=S),g.panDelta!==void 0&&(h.drag=S),g.pitchDelta!==void 0&&(h.pitch=S),g.bearingDelta!==void 0&&(h.rotate=S)}_applyChanges(){let o={},h={},g={};for(let[v,x,S]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new t.P(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(o.around=v.around),v.aroundCoord!==void 0&&(o.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),t.W(h,x),t.W(g,S);this._updateMapTransform(o,h,g),this._changes=[]}_updateMapTransform(o,h,g){let v=this._map,x=v.transform,S=re=>[re.x,re.y,re.z];if((re=>{let oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!xh(o)){let re=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),re!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!xh(o))return void this._fireEvents(h,g,!0);let{panDelta:k,zoomDelta:D,bearingDelta:A,pitchDelta:L,around:z,aroundCoord:U,pinchAround:H}=o;x._isCameraConstrained&&(D>0&&(D=0),x._isCameraConstrained=!1),H!==void 0&&(z=H),(D||(re=>h[re]&&!this._eventsInProgress[re])("drag"))&&z&&(this._dragOrigin=S(x.pointCoordinate3D(z)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),z=z||v.transform.centerPoint,A&&(x.bearing+=A),L&&(x.pitch+=L),x._updateCameraState();let Y=[0,0,0];if(k)if(x.projection.name==="mercator"){let re=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z).dir),oe=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z.sub(k)).dir);Y[0]=oe[0]-re[0],Y[1]=oe[1]-re[1]}else{let re=x.pointCoordinate(z);if(x.projection.name==="globe"){k=k.rotate(-x.angle);let oe=x._pixelsPerMercatorPixel/x.worldSize;Y[0]=-k.x*t.d3(t.ay(re.y))*oe,Y[1]=-k.y*t.d3(x.center.lat)*oe}else{let oe=x.pointCoordinate(z.sub(k));re&&oe&&(Y[0]=oe.x-re.x,Y[1]=oe.y-re.y)}}let Z=x.zoom,X=[0,0,0];if(D){let re=S(U||x.pointCoordinate3D(z)),oe={dir:t._.normalize([],t._.sub([],re,x._camera.position))};if(oe.dir[2]<0){let ae=x.zoomDeltaToMovement(re,D);t._.scale(X,oe.dir,ae)}}let Q=t._.add(Y,Y,X);x._translateCameraConstrained(Q),D&&Math.abs(x.zoom-Z)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,g,!0)}_fireEvents(o,h,g){let v=Fc(this._eventsInProgress),x=Fc(o),S={};for(let L in o){let{originalEvent:z}=o[L];this._eventsInProgress[L]||(S[`${L}start`]=z),this._eventsInProgress[L]=o[L]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let L in S)this._fireEvent(L,S[L]);x&&this._fireEvent("move",x.originalEvent);for(let L in o){let{originalEvent:z}=o[L];this._fireEvent(L,z)}let k={},D;for(let L in this._eventsInProgress){let{handlerName:z,originalEvent:U}=this._eventsInProgress[L];this._handlersById[z].isActive()||(delete this._eventsInProgress[L],D=h[z]||U,k[`${L}end`]=D)}for(let L in k)this._fireEvent(L,k[L]);let A=Fc(this._eventsInProgress);if(g&&(v||x)&&!A){this._updatingCamera=!0;let L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;L?(z(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:D})):(this._map.fire(new t.f("moveend",{originalEvent:D})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new t.f(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new pf("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Sl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Zy extends t.E{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,t.bp(["_renderFrameCallback"],this)}getCenter(){return new t.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,g){return o=t.P.convert(o).mult(-1),this.panTo(this.transform.center,t.W({offset:o},h),g)}panTo(o,h,g){return this.easeTo(t.W({center:o},h),g)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,g){return this.easeTo(t.W({zoom:o},h),g)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,g){return this.easeTo(t.W({bearing:o},h),g)}resetNorth(o,h){return this.rotateTo(0,t.W({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(t.W({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=t.ai.convert(o);let g=h&&h.bearing||0,v=h&&h.pitch||0,x=o.getNorthWest(),S=o.getSouthEast();return this._cameraForBounds(this.transform,x,S,g,v,h)}_extendPadding(o){let h={top:0,right:0,bottom:0,left:0};return o==null?t.W({},h,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:t.W({},h,o)}_extendCameraOptions(o){return(o=t.W({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,h){let g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>o.aspect?g/(2*Math.tan(.5*o.fovX)*o.aspect):v/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,h,g,v,x,S){let k=o.clone(),D=this._extendCameraOptions(S);k.bearing=v,k.pitch=x;let A=t.aI.convert(h),L=t.aI.convert(g),z=.5*(A.lat+L.lat),U=.5*(A.lng+L.lng),H=t.d4(z,U),Y=t._.normalize([],H),Z=t._.normalize([],t._.cross([],Y,[0,1,0])),X=t._.cross([],Z,Y),Q=[Z[0],Z[1],Z[2],0,X[0],X[1],X[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],re=[H,t.d4(A.lat,A.lng),t.d4(L.lat,A.lng),t.d4(L.lat,L.lng),t.d4(A.lat,L.lng),t.d4(z,A.lng),t.d4(z,L.lng),t.d4(A.lat,U),t.d4(L.lat,U)],oe=t.b6.fromPoints(re.map(Ye=>[t._.dot(Z,Ye),t._.dot(X,Ye),t._.dot(Y,Ye)])),ae=t._.transformMat4([],oe.center,Q);t._.squaredLength(ae)===0&&t._.set(ae,0,0,1),t._.normalize(ae,ae),t._.scale(ae,ae,t.cD),k.center=t.d5(ae);let _e=k.getWorldToCameraMatrix(),ge=t.ad.invert(new Float64Array(16),_e);oe=t.b6.applyTransform(oe,t.ad.multiply([],_e,Q));let ne=this._extendAABB(oe,k,D,v);if(!ne)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=ne,t._.transformMat4(ae,ae,_e);let se=.5*(oe.max[2]-oe.min[2]),le=this._minimumAABBFrustumDistance(k,oe),we=t._.scale([],[0,0,1],se),Re=t._.add(we,ae,we),me=le+(k.pitch===0?0:t._.distance(ae,Re)),Le=k.globeCenterInViewSpace,Be=t._.sub([],ae,[Le[0],Le[1],Le[2]]);t._.normalize(Be,Be),t._.scale(Be,Be,me);let Qe=t._.add([],ae,Be);t._.transformMat4(Qe,Qe,ge);let Je=t.d7/t.cD,Ze=t._.length(Qe),Te=t.ax(Math.max(Ze*Je-t.d7,Number.EPSILON),0),Ve=Math.min(k.zoomFromMercatorZAdjusted(Te),D.maxZoom);return Ve>.5*(t.b1+t.aU)?(k.setProjection({name:"mercator"}),k.zoom=Ve,this._cameraForBounds(k,h,g,v,x,S)):{center:k.center,zoom:Ve,bearing:v,pitch:x}}_extendAABB(o,h,g,v){let x=.5*((g.padding.left||0)+(g.padding.right||0)),S=.5*((g.padding.top||0)+(g.padding.bottom||0)),k=S,D=x,A=x,L=S,z=h.width-(D+A),U=h.height-(k+L),H=t._.sub([],o.max,o.min),Y=Math.min(z/H[0],U/H[1]),Z=Math.min(h.scaleZoom(h.scale*Y),g.maxZoom);if(isNaN(Z))return null;let X=h.scale/h.zoomScale(Z),Q=new t.b6([o.min[0]-D*X,o.min[1]-L*X,o.min[2]],[o.max[0]+A*X,o.max[1]+k*X,o.max[2]]),re=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new t.P(g.offset.x,g.offset.y):t.P.convert(g.offset)).rotate(-t.ab(v));return Q.center[0]-=re.x*X,Q.center[1]+=re.y*X,Q}queryTerrainElevation(o,h){let g=this.transform.elevation;return g?(h=t.W({},{exaggerated:!0},h),g.getAtPoint(t.Y.fromLngLat(o),null,h.exaggerated)):null}_cameraForBounds(o,h,g,v,x,S){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,h,g,v,x,S);let k=o.clone(),D=this._extendCameraOptions(S);k.bearing=v,k.pitch=x;let A=t.aI.convert(h),L=t.aI.convert(g),z=new t.aI(A.lng,L.lat),U=new t.aI(L.lng,A.lat),H=k.project(A),Y=k.project(L),Z=this.queryTerrainElevation(A),X=this.queryTerrainElevation(L),Q=this.queryTerrainElevation(z),re=this.queryTerrainElevation(U),oe=[[H.x,H.y,Math.min(Z||0,X||0,Q||0,re||0)],[Y.x,Y.y,Math.max(Z||0,X||0,Q||0,re||0)]],ae=t.b6.fromPoints(oe),_e=k.getWorldToCameraMatrix(),ge=t.ad.invert(new Float64Array(16),_e);ae=t.b6.applyTransform(ae,_e);let ne=this._extendAABB(ae,k,D,v);if(!ne)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=ne;let se=.5*t._.sub([],ae.max,ae.min)[2],le=this._minimumAABBFrustumDistance(k,ae),we=[0,0,1,0];t.aA.transformMat4(we,we,_e),t.aA.normalize(we,we);let Re=t._.scale([],we,le+se),me=t._.add([],ae.center,Re);t._.transformMat4(ae.center,ae.center,ge),t._.transformMat4(me,me,ge);let Le=[ae.center[0],ae.center[1],me[2]*k.pixelsPerMeter];t._.scale(Le,Le,1/k.worldSize);let Be=t.d6(Le[0]),Qe=t.ay(Le[1]),Je=Math.min(k._zoomFromMercatorZ(Le[2]),D.maxZoom),Ze=new t.aI(Be,Qe);return k.mercatorFromTransition&&Je<.5*(t.b1+t.aU)?(k.setProjection({name:"globe"}),k.zoom=Je,this._cameraForBounds(k,h,g,v,x,S)):{center:Ze,zoom:Je,bearing:v,pitch:x}}fitBounds(o,h,g){let v=this.cameraForBounds(o,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(o,h,g,v,x){let S=t.P.convert(o),k=t.P.convert(h),D=new t.P(Math.min(S.x,k.x),Math.min(S.y,k.y)),A=new t.P(Math.max(S.x,k.x),Math.max(S.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,k))return this;let L=this.transform.pointLocation3D(D),z=this.transform.pointLocation3D(A),U=this.transform.pointLocation3D(new t.P(D.x,A.y)),H=this.transform.pointLocation3D(new t.P(A.x,D.y)),Y=[Math.min(L.lng,z.lng,U.lng,H.lng),Math.min(L.lat,z.lat,U.lat,H.lat)],Z=[Math.max(L.lng,z.lng,U.lng,H.lng),Math.max(L.lat,z.lat,U.lat,H.lat)],X=v&&v.pitch?v.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,Y,Z,g,X,v);return this._fitInternal(Q,v,x)}_fitInternal(o,h,g){return o?(h=t.W(o,h)).linear?this.easeTo(h,g):this.flyTo(h,g):this}jumpTo(o,h){this.stop();let g=o.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,S=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(v=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=t.aI.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(x=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(S=!0,g.pitch=+o.pitch),o.padding==null||g.isPaddingEqual(o.padding)||(g.padding=o.padding),o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new t.f("movestart",h)).fire(new t.f("move",h)),v&&this.fire(new t.f("zoomstart",h)).fire(new t.f("zoom",h)).fire(new t.f("zoomend",h)),x&&this.fire(new t.f("rotatestart",h)).fire(new t.f("rotate",h)).fire(new t.f("rotateend",h)),S&&this.fire(new t.f("pitchstart",h)).fire(new t.f("pitch",h)).fire(new t.f("pitchend",h)),this.fire(new t.f("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(Sl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,h){let g=this.transform;if(!g.projection.supportsFreeCamera)return t.w(Sl),this;this.stop();let v=g.zoom,x=g.pitch,S=g.bearing;g.setFreeCameraOptions(o);let k=v!==g.zoom,D=x!==g.pitch,A=S!==g.bearing;return this.fire(new t.f("movestart",h)).fire(new t.f("move",h)),k&&this.fire(new t.f("zoomstart",h)).fire(new t.f("zoom",h)).fire(new t.f("zoomend",h)),A&&this.fire(new t.f("rotatestart",h)).fire(new t.f("rotate",h)).fire(new t.f("rotateend",h)),D&&this.fire(new t.f("pitchstart",h)).fire(new t.f("pitch",h)).fire(new t.f("pitchend",h)),this.fire(new t.f("moveend",h)),this}easeTo(o,h){this._stop(!1,o.easeId),((o=t.W({offset:[0,0],duration:500,easing:t.d2},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);let g=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in o?+o.zoom:v,A="bearing"in o?this._normalizeBearing(o.bearing,x):x,L="pitch"in o?+o.pitch:S,z=this._extendPadding(o.padding),U=t.P.convert(o.offset),H,Y,Z;if(g.projection.name==="globe"){let le=t.Y.fromLngLat(g.center),we=U.rotate(-g.angle);le.x+=we.x/g.worldSize,le.y+=we.y/g.worldSize;let Re=le.toLngLat(),me=t.aI.convert(o.center||Re);this._normalizeCenter(me),H=g.centerPoint.add(we),Y=new t.P(le.x,le.y).mult(g.worldSize),Z=new t.P(t.aj(me.lng),t.ak(me.lat)).mult(g.worldSize).sub(Y)}else{H=g.centerPoint.add(U);let le=g.pointLocation(H),we=t.aI.convert(o.center||le);this._normalizeCenter(we),Y=g.project(le),Z=g.project(we).sub(Y)}let X=g.zoomScale(D-v),Q,re;o.around&&(Q=t.aI.convert(o.around),re=g.locationPoint(Q));let oe=this._zooming||D!==v,ae=this._rotating||x!==A,_e=this._pitching||L!==S,ge=!g.isPaddingEqual(z),ne=le=>we=>{if(oe&&(le.zoom=t.a2(v,D,we)),ae&&(le.bearing=t.a2(x,A,we)),_e&&(le.pitch=t.a2(S,L,we)),ge&&(le.interpolatePadding(k,z,we),H=le.centerPoint.add(U)),Q)le.setLocationAtPoint(Q,re);else{let Re=le.zoomScale(le.zoom-v),me=D>v?Math.min(2,X):Math.max(.5,X),Le=Math.pow(me,1-we),Be=le.unproject(Y.add(Z.mult(we*Le)).mult(Re));le.setLocationAtPoint(le.renderWorldCopies?Be.wrap():Be,H)}return o.preloadOnly||this._fireMoveEvents(h),le};if(o.preloadOnly){let le=this._emulate(ne,o.duration,g);return this._preloadTiles(le),this}let se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ae,this._pitching=_e,this._padding=ge,this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,se),this._ease(ne(g),le=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(h,le)},o),this}_prepareEase(o,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||g.moving||this.fire(new t.f("movestart",o)),this._zooming&&!g.zooming&&this.fire(new t.f("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new t.f("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new t.f("pitchstart",o))}_fireMoveEvents(o){this.fire(new t.f("move",o)),this._zooming&&this.fire(new t.f("zoom",o)),this._rotating&&this.fire(new t.f("rotate",o)),this._pitching&&this.fire(new t.f("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new t.f("zoomend",o)),v&&this.fire(new t.f("rotateend",o)),x&&this.fire(new t.f("pitchend",o)),this.fire(new t.f("moveend",o))}flyTo(o,h){if(this._prefersReducedMotion(o)){let Ve=t.ah(o,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ve,h)}this.stop(),o=t.W({offset:[0,0],speed:1.2,curve:1.42,easing:t.d2},o);let g=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in o?t.at(+o.zoom,g.minZoom,g.maxZoom):v,A="bearing"in o?this._normalizeBearing(o.bearing,x):x,L="pitch"in o?+o.pitch:S,z=this._extendPadding(o.padding),U=g.zoomScale(D-v),H=t.P.convert(o.offset),Y=g.centerPoint.add(H),Z=g.pointLocation(Y),X=t.aI.convert(o.center||Z);this._normalizeCenter(X);let Q=g.project(Z),re=g.project(X).sub(Q),oe=o.curve,ae=Math.max(g.width,g.height),_e=ae/U,ge=re.mag();if("minZoom"in o){let Ve=t.at(Math.min(o.minZoom,v,D),g.minZoom,g.maxZoom),Ye=ae/g.zoomScale(Ve-v);oe=Math.sqrt(Ye/ge*2)}let ne=oe*oe;function se(Ve){let Ye=(_e*_e-ae*ae+(Ve?-1:1)*ne*ne*ge*ge)/(2*(Ve?_e:ae)*ne*ge);return Math.log(Math.sqrt(Ye*Ye+1)-Ye)}function le(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function we(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}let Re=se(0),me=function(Ve){return we(Re)/we(Re+oe*Ve)},Le=function(Ve){return ae*((we(Re)*(le(Ye=Re+oe*Ve)/we(Ye))-le(Re))/ne)/ge;var Ye},Be=(se(1)-Re)/oe;if(Math.abs(ge)<1e-6||!isFinite(Be)){if(Math.abs(ae-_e)<1e-6)return this.easeTo(o,h);let Ve=_e<ae?-1:1;Be=Math.abs(Math.log(_e/ae))/oe,Le=function(){return 0},me=function(Ye){return Math.exp(Ve*oe*Ye)}}o.duration="duration"in o?+o.duration:1e3*Be/("screenSpeed"in o?+o.screenSpeed/oe:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);let Qe=x!==A,Je=L!==S,Ze=!g.isPaddingEqual(z),Te=Ve=>Ye=>{let bt=Ye*Be,yt=1/me(bt);Ve.zoom=Ye===1?D:v+Ve.scaleZoom(yt),Qe&&(Ve.bearing=t.a2(x,A,Ye)),Je&&(Ve.pitch=t.a2(S,L,Ye)),Ze&&(Ve.interpolatePadding(k,z,Ye),Y=Ve.centerPoint.add(H));let kt=Ye===1?X:Ve.unproject(Q.add(re.mult(Le(bt))).mult(yt));return Ve.setLocationAtPoint(Ve.renderWorldCopies?kt.wrap():kt,Y),Ve._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(h),Ve};if(o.preloadOnly){let Ve=this._emulate(Te,o.duration,g);return this._preloadTiles(Ve),this}return this._zooming=!0,this._rotating=Qe,this._pitching=Je,this._padding=Ze,this._prepareEase(h,!1),this._ease(Te(g),()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!o){let g=this.handlers;g&&g.stop(!1)}return this}_ease(o,h,g){g.animate===!1||g.duration===0?(o(1),h()):(this._easeStart=t.e.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let o=Math.min((t.e.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=t.au(o,-180,180);let g=Math.abs(o-h);return Math.abs(o-360-h)<g&&(o-=360),Math.abs(o+360-h)<g&&(o+=360),o}_normalizeCenter(o){let h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;let g=o.lng-h.center.lng;o.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&t.e.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,h,g){let v=Math.ceil(15*h/1e3),x=[],S=o(g.clone());for(let k=0;k<=v;k++){let D=S(k/v);x.push(D.clone())}return x}_preloadTiles(o,h){}}class P_{constructor(o={}){this.options=o,t.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){let h=this.options&&this.options.compact;return this._map=o,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=N("button","mapboxgl-ctrl-attrib-button",this._container),N("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,h){let g=this._map._getUIString(`AttributionControl.${h}`);o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.d8.ACCESS_TOKEN}];if(o){let g=h.reduce((v,x,S)=>(x.value&&(v+=`${x.key}=${x.value}${S<h.length-1?"&":""}`),v),"?");o.href=`${t.d8.FEEDBACK_URL}/${g}#${mh(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let h=this._map.style._mergedSourceCaches;for(let v in h){let x=h[v];if(x.used){let S=x.getSource();S.attribution&&o.indexOf(S.attribution)<0&&o.push(S.attribution)}}o.sort((v,x)=>v.length-x.length),o=o.filter((v,x)=>{for(let S=x+1;S<o.length;S++)if(o[S].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));let g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class O_{constructor(){t.bp(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=N("div","mapboxgl-ctrl");let h=N("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(let h in o){let g=o[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){let o=this._container.children;if(o.length){let h=o[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class R_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){let h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(let v of g)if(v.id===o)return void(v.cancelled=!0)}run(o=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let g of h)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function L_(f,o,h){if(f=new t.aI(f.lng,f.lat),o){let g=new t.aI(f.lng-360,f.lat),v=new t.aI(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-h.center.lng)/360),S=h.locationPoint(f).distSqr(o),k=o.x<0||o.y<0||o.x>h.width||o.y>h.height;h.locationPoint(g).distSqr(o)<S&&(k||Math.abs(g.lng-h.center.lng)<x)?f=g:h.locationPoint(v).distSqr(o)<S&&(k||Math.abs(v.lng-h.center.lng)<x)&&(f=v)}for(;Math.abs(f.lng-h.center.lng)>180;){let g=h.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}let ff={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class wh extends t.E{constructor(o,h){if(super(),(o instanceof HTMLElement||h)&&(o=t.W({element:o},h)),t.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=t.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=N("div");let x=41,S=27,k=q("svg",{display:"block",height:x*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${x}`},this._element),D=q("radialGradient",{id:"shadowGradient"},q("defs",{},k));q("stop",{offset:"10%","stop-opacity":.4},D),q("stop",{offset:"100%","stop-opacity":.05},D),q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=t.P.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let g=this._element.classList;for(let x in ff)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=o&&o.className?o.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){let o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=t.aI.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){let h=o.code,g=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(o){let h=o.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let o=this._map,h=this._pos;if(!o||!h)return!1;let g=o.unproject(h),v=o.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(g)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let o=this._map;if(!o)return;let h=this._pos;if(!h||h.x<0||h.x>o.transform.width||h.y<0||h.y>o.transform.height)return void this._clearFadeTimer();let g=o.unproject(h),v;o._showingGlobe()&&t.d9(o.transform,this._lngLat)?v=0:(v=1-o._queryFogOpacity(g),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let o=this._pos;if(!o||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${ff[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let o=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!o||g!=="map")return"";if(!h._showingGlobe()){let D=h.getPitch();return D?`rotateX(${D}deg)`:""}let v=t.b0(t.da(h.transform,this._lngLat)),x=o.sub(t.db(h.transform)),S=Math.abs(x.x)+Math.abs(x.y);if(S===0)return"";let k=v/S;return`rotateX(${-x.y*k}deg) rotateY(${x.x*k}deg)`}_calculateZTransform(){let o=this._pos,h=this._map;if(!h||!o)return"";let g=0,v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){let x=h.project(new t.aI(this._lngLat.lng,this._lngLat.lat+.001)),S=h.project(new t.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);g=t.b0(Math.atan2(S.y,S.x))-90}else g=-h.getBearing();else if(v==="horizon"){let x=t.$(4,6,h.getZoom()),S=t.db(h.transform);S.y+=x*h.transform.height;let k=o.sub(S),D=t.b0(Math.atan2(k.y,k.x));g=(D>90?D-270:D+90)*(1-x)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=L_(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=t.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){let h=this._map;if(!h)return;let g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){let x=this._clickTolerance||h._clickTolerance;if(o.point.dist(g)<x)return;this._isDragging=!0}this._pos=o.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.f("dragstart"))),this.fire(new t.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.f("dragend")),this._state="inactive"}_addDragHandler(o){let h=this._map,g=this._pos;h&&g&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(g),this._pointerdownPos=o.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;let h=this._map;return h&&(o?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let gf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},F_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ml(f=new t.P(0,0),o="bottom"){if(typeof f=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(o){case"top":return new t.P(0,f);case"top-left":return new t.P(h,h);case"top-right":return new t.P(-h,h);case"bottom":return new t.P(0,-f);case"bottom-left":return new t.P(h,-h);case"bottom-right":return new t.P(-h,-h);case"left":return new t.P(f,0);case"right":return new t.P(-f,0)}return new t.P(0,0)}return f instanceof t.P||Array.isArray(f)?t.P.convert(f):t.P.convert(f[o]||[0,0])}class z_{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;let h=t.b9((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,h,g){this._start=this.getValue(h),this._end=o,this._startTime=h,this._endTime=h+g}}let B_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class N_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let _f={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},kl={showCompass:!0,showZoom:!0,visualizePitch:!1};class V_{constructor(o,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new sf({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new Cl({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),t.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),ke()}move(o,h){let g=this.map,v=this.mouseRotate.mousemoveWindow(o,h),x=v&&v.bearingDelta;if(x&&g.setBearing(g.getBearing()+x),this.mousePitch){let S=this.mousePitch.mousemoveWindow(o,h),k=S&&S.pitchDelta;k&&g.setPitch(g.getPitch()+k)}}off(){let o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(t.W({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ut(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ut(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=It(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=It(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Il={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},j_={maxWidth:100,unit:"metric"},Yu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:t.dt,supported:C,setRTLTextPlugin:t.dv,getRTLTextPluginStatus:t.dw,Map:class extends Zy{constructor(f){t.dc.mark(t.dd.create);let o=f;if((f=t.W({},_f,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&t.de(window)&&(f.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Aa(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new R_,this._domRenderTaskQueue=new R_,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.df(),this._locale=t.W({},B_,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new z_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new t.dg(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Ji({},f.contextCreateOptions):{},typeof f.container=="string"){let h=document.getElementById(f.container);if(!h)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=h}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),t.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new N_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new A_(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||t.d8.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new $y(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});let h=f.bounds;h&&(this.resize(),this.fitBounds(h,t.W({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new P_({customAttribution:f.customAttribution})),this._logoControl=new O_,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new t.f(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new t.f(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(f,o){if(o===void 0&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new t.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=f.onAdd(this);this._controls.push(f);let g=this._controlPositions[o];return o.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new t.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let o=!this._moving;return o&&this.fire(new t.f("movestart",f)).fire(new t.f("move",f)),this.fire(new t.f("resize",f)),o&&this.fire(new t.f("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(t.ai.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new t.f("zoomstart")).fire(new t.f("zoom")).fire(new t.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new t.f("pitchstart")).fire(new t.f("pitch")).fire(new t.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(o=>o==="auto"?navigator.language:o):f}setLanguage(f){let o=this._parseLanguage(f);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(let h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,o=f.projection.name,h;o==="globe"&&f.zoom>=t.aU?(f.setMercatorFromTransition(),h=!0):o==="mercator"&&f.zoom<t.aU&&(f.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,o){return this._updateProjection(f||o||{name:"mercator"})}_updateProjection(f){let o;return o=f.name==="globe"&&this.transform.zoom>=t.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(t.aI.convert(f))}unproject(f){return this.transform.pointLocation3D(t.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,o,h){if(f==="mouseenter"||f==="mouseover"){let g=!1,v=S=>{let k=o.filter(A=>this.getLayer(A)),D=k.length?this.queryRenderedFeatures(S.point,{layers:k}):[];D.length?g||(g=!0,h.call(this,new Lr(f,this,S.originalEvent,{features:D}))):g=!1},x=()=>{g=!1};return{layers:new Set(o),listener:h,delegates:{mousemove:v,mouseout:x}}}if(f==="mouseleave"||f==="mouseout"){let g=!1,v=S=>{let k=o.filter(D=>this.getLayer(D));(k.length?this.queryRenderedFeatures(S.point,{layers:k}):[]).length?g=!0:g&&(g=!1,h.call(this,new Lr(f,this,S.originalEvent)))},x=S=>{g&&(g=!1,h.call(this,new Lr(f,this,S.originalEvent)))};return{layers:new Set(o),listener:h,delegates:{mousemove:v,mouseout:x}}}{let g=v=>{let x=o.filter(k=>this.getLayer(k)),S=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];S.length&&(v.features=S,h.call(this,v),delete v.features)};return{layers:new Set(o),listener:h,delegates:{[f]:g}}}}on(f,o,h){if(typeof o=="function"||h===void 0)return super.on(f,o);if(Array.isArray(o)||(o=[o]),o){for(let v of o)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(f,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(let v in g.delegates)this.on(v,g.delegates[v]);return this}once(f,o,h){if(typeof o=="function"||h===void 0)return super.once(f,o);if(Array.isArray(o)||(o=[o]),o){for(let v of o)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(f,o,h);for(let v in g.delegates)this.once(v,g.delegates[v]);return this}off(f,o,h){if(typeof o=="function"||h===void 0)return super.off(f,o);let g=new Set(Array.isArray(o)?o:[o]);for(let S of g)if(!this._isValidId(S))return this;let v=(S,k)=>{if(S.size!==k.size)return!1;for(let D of S)if(!k.has(D))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[f]:void 0;return x&&(S=>{for(let k=0;k<S.length;k++){let D=S[k];if(D.listener===h&&v(D.layers,g)){for(let A in D.delegates)this.off(A,D.delegates[A]);return S.splice(k,1),this}}})(x),this}queryRenderedFeatures(f,o){if(!this.style)return[];if(o!==void 0||f===void 0||f instanceof t.P||Array.isArray(f)||(o=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(o=o||{}).layers&&Array.isArray(o.layers)){for(let h of o.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(f,o,this.transform)}querySourceFeatures(f,o){return this._isValidId(f)?this.style.querySourceFeatures(f,o):[]}isPointOnSurface(f){let{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&t.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(f))}setStyle(f,o){return o=t.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&f&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(f,(h,g)=>{h?(t.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(f,o)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(f,o))}_getUIString(f){let o=this._locale[f];if(o==null)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){let h=t.W({},o);o&&o.config&&(h.initialConfig=o.config,delete h.config),this.style=new pa(this,h).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new pa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new t.d(new Error("IDs can't be empty."))),!1):!t.cV(f)||(this.fire(new t.d(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,o){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,o,h){this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,h)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,o,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:x,content:S}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){let{width:k,height:D,data:A}=t.e.getImageData(o);this.style.addImage(f,{data:new t.i({width:k,height:D},A),pixelRatio:h,stretchX:v,stretchY:x,content:S,sdf:g,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new t.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:k,height:D}=o,A=o;this.style.addImage(f,{data:new t.i({width:k,height:D},new Uint8Array(A.data)),pixelRatio:h,stretchX:v,stretchY:x,content:S,sdf:g,version:0,userImage:A}),A.onAdd&&A.onAdd(this,f)}}updateImage(f,o){this._lazyInitEmptyStyle();let h=this.style.getImage(f);if(!h)return void this.fire(new t.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?t.e.getImageData(o):o,{width:v,height:x,data:S}=g;if(v===void 0||x===void 0)return void this.fire(new t.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||x!==h.data.height)return void this.fire(new t.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));let k=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);h.data.replace(S,k),this.style.updateImage(f,h)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new t.d(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,o){t.h(this._requestManager.transformRequest(f,t.R.Image),(h,g)=>{o(h,g instanceof HTMLImageElement?t.e.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(f,o){this._lazyInitEmptyStyle(),this.style.addModel(f,o)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new t.d(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,o){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)):this}getSlot(f){let o=this.getLayer(f);return o&&o.slot||null}setSlot(f,o){return this.style.setSlot(f,o),this.style.mergeLayers(),this._update(!0)}addImport(f,o){return this.style.addImport(f,o),this}updateImport(f,o){return typeof o!="string"&&o.id!==f?(this.removeImport(f),this.addImport(o)):(this.style.updateImport(f,o),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,o){return this.style.moveImport(f,o),this._update(!0)}moveLayer(f,o){return this._isValidId(f)?(this.style.moveLayer(f,o),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){return this._isValidId(f)?this.style.getOwnLayer(f):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,o,h){return this._isValidId(f)?(this.style.setLayerZoomRange(f,o,h),this._update(!0)):this}setFilter(f,o,h={}){return this._isValidId(f)?(this.style.setFilter(f,o,h),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,o,h,g={}){return this._isValidId(f)?(this.style.setPaintProperty(f,o,h,g),this._update(!0)):this}getPaintProperty(f,o){return this._isValidId(f)?this.style.getPaintProperty(f,o):null}setLayoutProperty(f,o,h,g={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,o,h,g),this._update(!0)):this}getLayoutProperty(f,o){return this._isValidId(f)?this.style.getLayoutProperty(f,o):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,o){return this.style.setSchema(f,o),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,o){return this.style.setConfig(f,o),this._update(!0)}getConfigProperty(f,o){return this.style.getConfigProperty(f,o)}setConfigProperty(f,o,h){return this.style.setConfigProperty(f,o,h),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){let o=f[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.aI.convert(f),this.transform):0}setFeatureState(f,o){return this._isValidId(f.source)?(this.style.setFeatureState(f,o),this._update()):this}removeFeatureState(f,o){return this._isValidId(f.source)?(this.style.removeFeatureState(f,o),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300,h,g,v,x=this._container;for(;x&&(!g||!v);){let S=window.getComputedStyle(x).transform;S&&S!=="none"&&(h=S.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),x=x.parentElement}this._containerWidth=g?Math.abs(f/g):f,this._containerHeight=v?Math.abs(o/v):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=N("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let o=this._canvasContainer=N("div","mapboxgl-canvas-container",f);this._canvas=N("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=N("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=N("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,o){let h=t.e.devicePixelRatio||1;this._canvas.width=h*Math.ceil(f),this._canvas.height=h*Math.ceil(o),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let o=this._markers.indexOf(f);o!==-1&&this._markers.splice(o,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){let o=this._popups.indexOf(f);o!==-1&&this._popups.splice(o,1)}_setupPainter(){let f=t.W({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",f);o?(t.dh(o,!0),this.painter=new m_(o,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),t.di.testSupport(o)):this.fire(new t.d(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.f("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new t.f("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let o;this.fire(new t.f("renderstart")),++this._frameId;let h=this.painter.context.extTimerQuery,g=t.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=v.createQuery(),v.beginQuery(h.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let A=this.transform.zoom,L=this.transform.pitch,z=t.e.now(),U=new t.X(A,{now:z,fadeDuration:x,pitch:L,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(g);let k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(k&&(this._placementDirty=k.needsRerender,this._occlusionOpacityChanged=k.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.dc.mark(t.dd.load),this.fire(new t.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){let A=t.e.now()-g;v.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{let L=v.getQueryParameter(o,v.QUERY_RESULT)/1e6;v.deleteQuery(o),this.fire(new t.f("gpu-timing-frame",{cpuTime:A,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){let A=this.painter.collectGpuTimers();setTimeout(()=>{let L=this.painter.queryGpuTimers(A);this.fire(new t.f("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){let A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let L=this.painter.queryGpuTimeDeferredRender(A);this.fire(new t.f("gpu-timing-deferred-render",{gpuTime:L}))},50)}let D=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||S;if((this._sourcesDirty||this._styleDirty||S||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),D||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let A=!this.isMoving()&&this.loaded();if(A&&(S=this._updateAverageElevation(g,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new t.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let L=this._calculateSpeedIndex();this.fire(new t.f("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!D&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,t.dc.mark(t.dd.fullLoad),this._performanceMetricsCollection&&t.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(let o of this._markers)f&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(let o of this._popups)!f||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(f,o=!1){let h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);let g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(o||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;let S=Math.abs(v-x);if(S>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,f,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(f)&&h(this._averageElevation.getValue(f))}_authenticate(){t.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===t.dl||f.status===401)){let o=this.painter.context.gl;t.dh(o,!1),this._logoControl instanceof O_&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&t.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());let h=this.painter.context.gl,g=h.createFramebuffer();function v(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);let S=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,S),S}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(f),o.canvasCopies.map(v),o.timeStamps)}_canvasPixelComparison(f,o,h){let g=h[1]-h[0],v=f.length/4;for(let x=0;x<o.length;x++){let S=o[x],k=0;for(let D=0;D<S.length;D+=4)S[D]===f[D]&&S[D+1]===f[D+1]&&S[D+2]===f[D+2]&&S[D+3]===f[D+3]&&(k+=1);g+=(h[x+2]-h[x+1])*(1-k/v)}return g}remove(){this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.dp(this.painter.context.gl),t.dq.remove(),t.dr.remove(),this._removed=!0,this.fire(new t.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=t.e.frame(o=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(o)}))}_preloadTiles(f){let o=this.style?this.style.getSourceCaches():[];return t.ds(o,(h,g)=>h._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,o){t.du(f,o)}_occlusionCriteriaSatisfied(){let f=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&f&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return t.dt}},NavigationControl:class{constructor(f){this.options=t.W({},kl,f),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(t.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),N("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),N("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:o}):h.resetNorth({},{originalEvent:o}))}),this._compassIcon=N("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let o=f.getZoom(),h=o===f.getMaxZoom(),g=o===f.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new V_(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,o){let h=N("button",f,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(f,o){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${o}`);f.setAttribute("aria-label",h),f.firstElementChild&&f.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends t.E{constructor(f){super();let o=navigator.geolocation;this.options=t.W({geolocation:o},Il,f),t.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=nf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){let o=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,f(h)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>o(h.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(f){let o=this._map.getMaxBounds(),h=f.coords;return!!o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new t.f("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("geolocate",f)),this._finish()}}_updateCamera(f){let o=new t.aI(f.coords.longitude,f.coords.latitude),h=f.coords.accuracy,g=this._map.getBearing(),v=t.W({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),v,{geolocateSource:!0})}_updateMarker(f){if(f){let o=new t.aI(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,o=t.ax(1,f._center.lat)*f.worldSize,h=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.f("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=N("button","mapboxgl-ctrl-geolocate",this._container),N("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N("div","mapboxgl-user-location"),this._dotElement.appendChild(N("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(N("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new wh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=N("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.f("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:P_,ScaleControl:class{constructor(f){this.options=t.W({},j_,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),t.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,o=this._map,h=o._containerHeight/2,g=o._containerWidth/2-f/2,v=o.unproject([g,h]),x=o.unproject([g+f,h]),S=v.distanceTo(x);if(this.options.unit==="imperial"){let k=3.2808*S;k>5280?this._setScale(f,k/5280,"mile"):this._setScale(f,k,"foot")}else this.options.unit==="nautical"?this._setScale(f,S/1852,"nautical-mile"):S>=1e3?this._setScale(f,S/1e3,"kilometer"):this._setScale(f,S,"meter")}_setScale(f,o,h){this._map._requestDomTask(()=>{let g=function(x){let S=Math.pow(10,`${Math.floor(x)}`.length-1),k=x/S;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(D){let A=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*A)/A}(k),S*k}(o),v=g/o;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${Yu[h]}`,this._container.style.width=f*v+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:t.w("Full screen control 'container' must be a DOM element.")),t.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=N("button","mapboxgl-ctrl-fullscreen",this._controlContainer);N("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(f){super(),this.options=t.W(Object.create(gf),f),t.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new t.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new t.f("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=t.aI.convert(f),this._pos=null,this._trackPointer=!1,this._update();let o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let o=document.createDocumentFragment(),h=document.createElement("body"),g;for(h.innerHTML=f;g=h.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=N("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(f),this.options.closeButton){let h=this._closeButton=N("button","mapboxgl-popup-close-button",o);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let o;return this._classList.delete(f)?o=!1:(this._classList.add(f),o=!0),this._updateClassList(),o}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let o=this._map,h=this._container,g=this._pos;if(!o||!h||!g)return"bottom";let v=h.offsetWidth,x=h.offsetHeight,S=g.x<v/2,k=g.x>o.transform.width-v/2;if(g.y+f<x)return S?"top-left":k?"top-right":"top";if(g.y>o.transform.height-x){if(S)return"bottom-left";if(k)return"bottom-right"}return S?"left":k?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),f.className=o.join(" ")}_update(f){let o=this._map,h=this._content;if(!o||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=N("div","mapboxgl-popup",o.getContainer()),this._tip=N("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=L_(this._lngLat,this._pos,o.transform)),!this._trackPointer||f){let v=this._pos=this._trackPointer&&f?f:o.project(this._lngLat),x=Ml(this.options.offset),S=this._anchor=this._getAnchor(x.y),k=Ml(this.options.offset,S),D=v.add(k).round();o._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${ff[S]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&o._showingGlobe()){let v=t.d9(o.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(F_);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:wh,Style:pa,LngLat:t.aI,LngLatBounds:t.ai,Point:t.P,MercatorCoordinate:t.Y,FreeCameraOptions:xp,Evented:t.E,config:t.d8,prewarm:t.dx,clearPrewarmedResources:t.dy,get accessToken(){return t.d8.ACCESS_TOKEN},set accessToken(f){t.d8.ACCESS_TOKEN=f},get baseApiUrl(){return t.d8.API_URL},set baseApiUrl(f){t.d8.API_URL=f},get workerCount(){return t.dz.workerCount},set workerCount(f){t.dz.workerCount=f},get maxParallelImageRequests(){return t.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){t.d8.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){t.dA(f)},get workerUrl(){return t.dB.workerUrl},set workerUrl(f){t.dB.workerUrl=f},get workerClass(){return t.dB.workerClass},set workerClass(f){t.dB.workerClass=f},get workerParams(){return t.dB.workerParams},set workerParams(f){t.dB.workerParams=f},get dracoUrl(){return t.dC()},set dracoUrl(f){t.dD(f)},get meshoptUrl(){return t.dE()},set meshoptUrl(f){t.dF(f)},setNow:t.e.setNow,restoreNow:t.e.restoreNow}});var l=u;return l})});var C3=(()=>{let s=class s extends cb{constructor(r,l,t){super(r,l,t,wn(K0,{optional:!0}))}ngOnDestroy(){this.flush()}};s.\u0275fac=function(l){return new(l||s)(st(mn),st(sg),st(lb))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})();function S3(){return new Vk}function M3(d,s,u){return new Uk(d,s,u)}var Yk=[{provide:lb,useFactory:S3},{provide:cb,useClass:C3},{provide:J0,useFactory:M3,deps:[ob,cb,zi]}],$k=[{provide:sg,useFactory:()=>new jk},{provide:io,useValue:"BrowserAnimations"},...Yk],k3=[{provide:sg,useClass:Nk},{provide:io,useValue:"NoopAnimations"},...Yk],Zk=(()=>{let s=class s{static withConfig(r){return{ngModule:s,providers:r.disableAnimations?k3:$k}}};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({providers:$k,imports:[ab]});let d=s;return d})();var n1;try{n1=typeof Intl<"u"&&Intl.v8BreakIterator}catch{n1=!1}var $n=(()=>{let s=class s{constructor(r){this._platformId=r,this.isBrowser=this._platformId?kk(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||n1)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};s.\u0275fac=function(l){return new(l||s)(st(dd))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var lg;function I3(){if(lg==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>lg=!0}))}finally{lg=lg||!1}return lg}function Qs(d){return I3()?d:!!d.capture}var Hh;function Xk(){if(Hh==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Hh=!1,Hh;if("scrollBehavior"in document.documentElement.style)Hh=!0;else{let d=Element.prototype.scrollTo;d?Hh=!/\{\s*\[native code\]\s*\}/.test(d.toString()):Hh=!1}}return Hh}var i1;function T3(){if(i1==null){let d=typeof document<"u"?document.head:null;i1=!!(d&&(d.createShadowRoot||d.attachShadow))}return i1}function Qk(d){if(T3()){let s=d.getRootNode?d.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&s instanceof ShadowRoot)return s}return null}function Wh(){let d=typeof document<"u"&&document?document.activeElement:null;for(;d&&d.shadowRoot;){let s=d.shadowRoot.activeElement;if(s===d)break;d=s}return d}function xs(d){return d.composedPath?d.composedPath()[0]:d.target}function cg(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Am(d,...s){return s.length?s.some(u=>d[u]):d.altKey||d.shiftKey||d.ctrlKey||d.metaKey}function dg(d,s=0){return E3(d)?Number(d):s}function E3(d){return!isNaN(parseFloat(d))&&!isNaN(Number(d))}function Pm(d){return Array.isArray(d)?d:[d]}function Dr(d){return d==null?"":typeof d=="string"?d:`${d}px`}function jl(d){return d instanceof ln?d.nativeElement:d}var D3=(()=>{let s=class s{create(r){return typeof MutationObserver>"u"?null:new MutationObserver(r)}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var fb=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({providers:[D3]});let d=s;return d})();var Kk=new Set,Gh,A3=(()=>{let s=class s{constructor(r,l){this._platform=r,this._nonce=l,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):O3}matchMedia(r){return(this._platform.WEBKIT||this._platform.BLINK)&&P3(r,this._nonce),this._matchMedia(r)}};s.\u0275fac=function(l){return new(l||s)(st($n),st(dk,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function P3(d,s){if(!Kk.has(d))try{Gh||(Gh=document.createElement("style"),s&&Gh.setAttribute("nonce",s),Gh.setAttribute("type","text/css"),document.head.appendChild(Gh)),Gh.sheet&&(Gh.sheet.insertRule(`@media ${d} {body{ }}`,0),Kk.add(d))}catch(u){console.error(u)}}function O3(d){return{matches:d==="all"||d==="",media:d,addListener:()=>{},removeListener:()=>{}}}var eI=(()=>{let s=class s{constructor(r,l){this._mediaMatcher=r,this._zone=l,this._queries=new Map,this._destroySubject=new En}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(r){return Jk(Pm(r)).some(t=>this._registerQuery(t).mql.matches)}observe(r){let t=Jk(Pm(r)).map(C=>this._registerQuery(C).observable),_=ik(t);return _=$0(_.pipe(Ua(1)),_.pipe(Z0(1),Vx(0))),_.pipe(Cm(C=>{let I={matches:!1,breakpoints:{}};return C.forEach(({matches:O,query:N})=>{I.matches=I.matches||O,I.breakpoints[N]=O}),I}))}_registerQuery(r){if(this._queries.has(r))return this._queries.get(r);let l=this._mediaMatcher.matchMedia(r),_={observable:new uo(C=>{let I=O=>this._zone.run(()=>C.next(O));return l.addListener(I),()=>{l.removeListener(I)}}).pipe(gs(l),Cm(({matches:C})=>({query:r,matches:C})),jh(this._destroySubject)),mql:l};return this._queries.set(r,_),_}};s.\u0275fac=function(l){return new(l||s)(st(A3),st(zi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function Jk(d){return d.map(s=>s.split(",")).reduce((s,u)=>s.concat(u)).map(s=>s.trim())}var hg=(()=>{let s=class s{constructor(r){this._platform=r}isDisabled(r){return r.hasAttribute("disabled")}isVisible(r){return L3(r)&&getComputedStyle(r).visibility==="visible"}isTabbable(r){if(!this._platform.isBrowser)return!1;let l=R3(H3(r));if(l&&(tI(l)===-1||!this.isVisible(l)))return!1;let t=r.nodeName.toLowerCase(),_=tI(r);return r.hasAttribute("contenteditable")?_!==-1:t==="iframe"||t==="object"||this._platform.WEBKIT&&this._platform.IOS&&!j3(r)?!1:t==="audio"?r.hasAttribute("controls")?_!==-1:!1:t==="video"?_===-1?!1:_!==null?!0:this._platform.FIREFOX||r.hasAttribute("controls"):r.tabIndex>=0}isFocusable(r,l){return U3(r)&&!this.isDisabled(r)&&(l?.ignoreVisibility||this.isVisible(r))}};s.\u0275fac=function(l){return new(l||s)(st($n))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function R3(d){try{return d.frameElement}catch{return null}}function L3(d){return!!(d.offsetWidth||d.offsetHeight||typeof d.getClientRects=="function"&&d.getClientRects().length)}function F3(d){let s=d.nodeName.toLowerCase();return s==="input"||s==="select"||s==="button"||s==="textarea"}function z3(d){return N3(d)&&d.type=="hidden"}function B3(d){return V3(d)&&d.hasAttribute("href")}function N3(d){return d.nodeName.toLowerCase()=="input"}function V3(d){return d.nodeName.toLowerCase()=="a"}function rI(d){if(!d.hasAttribute("tabindex")||d.tabIndex===void 0)return!1;let s=d.getAttribute("tabindex");return!!(s&&!isNaN(parseInt(s,10)))}function tI(d){if(!rI(d))return null;let s=parseInt(d.getAttribute("tabindex")||"",10);return isNaN(s)?-1:s}function j3(d){let s=d.nodeName.toLowerCase(),u=s==="input"&&d.type;return u==="text"||u==="password"||s==="select"||s==="textarea"}function U3(d){return z3(d)?!1:F3(d)||B3(d)||d.hasAttribute("contenteditable")||rI(d)}function H3(d){return d.ownerDocument&&d.ownerDocument.defaultView||window}var o1=class{get enabled(){return this._enabled}set enabled(s){this._enabled=s,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(s,this._startAnchor),this._toggleAnchorTabIndex(s,this._endAnchor))}constructor(s,u,r,l,t=!1){this._element=s,this._checker=u,this._ngZone=r,this._document=l,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,t||this.attachAnchors()}destroy(){let s=this._startAnchor,u=this._endAnchor;s&&(s.removeEventListener("focus",this.startAnchorListener),s.remove()),u&&(u.removeEventListener("focus",this.endAnchorListener),u.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(s){return new Promise(u=>{this._executeOnStable(()=>u(this.focusInitialElement(s)))})}focusFirstTabbableElementWhenReady(s){return new Promise(u=>{this._executeOnStable(()=>u(this.focusFirstTabbableElement(s)))})}focusLastTabbableElementWhenReady(s){return new Promise(u=>{this._executeOnStable(()=>u(this.focusLastTabbableElement(s)))})}_getRegionBoundary(s){let u=this._element.querySelectorAll(`[cdk-focus-region-${s}], [cdkFocusRegion${s}], [cdk-focus-${s}]`);return s=="start"?u.length?u[0]:this._getFirstTabbableElement(this._element):u.length?u[u.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(s){let u=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(u){if(!this._checker.isFocusable(u)){let r=this._getFirstTabbableElement(u);return r?.focus(s),!!r}return u.focus(s),!0}return this.focusFirstTabbableElement(s)}focusFirstTabbableElement(s){let u=this._getRegionBoundary("start");return u&&u.focus(s),!!u}focusLastTabbableElement(s){let u=this._getRegionBoundary("end");return u&&u.focus(s),!!u}hasAttached(){return this._hasAttached}_getFirstTabbableElement(s){if(this._checker.isFocusable(s)&&this._checker.isTabbable(s))return s;let u=s.children;for(let r=0;r<u.length;r++){let l=u[r].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(u[r]):null;if(l)return l}return null}_getLastTabbableElement(s){if(this._checker.isFocusable(s)&&this._checker.isTabbable(s))return s;let u=s.children;for(let r=u.length-1;r>=0;r--){let l=u[r].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(u[r]):null;if(l)return l}return null}_createAnchor(){let s=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,s),s.classList.add("cdk-visually-hidden"),s.classList.add("cdk-focus-trap-anchor"),s.setAttribute("aria-hidden","true"),s}_toggleAnchorTabIndex(s,u){s?u.setAttribute("tabindex","0"):u.removeAttribute("tabindex")}toggleAnchors(s){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(s,this._startAnchor),this._toggleAnchorTabIndex(s,this._endAnchor))}_executeOnStable(s){this._ngZone.isStable?s():this._ngZone.onStable.pipe(Ua(1)).subscribe(s)}},ug=(()=>{let s=class s{constructor(r,l,t){this._checker=r,this._ngZone=l,this._document=t}create(r,l=!1){return new o1(r,this._checker,this._ngZone,this._document,l)}};s.\u0275fac=function(l){return new(l||s)(st(hg),st(zi),st(mn))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),oI=(()=>{let s=class s{get enabled(){return this.focusTrap?.enabled||!1}set enabled(r){this.focusTrap&&(this.focusTrap.enabled=r)}constructor(r,l,t){this._elementRef=r,this._focusTrapFactory=l,this._previouslyFocusedElement=null,wn($n).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(r){let l=r.autoCapture;l&&!l.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=Wh(),this.focusTrap?.focusInitialElementWhenReady()}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe(ug),fe(mn))},s.\u0275dir=tr({type:s,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[Zi.HasDecoratorInputTransform,"cdkTrapFocus","enabled",no],autoCapture:[Zi.HasDecoratorInputTransform,"cdkTrapFocusAutoCapture","autoCapture",no]},exportAs:["cdkTrapFocus"],standalone:!0,features:[Co,wo]});let d=s;return d})();function a1(d){return d.buttons===0||d.detail===0}function s1(d){let s=d.touches&&d.touches[0]||d.changedTouches&&d.changedTouches[0];return!!s&&s.identifier===-1&&(s.radiusX==null||s.radiusX===1)&&(s.radiusY==null||s.radiusY===1)}var W3=new fn("cdk-input-modality-detector-options"),G3={ignoreKeys:[18,17,224,91,16]},aI=650,Om=Qs({passive:!0,capture:!0}),q3=(()=>{let s=class s{get mostRecentModality(){return this._modality.value}constructor(r,l,t,_){this._platform=r,this._mostRecentTarget=null,this._modality=new ig(null),this._lastTouchMs=0,this._onKeydown=C=>{this._options?.ignoreKeys?.some(I=>I===C.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=xs(C))},this._onMousedown=C=>{Date.now()-this._lastTouchMs<aI||(this._modality.next(a1(C)?"keyboard":"mouse"),this._mostRecentTarget=xs(C))},this._onTouchstart=C=>{if(s1(C)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=xs(C)},this._options=Ji(Ji({},G3),_),this.modalityDetected=this._modality.pipe(Z0(1)),this.modalityChanged=this.modalityDetected.pipe(jx()),r.isBrowser&&l.runOutsideAngular(()=>{t.addEventListener("keydown",this._onKeydown,Om),t.addEventListener("mousedown",this._onMousedown,Om),t.addEventListener("touchstart",this._onTouchstart,Om)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Om),document.removeEventListener("mousedown",this._onMousedown,Om),document.removeEventListener("touchstart",this._onTouchstart,Om))}};s.\u0275fac=function(l){return new(l||s)(st($n),st(zi),st(mn),st(W3,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var _b=function(d){return d[d.IMMEDIATE=0]="IMMEDIATE",d[d.EVENTUAL=1]="EVENTUAL",d}(_b||{}),$3=new fn("cdk-focus-monitor-default-options"),gb=Qs({passive:!0,capture:!0}),Ul=(()=>{let s=class s{constructor(r,l,t,_,C){this._ngZone=r,this._platform=l,this._inputModalityDetector=t,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new En,this._rootNodeFocusAndBlurListener=I=>{let O=xs(I);for(let N=O;N;N=N.parentElement)I.type==="focus"?this._onFocus(I,N):this._onBlur(I,N)},this._document=_,this._detectionMode=C?.detectionMode||_b.IMMEDIATE}monitor(r,l=!1){let t=jl(r);if(!this._platform.isBrowser||t.nodeType!==1)return sr();let _=Qk(t)||this._getDocument(),C=this._elementInfo.get(t);if(C)return l&&(C.checkChildren=!0),C.subject;let I={checkChildren:l,subject:new En,rootNode:_};return this._elementInfo.set(t,I),this._registerGlobalListeners(I),I.subject}stopMonitoring(r){let l=jl(r),t=this._elementInfo.get(l);t&&(t.subject.complete(),this._setClasses(l),this._elementInfo.delete(l),this._removeGlobalListeners(t))}focusVia(r,l,t){let _=jl(r),C=this._getDocument().activeElement;_===C?this._getClosestElementsInfo(_).forEach(([I,O])=>this._originChanged(I,l,O)):(this._setOrigin(l),typeof _.focus=="function"&&_.focus(t))}ngOnDestroy(){this._elementInfo.forEach((r,l)=>this.stopMonitoring(l))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(r){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(r)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:r&&this._isLastInteractionFromInputLabel(r)?"mouse":"program"}_shouldBeAttributedToTouch(r){return this._detectionMode===_b.EVENTUAL||!!r?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(r,l){r.classList.toggle("cdk-focused",!!l),r.classList.toggle("cdk-touch-focused",l==="touch"),r.classList.toggle("cdk-keyboard-focused",l==="keyboard"),r.classList.toggle("cdk-mouse-focused",l==="mouse"),r.classList.toggle("cdk-program-focused",l==="program")}_setOrigin(r,l=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=r,this._originFromTouchInteraction=r==="touch"&&l,this._detectionMode===_b.IMMEDIATE){clearTimeout(this._originTimeoutId);let t=this._originFromTouchInteraction?aI:1;this._originTimeoutId=setTimeout(()=>this._origin=null,t)}})}_onFocus(r,l){let t=this._elementInfo.get(l),_=xs(r);!t||!t.checkChildren&&l!==_||this._originChanged(l,this._getFocusOrigin(_),t)}_onBlur(r,l){let t=this._elementInfo.get(l);!t||t.checkChildren&&r.relatedTarget instanceof Node&&l.contains(r.relatedTarget)||(this._setClasses(l),this._emitOrigin(t,null))}_emitOrigin(r,l){r.subject.observers.length&&this._ngZone.run(()=>r.subject.next(l))}_registerGlobalListeners(r){if(!this._platform.isBrowser)return;let l=r.rootNode,t=this._rootNodeFocusListenerCount.get(l)||0;t||this._ngZone.runOutsideAngular(()=>{l.addEventListener("focus",this._rootNodeFocusAndBlurListener,gb),l.addEventListener("blur",this._rootNodeFocusAndBlurListener,gb)}),this._rootNodeFocusListenerCount.set(l,t+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(jh(this._stopInputModalityDetector)).subscribe(_=>{this._setOrigin(_,!0)}))}_removeGlobalListeners(r){let l=r.rootNode;if(this._rootNodeFocusListenerCount.has(l)){let t=this._rootNodeFocusListenerCount.get(l);t>1?this._rootNodeFocusListenerCount.set(l,t-1):(l.removeEventListener("focus",this._rootNodeFocusAndBlurListener,gb),l.removeEventListener("blur",this._rootNodeFocusAndBlurListener,gb),this._rootNodeFocusListenerCount.delete(l))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(r,l,t){this._setClasses(r,l),this._emitOrigin(t,l),this._lastFocusOrigin=l}_getClosestElementsInfo(r){let l=[];return this._elementInfo.forEach((t,_)=>{(_===r||t.checkChildren&&_.contains(r))&&l.push([_,t])}),l}_isLastInteractionFromInputLabel(r){let{_mostRecentTarget:l,mostRecentModality:t}=this._inputModalityDetector;if(t!=="mouse"||!l||l===r||r.nodeName!=="INPUT"&&r.nodeName!=="TEXTAREA"||r.disabled)return!1;let _=r.labels;if(_){for(let C=0;C<_.length;C++)if(_[C].contains(l))return!0}return!1}};s.\u0275fac=function(l){return new(l||s)(st(zi),st($n),st(q3),st(mn,8),st($3,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),sI=(()=>{let s=class s{constructor(r,l){this._elementRef=r,this._focusMonitor=l,this._focusOrigin=null,this.cdkFocusChange=new an}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){let r=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(r,r.nodeType===1&&r.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(l=>{this._focusOrigin=l,this.cdkFocusChange.emit(l)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe(Ul))},s.\u0275dir=tr({type:s,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"],standalone:!0});let d=s;return d})(),qh=function(d){return d[d.NONE=0]="NONE",d[d.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",d[d.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",d}(qh||{}),iI="cdk-high-contrast-black-on-white",nI="cdk-high-contrast-white-on-black",r1="cdk-high-contrast-active",l1=(()=>{let s=class s{constructor(r,l){this._platform=r,this._document=l,this._breakpointSubscription=wn(eI).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return qh.NONE;let r=this._document.createElement("div");r.style.backgroundColor="rgb(1,2,3)",r.style.position="absolute",this._document.body.appendChild(r);let l=this._document.defaultView||window,t=l&&l.getComputedStyle?l.getComputedStyle(r):null,_=(t&&t.backgroundColor||"").replace(/ /g,"");switch(r.remove(),_){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return qh.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return qh.BLACK_ON_WHITE}return qh.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let r=this._document.body.classList;r.remove(r1,iI,nI),this._hasCheckedHighContrastMode=!0;let l=this.getHighContrastMode();l===qh.BLACK_ON_WHITE?r.add(r1,iI):l===qh.WHITE_ON_BLACK&&r.add(r1,nI)}}};s.\u0275fac=function(l){return new(l||s)(st($n),st(mn))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),bb=(()=>{let s=class s{constructor(r){r._applyBodyHighContrastModeCssClasses()}};s.\u0275fac=function(l){return new(l||s)(st(l1))},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[fb]});let d=s;return d})();var Y3=new fn("cdk-dir-doc",{providedIn:"root",factory:Z3});function Z3(){return wn(mn)}var X3=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function Q3(d){let s=d?.toLowerCase()||"";return s==="auto"&&typeof navigator<"u"&&navigator?.language?X3.test(navigator.language)?"rtl":"ltr":s==="rtl"?"rtl":"ltr"}var Hl=(()=>{let s=class s{constructor(r){if(this.value="ltr",this.change=new an,r){let l=r.body?r.body.dir:null,t=r.documentElement?r.documentElement.dir:null;this.value=Q3(l||t||"ltr")}}ngOnDestroy(){this.change.complete()}};s.\u0275fac=function(l){return new(l||s)(st(Y3,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var fd=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({});let d=s;return d})();var K3=["mat-internal-form-field",""],J3=["*"];function eL(){return!0}var tL=new fn("mat-sanity-checks",{providedIn:"root",factory:eL}),Vn=(()=>{let s=class s{constructor(r,l,t){this._sanityChecks=l,this._document=t,this._hasDoneGlobalChecks=!1,r._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(r){return cg()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[r]}};s.\u0275fac=function(l){return new(l||s)(st(l1),st(tL,8),st(mn))},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[fd,fd]});let d=s;return d})();var cI=new fn("MAT_DATE_LOCALE",{providedIn:"root",factory:iL});function iL(){return wn(xk)}var Ko=class{constructor(){this._localeChanges=new En,this.localeChanges=this._localeChanges}getValidDateOrNull(s){return this.isDateInstance(s)&&this.isValid(s)?s:null}deserialize(s){return s==null||this.isDateInstance(s)&&this.isValid(s)?s:this.invalid()}setLocale(s){this.locale=s,this._localeChanges.next()}compareDate(s,u){return this.getYear(s)-this.getYear(u)||this.getMonth(s)-this.getMonth(u)||this.getDate(s)-this.getDate(u)}sameDate(s,u){if(s&&u){let r=this.isValid(s),l=this.isValid(u);return r&&l?!this.compareDate(s,u):r==l}return s==u}clampDate(s,u,r){return u&&this.compareDate(s,u)<0?u:r&&this.compareDate(s,r)>0?r:s}},Rm=new fn("mat-date-formats"),nL=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function c1(d,s){let u=Array(d);for(let r=0;r<d;r++)u[r]=s(r);return u}var rL=(()=>{let s=class s extends Ko{constructor(r){super(),this.useUtcForDisplay=!1,this._matDateLocale=wn(cI,{optional:!0}),r!==void 0&&(this._matDateLocale=r),super.setLocale(this._matDateLocale)}getYear(r){return r.getFullYear()}getMonth(r){return r.getMonth()}getDate(r){return r.getDate()}getDayOfWeek(r){return r.getDay()}getMonthNames(r){let l=new Intl.DateTimeFormat(this.locale,{month:r,timeZone:"utc"});return c1(12,t=>this._format(l,new Date(2017,t,1)))}getDateNames(){let r=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return c1(31,l=>this._format(r,new Date(2017,0,l+1)))}getDayOfWeekNames(r){let l=new Intl.DateTimeFormat(this.locale,{weekday:r,timeZone:"utc"});return c1(7,t=>this._format(l,new Date(2017,0,t+1)))}getYearName(r){let l=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(l,r)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(r){return this.getDate(this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+1,0))}clone(r){return new Date(r.getTime())}createDate(r,l,t){let _=this._createDateWithOverflow(r,l,t);return _.getMonth()!=l,_}today(){return new Date}parse(r,l){return typeof r=="number"?new Date(r):r?new Date(Date.parse(r)):null}format(r,l){if(!this.isValid(r))throw Error("NativeDateAdapter: Cannot format invalid date.");let t=new Intl.DateTimeFormat(this.locale,ja(Ji({},l),{timeZone:"utc"}));return this._format(t,r)}addCalendarYears(r,l){return this.addCalendarMonths(r,l*12)}addCalendarMonths(r,l){let t=this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+l,this.getDate(r));return this.getMonth(t)!=((this.getMonth(r)+l)%12+12)%12&&(t=this._createDateWithOverflow(this.getYear(t),this.getMonth(t),0)),t}addCalendarDays(r,l){return this._createDateWithOverflow(this.getYear(r),this.getMonth(r),this.getDate(r)+l)}toIso8601(r){return[r.getUTCFullYear(),this._2digit(r.getUTCMonth()+1),this._2digit(r.getUTCDate())].join("-")}deserialize(r){if(typeof r=="string"){if(!r)return null;if(nL.test(r)){let l=new Date(r);if(this.isValid(l))return l}}return super.deserialize(r)}isDateInstance(r){return r instanceof Date}isValid(r){return!isNaN(r.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(r,l,t){let _=new Date;return _.setFullYear(r,l,t),_.setHours(0,0,0,0),_}_2digit(r){return("00"+r).slice(-2)}_format(r,l){let t=new Date;return t.setUTCFullYear(l.getFullYear(),l.getMonth(),l.getDate()),t.setUTCHours(l.getHours(),l.getMinutes(),l.getSeconds(),l.getMilliseconds()),r.format(t)}};s.\u0275fac=function(l){return new(l||s)(st(cI,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})(),oL={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};var bI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({providers:[aL()]});let d=s;return d})();function aL(d=oL){return[{provide:Ko,useClass:rL},{provide:Rm,useValue:d}]}var qa=function(d){return d[d.FADING_IN=0]="FADING_IN",d[d.VISIBLE=1]="VISIBLE",d[d.FADING_OUT=2]="FADING_OUT",d[d.HIDDEN=3]="HIDDEN",d}(qa||{}),u1=class{constructor(s,u,r,l=!1){this._renderer=s,this.element=u,this.config=r,this._animationForciblyDisabledThroughCss=l,this.state=qa.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},dI=Qs({passive:!0,capture:!0}),m1=class{constructor(){this._events=new Map,this._delegateEventHandler=s=>{let u=xs(s);u&&this._events.get(s.type)?.forEach((r,l)=>{(l===u||l.contains(u))&&r.forEach(t=>t.handleEvent(s))})}}addHandler(s,u,r,l){let t=this._events.get(u);if(t){let _=t.get(r);_?_.add(l):t.set(r,new Set([l]))}else this._events.set(u,new Map([[r,new Set([l])]])),s.runOutsideAngular(()=>{document.addEventListener(u,this._delegateEventHandler,dI)})}removeHandler(s,u,r){let l=this._events.get(s);if(!l)return;let t=l.get(u);t&&(t.delete(r),t.size===0&&l.delete(u),l.size===0&&(this._events.delete(s),document.removeEventListener(s,this._delegateEventHandler,dI)))}},hI={enterDuration:225,exitDuration:150},sL=800,uI=Qs({passive:!0,capture:!0}),mI=["mousedown","touchstart"],pI=["mouseup","mouseleave","touchend","touchcancel"],mg=class mg{constructor(s,u,r,l){this._target=s,this._ngZone=u,this._platform=l,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,l.isBrowser&&(this._containerElement=jl(r))}fadeInRipple(s,u,r={}){let l=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),t=Ji(Ji({},hI),r.animation);r.centered&&(s=l.left+l.width/2,u=l.top+l.height/2);let _=r.radius||lL(s,u,l),C=s-l.left,I=u-l.top,O=t.enterDuration,N=document.createElement("div");N.classList.add("mat-ripple-element"),N.style.left=`${C-_}px`,N.style.top=`${I-_}px`,N.style.height=`${_*2}px`,N.style.width=`${_*2}px`,r.color!=null&&(N.style.backgroundColor=r.color),N.style.transitionDuration=`${O}ms`,this._containerElement.appendChild(N);let q=window.getComputedStyle(N),ie=q.transitionProperty,de=q.transitionDuration,xe=ie==="none"||de==="0s"||de==="0s, 0s"||l.width===0&&l.height===0,ke=new u1(this,N,r,xe);N.style.transform="scale3d(1, 1, 1)",ke.state=qa.FADING_IN,r.persistent||(this._mostRecentTransientRipple=ke);let Ae=null;return!xe&&(O||t.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Xe=()=>this._finishRippleTransition(ke),qe=()=>this._destroyRipple(ke);N.addEventListener("transitionend",Xe),N.addEventListener("transitioncancel",qe),Ae={onTransitionEnd:Xe,onTransitionCancel:qe}}),this._activeRipples.set(ke,Ae),(xe||!O)&&this._finishRippleTransition(ke),ke}fadeOutRipple(s){if(s.state===qa.FADING_OUT||s.state===qa.HIDDEN)return;let u=s.element,r=Ji(Ji({},hI),s.config.animation);u.style.transitionDuration=`${r.exitDuration}ms`,u.style.opacity="0",s.state=qa.FADING_OUT,(s._animationForciblyDisabledThroughCss||!r.exitDuration)&&this._finishRippleTransition(s)}fadeOutAll(){this._getActiveRipples().forEach(s=>s.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(s=>{s.config.persistent||s.fadeOut()})}setupTriggerEvents(s){let u=jl(s);!this._platform.isBrowser||!u||u===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=u,mI.forEach(r=>{mg._eventManager.addHandler(this._ngZone,r,u,this)}))}handleEvent(s){s.type==="mousedown"?this._onMousedown(s):s.type==="touchstart"?this._onTouchStart(s):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{pI.forEach(u=>{this._triggerElement.addEventListener(u,this,uI)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(s){s.state===qa.FADING_IN?this._startFadeOutTransition(s):s.state===qa.FADING_OUT&&this._destroyRipple(s)}_startFadeOutTransition(s){let u=s===this._mostRecentTransientRipple,{persistent:r}=s.config;s.state=qa.VISIBLE,!r&&(!u||!this._isPointerDown)&&s.fadeOut()}_destroyRipple(s){let u=this._activeRipples.get(s)??null;this._activeRipples.delete(s),this._activeRipples.size||(this._containerRect=null),s===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),s.state=qa.HIDDEN,u!==null&&(s.element.removeEventListener("transitionend",u.onTransitionEnd),s.element.removeEventListener("transitioncancel",u.onTransitionCancel)),s.element.remove()}_onMousedown(s){let u=a1(s),r=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+sL;!this._target.rippleDisabled&&!u&&!r&&(this._isPointerDown=!0,this.fadeInRipple(s.clientX,s.clientY,this._target.rippleConfig))}_onTouchStart(s){if(!this._target.rippleDisabled&&!s1(s)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let u=s.changedTouches;if(u)for(let r=0;r<u.length;r++)this.fadeInRipple(u[r].clientX,u[r].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(s=>{let u=s.state===qa.VISIBLE||s.config.terminateOnPointerUp&&s.state===qa.FADING_IN;!s.config.persistent&&u&&s.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let s=this._triggerElement;s&&(mI.forEach(u=>mg._eventManager.removeHandler(u,s,this)),this._pointerUpEventsRegistered&&(pI.forEach(u=>s.removeEventListener(u,this,uI)),this._pointerUpEventsRegistered=!1))}};mg._eventManager=new m1;var p1=mg;function lL(d,s,u){let r=Math.max(Math.abs(d-u.left),Math.abs(d-u.right)),l=Math.max(Math.abs(s-u.top),Math.abs(s-u.bottom));return Math.sqrt(r*r+l*l)}var f1=new fn("mat-ripple-global-options"),xb=(()=>{let s=class s{get disabled(){return this._disabled}set disabled(r){r&&this.fadeOutAllNonPersistent(),this._disabled=r,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(r){this._trigger=r,this._setupTriggerEventsIfEnabled()}constructor(r,l,t,_,C){this._elementRef=r,this._animationMode=C,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=_||{},this._rippleRenderer=new p1(this,l,r,t)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Ji(Ji(Ji({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(r,l=0,t){return typeof r=="number"?this._rippleRenderer.fadeInRipple(r,l,Ji(Ji({},this.rippleConfig),t)):this._rippleRenderer.fadeInRipple(0,0,Ji(Ji({},this.rippleConfig),r))}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe(zi),fe($n),fe(f1,8),fe(io,8))},s.\u0275dir=tr({type:s,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(l,t){l&2&&Mi("mat-ripple-unbounded",t.unbounded)},inputs:{color:[Zi.None,"matRippleColor","color"],unbounded:[Zi.None,"matRippleUnbounded","unbounded"],centered:[Zi.None,"matRippleCentered","centered"],radius:[Zi.None,"matRippleRadius","radius"],animation:[Zi.None,"matRippleAnimation","animation"],disabled:[Zi.None,"matRippleDisabled","disabled"],trigger:[Zi.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let d=s;return d})(),yI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[Vn,Vn]});let d=s;return d})();var fI={capture:!0},gI=["focus","click","mouseenter","touchstart"],d1="mat-ripple-loader-uninitialized",h1="mat-ripple-loader-class-name",_I="mat-ripple-loader-centered",vb="mat-ripple-loader-disabled",vI=(()=>{let s=class s{constructor(){this._document=wn(mn,{optional:!0}),this._animationMode=wn(io,{optional:!0}),this._globalRippleOptions=wn(f1,{optional:!0}),this._platform=wn($n),this._ngZone=wn(zi),this._hosts=new Map,this._onInteraction=r=>{if(!(r.target instanceof HTMLElement))return;let t=r.target.closest(`[${d1}]`);t&&this._createRipple(t)},this._ngZone.runOutsideAngular(()=>{for(let r of gI)this._document?.addEventListener(r,this._onInteraction,fI)})}ngOnDestroy(){let r=this._hosts.keys();for(let l of r)this.destroyRipple(l);for(let l of gI)this._document?.removeEventListener(l,this._onInteraction,fI)}configureRipple(r,l){r.setAttribute(d1,""),(l.className||!r.hasAttribute(h1))&&r.setAttribute(h1,l.className||""),l.centered&&r.setAttribute(_I,""),l.disabled&&r.setAttribute(vb,"")}getRipple(r){return this._hosts.get(r)||this._createRipple(r)}setDisabled(r,l){let t=this._hosts.get(r);if(t){t.disabled=l;return}l?r.setAttribute(vb,""):r.removeAttribute(vb)}_createRipple(r){if(!this._document)return;let l=this._hosts.get(r);if(l)return l;r.querySelector(".mat-ripple")?.remove();let t=this._document.createElement("span");t.classList.add("mat-ripple",r.getAttribute(h1)),r.append(t);let _=new xb(new ln(t),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return _._isInitialized=!0,_.trigger=r,_.centered=r.hasAttribute(_I),_.disabled=r.hasAttribute(vb),this.attachRipple(r,_),_}attachRipple(r,l){r.removeAttribute(d1),this._hosts.set(r,l)}destroyRipple(r){let l=this._hosts.get(r);l&&(l.ngOnDestroy(),this._hosts.delete(r))}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),xI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=_t({type:s,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(l,t){l&2&&Mi("mdc-form-field--align-end",t.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[Hn],attrs:K3,ngContentSelectors:J3,decls:1,vars:0,template:function(l,t){l&1&&(Yo(),So(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0});let d=s;return d})();var wI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[Vn]});let d=s;return d})();var CI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({});let d=s;return d})();var g1=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[Vn,Zs,fb,Vn]});let d=s;return d})();var SI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[Vn,g1,g1,CI,Vn]});let d=s;return d})();var MI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[Vn,Zs,Vn]});let d=s;return d})();var kI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[Zs,Vn]});let d=s;return d})();var pg=class{attach(s){return this._attachedHost=s,s.attach(this)}detach(){let s=this._attachedHost;s!=null&&(this._attachedHost=null,s.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(s){this._attachedHost=s}},gd=class extends pg{constructor(s,u,r,l,t){super(),this.component=s,this.viewContainerRef=u,this.injector=r,this.componentFactoryResolver=l,this.projectableNodes=t}},$h=class extends pg{constructor(s,u,r,l){super(),this.templateRef=s,this.viewContainerRef=u,this.context=r,this.injector=l}get origin(){return this.templateRef.elementRef}attach(s,u=this.context){return this.context=u,super.attach(s)}detach(){return this.context=void 0,super.detach()}},_1=class extends pg{constructor(s){super(),this.element=s instanceof ln?s.nativeElement:s}},Lm=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(s){if(s instanceof gd)return this._attachedPortal=s,this.attachComponentPortal(s);if(s instanceof $h)return this._attachedPortal=s,this.attachTemplatePortal(s);if(this.attachDomPortal&&s instanceof _1)return this._attachedPortal=s,this.attachDomPortal(s)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(s){this._disposeFn=s}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var wb=class extends Lm{constructor(s,u,r,l,t){super(),this.outletElement=s,this._componentFactoryResolver=u,this._appRef=r,this._defaultInjector=l,this.attachDomPortal=_=>{this._document;let C=_.element;C.parentNode;let I=this._document.createComment("dom-portal");C.parentNode.insertBefore(I,C),this.outletElement.appendChild(C),this._attachedPortal=_,super.setDisposeFn(()=>{I.parentNode&&I.parentNode.replaceChild(C,I)})},this._document=t}attachComponentPortal(s){let r=(s.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(s.component),l;return s.viewContainerRef?(l=s.viewContainerRef.createComponent(r,s.viewContainerRef.length,s.injector||s.viewContainerRef.injector,s.projectableNodes||void 0),this.setDisposeFn(()=>l.destroy())):(l=r.create(s.injector||this._defaultInjector||Ha.NULL),this._appRef.attachView(l.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(l.hostView),l.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(l)),this._attachedPortal=s,l}attachTemplatePortal(s){let u=s.viewContainerRef,r=u.createEmbeddedView(s.templateRef,s.context,{injector:s.injector});return r.rootNodes.forEach(l=>this.outletElement.appendChild(l)),r.detectChanges(),this.setDisposeFn(()=>{let l=u.indexOf(r);l!==-1&&u.remove(l)}),this._attachedPortal=s,r}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(s){return s.hostView.rootNodes[0]}};var _d=(()=>{let s=class s extends Lm{constructor(r,l,t){super(),this._componentFactoryResolver=r,this._viewContainerRef=l,this._isInitialized=!1,this.attached=new an,this.attachDomPortal=_=>{this._document;let C=_.element;C.parentNode;let I=this._document.createComment("dom-portal");_.setAttachedHost(this),C.parentNode.insertBefore(I,C),this._getRootNode().appendChild(C),this._attachedPortal=_,super.setDisposeFn(()=>{I.parentNode&&I.parentNode.replaceChild(C,I)})},this._document=t}get portal(){return this._attachedPortal}set portal(r){this.hasAttached()&&!r&&!this._isInitialized||(this.hasAttached()&&super.detach(),r&&super.attach(r),this._attachedPortal=r||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(r){r.setAttachedHost(this);let l=r.viewContainerRef!=null?r.viewContainerRef:this._viewContainerRef,_=(r.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(r.component),C=l.createComponent(_,l.length,r.injector||l.injector,r.projectableNodes||void 0);return l!==this._viewContainerRef&&this._getRootNode().appendChild(C.hostView.rootNodes[0]),super.setDisposeFn(()=>C.destroy()),this._attachedPortal=r,this._attachedRef=C,this.attached.emit(C),C}attachTemplatePortal(r){r.setAttachedHost(this);let l=this._viewContainerRef.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=r,this._attachedRef=l,this.attached.emit(l),l}_getRootNode(){let r=this._viewContainerRef.element.nativeElement;return r.nodeType===r.ELEMENT_NODE?r:r.parentNode}};s.\u0275fac=function(l){return new(l||s)(fe(ng),fe(Im),fe(mn))},s.\u0275dir=tr({type:s,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[Zi.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[Fo]});let d=s;return d})();var Wl=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({});let d=s;return d})();var hL=20,II=(()=>{let s=class s{constructor(r,l,t){this._ngZone=r,this._platform=l,this._scrolled=new En,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=t}register(r){this.scrollContainers.has(r)||this.scrollContainers.set(r,r.elementScrolled().subscribe(()=>this._scrolled.next(r)))}deregister(r){let l=this.scrollContainers.get(r);l&&(l.unsubscribe(),this.scrollContainers.delete(r))}scrolled(r=hL){return this._platform.isBrowser?new uo(l=>{this._globalSubscription||this._addGlobalListener();let t=r>0?this._scrolled.pipe(Nx(r)).subscribe(l):this._scrolled.subscribe(l);return this._scrolledCount++,()=>{t.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):sr()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((r,l)=>this.deregister(l)),this._scrolled.complete()}ancestorScrolled(r,l){let t=this.getAncestorScrollContainers(r);return this.scrolled(l).pipe(ya(_=>!_||t.indexOf(_)>-1))}getAncestorScrollContainers(r){let l=[];return this.scrollContainers.forEach((t,_)=>{this._scrollableContainsElement(_,r)&&l.push(_)}),l}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(r,l){let t=jl(l),_=r.getElementRef().nativeElement;do if(t==_)return!0;while(t=t.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let r=this._getWindow();return rk(r.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};s.\u0275fac=function(l){return new(l||s)(st(zi),st($n),st(mn,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var uL=20,b1=(()=>{let s=class s{constructor(r,l,t){this._platform=r,this._change=new En,this._changeListener=_=>{this._change.next(_)},this._document=t,l.runOutsideAngular(()=>{if(r.isBrowser){let _=this._getWindow();_.addEventListener("resize",this._changeListener),_.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let r=this._getWindow();r.removeEventListener("resize",this._changeListener),r.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let r={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),r}getViewportRect(){let r=this.getViewportScrollPosition(),{width:l,height:t}=this.getViewportSize();return{top:r.top,left:r.left,bottom:r.top+t,right:r.left+l,height:t,width:l}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let r=this._document,l=this._getWindow(),t=r.documentElement,_=t.getBoundingClientRect(),C=-_.top||r.body.scrollTop||l.scrollY||t.scrollTop||0,I=-_.left||r.body.scrollLeft||l.scrollX||t.scrollLeft||0;return{top:C,left:I}}change(r=uL){return r>0?this._change.pipe(Nx(r)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let r=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:r.innerWidth,height:r.innerHeight}:{width:0,height:0}}};s.\u0275fac=function(l){return new(l||s)(st($n),st(zi),st(mn,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Cb=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({});let d=s;return d})(),y1=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[fd,Cb,fd,Cb]});let d=s;return d})();var TI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[Vn,Vn]});let d=s;return d})();var pL=["switch"],fL=["*"];function gL(d,s){d&1&&(V(0,"div",10),cd(),V(1,"svg",12),Me(2,"path",13),j(),V(3,"svg",14),Me(4,"path",15),j()())}var _L=new fn("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),bL={provide:Dk,useExisting:X0(()=>EI),multi:!0},Sb=class{constructor(s,u){this.source=s,this.checked=u}},yL=0,EI=(()=>{let s=class s{_createChangeEvent(r){return new Sb(this,r)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(r){this._checked=r,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(r,l,t,_,C,I){this._elementRef=r,this._focusMonitor=l,this._changeDetectorRef=t,this.defaults=C,this._onChange=O=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new an,this.toggleChange=new an,this.tabIndex=parseInt(_)||0,this.color=C.color||"accent",this._noopAnimations=I==="NoopAnimations",this.id=this._uniqueId=`mat-mdc-slide-toggle-${++yL}`,this.hideIcon=C.hideIcon??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(r=>{r==="keyboard"||r==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):r||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(r){r.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(r){this.checked=!!r}registerOnChange(r){this._onChange=r}registerOnTouched(r){this._onTouched=r}validate(r){return this.required&&r.value!==!0?{required:!0}:null}registerOnValidatorChange(r){this._validatorOnChange=r}setDisabledState(r){this.disabled=r,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new Sb(this,this.checked)))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe(Ul),fe(mo),Mm("tabindex"),fe(_L),fe(io,8))},s.\u0275cmp=_t({type:s,selectors:[["mat-slide-toggle"]],viewQuery:function(l,t){if(l&1&&bi(pL,5),l&2){let _;gi(_=_i())&&(t._switchElement=_.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(l,t){l&2&&(Vl("id",t.id),bn("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),bs(t.color?"mat-"+t.color:""),Mi("mat-mdc-slide-toggle-focused",t._focused)("mat-mdc-slide-toggle-checked",t.checked)("_mat-animation-noopable",t._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[Zi.None,"aria-label","ariaLabel"],ariaLabelledby:[Zi.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Zi.None,"aria-describedby","ariaDescribedby"],required:[Zi.HasDecoratorInputTransform,"required","required",no],color:"color",disabled:[Zi.HasDecoratorInputTransform,"disabled","disabled",no],disableRipple:[Zi.HasDecoratorInputTransform,"disableRipple","disableRipple",no],tabIndex:[Zi.HasDecoratorInputTransform,"tabIndex","tabIndex",r=>r==null?0:Qx(r)],checked:[Zi.HasDecoratorInputTransform,"checked","checked",no],hideIcon:[Zi.HasDecoratorInputTransform,"hideIcon","hideIcon",no]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[ys([bL,{provide:Ak,useExisting:s,multi:!0}]),Co,wo,Hn],ngContentSelectors:fL,decls:13,vars:24,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(l,t){if(l&1){let _=Xt();Yo(),V(0,"div",1)(1,"button",2,0),Pe("click",function(){return mt(_),pt(t._handleClick())}),Me(3,"div",3),V(4,"div",4)(5,"div",5)(6,"div",6),Me(7,"div",7),j(),V(8,"div",8),Me(9,"div",9),j(),Bt(10,gL,5,0,"div",10),j()()(),V(11,"label",11),Pe("click",function(I){return mt(_),pt(I.stopPropagation())}),So(12),j()()}if(l&2){let _=va(2);Fe("labelPosition",t.labelPosition),ue(),Mi("mdc-switch--selected",t.checked)("mdc-switch--unselected",!t.checked)("mdc-switch--checked",t.checked)("mdc-switch--disabled",t.disabled),Fe("tabIndex",t.disabled?-1:t.tabIndex)("disabled",t.disabled),bn("id",t.buttonId)("name",t.name)("aria-label",t.ariaLabel)("aria-labelledby",t._getAriaLabelledBy())("aria-describedby",t.ariaDescribedby)("aria-required",t.required||null)("aria-checked",t.checked),ue(8),Fe("matRippleTrigger",_)("matRippleDisabled",t.disableRipple||t.disabled)("matRippleCentered",!0),ue(),Dn(10,t.hideIcon?-1:10),ue(),Fe("for",t.buttonId),bn("id",t._labelId)}},dependencies:[xb,xI],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}.mdc-switch{width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mdc-switch__handle{transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle:active .mdc-switch:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--selected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--unselected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch__track::after,.mdc-switch__track::before{border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color)}.mdc-switch--selected .mdc-switch__track::after,.mdc-switch--selected .mdc-switch__track::before{border-width:var(--mat-switch-selected-track-outline-width)}.mdc-switch--disabled .mdc-switch__track::after,.mdc-switch--disabled .mdc-switch__track::before{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}'],encapsulation:2,changeDetection:0});let d=s;return d})();var DI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[EI,Vn,Vn]});let d=s;return d})();var AI=Xk(),v1=class{constructor(s,u){this._viewportRuler=s,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=u}attach(){}enable(){if(this._canBeEnabled()){let s=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=s.style.left||"",this._previousHTMLStyles.top=s.style.top||"",s.style.left=Dr(-this._previousScrollPosition.left),s.style.top=Dr(-this._previousScrollPosition.top),s.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let s=this._document.documentElement,u=this._document.body,r=s.style,l=u.style,t=r.scrollBehavior||"",_=l.scrollBehavior||"";this._isEnabled=!1,r.left=this._previousHTMLStyles.left,r.top=this._previousHTMLStyles.top,s.classList.remove("cdk-global-scrollblock"),AI&&(r.scrollBehavior=l.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),AI&&(r.scrollBehavior=t,l.scrollBehavior=_)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let u=this._document.body,r=this._viewportRuler.getViewportSize();return u.scrollHeight>r.height||u.scrollWidth>r.width}};var x1=class{constructor(s,u,r,l){this._scrollDispatcher=s,this._ngZone=u,this._viewportRuler=r,this._config=l,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(s){this._overlayRef,this._overlayRef=s}enable(){if(this._scrollSubscription)return;let s=this._scrollDispatcher.scrolled(0).pipe(ya(u=>!u||!this._overlayRef.overlayElement.contains(u.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=s.subscribe(()=>{let u=this._viewportRuler.getViewportScrollPosition().top;Math.abs(u-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=s.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},Mb=class{enable(){}disable(){}attach(){}};function w1(d,s){return s.some(u=>{let r=d.bottom<u.top,l=d.top>u.bottom,t=d.right<u.left,_=d.left>u.right;return r||l||t||_})}function PI(d,s){return s.some(u=>{let r=d.top<u.top,l=d.bottom>u.bottom,t=d.left<u.left,_=d.right>u.right;return r||l||t||_})}var C1=class{constructor(s,u,r,l){this._scrollDispatcher=s,this._viewportRuler=u,this._ngZone=r,this._config=l,this._scrollSubscription=null}attach(s){this._overlayRef,this._overlayRef=s}enable(){if(!this._scrollSubscription){let s=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(s).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let u=this._overlayRef.overlayElement.getBoundingClientRect(),{width:r,height:l}=this._viewportRuler.getViewportSize();w1(u,[{width:r,height:l,bottom:l,right:r,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},vL=(()=>{let s=class s{constructor(r,l,t,_){this._scrollDispatcher=r,this._viewportRuler=l,this._ngZone=t,this.noop=()=>new Mb,this.close=C=>new x1(this._scrollDispatcher,this._ngZone,this._viewportRuler,C),this.block=()=>new v1(this._viewportRuler,this._document),this.reposition=C=>new C1(this._scrollDispatcher,this._viewportRuler,this._ngZone,C),this._document=_}};s.\u0275fac=function(l){return new(l||s)(st(II),st(b1),st(zi),st(mn))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Fm=class{constructor(s){if(this.scrollStrategy=new Mb,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,s){let u=Object.keys(s);for(let r of u)s[r]!==void 0&&(this[r]=s[r])}}};var S1=class{constructor(s,u){this.connectionPair=s,this.scrollableViewProperties=u}};var zI=(()=>{let s=class s{constructor(r){this._attachedOverlays=[],this._document=r}ngOnDestroy(){this.detach()}add(r){this.remove(r),this._attachedOverlays.push(r)}remove(r){let l=this._attachedOverlays.indexOf(r);l>-1&&this._attachedOverlays.splice(l,1),this._attachedOverlays.length===0&&this.detach()}};s.\u0275fac=function(l){return new(l||s)(st(mn))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),xL=(()=>{let s=class s extends zI{constructor(r,l){super(r),this._ngZone=l,this._keydownListener=t=>{let _=this._attachedOverlays;for(let C=_.length-1;C>-1;C--)if(_[C]._keydownEvents.observers.length>0){let I=_[C]._keydownEvents;this._ngZone?this._ngZone.run(()=>I.next(t)):I.next(t);break}}}add(r){super.add(r),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};s.\u0275fac=function(l){return new(l||s)(st(mn),st(zi,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),wL=(()=>{let s=class s extends zI{constructor(r,l,t){super(r),this._platform=l,this._ngZone=t,this._cursorStyleIsSet=!1,this._pointerDownListener=_=>{this._pointerDownEventTarget=xs(_)},this._clickListener=_=>{let C=xs(_),I=_.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:C;this._pointerDownEventTarget=null;let O=this._attachedOverlays.slice();for(let N=O.length-1;N>-1;N--){let q=O[N];if(q._outsidePointerEvents.observers.length<1||!q.hasAttached())continue;if(q.overlayElement.contains(C)||q.overlayElement.contains(I))break;let ie=q._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>ie.next(_)):ie.next(_)}}}add(r){if(super.add(r),!this._isAttached){let l=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(l)):this._addEventListeners(l),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=l.style.cursor,l.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let r=this._document.body;r.removeEventListener("pointerdown",this._pointerDownListener,!0),r.removeEventListener("click",this._clickListener,!0),r.removeEventListener("auxclick",this._clickListener,!0),r.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(r.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(r){r.addEventListener("pointerdown",this._pointerDownListener,!0),r.addEventListener("click",this._clickListener,!0),r.addEventListener("auxclick",this._clickListener,!0),r.addEventListener("contextmenu",this._clickListener,!0)}};s.\u0275fac=function(l){return new(l||s)(st(mn),st($n),st(zi,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),zm=(()=>{let s=class s{constructor(r,l){this._platform=l,this._document=r}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let r="cdk-overlay-container";if(this._platform.isBrowser||cg()){let t=this._document.querySelectorAll(`.${r}[platform="server"], .${r}[platform="test"]`);for(let _=0;_<t.length;_++)t[_].remove()}let l=this._document.createElement("div");l.classList.add(r),cg()?l.setAttribute("platform","test"):this._platform.isBrowser||l.setAttribute("platform","server"),this._document.body.appendChild(l),this._containerElement=l}};s.\u0275fac=function(l){return new(l||s)(st(mn),st($n))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Gl=class{constructor(s,u,r,l,t,_,C,I,O,N=!1){this._portalOutlet=s,this._host=u,this._pane=r,this._config=l,this._ngZone=t,this._keyboardDispatcher=_,this._document=C,this._location=I,this._outsideClickDispatcher=O,this._animationsDisabled=N,this._backdropElement=null,this._backdropClick=new En,this._attachments=new En,this._detachments=new En,this._locationChanges=fs.EMPTY,this._backdropClickHandler=q=>this._backdropClick.next(q),this._backdropTransitionendHandler=q=>{this._disposeBackdrop(q.target)},this._keydownEvents=new En,this._outsidePointerEvents=new En,l.scrollStrategy&&(this._scrollStrategy=l.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=l.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(s){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let u=this._portalOutlet.attach(s);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Ua(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof u?.onDestroy=="function"&&u.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),u}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let s=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),s}dispose(){let s=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,s&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(s){s!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=s,this.hasAttached()&&(s.attach(this),this.updatePosition()))}updateSize(s){this._config=Ji(Ji({},this._config),s),this._updateElementSize()}setDirection(s){this._config=ja(Ji({},this._config),{direction:s}),this._updateElementDirection()}addPanelClass(s){this._pane&&this._toggleClasses(this._pane,s,!0)}removePanelClass(s){this._pane&&this._toggleClasses(this._pane,s,!1)}getDirection(){let s=this._config.direction;return s?typeof s=="string"?s:s.value:"ltr"}updateScrollStrategy(s){s!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=s,this.hasAttached()&&(s.attach(this),s.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let s=this._pane.style;s.width=Dr(this._config.width),s.height=Dr(this._config.height),s.minWidth=Dr(this._config.minWidth),s.minHeight=Dr(this._config.minHeight),s.maxWidth=Dr(this._config.maxWidth),s.maxHeight=Dr(this._config.maxHeight)}_togglePointerEvents(s){this._pane.style.pointerEvents=s?"":"none"}_attachBackdrop(){let s="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(s)})}):this._backdropElement.classList.add(s)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let s=this._backdropElement;if(s){if(this._animationsDisabled){this._disposeBackdrop(s);return}s.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{s.addEventListener("transitionend",this._backdropTransitionendHandler)}),s.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(s)},500))}}_toggleClasses(s,u,r){let l=Pm(u||[]).filter(t=>!!t);l.length&&(r?s.classList.add(...l):s.classList.remove(...l))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let s=this._ngZone.onStable.pipe(jh(Nh(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),s.unsubscribe())})})}_disposeScrollStrategy(){let s=this._scrollStrategy;s&&(s.disable(),s.detach&&s.detach())}_disposeBackdrop(s){s&&(s.removeEventListener("click",this._backdropClickHandler),s.removeEventListener("transitionend",this._backdropTransitionendHandler),s.remove(),this._backdropElement===s&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},OI="cdk-overlay-connected-position-bounding-box",CL=/([A-Za-z%]+)$/,kb=class{get positions(){return this._preferredPositions}constructor(s,u,r,l,t){this._viewportRuler=u,this._document=r,this._platform=l,this._overlayContainer=t,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new En,this._resizeSubscription=fs.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(s)}attach(s){this._overlayRef&&this._overlayRef,this._validatePositions(),s.hostElement.classList.add(OI),this._overlayRef=s,this._boundingBox=s.hostElement,this._pane=s.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let s=this._originRect,u=this._overlayRect,r=this._viewportRect,l=this._containerRect,t=[],_;for(let C of this._preferredPositions){let I=this._getOriginPoint(s,l,C),O=this._getOverlayPoint(I,u,C),N=this._getOverlayFit(O,u,r,C);if(N.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(C,I);return}if(this._canFitWithFlexibleDimensions(N,O,r)){t.push({position:C,origin:I,overlayRect:u,boundingBoxRect:this._calculateBoundingBoxRect(I,C)});continue}(!_||_.overlayFit.visibleArea<N.visibleArea)&&(_={overlayFit:N,overlayPoint:O,originPoint:I,position:C,overlayRect:u})}if(t.length){let C=null,I=-1;for(let O of t){let N=O.boundingBoxRect.width*O.boundingBoxRect.height*(O.position.weight||1);N>I&&(I=N,C=O)}this._isPushed=!1,this._applyPosition(C.position,C.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(_.position,_.originPoint);return}this._applyPosition(_.position,_.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Yh(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(OI),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let s=this._lastPosition;if(s){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let u=this._getOriginPoint(this._originRect,this._containerRect,s);this._applyPosition(s,u)}else this.apply()}withScrollableContainers(s){return this._scrollables=s,this}withPositions(s){return this._preferredPositions=s,s.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(s){return this._viewportMargin=s,this}withFlexibleDimensions(s=!0){return this._hasFlexibleDimensions=s,this}withGrowAfterOpen(s=!0){return this._growAfterOpen=s,this}withPush(s=!0){return this._canPush=s,this}withLockedPosition(s=!0){return this._positionLocked=s,this}setOrigin(s){return this._origin=s,this}withDefaultOffsetX(s){return this._offsetX=s,this}withDefaultOffsetY(s){return this._offsetY=s,this}withTransformOriginOn(s){return this._transformOriginSelector=s,this}_getOriginPoint(s,u,r){let l;if(r.originX=="center")l=s.left+s.width/2;else{let _=this._isRtl()?s.right:s.left,C=this._isRtl()?s.left:s.right;l=r.originX=="start"?_:C}u.left<0&&(l-=u.left);let t;return r.originY=="center"?t=s.top+s.height/2:t=r.originY=="top"?s.top:s.bottom,u.top<0&&(t-=u.top),{x:l,y:t}}_getOverlayPoint(s,u,r){let l;r.overlayX=="center"?l=-u.width/2:r.overlayX==="start"?l=this._isRtl()?-u.width:0:l=this._isRtl()?0:-u.width;let t;return r.overlayY=="center"?t=-u.height/2:t=r.overlayY=="top"?0:-u.height,{x:s.x+l,y:s.y+t}}_getOverlayFit(s,u,r,l){let t=LI(u),{x:_,y:C}=s,I=this._getOffset(l,"x"),O=this._getOffset(l,"y");I&&(_+=I),O&&(C+=O);let N=0-_,q=_+t.width-r.width,ie=0-C,de=C+t.height-r.height,xe=this._subtractOverflows(t.width,N,q),ke=this._subtractOverflows(t.height,ie,de),Ae=xe*ke;return{visibleArea:Ae,isCompletelyWithinViewport:t.width*t.height===Ae,fitsInViewportVertically:ke===t.height,fitsInViewportHorizontally:xe==t.width}}_canFitWithFlexibleDimensions(s,u,r){if(this._hasFlexibleDimensions){let l=r.bottom-u.y,t=r.right-u.x,_=RI(this._overlayRef.getConfig().minHeight),C=RI(this._overlayRef.getConfig().minWidth),I=s.fitsInViewportVertically||_!=null&&_<=l,O=s.fitsInViewportHorizontally||C!=null&&C<=t;return I&&O}return!1}_pushOverlayOnScreen(s,u,r){if(this._previousPushAmount&&this._positionLocked)return{x:s.x+this._previousPushAmount.x,y:s.y+this._previousPushAmount.y};let l=LI(u),t=this._viewportRect,_=Math.max(s.x+l.width-t.width,0),C=Math.max(s.y+l.height-t.height,0),I=Math.max(t.top-r.top-s.y,0),O=Math.max(t.left-r.left-s.x,0),N=0,q=0;return l.width<=t.width?N=O||-_:N=s.x<this._viewportMargin?t.left-r.left-s.x:0,l.height<=t.height?q=I||-C:q=s.y<this._viewportMargin?t.top-r.top-s.y:0,this._previousPushAmount={x:N,y:q},{x:s.x+N,y:s.y+q}}_applyPosition(s,u){if(this._setTransformOrigin(s),this._setOverlayElementStyles(u,s),this._setBoundingBoxStyles(u,s),s.panelClass&&this._addPanelClasses(s.panelClass),this._positionChanges.observers.length){let r=this._getScrollVisibility();if(s!==this._lastPosition||!this._lastScrollVisibility||!SL(this._lastScrollVisibility,r)){let l=new S1(s,r);this._positionChanges.next(l)}this._lastScrollVisibility=r}this._lastPosition=s,this._isInitialRender=!1}_setTransformOrigin(s){if(!this._transformOriginSelector)return;let u=this._boundingBox.querySelectorAll(this._transformOriginSelector),r,l=s.overlayY;s.overlayX==="center"?r="center":this._isRtl()?r=s.overlayX==="start"?"right":"left":r=s.overlayX==="start"?"left":"right";for(let t=0;t<u.length;t++)u[t].style.transformOrigin=`${r} ${l}`}_calculateBoundingBoxRect(s,u){let r=this._viewportRect,l=this._isRtl(),t,_,C;if(u.overlayY==="top")_=s.y,t=r.height-_+this._viewportMargin;else if(u.overlayY==="bottom")C=r.height-s.y+this._viewportMargin*2,t=r.height-C+this._viewportMargin;else{let de=Math.min(r.bottom-s.y+r.top,s.y),xe=this._lastBoundingBoxSize.height;t=de*2,_=s.y-de,t>xe&&!this._isInitialRender&&!this._growAfterOpen&&(_=s.y-xe/2)}let I=u.overlayX==="start"&&!l||u.overlayX==="end"&&l,O=u.overlayX==="end"&&!l||u.overlayX==="start"&&l,N,q,ie;if(O)ie=r.width-s.x+this._viewportMargin*2,N=s.x-this._viewportMargin;else if(I)q=s.x,N=r.right-s.x;else{let de=Math.min(r.right-s.x+r.left,s.x),xe=this._lastBoundingBoxSize.width;N=de*2,q=s.x-de,N>xe&&!this._isInitialRender&&!this._growAfterOpen&&(q=s.x-xe/2)}return{top:_,left:q,bottom:C,right:ie,width:N,height:t}}_setBoundingBoxStyles(s,u){let r=this._calculateBoundingBoxRect(s,u);!this._isInitialRender&&!this._growAfterOpen&&(r.height=Math.min(r.height,this._lastBoundingBoxSize.height),r.width=Math.min(r.width,this._lastBoundingBoxSize.width));let l={};if(this._hasExactPosition())l.top=l.left="0",l.bottom=l.right=l.maxHeight=l.maxWidth="",l.width=l.height="100%";else{let t=this._overlayRef.getConfig().maxHeight,_=this._overlayRef.getConfig().maxWidth;l.height=Dr(r.height),l.top=Dr(r.top),l.bottom=Dr(r.bottom),l.width=Dr(r.width),l.left=Dr(r.left),l.right=Dr(r.right),u.overlayX==="center"?l.alignItems="center":l.alignItems=u.overlayX==="end"?"flex-end":"flex-start",u.overlayY==="center"?l.justifyContent="center":l.justifyContent=u.overlayY==="bottom"?"flex-end":"flex-start",t&&(l.maxHeight=Dr(t)),_&&(l.maxWidth=Dr(_))}this._lastBoundingBoxSize=r,Yh(this._boundingBox.style,l)}_resetBoundingBoxStyles(){Yh(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Yh(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(s,u){let r={},l=this._hasExactPosition(),t=this._hasFlexibleDimensions,_=this._overlayRef.getConfig();if(l){let N=this._viewportRuler.getViewportScrollPosition();Yh(r,this._getExactOverlayY(u,s,N)),Yh(r,this._getExactOverlayX(u,s,N))}else r.position="static";let C="",I=this._getOffset(u,"x"),O=this._getOffset(u,"y");I&&(C+=`translateX(${I}px) `),O&&(C+=`translateY(${O}px)`),r.transform=C.trim(),_.maxHeight&&(l?r.maxHeight=Dr(_.maxHeight):t&&(r.maxHeight="")),_.maxWidth&&(l?r.maxWidth=Dr(_.maxWidth):t&&(r.maxWidth="")),Yh(this._pane.style,r)}_getExactOverlayY(s,u,r){let l={top:"",bottom:""},t=this._getOverlayPoint(u,this._overlayRect,s);if(this._isPushed&&(t=this._pushOverlayOnScreen(t,this._overlayRect,r)),s.overlayY==="bottom"){let _=this._document.documentElement.clientHeight;l.bottom=`${_-(t.y+this._overlayRect.height)}px`}else l.top=Dr(t.y);return l}_getExactOverlayX(s,u,r){let l={left:"",right:""},t=this._getOverlayPoint(u,this._overlayRect,s);this._isPushed&&(t=this._pushOverlayOnScreen(t,this._overlayRect,r));let _;if(this._isRtl()?_=s.overlayX==="end"?"left":"right":_=s.overlayX==="end"?"right":"left",_==="right"){let C=this._document.documentElement.clientWidth;l.right=`${C-(t.x+this._overlayRect.width)}px`}else l.left=Dr(t.x);return l}_getScrollVisibility(){let s=this._getOriginRect(),u=this._pane.getBoundingClientRect(),r=this._scrollables.map(l=>l.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:PI(s,r),isOriginOutsideView:w1(s,r),isOverlayClipped:PI(u,r),isOverlayOutsideView:w1(u,r)}}_subtractOverflows(s,...u){return u.reduce((r,l)=>r-Math.max(l,0),s)}_getNarrowedViewportRect(){let s=this._document.documentElement.clientWidth,u=this._document.documentElement.clientHeight,r=this._viewportRuler.getViewportScrollPosition();return{top:r.top+this._viewportMargin,left:r.left+this._viewportMargin,right:r.left+s-this._viewportMargin,bottom:r.top+u-this._viewportMargin,width:s-2*this._viewportMargin,height:u-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(s,u){return u==="x"?s.offsetX==null?this._offsetX:s.offsetX:s.offsetY==null?this._offsetY:s.offsetY}_validatePositions(){}_addPanelClasses(s){this._pane&&Pm(s).forEach(u=>{u!==""&&this._appliedPanelClasses.indexOf(u)===-1&&(this._appliedPanelClasses.push(u),this._pane.classList.add(u))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(s=>{this._pane.classList.remove(s)}),this._appliedPanelClasses=[])}_getOriginRect(){let s=this._origin;if(s instanceof ln)return s.nativeElement.getBoundingClientRect();if(s instanceof Element)return s.getBoundingClientRect();let u=s.width||0,r=s.height||0;return{top:s.y,bottom:s.y+r,left:s.x,right:s.x+u,height:r,width:u}}};function Yh(d,s){for(let u in s)s.hasOwnProperty(u)&&(d[u]=s[u]);return d}function RI(d){if(typeof d!="number"&&d!=null){let[s,u]=d.split(CL);return!u||u==="px"?parseFloat(s):null}return d||null}function LI(d){return{top:Math.floor(d.top),right:Math.floor(d.right),bottom:Math.floor(d.bottom),left:Math.floor(d.left),width:Math.floor(d.width),height:Math.floor(d.height)}}function SL(d,s){return d===s?!0:d.isOriginClipped===s.isOriginClipped&&d.isOriginOutsideView===s.isOriginOutsideView&&d.isOverlayClipped===s.isOverlayClipped&&d.isOverlayOutsideView===s.isOverlayOutsideView}var FI="cdk-global-overlay-wrapper",M1=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(s){let u=s.getConfig();this._overlayRef=s,this._width&&!u.width&&s.updateSize({width:this._width}),this._height&&!u.height&&s.updateSize({height:this._height}),s.hostElement.classList.add(FI),this._isDisposed=!1}top(s=""){return this._bottomOffset="",this._topOffset=s,this._alignItems="flex-start",this}left(s=""){return this._xOffset=s,this._xPosition="left",this}bottom(s=""){return this._topOffset="",this._bottomOffset=s,this._alignItems="flex-end",this}right(s=""){return this._xOffset=s,this._xPosition="right",this}start(s=""){return this._xOffset=s,this._xPosition="start",this}end(s=""){return this._xOffset=s,this._xPosition="end",this}width(s=""){return this._overlayRef?this._overlayRef.updateSize({width:s}):this._width=s,this}height(s=""){return this._overlayRef?this._overlayRef.updateSize({height:s}):this._height=s,this}centerHorizontally(s=""){return this.left(s),this._xPosition="center",this}centerVertically(s=""){return this.top(s),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let s=this._overlayRef.overlayElement.style,u=this._overlayRef.hostElement.style,r=this._overlayRef.getConfig(),{width:l,height:t,maxWidth:_,maxHeight:C}=r,I=(l==="100%"||l==="100vw")&&(!_||_==="100%"||_==="100vw"),O=(t==="100%"||t==="100vh")&&(!C||C==="100%"||C==="100vh"),N=this._xPosition,q=this._xOffset,ie=this._overlayRef.getConfig().direction==="rtl",de="",xe="",ke="";I?ke="flex-start":N==="center"?(ke="center",ie?xe=q:de=q):ie?N==="left"||N==="end"?(ke="flex-end",de=q):(N==="right"||N==="start")&&(ke="flex-start",xe=q):N==="left"||N==="start"?(ke="flex-start",de=q):(N==="right"||N==="end")&&(ke="flex-end",xe=q),s.position=this._cssPosition,s.marginLeft=I?"0":de,s.marginTop=O?"0":this._topOffset,s.marginBottom=this._bottomOffset,s.marginRight=I?"0":xe,u.justifyContent=ke,u.alignItems=O?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let s=this._overlayRef.overlayElement.style,u=this._overlayRef.hostElement,r=u.style;u.classList.remove(FI),r.justifyContent=r.alignItems=s.marginTop=s.marginBottom=s.marginLeft=s.marginRight=s.position="",this._overlayRef=null,this._isDisposed=!0}},ML=(()=>{let s=class s{constructor(r,l,t,_){this._viewportRuler=r,this._document=l,this._platform=t,this._overlayContainer=_}global(){return new M1}flexibleConnectedTo(r){return new kb(r,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};s.\u0275fac=function(l){return new(l||s)(st(b1),st(mn),st($n),st(zm))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),kL=0,Jo=(()=>{let s=class s{constructor(r,l,t,_,C,I,O,N,q,ie,de,xe){this.scrollStrategies=r,this._overlayContainer=l,this._componentFactoryResolver=t,this._positionBuilder=_,this._keyboardDispatcher=C,this._injector=I,this._ngZone=O,this._document=N,this._directionality=q,this._location=ie,this._outsideClickDispatcher=de,this._animationsModuleType=xe}create(r){let l=this._createHostElement(),t=this._createPaneElement(l),_=this._createPortalOutlet(t),C=new Fm(r);return C.direction=C.direction||this._directionality.value,new Gl(_,l,t,C,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(r){let l=this._document.createElement("div");return l.id=`cdk-overlay-${kL++}`,l.classList.add("cdk-overlay-pane"),r.appendChild(l),l}_createHostElement(){let r=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(r),r}_createPortalOutlet(r){return this._appRef||(this._appRef=this._injector.get(vk)),new wb(r,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};s.\u0275fac=function(l){return new(l||s)(st(vL),st(zm),st(ng),st(ML),st(xL),st(Ha),st(zi),st(mn),st(Hl),st(ii),st(wL),st(io,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var IL=new fn("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let d=wn(Jo);return()=>d.scrollStrategies.reposition()}});function TL(d){return()=>d.scrollStrategies.reposition()}var EL={provide:IL,deps:[Jo],useFactory:TL},Bm=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({providers:[Jo,EL],imports:[fd,Wl,y1,y1]});let d=s;return d})();var DL=["mat-button",""],AL=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],PL=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var OL=".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}";var RL=["mat-icon-button",""],LL=["*"];var FL=new fn("MAT_BUTTON_CONFIG");var zL=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],NI=(()=>{let s=class s{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(r){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,r)}get disableRipple(){return this._disableRipple}set disableRipple(r){this._disableRipple=r,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(r){this._disabled=r,this._updateRippleDisabled()}constructor(r,l,t,_){this._elementRef=r,this._platform=l,this._ngZone=t,this._animationMode=_,this._focusMonitor=wn(Ul),this._rippleLoader=wn(vI),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let C=wn(FL,{optional:!0}),I=r.nativeElement,O=I.classList;this.disabledInteractive=C?.disabledInteractive??!1,this._rippleLoader?.configureRipple(I,{className:"mat-mdc-button-ripple"});for(let{attribute:N,mdcClasses:q}of zL)I.hasAttribute(N)&&O.add(...q)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(r="program",l){r?this._focusMonitor.focusVia(this._elementRef.nativeElement,r,l):this._elementRef.nativeElement.focus(l)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};s.\u0275fac=function(l){km()},s.\u0275dir=tr({type:s,inputs:{color:"color",disableRipple:[Zi.HasDecoratorInputTransform,"disableRipple","disableRipple",no],disabled:[Zi.HasDecoratorInputTransform,"disabled","disabled",no],ariaDisabled:[Zi.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",no],disabledInteractive:[Zi.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",no]},features:[Co]});let d=s;return d})();var k1=(()=>{let s=class s extends NI{constructor(r,l,t,_){super(r,l,t,_)}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe($n),fe(zi),fe(io,8))},s.\u0275cmp=_t({type:s,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(l,t){l&2&&(bn("disabled",t._getDisabledAttribute())("aria-disabled",t._getAriaDisabled()),bs(t.color?"mat-"+t.color:""),Mi("mat-mdc-button-disabled",t.disabled)("mat-mdc-button-disabled-interactive",t.disabledInteractive)("_mat-animation-noopable",t._animationMode==="NoopAnimations")("mat-unthemed",!t.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Fo,Hn],attrs:DL,ngContentSelectors:PL,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(l,t){l&1&&(Yo(AL),Me(0,"span",0),So(1),V(2,"span",1),So(3,1),j(),So(4,2),Me(5,"span",2)(6,"span",3)),l&2&&Mi("mdc-button__ripple",!t._isFab)("mdc-fab__ripple",t._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let d=s;return d})();var I1=(()=>{let s=class s extends NI{constructor(r,l,t,_){super(r,l,t,_),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe($n),fe(zi),fe(io,8))},s.\u0275cmp=_t({type:s,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(l,t){l&2&&(bn("disabled",t._getDisabledAttribute())("aria-disabled",t._getAriaDisabled()),bs(t.color?"mat-"+t.color:""),Mi("mat-mdc-button-disabled",t.disabled)("mat-mdc-button-disabled-interactive",t.disabledInteractive)("_mat-animation-noopable",t._animationMode==="NoopAnimations")("mat-unthemed",!t.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Fo,Hn],attrs:RL,ngContentSelectors:LL,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(l,t){l&1&&(Yo(),Me(0,"span",0),So(1),Me(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{color:var(--mdc-icon-button-icon-color)}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 48px);height:var(--mdc-icon-button-state-layer-size, 48px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 48px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size);-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color)}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color)}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color)}.mat-mdc-icon-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity)}.mat-mdc-icon-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity)}.mat-mdc-icon-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity)}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',OL],encapsulation:2,changeDetection:0});let d=s;return d})();var VI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[Vn,yI,Vn]});let d=s;return d})();var BL=["mat-calendar-body",""];function NL(d,s){if(d&1&&(V(0,"tr",0)(1,"td",3),$(2),j()()),d&2){let u=rt();ue(),Wa("padding-top",u._cellPadding)("padding-bottom",u._cellPadding),bn("colspan",u.numCols),ue(),ki(" ",u.label," ")}}function VL(d,s){if(d&1&&(V(0,"td",3),$(1),j()),d&2){let u=rt(2);Wa("padding-top",u._cellPadding)("padding-bottom",u._cellPadding),bn("colspan",u._firstRowOffset),ue(),ki(" ",u._firstRowOffset>=u.labelMinRequiredCells?u.label:""," ")}}function jL(d,s){if(d&1){let u=Xt();V(0,"td",6)(1,"button",7),Pe("click",function(l){let t=mt(u).$implicit,_=rt(2);return pt(_._cellClicked(t,l))})("focus",function(l){let t=mt(u).$implicit,_=rt(2);return pt(_._emitActiveDateChange(t,l))}),V(2,"span",8),$(3),j(),Me(4,"span",9),j()()}if(d&2){let u=s.$implicit,r=s.$index,l=rt().$index,t=rt();Wa("width",t._cellWidth)("padding-top",t._cellPadding)("padding-bottom",t._cellPadding),bn("data-mat-row",l)("data-mat-col",r),ue(),Mi("mat-calendar-body-disabled",!u.enabled)("mat-calendar-body-active",t._isActiveCell(l,r))("mat-calendar-body-range-start",t._isRangeStart(u.compareValue))("mat-calendar-body-range-end",t._isRangeEnd(u.compareValue))("mat-calendar-body-in-range",t._isInRange(u.compareValue))("mat-calendar-body-comparison-bridge-start",t._isComparisonBridgeStart(u.compareValue,l,r))("mat-calendar-body-comparison-bridge-end",t._isComparisonBridgeEnd(u.compareValue,l,r))("mat-calendar-body-comparison-start",t._isComparisonStart(u.compareValue))("mat-calendar-body-comparison-end",t._isComparisonEnd(u.compareValue))("mat-calendar-body-in-comparison-range",t._isInComparisonRange(u.compareValue))("mat-calendar-body-preview-start",t._isPreviewStart(u.compareValue))("mat-calendar-body-preview-end",t._isPreviewEnd(u.compareValue))("mat-calendar-body-in-preview",t._isInPreview(u.compareValue)),Fe("ngClass",u.cssClasses)("tabindex",t._isActiveCell(l,r)?0:-1),bn("aria-label",u.ariaLabel)("aria-disabled",!u.enabled||null)("aria-pressed",t._isSelected(u.compareValue))("aria-current",t.todayValue===u.compareValue?"date":null)("aria-describedby",t._getDescribedby(u.compareValue)),ue(),Mi("mat-calendar-body-selected",t._isSelected(u.compareValue))("mat-calendar-body-comparison-identical",t._isComparisonIdentical(u.compareValue))("mat-calendar-body-today",t.todayValue===u.compareValue),ue(),ki(" ",u.displayValue," ")}}function UL(d,s){if(d&1&&(V(0,"tr",1),Bt(1,VL,2,6,"td",4),mr(2,jL,5,48,"td",5,rg),j()),d&2){let u=s.$implicit,r=s.$index,l=rt();ue(),Dn(1,r===0&&l._firstRowOffset?1:-1),ue(),pr(u)}}function HL(d,s){if(d&1&&(V(0,"th",2)(1,"span",6),$(2),j(),V(3,"span",3),$(4),j()()),d&2){let u=s.$implicit;ue(2),Ft(u.long),ue(2),Ft(u.narrow)}}var WL=["*"];function GL(d,s){}function qL(d,s){if(d&1){let u=Xt();V(0,"mat-month-view",2),Er("activeDateChange",function(l){mt(u);let t=rt();return Tr(t.activeDate,l)||(t.activeDate=l),pt(l)}),Pe("_userSelection",function(l){mt(u);let t=rt();return pt(t._dateSelected(l))})("dragStarted",function(l){mt(u);let t=rt();return pt(t._dragStarted(l))})("dragEnded",function(l){mt(u);let t=rt();return pt(t._dragEnded(l))}),j()}if(d&2){let u=rt();Ir("activeDate",u.activeDate),Fe("selected",u.selected)("dateFilter",u.dateFilter)("maxDate",u.maxDate)("minDate",u.minDate)("dateClass",u.dateClass)("comparisonStart",u.comparisonStart)("comparisonEnd",u.comparisonEnd)("startDateAccessibleName",u.startDateAccessibleName)("endDateAccessibleName",u.endDateAccessibleName)("activeDrag",u._activeDrag)}}function $L(d,s){if(d&1){let u=Xt();V(0,"mat-year-view",3),Er("activeDateChange",function(l){mt(u);let t=rt();return Tr(t.activeDate,l)||(t.activeDate=l),pt(l)}),Pe("monthSelected",function(l){mt(u);let t=rt();return pt(t._monthSelectedInYearView(l))})("selectedChange",function(l){mt(u);let t=rt();return pt(t._goToDateInView(l,"month"))}),j()}if(d&2){let u=rt();Ir("activeDate",u.activeDate),Fe("selected",u.selected)("dateFilter",u.dateFilter)("maxDate",u.maxDate)("minDate",u.minDate)("dateClass",u.dateClass)}}function YL(d,s){if(d&1){let u=Xt();V(0,"mat-multi-year-view",4),Er("activeDateChange",function(l){mt(u);let t=rt();return Tr(t.activeDate,l)||(t.activeDate=l),pt(l)}),Pe("yearSelected",function(l){mt(u);let t=rt();return pt(t._yearSelectedInMultiYearView(l))})("selectedChange",function(l){mt(u);let t=rt();return pt(t._goToDateInView(l,"year"))}),j()}if(d&2){let u=rt();Ir("activeDate",u.activeDate),Fe("selected",u.selected)("dateFilter",u.dateFilter)("maxDate",u.maxDate)("minDate",u.minDate)("dateClass",u.dateClass)}}function ZL(d,s){}var XL=["button"],QL=[[["","matDatepickerToggleIcon",""]]],KL=["[matDatepickerToggleIcon]"];function JL(d,s){d&1&&(cd(),V(0,"svg",2),Me(1,"path",3),j())}var bg=(()=>{let s=class s{constructor(){this.changes=new En,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(r,l){return`${r} \u2013 ${l}`}formatYearRangeLabel(r,l){return`${r} to ${l}`}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),gg=class{constructor(s,u,r,l,t={},_=s,C){this.value=s,this.displayValue=u,this.ariaLabel=r,this.enabled=l,this.cssClasses=t,this.compareValue=_,this.rawValue=C}},eF=1,jI=Qs({passive:!1,capture:!0}),bd=Qs({passive:!0,capture:!0}),Ib=Qs({passive:!0}),jm=(()=>{let s=class s{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(r,l){this._elementRef=r,this._ngZone=l,this._platform=wn($n),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new an,this.previewChange=new an,this.activeDateChange=new an,this.dragStarted=new an,this.dragEnded=new an,this._didDragSinceMouseDown=!1,this._enterHandler=t=>{if(this._skipNextFocus&&t.type==="focus"){this._skipNextFocus=!1;return}if(t.target&&this.isRange){let _=this._getCellFromElement(t.target);_&&this._ngZone.run(()=>this.previewChange.emit({value:_.enabled?_:null,event:t}))}},this._touchmoveHandler=t=>{if(!this.isRange)return;let _=UI(t),C=_?this._getCellFromElement(_):null;_!==t.target&&(this._didDragSinceMouseDown=!0),E1(t.target)&&t.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:C?.enabled?C:null,event:t}))},this._leaveHandler=t=>{this.previewEnd!==null&&this.isRange&&(t.type!=="blur"&&(this._didDragSinceMouseDown=!0),t.target&&this._getCellFromElement(t.target)&&!(t.relatedTarget&&this._getCellFromElement(t.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:t})))},this._mousedownHandler=t=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let _=t.target&&this._getCellFromElement(t.target);!_||!this._isInRange(_.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:_.rawValue,event:t})})},this._mouseupHandler=t=>{if(!this.isRange)return;let _=E1(t.target);if(!_){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:t})});return}_.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let C=this._getCellFromElement(_);this.dragEnded.emit({value:C?.rawValue??null,event:t})})},this._touchendHandler=t=>{let _=UI(t);_&&this._mouseupHandler({target:_})},this._id=`mat-calendar-body-${eF++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,l.runOutsideAngular(()=>{let t=r.nativeElement;t.addEventListener("touchmove",this._touchmoveHandler,jI),t.addEventListener("mouseenter",this._enterHandler,bd),t.addEventListener("focus",this._enterHandler,bd),t.addEventListener("mouseleave",this._leaveHandler,bd),t.addEventListener("blur",this._leaveHandler,bd),t.addEventListener("mousedown",this._mousedownHandler,Ib),t.addEventListener("touchstart",this._mousedownHandler,Ib),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(r,l){this._didDragSinceMouseDown||r.enabled&&this.selectedValueChange.emit({value:r.value,event:l})}_emitActiveDateChange(r,l){r.enabled&&this.activeDateChange.emit({value:r.value,event:l})}_isSelected(r){return this.startValue===r||this.endValue===r}ngOnChanges(r){let l=r.numCols,{rows:t,numCols:_}=this;(r.rows||l)&&(this._firstRowOffset=t&&t.length&&t[0].length?_-t[0].length:0),(r.cellAspectRatio||l||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/_}%`),(l||!this._cellWidth)&&(this._cellWidth=`${100/_}%`)}ngOnDestroy(){let r=this._elementRef.nativeElement;r.removeEventListener("touchmove",this._touchmoveHandler,jI),r.removeEventListener("mouseenter",this._enterHandler,bd),r.removeEventListener("focus",this._enterHandler,bd),r.removeEventListener("mouseleave",this._leaveHandler,bd),r.removeEventListener("blur",this._leaveHandler,bd),r.removeEventListener("mousedown",this._mousedownHandler,Ib),r.removeEventListener("touchstart",this._mousedownHandler,Ib),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(r,l){let t=r*this.numCols+l;return r&&(t-=this._firstRowOffset),t==this.activeCell}_focusActiveCell(r=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Ua(1)).subscribe(()=>{setTimeout(()=>{let l=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");l&&(r||(this._skipNextFocus=!0),l.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(r){return D1(r,this.startValue,this.endValue)}_isRangeEnd(r){return A1(r,this.startValue,this.endValue)}_isInRange(r){return P1(r,this.startValue,this.endValue,this.isRange)}_isComparisonStart(r){return D1(r,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(r,l,t){if(!this._isComparisonStart(r)||this._isRangeStart(r)||!this._isInRange(r))return!1;let _=this.rows[l][t-1];if(!_){let C=this.rows[l-1];_=C&&C[C.length-1]}return _&&!this._isRangeEnd(_.compareValue)}_isComparisonBridgeEnd(r,l,t){if(!this._isComparisonEnd(r)||this._isRangeEnd(r)||!this._isInRange(r))return!1;let _=this.rows[l][t+1];if(!_){let C=this.rows[l+1];_=C&&C[0]}return _&&!this._isRangeStart(_.compareValue)}_isComparisonEnd(r){return A1(r,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(r){return P1(r,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(r){return this.comparisonStart===this.comparisonEnd&&r===this.comparisonStart}_isPreviewStart(r){return D1(r,this.previewStart,this.previewEnd)}_isPreviewEnd(r){return A1(r,this.previewStart,this.previewEnd)}_isInPreview(r){return P1(r,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(r){return this.isRange?this.startValue===r&&this.endValue===r?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===r?this._startDateLabelId:this.endValue===r?this._endDateLabelId:null:null}_getCellFromElement(r){let l=E1(r);if(l){let t=l.getAttribute("data-mat-row"),_=l.getAttribute("data-mat-col");if(t&&_)return this.rows[parseInt(t)][parseInt(_)]}return null}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe(zi))},s.\u0275cmp=_t({type:s,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[wo,Hn],attrs:BL,decls:7,vars:5,consts:[["aria-hidden","true"],["role","row"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],[1,"mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"click","focus","ngClass","tabindex"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(l,t){l&1&&(Bt(0,NL,3,6,"tr",0),mr(1,UL,4,1,"tr",1,rg),V(3,"label",2),$(4),j(),V(5,"label",2),$(6),j()),l&2&&(Dn(0,t._firstRowOffset<t.labelMinRequiredCells?0:-1),ue(),pr(t.rows),ue(2),Fe("id",t._startDateLabelId),ue(),ki(" ",t.startDateAccessibleName,`
`),ue(),Fe("id",t._endDateLabelId),ue(),ki(" ",t.endDateAccessibleName,`
`))},dependencies:[Mo],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let d=s;return d})();function T1(d){return d?.nodeName==="TD"}function E1(d){let s;return T1(d)?s=d:T1(d.parentNode)?s=d.parentNode:T1(d.parentNode?.parentNode)&&(s=d.parentNode.parentNode),s?.getAttribute("data-mat-row")!=null?s:null}function D1(d,s,u){return u!==null&&s!==u&&d<u&&d===s}function A1(d,s,u){return s!==null&&s!==u&&d>=s&&d===u}function P1(d,s,u,r){return r&&s!==null&&u!==null&&s!==u&&d>=s&&d<=u}function UI(d){let s=d.changedTouches[0];return document.elementFromPoint(s.clientX,s.clientY)}var $a=class{constructor(s,u){this.start=s,this.end=u}},Tb=(()=>{let s=class s{constructor(r,l){this.selection=r,this._adapter=l,this._selectionChanged=new En,this.selectionChanged=this._selectionChanged,this.selection=r}updateSelection(r,l){let t=this.selection;this.selection=r,this._selectionChanged.next({selection:r,source:l,oldValue:t})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(r){return this._adapter.isDateInstance(r)&&this._adapter.isValid(r)}};s.\u0275fac=function(l){km()},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})(),tF=(()=>{let s=class s extends Tb{constructor(r){super(null,r)}add(r){super.updateSelection(r,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let r=new s(this._adapter);return r.updateSelection(this.selection,this),r}};s.\u0275fac=function(l){return new(l||s)(st(Ko))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})();function iF(d,s){return d||new tF(s)}var nF={provide:Tb,deps:[[new Q0,new lk,Tb],Ko],useFactory:iF};var $I=new fn("MAT_DATE_RANGE_SELECTION_STRATEGY");var O1=7,HI=(()=>{let s=class s{get activeDate(){return this._activeDate}set activeDate(r){let l=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this._hasSameMonthAndYear(l,this._activeDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof $a?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,l,t,_,C){this._changeDetectorRef=r,this._dateFormats=l,this._dateAdapter=t,this._dir=_,this._rangeStrategy=C,this._rerenderSubscription=fs.EMPTY,this.activeDrag=null,this.selectedChange=new an,this._userSelection=new an,this.dragStarted=new an,this.dragEnded=new an,this.activeDateChange=new an,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(gs(null)).subscribe(()=>this._init())}ngOnChanges(r){let l=r.comparisonStart||r.comparisonEnd;l&&!l.firstChange&&this._setRanges(this.selected),r.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(r){let l=r.value,t=this._getDateFromDayOfMonth(l),_,C;this._selected instanceof $a?(_=this._getDateInCurrentMonth(this._selected.start),C=this._getDateInCurrentMonth(this._selected.end)):_=C=this._getDateInCurrentMonth(this._selected),(_!==l||C!==l)&&this.selectedChange.emit(t),this._userSelection.emit({value:t,event:r.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(r){let l=r.value,t=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(l),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(r){let l=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&r.preventDefault();return;case 27:this._previewEnd!=null&&!Am(r)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:r}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:r})),r.preventDefault(),r.stopPropagation());return;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(O1+this._dateAdapter.getDayOfWeek(r)-this._dateAdapter.getFirstDayOfWeek())%O1,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(r){this._matCalendarBody._focusActiveCell(r)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:r,value:l}){if(this._rangeStrategy){let t=l?l.rawValue:null,_=this._rangeStrategy.createPreview(t,this.selected,r);if(this._previewStart=this._getCellCompareValue(_.start),this._previewEnd=this._getCellCompareValue(_.end),this.activeDrag&&t){let C=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,t,r);C&&(this._previewStart=this._getCellCompareValue(C.start),this._previewEnd=this._getCellCompareValue(C.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(r){if(this.activeDrag)if(r.value){let l=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,r.value,r.event);this.dragEnded.emit({value:l??null,event:r.event})}else this.dragEnded.emit({value:null,event:r.event})}_getDateFromDayOfMonth(r){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r)}_initWeekdays(){let r=this._dateAdapter.getFirstDayOfWeek(),l=this._dateAdapter.getDayOfWeekNames("narrow"),_=this._dateAdapter.getDayOfWeekNames("long").map((C,I)=>({long:C,narrow:l[I]}));this._weekdays=_.slice(r).concat(_.slice(0,r))}_createWeekCells(){let r=this._dateAdapter.getNumDaysInMonth(this.activeDate),l=this._dateAdapter.getDateNames();this._weeks=[[]];for(let t=0,_=this._firstWeekOffset;t<r;t++,_++){_==O1&&(this._weeks.push([]),_=0);let C=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),t+1),I=this._shouldEnableDate(C),O=this._dateAdapter.format(C,this._dateFormats.display.dateA11yLabel),N=this.dateClass?this.dateClass(C,"month"):void 0;this._weeks[this._weeks.length-1].push(new gg(t+1,l[t],O,I,N,this._getCellCompareValue(C),C))}}_shouldEnableDate(r){return!!r&&(!this.minDate||this._dateAdapter.compareDate(r,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(r,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(r))}_getDateInCurrentMonth(r){return r&&this._hasSameMonthAndYear(r,this.activeDate)?this._dateAdapter.getDate(r):null}_hasSameMonthAndYear(r,l){return!!(r&&l&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(l)&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(l))}_getCellCompareValue(r){if(r){let l=this._dateAdapter.getYear(r),t=this._dateAdapter.getMonth(r),_=this._dateAdapter.getDate(r);return new Date(l,t,_).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(r){r instanceof $a?(this._rangeStart=this._getCellCompareValue(r.start),this._rangeEnd=this._getCellCompareValue(r.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(r),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(r){return!this.dateFilter||this.dateFilter(r)}_clearPreview(){this._previewStart=this._previewEnd=null}};s.\u0275fac=function(l){return new(l||s)(fe(mo),fe(Rm,8),fe(Ko,8),fe(Hl,8),fe($I,8))},s.\u0275cmp=_t({type:s,selectors:[["mat-month-view"]],viewQuery:function(l,t){if(l&1&&bi(jm,5),l&2){let _;gi(_=_i())&&(t._matCalendarBody=_.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[wo,Hn],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown","label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName"],[1,"cdk-visually-hidden"]],template:function(l,t){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),mr(3,HL,5,2,"th",2,rg),j(),V(5,"tr",3),Me(6,"th",4),j()(),V(7,"tbody",5),Pe("selectedValueChange",function(C){return t._dateSelected(C)})("activeDateChange",function(C){return t._updateActiveDate(C)})("previewChange",function(C){return t._previewChanged(C)})("dragStarted",function(C){return t.dragStarted.emit(C)})("dragEnded",function(C){return t._dragEnded(C)})("keyup",function(C){return t._handleCalendarBodyKeyup(C)})("keydown",function(C){return t._handleCalendarBodyKeydown(C)}),j()()),l&2&&(ue(3),pr(t._weekdays),ue(4),Fe("label",t._monthLabel)("rows",t._weeks)("todayValue",t._todayDate)("startValue",t._rangeStart)("endValue",t._rangeEnd)("comparisonStart",t._comparisonRangeStart)("comparisonEnd",t._comparisonRangeEnd)("previewStart",t._previewStart)("previewEnd",t._previewEnd)("isRange",t._isRange)("labelMinRequiredCells",3)("activeCell",t._dateAdapter.getDate(t.activeDate)-1)("startDateAccessibleName",t.startDateAccessibleName)("endDateAccessibleName",t.endDateAccessibleName))},dependencies:[jm],encapsulation:2,changeDetection:0});let d=s;return d})(),wa=24,R1=4,WI=(()=>{let s=class s{get activeDate(){return this._activeDate}set activeDate(r){let l=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),YI(this._dateAdapter,l,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof $a?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedYear(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,l,t){this._changeDetectorRef=r,this._dateAdapter=l,this._dir=t,this._rerenderSubscription=fs.EMPTY,this.selectedChange=new an,this.yearSelected=new an,this.activeDateChange=new an,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(gs(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let l=this._dateAdapter.getYear(this._activeDate)-fg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let t=0,_=[];t<wa;t++)_.push(l+t),_.length==R1&&(this._years.push(_.map(C=>this._createCellForYear(C))),_=[]);this._changeDetectorRef.markForCheck()}_yearSelected(r){let l=r.value,t=this._dateAdapter.createDate(l,0,1),_=this._getDateFromYear(l);this.yearSelected.emit(t),this.selectedChange.emit(_)}_updateActiveDate(r){let l=r.value,t=this._activeDate;this.activeDate=this._getDateFromYear(l),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let l=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-R1);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,R1);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-fg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,wa-fg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-wa*10:-wa);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?wa*10:wa);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_getActiveCell(){return fg(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(r){let l=this._dateAdapter.getMonth(this.activeDate),t=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(r,l,1));return this._dateAdapter.createDate(r,l,Math.min(this._dateAdapter.getDate(this.activeDate),t))}_createCellForYear(r){let l=this._dateAdapter.createDate(r,0,1),t=this._dateAdapter.getYearName(l),_=this.dateClass?this.dateClass(l,"multi-year"):void 0;return new gg(r,t,t,this._shouldEnableYear(r),_)}_shouldEnableYear(r){if(r==null||this.maxDate&&r>this._dateAdapter.getYear(this.maxDate)||this.minDate&&r<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let l=this._dateAdapter.createDate(r,0,1);for(let t=l;this._dateAdapter.getYear(t)==r;t=this._dateAdapter.addCalendarDays(t,1))if(this.dateFilter(t))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(r){if(this._selectedYear=null,r instanceof $a){let l=r.start||r.end;l&&(this._selectedYear=this._dateAdapter.getYear(l))}else r&&(this._selectedYear=this._dateAdapter.getYear(r))}};s.\u0275fac=function(l){return new(l||s)(fe(mo),fe(Ko,8),fe(Hl,8))},s.\u0275cmp=_t({type:s,selectors:[["mat-multi-year-view"]],viewQuery:function(l,t){if(l&1&&bi(jm,5),l&2){let _;gi(_=_i())&&(t._matCalendarBody=_.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[Hn],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell"]],template:function(l,t){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Me(3,"th",2),j()(),V(4,"tbody",3),Pe("selectedValueChange",function(C){return t._yearSelected(C)})("activeDateChange",function(C){return t._updateActiveDate(C)})("keyup",function(C){return t._handleCalendarBodyKeyup(C)})("keydown",function(C){return t._handleCalendarBodyKeydown(C)}),j()()),l&2&&(ue(4),Fe("rows",t._years)("todayValue",t._todayYear)("startValue",t._selectedYear)("endValue",t._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",t._getActiveCell()))},dependencies:[jm],encapsulation:2,changeDetection:0});let d=s;return d})();function YI(d,s,u,r,l){let t=d.getYear(s),_=d.getYear(u),C=ZI(d,r,l);return Math.floor((t-C)/wa)===Math.floor((_-C)/wa)}function fg(d,s,u,r){let l=d.getYear(s);return rF(l-ZI(d,u,r),wa)}function ZI(d,s,u){let r=0;return u?r=d.getYear(u)-wa+1:s&&(r=d.getYear(s)),r}function rF(d,s){return(d%s+s)%s}var GI=(()=>{let s=class s{get activeDate(){return this._activeDate}set activeDate(r){let l=this._activeDate,t=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this._dateAdapter.getYear(l)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(r){r instanceof $a?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedMonth(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,l,t,_){this._changeDetectorRef=r,this._dateFormats=l,this._dateAdapter=t,this._dir=_,this._rerenderSubscription=fs.EMPTY,this.selectedChange=new an,this.monthSelected=new an,this.activeDateChange=new an,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(gs(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(r){let l=r.value,t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),l,1);this.monthSelected.emit(t);let _=this._getDateFromMonth(l);this.selectedChange.emit(_)}_updateActiveDate(r){let l=r.value,t=this._activeDate;this.activeDate=this._getDateFromMonth(l),this._dateAdapter.compareDate(t,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let l=this._activeDate,t=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,t?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,t?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let r=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(l=>l.map(t=>this._createCellForMonth(t,r[t]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(r){return r&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(r):null}_getDateFromMonth(r){let l=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),t=this._dateAdapter.getNumDaysInMonth(l);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,Math.min(this._dateAdapter.getDate(this.activeDate),t))}_createCellForMonth(r,l){let t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),_=this._dateAdapter.format(t,this._dateFormats.display.monthYearA11yLabel),C=this.dateClass?this.dateClass(t,"year"):void 0;return new gg(r,l.toLocaleUpperCase(),_,this._shouldEnableMonth(r),C)}_shouldEnableMonth(r){let l=this._dateAdapter.getYear(this.activeDate);if(r==null||this._isYearAndMonthAfterMaxDate(l,r)||this._isYearAndMonthBeforeMinDate(l,r))return!1;if(!this.dateFilter)return!0;let t=this._dateAdapter.createDate(l,r,1);for(let _=t;this._dateAdapter.getMonth(_)==r;_=this._dateAdapter.addCalendarDays(_,1))if(this.dateFilter(_))return!0;return!1}_isYearAndMonthAfterMaxDate(r,l){if(this.maxDate){let t=this._dateAdapter.getYear(this.maxDate),_=this._dateAdapter.getMonth(this.maxDate);return r>t||r===t&&l>_}return!1}_isYearAndMonthBeforeMinDate(r,l){if(this.minDate){let t=this._dateAdapter.getYear(this.minDate),_=this._dateAdapter.getMonth(this.minDate);return r<t||r===t&&l<_}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(r){r instanceof $a?this._selectedMonth=this._getMonthInCurrentYear(r.start)||this._getMonthInCurrentYear(r.end):this._selectedMonth=this._getMonthInCurrentYear(r)}};s.\u0275fac=function(l){return new(l||s)(fe(mo),fe(Rm,8),fe(Ko,8),fe(Hl,8))},s.\u0275cmp=_t({type:s,selectors:[["mat-year-view"]],viewQuery:function(l,t){if(l&1&&bi(jm,5),l&2){let _;gi(_=_i())&&(t._matCalendarBody=_.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[Hn],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell"]],template:function(l,t){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Me(3,"th",2),j()(),V(4,"tbody",3),Pe("selectedValueChange",function(C){return t._monthSelected(C)})("activeDateChange",function(C){return t._updateActiveDate(C)})("keyup",function(C){return t._handleCalendarBodyKeyup(C)})("keydown",function(C){return t._handleCalendarBodyKeydown(C)}),j()()),l&2&&(ue(4),Fe("label",t._yearLabel)("rows",t._months)("todayValue",t._todayMonth)("startValue",t._selectedMonth)("endValue",t._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",t._dateAdapter.getMonth(t.activeDate)))},dependencies:[jm],encapsulation:2,changeDetection:0});let d=s;return d})(),oF=1,XI=(()=>{let s=class s{constructor(r,l,t,_,C){this._intl=r,this.calendar=l,this._dateAdapter=t,this._dateFormats=_,this._id=`mat-calendar-header-${oF++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>C.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-wa)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:wa)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(r,l){return this.calendar.currentView=="month"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(l)&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(l):this.calendar.currentView=="year"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(l):YI(this._dateAdapter,r,l,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let l=this._dateAdapter.getYear(this.calendar.activeDate)-fg(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),t=l+wa-1,_=this._dateAdapter.getYearName(this._dateAdapter.createDate(l,0,1)),C=this._dateAdapter.getYearName(this._dateAdapter.createDate(t,0,1));return[_,C]}};s.\u0275fac=function(l){return new(l||s)(fe(bg),fe(X0(()=>L1)),fe(Ko,8),fe(Rm,8),fe(mo))},s.\u0275cmp=_t({type:s,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[Hn],ngContentSelectors:WL,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],[1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"click","disabled"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"click","disabled"]],template:function(l,t){l&1&&(Yo(),V(0,"div",0)(1,"div",1)(2,"label",2),$(3),j(),V(4,"button",3),Pe("click",function(){return t.currentPeriodClicked()}),V(5,"span",4),$(6),j(),cd(),V(7,"svg",5),Me(8,"polygon",6),j()(),Gx(),Me(9,"div",7),So(10),V(11,"button",8),Pe("click",function(){return t.previousClicked()}),j(),V(12,"button",9),Pe("click",function(){return t.nextClicked()}),j()()()),l&2&&(ue(2),Fe("id",t._periodButtonLabelId),ue(),Ft(t.periodButtonDescription),ue(),bn("aria-label",t.periodButtonLabel)("aria-describedby",t._periodButtonLabelId),ue(2),Ft(t.periodButtonText),ue(),Mi("mat-calendar-invert",t.calendar.currentView!=="month"),ue(4),Fe("disabled",!t.previousEnabled()),bn("aria-label",t.prevButtonLabel),ue(),Fe("disabled",!t.nextEnabled()),bn("aria-label",t.nextButtonLabel))},dependencies:[k1,I1],encapsulation:2,changeDetection:0});let d=s;return d})(),L1=(()=>{let s=class s{get startAt(){return this._startAt}set startAt(r){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get selected(){return this._selected}set selected(r){r instanceof $a?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get activeDate(){return this._clampedActiveDate}set activeDate(r){this._clampedActiveDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(r){let l=this._currentView!==r?r:null;this._currentView=r,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),l&&this.viewChanged.emit(l)}constructor(r,l,t,_){this._dateAdapter=l,this._dateFormats=t,this._changeDetectorRef=_,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new an,this.yearSelected=new an,this.monthSelected=new an,this.viewChanged=new an(!0),this._userSelection=new an,this._userDragDrop=new an,this._activeDrag=null,this.stateChanges=new En,this._intlChanges=r.changes.subscribe(()=>{_.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new gd(this.headerComponent||XI),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(r){let l=r.minDate&&!this._dateAdapter.sameDate(r.minDate.previousValue,r.minDate.currentValue)?r.minDate:void 0,t=r.maxDate&&!this._dateAdapter.sameDate(r.maxDate.previousValue,r.maxDate.currentValue)?r.maxDate:void 0,_=l||t||r.dateFilter;if(_&&!_.firstChange){let C=this._getCurrentViewComponent();C&&(this._changeDetectorRef.detectChanges(),C._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(r){let l=r.value;(this.selected instanceof $a||l&&!this._dateAdapter.sameDate(l,this.selected))&&this.selectedChange.emit(l),this._userSelection.emit(r)}_yearSelectedInMultiYearView(r){this.yearSelected.emit(r)}_monthSelectedInYearView(r){this.monthSelected.emit(r)}_goToDateInView(r,l){this.activeDate=r,this.currentView=l}_dragStarted(r){this._activeDrag=r}_dragEnded(r){this._activeDrag&&(r.value&&this._userDragDrop.emit(r),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};s.\u0275fac=function(l){return new(l||s)(fe(bg),fe(Ko,8),fe(Rm,8),fe(mo))},s.\u0275cmp=_t({type:s,selectors:[["mat-calendar"]],viewQuery:function(l,t){if(l&1&&(bi(HI,5),bi(GI,5),bi(WI,5)),l&2){let _;gi(_=_i())&&(t.monthView=_.first),gi(_=_i())&&(t.yearView=_.first),gi(_=_i())&&(t.multiYearView=_.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[ys([nF]),wo,Hn],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDateChange","_userSelection","dragStarted","dragEnded","activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag"],[3,"activeDateChange","monthSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"],[3,"activeDateChange","yearSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"]],template:function(l,t){if(l&1&&(Bt(0,GL,0,0,"ng-template",0),V(1,"div",1),Bt(2,qL,1,11)(3,$L,1,6)(4,YL,1,6),j()),l&2){let _;Fe("cdkPortalOutlet",t._calendarHeaderPortal),ue(2),Dn(2,(_=t.currentView)==="month"?2:_==="year"?3:_==="multi-year"?4:-1)}},dependencies:[_d,sI,HI,GI,WI],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let d=s;return d})(),qI={transformPanel:Kx("transformPanel",[ag("void => enter-dropdown",og("120ms cubic-bezier(0, 0, 0.2, 1)",e1([md({opacity:0,transform:"scale(1, 0.8)"}),md({opacity:1,transform:"scale(1, 1)"})]))),ag("void => enter-dialog",og("150ms cubic-bezier(0, 0, 0.2, 1)",e1([md({opacity:0,transform:"scale(0.7)"}),md({transform:"none",opacity:1})]))),ag("* => void",og("100ms linear",md({opacity:0})))]),fadeInCalendar:Kx("fadeInCalendar",[Jx("void",md({opacity:0})),Jx("enter",md({opacity:1})),ag("void => *",og("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};var aF=new fn("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let d=wn(Jo);return()=>d.scrollStrategies.reposition()}});function sF(d){return()=>d.scrollStrategies.reposition()}var lF={provide:aF,deps:[Jo],useFactory:sF},cF=(()=>{let s=class s{constructor(r,l,t,_,C,I){this._elementRef=r,this._changeDetectorRef=l,this._globalModel=t,this._dateAdapter=_,this._rangeSelectionStrategy=C,this._subscriptions=new fs,this._animationDone=new En,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=I.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(r){let l=this._model.selection,t=r.value,_=l instanceof $a;if(_&&this._rangeSelectionStrategy){let C=this._rangeSelectionStrategy.selectionFinished(t,l,r.event);this._model.updateSelection(C,this)}else t&&(_||!this._dateAdapter.sameDate(t,l))&&this._model.add(t);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(r){this._model.updateSelection(r.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(r){this._isAnimating=r.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(r,l){this._model=r?this._globalModel.clone():this._globalModel,this._actionsPortal=r,l&&this._changeDetectorRef.detectChanges()}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe(mo),fe(Tb),fe(Ko),fe($I,8),fe(bg))},s.\u0275cmp=_t({type:s,selectors:[["mat-datepicker-content"]],viewQuery:function(l,t){if(l&1&&bi(L1,5),l&2){let _;gi(_=_i())&&(t._calendar=_.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(l,t){l&1&&mk("@transformPanel.start",function(C){return t._handleAnimationEvent(C)})("@transformPanel.done",function(C){return t._handleAnimationEvent(C)}),l&2&&(uk("@transformPanel",t._animationState),bs(t.color?"mat-"+t.color:""),Mi("mat-datepicker-content-touch",t.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[Hn],decls:5,vars:27,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop","id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"focus","blur","click","color"]],template:function(l,t){if(l&1&&(V(0,"div",0)(1,"mat-calendar",1),Pe("yearSelected",function(C){return t.datepicker._selectYear(C)})("monthSelected",function(C){return t.datepicker._selectMonth(C)})("viewChanged",function(C){return t.datepicker._viewChanged(C)})("_userSelection",function(C){return t._handleUserSelection(C)})("_userDragDrop",function(C){return t._handleUserDragDrop(C)}),j(),Bt(2,ZL,0,0,"ng-template",2),V(3,"button",3),Pe("focus",function(){return t._closeButtonFocused=!0})("blur",function(){return t._closeButtonFocused=!1})("click",function(){return t.datepicker.close()}),$(4),j()()),l&2){let _;Mi("mat-datepicker-content-container-with-custom-header",t.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",t._actionsPortal),bn("aria-modal",!0)("aria-labelledby",(_=t._dialogLabelId)!==null&&_!==void 0?_:void 0),ue(),bs(t.datepicker.panelClass),Fe("id",t.datepicker.id)("startAt",t.datepicker.startAt)("startView",t.datepicker.startView)("minDate",t.datepicker._getMinDate())("maxDate",t.datepicker._getMaxDate())("dateFilter",t.datepicker._getDateFilter())("headerComponent",t.datepicker.calendarHeaderComponent)("selected",t._getSelected())("dateClass",t.datepicker.dateClass)("comparisonStart",t.comparisonStart)("comparisonEnd",t.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",t.startDateAccessibleName)("endDateAccessibleName",t.endDateAccessibleName),ue(),Fe("cdkPortalOutlet",t._actionsPortal),ue(),Mi("cdk-visually-hidden",!t._closeButtonFocused),Fe("color",t.color||"primary"),ue(),Ft(t._closeButtonText)}},dependencies:[oI,L1,_d,k1],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[qI.transformPanel,qI.fadeInCalendar]},changeDetection:0});let d=s;return d})();var dF=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275dir=tr({type:s,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let d=s;return d})(),hF=(()=>{let s=class s{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(r){this._disabled=r}constructor(r,l,t){this._intl=r,this._changeDetectorRef=l,this._stateChanges=fs.EMPTY;let _=Number(t);this.tabIndex=_||_===0?_:null}ngOnChanges(r){r.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(r){this.datepicker&&!this.disabled&&(this.datepicker.open(),r.stopPropagation())}_watchStateChanges(){let r=this.datepicker?this.datepicker.stateChanges:sr(),l=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:sr(),t=this.datepicker?Nh(this.datepicker.openedStream,this.datepicker.closedStream):sr();this._stateChanges.unsubscribe(),this._stateChanges=Nh(this._intl.changes,r,l,t).subscribe(()=>this._changeDetectorRef.markForCheck())}};s.\u0275fac=function(l){return new(l||s)(fe(bg),fe(mo),Mm("tabindex"))},s.\u0275cmp=_t({type:s,selectors:[["mat-datepicker-toggle"]],contentQueries:function(l,t,_){if(l&1&&eb(_,dF,5),l&2){let C;gi(C=_i())&&(t._customIcon=C.first)}},viewQuery:function(l,t){if(l&1&&bi(XL,5),l&2){let _;gi(_=_i())&&(t._button=_.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(l,t){l&1&&Pe("click",function(C){return t._open(C)}),l&2&&(bn("tabindex",null)("data-mat-calendar",t.datepicker?t.datepicker.id:null),Mi("mat-datepicker-toggle-active",t.datepicker&&t.datepicker.opened)("mat-accent",t.datepicker&&t.datepicker.color==="accent")("mat-warn",t.datepicker&&t.datepicker.color==="warn"))},inputs:{datepicker:[Zi.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[Zi.None,"aria-label","ariaLabel"],disabled:[Zi.HasDecoratorInputTransform,"disabled","disabled",no],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[Co,wo,Hn],ngContentSelectors:KL,decls:4,vars:6,consts:[["button",""],["mat-icon-button","","type","button",3,"disabled","disableRipple"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(l,t){l&1&&(Yo(QL),V(0,"button",1,0),Bt(2,JL,2,0,":svg:svg",2),So(3),j()),l&2&&(Fe("disabled",t.disabled)("disableRipple",t.disableRipple),bn("aria-haspopup",t.datepicker?"dialog":null)("aria-label",t.ariaLabel||t._intl.openCalendarLabel)("tabindex",t.disabled?-1:t.tabIndex),ue(2),Dn(2,t._customIcon?-1:2))},dependencies:[I1],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let d=s;return d})();var QI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({providers:[bg,lF],imports:[Zs,VI,Bm,bb,Wl,Vn,cF,hF,XI,Cb]});let d=s;return d})();function uF(d,s){}var Zh=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var G1=(()=>{let s=class s extends Lm{constructor(r,l,t,_,C,I,O,N){super(),this._elementRef=r,this._focusTrapFactory=l,this._config=_,this._interactivityChecker=C,this._ngZone=I,this._overlayRef=O,this._focusMonitor=N,this._platform=wn($n),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=wn(mo),this.attachDomPortal=q=>{this._portalOutlet.hasAttached();let ie=this._portalOutlet.attachDomPortal(q);return this._contentAttached(),ie},this._document=t,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(r){this._ariaLabelledByQueue.push(r),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(r){let l=this._ariaLabelledByQueue.indexOf(r);l>-1&&(this._ariaLabelledByQueue.splice(l,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(r){this._portalOutlet.hasAttached();let l=this._portalOutlet.attachComponentPortal(r);return this._contentAttached(),l}attachTemplatePortal(r){this._portalOutlet.hasAttached();let l=this._portalOutlet.attachTemplatePortal(r);return this._contentAttached(),l}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(r,l){this._interactivityChecker.isFocusable(r)||(r.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let t=()=>{r.removeEventListener("blur",t),r.removeEventListener("mousedown",t),r.removeAttribute("tabindex")};r.addEventListener("blur",t),r.addEventListener("mousedown",t)})),r.focus(l)}_focusByCssSelector(r,l){let t=this._elementRef.nativeElement.querySelector(r);t&&this._forceFocus(t,l)}_trapFocus(){let r=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||r.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(l=>{l||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let r=this._config.restoreFocus,l=null;if(typeof r=="string"?l=this._document.querySelector(r):typeof r=="boolean"?l=r?this._elementFocusedBeforeDialogWasOpened:null:r&&(l=r),this._config.restoreFocus&&l&&typeof l.focus=="function"){let t=Wh(),_=this._elementRef.nativeElement;(!t||t===this._document.body||t===_||_.contains(t))&&(this._focusMonitor?(this._focusMonitor.focusVia(l,this._closeInteractionType),this._closeInteractionType=null):l.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let r=this._elementRef.nativeElement,l=Wh();return r===l||r.contains(l)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Wh()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe(ug),fe(mn,8),fe(Zh),fe(hg),fe(zi),fe(Gl),fe(Ul))},s.\u0275cmp=_t({type:s,selectors:[["cdk-dialog-container"]],viewQuery:function(l,t){if(l&1&&bi(_d,7),l&2){let _;gi(_=_i())&&(t._portalOutlet=_.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(l,t){l&2&&bn("id",t._config.id||null)("role",t._config.role)("aria-modal",t._config.ariaModal)("aria-labelledby",t._config.ariaLabel?null:t._ariaLabelledByQueue[0])("aria-label",t._config.ariaLabel)("aria-describedby",t._config.ariaDescribedBy||null)},standalone:!0,features:[Fo,Hn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(l,t){l&1&&Bt(0,uF,0,0,"ng-template",0)},dependencies:[_d],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let d=s;return d})(),yg=class{constructor(s,u){this.overlayRef=s,this.config=u,this.closed=new En,this.disableClose=u.disableClose,this.backdropClick=s.backdropClick(),this.keydownEvents=s.keydownEvents(),this.outsidePointerEvents=s.outsidePointerEvents(),this.id=u.id,this.keydownEvents.subscribe(r=>{r.keyCode===27&&!this.disableClose&&!Am(r)&&(r.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=s.detachments().subscribe(()=>{u.closeOnOverlayDetachments!==!1&&this.close()})}close(s,u){if(this.containerInstance){let r=this.closed;this.containerInstance._closeInteractionType=u?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),r.next(s),r.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(s="",u=""){return this.overlayRef.updateSize({width:s,height:u}),this}addPanelClass(s){return this.overlayRef.addPanelClass(s),this}removePanelClass(s){return this.overlayRef.removePanelClass(s),this}},mF=new fn("DialogScrollStrategy",{providedIn:"root",factory:()=>{let d=wn(Jo);return()=>d.scrollStrategies.block()}}),pF=new fn("DialogData"),fF=new fn("DefaultDialogConfig");var gF=0,q1=(()=>{let s=class s{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(r,l,t,_,C,I){this._overlay=r,this._injector=l,this._defaultOptions=t,this._parentDialog=_,this._overlayContainer=C,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new En,this._afterOpenedAtThisLevel=new En,this._ariaHiddenElements=new Map,this.afterAllClosed=Y0(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(gs(void 0))),this._scrollStrategy=I}open(r,l){let t=this._defaultOptions||new Zh;l=Ji(Ji({},t),l),l.id=l.id||`cdk-dialog-${gF++}`,l.id&&this.getDialogById(l.id);let _=this._getOverlayConfig(l),C=this._overlay.create(_),I=new yg(C,l),O=this._attachContainer(C,I,l);return I.containerInstance=O,this._attachDialogContent(r,I,O,l),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(I),I.closed.subscribe(()=>this._removeOpenDialog(I,!0)),this.afterOpened.next(I),I}closeAll(){W1(this.openDialogs,r=>r.close())}getDialogById(r){return this.openDialogs.find(l=>l.id===r)}ngOnDestroy(){W1(this._openDialogsAtThisLevel,r=>{r.config.closeOnDestroy===!1&&this._removeOpenDialog(r,!1)}),W1(this._openDialogsAtThisLevel,r=>r.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(r){let l=new Fm({positionStrategy:r.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:r.scrollStrategy||this._scrollStrategy(),panelClass:r.panelClass,hasBackdrop:r.hasBackdrop,direction:r.direction,minWidth:r.minWidth,minHeight:r.minHeight,maxWidth:r.maxWidth,maxHeight:r.maxHeight,width:r.width,height:r.height,disposeOnNavigation:r.closeOnNavigation});return r.backdropClass&&(l.backdropClass=r.backdropClass),l}_attachContainer(r,l,t){let _=t.injector||t.viewContainerRef?.injector,C=[{provide:Zh,useValue:t},{provide:yg,useValue:l},{provide:Gl,useValue:r}],I;t.container?typeof t.container=="function"?I=t.container:(I=t.container.type,C.push(...t.container.providers(t))):I=G1;let O=new gd(I,t.viewContainerRef,Ha.create({parent:_||this._injector,providers:C}),t.componentFactoryResolver);return r.attach(O).instance}_attachDialogContent(r,l,t,_){if(r instanceof Uh){let C=this._createInjector(_,l,t,void 0),I={$implicit:_.data,dialogRef:l};_.templateContext&&(I=Ji(Ji({},I),typeof _.templateContext=="function"?_.templateContext():_.templateContext)),t.attachTemplatePortal(new $h(r,null,I,C))}else{let C=this._createInjector(_,l,t,this._injector),I=t.attachComponentPortal(new gd(r,_.viewContainerRef,C,_.componentFactoryResolver));l.componentRef=I,l.componentInstance=I.instance}}_createInjector(r,l,t,_){let C=r.injector||r.viewContainerRef?.injector,I=[{provide:pF,useValue:r.data},{provide:yg,useValue:l}];return r.providers&&(typeof r.providers=="function"?I.push(...r.providers(l,r,t)):I.push(...r.providers)),r.direction&&(!C||!C.get(Hl,null,{optional:!0}))&&I.push({provide:Hl,useValue:{value:r.direction,change:sr()}}),Ha.create({parent:C||_,providers:I})}_removeOpenDialog(r,l){let t=this.openDialogs.indexOf(r);t>-1&&(this.openDialogs.splice(t,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((_,C)=>{_?C.setAttribute("aria-hidden",_):C.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),l&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let r=this._overlayContainer.getContainerElement();if(r.parentElement){let l=r.parentElement.children;for(let t=l.length-1;t>-1;t--){let _=l[t];_!==r&&_.nodeName!=="SCRIPT"&&_.nodeName!=="STYLE"&&!_.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(_,_.getAttribute("aria-hidden")),_.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}};s.\u0275fac=function(l){return new(l||s)(st(Jo),st(Ha),st(fF,8),st(s,12),st(zm),st(mF))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function W1(d,s){let u=d.length;for(;u--;)s(d[u])}var KI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({providers:[q1],imports:[Bm,Wl,bb,Wl]});let d=s;return d})();function _F(d,s){}var vg=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},$1="mdc-dialog--open",JI="mdc-dialog--opening",eT="mdc-dialog--closing",bF=150,yF=75,vF=(()=>{let s=class s extends G1{constructor(r,l,t,_,C,I,O,N,q){super(r,l,t,_,C,I,O,q),this._animationMode=N,this._animationStateChanged=new an,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?iT(this._config.enterAnimationDuration)??bF:0,this._exitAnimationDuration=this._animationsEnabled?iT(this._config.exitAnimationDuration)??yF:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(tT,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(JI,$1)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add($1),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove($1),this._animationsEnabled?(this._hostElement.style.setProperty(tT,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(eT)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(r){this._actionSectionCount+=r,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(JI,eT)}_waitForAnimationToComplete(r,l){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(l,r)}_requestAnimationFrame(r){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(r):r()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(r){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:r})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(r){let l=super.attachComponentPortal(r);return l.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),l}};s.\u0275fac=function(l){return new(l||s)(fe(ln),fe(ug),fe(mn,8),fe(vg),fe(hg),fe(zi),fe(Gl),fe(io,8),fe(Ul))},s.\u0275cmp=_t({type:s,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(l,t){l&2&&(Vl("id",t._config.id),bn("aria-modal",t._config.ariaModal)("role",t._config.role)("aria-labelledby",t._config.ariaLabel?null:t._ariaLabelledByQueue[0])("aria-label",t._config.ariaLabel)("aria-describedby",t._config.ariaDescribedBy||null),Mi("_mat-animation-noopable",!t._animationsEnabled)("mat-mdc-dialog-container-with-actions",t._actionSectionCount>0))},standalone:!0,features:[Fo,Hn],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),Bt(2,_F,0,0,"ng-template",2),j()())},dependencies:[_d],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let d=s;return d})(),tT="--mat-dialog-transition-duration";function iT(d){return d==null?null:typeof d=="number"?d:d.endsWith("ms")?dg(d.substring(0,d.length-2)):d.endsWith("s")?dg(d.substring(0,d.length-1))*1e3:d==="0"?0:null}var Eb=function(d){return d[d.OPEN=0]="OPEN",d[d.CLOSING=1]="CLOSING",d[d.CLOSED=2]="CLOSED",d}(Eb||{}),Um=class{constructor(s,u,r){this._ref=s,this._containerInstance=r,this._afterOpened=new En,this._beforeClosed=new En,this._state=Eb.OPEN,this.disableClose=u.disableClose,this.id=s.id,s.addPanelClass("mat-mdc-dialog-panel"),r._animationStateChanged.pipe(ya(l=>l.state==="opened"),Ua(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),r._animationStateChanged.pipe(ya(l=>l.state==="closed"),Ua(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),s.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Nh(this.backdropClick(),this.keydownEvents().pipe(ya(l=>l.keyCode===27&&!this.disableClose&&!Am(l)))).subscribe(l=>{this.disableClose||(l.preventDefault(),xF(this,l.type==="keydown"?"keyboard":"mouse"))})}close(s){this._result=s,this._containerInstance._animationStateChanged.pipe(ya(u=>u.state==="closing"),Ua(1)).subscribe(u=>{this._beforeClosed.next(s),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),u.totalTime+100)}),this._state=Eb.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(s){let u=this._ref.config.positionStrategy;return s&&(s.left||s.right)?s.left?u.left(s.left):u.right(s.right):u.centerHorizontally(),s&&(s.top||s.bottom)?s.top?u.top(s.top):u.bottom(s.bottom):u.centerVertically(),this._ref.updatePosition(),this}updateSize(s="",u=""){return this._ref.updateSize(s,u),this}addPanelClass(s){return this._ref.addPanelClass(s),this}removePanelClass(s){return this._ref.removePanelClass(s),this}getState(){return this._state}_finishDialogClose(){this._state=Eb.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function xF(d,s,u){return d._closeInteractionType=s,d.close(u)}var Y1=new fn("MatMdcDialogData"),wF=new fn("mat-mdc-dialog-default-options"),CF=new fn("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let d=wn(Jo);return()=>d.scrollStrategies.block()}});var SF=0,Hm=(()=>{let s=class s{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(r,l,t,_,C,I,O,N){this._overlay=r,this._defaultOptions=_,this._scrollStrategy=C,this._parentDialog=I,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new En,this._afterOpenedAtThisLevel=new En,this.dialogConfigClass=vg,this.afterAllClosed=Y0(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(gs(void 0))),this._dialog=l.get(q1),this._dialogRefConstructor=Um,this._dialogContainerType=vF,this._dialogDataToken=Y1}open(r,l){let t;l=Ji(Ji({},this._defaultOptions||new vg),l),l.id=l.id||`mat-mdc-dialog-${SF++}`,l.scrollStrategy=l.scrollStrategy||this._scrollStrategy();let _=this._dialog.open(r,ja(Ji({},l),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:l},{provide:Zh,useValue:l}]},templateContext:()=>({dialogRef:t}),providers:(C,I,O)=>(t=new this._dialogRefConstructor(C,l,O),t.updatePosition(l?.position),[{provide:this._dialogContainerType,useValue:O},{provide:this._dialogDataToken,useValue:I.data},{provide:this._dialogRefConstructor,useValue:t}])}));return t.componentRef=_.componentRef,t.componentInstance=_.componentInstance,this.openDialogs.push(t),this.afterOpened.next(t),t.afterClosed().subscribe(()=>{let C=this.openDialogs.indexOf(t);C>-1&&(this.openDialogs.splice(C,1),this.openDialogs.length||this._getAfterAllClosed().next())}),t}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(r){return this.openDialogs.find(l=>l.id===r)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(r){let l=r.length;for(;l--;)r[l].close()}};s.\u0275fac=function(l){return new(l||s)(st(Jo),st(Ha),st(ii,8),st(wF,8),st(CF),st(s,12),st(zm),st(io,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),MF=0;var nT=(()=>{let s=class s{constructor(r,l,t){this._dialogRef=r,this._elementRef=l,this._dialog=t}ngOnInit(){this._dialogRef||(this._dialogRef=kF(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}};s.\u0275fac=function(l){return new(l||s)(fe(Um,8),fe(ln),fe(Hm))},s.\u0275dir=tr({type:s,standalone:!0});let d=s;return d})(),rT=(()=>{let s=class s extends nT{constructor(){super(...arguments),this.id=`mat-mdc-dialog-title-${MF++}`}_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}};s.\u0275fac=(()=>{let r;return function(t){return(r||(r=Sm(s)))(t||s)}})(),s.\u0275dir=tr({type:s,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(l,t){l&2&&Vl("id",t.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],standalone:!0,features:[Fo]});let d=s;return d})(),oT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275dir=tr({type:s,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],standalone:!0});let d=s;return d})(),aT=(()=>{let s=class s extends nT{_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}};s.\u0275fac=(()=>{let r;return function(t){return(r||(r=Sm(s)))(t||s)}})(),s.\u0275dir=tr({type:s,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(l,t){l&2&&Mi("mat-mdc-dialog-actions-align-start",t.align==="start")("mat-mdc-dialog-actions-align-center",t.align==="center")("mat-mdc-dialog-actions-align-end",t.align==="end")},inputs:{align:"align"},standalone:!0,features:[Fo]});let d=s;return d})();function kF(d,s){let u=d.nativeElement.parentElement;for(;u&&!u.classList.contains("mat-mdc-dialog-container");)u=u.parentElement;return u?s.find(r=>r.id===u.id):null}var sT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({providers:[Hm],imports:[KI,Bm,Wl,Vn,Vn]});let d=s;return d})();var yn="https://appsvc-apibackend-dev.azurewebsites.net/v1.0/";var ql=pd("PushNotifications",{});var IF="firebase",TF="10.12.4";Gk(IF,TF,"app");var xg=new Zx("ANGULARFIRE2_VERSION");var Db=class{zone;delegate;constructor(s,u=JM){this.zone=s,this.delegate=u}now(){return this.delegate.now()}schedule(s,u,r){let l=this.zone,t=function(_){l.runGuarded(()=>{s.apply(this,[_])})};return this.delegate.schedule(t,u,r)}};var lT=(()=>{class d{ngZone;outsideAngular;insideAngular;constructor(u){this.ngZone=u,this.outsideAngular=u.runOutsideAngular(()=>new Db(Zone.current)),this.insideAngular=u.run(()=>new Db(Zone.current,KM)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||d)(st(zi))};static \u0275prov=Ut({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})();var DF="firebase",AF="10.12.4";vs.registerVersion(DF,AF,"app-compat");var PF=["ngOnDestroy"],dT=(d,s,u,r={})=>new Proxy(d,{get:(l,t)=>u.runOutsideAngular(()=>{if(d[t])return r?.spy?.get&&r.spy.get(t,d[t]),d[t];if(PF.indexOf(t)>-1)return()=>{};let _=s.toPromise().then(C=>{let I=C?.[t];return typeof I=="function"?I.bind(C):I?.then?I.then(O=>u.run(()=>O)):u.run(()=>I)});return new Proxy(()=>{},{get:(C,I)=>_[I],apply:(C,I,O)=>_.then(N=>{let q=N?.(...O);return r?.spy?.apply&&r.spy.apply(t,O,q),q})})})});var Ab=class{constructor(s){return s}},Pb=new fn("angularfire2.app.options"),Ob=new fn("angularfire2.app.name");function X1(d,s,u){let r=typeof u=="string"&&u||"[DEFAULT]",l=typeof u=="object"&&u||{};l.name=l.name||r;let _=vs.apps.filter(C=>C&&C.name===l.name)[0]||s.runOutsideAngular(()=>vs.initializeApp(d,l));try{if(JSON.stringify(d)!==JSON.stringify(_.options)){let C=!!module.hot;OF("error",`${_.name} Firebase App already initialized with different options${C?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Ab(_)}var OF=(d,...s)=>{Xx()&&typeof console<"u"&&console[d](...s)},RF={provide:Ab,useFactory:X1,deps:[Pb,zi,[new Q0,Ob]]},hT=(()=>{class d{static initializeApp(u,r){return{ngModule:d,providers:[{provide:Pb,useValue:u},{provide:Ob,useValue:r}]}}constructor(u){vs.registerVersion("angularfire",xg.full,"core"),vs.registerVersion("angularfire",xg.full,"app-compat"),vs.registerVersion("angular",yk.full,u.toString())}static \u0275fac=function(r){return new(r||d)(st(dd))};static \u0275mod=mi({type:d});static \u0275inj=ui({providers:[RF]})}return d})();function uT(d,s,u,r,l){let[,t,_]=globalThis.\u0275AngularfireInstanceCache.find(C=>C[0]===d)||[];if(t)return LF(l,_)||(cT("error",`${s} was already initialized on the ${u} Firebase App with different settings.${FF?" You may need to reload as Firebase is not HMR aware.":""}`),cT("warn",{is:l,was:_})),t;{let C=r();return globalThis.\u0275AngularfireInstanceCache.push([d,C,l]),C}}function LF(d,s){try{return d.toString()===s.toString()}catch{return d===s}}var FF=typeof module<"u"&&!!module.hot,cT=(d,...s)=>{Xx()&&typeof console<"u"&&console[d](...s)};globalThis.\u0275AngularfireInstanceCache||=[];var zF=new fn("angularfire2.messaging.vapid-key"),BF=new fn("angularfire2.messaging.service-worker-registeration"),Q1=(()=>{class d{requestPermission;getToken;tokenChanges;messages;requestToken;deleteToken;constructor(u,r,l,t,_,C,I){let O=I,N=sr(void 0).pipe(Nl(_.outsideAngular),Bl(_.insideAngular),_s(qk),_s(de=>de?import("./chunk-WCJOXY6X.js"):ek),Cm(()=>X1(u,t,r)),_s(de=>uT(`${de.name}.messaging`,"AngularFireMessaging",de.name,()=>sr(de.messaging()),[])),Hx({bufferSize:1,refCount:!1}));this.requestPermission=N.pipe(Nl(_.outsideAngular),Bl(_.insideAngular),_s(()=>Notification.requestPermission())),this.getToken=N.pipe(Nl(_.outsideAngular),Bl(_.insideAngular),_s(de=>Ln(this,null,function*(){if(Notification.permission==="granted"){let xe=O?yield O:null;return yield de.getToken({vapidKey:C,serviceWorkerRegistration:xe})}else return null})));let q=new uo(de=>{navigator.permissions.query({name:"notifications"}).then(xe=>{xe.onchange=()=>de.next()})}),ie=N.pipe(Nl(_.outsideAngular),Bl(_.insideAngular),Wx(q),Wx(this.getToken));return this.tokenChanges=N.pipe(Nl(_.outsideAngular),Bl(_.insideAngular),_s(()=>$0(this.getToken,ie))),this.messages=N.pipe(Nl(_.outsideAngular),Bl(_.insideAngular),_s(de=>new uo(xe=>de.onMessage(xe)))),this.requestToken=N.pipe(Nl(_.outsideAngular),Bl(_.insideAngular),_s(()=>this.requestPermission),Vh(()=>sr(null)),nk(()=>this.tokenChanges)),this.deleteToken=()=>N.pipe(Nl(_.outsideAngular),Bl(_.insideAngular),_s(de=>de.deleteToken()),ok(!1)),dT(this,N,t)}static \u0275fac=function(r){return new(r||d)(st(Pb),st(Ob,8),st(dd),st(zi),st(lT),st(zF,8),st(BF,8))};static \u0275prov=Ut({token:d,factory:d.\u0275fac,providedIn:"any"})}return d})(),mT=(()=>{class d{constructor(){vs.registerVersion("angularfire",xg.full,"fcm-compat")}static \u0275fac=function(r){return new(r||d)};static \u0275mod=mi({type:d});static \u0275inj=ui({providers:[Q1]})}return d})();var Wm=(()=>{let s=class s{constructor(r,l,t,_){this.afMessaging=r,this.http=l,this.router=t,this.location=_,this.orderId=null,this.apiUrl=yn,this.listenForMessages()}requestPermission(){Hk.isNativePlatform()?ql.requestPermissions().then(r=>{r.receive==="granted"&&(ql.register(),ql.addListener("registration",l=>{console.log("Push registration success, token: "+l.value),this.token=l.value,this.sendTokenToBackend(l.value)}),ql.addListener("pushNotificationReceived",l=>{this.handleInAppNotification(l),console.log("Push received: ",l)}),ql.addListener("pushNotificationActionPerformed",l=>{console.log("Push action performed: ",l),this.handleNotificationClick(l)}))}):this.afMessaging.requestToken.subscribe({next:r=>{console.log("FCM token:",r),this.token=r,this.sendTokenToBackend(r)},error:r=>{console.error("Error getting token",r)}})}listenForMessages(){this.afMessaging.messages.subscribe(r=>{console.log(r);let l=r.notification?.title,t=r.data?.orderId;l==="New Order"&&t&&this.router.navigate(["getOrder",t],{replaceUrl:!0}).then(()=>{this.location.replaceState("home")})},r=>{console.log(r)})}sendTokenToBackend(r){alert(r);let l=this.apiUrl+"providers/provider-token",t={providerId:localStorage.getItem("providerId"),token:r};alert(t.providerId),alert(t.token),this.http.post(l,t).subscribe({next:_=>{console.log(_),alert("token send sucessfully")},error:_=>{console.log(_),alert("error"),alert(_.error.message)}})}handleInAppNotification(r){alert("inapp notification");let l=r.notification?.title||r.title,t=r.notification?.body||r.body,_=r.data;l&&t&&(alert(l),l==="New Order"&&(alert(_.orderId),setTimeout(()=>{this.router.navigate(["getOrder",_.orderId]).then(()=>{this.location.replaceState("home")})},3e3)))}handleNotificationClick(r){let l=r.data?.orderId,t=r.notification?.title,_=r.notification?.body;t&&t==="New Order"&&(alert("inside nav"),setTimeout(()=>{alert(l),this.router.navigate(["getOrder",l])},3e3))}setOrderId(r){this.orderId=r}getOrderId(){return this.orderId}clearOrderId(){this.orderId=null}};s.\u0275fac=function(l){return new(l||s)(st(Q1),st(Wi),st(Nt),st(ii))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var pT=(()=>{let s=class s{constructor(r,l){this.router=r,this.getOrderService=l,this.getOrderService.getOrderId()?this.router.navigate(["getOrder",this.getOrderService.getOrderId]):setTimeout(()=>{this.router.navigate(["started"])},4e3)}};s.\u0275fac=function(l){return new(l||s)(fe(Nt),fe(Wm))},s.\u0275cmp=_t({type:s,selectors:[["app-landing-page"]],decls:3,vars:0,consts:[["gifElement",""],[1,"container"],["src","assets/new/ti.gif","alt","Loading...",1,"gif-loader"]],template:function(l,t){l&1&&(V(0,"div",1),Me(1,"img",2,0),j())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}"]});let d=s;return d})();var fT=(()=>{let s=class s{constructor(r){this.location=r}ngAfterViewInit(){this.loadGoogleTranslateScript()}loadGoogleTranslateScript(){if(!document.getElementById("google-translate-script")){let l=document.createElement("script");l.type="text/javascript",l.src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit",l.id="google-translate-script",document.body.appendChild(l)}}navToBack(){this.location.back()}};s.\u0275fac=function(l){return new(l||s)(fe(ii))},s.\u0275cmp=_t({type:s,selectors:[["app-language"]],decls:8,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittlee"],[1,"material-symbols-outlined","notranslate",3,"click"],["id","google_translate_element",1,"trans"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2)(3,"span",3),Pe("click",function(){return t.navToBack()}),$(4," keyboard_backspace "),j(),V(5,"span"),$(6,"Select Language"),j()(),Me(7,"div",4),j()())},styles:['.goog-te-banner-frame.skiptranslate[_ngcontent-%COMP%]{display:none!important}body[_ngcontent-%COMP%]{top:0!important}.goog-logo-link[_ngcontent-%COMP%]{display:none!important}.goog-te-gadget[_ngcontent-%COMP%]{font-size:0}select[_ngcontent-%COMP%]{padding:8px;font-size:16px;border-radius:4px;border:1px solid #ccc;margin-top:10px}.container[_ngcontent-%COMP%]{width:100%;height:100vh;margin-bottom:1rem}.sub-container[_ngcontent-%COMP%]{width:95%;position:relative;top:3%;left:2.5%;display:flex;flex-direction:column;gap:2rem;padding-bottom:3rem}.tittlee[_ngcontent-%COMP%]{display:flex;text-align:center;align-items:center;gap:10px}.tittlee[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.2rem;font-family:"Roboto" sans-serif;font-weight:500}.trans[_ngcontent-%COMP%]   .goog-te-combo[_ngcontent-%COMP%]{width:100%;height:2rem;margin:0;border:1px solid rgb(208,32,32)}']});let d=s;return d})();var gT=(()=>{let s=class s{constructor(r){this.http=r,this.apiUrl=yn,this.api=this.apiUrl+"providers/provider-auth/signup"}setLog(r){console.log(r);let l={phone:r};console.log(l),this.http.post(this.api,l).subscribe(t=>{console.log(t)},t=>{console.log(t)})}setDefult(){this.api="",this.apiUrl=""}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Rb=(()=>{let s=class s{constructor(r,l){this.dialogRef=r,this.data=l,this.content="",this.content=l.content,setTimeout(()=>{this.onNoClick()},3e3)}onNoClick(){this.dialogRef.close()}};s.\u0275fac=function(l){return new(l||s)(fe(Um),fe(Y1))},s.\u0275cmp=_t({type:s,selectors:[["app-demo"]],inputs:{content:"content"},decls:3,vars:1,consts:[[1,"mat-dialog-container","bottom-dialog-container"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"p"),$(2),j()()),l&2&&(ue(2),Ft(t.content))},styles:[".mat-dialog-container[_ngcontent-%COMP%]{position:fixed;bottom:2rem;left:5%;width:90%;height:auto;border-radius:16px;color:#fff;background-color:#0d0c0cad;padding:8px;display:flex;align-items:center;justify-content:center}"]});let d=s;return d})();var zn=(()=>{let s=class s{constructor(r){this.dialog=r}openDialog(r){let l={content:r};this.dialog.open(Rb,{width:"100%",height:"auto",panelClass:"bottom-dialog-container",data:l})}};s.\u0275fac=function(l){return new(l||s)(st(Hm))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Wn=(()=>{let s=class s{constructor(r,l,t){this.http=r,this.router=l,this.dialogService=t,this.apiUrl=yn,this.userDetails=[],this.workDetails=[],this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.name="",this.experience=0,this.selectedSubCategories="",this.selectedServiceId=[],this.userFromServer=[]}setLogInApi(){this.api=this.apiUrl+"providers/provider-auth/login",console.log(this.api)}setSignUpApi(){this.api=this.apiUrl+"providers/provider-auth/signup",console.log(this.api)}setLog(r){console.log(r),console.log(this.api);let l={phone:r};console.log(l),this.http.post(this.api,l).subscribe(t=>{console.log(t),this.responseOtp=t,this.userNumber=r,this.router.navigate(["verify"])},t=>{console.log(t),console.log(t.error),console.log(t.error.message),t.error.message==="User does not exist. Please sign up first."?(alert("Account was not found. Please signUp first."),this.router.navigate(["selectAccount"])):alert("something went wrong.Please retry again")})}showOtp(){alert(this.responseOtp.otp)}resendOtp(){console.log(this.userNumber),console.log(this.api);let r={phone:this.userNumber};console.log(r),this.http.post(this.api,r).subscribe(l=>{console.log(l)},l=>{console.log(l)})}verifyOtp(r){let l={otp:r,phone:this.userNumber},t=this.apiUrl+"providers/provider-auth/verify-otp";return this.http.post(t,l)}setUserInLocalStroage(r){localStorage.setItem("providerId",r)}setUser(r){this.userDetails.push({number:this.userNumber}),console.log(this.userDetails),localStorage.setItem("providerId",r),this.userId=localStorage.getItem("providerId")}getUserId(){let r=localStorage.getItem("providerId");return console.log(r),sr(r)}removeUser(){localStorage.removeItem("providerId")}setWork(r,l){this.workName=r,this.workId=l}setSubCat(r){this.selectedSubCategories=r,console.log(this.selectedSubCategories)}setservices(r){this.selectedServiceId=r}setAge(r){console.log(r),this.age=r,console.log(this.age)}setExperiance(r){console.log(r),this.experience=r}setWorkDetails(){console.log(this.selectedSubCategories);let r=[{categoryId:this.workId,experience:this.experience,subcategoryId:this.selectedSubCategories,serviceId:this.selectedServiceId}];this.workDetails.push(r),console.log(this.workDetails.flat())}getSubCategory(){let r=this.apiUrl+`core/sub-categories/category/${this.categoryId}`;return this.http.get(r)}getServices(r,l){let t=`${this.apiUrl}/core/services/filter/${r}/${l}`;return this.http.get(t)}sendWorkDetails(){let r=this.apiUrl+"providers/provider-work",l=this.workDetails.flat(),_={providerId:localStorage.getItem("providerId"),works:l};return console.log(_),this.http.post(r,_)}UserDetails(r){let l=[];r.forEach((_,C)=>{l.push(C=_)}),console.log(l),console.log(r);let t=this.apiUrl+"providers/provider-details";this.http.post(t,r).subscribe(_=>{console.log("Success",_),this.userFromServer=_,this.router.navigate(["aadharVerify"])},_=>{console.error("Error",_),_.error instanceof ErrorEvent?alert("A network error occurred. Please try again later."):alert("An error occurred. Please try again later."),console.error(`Backend returned code ${_.status}, body was: `,_.error)})}formatingResponse(r){console.log(r.work),console.log(r.work);let t=JSON.parse(r.work).flat();this.userFromServer.work=t,console.log(this.userFromServer)}updateUserWork(r,l){console.log(r);let t=localStorage.getItem("providerId");console.log(l);let _={providerId:t,works:r};console.log("work in service",_);let C=this.apiUrl+"providers/provider-work";this.http.post(C,_).subscribe(I=>{console.log(I),this.dialogService.openDialog("Service has been updated"),this.router.navigate(["home"])},I=>{console.log(I)})}getPhoneNumber(){let r=localStorage.getItem("providerId"),l=this.apiUrl+`providers/provider-auth/${r}`;return this.http.get(l).subscribe(t=>{this.userNumber=t.phone,console.log(this.userNumber)},t=>{console.log(t)}),this.userNumber}setDefult(){this.userDetails=[],this.workDetails=[],this.userNumber=null,this.userId="",this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.responseOtp="",this.name="",this.pincode="",this.radius=void 0,this.workName="",this.workId="",this.age="",this.gender="",this.experience=0,this.selectedSubCategories="",this.categoryId="",this.userFromServer=[]}};s.\u0275fac=function(l){return new(l||s)(st(Wi),st(Nt),st(zn))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Ya=d=>({"full-screen":d}),jF=(d,s)=>({"border-radius":d,"background-color":s}),UF=(d,s,u,r)=>({"border-top-color":d,"border-right-color":s,"border-bottom-color":u,"border-left-color":r}),lr=d=>({"background-color":d}),HF=d=>({color:d});function WF(d,s){if(d&1&&Me(0,"div",14),d&2){let u=rt(2);Fe("ngClass",ci(2,Ya,u.config.fullScreenBackdrop===!0))("ngStyle",gk(4,UF,u.config.secondaryColour,u.config.secondaryColour,u.config.secondaryColour,u.config.primaryColour))}}function GF(d,s){if(d&1&&(V(0,"div",15),Me(1,"div",16)(2,"div",17)(3,"div",18)(4,"div",19)(5,"div",20)(6,"div",21)(7,"div",22)(8,"div",23)(9,"div",24),j()),d&2){let u=rt(2);Fe("ngClass",ci(10,Ya,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",ci(12,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(14,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(16,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(18,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(20,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(22,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(24,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(26,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(28,lr,u.config.primaryColour))}}function qF(d,s){if(d&1&&Me(0,"div",25),d&2){let u=rt(2);Fe("ngStyle",ci(2,lr,u.config.primaryColour))("ngClass",ci(4,Ya,u.config.fullScreenBackdrop===!0))}}function $F(d,s){if(d&1&&(V(0,"div",26),Me(1,"div",27)(2,"div",28)(3,"div",29)(4,"div",30)(5,"div",31),j()),d&2){let u=rt(2);Fe("ngClass",ci(6,Ya,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",ci(8,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(10,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(12,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(14,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(16,lr,u.config.primaryColour))}}function YF(d,s){if(d&1&&(V(0,"div",32),Me(1,"div",33)(2,"div",34),j()),d&2){let u=rt(2);Fe("ngClass",ci(3,Ya,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",ci(5,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(7,lr,u.config.secondaryColour))}}function ZF(d,s){if(d&1&&(V(0,"div",35),Me(1,"div",36)(2,"div",37),j()),d&2){let u=rt(2);Fe("ngClass",ci(3,Ya,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",ci(5,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(7,lr,u.config.secondaryColour))}}function XF(d,s){if(d&1&&Me(0,"div",38),d&2){let u=rt(2);Fe("ngClass",ci(2,Ya,u.config.fullScreenBackdrop===!0))("ngStyle",ci(4,lr,u.config.primaryColour))}}function QF(d,s){if(d&1&&(V(0,"div",39),Me(1,"div",40)(2,"div",41),j()),d&2){let u=rt(2);Fe("ngClass",ci(3,Ya,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",ci(5,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(7,lr,u.config.secondaryColour))}}function KF(d,s){if(d&1&&Me(0,"div",42),d&2){let u=rt(2);Fe("ngClass",ci(2,Ya,u.config.fullScreenBackdrop===!0))("ngStyle",ci(4,HF,u.config.primaryColour))}}function JF(d,s){if(d&1&&Me(0,"div",43),d&2){let u=rt(2);Fe("ngClass",ci(1,Ya,u.config.fullScreenBackdrop===!0))}}function ez(d,s){if(d&1&&(V(0,"div",44),Me(1,"div",45)(2,"div",46)(3,"div",47),j()),d&2){let u=rt(2);Fe("ngClass",ci(4,Ya,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",ci(6,lr,u.config.primaryColour)),ue(),Fe("ngStyle",ci(8,lr,u.config.secondaryColour)),ue(),Fe("ngStyle",ci(10,lr,u.config.tertiaryColour))}}function tz(d,s){d&1&&$x(0)}function iz(d,s){if(d&1&&(hd(0),Bt(1,tz,1,0,"ng-container",48),ud()),d&2){let u=rt(2);ue(),Fe("ngTemplateOutlet",u.template)}}function nz(d,s){if(d&1&&(V(0,"div"),Me(1,"div",1),V(2,"div",2),Bt(3,WF,1,9,"div",3)(4,GF,10,30,"div",4)(5,qF,1,6,"div",5)(6,$F,6,18,"div",6)(7,YF,3,9,"div",7)(8,ZF,3,9,"div",8)(9,XF,1,6,"div",9)(10,QF,3,9,"div",10)(11,KF,1,6,"div",11)(12,JF,1,3,"div",12)(13,ez,4,12,"div",13)(14,iz,2,1,"ng-container",0),j()()),d&2){let u=rt();ue(),Fe("ngClass",ci(14,Ya,u.config.fullScreenBackdrop===!0))("ngStyle",Yx(16,jF,u.config.backdropBorderRadius,u.config.backdropBackgroundColour)),ue(),Fe("ngSwitch",u.config.animationType),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.circle),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.cubeGrid),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.rotatingPlane),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.rectangleBounce),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.wanderingCubes),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.doubleBounce),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.pulse),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.chasingDots),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.circleSwish),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.none),ue(2),Fe("ngIf",u.template)}}var Lb=class{constructor(s={}){this.backdropBorderRadius=s.backdropBorderRadius,this.backdropBackgroundColour=s.backdropBackgroundColour,this.fullScreenBackdrop=s.fullScreenBackdrop,this.animationType=s.animationType,this.primaryColour=s.primaryColour,this.secondaryColour=s.secondaryColour,this.tertiaryColour=s.tertiaryColour}},_T={chasingDots:"chasing-dots",circle:"sk-circle",circleSwish:"circleSwish",cubeGrid:"sk-cube-grid",doubleBounce:"double-bounce",none:"none",pulse:"pulse",rectangleBounce:"rectangle-bounce",rotatingPlane:"rotating-plane",threeBounce:"three-bounce",wanderingCubes:"wandering-cubes"},rz=(()=>{let s=class s{constructor(r){this.config=r,this.loadingConfig=this.config||new Lb}};s.\u0275fac=function(l){return new(l||s)(st("loadingConfig",8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Fb=(()=>{let s=class s{constructor(r){this.LoadingService=r,this.show=!1,this.config=new Lb,this.defaultConfig={animationType:_T.threeBounce,backdropBackgroundColour:"rgba(0, 0, 0, 0.3)",backdropBorderRadius:"0px",fullScreenBackdrop:!1,primaryColour:"#ffffff",secondaryColour:"#ffffff",tertiaryColour:"#ffffff"},this.ngxLoadingAnimationTypes=_T}ngOnInit(){this.setupConfig()}setupConfig(){for(let r in this.defaultConfig)this.config[r]==null&&(this.config[r]=this.LoadingService.loadingConfig[r]!=null?this.LoadingService.loadingConfig[r]:this.defaultConfig[r])}};s.\u0275fac=function(l){return new(l||s)(fe(rz))},s.\u0275cmp=_t({type:s,selectors:[["ngx-loading"]],inputs:{show:"show",config:"config",template:"template"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"backdrop",3,"ngClass","ngStyle"],[3,"ngSwitch"],["class","spinner-circle",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","sk-cube-grid",3,"ngClass",4,"ngSwitchCase"],["class","spinner-sk-rotateplane",3,"ngStyle","ngClass",4,"ngSwitchCase"],["class","spinner-rectangle-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-wandering-cubes",3,"ngClass",4,"ngSwitchCase"],["class","spinner-double-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-pulse",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","spinner-chasing-dots",3,"ngClass",4,"ngSwitchCase"],["class","spinner-circle-swish",3,"ngClass","ngStyle",4,"ngSwitchCase"],[3,"ngClass",4,"ngSwitchCase"],["class","spinner-three-bounce",3,"ngClass",4,"ngSwitchDefault"],[1,"spinner-circle",3,"ngClass","ngStyle"],[1,"sk-cube-grid",3,"ngClass"],[1,"sk-cube","sk-cube1",3,"ngStyle"],[1,"sk-cube","sk-cube2",3,"ngStyle"],[1,"sk-cube","sk-cube3",3,"ngStyle"],[1,"sk-cube","sk-cube4",3,"ngStyle"],[1,"sk-cube","sk-cube5",3,"ngStyle"],[1,"sk-cube","sk-cube6",3,"ngStyle"],[1,"sk-cube","sk-cube7",3,"ngStyle"],[1,"sk-cube","sk-cube8",3,"ngStyle"],[1,"sk-cube","sk-cube9",3,"ngStyle"],[1,"spinner-sk-rotateplane",3,"ngStyle","ngClass"],[1,"spinner-rectangle-bounce",3,"ngClass"],[1,"rect1",3,"ngStyle"],[1,"rect2",3,"ngStyle"],[1,"rect3",3,"ngStyle"],[1,"rect4",3,"ngStyle"],[1,"rect5",3,"ngStyle"],[1,"spinner-wandering-cubes",3,"ngClass"],[1,"cube1",3,"ngStyle"],[1,"cube2",3,"ngStyle"],[1,"spinner-double-bounce",3,"ngClass"],[1,"double-bounce1",3,"ngStyle"],[1,"double-bounce2",3,"ngStyle"],[1,"spinner-pulse",3,"ngClass","ngStyle"],[1,"spinner-chasing-dots",3,"ngClass"],[1,"dot1",3,"ngStyle"],[1,"dot2",3,"ngStyle"],[1,"spinner-circle-swish",3,"ngClass","ngStyle"],[3,"ngClass"],[1,"spinner-three-bounce",3,"ngClass"],[1,"bounce1",3,"ngStyle"],[1,"bounce2",3,"ngStyle"],[1,"bounce3",3,"ngStyle"],[4,"ngTemplateOutlet"]],template:function(l,t){l&1&&Bt(0,nz,15,19,"div",0),l&2&&Fe("ngIf",t.show)},dependencies:[Mo,fr,rb,nb,wk,Ck,Sk],styles:['.backdrop[_ngcontent-%COMP%]{z-index:1999;position:absolute;inset:0;background-color:#0000004d}.spinner-circle[_ngcontent-%COMP%], .spinner-circle[_ngcontent-%COMP%]:after{border-radius:50%;width:10em;height:10em}.spinner-circle[_ngcontent-%COMP%]{font-size:6px;border-top:1.1em solid rgba(255,255,255,.2);border-right:1.1em solid rgba(255,255,255,.2);border-bottom:1.1em solid rgba(255,255,255,.2);border-left:1.1em solid #ffffff;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load8 1.1s infinite linear;animation:_ngcontent-%COMP%_load8 1.1s infinite linear}@-webkit-keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.spinner-circle-swish[_ngcontent-%COMP%]{font-size:60px;overflow:hidden;width:1em;height:1em;border-radius:50%;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load6 1.7s infinite ease;animation:_ngcontent-%COMP%_load6 1.7s infinite ease}@-webkit-keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(0deg)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(0)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(360deg)}}.sk-cube-grid[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube[_ngcontent-%COMP%]{width:33%;height:33%;background-color:#333;float:left;-webkit-animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube1[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube2[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube3[_ngcontent-%COMP%]{-webkit-animation-delay:.4s;animation-delay:.4s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube4[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube5[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube6[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube7[_ngcontent-%COMP%]{-webkit-animation-delay:0s;animation-delay:0s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube8[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube9[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}@keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}.spinner-double-bounce[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.double-bounce1[_ngcontent-%COMP%], .double-bounce2[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;background-color:#333;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.double-bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-pulse[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#333;position:absolute;inset:0;margin:auto;z-index:2000;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0)}to{-webkit-transform:scale(1);opacity:0}}@keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0);transform:scale(0)}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.spinner-three-bounce[_ngcontent-%COMP%]{width:70px;text-align:center;position:absolute;inset:0;height:20px;margin:auto;z-index:2000}.spinner-three-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#fff;border-radius:100%;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce1[_ngcontent-%COMP%]{-webkit-animation-delay:-.32s;animation-delay:-.32s}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-.16s;animation-delay:-.16s}@-webkit-keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-sk-rotateplane[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes _ngcontent-%COMP%_sk-rotateplane{0%{transform:perspective(120px) rotateX(0) rotateY(0);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}.spinner-rectangle-bounce[_ngcontent-%COMP%]{width:50px;height:40px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.spinner-rectangle-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:#fff;height:100%;width:6px;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect2[_ngcontent-%COMP%]{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect3[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect4[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect5[_ngcontent-%COMP%]{-webkit-animation-delay:-.8s;animation-delay:-.8s}@-webkit-keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{-webkit-transform:scaleY(.4)}20%{-webkit-transform:scaleY(1)}}@keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{transform:scaleY(.4);-webkit-transform:scaleY(.4)}20%{transform:scaleY(1);-webkit-transform:scaleY(1)}}.spinner-wandering-cubes[_ngcontent-%COMP%]{width:60px;height:58px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.cube1[_ngcontent-%COMP%], .cube2[_ngcontent-%COMP%]{background-color:#fff;width:15px;height:15px;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out}.cube2[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubemove{25%{-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{-webkit-transform:rotate(-360deg)}}@keyframes _ngcontent-%COMP%_sk-cubemove{25%{transform:translate(42px) rotate(-90deg) scale(.5);-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{transform:translate(42px) translateY(42px) rotate(-179deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-179deg)}50.1%{transform:translate(42px) translateY(42px) rotate(-180deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{transform:translate(0) translateY(42px) rotate(-270deg) scale(.5);-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{transform:rotate(-360deg);-webkit-transform:rotate(-360deg)}}.sk-circle[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;left:0;top:0}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]:before{content:"";display:block;margin:0 auto;width:15%;height:15%;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]{-webkit-transform:rotate(30deg);-ms-transform:rotate(30deg);transform:rotate(30deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]{-webkit-transform:rotate(60deg);-ms-transform:rotate(60deg);transform:rotate(60deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]{-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]{-webkit-transform:rotate(120deg);-ms-transform:rotate(120deg);transform:rotate(120deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]{-webkit-transform:rotate(150deg);-ms-transform:rotate(150deg);transform:rotate(150deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]{-webkit-transform:rotate(210deg);-ms-transform:rotate(210deg);transform:rotate(210deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]{-webkit-transform:rotate(240deg);-ms-transform:rotate(240deg);transform:rotate(240deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]{-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]{-webkit-transform:rotate(300deg);-ms-transform:rotate(300deg);transform:rotate(300deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]{-webkit-transform:rotate(330deg);-ms-transform:rotate(330deg);transform:rotate(330deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1s;animation-delay:-1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.9s;animation-delay:-.9s}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.8s;animation-delay:-.8s}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.7s;animation-delay:-.7s}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.6s;animation-delay:-.6s}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.5s;animation-delay:-.5s}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.4s;animation-delay:-.4s}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.3s;animation-delay:-.3s}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.2s;animation-delay:-.2s}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.1s;animation-delay:-.1s}@-webkit-keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-chasing-dots[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000;text-align:center;-webkit-animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear;animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear}.dot1[_ngcontent-%COMP%], .dot2[_ngcontent-%COMP%]{width:60%;height:60%;display:inline-block;position:absolute;top:0;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.dot2[_ngcontent-%COMP%]{top:auto;bottom:0;-webkit-animation-delay:-1s;animation-delay:-1s}@-webkit-keyframes _ngcontent-%COMP%_sk-rotate{to{-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_sk-rotate{to{transform:rotate(360deg);-webkit-transform:rotate(360deg)}}@-webkit-keyframes _ngcontent-%COMP%_sk-bounce{0%,to{-webkit-transform:scale(0)}50%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bounce{0%,to{transform:scale(0);-webkit-transform:scale(0)}50%{transform:scale(1);-webkit-transform:scale(1)}}.full-screen[_ngcontent-%COMP%]{position:fixed;position:-ms-page}']});let d=s;return d})(),bT=(()=>{let s=class s{static forRoot(r){return{ngModule:s,providers:[{provide:"loadingConfig",useValue:r}]}}};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[Zs]});let d=s;return d})();var oz=d=>({disabled:d}),az=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function sz(d,s){d&1&&(V(0,"div",16)(1,"p",17),$(2,"***Please enter a valid 10-digit phone number."),j()())}function lz(d,s){if(d&1&&Me(0,"ngx-loading",15),d&2){let u=rt();Fe("show",u.loading)("config",ib(2,az))}}var vT=(()=>{let s=class s{constructor(r,l,t,_,C){this.router=r,this.fb=l,this.auth=t,this.http=_,this.logInService=C,this.loading=!1,this.showError=!1,this.myForm=this.fb.group({phoneNumber:[null,[oo.required,oo.pattern("^[0-9]{10}$")]]})}validate(){this.myForm.value.phoneNumber.length===10?this.showError=!1:this.showError=!0}login(){this.loading=!0,this.logInService.setLog(this.myForm.value.phoneNumber),this.loading=!1}};s.\u0275fac=function(l){return new(l||s)(fe(Nt),fe(Qo),fe(gT),fe(Wi),fe(Wn))},s.\u0275cmp=_t({type:s,selectors:[["app-log-in"]],decls:29,vars:7,consts:[[1,"container"],[1,"sub-container"],[1,"banner-div"],[1,"banner"],[3,"submit","input","formGroup"],[1,"phone-div"],[1,"num"],[1,"line"],["type","tel","formControlName","phoneNumber",1,"input-box"],["class","error",4,"ngIf"],[1,"update-div"],["type","checkbox"],["src","assets\\logo\\wts up .png"],[1,"btn"],[3,"disabled","ngClass"],[3,"show","config"],[1,"error"],[1,"error-message",2,"color","red"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span"),$(5,"Earn more"),j(),Me(6,"br"),V(7,"p"),$(8,"fill your dreams"),j()()(),V(9,"form",4),Pe("submit",function(){return t.login()})("input",function(){return t.validate()}),V(10,"div",5)(11,"div")(12,"span",6),$(13,"+91"),j(),Me(14,"span",7)(15,"input",8),j()(),Bt(16,sz,3,0,"div",9),V(17,"div",10),Me(18,"input",11),V(19,"span"),$(20,"Get update on \xA0"),Me(21,"img",12),$(22," whatsapp"),j()(),Me(23,"br")(24,"br"),V(25,"div",13)(26,"button",14),$(27,"Get OTP"),j()()()()(),Bt(28,lz,1,3,"ngx-loading",15)),l&2&&(ue(9),Fe("formGroup",t.myForm),ue(7),Fe("ngIf",t.showError),ue(10),Fe("disabled",!t.myForm.valid)("ngClass",ci(5,oz,!t.myForm.valid)),ue(2),Dn(28,t.loading?28:-1))},dependencies:[Mo,fr,Io,ro,ir,ko,Xo,Ga,Fb],styles:['.container[_ngcontent-%COMP%]{width:99vw;max-width:450px;height:100vh;display:flex;flex-direction:column;align-items:center}.sub-container[_ngcontent-%COMP%]{width:100%;position:relative;top:3%;display:grid;grid-gap:1.2rem;align-items:center}.banner-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.banner[_ngcontent-%COMP%]{width:90%;max-width:450px;height:26rem;background-image:url("./media/Rectangle 25-RGNGM5F3.png");background-size:cover;background-repeat:no-repeat;background-position:center;display:flex;flex-direction:column;justify-content:center;text-align:center}.banner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:42px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.banner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:26px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.phone-div[_ngcontent-%COMP%]{width:90%;align-items:start;border-radius:.5rem;height:3.5rem;border:1px solid rgba(0,0,0,1);position:relative;left:5%}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:flex;position:relative;top:30%;left:5%;font-size:1.3rem}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:26px;height:17px}.num[_ngcontent-%COMP%]{font-size:1.4rem}.line[_ngcontent-%COMP%]{margin-top:-.2rem;font-size:2.2rem}.input-box[_ngcontent-%COMP%]{float:left;margin-top:-.4rem;width:70%;height:2rem;outline:0;border-width:0 0 0;font-size:1.5rem}input[type=checkbox][_ngcontent-%COMP%]{accent-color:#D16611}.update-div[_ngcontent-%COMP%]{width:80%;height:1.6rem;margin-left:5%;margin-top:.4rem;align-items:center;display:flex}.update-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#d70d09}.update-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.1rem;font-family:inter;font-weight:400;line-height:1.4rem}.btn[_ngcontent-%COMP%]{width:90%;align-items:center;margin-left:5%}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.disabled[_ngcontent-%COMP%]{background-color:#838180}.error[_ngcontent-%COMP%]{width:90%;margin-left:5%}']});let d=s;return d})();var Cr=(()=>{let s=class s{constructor(r,l,t){this.http=r,this.router=l,this.dialogService=t,this.providerRating=0,this.apiUrl=yn,this.userId=localStorage.getItem("provider"),this.isVerify=!1,this.checkingDetails=!1,this.items=[],this.selectedJob=[],this.userName="",this.workDetails=[],this.getServices()}setCheckingDetails(r){this.checkingDetails=r}getcheckingDetails(){return this.checkingDetails}selectedJobDetails(r){console.log(r),this.selectedJob=r}getSelectedJob(){return console.log(this.selectedJob),this.selectedJob}getUserDetails(r){let l=this.apiUrl+`providers/provider-details/${r}`;return new uo(t=>{this.http.get(l).subscribe(_=>{console.log(_),console.log("response",_),this.isVerify=_.isVerified,this.userDetails=_,this.formatingResponse(this.userDetails),t.next(!1),t.complete()},_=>{console.log(_),_.error.message=="No items found for this user"?(console.log("not found"),t.next(!0)):(t.error(_),this.checkingDetails||(this.dialogService.openDialog("Please add the details"),this.checkingDetails=!0,this.router.navigate(["aboutUser"]))),t.complete()})})}getRating(){let r=localStorage.getItem("providerId");if(this.providerRating>0)return sr(this.providerRating);{let l=`${this.apiUrl}users/user-feedback/provider/${r}`;return new uo(t=>{this.http.get(l).subscribe({next:_=>{console.log(_),this.providerRating=_,t.next(this.providerRating)},error:_=>{console.log(_)}})})}}formatingResponse(r){try{typeof r.work=="string"&&(this.workDetails=r.work);let t=r.work;this.workDetails=t,console.log(this.workDetails)}catch(l){console.error("Error processing response.work",l)}}flattenArray(r){return r.reduce((l,t)=>Array.isArray(t)?l.concat(this.flattenArray(t)):l.concat(t),[])}getServices(){let r=this.apiUrl+"core/categories";this.http.get(r).subscribe(l=>{console.log(l),this.formattingServices(l)},l=>{console.log(l)})}formattingServices(r){r.forEach(l=>{this.items.push({id:l._id,names:l.name,checked:!1,image:l.imageKey})})}getAvailability(){let r=this.apiUrl+`providers/provider-date/${localStorage.getItem("providerId")}`;return this.http.get(r)}setDefault(){this.items=[],this.selectedJob=[],this.userDetails="",this.userName=""}};s.\u0275fac=function(l){return new(l||s)(st(Wi),st(Nt),st(zn))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var cz=["input1"],dz=["input2"],hz=["input3"],uz=["input4"];function mz(d,s){if(d&1){let u=Xt();V(0,"u",16),Pe("click",function(){mt(u);let l=rt();return pt(l.resend())}),$(1,"Resend"),j()}}function pz(d,s){if(d&1&&(V(0,"div",17)(1,"p"),$(2),j()()),d&2){let u=rt();ue(2),xa("",u.minutes," : ",u.seconds,"")}}var xT=(()=>{let s=class s{constructor(r,l,t,_,C,I,O){this.form=r,this.logInService=l,this.jobDetailsService=t,this.loginServices=_,this.router=C,this.dialogeService=I,this.http=O,this.apiUrl=yn,this.userNumber=0,this.resendToggling="resend",this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}ngOnInit(){this.userNumber=this.logInService.userNumber,this.logInService.showOtp()}onInput(r,l){if(r.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}onKeyDown(r,l){console.log("called",r,l);let t=r.target;if(console.log("input :",t.value),console.log(l==1),r.key==="Backspace"&&!t.value&&l>1){let _=l-1;if(console.log("previous input",`#input${l-1}`),_)switch(_){case 3:this.input3.nativeElement.focus();break;case 2:this.input2.nativeElement.focus();break;case 1:this.input1.nativeElement.focus();break;default:console.log("something went wrong")}}}login(){return Ln(this,null,function*(){let r=this.otp.value,l=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log("OTP:",this.otp.value),console.log(l),this.logInService.verifyOtp(l).subscribe(t=>Ln(this,null,function*(){console.log("log in done",t),console.log(t.providerId),yield this.logInService.setUser(t.providerId),this.storeUserData(),yield this.chekingUser()}),t=>{console.log("error",t),alert(t.error.message)})})}storeUserData(){}resend(){this.logInService.resendOtp(),this.resendToggling="countdown",this.startCountdown()}startCountdown(){let r=120;this.updateDisplay(r),this.countdownInterval=setInterval(()=>{r-=1,r<=0?(this.stopCountdown(),this.resendToggling="resend"):this.updateDisplay(r)},1e3)}stopCountdown(){clearInterval(this.countdownInterval)}ngOnDestroy(){this.stopCountdown()}updateDisplay(r){this.minutes=Math.floor(r/60),this.seconds=r%60}chekingUser(){return Ln(this,null,function*(){let r=localStorage.getItem("providerId"),l=`${this.apiUrl}providers/provider-details/${r}`;this.http.get(l).subscribe(t=>{console.log("response",t),console.log(t.providerName),this.logInService.alreadyHasAccount=!0,this.navTo()},t=>{console.log(t),this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"])})})}navTo(){this.logInService.alreadyHasAccount?this.router.navigate(["home"]):(this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"]))}};s.\u0275fac=function(l){return new(l||s)(fe(Qo),fe(Wn),fe(Cr),fe(Wn),fe(Nt),fe(zn),fe(Wi))},s.\u0275cmp=_t({type:s,selectors:[["app-verify"]],viewQuery:function(l,t){if(l&1&&(bi(cz,5),bi(dz,5),bi(hz,5),bi(uz,5)),l&2){let _;gi(_=_i())&&(t.input1=_.first),gi(_=_i())&&(t.input2=_.first),gi(_=_i())&&(t.input3=_.first),gi(_=_i())&&(t.input4=_.first)}},decls:27,vars:3,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"info-text"],[3,"ngSubmit","formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputTwo",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputThree",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputFour",3,"input","keydown"],[1,"resend-div"],["type","submit",1,"login-btn",3,"click"],[1,"resend",3,"click"],[1,"resend"]],template:function(l,t){if(l&1){let _=Xt();V(0,"div",4)(1,"div",5)(2,"span",6),$(3,"Enter OTP "),j(),Me(4,"br"),V(5,"span",7),$(6,"Please enter the code we just send to"),j(),V(7,"p",7),$(8),j(),Me(9,"br"),V(10,"form",8),Pe("ngSubmit",function(){return mt(_),pt(t.login())}),V(11,"div",9)(12,"input",10,0),Pe("input",function(I){return mt(_),pt(t.onInput(I,1))})("keydown",function(I){return mt(_),pt(t.onKeyDown(I,1))}),j(),V(14,"input",11,1),Pe("input",function(I){return mt(_),pt(t.onInput(I,2))})("keydown",function(I){return mt(_),pt(t.onKeyDown(I,2))}),j(),V(16,"input",12,2),Pe("input",function(I){return mt(_),pt(t.onInput(I,3))})("keydown",function(I){return mt(_),pt(t.onKeyDown(I,3))}),j(),V(18,"input",13,3),Pe("input",function(I){return mt(_),pt(t.onInput(I,4))})("keydown",function(I){return mt(_),pt(t.onKeyDown(I,4))}),j()(),V(20,"div",14)(21,"span"),$(22,"Didn\u2019t receive OTP? "),Bt(23,mz,2,0)(24,pz,3,2),j()(),V(25,"button",15),Pe("click",function(){return mt(_),pt(t.login())}),$(26,"Verify"),j()()()()}if(l&2){let _;ue(8),ki("+91 ",t.userNumber,""),ue(2),Fe("formGroup",t.otp),ue(13),Dn(23,(_=t.resendToggling)==="resend"?23:_==="countdown"?24:-1)}},dependencies:[Io,ro,ir,ko,Em,Xo,Ga],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center;align-items:center}.sub-container[_ngcontent-%COMP%]{position:relative;top:10%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:2.1rem}.info-text[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.3rem;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:2.5rem;font-weight:300;align-items:center}.resend-div[_ngcontent-%COMP%]{margin-top:3rem;width:90%;height:4rem;display:grid;align-items:center;row-gap:0}.resend-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer;font-size:1.1rem;font-family:Roboto,sans-serif;font-weight:400;color:#000}.resend[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}@media screen and (min-width: 600px){.container[_ngcontent-%COMP%]{align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:30%;border:1px solid black;position:relative;left:35%}}"]});let d=s;return d})();var Gn=(()=>{let s=class s{constructor(r){this.http=r,this.workResponse=[],this.api=yn}getUserDetails(r){let l=this.api+`providers/provider-details/${r}`;return this.providerDetails?sr(this.providerDetails):new uo(t=>{this.http.get(l).subscribe(_=>{console.log(_),this.providerDetails=_,t.next(this.providerDetails),t.complete()},_=>{console.log(_),t.error(_)})})}selectWork(r){return r}getBanners(){let r=`${this.api}admin/provider-banners`;return this.http.get(r)}getWork(r){let l=this.api+`providers/provider-work/${r}`;return console.log(l),this.http.get(l)}deleteServiceWork(r,l){let t=`${this.api}providers/provider-work/delete`,C={body:{providerId:localStorage.getItem("providerId"),workId:r,serviceId:l}};return this.http.delete(t,C)}deleteWork(r){let l=`${this.api}providers/provider-work/delete-work`,t={body:r};return this.http.delete(l,t)}getFinancialDetails(){let r=this.api+`providers/provider-finance/${localStorage.getItem("providerId")}`;return this.http.get(r)}getPackages(){let r=`${this.api}admin/admin-provider-package`;return this.http.get(r)}buyingPackages(r){let l=`${this.api}providers/provider-package`;return this.http.post(l,r)}getPurchasedPackages(r){let l=`${this.api}providers/provider-package/${r}`;return this.http.get(l)}getCertificated(r){let l=this.api+`providers/provider-certificate/${r}`;return this.http.get(l)}setDefult(){this.workResponseId="",this.workResponse=[],this.currentLocation="",this.currentCordinates="",this.userRegistered="",this.api=""}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Ks=(()=>{let s=class s{constructor(r){this.http=r,this.apiUrl=yn,this.mapStatus=!1,this.currentLocation$=new ig(null),this.onlineStatus=!1,this.directionsService=new google.maps.DirectionsService,this.directionsRenderer=new google.maps.DirectionsRenderer}setonlineStatus(r,l){this.onlineStatus=r,localStorage.setItem("onlineStatus",r.toString()),localStorage.setItem("onlineText",l)}getonlineStatus(){let r=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");return{status:r==="true",text:l||"Go"}}getCoordinates(){return navigator.geolocation.getCurrentPosition(r=>{let l={lat:r.coords.latitude,lng:r.coords.longitude};this.currentLocation$.next(l)},r=>{console.log(r)}),this.currentLocation$.asObservable()}sendCordinates(r){let l=this.apiUrl+"providers/provider-cordinates",t=localStorage.getItem("providerId");console.log(r);let _={providerId:t,longitude:r.location.lng,latitude:r.location.lat};return console.log(_),this.http.post(l,_)}getCoordinatesFromPlaceName(r){let l=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(r)}&key=AIzaSyCJQHv3pYfnPd6F3ju1DXZ7jm46PJbncuk`;return this.http.get(l)}getPlaceNameFromCoordinates(r,l){let t=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${r},${l}&key=AIzaSyCJQHv3pYfnPd6F3ju1DXZ7jm46PJbncuk`;return this.http.get(t)}addDestinationMarker(r){new google.maps.Marker({position:{lat:r[1],lng:r[0]},map:this.map,title:"Destination"})}initializeMap(r,l){this.map=new google.maps.Map(l,{center:{lat:r.lat,lng:r.lng},zoom:15})}addProviderMarker(r){this.providerMarker=new google.maps.Marker({position:r,map:this.map,title:"Provider Location"})}addUserMarker(r){new google.maps.Marker({position:r,map:this.map,title:"User Location",icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}),this.directionsRenderer.setMap(this.map)}updateProviderMarker(r){this.providerMarker&&this.providerMarker.setPosition(r)}showDirections(r,l){if(!r||!l){console.error("Invalid origin or destination for directions.");return}let t={origin:new google.maps.LatLng(r.lat,r.lng),destination:new google.maps.LatLng(l.lat,l.lng),travelMode:google.maps.TravelMode.DRIVING};this.directionsService.route(t,(_,C)=>{C==="OK"?this.directionsRenderer.setDirections(_):console.error("Error fetching directions:",C)})}trackProviderLocation(){let r=new ig(null);return navigator.geolocation.watchPosition(l=>{let t={lat:l.coords.latitude,lng:l.coords.longitude};r.next(t)},l=>{console.log("Tracking error:",l)}),r.asObservable()}calculateDistance(r,l,t,_){let C=de=>de*Math.PI/180,O=C(t-r),N=C(_-l),q=Math.sin(O/2)*Math.sin(O/2)+Math.cos(C(r))*Math.cos(C(t))*Math.sin(N/2)*Math.sin(N/2);return 6371e3*(2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q)))}setDefult(){}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function fz(d,s){if(d&1){let u=Xt();V(0,"div",5)(1,"label",8),$(2,"what work do you do?"),j(),Me(3,"br"),V(4,"input",33),Pe("click",function(){mt(u);let l=rt();return pt(l.navTo())}),j(),Me(5,"i",34),j()}if(d&2){let u=rt();ue(4),Fe("ngModel",u.selectedWork)}}function gz(d,s){d&1&&Me(0,"img",35)}function _z(d,s){if(d&1&&Me(0,"img",36),d&2){let u=rt();Fe("src",u.imagePreview,Fn)}}var wT=(()=>{let s=class s{constructor(r,l,t,_,C,I){this.fb=r,this.router=l,this.location=t,this.loginService=_,this.userDetailsService=C,this.googleMapService=I,this.selectedFile=null,this.imagePreview=null,this.workAdded=!0,this.aboutProvider=this.fb.group({userId:localStorage.getItem("providerId"),providerName:["",oo.required],work:["",oo.required],pincode:["",oo.required],phone:[this.loginService.userNumber,oo.required],age:[this.loginService.age,oo.required],gender:["",oo.required],houseNo:"",landmark:"",address:["",oo.required],city:"",state:"",image:[""]});let O=this.loginService.workDetails.flat();this.aboutProvider.controls.work.setValue(O),console.log(O),console.log("inform",this.aboutProvider.value.work),this.selectedWork=this.loginService.workDetails.flatMap(N=>N.flatMap(q=>q.nameOfService)).join(", ")}ngOnInit(){this.getNumber(),this.getWork()}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r),r.works.length>0&&(this.workAdded=!1)},error:r=>{console.log(r)}})}getNumber(){return Ln(this,null,function*(){let r=this.loginService.getPhoneNumber();console.log(r),this.userNumber=yield this.loginService.userNumber,console.log(this.userNumber)})}flattenWorkDetails(r){return r.flatMap(l=>l.flatMap(t=>t.nameOfService))}onFileSelected(r){let l=r.target;if(l.files&&l.files.length>0){this.selectedFile=l.files[0];let t=new FileReader;t.onload=()=>{this.imagePreview=t.result},t.readAsDataURL(this.selectedFile)}}navTo(){this.router.navigate(["selectWork"])}getCoordinates(){let r=`${this.aboutProvider.value.houseNo} ${this.aboutProvider.value.landmark} ${this.aboutProvider.value.address} ${this.aboutProvider.value.city} ${this.aboutProvider.value.state} ${this.aboutProvider.value.pincode}`;console.log(r),this.googleMapService.getCoordinatesFromPlaceName(r).subscribe({next:l=>{console.log(l),this.googleMapService.sendCordinates(l.results[0].geometry).subscribe({next:t=>{console.log(t),alert("coordinates are updated")},error:t=>{console.log(t)}})},error:l=>{console.log(l)}})}submit(){this.getCoordinates();let r=new FormData;r.append("providerName",this.aboutProvider.value.providerName),r.append("age",this.aboutProvider.value.age),r.append("pincode",this.aboutProvider.value.pincode),r.append("providerId",this.aboutProvider.value.userId),r.append("gender",this.aboutProvider.value.gender),r.append("address",this.aboutProvider.value.address),r.append("phone",this.loginService.userNumber),r.append("houseNo",this.aboutProvider.value.houseNo),r.append("landMark",this.aboutProvider.value.landmark),r.append("city",this.aboutProvider.value.city),r.append("state",this.aboutProvider.value.state),this.selectedFile&&r.append("image",this.selectedFile,this.selectedFile.name),r.forEach((l,t)=>{console.log(`${t}: ${l}`)}),this.loginService.UserDetails(r)}navToBack(){console.log("back"),this.location.back()}};s.\u0275fac=function(l){return new(l||s)(fe(Qo),fe(Nt),fe(ii),fe(Wn),fe(Gn),fe(Ks))},s.\u0275cmp=_t({type:s,selectors:[["app-about-user"]],decls:67,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[3,"formGroup"],[1,"form-div"],[2,"position","relative"],["for","name"],["type","text","placeholder","Name","formControlName","providerName","id","names","required",""],["for","work"],["for","name","formControlName","gender"],["value","","disabled","","selected",""],["value","Male"],["value","Female"],["value","Others"],["for","houseNo"],["type","text","formControlName","houseNo","required","","placeholder","Address"],["for","landmark"],["type","text","formControlName","landmark","required","","placeholder","Address"],["for","address"],["type","text","formControlName","address","required","","placeholder","Address"],["for","city"],["type","text","formControlName","city","required","","placeholder","Address"],["for","state"],["type","text","formControlName","state","required","","placeholder","Address"],["for","pincode"],["type","text","formControlName","pincode","required","","placeholder","Address"],["for","file",1,"image-label"],[1,"file-input-container"],["for","file-input",1,"file-label"],["src","assets/documents/Group.png","alt","Upload image","class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],["type","file","id","file-input","formControlName","image","required","",1,"file-input",3,"change"],["type","submit",1,"login-btn",3,"click"],["formControlName","work","id","providerType","required","","placeholder","please select the Work ",3,"click","ngModel"],[1,"fa","fa-angle-down",2,"font-size","36px","position","absolute","right","10px","top","75%","transform","translateY(-50%)","pointer-events","none"],["src","assets/documents/Group.png","alt","Upload image",1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Tell us about yourself"),j(),Me(4,"br"),V(5,"form",3)(6,"div",4),Bt(7,fz,6,1,"div",5),V(8,"div")(9,"label",6),$(10,"what's your Name"),j(),Me(11,"br")(12,"input",7),j(),V(13,"div")(14,"label",8),$(15,"Select your Gender"),j(),Me(16,"br"),V(17,"select",9)(18,"option",10),$(19,"Select"),j(),V(20,"option",11),$(21,"Male"),j(),V(22,"option",12),$(23,"Female"),j(),V(24,"option",13),$(25,"Others"),j()(),Me(26,"br"),j(),V(27,"div")(28,"label",14),$(29," H no "),j(),Me(30,"br")(31,"input",15),j(),V(32,"div")(33,"label",16),$(34," Landmark "),j(),Me(35,"br")(36,"input",17),j(),V(37,"div")(38,"label",18),$(39," Address "),j(),Me(40,"br")(41,"input",19),j(),V(42,"div")(43,"label",20),$(44," City"),j(),Me(45,"br")(46,"input",21),j(),V(47,"div")(48,"label",22),$(49," State "),j(),Me(50,"br")(51,"input",23),j(),V(52,"div")(53,"label",24),$(54," Pincode "),j(),Me(55,"br")(56,"input",25),j(),V(57,"label",26),$(58," Upload image "),j(),V(59,"div",27)(60,"label",28),Bt(61,gz,1,0,"img",29)(62,_z,1,1,"img",30),j(),V(63,"input",31),Pe("change",function(C){return t.onFileSelected(C)}),j()(),V(64,"button",32),Pe("click",function(){return t.submit()}),$(65,"Continue"),j()()()()(),Me(66,"br")),l&2&&(ue(5),Fe("formGroup",t.aboutProvider),ue(2),Dn(7,t.workAdded?7:-1),ue(54),Fe("ngIf",!t.selectedFile),ue(),Fe("ngIf",t.selectedFile))},dependencies:[fr,Io,Rk,Lk,ro,Ok,ir,ko,Fk,Xo,Ga],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;top:10%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.form-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-gap:1rem}.form-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter;line-height:19px}#providerType[_ngcontent-%COMP%]   option[value=""][disabled][_ngcontent-%COMP%]{display:none}.file-input-container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px;border:.25px solid #ccc;display:flex;align-items:center;justify-content:center;border-radius:.5rem}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.placeholder-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.image-label[_ngcontent-%COMP%]{float:left;text-align:left}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:100%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-bottom:3rem}']});let d=s;return d})();var CT=(()=>{let s=class s{constructor(r){this.router=r,this.currentUrl=this.router.url,this.router.events.pipe(ya(l=>l instanceof db),Ux()).subscribe(l=>{this.previousUrl=l[0].url,this.currentUrl=l[1].url})}getPreviousUrl(){return this.previousUrl}};s.\u0275fac=function(l){return new(l||s)(st(Nt))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function yz(d,s){if(d&1){let u=Xt();V(0,"div",8)(1,"div",10),Pe("click",function(){let l=mt(u).$implicit,t=rt();return pt(t.selectedCat(l))}),Me(2,"img",11),$(3),j(),V(4,"div")(5,"input",12),Er("ngModelChange",function(l){let t=mt(u).$implicit;return Tr(t.checked,l)||(t.checked=l),pt(l)}),Pe("change",function(l){let t=mt(u).$implicit,_=rt();return pt(_.onChange(l,t))}),j()()()}if(d&2){let u=s.$implicit;ue(2),Fe("src",u.image,Fn),ue(),ki(" ",u.names,""),ue(2),Ir("ngModel",u.checked)}}function vz(d,s){if(d&1){let u=Xt();V(0,"div",8)(1,"div",10),Pe("click",function(){let l=mt(u).$implicit,t=rt();return pt(t.selectedCat(l))}),Me(2,"img",11),$(3),j(),V(4,"div")(5,"input",12),Er("ngModelChange",function(l){let t=mt(u).$implicit;return Tr(t.checked,l)||(t.checked=l),pt(l)}),Pe("change",function(l){let t=mt(u).$implicit,_=rt();return pt(_.onChange(l,t))}),j()()()}if(d&2){let u=s.$implicit;ue(2),Fe("src",u.image,Fn),ue(),ki(" ",u.names,""),ue(2),Ir("ngModel",u.checked)}}var ST=(()=>{let s=class s{ngOnInit(){this.previousUrl=this.routeTrackingService.getPreviousUrl(),this.items=this.jobDetails.items,this.getWork(),console.log(this.items)}constructor(r,l,t,_,C,I){this.router=r,this.logInservice=l,this.jobDetails=t,this.routeTrackingService=_,this.userDetailsService=C,this.dialogeService=I,this.searchQuery="",this.workSeleceted=[],this.items=[],this.workForSending=[]}onInputChange(r){console.log(this.searchQuery);let l=this.jobDetails.items.filter(t=>t.names.toLowerCase().includes(this.searchQuery.toLowerCase()));console.log(l),this.items=l}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}onChange(r,l){let t=r.target;if(t&&t.checked){let C=this.items.indexOf(l);this.jobDetails.items[C].checked=!0,console.log("Item checked:",this.items.indexOf(l)),console.log("Item checked:",l.names),console.log("categoryId",l.id),this.logInservice.categoryId=l.id,this.logInservice.setWork(l.names,l.id),this.router.navigate(["subServices"])}}selectedCat(r){console.log("clciked");let l=this.items.indexOf(r);this.jobDetails.items[l].checked=!0,console.log("Item checked:",this.items.indexOf(r)),console.log("Item checked:",r.names),console.log("categoryId",r.id),this.logInservice.categoryId=r.id,this.logInservice.setWork(r.names,r.id),this.router.navigate(["subServices"])}autoCheckServices(){this.workSeleceted.forEach(r=>{let l=this.items.find(t=>t.names===r.categoryId.name);console.log(l),l&&r.serviceId.length>0&&l&&(l.checked=!0)})}send(){let r=this.items.filter(l=>l.checked===!0);if(console.log(r),this.jobDetails.userDetails&&this.jobDetails.userDetails.providerName!=null){let l=this.logInservice.workDetails.flat();this.UpdatingUserWork(l),console.log(this.jobDetails.userDetails.providerName)}}UpdatingUserWork(r){console.log(r);let l=this.userDetailsService.workResponseId;console.log("work before",this.userDetailsService.workResponse),console.log("id before",l),this.workForSending.push(this.userDetailsService.workResponse),this.workForSending.push(r),console.log(this.workForSending.flat()),this.logInservice.updateUserWork(this.workForSending.flat(),l)}};s.\u0275fac=function(l){return new(l||s)(fe(Nt),fe(Wn),fe(Cr),fe(CT),fe(Gn),fe(zn))},s.\u0275cmp=_t({type:s,selectors:[["app-select-work"]],decls:22,vars:2,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"search-container"],["type","text","placeholder","Search for Service",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"material-symbols-outlined","notranslate",3,"hidden"],[1,"serivce"],[1,"tittle2"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names",3,"click"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"what work do you do?"),j(),Me(4,"br"),V(5,"div",3)(6,"input",4),Er("ngModelChange",function(C){return Tr(t.searchQuery,C)||(t.searchQuery=C),C}),Pe("input",function(C){return t.onInputChange(C)}),j(),V(7,"span",5),$(8,"search"),j()(),V(9,"div",6)(10,"span",7),$(11,"Popular categories"),j(),Me(12,"br"),mr(13,yz,6,3,"div",8,Zr),V(15,"span",7),$(16,"All categories"),j(),Me(17,"br"),mr(18,vz,6,3,"div",8,Zr),j()(),V(20,"button",9),Pe("click",function(){return t.send()}),$(21,"Continue"),j()()),l&2&&(ue(6),Ir("ngModel",t.searchQuery),ue(),Fe("hidden",t.searchQuery),ue(6),pr(t.items),ue(5),pr(t.items))},dependencies:[ro,Xs,ir,Zo],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-container[_ngcontent-%COMP%]{position:relative}.search-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{padding-right:30px;width:70%;height:2.5rem;border-radius:.8rem;font-size:1.5rem}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.search-container[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{position:absolute;top:50%;left:7%;transform:translateY(-50%);cursor:pointer;pointer-events:none;font-size:32px;margin:0}.tittle2[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px;display:flex;align-items:start}.serivce[_ngcontent-%COMP%]{height:70vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.7rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=s;return d})();var MT=(()=>{let s=class s{constructor(r,l,t){this.router=r,this.dialogeService=l,this.loginService=t,this.selectedExperiance="",this.selectedAge="",this.workSelected=this.loginService.workName,this.selectedCheckbox=null}sendResponse(){console.log(this.selectedAge,this.selectedExperiance),this.loginService.sendWorkDetails().subscribe(r=>{console.log(r),this.dialogeService.openDialog("Service has been added"),this.loginService.workId="",this.loginService.setSubCat(""),this.loginService.setservices([]),this.router.navigate(["selectWork"])},r=>{console.log(r),this.dialogeService.openDialog(r.error.message)})}expSelected(r){this.selectedExperiance===r?this.selectedExperiance=null:this.selectedExperiance=r,console.log(this.selectedExperiance),this.selectedExperiance==="yes"?this.router.navigate(["workExperiance"]):(this.loginService.setExperiance("0"),this.loginService.setWorkDetails())}onCheckboxChange(r){this.selectedAge===r?this.selectedAge=null:this.selectedAge=r,console.log("Selected Checkbox:",this.selectedAge),this.loginService.setAge(this.selectedAge)}};s.\u0275fac=function(l){return new(l||s)(fe(Nt),fe(zn),fe(Wn))},s.\u0275cmp=_t({type:s,selectors:[["app-about-work"]],decls:44,vars:6,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],[2,"padding","0.5rem"],[1,"select-div"],[1,"conditions"],["type","checkbox"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Tell us about your work!"),j(),Me(4,"br")(5,"br"),V(6,"div",3)(7,"pre"),$(8,"What is your age?"),j(),Me(9,"hr"),V(10,"div")(11,"span"),$(12,"16 - 18"),j(),V(13,"input",4),Pe("change",function(){return t.onCheckboxChange("16-18")}),j()(),Me(14,"hr"),V(15,"div")(16,"span"),$(17,"18 - 40"),j(),V(18,"input",4),Pe("change",function(){return t.onCheckboxChange("18-40")}),j()(),Me(19,"hr"),V(20,"div")(21,"span"),$(22,"More than 40"),j(),V(23,"input",4),Pe("change",function(){return t.onCheckboxChange("more than 40")}),j()()(),V(24,"div",3)(25,"p",5),$(26),j(),Me(27,"hr"),V(28,"div",6)(29,"span"),$(30,"Yes"),j(),V(31,"input",4),Pe("change",function(){return t.expSelected("yes")}),j()(),Me(32,"hr"),V(33,"div")(34,"span"),$(35,"No"),j(),V(36,"input",4),Pe("change",function(){return t.expSelected("no")}),j()()(),V(37,"div",7),Me(38,"input",8),$(39," \xA0 Agree with Terms & conditions"),j(),Me(40,"br")(41,"br"),V(42,"button",9),Pe("click",function(){return t.sendResponse()}),$(43,"Continue"),j()()()),l&2&&(ue(13),Fe("checked",t.selectedAge==="16-18"),ue(5),Fe("checked",t.selectedAge==="18-40"),ue(5),Fe("checked",t.selectedAge==="more than 40"),ue(3),ki("Do you have any experience in ",t.workSelected," services?"),ue(5),Fe("checked",t.selectedExperiance==="yes"),ue(5),Fe("checked",t.selectedExperiance==="no"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}.conditions[_ngcontent-%COMP%]{width:max-content;font-size:1.2rem;font-family:inter,sans-serif;font-weight:400;line-height:1.4rem;float:left;display:flex;justify-content:space-around}.conditions[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}.sub-div1[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem}"]});let d=s;return d})();var kT=(()=>{let s=class s{constructor(r,l,t){this.logInservice=r,this.router=l,this.dialogeService=t,this.experiance=""}onCheckboxChange(r){this.experiance===r?this.experiance=null:this.experiance=r,console.log("Selected Checkbox:",this.experiance)}sendResponse(){this.logInservice.setExperiance(this.experiance),this.logInservice.setWorkDetails(),this.logInservice.sendWorkDetails().subscribe(r=>{console.log(r),this.dialogeService.openDialog("Service has been added"),this.logInservice.workId="",this.logInservice.setSubCat(""),this.logInservice.setservices([]),this.router.navigate(["selectWork"])},r=>{console.log(r),this.dialogeService.openDialog(r.error.message)})}};s.\u0275fac=function(l){return new(l||s)(fe(Wn),fe(Nt),fe(zn))},s.\u0275cmp=_t({type:s,selectors:[["app-work-experiance"]],decls:30,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Tell us about your work!"),j(),Me(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"span"),$(9,"0-1 Years"),j(),V(10,"input",4),Pe("change",function(){return t.onCheckboxChange("0-1")}),j()(),Me(11,"hr"),V(12,"div")(13,"span"),$(14,"2-4 Years"),j(),V(15,"input",4),Pe("change",function(){return t.onCheckboxChange("2-4")}),j()(),Me(16,"hr"),V(17,"div")(18,"span"),$(19,"3-5 Years"),j(),V(20,"input",4),Pe("change",function(){return t.onCheckboxChange("3-5")}),j()(),Me(21,"hr"),V(22,"div")(23,"span"),$(24,"More than 5 Years"),j(),V(25,"input",4),Pe("change",function(){return t.onCheckboxChange("more than 5")}),j()()()(),Me(26,"br")(27,"br"),V(28,"button",5),Pe("click",function(){return t.sendResponse()}),$(29,"Continue"),j()()),l&2&&(ue(10),Fe("checked",t.experiance==="0-1"),ue(5),Fe("checked",t.experiance==="2-4"),ue(5),Fe("checked",t.experiance==="3-5"),ue(5),Fe("checked",t.experiance==="moreThan5"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}"]});let d=s;return d})();var IT=(()=>{let s=class s{constructor(r){this.router=r}verify(){console.log("inside"),this.router.navigate(["pancard"])}};s.\u0275fac=function(l){return new(l||s)(fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-aadhar-verification"]],decls:24,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["for","name"],["type","number","placeholder","name","id","names","required",""],["type","number","placeholder","OTP","id","names","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Lets Get the Documentation Done....!!"),j(),Me(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"label",4),$(9,"Adhar Number"),j(),Me(10,"br")(11,"input",5),j(),Me(12,"br"),V(13,"button"),$(14,"Verify"),j(),V(15,"div")(16,"label",4),$(17,"OTP"),j(),Me(18,"br")(19,"input",6),j()(),V(20,"button",7),Pe("click",function(){return t.verify()}),$(21,"Verify"),j()(),Me(22,"br")(23,"br"),j())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter,sans-serif;line-height:19px}.sub-div1[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:1.4rem;background-color:#d16611;color:#fff;font-size:.8rem;font-family:inter;float:right;border:none;border-radius:.4rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}"]});let d=s;return d})();var TT=(()=>{let s=class s{constructor(r){this.router=r}skip(){this.router.navigate(["bankDetails"])}submit(){this.router.navigate(["bankDetails"])}};s.\u0275fac=function(l){return new(l||s)(fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-pancard"]],decls:21,vars:0,consts:[[1,"container"],[1,"skip-btn",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"tittle1"],[1,"pan"],["src","assets\\documents\\pancard.png"],[1,"input"],["type","number","placeholder","PAN Number","id","Enter GST Number","required",""],["type","number","placeholder","Enter GST Number","id","Enter GST Number","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"button",1),Pe("click",function(){return t.skip()}),$(2,"skip"),j(),V(3,"div",2)(4,"div")(5,"span",3),$(6,"PAN Number"),j(),Me(7,"br")(8,"br"),V(9,"span",4),$(10,"Please Input your PAN number"),j(),Me(11,"br")(12,"br"),j(),V(13,"div",5),Me(14,"img",6),j(),V(15,"div",7),Me(16,"input",8)(17,"br")(18,"input",9),j(),V(19,"button",10),Pe("click",function(){return t.submit()}),$(20,"Submit"),j()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:0%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:600;line-height:24px}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem;font-weight:400;line-height:19px}.pan[_ngcontent-%COMP%]{width:19rem;height:11.5rem}.pan[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.input[_ngcontent-%COMP%]{width:100%;height:7rem}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-top:1rem;width:98%;height:2rem;border-radius:.9rem;font-size:1rem;text-align:center}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{text-align:center;font-size:1rem;font-weight:600;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:89%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}']});let d=s;return d})();var ET=(()=>{let s=class s{constructor(r,l,t){this.fb=r,this.router=l,this.http=t,this.apiUrl=yn,this.bankDetails=this.fb.group({accountName:["",oo.required],accountNumber:["",oo.required],PANNumber:["",oo.required],bankName:["",oo.required],IFSC:["",oo.required],branch:["",oo.required],aadhaarNumber:532268448050})}submit(){let r=`${this.apiUrl}providers/provider-finance`,l=new FormData;l.append("accountName",this.bankDetails.value.accountName),l.append("providerId",localStorage.getItem("providerId")||""),l.append("aadhaarNumber",this.bankDetails.value.aadhaarNumber),l.append("accountNumber",this.bankDetails.value.accountNumber),l.append("pan",this.bankDetails.value.PANNumber),l.append("bankName",this.bankDetails.value.bankName),l.append("ifscCode",this.bankDetails.value.IFSC),l.append("branch",this.bankDetails.value.branch),this.http.post(r,l).subscribe(t=>{console.log(t),this.router.navigate(["induction"])},t=>{console.log(t),t.error.error==='E11000 duplicate key error collection: test.finances index: pan_1 dup key: { pan: "cggpc1173E" }'&&alert("Pancard is already registered")})}skip(){this.router.navigate(["induction"])}};s.\u0275fac=function(l){return new(l||s)(fe(Qo),fe(Nt),fe(Wi))},s.\u0275cmp=_t({type:s,selectors:[["app-bank-details"]],decls:50,vars:1,consts:[[1,"skip-btn",3,"click"],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],[1,"form-main",3,"formGroup"],[1,"form-div-section"],["for","accountName"],["type","text","id","accountName","formControlName","accountName"],["for","accountNumber"],["type","number","id","accountNumber","formControlName","accountNumber"],["for","PANNumber"],["type","text","id","PANNumber","formControlName","PANNumber"],["for","bankName"],["type","text","id","bankName","formControlName","bankName"],["for","IFSC"],["type","text","id","IFSC","formControlName","IFSC"],["for","branch"],["type","text","id","branch","formControlName","branch"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"button",0),Pe("click",function(){return t.skip()}),$(1,"skip"),j(),V(2,"div",1)(3,"div",2)(4,"span",3),$(5,"Banking details"),j(),Me(6,"br")(7,"br"),V(8,"div",4)(9,"form",5)(10,"div",6)(11,"fieldset")(12,"legend",7),$(13," Account Name \xA0"),j(),Me(14,"input",8)(15,"br"),j()(),V(16,"div",6)(17,"fieldset")(18,"legend",9),$(19," Account Number \xA0"),j(),Me(20,"input",10)(21,"br"),j()(),V(22,"div",6)(23,"fieldset")(24,"legend",11),$(25," PAN Number \xA0"),j(),Me(26,"input",12)(27,"br"),j()(),V(28,"div",6)(29,"fieldset")(30,"legend",13),$(31," Bank name \xA0"),j(),Me(32,"input",14)(33,"br"),j()(),V(34,"div",6)(35,"fieldset")(36,"legend",15),$(37," IFSC \xA0"),j(),Me(38,"input",16)(39,"br"),j()(),V(40,"div",6)(41,"fieldset")(42,"legend",17),$(43," Branch \xA0"),j(),Me(44,"input",18)(45,"br"),j()()()(),V(46,"button",19),Pe("click",function(){return t.submit()}),$(47,"Submit"),j()(),Me(48,"br")(49,"br"),j()),l&2&&(ue(9),Fe("formGroup",t.bankDetails))},dependencies:[Io,ro,sb,ir,ko,Xo,Ga],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;justify-content:center;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:0%;left:0%;display:grid;grid-template-rows:max-content max-content;align-items:start;text-align:left}.tittle[_ngcontent-%COMP%]{float:left;font-family:Inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content}.form-main[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;flex-direction:column;gap:.9rem}fieldset[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.5rem}fieldset[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:.9rem;font-family:Inter,sans-serif;font-weight:400;line-height:1rem;flex-shrink:0;margin-right:10px;color:#030b33b3}input[_ngcontent-%COMP%]{flex-grow:1;outline:0;border-width:0 0 0 0;border-color:#000;font-size:1.1rem;padding:5px 0}.login-btn[_ngcontent-%COMP%]{height:3rem;width:90%;font-size:1.3rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:3rem;border:none;background-color:#d16611;position:fixed;top:90%;left:5%}.mat-mdc-text-field-wrapper.mdc-text-field.mdc-text-field--filled[_ngcontent-%COMP%]{background-color:transparent;height:5rem}']});let d=s;return d})();var Gm=(()=>{let s=class s{constructor(r){this.http=r,this.apiUrl=yn,this.apiForVideo=this.apiUrl+"admin"}getingVideos(){return this.http.get(`${this.apiForVideo}/training`)}gettingInductionVeideos(){return this.http.get(`${this.apiForVideo}/induction`)}getVideosByIds(r){let l=r.map(t=>this.http.get(`${this.apiForVideo}/training/${t}`).pipe(Vh(_=>(console.error(`Error fetching video for ID ${t}:`,_),sr(null)))));return Bx(l)}getInductionVideosByIds(r){let l=r.map(t=>this.http.get(`${this.apiForVideo}/induction/${t}`).pipe(Vh(_=>(console.error(`Error fetching video for ID ${t}:`,_),sr(null)))));return Bx(l)}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Eo=(()=>{let s=class s{constructor(r,l){this.http=r,this.location=l,this.apiUrl=yn,this.userId=localStorage.getItem("providerId"),this.userCredit=0}payWithRazorpay(r,l,t){let _={key:"rzp_test_b8XfUOQ4u8dlSq",amount:r*100,currency:t,name:"Coolie no.1",description:"Test Transaction",image:"assets/location/logo-v3 3.png",handler:I=>{console.log(I),this.addingCredit(r)},prefill:{name:"Customer Name",email:"customer@example.com",contact:"9999999999"},notes:{address:"Razorpay Corporate Office"},theme:{color:"#3399cc"},modal:{ondismiss:function(){console.log("Checkout form closed")},escape:!1,backdropclose:!1,handleback:!0}};new Razorpay(_).open()}createOrder(r){let l=new Ik({"Content-Type":"application/json"}),t={amount:r,currency:"INR",receipt:`receipt_${Date.now()}`},_=`${this.apiUrl}core/razor-pay/create-order`;return this.http.post(_,t,{headers:l})}addingCredit(r){let l=this.apiUrl+"providers/provider-credits/recharge",t={providerId:this.userId,amount:r};return this.http.post(l,t).subscribe(_=>{console.log(_),this.getNow()},_=>{console.log(_)})}getCredits(){let r=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get(r)}getNow(){this.getCredits().subscribe(r=>{console.log(r),this.userCredit=r.credits,this.location.back()},r=>{console.log(r)})}getCreditHistory(){let r=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get}setDefault(){this.userId="",this.userCredit=0}};s.\u0275fac=function(l){return new(l||s)(st(Wi),st(ii))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Cs=QM(iw());var qm=(()=>{let s=class s{setonlineStatus(r,l){this.onlineStatus=r,localStorage.setItem("onlineStatus",r.toString()),localStorage.setItem("onlineText",l)}getonlineStatus(){let r=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");return{status:r==="true",text:l||"Go"}}constructor(r,l){this.platformId=r,this.http=l,this.apiUrl=yn,this.destinationInput="",this.currentLocation=[0,0],this.directionsLayerId="directions",this.userCordinates=[0,0],this.onlineStatus=!1,Cs.default.accessToken="pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ"}ngOnInit(){this.initializeMap()}ngOnDestroy(){this.watchId&&navigator.geolocation.clearWatch(this.watchId)}initializeMap(){navigator.geolocation.getCurrentPosition(r=>{this.currentLocation=[r.coords.longitude,r.coords.latitude],console.log(this.currentLocation,"currect location"),this.map=new Cs.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:this.currentLocation,zoom:12}),this.map.addControl(new Cs.default.NavigationControl),this.userMarker=new Cs.default.Marker({color:"blue"}).setLngLat(this.currentLocation).setPopup(new Cs.default.Popup().setText("You are here")).addTo(this.map),this.watchId=navigator.geolocation.watchPosition(l=>{let t=[l.coords.longitude,l.coords.latitude];this.currentLocation=t,this.userMarker&&this.userMarker.setLngLat(t),this.userCordinates[0]!=0&&this.addDestinationMarker(this.userCordinates)},l=>{console.error("Error watching position:",l)})})}navigateToPlace(){if(!this.destinationInput){console.error("Please enter the destination address or coordinates.");return}if(/^(-?\d+(\.\d+)?),\s*(-?\d+(\.\d+)?)$/.test(this.destinationInput)){let[l,t]=this.destinationInput.split(",").map(_=>parseFloat(_.trim()));this.addDestinationMarker([l,t])}else fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(this.destinationInput)}.json?access_token=${Cs.default.accessToken}`).then(l=>{if(!l.ok)throw new Error("Network response was not ok");return l.json()}).then(l=>{if(l.features.length===0)throw new Error("No results found");let t=l.features[0].geometry.coordinates;this.addDestinationMarker(t)}).catch(l=>{console.error("Error fetching destination coordinates:",l),alert("Error: Could not find the location. Please check your input.")})}addDestinationMarker(r){console.log(r),this.destinationMarker&&this.destinationMarker.remove(),this.destinationMarker=new Cs.default.Marker({color:"red"}).setLngLat(r).setPopup(new Cs.default.Popup().setText(this.destinationInput)).addTo(this.map),this.map.flyTo({center:r,zoom:12}),this.getDirections(r)}getDirections(r){let l=`https://api.mapbox.com/directions/v5/mapbox/driving/${this.currentLocation[0]},${this.currentLocation[1]};${r[0]},${r[1]}?alternatives=true&geometries=geojson&steps=true&access_token=${Cs.default.accessToken}`;fetch(l).then(t=>{if(!t.ok)throw new Error("NoRoute");return t.json()}).then(t=>{if(console.log("Directions data:",t),t.routes.length===0)throw new Error("No routes found");this.map.getSource(this.directionsLayerId)&&(this.map.removeLayer(this.directionsLayerId),this.map.removeSource(this.directionsLayerId)),this.map.addSource(this.directionsLayerId,{type:"geojson",data:{type:"Feature",properties:{},geometry:t.routes[0].geometry}}),this.map.addLayer({id:this.directionsLayerId,type:"line",source:this.directionsLayerId,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"red","line-width":5}});let _=new Cs.default.LngLatBounds;t.routes[0].geometry.coordinates.forEach(C=>{_.extend(C)}),this.map.fitBounds(_,{padding:50})}).catch(t=>{console.error("Error fetching directions:",t),alert("Error: Could not find a route.")})}getCurrentLocation(){return new uo(r=>{navigator.geolocation.getCurrentPosition(l=>{let t=[l.coords.longitude,l.coords.latitude];console.log("current location inside getcurrent location",t),alert(t),this.getPlaceNameFromCoordinates(t),r.next(t),r.complete()},l=>{r.error(l)})})}getPlaceNameFromCoordinates(r){let t=`https://api.mapbox.com/geocoding/v5/mapbox.places/${r[0]},${r[1]}.json?access_token=pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ`;return new uo(_=>{fetch(t).then(C=>{if(!C.ok)throw console.error("Network response was not ok:",C.status,C.statusText),new Error(`Network response was not ok: ${C.status} ${C.statusText}`);return C.json()}).then(C=>{if(C.features.length===0)throw console.error("No results found:",C),new Error("No results found");let I=C.features[0].place_name;_.next(I),_.complete()}).catch(C=>{console.error("Error fetching place name:",C),_.error(C)})})}sendCordinates(r){let l=this.apiUrl+"providers/provider-cordinates",_={providerId:localStorage.getItem("providerId"),longitude:r[0],latitude:r[1]};return console.log(_),this.http.post(l,_)}};s.\u0275fac=function(l){return new(l||s)(st(dd),st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Sr=(()=>{let s=class s{constructor(r){this.http=r,this.oredrDetails=[],this.apiUrl=yn}getOrder(r){let l=this.apiUrl+`users/order/category/${r}`;return this.http.get(l)}getOrderDetails(r){return this.http.get("")}accept(r,l,t){let _={orderId:r,price:l,userId:t,providerId:localStorage.getItem("providerId")};console.log(_);let C=this.apiUrl+"users/order-history/accept-order";return this.http.post(C,_)}verifyOtp(){let r=this.apiUrl+"users/order-history/verify-start-order",l={orderId:this.orderIds};return this.http.post(r,l)}verifyStartOrder(r){let l=`${this.apiUrl}users/order-history/verify-start-order`;return this.http.post(l,r)}cancelOrder(){let r=this.apiUrl+"users/order-history/cancel-order",l={orderHistoryId:this.orderIds,providerId:localStorage.getItem("providerId"),reason:"nothing"};return console.log(l),this.http.post(r,l)}sendingImageBeforeWork(r){let l=`${this.apiUrl}users/order-history/before-work-upload-image`;return this.http.post(l,r)}completeOrder(r){let l=this.apiUrl+"users/order-history/order-completed-generateotp";return this.http.post(l,r)}verifyAfterComplete(r,l,t){let _=this.apiUrl+"users/order-history/order-completed-verify",C={orderHistoryId:l,orderId:t,otp:r};return console.log(C),this.http.post(_,C)}orderHistory(){let r=localStorage.getItem("providerId"),l=this.apiUrl+`users/order-history/provider/${r}`;return this.http.get(l)}setDefult(){this.orderIds="",this.oredrDetails=[],this.userFullAddress=""}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var zb=d=>({active:d}),Js=(()=>{let s=class s{constructor(r){this.router=r,this.activeIcon="home"}ngOnInit(){this.router.events.subscribe(r=>{r instanceof db&&this.setActiveIcon(r.urlAfterRedirects)}),this.setActiveIcon(this.router.url)}changeColor(r,l){this.activeIcon=r,this.router.navigate([l])}setActiveIcon(r){r.includes("home")?this.activeIcon="home":r.includes("ongoing")?this.activeIcon="Services":r.includes("earnings")?this.activeIcon="Activity":r.includes("target")&&(this.activeIcon="Account")}};s.\u0275fac=function(l){return new(l||s)(fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-fotter"]],decls:25,vars:12,consts:[[1,"fottersss"],[1,"sub-fotterss",3,"click","ngClass"],[1,"material-symbols-outlined","notranslate"],[1,"names"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),Pe("click",function(){return t.changeColor("home","home")}),V(2,"i",2),$(3,"home"),j(),$(4," \xA0 "),V(5,"span",3),$(6,"Home"),j()(),V(7,"div",1),Pe("click",function(){return t.changeColor("Services","ongoing")}),V(8,"i",2),$(9,"work_history"),j(),$(10,"\xA0 "),V(11,"span",3),$(12,"Ongoing"),j()(),V(13,"div",1),Pe("click",function(){return t.changeColor("Activity","earnings")}),V(14,"i",2),$(15,"payments"),j(),$(16,"\xA0 "),V(17,"span",3),$(18,"Earnings"),j()(),V(19,"div",1),Pe("click",function(){return t.changeColor("Account","target")}),V(20,"i",2),$(21,"ads_click"),j(),$(22,"\xA0 "),V(23,"span",3),$(24,"Target"),j()()()),l&2&&(ue(),Fe("ngClass",ci(4,zb,t.activeIcon==="home")),ue(6),Fe("ngClass",ci(6,zb,t.activeIcon==="Services")),ue(6),Fe("ngClass",ci(8,zb,t.activeIcon==="Activity")),ue(6),Fe("ngClass",ci(10,zb,t.activeIcon==="Account")))},dependencies:[Mo],styles:[".fottersss[_ngcontent-%COMP%]{border:0;width:100%;display:flex;justify-content:space-around;position:fixed;bottom:0;text-align:center;padding-top:.5rem;padding-bottom:.5rem;background-color:#fff}.sub-fotterss[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{font-size:2rem;color:#00000080}.names[_ngcontent-%COMP%]{display:none}.active[_ngcontent-%COMP%]{background-color:#d16611;border-radius:25px;padding:.5rem 1rem}.active[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{color:#fff}.active[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{display:block;color:#fff}"]});let d=s;return d})();var xz=["footer"],wz=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function Cz(d,s){if(d&1&&(V(0,"div")(1,"div",25),Me(2,"img",26),j()()),d&2){let u=s.$implicit;ue(2),Fe("src",u.image,Fn)}}function Sz(d,s){if(d&1&&(V(0,"div")(1,"span"),$(2),j(),V(3,"span"),Me(4,"i",30),$(5),j()()),d&2){let u=s.$implicit;ue(2),tb("",u.day,", ",u.month," ",u.date,""),ue(3),ki(" ",u.isWorking,"")}}function Mz(d,s){if(d&1){let u=Xt();V(0,"div",27),Bt(1,Sz,6,4,"div",11),V(2,"div",28),Pe("click",function(){mt(u);let l=rt();return pt(l.navToCal())}),V(3,"pre",29),$(4,"calendar_today"),j()()()}if(d&2){let u=rt();ue(),Fe("ngForOf",u.nextWorking)}}function kz(d,s){d&1&&(V(0,"span"),$(1,"No more jobs today"),j())}function Iz(d,s){if(d&1&&(V(0,"span"),$(1),j()),d&2){let u=rt();ue(),ki("",u.noOfPendingOrders," more jobs today")}}function Tz(d,s){if(d&1&&(V(0,"div")(1,"div",32)(2,"video",33),Me(3,"source",34),j()()()),d&2){let u=s.$implicit,r=rt(2);ue(3),Fe("src","https://"+r.bucketName+".s3."+r.region+".amazonaws.com/"+u.videoKey,Fn)}}function Ez(d,s){if(d&1&&(V(0,"div",31),Bt(1,Tz,4,1,"div",11),j()),d&2){let u=rt();ue(),Fe("ngForOf",u.data)}}function Dz(d,s){if(d&1&&Me(0,"ngx-loading",24),d&2){let u=rt();Fe("show",u.loading)("config",ib(2,wz))}}var AT=(()=>{let s=class s{ngOnInit(){let r=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");r!==null&&(this.online=r==="true"),l!==null&&(this.onlineText=l),this.isAccountVerify=this.logInService.isAccountVerify,this.trainingService.getingVideos().subscribe(t=>{console.log(t),this.data=t},t=>{console.log(t)})}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}navToCredit(){this.router.navigate(["credits"])}navToNotification(){this.router.navigate(["notification"])}navToCal(){this.router.navigate(["calender"])}constructor(r,l,t,_,C,I,O,N,q,ie,de){this.router=r,this.http=l,this.trainingService=t,this.logInService=_,this.userDetailsService=C,this.jobDetailsService=I,this.razorpayService=O,this.mapboxService=N,this.orderService=q,this.dialogService=ie,this.googleMapService=de,this.isDrawerOpen=!1,this.data=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.nextWorking=[],this.loading=!1,this.ads=[{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/documents/pancard.png"}],this.dates=[],this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.credits=0,this.online=!1,this.onlineText="Go",this.noOfPendingOrders=0,console.log(this.nextWorking.length),this.getBanners(),this.getProviderDetails(),this.workingDates(),this.getAvalibility(),this.getWork(),this.getCredit(),this.getPendingOrders()}getProviderDetails(){return Ln(this,null,function*(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),setTimeout(()=>{this.navToAboutUser()},2e3)})}navToAboutUser(){localStorage.getItem("providerId")||this.router.navigate(["selectAccount"]);let r;this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe(l=>{console.log(l),r=l,r&&!this.jobDetailsService.getcheckingDetails()&&(console.log("inside",this.jobDetailsService.getcheckingDetails()),this.dialogService.openDialog("Please add the details"),this.jobDetailsService.setCheckingDetails(!0),this.router.navigate(["aboutUser"]))}),console.log(r)}workingDates(){this.nextWorking=this.dates.splice(0,2),console.log(this.nextWorking)}getAvalibility(){this.jobDetailsService.getAvailability().subscribe(r=>{console.log(r),this.formattingAvailbility(r)},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),console.log(r._id),this.userDetailsService.workResponse=r.works,this.userDetailsService.workResponseId=r._id},r=>{console.log(r)})}formattingAvailbility(r){let l=new Date;for(let t=0;t<r.length;t++){let C=r[t].date.split("T")[0],I=new Date(C),O=this.dayNames[I.getDay()],N=this.monthNames[I.getMonth()],q=I.getFullYear(),ie=I.getDate();(I>=l||I.toDateString()===l.toDateString())&&(this.dates.some(xe=>xe.date===ie&&xe.day===O&&xe.month===N&&xe.year===q)||(this.dates.push({date:ie,day:O,month:N,year:q,isWorking:"working"}),this.dates.sort((xe,ke)=>{let Ae=this.monthNames.indexOf(xe.month),Xe=this.monthNames.indexOf(ke.month);if(Ae===-1||Xe===-1)return 0;let qe=new Date(xe.year,Ae,xe.date),ut=new Date(ke.year,Xe,ke.date);return qe.getTime()-ut.getTime()})))}this.workingDates()}getCredit(){this.razorpayService.getCredits().subscribe(r=>{console.log(r),this.razorpayService.userCredit=r.creditBalance,this.credits=r.credits},r=>{console.log(r)})}getBanners(){this.userDetailsService.getBanners().subscribe({next:r=>{console.log(r),this.ads=r},error:r=>{console.log(r)}})}onlineStatus(){try{this.loading=!0;let r=this.jobDetailsService.isVerify;console.log(r),this.online=!this.online,this.onlineText=this.online?"Off":"Go",this.googleMapService.onlineStatus=this.online,this.googleMapService.setonlineStatus(this.online,this.onlineText),localStorage.setItem("onlineStatus",this.online.toString()),localStorage.setItem("onlineText",this.onlineText),this.online&&this.googleMapService.getCoordinates().subscribe(l=>{console.log("Current Location:",l),this.sendCordinates(l),this.getname(l),alert(l?.lat),this.loading=!1},l=>{console.error("Error getting current location:",l),alert(l.error.message),this.loading=!1})}catch(r){console.error("Error in onlineStatus method:",r)}console.log(this.online)}getname(r){this.mapboxService.getPlaceNameFromCoordinates(r).subscribe(l=>{console.log("Place Name:",l),this.userDetailsService.currentCordinates=r,this.userDetailsService.currentLocation=l,this.mapboxService.placeName=l},l=>{console.error("Error getting place name:",l)})}sendCordinates(r){this.googleMapService.sendCordinates(r).subscribe({next:l=>{console.log(l),alert(l.message)},error:l=>{console.log(l),alert(l.errors.message)}})}sendTokens(){let r="",l={};this.http.post(r,l).subscribe(t=>{console.log(t)},t=>{console.log(t)})}getPendingOrders(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r);let t=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-"),_="Accepted",C=r.data.filter(I=>{let O=I.orderId.items[0].scheduledDate.split(" ")[0];return console.log("scheduleee================",O),I.status.toLowerCase().includes(_.toLowerCase())&&O===t});console.log("filtered",C),this.noOfPendingOrders=C.length},error:r=>{console.log(r)}})}};s.\u0275fac=function(l){return new(l||s)(fe(Nt),fe(Wi),fe(Gm),fe(Wn),fe(Gn),fe(Cr),fe(Eo),fe(qm),fe(Sr),fe(zn),fe(Ks))},s.\u0275cmp=_t({type:s,selectors:[["app-home"]],viewQuery:function(l,t){if(l&1&&bi(xz,5),l&2){let _;gi(_=_i())&&(t.footer=_.first)}},decls:60,vars:12,consts:[[1,"container"],[1,"header"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets/logo/credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"ads-div"],[1,"wrapperrr"],[4,"ngFor","ngForOf"],[1,"sub-divs"],["class","availability-div",4,"ngIf"],[1,"new-jobs"],[1,"text-div"],[1,"icon-div"],[1,"more-jobs"],[1,"text-div1"],[1,"pending-task-div"],[1,"quick-links"],["routerLinkActive","help",1,"helps",3,"routerLink"],["id","video-div",4,"ngIf"],[2,"height","5rem"],[3,"show","config"],[1,"slidesss"],[3,"src"],[1,"availability-div"],[3,"click"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"fa","fa-circle",2,"font-size","10px"],["id","video-div"],["id","video-slidess"],["controls","","id","videoss"],["type","video/mp4",3,"src"]],template:function(l,t){l&1&&(V(0,"div",0),Me(1,"br"),V(2,"div",1)(3,"div",2),Pe("click",function(){return t.toggleDrawer()}),$(4,"\u2630"),j(),V(5,"div",3)(6,"div",4),Pe("click",function(){return t.navToCredit()}),Me(7,"img",5),V(8,"pre"),$(9),_k(10,"number"),j()(),V(11,"div",6),Pe("click",function(){return t.navToNotification()}),V(12,"span",7),$(13,"notifications"),j()()()(),Me(14,"br"),V(15,"div",8)(16,"div",9)(17,"div",10),Bt(18,Cz,3,1,"div",11),j()(),V(19,"div",12),Bt(20,Mz,5,1,"div",13),V(21,"div")(22,"div",14)(23,"div",15)(24,"span"),$(25,"No new jobs"),j(),V(26,"span"),$(27,"5 jobs missed recently"),j()(),V(28,"div",16)(29,"span",7),$(30,"arrow_forward_ios"),j()()(),Me(31,"br"),V(32,"div",17)(33,"div",18),Bt(34,kz,2,0,"span")(35,Iz,2,1),j(),V(36,"div",16)(37,"span",7),$(38,"arrow_forward_ios"),j()()()(),V(39,"div",19)(40,"span"),$(41,"Pending Tasks"),j(),Me(42,"br")(43,"br"),V(44,"p"),$(45," 80 subscription jobs . 4days left to buy job pack now "),j(),V(46,"p"),$(47," Only 50 credits left.Recharge credits to get new jobs "),j()(),V(48,"div",20)(49,"div")(50,"span"),$(51,"Quick links"),j()(),V(52,"div",21)(53,"span"),$(54,"Help?"),j()()(),Bt(55,Ez,2,1,"div",22),j()()(),Me(56,"div",23)(57,"router-outlet")(58,"app-fotter"),Bt(59,Dz,1,3,"ngx-loading",24)),l&2&&(Mi("overlap",t.isDrawerOpen),ue(9),Ft(t.credits%1===0?t.credits:bk(10,9,t.credits,"1.2-2")),ue(9),Fe("ngForOf",t.ads),ue(2),Fe("ngIf",t.nextWorking.length!=0),ue(14),Dn(34,t.noOfPendingOrders===0?34:35),ue(18),Fe("routerLink","/help"),ue(3),Fe("ngIf",t.isAccountVerify),ue(4),Dn(59,t.loading?59:-1))},dependencies:[Vr,fr,hb,ub,mb,Fb,Js,Mk],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;transition:padding-left .3s ease;margin-top:0}#drawer[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000;color:red;padding:20px;box-sizing:border-box;transition:transform .3s ease;transform:translate(-100%);z-index:2}#drawer.open[_ngcontent-%COMP%]{transform:translate(0);overlay:auto}.header[_ngcontent-%COMP%]{margin-top:0rem;width:90%;display:flex;justify-content:space-between}#menu-button[_ngcontent-%COMP%]{cursor:pointer;z-index:2;color:#d16611;font-size:24px}.list-menu[_ngcontent-%COMP%]{list-style-type:none;font-size:1rem;font-weight:400;font-family:Roboto Condensed}.bell-credit[_ngcontent-%COMP%]{width:max-content;height:2.5rem;display:flex;justify-content:space-between;gap:.5rem;border-radius:.2rem}.package[_ngcontent-%COMP%]{width:max-content;padding:0 .5rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]{width:max-content;padding:0 .5rem;display:flex;justify-content:space-evenly;align-items:center;gap:.3rem;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center;border-radius:.4rem}.sub-container[_ngcontent-%COMP%]{width:95%;height:90vh;overflow-y:auto;scroll-snap-type:y;scroll-behavior:smooth;scrollbar-width:none}.sub-divs[_ngcontent-%COMP%]{margin-top:1rem;display:grid;row-gap:1.4rem}.ads-div[_ngcontent-%COMP%]{display:flex;height:7rem;width:100%}.wrapperrr[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}.slidesss[_ngcontent-%COMP%]{width:100%;height:100%}.slidesss[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:auto;object-fit:cover}.availability-div[_ngcontent-%COMP%]{width:98%;height:max-content;display:flex;column-gap:4%;row-gap:0;align-items:center;margin-left:.5rem;justify-content:space-between}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:22px;text-align:left}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22px;text-align:left}.new-jobs[_ngcontent-%COMP%]{width:100%;height:5rem;background-color:#d70d09;border-radius:1.3rem;color:#f5f5f5;display:flex;justify-content:space-between;align-items:center}.text-div[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;row-gap:0rem;text-align:left;align-items:center;padding-left:2rem}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(1), .pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .quick-links[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .text-div1[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.4rem;font-weight:500}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(2){font-family:Inter,sans-serif;font-size:.95rem;font-weight:400}.icon-div[_ngcontent-%COMP%]{width:30%;display:flex;justify-content:center;align-items:center}.more-jobs[_ngcontent-%COMP%]{width:100%;height:4rem;background-color:#d70d09;border-radius:1.3rem;color:#fff;display:flex;align-items:center;justify-content:space-between}.text-div1[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;align-items:center;padding-left:2rem}.pending-task-div[_ngcontent-%COMP%]{text-align:left}.pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:15px;font-weight:400;line-height:16.94px;letter-spacing:.05em;text-align:left}.quick-links[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.helps[_ngcontent-%COMP%]{width:6rem;height:3rem;background-color:#20193f;color:#fff;display:flex;justify-content:center;align-items:center;border-radius:1.8rem}#video-div[_ngcontent-%COMP%]{width:100%;height:10rem;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}video[_ngcontent-%COMP%]{width:100vw;height:10rem;object-fit:cover;cursor:pointer}.online[_ngcontent-%COMP%]{background-color:#d16611;width:6rem;height:6rem;border-radius:50%;position:fixed;bottom:70px;left:40%;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:500;color:#fff;overflow:hidden}.online[_ngcontent-%COMP%]:before{content:"";position:absolute;width:50%;height:50%;border:.2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_wave 1.9s ease-out infinite;pointer-events:none}@keyframes _ngcontent-%COMP%_wave{50%{transform:scale(1);width:50%;height:50%}60%{transform:scale(1.5);width:60%;height:60%}70%{transform:scale(2);width:70%;height:70%}to{transform:scale(2.5);width:100%;height:100%}}']});let d=s;return d})();var Az=d=>({active:d});function Pz(d,s){if(d&1){let u=Xt();V(0,"button",14),Pe("click",function(){let l=mt(u).$implicit,t=rt();return pt(t.setActiveButton(l))}),$(1),j()}if(d&2){let u=s.$implicit,r=rt();Fe("ngClass",ci(2,Az,r.activeButton===u)),ue(),ki(" ",u," ")}}function Oz(d,s){if(d&1&&(V(0,"div",15)(1,"span",16)(2,"span",17),$(3),j(),V(4,"span",18),$(5),j()(),V(6,"span",18),$(7),j()(),Me(8,"div",19)),d&2){let u=s.$implicit;ue(3),Ft(u.date),ue(2),Ft(u.details),ue(2),Ft(u.amount)}}var PT=(()=>{let s=class s{navBack(){this.location.back()}navToAddCredit(){this.router.navigate(["addCredit"])}constructor(r,l,t){this.location=r,this.router=l,this.razorpayServie=t,this.buttons=["All","Recharge","Expenses","Penalties"],this.activeButton="All",this.history=[],this.filteredCreditHistory=[],this.credits=this.razorpayServie.userCredit,console.log(this.razorpayServie.userCredit),this.getCredit()}setActiveButton(r){this.activeButton=r,this.filter(this.activeButton)}getCredit(){this.razorpayServie.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits,this.history=r.transactions,this.filteredCreditHistory=this.history},error:r=>{console.log(r)}})}filter(r){let l=this.history,t;r!="All"?(t=l.filter(_=>_.type.toLowerCase().includes(r.toLowerCase())),this.filteredCreditHistory=t):this.filteredCreditHistory=l,console.log(this.filteredCreditHistory)}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Nt),fe(Eo))},s.\u0275cmp=_t({type:s,selectors:[["app-credit"]],decls:24,vars:2,consts:[[1,"container"],[1,"header"],[1,"arrow_back",3,"click"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"logo"],["src","assets\\documents\\credit bg.png"],[1,"credit"],[1,"credit-details"],[3,"click"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content"],[1,"content-div"],[3,"click","ngClass"],[1,"sub-content-div"],[1,"span-div"],[1,"highlight"],[1,"normal-text"],[1,"line"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2),Pe("click",function(){return t.navBack()}),V(3,"span",3),$(4,"arrow_back"),j()(),V(5,"div",4),Me(6,"img",5),j()(),V(7,"div",6)(8,"div",7)(9,"span"),$(10,"Credit balance :"),j(),$(11,"\xA0 "),V(12,"span"),$(13),j()(),V(14,"div")(15,"button",8),Pe("click",function(){return t.navToAddCredit()}),$(16,"Add+"),j()()(),V(17,"div",9)(18,"div",10),Bt(19,Pz,2,4,"button",11),j(),V(20,"div",12)(21,"div",13),mr(22,Oz,9,3,null,null,Zr),j()()()()),l&2&&(ue(13),Ft(t.credits),ue(6),Fe("ngForOf",t.buttons),ue(3),pr(t.filteredCreditHistory))},dependencies:[Mo,Vr],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh;align-items:center;text-align:center;display:grid;grid-template-rows:max-content max-content auto;row-gap:2rem;gap:2rem;grid-gap:2rem}.header[_ngcontent-%COMP%]{border:1px solid black;width:90%;height:10rem;display:flex;position:relative;left:5%;top:10%;border-radius:.8rem}.arrow_back[_ngcontent-%COMP%]{width:10%;position:relative;top:8%;left:2%}.logo[_ngcontent-%COMP%]{width:90%;display:flex;justify-content:center;align-items:center}.credit[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;justify-content:space-between;position:relative;left:5%}.credit-details[_ngcontent-%COMP%]{float:left;text-align:left}.credit-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter" sans-serif;font-weight:500;line-height:1.2rem}.credit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:2rem;background-color:#5ba36b;color:#fff;border:none;border-radius:.6rem}.sub-container[_ngcontent-%COMP%]{width:90%;height:70vh;position:relative;left:5%}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:2px solid #f40905}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content[_ngcontent-%COMP%]{width:100%;margin-top:.8rem}.content-div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-content-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.span-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.highlight[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:16.94px;text-align:left}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px;text-align:left}.line[_ngcontent-%COMP%]{margin-top:.5rem;border:none;border-bottom:.25px solid black}']});let d=s;return d})();function Rz(d,s){d&1&&(V(0,"span"),$(1,"Name"),j())}function Lz(d,s){if(d&1&&(V(0,"span"),$(1),j()),d&2){let u=rt();ue(),Ft(u.userName)}}function Fz(d,s){if(d&1){let u=Xt();Me(0,"br"),V(1,"div",12),Pe("click",function(){let l=mt(u).$implicit,t=rt();return pt(t.navTo(l.name))}),V(2,"div",12),Pe("click",function(){let l=mt(u).$implicit,t=rt();return pt(t.navTo(l.name))}),V(3,"span",11),$(4),j(),$(5," \xA0 \xA0 "),V(6,"span"),$(7),j()(),V(8,"span",11),$(9,"arrow_forward_ios"),j()(),Me(10,"hr")}if(d&2){let u=s.$implicit;ue(4),Ft(u.icon),ue(3),Ft(u.name)}}var OT=(()=>{let s=class s{constructor(r,l,t,_,C,I,O,N){this.location=r,this.router=l,this.loginService=t,this.jobDetailsService=_,this.ordersService=C,this.razorpayService=I,this.userDetals=O,this.dialougeService=N,this.userName="",this.userImage="",this.whatsAppStaus="on",this.providerRating="",this.options=[{icon:"calendar_today",name:"Calendar"},{icon:"work",name:"Job History"},{icon:"poker_chip",name:"Credits"},{icon:"tv_gen",name:"Training"},{icon:"featured_seasonal_and_gifts",name:"Invite a friend"},{icon:"question_mark",name:"Help Center"},{icon:"emoji_events",name:"Certificate & documents"}]}ngOnInit(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),this.getUsername(),this.getProviderRating()}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r),this.providerRating=r.averageRating},error:r=>{console.log(r)}})}getUsername(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r)},complete:()=>{this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image,console.log(this.jobDetailsService.userDetails),console.log(this.userName),this.apiSubscription?.unsubscribe()}})}navTo(r){switch(console.log(r),r){case"Calendar":this.router.navigate(["calender"]);break;case"Job History":this.router.navigate(["jobHistory"]);break;case"Credits":console.log("inside"),this.router.navigate(["credits"]);break;case"Training":this.router.navigate(["training"]);break;case"Invite a friend":this.router.navigate(["referAndEarn"]);break;case"Help Center":this.router.navigate(["help"]);break;case"Certificate & documents":this.router.navigate(["awards"]);break;case"packages":this.router.navigate(["packages"]);break;default:console.log("No matching case found")}}navToFinancial(){this.router.navigate(["financialDetails"])}navBack(){this.location.back()}navToVisiting(){let r=localStorage.getItem("providerId");this.userDetals.getUserDetails(r).subscribe({next:l=>{console.log(l),this.router.navigate(["visitingCard"])},error:l=>{console.log(l),this.dialougeService.openDialog("Provider details are missing"),this.router.navigate(["aboutUser"])}})}logOut(){this.jobDetailsService.setDefault(),this.loginService.setDefult(),this.ordersService.setDefult(),this.razorpayService.setDefault(),this.userDetals.setDefult(),this.loginService.removeUser(),this.router.navigate(["selectAccount"]),localStorage.clear()}statusChange(){this.whatsAppStaus==="on"?this.whatsAppStaus="off":(this.whatsAppStaus="off")&&(this.whatsAppStaus="on")}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Nt),fe(Wn),fe(Cr),fe(Sr),fe(Eo),fe(Gn),fe(zn))},s.\u0275cmp=_t({type:s,selectors:[["app-menu"]],decls:66,vars:5,consts:[[1,"material-symbols-outlined","notranslate",3,"click"],[1,"container"],[1,"sub-container"],[1,"profile"],[1,"image"],[1,"profile-img",3,"src"],[1,"details"],[1,"details-div"],[1,"package",3,"click"],["src","assets/packages/silver coin 1.png",1,"package-img"],[1,"rating"],[1,"material-symbols-outlined","notranslate"],[3,"click"],[1,"category"],[1,"updates"],[1,"finacial",3,"click"],[1,"iconss"],[1,"finacial"],[1,"fa","fa-whatsapp"],["routerLinkActive","language",1,"finacial",3,"routerLink"],[1,"btn",3,"click"]],template:function(l,t){l&1&&(Me(0,"br")(1,"br"),$(2,"\xA0\xA0 \xA0"),V(3,"span",0),Pe("click",function(){return t.navBack()}),$(4,"arrow_back"),j(),Me(5,"br")(6,"br"),V(7,"div",1)(8,"div",2)(9,"div",3)(10,"div",4),Me(11,"img",5),j(),V(12,"div",6)(13,"div",7),Bt(14,Rz,2,0,"span")(15,Lz,2,1),V(16,"span",8),Pe("click",function(){return t.navTo("packages")}),Me(17,"img",9),$(18,"\xA0 "),V(19,"pre"),$(20,"Silver"),j()()(),V(21,"div",10)(22,"span",11),$(23,"star"),j(),$(24),j(),V(25,"button",12),Pe("click",function(){return t.navToVisiting()}),$(26,"View more"),j()()(),Me(27,"br"),V(28,"div",13),mr(29,Fz,11,2,null,null,Zr),j(),Me(31,"br"),V(32,"div",14)(33,"div",15),Pe("click",function(){return t.navToFinancial()}),V(34,"div",16)(35,"span",11),$(36,"currency_rupee"),j()(),V(37,"div")(38,"span"),$(39,"Financial details"),j(),Me(40,"br"),$(41," GST,PAN and bank information "),j()(),V(42,"div",17)(43,"div",16),Me(44,"span",18),j(),V(45,"div")(46,"span"),$(47,"Send whatsApp updates"),j(),Me(48,"br"),V(49,"span",12),Pe("click",function(){return t.statusChange()}),$(50),j()()(),V(51,"div",19)(52,"div",16)(53,"span",11),$(54,"g_translate"),j()(),V(55,"div")(56,"span"),$(57,"Change language"),j(),Me(58,"br"),$(59," English "),j()()(),Me(60,"br"),V(61,"div",20),Pe("click",function(){return t.logOut()}),V(62,"button")(63,"span",11),$(64,"power_settings_new"),j(),$(65,"\xA0 Logout"),j()()()()),l&2&&(ue(11),Fe("src",t.userImage?t.userImage:"assets/logo/profile.png",Fn),ue(3),Dn(14,t.userName===""?14:15),ue(10),Ft(t.providerRating),ue(5),pr(t.options),ue(21),Ft(t.whatsAppStaus),ue(),Fe("routerLink","/language"))},dependencies:[ub,mb],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%}.profile[_ngcontent-%COMP%]{width:100%;height:9rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile-img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:column;text-align:left;gap:.5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.5rem;font-family:"Inter" sans-serif;font-weight:500}.details-div[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}.details[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;width:max-content;border-bottom:2px solid black;display:flex;align-items:center}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:max-content;align-items:center}.category[_ngcontent-%COMP%]{width:100%}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .finacial[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.updates[_ngcontent-%COMP%]{border:.25px solid black;width:100%;height:11.5rem;border-radius:.5rem;display:flex;flex-direction:column;align-items:center;justify-content:center}.finacial[_ngcontent-%COMP%]{display:flex;width:100%;height:3.2rem}.iconss[_ngcontent-%COMP%]{width:20%;display:flex;justify-content:center;align-items:center;text-align:center}.iconss[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;display:flex;align-items:center}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;color:red}']});let d=s;return d})();function zz(d,s){d&1&&(V(0,"span"),$(1,"Name"),j())}function Bz(d,s){if(d&1&&(V(0,"span"),$(1),j()),d&2){let u=rt();ue(),Ft(u.userName)}}function Nz(d,s){if(d&1&&$(0),d&2){let u=rt().$implicit;ki(" ",u.categoryId.name," ")}}function Vz(d,s){if(d&1&&(V(0,"span"),Bt(1,Nz,1,1),j()),d&2){let u=s.index;ue(),Dn(1,u<2?1:-1)}}function jz(d,s){if(d&1&&Bt(0,Vz,2,1,"span",19),d&2){let u=rt();Fe("ngForOf",u.workSeleceted)}}var RT=(()=>{let s=class s{constructor(r,l,t,_,C){this.router=r,this.location=l,this.jobDetailsService=t,this.logInService=_,this.userService=C,this.userImage="",this.userName="",this.userId=localStorage.getItem("providerId"),this.workSeleceted=this.jobDetailsService?.userDetails?.work,this.providerRating="",this.certificateImages=[{images:"assets/demo/awards.png"},{images:"assets/demo/certificate2.png"}]}ngOnInit(){this.signingDetails(),this.getWork(),this.getCertificates(),this.getProviderRating()}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r),this.providerRating=r.averageRating},error:r=>{console.log(r)}})}signingDetails(){this.phoneNumber=this.jobDetailsService.userDetails?.phone,this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works},r=>{console.log(r)})}getCertificates(){let r=localStorage.getItem("providerId");this.userService.getCertificated(r).subscribe({next:l=>{console.log(l);let t=[];for(let _=0;_<l.length;_++){let C=l[_];t.push({images:C.image})}this.certificateImages=t},error:l=>{console.log(l)},complete:()=>{this.apiSubscription?.unsubscribe()}})}navTo(){this.router.navigate(["manageServices"])}navToBack(){this.location.back()}navToVerification(){this.logInService.isAccountVerify?this.router.navigate(["identityVerification"]):this.router.navigate(["aadharVerify"])}navToCertificates(){this.router.navigate(["awards"])}};s.\u0275fac=function(l){return new(l||s)(fe(Nt),fe(ii),fe(Cr),fe(Wn),fe(Gn))},s.\u0275cmp=_t({type:s,selectors:[["app-visiting-card"]],decls:67,vars:8,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"sub-container"],[1,"profile"],[1,"image"],["alt","User Image",3,"src"],[1,"details"],[1,"rating"],[1,"category"],[1,"ids"],[1,"tittle"],[1,"ids",3,"click"],[3,"click"],[1,"tittle2"],[1,"material-symbols-outlined","notranslate"],[1,"awards-div"],[1,"awards"],[3,"src"],[2,"height","3rem"],[4,"ngFor","ngForOf"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Pe("click",function(){return t.navToBack()}),$(2,"arrow_back"),j(),Me(3,"br"),V(4,"div",2)(5,"div",3)(6,"div",4),Me(7,"img",5),j(),V(8,"div",6),Bt(9,zz,2,0,"span")(10,Bz,2,1),V(11,"div",7),$(12),j(),Bt(13,jz,1,1,"span"),j()(),V(14,"div",8)(15,"div")(16,"div",9)(17,"span",10),$(18,"My Id"),j(),V(19,"span",10),$(20),j()(),Me(21,"hr"),j(),V(22,"div")(23,"div",11),Pe("click",function(){return t.navTo()}),V(24,"span",10),$(25,"Manage Service"),j(),V(26,"span",10),$(27,"+"),j()(),Me(28,"hr"),j(),V(29,"div")(30,"div",9)(31,"div",12),Pe("click",function(){return t.navToVerification()}),V(32,"span",10),$(33,"Identity verification"),j(),Me(34,"br"),V(35,"span",13),$(36,"Identity Proof and Personal details"),j()(),V(37,"span",14),$(38,"arrow_forward_ios"),j()()()(),V(39,"div",15)(40,"span"),$(41,"Award and certificate "),j(),V(42,"div",16)(43,"div"),Me(44,"img",17),j(),V(45,"div"),Me(46,"img",17),j()(),V(47,"span",12),Pe("click",function(){return t.navToCertificates()}),$(48,"View More"),j()(),V(49,"div",15)(50,"span"),$(51,"Contact Details"),j(),V(52,"div"),Me(53,"hr"),j(),V(54,"div")(55,"pre"),$(56,"Phone"),j(),V(57,"span"),$(58),j()(),V(59,"div")(60,"pre"),$(61,"Email"),j(),V(62,"span"),$(63,"abcdgmail.com"),j()()()()(),Me(64,"br")(65,"br")(66,"div",18)),l&2&&(ue(7),Fe("src",t.userImage?t.userImage:"assets/logo/profile.png",Fn),ue(2),Dn(9,t.userName===""?9:10),ue(3),ki(" \u2605 ",t.providerRating," "),ue(),Dn(13,t.workSeleceted?13:-1),ue(7),Ft(t.userId),ue(24),Fe("src",t.certificateImages[0].images,Fn),ue(2),Fe("src",t.certificateImages[0].images,Fn),ue(12),Ft(t.phoneNumber))},dependencies:[Vr],styles:['.container[_ngcontent-%COMP%]{width:100%;margin-bottom:3rem}.material-symbols-outlined[_ngcontent-%COMP%]{margin:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%;display:grid;row-gap:2rem}.profile[_ngcontent-%COMP%]{width:100%;height:8rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;height:5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:1.3rem;align-items:center;text-align:left}.category[_ngcontent-%COMP%]{width:100%;padding:.5rem;display:flex;flex-direction:column;gap:.8rem}.work-names[_ngcontent-%COMP%]{border:1px solid red;width:100%;display:flex;flex-direction:row}.ids[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;justify-content:space-between;margin-top:.5rem;margin-bottom:.5rem}.tittle[_ngcontent-%COMP%], .awards-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter"sans-serif;font-weight:500}.tittle2[_ngcontent-%COMP%], pre[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter"sans-serif;font-weight:400}.awards-div[_ngcontent-%COMP%]{display:grid;row-gap:1rem;border:.25px solid black;border-radius:.5rem;padding:1rem}.awards[_ngcontent-%COMP%]{width:100%;border:1px solid black;display:flex;justify-content:space-between}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:48%;height:141px}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}hr[_ngcontent-%COMP%]{color:#000}']});let d=s;return d})();var LT=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r){this.location=r}};s.\u0275fac=function(l){return new(l||s)(fe(ii))},s.\u0275cmp=_t({type:s,selectors:[["app-refer-and-earn"]],decls:54,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"refer-div"],[1,"refer"],[1,"tittle1"],["src","assets\\documents\\invite.png"],[1,"dot"],[1,"line"],[1,"links"],["src","assets\\logo\\whatsup.png"],[1,"material-symbols-outlined","notranslate"],[1,"how"],[1,"steps-div"],[1,"steps"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Pe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Refer and Earn"),j()(),V(7,"div",4)(8,"div",5)(9,"div",6)(10,"div")(11,"span",7),$(12,"Refer and get FREE services "),j(),V(13,"p"),$(14,"Invite your to our company off.You win \u20B9 500 once they take services.They get instant \u20B9 500 "),j()(),V(15,"div"),Me(16,"img",8),j()(),V(17,"div",9),Me(18,"div",10),V(19,"span"),$(20,"Refer via"),j(),Me(21,"div",10),j(),V(22,"div",11)(23,"div"),Me(24,"img",12)(25,"br"),V(26,"span"),$(27,"Whatsapp"),j()(),V(28,"div")(29,"span",13),$(30,"link"),j(),Me(31,"br"),V(32,"span"),$(33,"Link"),j()()()(),V(34,"div",14)(35,"span",7),$(36,"How it works?"),j(),Me(37,"br"),V(38,"div",15)(39,"div",16)(40,"div"),$(41,"1"),j(),V(42,"span"),$(43,"Invite your friends & get rewarded"),j()(),V(44,"div",16)(45,"div"),$(46,"2"),j(),V(47,"span"),$(48,"They get free service on first order"),j()(),V(49,"div",16)(50,"div"),$(51,"3"),j(),V(52,"span"),$(53,"You get reward once their service is completed"),j()()()()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{float:left;font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.refer-div[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.5rem}.refer[_ngcontent-%COMP%]{padding:1rem;width:90%;height:max-content;display:flex;border-radius:.4rem}.refer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:92px;height:92px}.dot[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto max-content auto}.dot[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1rem;font-weight:500;line-height:14.52px}.line[_ngcontent-%COMP%]{margin-top:8px;border:none;border-top:1.2px dashed rgb(91,90,90)}.links[_ngcontent-%COMP%]{display:flex;justify-content:space-around;padding:1rem}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px}.how[_ngcontent-%COMP%]{width:90%;height:max-content;padding:1rem;border:.25px solid black;border-radius:.5rem;display:grid;text-align:left}.how[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.steps-div[_ngcontent-%COMP%]{display:grid;row-gap:1.5rem}.steps[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#49a010;color:#fff;align-items:center}.steps[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:80%}']});let d=s;return d})();function Uz(d,s){d&1&&(V(0,"div",13)(1,"span"),$(2,"+"),j(),V(3,"span"),$(4,"Add Photo"),j()())}function Hz(d,s){if(d&1&&Me(0,"img",14),d&2){let u=rt();Fe("src",u.imagePreview,Fn)}}function Wz(d,s){d&1&&(V(0,"div",13)(1,"span"),$(2,"+"),j(),V(3,"span"),$(4,"Add Documents"),j()())}function Gz(d,s){if(d&1&&Me(0,"img",14),d&2){let u=rt();Fe("src",u.documentPreview,Fn)}}function qz(d,s){if(d&1&&(V(0,"div",12),Me(1,"img",15),j()),d&2){let u=s.$implicit;ue(),Fe("src",u.image,Fn)}}var FT=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r,l,t,_){this.location=r,this.http=l,this.fb=t,this.userDetalsService=_,this.apiUrl=yn,this.items=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.userId=localStorage.getItem("providerId"),this.selectedFile=null,this.selectedDocument=null,this.base64Image=null,this.imagePreview=null,this.documentPreview=null,this.getCertificates(),this.imageForm=this.fb.group({image:"",user:this.userId,isverified:!1}),console.log(this.items)}onFileSelected(r){let l=r.target;if(l.files&&l.files.length>0){this.selectedFile=l.files[0],this.imagePreview=l.files[0];let t=l.files[0],_=new FileReader;_.onload=()=>{this.imagePreview=_.result},_.readAsDataURL(this.selectedFile),console.log("image",this.imagePreview),this.imageForm.value.image=t}this.sending()}onDocumentSelected(r){let l=r.target;if(l.files&&l.files.length>0){this.selectedDocument=l.files[0],this.imagePreview=l.files[0];let t=l.files[0],_=new FileReader;_.onload=()=>{this.imagePreview=_.result},_.readAsDataURL(this.selectedDocument),console.log("image",this.imagePreview),this.imageForm.value.image=t}this.sending()}sending(){console.log("sending doc");let r=new FormData;r.append("image",this.imageForm.value.image),r.append("isVerified",this.imageForm.value.isverified),r.append("providerId",this.imageForm.value.user);let l=this.apiUrl+"providers/provider-certificate";this.http.post(l,r).subscribe({next:t=>{console.log(t),this.getCertificates()},error:t=>{console.log(t)}})}getCertificates(){this.userDetalsService.getCertificated(this.userId).subscribe({next:r=>{console.log(r),this.items=r,console.log(this.items[0].image)},error:r=>{console.log(r)},complete:()=>{this.apiSubscription?.unsubscribe()}})}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Wi),fe(Qo),fe(Gn))},s.\u0275cmp=_t({type:s,selectors:[["app-awards"]],decls:22,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"addPhoto"],["for","file-input",1,"file-label"],["class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],[3,"formGroup"],["type","file","id","file-input","required","",1,"file-input",3,"change"],["type","file","id","document-inputs","required","",1,"file-input",3,"change"],[1,"awards"],[1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"],["alt","Image from AWS S3",3,"src"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Pe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0\xA0 "),V(5,"span",3),$(6,"Certificate and Documents"),j()(),V(7,"div",4)(8,"div",5)(9,"label",6),Bt(10,Uz,5,0,"div",7)(11,Hz,1,1,"img",8),j(),V(12,"form",9)(13,"input",10),Pe("change",function(C){return t.onFileSelected(C)}),j()()(),V(14,"div",5)(15,"label",6),Bt(16,Wz,5,0,"div",7)(17,Gz,1,1,"img",8),j(),V(18,"form",9)(19,"input",11),Pe("change",function(C){return t.onDocumentSelected(C)}),j()()(),mr(20,qz,2,1,"div",12,Zr),j()()),l&2&&(ue(10),Fe("ngIf",!t.selectedFile),ue(),Fe("ngIf",t.selectedFile),ue(),Fe("formGroup",t.imageForm),ue(4),Fe("ngIf",!t.selectedDocument),ue(),Fe("ngIf",t.selectedDocument),ue(),Fe("formGroup",t.imageForm),ue(2),pr(t.items))},dependencies:[fr,Io,ko,Xo],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-columns:auto auto;row-gap:30px;column-gap:30px;align-items:center;text-align:center;justify-content:space-around}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.addPhoto[_ngcontent-%COMP%]{width:8.5rem;height:8rem;display:grid;align-items:center;border:1px dashed black}span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:600;line-height:19px}.awards[_ngcontent-%COMP%]{width:8.5rem;height:8rem}.awards[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.placeholder-image[_ngcontent-%COMP%]{display:grid;row-gap:1rem}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}']});let d=s;return d})();var $z=["path"],Yz=Math.PI/180,Zz=(()=>{let s=class s{constructor(r){this.supportsSvg=!!(r&&r.createElementNS&&r.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),this.base=r&&r.head.querySelector("base"),this.hasPerf=typeof window<"u"&&window.performance&&window.performance.now&&typeof window.performance.now()=="number"}resolveColor(r){if(this.base&&this.base.href){let l=r.indexOf("#");if(l>-1&&r.indexOf("url")>-1)return r.slice(0,l)+location.href+r.slice(l)}return r}getTimestamp(){return this.hasPerf?window.performance.now():Date.now()}getArc(r,l,t,_,C=!1){let I=Math.max(0,Math.min(r||0,l)),O=C?180:359.9999,N=l===0?O:I/l*O,q=this._polarToCartesian(_,t,N),ie=this._polarToCartesian(_,t,0),de=N<=180?0:1;return`M ${q} A ${t} ${t} 0 ${de} 0 ${ie}`}_polarToCartesian(r,l,t){let _=(t-90)*Yz,C=r+l*Math.cos(_),I=r+l*Math.sin(_);return C+" "+I}};s.\u0275fac=function(l){return new(l||s)(st(mn,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),zT={radius:125,animation:"easeOutCubic",animationDelay:void 0,duration:500,stroke:15,color:"#45CCCE",background:"#EAEAEA",responsive:!1,clockwise:!0,semicircle:!1,rounded:!1},BT=new fn("ROUND_PROGRESS_DEFAULTS",{providedIn:"root",factory:()=>zT}),Xz={provide:BT,useValue:zT},Qz=(()=>{let s=class s{linearEase(r,l,t,_){return t*r/_+l}easeInQuad(r,l,t,_){return t*(r/=_)*r+l}easeOutQuad(r,l,t,_){return-t*(r/=_)*(r-2)+l}easeInOutQuad(r,l,t,_){return(r/=_/2)<1?t/2*r*r+l:-t/2*(--r*(r-2)-1)+l}easeInCubic(r,l,t,_){return t*(r/=_)*r*r+l}easeOutCubic(r,l,t,_){return t*((r=r/_-1)*r*r+1)+l}easeInOutCubic(r,l,t,_){return(r/=_/2)<1?t/2*r*r*r+l:t/2*((r-=2)*r*r+2)+l}easeInQuart(r,l,t,_){return t*(r/=_)*r*r*r+l}easeOutQuart(r,l,t,_){return-t*((r=r/_-1)*r*r*r-1)+l}easeInOutQuart(r,l,t,_){return(r/=_/2)<1?t/2*r*r*r*r+l:-t/2*((r-=2)*r*r*r-2)+l}easeInQuint(r,l,t,_){return t*(r/=_)*r*r*r*r+l}easeOutQuint(r,l,t,_){return t*((r=r/_-1)*r*r*r*r+1)+l}easeInOutQuint(r,l,t,_){return(r/=_/2)<1?t/2*r*r*r*r*r+l:t/2*((r-=2)*r*r*r*r+2)+l}easeInSine(r,l,t,_){return-t*Math.cos(r/_*(Math.PI/2))+t+l}easeOutSine(r,l,t,_){return t*Math.sin(r/_*(Math.PI/2))+l}easeInOutSine(r,l,t,_){return-t/2*(Math.cos(Math.PI*r/_)-1)+l}easeInExpo(r,l,t,_){return r===0?l:t*Math.pow(2,10*(r/_-1))+l}easeOutExpo(r,l,t,_){return r===_?l+t:t*(-Math.pow(2,-10*r/_)+1)+l}easeInOutExpo(r,l,t,_){return r===0?l:r===_?l+t:(r/=_/2)<1?t/2*Math.pow(2,10*(r-1))+l:t/2*(-Math.pow(2,-10*--r)+2)+l}easeInCirc(r,l,t,_){return-t*(Math.sqrt(1-(r/=_)*r)-1)+l}easeOutCirc(r,l,t,_){return t*Math.sqrt(1-(r=r/_-1)*r)+l}easeInOutCirc(r,l,t,_){return(r/=_/2)<1?-t/2*(Math.sqrt(1-r*r)-1)+l:t/2*(Math.sqrt(1-(r-=2)*r)+1)+l}easeInElastic(r,l,t,_){let C=_*.3,I=1.70158,O=t;return r===0?l:(r/=_)===1?l+t:(O<Math.abs(t)?(O=t,I=C/4):I=C/(2*Math.PI)*Math.asin(t/O),-(O*Math.pow(2,10*r--)*Math.sin((r*_-I)*(2*Math.PI)/C))+l)}easeOutElastic(r,l,t,_){let C=_*.3,I=1.70158,O=t;return r===0?l:(r/=_)===1?l+t:(O<Math.abs(t)?(O=t,I=C/4):I=C/(2*Math.PI)*Math.asin(t/O),O*Math.pow(2,-10*r)*Math.sin((r*_-I)*(2*Math.PI)/C)+t+l)}easeInOutElastic(r,l,t,_){let C=_*.44999999999999996,I=1.70158,O=t;return r===0?l:(r/=_/2)===2?l+t:(O<Math.abs(t)?(O=t,I=C/4):I=C/(2*Math.PI)*Math.asin(t/O),r<1?-.5*(O*Math.pow(2,10*(r-=1))*Math.sin((r*_-I)*(2*Math.PI)/C))+l:O*Math.pow(2,-10*(r-=1))*Math.sin((r*_-I)*(2*Math.PI)/C)*.5+t+l)}easeInBack(r,l,t,_,C=1.70158){return t*(r/=_)*r*((C+1)*r-C)+l}easeOutBack(r,l,t,_,C=1.70158){return t*((r=r/_-1)*r*((C+1)*r+C)+1)+l}easeInOutBack(r,l,t,_,C=1.70158){return(r/=_/2)<1?t/2*(r*r*(((C*=1.525)+1)*r-C))+l:t/2*((r-=2)*r*(((C*=1.525)+1)*r+C)+2)+l}easeInBounce(r,l,t,_){return t-this.easeOutBounce(_-r,0,t,_)+l}easeOutBounce(r,l,t,_){return(r/=_)<1/2.75?t*(7.5625*r*r)+l:r<2/2.75?t*(7.5625*(r-=1.5/2.75)*r+.75)+l:r<2.5/2.75?t*(7.5625*(r-=2.25/2.75)*r+.9375)+l:t*(7.5625*(r-=2.625/2.75)*r+.984375)+l}easeInOutBounce(r,l,t,_){return r<_/2?this.easeInBounce(r*2,0,t,_)*.5+l:this.easeOutBounce(r*2-_,0,t,_)*.5+t*.5+l}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Nb=(()=>{let s=class s{constructor(r,l,t,_){this.service=r,this.easing=l,this.defaults=t,this.ngZone=_,this.currentLinecap="",this.current=0,this.max=0,this.radius=this.defaults.radius,this.animation=this.defaults.animation,this.animationDelay=this.defaults.animationDelay,this.duration=this.defaults.duration,this.stroke=this.defaults.stroke,this.color=this.defaults.color,this.background=this.defaults.background,this.responsive=this.defaults.responsive,this.clockwise=this.defaults.clockwise,this.semicircle=this.defaults.semicircle,this.rounded=this.defaults.rounded,this.onRender=new an,this.lastAnimationId=0}_animateChange(r,l){typeof r!="number"&&(r=0),l=this._clamp(l),r=this._clamp(r);let t=this,_=l-r,C=t.duration;t.ngZone.runOutsideAngular(()=>{let I=()=>{let O=t.service.getTimestamp(),N=++t.lastAnimationId;requestAnimationFrame(function q(){let ie=Math.min(t.service.getTimestamp()-O,C),de=t.easing[t.animation],xe=de(ie,r,_,C);t._updatePath(xe),t.onRender.observers.length>0&&t.onRender.emit(xe),N===t.lastAnimationId&&ie<C&&requestAnimationFrame(q)})};this.animationDelay>0?setTimeout(I,this.animationDelay):I()})}_updatePath(r){if(this.path){let l=this.service.getArc(r,this.max,this.radius-this.stroke/2,this.radius,this.semicircle),t=this.path.nativeElement,_=this.rounded&&r>0?"round":"";_!==this.currentLinecap&&(this.currentLinecap=_,t.style.strokeLinecap=_),t.setAttribute("d",l)}}_clamp(r){return Math.max(0,Math.min(r||0,this.max))}getPathTransform(){let r=this._getDiameter();return this.semicircle?this.clockwise?`translate(0, ${r}) rotate(-90)`:`translate(${r+","+r}) rotate(90) scale(-1, 1)`:this.clockwise?null:`scale(-1, 1) translate(-${r} 0)`}resolveColor(r){return this.service.resolveColor(r)}ngOnChanges(r){r.current?this._animateChange(r.current.previousValue,r.current.currentValue):this._updatePath(this.current)}_getDiameter(){return this.radius*2}_getElementHeight(){return this.responsive?null:(this.semicircle?this.radius:this._getDiameter())+"px"}_getViewBox(){let r=this._getDiameter();return`0 0 ${r} ${this.semicircle?this.radius:r}`}_getPaddingBottom(){return this.responsive?this.semicircle?"50%":"100%":null}};s.\u0275fac=function(l){return new(l||s)(fe(Zz),fe(Qz),fe(BT),fe(zi))},s.\u0275cmp=_t({type:s,selectors:[["round-progress"]],viewQuery:function(l,t){if(l&1&&bi($z,5),l&2){let _;gi(_=_i())&&(t.path=_.first)}},hostAttrs:["role","progressbar"],hostVars:11,hostBindings:function(l,t){l&2&&(bn("aria-valuemin",0)("aria-valuemax",t.max)("aria-valuenow",t.current),Wa("width",t.responsive?"":t._getDiameter()+"px")("height",t._getElementHeight())("padding-bottom",t._getPaddingBottom()),Mi("responsive",t.responsive))},inputs:{current:"current",max:"max",radius:"radius",animation:"animation",animationDelay:"animationDelay",duration:"duration",stroke:"stroke",color:"color",background:"background",responsive:"responsive",clockwise:"clockwise",semicircle:"semicircle",rounded:"rounded"},outputs:{onRender:"onRender"},standalone:!0,features:[wo,Hn],decls:4,vars:13,consts:[["path",""],["xmlns","http://www.w3.org/2000/svg"],["fill","none"]],template:function(l,t){l&1&&(cd(),V(0,"svg",1),Me(1,"circle",2)(2,"path",2,0),j()),l&2&&(bn("viewBox",t._getViewBox()),ue(),Wa("stroke",t.resolveColor(t.background))("stroke-width",t.stroke),bn("cx",t.radius)("cy",t.radius)("r",t.radius-t.stroke/2),ue(),Wa("stroke-width",t.stroke)("stroke",t.resolveColor(t.color)),bn("transform",t.getPathTransform()))},styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden}.responsive[_nghost-%COMP%]{width:100%;padding-bottom:100%}.responsive[_nghost-%COMP%] > svg[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}"],changeDetection:0});let d=s;return d})(),NT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({providers:[Xz]});let d=s;return d})();var jT=d=>({color:d}),UT=(()=>{let s=class s{constructor(r,l,t,_){this.http=r,this.router=l,this.razorpayService=t,this.jobDetailsService=_,this.apiUrl=yn,this.enteredValue=0,this.maxValue=5,this.minTarget=0,this.min=80,this.divColor="black",this.providerRating=0,this.creditBalance=50,this.isDrawerOpen=!1,this.current=0,this.max=5,this.radius=150,this.semicircle=!0,this.color="black",this.background="#eaeaea",this.cancelRate=0,this.workingHours=0,this.credits=0,this.colorChange(),this.getTarget(),this.getCredits(),this.getProviderRating()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r),this.providerRating=parseInt(r.averageRating)},error:r=>{console.log(r)}})}colorChange(){this.minTarget<this.min&&(this.divColor="red")}calculateProgress(r,l){let t=r+5;return l===0?0:t/l*100}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}increment(r=1){this.current+=r}getOverlayStyle(){let r=this.semicircle,l=(r?"":"translateY(-50%) ")+"translateX(-50%)";return{top:r?"auto":"50%",bottom:r?"5%":"auto",left:"50%",transform:l,"font-size":this.radius/3.5+"px"}}getTarget(){let r=localStorage.getItem("providerId"),l=`${this.apiUrl}providers/service-provider-targets/${r}`;this.http.get(l).subscribe(t=>{console.log(t),this.current=t.specialRating,this.minTarget=t.responseRate,this.cancelRate=t.cancellationRate,this.workingHours=t.totalWorkingHours},t=>{console.log(t)})}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"buyNow":this.router.navigate(["addCredit"])}}navToDetails(){this.router.navigate(["credits"])}};s.\u0275fac=function(l){return new(l||s)(fe(Wi),fe(Nt),fe(Eo),fe(Cr))},s.\u0275cmp=_t({type:s,selectors:[["app-target"]],decls:70,vars:21,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"container-target"],[1,"progress-wrapper"],[1,"current",3,"ngStyle"],[3,"current","max","color","background","radius","semicircle","rounded","stroke"],[1,"progress-content"],[1,"fa","fa-star"],[1,"section-div"],[1,"section"],[1,"info"],[1,"sub-info"],[1,"material-symbols-outlined","notranslate",3,"ngStyle"],[2,"font-size","1.4rem",3,"ngStyle"],[1,"material-symbols-outlined","notranslate",2,"color","red","font-size","28px"],[1,"credit-balance-div"],[3,"click"],[2,"height","10rem"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),Pe("click",function(){return t.toggleDrawer()}),$(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Pe("click",function(){return t.navTo("credit")}),Me(5,"img",4),V(6,"pre"),$(7),j()(),V(8,"div",5),Pe("click",function(){return t.navTo("notification")}),V(9,"span",6),$(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),$(15),j(),Me(16,"round-progress",11),V(17,"div",12),Me(18,"br"),V(19,"div"),Me(20,"span",13),V(21,"span"),$(22,"Min : 4.7"),j()()()()(),V(23,"div",14)(24,"div",15)(25,"span",6),$(26,"schedule"),j(),Me(27,"br")(28,"br"),V(29,"span",16),$(30),j(),Me(31,"br"),V(32,"span",17),$(33,"Weekend hours"),j()(),V(34,"div",15)(35,"span",18),$(36,"draft"),j(),$(37," \xA0"),V(38,"span",19),$(39,"Min:80%"),j(),Me(40,"br")(41,"br"),V(42,"span",16),$(43),j(),Me(44,"br"),V(45,"span",17),$(46,"Response rate"),j()(),V(47,"div",15)(48,"span",20),$(49,"privacy_tip"),j(),Me(50,"br")(51,"br"),V(52,"span",16),$(53),j(),Me(54,"br"),V(55,"span",17),$(56,"Cancellation"),j()()(),Me(57,"br"),V(58,"div",21)(59,"span",17),$(60),j(),Me(61,"br")(62,"br"),V(63,"div")(64,"button",22),Pe("click",function(){return t.navTo("buyNow")}),$(65,"Buy now"),j(),V(66,"button",22),Pe("click",function(){return t.navToDetails()}),$(67,"See details"),j()()()()(),Me(68,"div",23)(69,"app-fotter")),l&2&&(ue(7),Ft(t.credits),ue(7),Fe("ngStyle",t.getOverlayStyle()),ue(),ki("",t.providerRating,"%"),ue(),Fe("current",t.providerRating)("max",t.max)("color",t.color)("background",t.background)("radius",t.radius)("semicircle",t.semicircle)("rounded",!0)("stroke",20),ue(14),ki("",t.workingHours," HRS"),ue(5),Fe("ngStyle",ci(17,jT,t.divColor)),ue(3),Fe("ngStyle",ci(19,jT,t.divColor)),ue(5),ki("",t.minTarget,"%"),ue(10),Ft(t.cancelRate),ue(7),ki("Credit Balance ",t.credits,""))},dependencies:[nb,Nb,Js],styles:['.left-half-spinner-container[_ngcontent-%COMP%]{position:relative;width:100px;height:100px;overflow:hidden;transform:rotate(90deg)}.left-half-spinner-container[_ngcontent-%COMP%]   .mat-progress-spinner[_ngcontent-%COMP%]{width:100px;height:100px}.left-half-spinner-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;right:0;width:50%;height:100%;background:#fff;z-index:1}.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;margin-bottom:5rem}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#000;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:9rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:6rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;border-radius:.4rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.section-div[_ngcontent-%COMP%]{display:grid;grid-template-columns:45% 45%;column-gap:2%;width:100%;height:max-content;justify-content:space-around}.section[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.4rem;height:7rem;margin-top:2rem;padding:2rem 1rem 1rem;text-align:left}.info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:600;line-height:19.36px}.sub-info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px}.credit-balance-div[_ngcontent-%COMP%]{width:88%;height:5.5rem;border:.25px solid black;text-align:left;padding:1rem;padding-left:6%;border-radius:.8rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:max-content;height:2rem;display:flex;align-items:center;justify-content:center;font-family:"Inter" sans-serif;font-size:14px;font-weight:500;line-height:16.94px;border-radius:.5rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#3cc04b;color:#fff;border:none}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:transparent;border:.25 solid black}.credit-balance-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:grid;grid-template-columns:auto auto;column-gap:1rem}cf[_ngcontent-%COMP%]:before, .cf[_ngcontent-%COMP%]:after{content:" ";display:table}.cf[_ngcontent-%COMP%]:after{clear:both}.progress-wrapper[_ngcontent-%COMP%]{position:relative;margin:20px auto;font-size:40px}.current[_ngcontent-%COMP%]{position:absolute;color:#bbb;font-weight:100;line-height:1}round-progress[_ngcontent-%COMP%]{margin:auto}.container-target[_ngcontent-%COMP%]{width:80%;max-width:650px;margin:40px auto 80px;text-align:center;padding:40px;background:#fff;border:solid 1px #ccc;border-radius:4px}button[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background:#45ccce;color:#fff;font-size:16px;border:none;cursor:pointer;border-radius:4px;text-align:center;margin:0 5px 5px 0}button[_ngcontent-%COMP%]:nth-child(2){color:#000;border:.25px solid black;border-radius:4px;display:inline-block;text-align:center}form[_ngcontent-%COMP%]{text-align:left;max-width:350px;margin:30px auto}form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:15px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{float:right;padding:5px;width:150px}input[type=checkbox][_ngcontent-%COMP%]{width:auto}input[type=color][_ngcontent-%COMP%]{height:30px}.back[_ngcontent-%COMP%]{position:fixed;top:5px;right:5px}.progress-container[_ngcontent-%COMP%]   round-progress[_ngcontent-%COMP%]{position:relative;z-index:1}.progress-content[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%,-50%);text-align:center;font-size:1.1rem;font-weight:400;line-height:1.2;z-index:2}.progress-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;top:.5rem;display:flex;flex-direction:column}@media (max-width: 650px){.back[_ngcontent-%COMP%]{position:static;display:block;text-align:center}h2[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{margin-bottom:20px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;margin-top:5px;float:none}.container-target[_ngcontent-%COMP%]{margin:0 auto 50px;padding:25px}}']});let d=s;return d})();function Mg(d){return d+.5|0}var vd=(d,s,u)=>Math.max(Math.min(d,u),s);function Cg(d){return vd(Mg(d*2.55),0,255)}function xd(d){return vd(Mg(d*255),0,255)}function $l(d){return vd(Mg(d/2.55)/100,0,1)}function HT(d){return vd(Mg(d*100),0,100)}var Za={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},ow=[..."0123456789ABCDEF"],Kz=d=>ow[d&15],Jz=d=>ow[(d&240)>>4]+ow[d&15],Vb=d=>(d&240)>>4===(d&15),e5=d=>Vb(d.r)&&Vb(d.g)&&Vb(d.b)&&Vb(d.a);function t5(d){var s=d.length,u;return d[0]==="#"&&(s===4||s===5?u={r:255&Za[d[1]]*17,g:255&Za[d[2]]*17,b:255&Za[d[3]]*17,a:s===5?Za[d[4]]*17:255}:(s===7||s===9)&&(u={r:Za[d[1]]<<4|Za[d[2]],g:Za[d[3]]<<4|Za[d[4]],b:Za[d[5]]<<4|Za[d[6]],a:s===9?Za[d[7]]<<4|Za[d[8]]:255})),u}var i5=(d,s)=>d<255?s(d):"";function n5(d){var s=e5(d)?Kz:Jz;return d?"#"+s(d.r)+s(d.g)+s(d.b)+i5(d.a,s):void 0}var r5=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function $T(d,s,u){let r=s*Math.min(u,1-u),l=(t,_=(t+d/30)%12)=>u-r*Math.max(Math.min(_-3,9-_,1),-1);return[l(0),l(8),l(4)]}function o5(d,s,u){let r=(l,t=(l+d/60)%6)=>u-u*s*Math.max(Math.min(t,4-t,1),0);return[r(5),r(3),r(1)]}function a5(d,s,u){let r=$T(d,1,.5),l;for(s+u>1&&(l=1/(s+u),s*=l,u*=l),l=0;l<3;l++)r[l]*=1-s-u,r[l]+=s;return r}function s5(d,s,u,r,l){return d===l?(s-u)/r+(s<u?6:0):s===l?(u-d)/r+2:(d-s)/r+4}function aw(d){let u=d.r/255,r=d.g/255,l=d.b/255,t=Math.max(u,r,l),_=Math.min(u,r,l),C=(t+_)/2,I,O,N;return t!==_&&(N=t-_,O=C>.5?N/(2-t-_):N/(t+_),I=s5(u,r,l,N,t),I=I*60+.5),[I|0,O||0,C]}function sw(d,s,u,r){return(Array.isArray(s)?d(s[0],s[1],s[2]):d(s,u,r)).map(xd)}function lw(d,s,u){return sw($T,d,s,u)}function l5(d,s,u){return sw(a5,d,s,u)}function c5(d,s,u){return sw(o5,d,s,u)}function YT(d){return(d%360+360)%360}function d5(d){let s=r5.exec(d),u=255,r;if(!s)return;s[5]!==r&&(u=s[6]?Cg(+s[5]):xd(+s[5]));let l=YT(+s[2]),t=+s[3]/100,_=+s[4]/100;return s[1]==="hwb"?r=l5(l,t,_):s[1]==="hsv"?r=c5(l,t,_):r=lw(l,t,_),{r:r[0],g:r[1],b:r[2],a:u}}function h5(d,s){var u=aw(d);u[0]=YT(u[0]+s),u=lw(u),d.r=u[0],d.g=u[1],d.b=u[2]}function u5(d){if(!d)return;let s=aw(d),u=s[0],r=HT(s[1]),l=HT(s[2]);return d.a<255?`hsla(${u}, ${r}%, ${l}%, ${$l(d.a)})`:`hsl(${u}, ${r}%, ${l}%)`}var WT={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},GT={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function m5(){let d={},s=Object.keys(GT),u=Object.keys(WT),r,l,t,_,C;for(r=0;r<s.length;r++){for(_=C=s[r],l=0;l<u.length;l++)t=u[l],C=C.replace(t,WT[t]);t=parseInt(GT[_],16),d[C]=[t>>16&255,t>>8&255,t&255]}return d}var jb;function p5(d){jb||(jb=m5(),jb.transparent=[0,0,0,0]);let s=jb[d.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:s.length===4?s[3]:255}}var f5=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function g5(d){let s=f5.exec(d),u=255,r,l,t;if(s){if(s[7]!==r){let _=+s[7];u=s[8]?Cg(_):vd(_*255,0,255)}return r=+s[1],l=+s[3],t=+s[5],r=255&(s[2]?Cg(r):vd(r,0,255)),l=255&(s[4]?Cg(l):vd(l,0,255)),t=255&(s[6]?Cg(t):vd(t,0,255)),{r,g:l,b:t,a:u}}}function _5(d){return d&&(d.a<255?`rgba(${d.r}, ${d.g}, ${d.b}, ${$l(d.a)})`:`rgb(${d.r}, ${d.g}, ${d.b})`)}var rw=d=>d<=.0031308?d*12.92:Math.pow(d,1/2.4)*1.055-.055,$m=d=>d<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4);function b5(d,s,u){let r=$m($l(d.r)),l=$m($l(d.g)),t=$m($l(d.b));return{r:xd(rw(r+u*($m($l(s.r))-r))),g:xd(rw(l+u*($m($l(s.g))-l))),b:xd(rw(t+u*($m($l(s.b))-t))),a:d.a+u*(s.a-d.a)}}function Ub(d,s,u){if(d){let r=aw(d);r[s]=Math.max(0,Math.min(r[s]+r[s]*u,s===0?360:1)),r=lw(r),d.r=r[0],d.g=r[1],d.b=r[2]}}function ZT(d,s){return d&&Object.assign(s||{},d)}function qT(d){var s={r:0,g:0,b:0,a:255};return Array.isArray(d)?d.length>=3&&(s={r:d[0],g:d[1],b:d[2],a:255},d.length>3&&(s.a=xd(d[3]))):(s=ZT(d,{r:0,g:0,b:0,a:1}),s.a=xd(s.a)),s}function y5(d){return d.charAt(0)==="r"?g5(d):d5(d)}var Sg=class d{constructor(s){if(s instanceof d)return s;let u=typeof s,r;u==="object"?r=qT(s):u==="string"&&(r=t5(s)||p5(s)||y5(s)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var s=ZT(this._rgb);return s&&(s.a=$l(s.a)),s}set rgb(s){this._rgb=qT(s)}rgbString(){return this._valid?_5(this._rgb):void 0}hexString(){return this._valid?n5(this._rgb):void 0}hslString(){return this._valid?u5(this._rgb):void 0}mix(s,u){if(s){let r=this.rgb,l=s.rgb,t,_=u===t?.5:u,C=2*_-1,I=r.a-l.a,O=((C*I===-1?C:(C+I)/(1+C*I))+1)/2;t=1-O,r.r=255&O*r.r+t*l.r+.5,r.g=255&O*r.g+t*l.g+.5,r.b=255&O*r.b+t*l.b+.5,r.a=_*r.a+(1-_)*l.a,this.rgb=r}return this}interpolate(s,u){return s&&(this._rgb=b5(this._rgb,s._rgb,u)),this}clone(){return new d(this.rgb)}alpha(s){return this._rgb.a=xd(s),this}clearer(s){let u=this._rgb;return u.a*=1-s,this}greyscale(){let s=this._rgb,u=Mg(s.r*.3+s.g*.59+s.b*.11);return s.r=s.g=s.b=u,this}opaquer(s){let u=this._rgb;return u.a*=1+s,this}negate(){let s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return Ub(this._rgb,2,s),this}darken(s){return Ub(this._rgb,2,-s),this}saturate(s){return Ub(this._rgb,1,s),this}desaturate(s){return Ub(this._rgb,1,-s),this}rotate(s){return h5(this._rgb,s),this}};function il(){}var aE=(()=>{let d=0;return()=>d++})();function vn(d){return d===null||typeof d>"u"}function nr(d){if(Array.isArray&&Array.isArray(d))return!0;let s=Object.prototype.toString.call(d);return s.slice(0,7)==="[object"&&s.slice(-6)==="Array]"}function cn(d){return d!==null&&Object.prototype.toString.call(d)==="[object Object]"}function yr(d){return(typeof d=="number"||d instanceof Number)&&isFinite(+d)}function na(d,s){return yr(d)?d:s}function Yi(d,s){return typeof d>"u"?s:d}var sE=(d,s)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100:+d/s,uw=(d,s)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100*s:+d;function Yn(d,s,u){if(d&&typeof d.call=="function")return d.apply(u,s)}function Bn(d,s,u,r){let l,t,_;if(nr(d))if(t=d.length,r)for(l=t-1;l>=0;l--)s.call(u,d[l],l);else for(l=0;l<t;l++)s.call(u,d[l],l);else if(cn(d))for(_=Object.keys(d),t=_.length,l=0;l<t;l++)s.call(u,d[_[l]],_[l])}function Tg(d,s){let u,r,l,t;if(!d||!s||d.length!==s.length)return!1;for(u=0,r=d.length;u<r;++u)if(l=d[u],t=s[u],l.datasetIndex!==t.datasetIndex||l.index!==t.index)return!1;return!0}function qb(d){if(nr(d))return d.map(qb);if(cn(d)){let s=Object.create(null),u=Object.keys(d),r=u.length,l=0;for(;l<r;++l)s[u[l]]=qb(d[u[l]]);return s}return d}function lE(d){return["__proto__","prototype","constructor"].indexOf(d)===-1}function v5(d,s,u,r){if(!lE(d))return;let l=s[d],t=u[d];cn(l)&&cn(t)?Zm(l,t,r):s[d]=qb(t)}function Zm(d,s,u){let r=nr(s)?s:[s],l=r.length;if(!cn(d))return d;u=u||{};let t=u.merger||v5,_;for(let C=0;C<l;++C){if(_=r[C],!cn(_))continue;let I=Object.keys(_);for(let O=0,N=I.length;O<N;++O)t(I[O],d,_,u)}return d}function Qm(d,s){return Zm(d,s,{merger:x5})}function x5(d,s,u){if(!lE(d))return;let r=s[d],l=u[d];cn(r)&&cn(l)?Qm(r,l):Object.prototype.hasOwnProperty.call(s,d)||(s[d]=qb(l))}var XT={"":d=>d,x:d=>d.x,y:d=>d.y};function w5(d){let s=d.split("."),u=[],r="";for(let l of s)r+=l,r.endsWith("\\")?r=r.slice(0,-1)+".":(u.push(r),r="");return u}function C5(d){let s=w5(d);return u=>{for(let r of s){if(r==="")break;u=u&&u[r]}return u}}function Xl(d,s){return(XT[s]||(XT[s]=C5(s)))(d)}function Xb(d){return d.charAt(0).toUpperCase()+d.slice(1)}var Km=d=>typeof d<"u",Yl=d=>typeof d=="function",mw=(d,s)=>{if(d.size!==s.size)return!1;for(let u of d)if(!s.has(u))return!1;return!0};function cE(d){return d.type==="mouseup"||d.type==="click"||d.type==="contextmenu"}var rr=Math.PI,or=2*rr,S5=or+rr,$b=Number.POSITIVE_INFINITY,M5=rr/180,Mr=rr/2,Xh=rr/4,QT=rr*2/3,Zl=Math.log10,Ms=Math.sign;function Jm(d,s,u){return Math.abs(d-s)<u}function pw(d){let s=Math.round(d);d=Jm(d,s,d/1e3)?s:d;let u=Math.pow(10,Math.floor(Zl(d))),r=d/u;return(r<=1?1:r<=2?2:r<=5?5:10)*u}function dE(d){let s=[],u=Math.sqrt(d),r;for(r=1;r<u;r++)d%r===0&&(s.push(r),s.push(d/r));return u===(u|0)&&s.push(u),s.sort((l,t)=>l-t).pop(),s}function Jh(d){return!isNaN(parseFloat(d))&&isFinite(d)}function hE(d,s){let u=Math.round(d);return u-s<=d&&u+s>=d}function fw(d,s,u){let r,l,t;for(r=0,l=d.length;r<l;r++)t=d[r][u],isNaN(t)||(s.min=Math.min(s.min,t),s.max=Math.max(s.max,t))}function Xa(d){return d*(rr/180)}function Qb(d){return d*(180/rr)}function gw(d){if(!yr(d))return;let s=1,u=0;for(;Math.round(d*s)/s!==d;)s*=10,u++;return u}function _w(d,s){let u=s.x-d.x,r=s.y-d.y,l=Math.sqrt(u*u+r*r),t=Math.atan2(r,u);return t<-.5*rr&&(t+=or),{angle:t,distance:l}}function Yb(d,s){return Math.sqrt(Math.pow(s.x-d.x,2)+Math.pow(s.y-d.y,2))}function k5(d,s){return(d-s+S5)%or-rr}function ia(d){return(d%or+or)%or}function ep(d,s,u,r){let l=ia(d),t=ia(s),_=ia(u),C=ia(t-l),I=ia(_-l),O=ia(l-t),N=ia(l-_);return l===t||l===_||r&&t===_||C>I&&O<N}function Xr(d,s,u){return Math.max(s,Math.min(u,d))}function uE(d){return Xr(d,-32768,32767)}function nl(d,s,u,r=1e-6){return d>=Math.min(s,u)-r&&d<=Math.max(s,u)+r}function Kb(d,s,u){u=u||(_=>d[_]<s);let r=d.length-1,l=0,t;for(;r-l>1;)t=l+r>>1,u(t)?l=t:r=t;return{lo:l,hi:r}}var el=(d,s,u,r)=>Kb(d,u,r?l=>{let t=d[l][s];return t<u||t===u&&d[l+1][s]===u}:l=>d[l][s]<u),mE=(d,s,u)=>Kb(d,u,r=>d[r][s]>=u);function pE(d,s,u){let r=0,l=d.length;for(;r<l&&d[r]<s;)r++;for(;l>r&&d[l-1]>u;)l--;return r>0||l<d.length?d.slice(r,l):d}var fE=["push","pop","shift","splice","unshift"];function gE(d,s){if(d._chartjs){d._chartjs.listeners.push(s);return}Object.defineProperty(d,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),fE.forEach(u=>{let r="_onData"+Xb(u),l=d[u];Object.defineProperty(d,u,{configurable:!0,enumerable:!1,value(...t){let _=l.apply(this,t);return d._chartjs.listeners.forEach(C=>{typeof C[r]=="function"&&C[r](...t)}),_}})})}function bw(d,s){let u=d._chartjs;if(!u)return;let r=u.listeners,l=r.indexOf(s);l!==-1&&r.splice(l,1),!(r.length>0)&&(fE.forEach(t=>{delete d[t]}),delete d._chartjs)}function yw(d){let s=new Set(d);return s.size===d.length?d:Array.from(s)}var vw=function(){return typeof window>"u"?function(d){return d()}:window.requestAnimationFrame}();function xw(d,s){let u=[],r=!1;return function(...l){u=l,r||(r=!0,vw.call(window,()=>{r=!1,d.apply(s,u)}))}}function _E(d,s){let u;return function(...r){return s?(clearTimeout(u),u=setTimeout(d,s,r)):d.apply(this,r),s}}var Jb=d=>d==="start"?"left":d==="end"?"right":"center",po=(d,s,u)=>d==="start"?s:d==="end"?u:(s+u)/2,bE=(d,s,u,r)=>d===(r?"left":"right")?u:d==="center"?(s+u)/2:s;function ww(d,s,u){let r=s.length,l=0,t=r;if(d._sorted){let{iScale:_,_parsed:C}=d,I=_.axis,{min:O,max:N,minDefined:q,maxDefined:ie}=_.getUserBounds();q&&(l=Xr(Math.min(el(C,I,O).lo,u?r:el(s,I,_.getPixelForValue(O)).lo),0,r-1)),ie?t=Xr(Math.max(el(C,_.axis,N,!0).hi+1,u?0:el(s,I,_.getPixelForValue(N),!0).hi+1),l,r)-l:t=r-l}return{start:l,count:t}}function Cw(d){let{xScale:s,yScale:u,_scaleRanges:r}=d,l={xmin:s.min,xmax:s.max,ymin:u.min,ymax:u.max};if(!r)return d._scaleRanges=l,!0;let t=r.xmin!==s.min||r.xmax!==s.max||r.ymin!==u.min||r.ymax!==u.max;return Object.assign(r,l),t}var Hb=d=>d===0||d===1,KT=(d,s,u)=>-(Math.pow(2,10*(d-=1))*Math.sin((d-s)*or/u)),JT=(d,s,u)=>Math.pow(2,-10*d)*Math.sin((d-s)*or/u)+1,Ym={linear:d=>d,easeInQuad:d=>d*d,easeOutQuad:d=>-d*(d-2),easeInOutQuad:d=>(d/=.5)<1?.5*d*d:-.5*(--d*(d-2)-1),easeInCubic:d=>d*d*d,easeOutCubic:d=>(d-=1)*d*d+1,easeInOutCubic:d=>(d/=.5)<1?.5*d*d*d:.5*((d-=2)*d*d+2),easeInQuart:d=>d*d*d*d,easeOutQuart:d=>-((d-=1)*d*d*d-1),easeInOutQuart:d=>(d/=.5)<1?.5*d*d*d*d:-.5*((d-=2)*d*d*d-2),easeInQuint:d=>d*d*d*d*d,easeOutQuint:d=>(d-=1)*d*d*d*d+1,easeInOutQuint:d=>(d/=.5)<1?.5*d*d*d*d*d:.5*((d-=2)*d*d*d*d+2),easeInSine:d=>-Math.cos(d*Mr)+1,easeOutSine:d=>Math.sin(d*Mr),easeInOutSine:d=>-.5*(Math.cos(rr*d)-1),easeInExpo:d=>d===0?0:Math.pow(2,10*(d-1)),easeOutExpo:d=>d===1?1:-Math.pow(2,-10*d)+1,easeInOutExpo:d=>Hb(d)?d:d<.5?.5*Math.pow(2,10*(d*2-1)):.5*(-Math.pow(2,-10*(d*2-1))+2),easeInCirc:d=>d>=1?d:-(Math.sqrt(1-d*d)-1),easeOutCirc:d=>Math.sqrt(1-(d-=1)*d),easeInOutCirc:d=>(d/=.5)<1?-.5*(Math.sqrt(1-d*d)-1):.5*(Math.sqrt(1-(d-=2)*d)+1),easeInElastic:d=>Hb(d)?d:KT(d,.075,.3),easeOutElastic:d=>Hb(d)?d:JT(d,.075,.3),easeInOutElastic(d){return Hb(d)?d:d<.5?.5*KT(d*2,.1125,.45):.5+.5*JT(d*2-1,.1125,.45)},easeInBack(d){return d*d*((1.70158+1)*d-1.70158)},easeOutBack(d){return(d-=1)*d*((1.70158+1)*d+1.70158)+1},easeInOutBack(d){let s=1.70158;return(d/=.5)<1?.5*(d*d*(((s*=1.525)+1)*d-s)):.5*((d-=2)*d*(((s*=1.525)+1)*d+s)+2)},easeInBounce:d=>1-Ym.easeOutBounce(1-d),easeOutBounce(d){return d<1/2.75?7.5625*d*d:d<2/2.75?7.5625*(d-=1.5/2.75)*d+.75:d<2.5/2.75?7.5625*(d-=2.25/2.75)*d+.9375:7.5625*(d-=2.625/2.75)*d+.984375},easeInOutBounce:d=>d<.5?Ym.easeInBounce(d*2)*.5:Ym.easeOutBounce(d*2-1)*.5+.5};function Sw(d){if(d&&typeof d=="object"){let s=d.toString();return s==="[object CanvasPattern]"||s==="[object CanvasGradient]"}return!1}function Mw(d){return Sw(d)?d:new Sg(d)}function cw(d){return Sw(d)?d:new Sg(d).saturate(.5).darken(.1).hexString()}var I5=["x","y","borderWidth","radius","tension"],T5=["color","borderColor","backgroundColor"];function E5(d){d.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),d.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:s=>s!=="onProgress"&&s!=="onComplete"&&s!=="fn"}),d.set("animations",{colors:{type:"color",properties:T5},numbers:{type:"number",properties:I5}}),d.describe("animations",{_fallback:"animation"}),d.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:s=>s|0}}}})}function D5(d){d.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var eE=new Map;function A5(d,s){s=s||{};let u=d+JSON.stringify(s),r=eE.get(u);return r||(r=new Intl.NumberFormat(d,s),eE.set(u,r)),r}function tp(d,s,u){return A5(s,u).format(d)}var yE={values(d){return nr(d)?d:""+d},numeric(d,s,u){if(d===0)return"0";let r=this.chart.options.locale,l,t=d;if(u.length>1){let O=Math.max(Math.abs(u[0].value),Math.abs(u[u.length-1].value));(O<1e-4||O>1e15)&&(l="scientific"),t=P5(d,u)}let _=Zl(Math.abs(t)),C=isNaN(_)?1:Math.max(Math.min(-1*Math.floor(_),20),0),I={notation:l,minimumFractionDigits:C,maximumFractionDigits:C};return Object.assign(I,this.options.ticks.format),tp(d,r,I)},logarithmic(d,s,u){if(d===0)return"0";let r=u[s].significand||d/Math.pow(10,Math.floor(Zl(d)));return[1,2,3,5,10,15].includes(r)||s>.8*u.length?yE.numeric.call(this,d,s,u):""}};function P5(d,s){let u=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(u)>=1&&d!==Math.floor(d)&&(u=d-Math.floor(d)),u}var Eg={formatters:yE};function O5(d){d.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(s,u)=>u.lineWidth,tickColor:(s,u)=>u.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Eg.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),d.route("scale.ticks","color","","color"),d.route("scale.grid","color","","borderColor"),d.route("scale.border","color","","borderColor"),d.route("scale.title","color","","color"),d.describe("scale",{_fallback:!1,_scriptable:s=>!s.startsWith("before")&&!s.startsWith("after")&&s!=="callback"&&s!=="parser",_indexable:s=>s!=="borderDash"&&s!=="tickBorderDash"&&s!=="dash"}),d.describe("scales",{_fallback:"scale"}),d.describe("scale.ticks",{_scriptable:s=>s!=="backdropPadding"&&s!=="callback",_indexable:s=>s!=="backdropPadding"})}var Cd=Object.create(null),ey=Object.create(null);function kg(d,s){if(!s)return d;let u=s.split(".");for(let r=0,l=u.length;r<l;++r){let t=u[r];d=d[t]||(d[t]=Object.create(null))}return d}function dw(d,s,u){return typeof s=="string"?Zm(kg(d,s),u):Zm(kg(d,""),s)}var hw=class{constructor(s,u){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,l)=>cw(l.backgroundColor),this.hoverBorderColor=(r,l)=>cw(l.borderColor),this.hoverColor=(r,l)=>cw(l.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s),this.apply(u)}set(s,u){return dw(this,s,u)}get(s){return kg(this,s)}describe(s,u){return dw(ey,s,u)}override(s,u){return dw(Cd,s,u)}route(s,u,r,l){let t=kg(this,s),_=kg(this,r),C="_"+u;Object.defineProperties(t,{[C]:{value:t[u],writable:!0},[u]:{enumerable:!0,get(){let I=this[C],O=_[l];return cn(I)?Object.assign({},O,I):Yi(I,O)},set(I){this[C]=I}}})}apply(s){s.forEach(u=>u(this))}},vr=new hw({_scriptable:d=>!d.startsWith("on"),_indexable:d=>d!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[E5,D5,O5]);function R5(d){return!d||vn(d.size)||vn(d.family)?null:(d.style?d.style+" ":"")+(d.weight?d.weight+" ":"")+d.size+"px "+d.family}function Ig(d,s,u,r,l){let t=s[l];return t||(t=s[l]=d.measureText(l).width,u.push(l)),t>r&&(r=t),r}function vE(d,s,u,r){r=r||{};let l=r.data=r.data||{},t=r.garbageCollect=r.garbageCollect||[];r.font!==s&&(l=r.data={},t=r.garbageCollect=[],r.font=s),d.save(),d.font=s;let _=0,C=u.length,I,O,N,q,ie;for(I=0;I<C;I++)if(q=u[I],q!=null&&!nr(q))_=Ig(d,l,t,_,q);else if(nr(q))for(O=0,N=q.length;O<N;O++)ie=q[O],ie!=null&&!nr(ie)&&(_=Ig(d,l,t,_,ie));d.restore();let de=t.length/2;if(de>u.length){for(I=0;I<de;I++)delete l[t[I]];t.splice(0,de)}return _}function Sd(d,s,u){let r=d.currentDevicePixelRatio,l=u!==0?Math.max(u/2,.5):0;return Math.round((s-l)*r)/r+l}function kw(d,s){!s&&!d||(s=s||d.getContext("2d"),s.save(),s.resetTransform(),s.clearRect(0,0,d.width,d.height),s.restore())}function ty(d,s,u,r){Iw(d,s,u,r,null)}function Iw(d,s,u,r,l){let t,_,C,I,O,N,q,ie,de=s.pointStyle,xe=s.rotation,ke=s.radius,Ae=(xe||0)*M5;if(de&&typeof de=="object"&&(t=de.toString(),t==="[object HTMLImageElement]"||t==="[object HTMLCanvasElement]")){d.save(),d.translate(u,r),d.rotate(Ae),d.drawImage(de,-de.width/2,-de.height/2,de.width,de.height),d.restore();return}if(!(isNaN(ke)||ke<=0)){switch(d.beginPath(),de){default:l?d.ellipse(u,r,l/2,ke,0,0,or):d.arc(u,r,ke,0,or),d.closePath();break;case"triangle":N=l?l/2:ke,d.moveTo(u+Math.sin(Ae)*N,r-Math.cos(Ae)*ke),Ae+=QT,d.lineTo(u+Math.sin(Ae)*N,r-Math.cos(Ae)*ke),Ae+=QT,d.lineTo(u+Math.sin(Ae)*N,r-Math.cos(Ae)*ke),d.closePath();break;case"rectRounded":O=ke*.516,I=ke-O,_=Math.cos(Ae+Xh)*I,q=Math.cos(Ae+Xh)*(l?l/2-O:I),C=Math.sin(Ae+Xh)*I,ie=Math.sin(Ae+Xh)*(l?l/2-O:I),d.arc(u-q,r-C,O,Ae-rr,Ae-Mr),d.arc(u+ie,r-_,O,Ae-Mr,Ae),d.arc(u+q,r+C,O,Ae,Ae+Mr),d.arc(u-ie,r+_,O,Ae+Mr,Ae+rr),d.closePath();break;case"rect":if(!xe){I=Math.SQRT1_2*ke,N=l?l/2:I,d.rect(u-N,r-I,2*N,2*I);break}Ae+=Xh;case"rectRot":q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,r-C),d.lineTo(u+ie,r-_),d.lineTo(u+q,r+C),d.lineTo(u-ie,r+_),d.closePath();break;case"crossRot":Ae+=Xh;case"cross":q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,r-C),d.lineTo(u+q,r+C),d.moveTo(u+ie,r-_),d.lineTo(u-ie,r+_);break;case"star":q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,r-C),d.lineTo(u+q,r+C),d.moveTo(u+ie,r-_),d.lineTo(u-ie,r+_),Ae+=Xh,q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,r-C),d.lineTo(u+q,r+C),d.moveTo(u+ie,r-_),d.lineTo(u-ie,r+_);break;case"line":_=l?l/2:Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,d.moveTo(u-_,r-C),d.lineTo(u+_,r+C);break;case"dash":d.moveTo(u,r),d.lineTo(u+Math.cos(Ae)*(l?l/2:ke),r+Math.sin(Ae)*ke);break;case!1:d.closePath();break}d.fill(),s.borderWidth>0&&d.stroke()}}function tl(d,s,u){return u=u||.5,!s||d&&d.x>s.left-u&&d.x<s.right+u&&d.y>s.top-u&&d.y<s.bottom+u}function Dg(d,s){d.save(),d.beginPath(),d.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),d.clip()}function Ag(d){d.restore()}function xE(d,s,u,r,l){if(!s)return d.lineTo(u.x,u.y);if(l==="middle"){let t=(s.x+u.x)/2;d.lineTo(t,s.y),d.lineTo(t,u.y)}else l==="after"!=!!r?d.lineTo(s.x,u.y):d.lineTo(u.x,s.y);d.lineTo(u.x,u.y)}function wE(d,s,u,r){if(!s)return d.lineTo(u.x,u.y);d.bezierCurveTo(r?s.cp1x:s.cp2x,r?s.cp1y:s.cp2y,r?u.cp2x:u.cp1x,r?u.cp2y:u.cp1y,u.x,u.y)}function L5(d,s){s.translation&&d.translate(s.translation[0],s.translation[1]),vn(s.rotation)||d.rotate(s.rotation),s.color&&(d.fillStyle=s.color),s.textAlign&&(d.textAlign=s.textAlign),s.textBaseline&&(d.textBaseline=s.textBaseline)}function F5(d,s,u,r,l){if(l.strikethrough||l.underline){let t=d.measureText(r),_=s-t.actualBoundingBoxLeft,C=s+t.actualBoundingBoxRight,I=u-t.actualBoundingBoxAscent,O=u+t.actualBoundingBoxDescent,N=l.strikethrough?(I+O)/2:O;d.strokeStyle=d.fillStyle,d.beginPath(),d.lineWidth=l.decorationWidth||2,d.moveTo(_,N),d.lineTo(C,N),d.stroke()}}function z5(d,s){let u=d.fillStyle;d.fillStyle=s.color,d.fillRect(s.left,s.top,s.width,s.height),d.fillStyle=u}function Md(d,s,u,r,l,t={}){let _=nr(s)?s:[s],C=t.strokeWidth>0&&t.strokeColor!=="",I,O;for(d.save(),d.font=l.string,L5(d,t),I=0;I<_.length;++I)O=_[I],t.backdrop&&z5(d,t.backdrop),C&&(t.strokeColor&&(d.strokeStyle=t.strokeColor),vn(t.strokeWidth)||(d.lineWidth=t.strokeWidth),d.strokeText(O,u,r,t.maxWidth)),d.fillText(O,u,r,t.maxWidth),F5(d,u,r,O,t),r+=Number(l.lineHeight);d.restore()}function ip(d,s){let{x:u,y:r,w:l,h:t,radius:_}=s;d.arc(u+_.topLeft,r+_.topLeft,_.topLeft,1.5*rr,rr,!0),d.lineTo(u,r+t-_.bottomLeft),d.arc(u+_.bottomLeft,r+t-_.bottomLeft,_.bottomLeft,rr,Mr,!0),d.lineTo(u+l-_.bottomRight,r+t),d.arc(u+l-_.bottomRight,r+t-_.bottomRight,_.bottomRight,Mr,0,!0),d.lineTo(u+l,r+_.topRight),d.arc(u+l-_.topRight,r+_.topRight,_.topRight,0,-Mr,!0),d.lineTo(u+_.topLeft,r)}var B5=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,N5=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function V5(d,s){let u=(""+d).match(B5);if(!u||u[1]==="normal")return s*1.2;switch(d=+u[2],u[3]){case"px":return d;case"%":d/=100;break}return s*d}var j5=d=>+d||0;function iy(d,s){let u={},r=cn(s),l=r?Object.keys(s):s,t=cn(d)?r?_=>Yi(d[_],d[s[_]]):_=>d[_]:()=>d;for(let _ of l)u[_]=j5(t(_));return u}function Tw(d){return iy(d,{top:"y",right:"x",bottom:"y",left:"x"})}function kd(d){return iy(d,["topLeft","topRight","bottomLeft","bottomRight"])}function fo(d){let s=Tw(d);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function jr(d,s){d=d||{},s=s||vr.font;let u=Yi(d.size,s.size);typeof u=="string"&&(u=parseInt(u,10));let r=Yi(d.style,s.style);r&&!(""+r).match(N5)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);let l={family:Yi(d.family,s.family),lineHeight:V5(Yi(d.lineHeight,s.lineHeight),u),size:u,style:r,weight:Yi(d.weight,s.weight),string:""};return l.string=R5(l),l}function np(d,s,u,r){let l=!0,t,_,C;for(t=0,_=d.length;t<_;++t)if(C=d[t],C!==void 0&&(s!==void 0&&typeof C=="function"&&(C=C(s),l=!1),u!==void 0&&nr(C)&&(C=C[u%C.length],l=!1),C!==void 0))return r&&!l&&(r.cacheable=!1),C}function CE(d,s,u){let{min:r,max:l}=d,t=uw(s,(l-r)/2),_=(C,I)=>u&&C===0?0:C+I;return{min:_(r,-Math.abs(t)),max:_(l,t)}}function Ql(d,s){return Object.assign(Object.create(d),s)}function ny(d,s=[""],u,r,l=()=>d[0]){let t=u||d;typeof r>"u"&&(r=kE("_fallback",d));let _={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:d,_rootScopes:t,_fallback:r,_getTarget:l,override:C=>ny([C,...d],s,t,r)};return new Proxy(_,{deleteProperty(C,I){return delete C[I],delete C._keys,delete d[0][I],!0},get(C,I){return SE(C,I,()=>Z5(I,s,d,C))},getOwnPropertyDescriptor(C,I){return Reflect.getOwnPropertyDescriptor(C._scopes[0],I)},getPrototypeOf(){return Reflect.getPrototypeOf(d[0])},has(C,I){return iE(C).includes(I)},ownKeys(C){return iE(C)},set(C,I,O){let N=C._storage||(C._storage=l());return C[I]=N[I]=O,delete C._keys,!0}})}function Kh(d,s,u,r){let l={_cacheable:!1,_proxy:d,_context:s,_subProxy:u,_stack:new Set,_descriptors:Ew(d,r),setContext:t=>Kh(d,t,u,r),override:t=>Kh(d.override(t),s,u,r)};return new Proxy(l,{deleteProperty(t,_){return delete t[_],delete d[_],!0},get(t,_,C){return SE(t,_,()=>H5(t,_,C))},getOwnPropertyDescriptor(t,_){return t._descriptors.allKeys?Reflect.has(d,_)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(d,_)},getPrototypeOf(){return Reflect.getPrototypeOf(d)},has(t,_){return Reflect.has(d,_)},ownKeys(){return Reflect.ownKeys(d)},set(t,_,C){return d[_]=C,delete t[_],!0}})}function Ew(d,s={scriptable:!0,indexable:!0}){let{_scriptable:u=s.scriptable,_indexable:r=s.indexable,_allKeys:l=s.allKeys}=d;return{allKeys:l,scriptable:u,indexable:r,isScriptable:Yl(u)?u:()=>u,isIndexable:Yl(r)?r:()=>r}}var U5=(d,s)=>d?d+Xb(s):s,Dw=(d,s)=>cn(s)&&d!=="adapters"&&(Object.getPrototypeOf(s)===null||s.constructor===Object);function SE(d,s,u){if(Object.prototype.hasOwnProperty.call(d,s)||s==="constructor")return d[s];let r=u();return d[s]=r,r}function H5(d,s,u){let{_proxy:r,_context:l,_subProxy:t,_descriptors:_}=d,C=r[s];return Yl(C)&&_.isScriptable(s)&&(C=W5(s,C,d,u)),nr(C)&&C.length&&(C=G5(s,C,d,_.isIndexable)),Dw(s,C)&&(C=Kh(C,l,t&&t[s],_)),C}function W5(d,s,u,r){let{_proxy:l,_context:t,_subProxy:_,_stack:C}=u;if(C.has(d))throw new Error("Recursion detected: "+Array.from(C).join("->")+"->"+d);C.add(d);let I=s(t,_||r);return C.delete(d),Dw(d,I)&&(I=Aw(l._scopes,l,d,I)),I}function G5(d,s,u,r){let{_proxy:l,_context:t,_subProxy:_,_descriptors:C}=u;if(typeof t.index<"u"&&r(d))return s[t.index%s.length];if(cn(s[0])){let I=s,O=l._scopes.filter(N=>N!==I);s=[];for(let N of I){let q=Aw(O,l,d,N);s.push(Kh(q,t,_&&_[d],C))}}return s}function ME(d,s,u){return Yl(d)?d(s,u):d}var q5=(d,s)=>d===!0?s:typeof d=="string"?Xl(s,d):void 0;function $5(d,s,u,r,l){for(let t of s){let _=q5(u,t);if(_){d.add(_);let C=ME(_._fallback,u,l);if(typeof C<"u"&&C!==u&&C!==r)return C}else if(_===!1&&typeof r<"u"&&u!==r)return null}return!1}function Aw(d,s,u,r){let l=s._rootScopes,t=ME(s._fallback,u,r),_=[...d,...l],C=new Set;C.add(r);let I=tE(C,_,u,t||u,r);return I===null||typeof t<"u"&&t!==u&&(I=tE(C,_,t,I,r),I===null)?!1:ny(Array.from(C),[""],l,t,()=>Y5(s,u,r))}function tE(d,s,u,r,l){for(;u;)u=$5(d,s,u,r,l);return u}function Y5(d,s,u){let r=d._getTarget();s in r||(r[s]={});let l=r[s];return nr(l)&&cn(u)?u:l||{}}function Z5(d,s,u,r){let l;for(let t of s)if(l=kE(U5(t,d),u),typeof l<"u")return Dw(d,l)?Aw(u,r,d,l):l}function kE(d,s){for(let u of s){if(!u)continue;let r=u[d];if(typeof r<"u")return r}}function iE(d){let s=d._keys;return s||(s=d._keys=X5(d._scopes)),s}function X5(d){let s=new Set;for(let u of d)for(let r of Object.keys(u).filter(l=>!l.startsWith("_")))s.add(r);return Array.from(s)}function Pw(d,s,u,r){let{iScale:l}=d,{key:t="r"}=this._parsing,_=new Array(r),C,I,O,N;for(C=0,I=r;C<I;++C)O=C+u,N=s[O],_[C]={r:l.parse(Xl(N,t),O)};return _}var Q5=Number.EPSILON||1e-14,Xm=(d,s)=>s<d.length&&!d[s].skip&&d[s],IE=d=>d==="x"?"y":"x";function K5(d,s,u,r){let l=d.skip?s:d,t=s,_=u.skip?s:u,C=Yb(t,l),I=Yb(_,t),O=C/(C+I),N=I/(C+I);O=isNaN(O)?0:O,N=isNaN(N)?0:N;let q=r*O,ie=r*N;return{previous:{x:t.x-q*(_.x-l.x),y:t.y-q*(_.y-l.y)},next:{x:t.x+ie*(_.x-l.x),y:t.y+ie*(_.y-l.y)}}}function J5(d,s,u){let r=d.length,l,t,_,C,I,O=Xm(d,0);for(let N=0;N<r-1;++N)if(I=O,O=Xm(d,N+1),!(!I||!O)){if(Jm(s[N],0,Q5)){u[N]=u[N+1]=0;continue}l=u[N]/s[N],t=u[N+1]/s[N],C=Math.pow(l,2)+Math.pow(t,2),!(C<=9)&&(_=3/Math.sqrt(C),u[N]=l*_*s[N],u[N+1]=t*_*s[N])}}function e4(d,s,u="x"){let r=IE(u),l=d.length,t,_,C,I=Xm(d,0);for(let O=0;O<l;++O){if(_=C,C=I,I=Xm(d,O+1),!C)continue;let N=C[u],q=C[r];_&&(t=(N-_[u])/3,C[`cp1${u}`]=N-t,C[`cp1${r}`]=q-t*s[O]),I&&(t=(I[u]-N)/3,C[`cp2${u}`]=N+t,C[`cp2${r}`]=q+t*s[O])}}function t4(d,s="x"){let u=IE(s),r=d.length,l=Array(r).fill(0),t=Array(r),_,C,I,O=Xm(d,0);for(_=0;_<r;++_)if(C=I,I=O,O=Xm(d,_+1),!!I){if(O){let N=O[s]-I[s];l[_]=N!==0?(O[u]-I[u])/N:0}t[_]=C?O?Ms(l[_-1])!==Ms(l[_])?0:(l[_-1]+l[_])/2:l[_-1]:l[_]}J5(d,l,t),e4(d,t,s)}function Wb(d,s,u){return Math.max(Math.min(d,u),s)}function i4(d,s){let u,r,l,t,_,C=tl(d[0],s);for(u=0,r=d.length;u<r;++u)_=t,t=C,C=u<r-1&&tl(d[u+1],s),t&&(l=d[u],_&&(l.cp1x=Wb(l.cp1x,s.left,s.right),l.cp1y=Wb(l.cp1y,s.top,s.bottom)),C&&(l.cp2x=Wb(l.cp2x,s.left,s.right),l.cp2y=Wb(l.cp2y,s.top,s.bottom)))}function TE(d,s,u,r,l){let t,_,C,I;if(s.spanGaps&&(d=d.filter(O=>!O.skip)),s.cubicInterpolationMode==="monotone")t4(d,l);else{let O=r?d[d.length-1]:d[0];for(t=0,_=d.length;t<_;++t)C=d[t],I=K5(O,C,d[Math.min(t+1,_-(r?0:1))%_],s.tension),C.cp1x=I.previous.x,C.cp1y=I.previous.y,C.cp2x=I.next.x,C.cp2y=I.next.y,O=C}s.capBezierPoints&&i4(d,u)}function ry(){return typeof window<"u"&&typeof document<"u"}function oy(d){let s=d.parentNode;return s&&s.toString()==="[object ShadowRoot]"&&(s=s.host),s}function Zb(d,s,u){let r;return typeof d=="string"?(r=parseInt(d,10),d.indexOf("%")!==-1&&(r=r/100*s.parentNode[u])):r=d,r}var ay=d=>d.ownerDocument.defaultView.getComputedStyle(d,null);function n4(d,s){return ay(d).getPropertyValue(s)}var r4=["top","right","bottom","left"];function Qh(d,s,u){let r={};u=u?"-"+u:"";for(let l=0;l<4;l++){let t=r4[l];r[t]=parseFloat(d[s+"-"+t+u])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}var o4=(d,s,u)=>(d>0||s>0)&&(!u||!u.shadowRoot);function a4(d,s){let u=d.touches,r=u&&u.length?u[0]:d,{offsetX:l,offsetY:t}=r,_=!1,C,I;if(o4(l,t,d.target))C=l,I=t;else{let O=s.getBoundingClientRect();C=r.clientX-O.left,I=r.clientY-O.top,_=!0}return{x:C,y:I,box:_}}function Id(d,s){if("native"in d)return d;let{canvas:u,currentDevicePixelRatio:r}=s,l=ay(u),t=l.boxSizing==="border-box",_=Qh(l,"padding"),C=Qh(l,"border","width"),{x:I,y:O,box:N}=a4(d,u),q=_.left+(N&&C.left),ie=_.top+(N&&C.top),{width:de,height:xe}=s;return t&&(de-=_.width+C.width,xe-=_.height+C.height),{x:Math.round((I-q)/de*u.width/r),y:Math.round((O-ie)/xe*u.height/r)}}function s4(d,s,u){let r,l;if(s===void 0||u===void 0){let t=d&&oy(d);if(!t)s=d.clientWidth,u=d.clientHeight;else{let _=t.getBoundingClientRect(),C=ay(t),I=Qh(C,"border","width"),O=Qh(C,"padding");s=_.width-O.width-I.width,u=_.height-O.height-I.height,r=Zb(C.maxWidth,t,"clientWidth"),l=Zb(C.maxHeight,t,"clientHeight")}}return{width:s,height:u,maxWidth:r||$b,maxHeight:l||$b}}var Gb=d=>Math.round(d*10)/10;function EE(d,s,u,r){let l=ay(d),t=Qh(l,"margin"),_=Zb(l.maxWidth,d,"clientWidth")||$b,C=Zb(l.maxHeight,d,"clientHeight")||$b,I=s4(d,s,u),{width:O,height:N}=I;if(l.boxSizing==="content-box"){let ie=Qh(l,"border","width"),de=Qh(l,"padding");O-=de.width+ie.width,N-=de.height+ie.height}return O=Math.max(0,O-t.width),N=Math.max(0,r?O/r:N-t.height),O=Gb(Math.min(O,_,I.maxWidth)),N=Gb(Math.min(N,C,I.maxHeight)),O&&!N&&(N=Gb(O/2)),(s!==void 0||u!==void 0)&&r&&I.height&&N>I.height&&(N=I.height,O=Gb(Math.floor(N*r))),{width:O,height:N}}function Ow(d,s,u){let r=s||1,l=Math.floor(d.height*r),t=Math.floor(d.width*r);d.height=Math.floor(d.height),d.width=Math.floor(d.width);let _=d.canvas;return _.style&&(u||!_.style.height&&!_.style.width)&&(_.style.height=`${d.height}px`,_.style.width=`${d.width}px`),d.currentDevicePixelRatio!==r||_.height!==l||_.width!==t?(d.currentDevicePixelRatio=r,_.height=l,_.width=t,d.ctx.setTransform(r,0,0,r,0,0),!0):!1}var DE=function(){let d=!1;try{let s={get passive(){return d=!0,!1}};ry()&&(window.addEventListener("test",null,s),window.removeEventListener("test",null,s))}catch{}return d}();function Rw(d,s){let u=n4(d,s),r=u&&u.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function wd(d,s,u,r){return{x:d.x+u*(s.x-d.x),y:d.y+u*(s.y-d.y)}}function AE(d,s,u,r){return{x:d.x+u*(s.x-d.x),y:r==="middle"?u<.5?d.y:s.y:r==="after"?u<1?d.y:s.y:u>0?s.y:d.y}}function PE(d,s,u,r){let l={x:d.cp2x,y:d.cp2y},t={x:s.cp1x,y:s.cp1y},_=wd(d,l,u),C=wd(l,t,u),I=wd(t,s,u),O=wd(_,C,u),N=wd(C,I,u);return wd(O,N,u)}var l4=function(d,s){return{x(u){return d+d+s-u},setWidth(u){s=u},textAlign(u){return u==="center"?u:u==="right"?"left":"right"},xPlus(u,r){return u-r},leftForLtr(u,r){return u-r}}},c4=function(){return{x(d){return d},setWidth(d){},textAlign(d){return d},xPlus(d,s){return d+s},leftForLtr(d,s){return d}}};function eu(d,s,u){return d?l4(s,u):c4()}function Lw(d,s){let u,r;(s==="ltr"||s==="rtl")&&(u=d.canvas.style,r=[u.getPropertyValue("direction"),u.getPropertyPriority("direction")],u.setProperty("direction",s,"important"),d.prevTextDirection=r)}function Fw(d,s){s!==void 0&&(delete d.prevTextDirection,d.canvas.style.setProperty("direction",s[0],s[1]))}function OE(d){return d==="angle"?{between:ep,compare:k5,normalize:ia}:{between:nl,compare:(s,u)=>s-u,normalize:s=>s}}function nE({start:d,end:s,count:u,loop:r,style:l}){return{start:d%u,end:s%u,loop:r&&(s-d+1)%u===0,style:l}}function d4(d,s,u){let{property:r,start:l,end:t}=u,{between:_,normalize:C}=OE(r),I=s.length,{start:O,end:N,loop:q}=d,ie,de;if(q){for(O+=I,N+=I,ie=0,de=I;ie<de&&_(C(s[O%I][r]),l,t);++ie)O--,N--;O%=I,N%=I}return N<O&&(N+=I),{start:O,end:N,loop:q,style:d.style}}function zw(d,s,u){if(!u)return[d];let{property:r,start:l,end:t}=u,_=s.length,{compare:C,between:I,normalize:O}=OE(r),{start:N,end:q,loop:ie,style:de}=d4(d,s,u),xe=[],ke=!1,Ae=null,Xe,qe,ut,It=()=>I(l,ut,Xe)&&C(l,ut)!==0,wt=()=>C(t,Xe)===0||I(t,ut,Xe),Et=()=>ke||It(),Ht=()=>!ke||wt();for(let Ct=N,Yt=N;Ct<=q;++Ct)qe=s[Ct%_],!qe.skip&&(Xe=O(qe[r]),Xe!==ut&&(ke=I(Xe,l,t),Ae===null&&Et()&&(Ae=C(Xe,l)===0?Ct:Yt),Ae!==null&&Ht()&&(xe.push(nE({start:Ae,end:Ct,loop:ie,count:_,style:de})),Ae=null),Yt=Ct,ut=Xe));return Ae!==null&&xe.push(nE({start:Ae,end:q,loop:ie,count:_,style:de})),xe}function Bw(d,s){let u=[],r=d.segments;for(let l=0;l<r.length;l++){let t=zw(r[l],d.points,s);t.length&&u.push(...t)}return u}function h4(d,s,u,r){let l=0,t=s-1;if(u&&!r)for(;l<s&&!d[l].skip;)l++;for(;l<s&&d[l].skip;)l++;for(l%=s,u&&(t+=l);t>l&&d[t%s].skip;)t--;return t%=s,{start:l,end:t}}function u4(d,s,u,r){let l=d.length,t=[],_=s,C=d[s],I;for(I=s+1;I<=u;++I){let O=d[I%l];O.skip||O.stop?C.skip||(r=!1,t.push({start:s%l,end:(I-1)%l,loop:r}),s=_=O.stop?I:null):(_=I,C.skip&&(s=I)),C=O}return _!==null&&t.push({start:s%l,end:_%l,loop:r}),t}function RE(d,s){let u=d.points,r=d.options.spanGaps,l=u.length;if(!l)return[];let t=!!d._loop,{start:_,end:C}=h4(u,l,t,r);if(r===!0)return rE(d,[{start:_,end:C,loop:t}],u,s);let I=C<_?C+l:C,O=!!d._fullLoop&&_===0&&C===l-1;return rE(d,u4(u,_,I,O),u,s)}function rE(d,s,u,r){return!r||!r.setContext||!u?s:m4(d,s,u,r)}function m4(d,s,u,r){let l=d._chart.getContext(),t=oE(d.options),{_datasetIndex:_,options:{spanGaps:C}}=d,I=u.length,O=[],N=t,q=s[0].start,ie=q;function de(xe,ke,Ae,Xe){let qe=C?-1:1;if(xe!==ke){for(xe+=I;u[xe%I].skip;)xe-=qe;for(;u[ke%I].skip;)ke+=qe;xe%I!==ke%I&&(O.push({start:xe%I,end:ke%I,loop:Ae,style:Xe}),N=Xe,q=ke%I)}}for(let xe of s){q=C?q:xe.start;let ke=u[q%I],Ae;for(ie=q+1;ie<=xe.end;ie++){let Xe=u[ie%I];Ae=oE(r.setContext(Ql(l,{type:"segment",p0:ke,p1:Xe,p0DataIndex:(ie-1)%I,p1DataIndex:ie%I,datasetIndex:_}))),p4(Ae,N)&&de(q,ie-1,xe.loop,N),ke=Xe,N=Ae}q<ie-1&&de(q,ie-1,xe.loop,N)}return O}function oE(d){return{backgroundColor:d.backgroundColor,borderCapStyle:d.borderCapStyle,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderJoinStyle:d.borderJoinStyle,borderWidth:d.borderWidth,borderColor:d.borderColor}}function p4(d,s){if(!s)return!1;let u=[],r=function(l,t){return Sw(t)?(u.includes(t)||u.push(t),u.indexOf(t)):t};return JSON.stringify(d,r)!==JSON.stringify(s,r)}var Yw=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,u,r,l){let t=u.listeners[l],_=u.duration;t.forEach(C=>C({chart:s,initial:u.initial,numSteps:_,currentStep:Math.min(r-u.start,_)}))}_refresh(){this._request||(this._running=!0,this._request=vw.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let u=0;this._charts.forEach((r,l)=>{if(!r.running||!r.items.length)return;let t=r.items,_=t.length-1,C=!1,I;for(;_>=0;--_)I=t[_],I._active?(I._total>r.duration&&(r.duration=I._total),I.tick(s),C=!0):(t[_]=t[t.length-1],t.pop());C&&(l.draw(),this._notify(l,r,s,"progress")),t.length||(r.running=!1,this._notify(l,r,s,"complete"),r.initial=!1),u+=t.length}),this._lastDate=s,u===0&&(this._running=!1)}_getAnims(s){let u=this._charts,r=u.get(s);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},u.set(s,r)),r}listen(s,u,r){this._getAnims(s).listeners[u].push(r)}add(s,u){!u||!u.length||this._getAnims(s).items.push(...u)}has(s){return this._getAnims(s).items.length>0}start(s){let u=this._charts.get(s);u&&(u.running=!0,u.start=Date.now(),u.duration=u.items.reduce((r,l)=>Math.max(r,l._duration),0),this._refresh())}running(s){if(!this._running)return!1;let u=this._charts.get(s);return!(!u||!u.running||!u.items.length)}stop(s){let u=this._charts.get(s);if(!u||!u.items.length)return;let r=u.items,l=r.length-1;for(;l>=0;--l)r[l].cancel();u.items=[],this._notify(s,u,Date.now(),"complete")}remove(s){return this._charts.delete(s)}},Kl=new Yw,LE="transparent",f4={boolean(d,s,u){return u>.5?s:d},color(d,s,u){let r=Mw(d||LE),l=r.valid&&Mw(s||LE);return l&&l.valid?l.mix(r,u).hexString():s},number(d,s,u){return d+(s-d)*u}},Zw=class{constructor(s,u,r,l){let t=u[r];l=np([s.to,l,t,s.from]);let _=np([s.from,t,l]);this._active=!0,this._fn=s.fn||f4[s.type||typeof _],this._easing=Ym[s.easing]||Ym.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=u,this._prop=r,this._from=_,this._to=l,this._promises=void 0}active(){return this._active}update(s,u,r){if(this._active){this._notify(!1);let l=this._target[this._prop],t=r-this._start,_=this._duration-t;this._start=r,this._duration=Math.floor(Math.max(_,s.duration)),this._total+=t,this._loop=!!s.loop,this._to=np([s.to,u,l,s.from]),this._from=np([s.from,l,u])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){let u=s-this._start,r=this._duration,l=this._prop,t=this._from,_=this._loop,C=this._to,I;if(this._active=t!==C&&(_||u<r),!this._active){this._target[l]=C,this._notify(!0);return}if(u<0){this._target[l]=t;return}I=u/r%2,I=_&&I>1?2-I:I,I=this._easing(Math.min(1,Math.max(0,I))),this._target[l]=this._fn(t,C,I)}wait(){let s=this._promises||(this._promises=[]);return new Promise((u,r)=>{s.push({res:u,rej:r})})}_notify(s){let u=s?"res":"rej",r=this._promises||[];for(let l=0;l<r.length;l++)r[l][u]()}},gy=class{constructor(s,u){this._chart=s,this._properties=new Map,this.configure(u)}configure(s){if(!cn(s))return;let u=Object.keys(vr.animation),r=this._properties;Object.getOwnPropertyNames(s).forEach(l=>{let t=s[l];if(!cn(t))return;let _={};for(let C of u)_[C]=t[C];(nr(t.properties)&&t.properties||[l]).forEach(C=>{(C===l||!r.has(C))&&r.set(C,_)})})}_animateOptions(s,u){let r=u.options,l=_4(s,r);if(!l)return[];let t=this._createAnimations(l,r);return r.$shared&&g4(s.options.$animations,r).then(()=>{s.options=r},()=>{}),t}_createAnimations(s,u){let r=this._properties,l=[],t=s.$animations||(s.$animations={}),_=Object.keys(u),C=Date.now(),I;for(I=_.length-1;I>=0;--I){let O=_[I];if(O.charAt(0)==="$")continue;if(O==="options"){l.push(...this._animateOptions(s,u));continue}let N=u[O],q=t[O],ie=r.get(O);if(q)if(ie&&q.active()){q.update(ie,N,C);continue}else q.cancel();if(!ie||!ie.duration){s[O]=N;continue}t[O]=q=new Zw(ie,s,O,N),l.push(q)}return l}update(s,u){if(this._properties.size===0){Object.assign(s,u);return}let r=this._createAnimations(s,u);if(r.length)return Kl.add(this._chart,r),!0}};function g4(d,s){let u=[],r=Object.keys(s);for(let l=0;l<r.length;l++){let t=d[r[l]];t&&t.active()&&u.push(t.wait())}return Promise.all(u)}function _4(d,s){if(!s)return;let u=d.options;if(!u){d.options=s;return}return u.$shared&&(d.options=u=Object.assign({},u,{$shared:!1,$animations:{}})),u}function FE(d,s){let u=d&&d.options||{},r=u.reverse,l=u.min===void 0?s:0,t=u.max===void 0?s:0;return{start:r?t:l,end:r?l:t}}function b4(d,s,u){if(u===!1)return!1;let r=FE(d,u),l=FE(s,u);return{top:l.end,right:r.end,bottom:l.start,left:r.start}}function y4(d){let s,u,r,l;return cn(d)?(s=d.top,u=d.right,r=d.bottom,l=d.left):s=u=r=l=d,{top:s,right:u,bottom:r,left:l,disabled:d===!1}}function FD(d,s){let u=[],r=d._getSortedDatasetMetas(s),l,t;for(l=0,t=r.length;l<t;++l)u.push(r[l].index);return u}function zE(d,s,u,r={}){let l=d.keys,t=r.mode==="single",_,C,I,O;if(s!==null){for(_=0,C=l.length;_<C;++_){if(I=+l[_],I===u){if(r.all)continue;break}O=d.values[I],yr(O)&&(t||s===0||Ms(s)===Ms(O))&&(s+=O)}return s}}function v4(d,s){let{iScale:u,vScale:r}=s,l=u.axis==="x"?"x":"y",t=r.axis==="x"?"x":"y",_=Object.keys(d),C=new Array(_.length),I,O,N;for(I=0,O=_.length;I<O;++I)N=_[I],C[I]={[l]:N,[t]:d[N]};return C}function BE(d,s){let u=d&&d.options.stacked;return u||u===void 0&&s.stack!==void 0}function x4(d,s,u){return`${d.id}.${s.id}.${u.stack||u.type}`}function w4(d){let{min:s,max:u,minDefined:r,maxDefined:l}=d.getUserBounds();return{min:r?s:Number.NEGATIVE_INFINITY,max:l?u:Number.POSITIVE_INFINITY}}function C4(d,s,u){let r=d[s]||(d[s]={});return r[u]||(r[u]={})}function NE(d,s,u,r){for(let l of s.getMatchingVisibleMetas(r).reverse()){let t=d[l.index];if(u&&t>0||!u&&t<0)return l.index}return null}function VE(d,s){let{chart:u,_cachedMeta:r}=d,l=u._stacks||(u._stacks={}),{iScale:t,vScale:_,index:C}=r,I=t.axis,O=_.axis,N=x4(t,_,r),q=s.length,ie;for(let de=0;de<q;++de){let xe=s[de],{[I]:ke,[O]:Ae}=xe,Xe=xe._stacks||(xe._stacks={});ie=Xe[O]=C4(l,N,ke),ie[C]=Ae,ie._top=NE(ie,_,!0,r.type),ie._bottom=NE(ie,_,!1,r.type);let qe=ie._visualValues||(ie._visualValues={});qe[C]=Ae}}function Nw(d,s){let u=d.scales;return Object.keys(u).filter(r=>u[r].axis===s).shift()}function S4(d,s){return Ql(d,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}function M4(d,s,u){return Ql(d,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:u,index:s,mode:"default",type:"data"})}function Pg(d,s){let u=d.controller.index,r=d.vScale&&d.vScale.axis;if(r){s=s||d._parsed;for(let l of s){let t=l._stacks;if(!t||t[r]===void 0||t[r][u]===void 0)return;delete t[r][u],t[r]._visualValues!==void 0&&t[r]._visualValues[u]!==void 0&&delete t[r]._visualValues[u]}}}var Vw=d=>d==="reset"||d==="none",jE=(d,s)=>s?d:Object.assign({},d),k4=(d,s,u)=>d&&!s.hidden&&s._stacked&&{keys:FD(u,!0),values:null},Ed=(()=>{class d{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(u,r){this.chart=u,this._ctx=u.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let u=this._cachedMeta;this.configure(),this.linkScales(),u._stacked=BE(u.vScale,u),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(u){this.index!==u&&Pg(this._cachedMeta),this.index=u}linkScales(){let u=this.chart,r=this._cachedMeta,l=this.getDataset(),t=(ie,de,xe,ke)=>ie==="x"?de:ie==="r"?ke:xe,_=r.xAxisID=Yi(l.xAxisID,Nw(u,"x")),C=r.yAxisID=Yi(l.yAxisID,Nw(u,"y")),I=r.rAxisID=Yi(l.rAxisID,Nw(u,"r")),O=r.indexAxis,N=r.iAxisID=t(O,_,C,I),q=r.vAxisID=t(O,C,_,I);r.xScale=this.getScaleForId(_),r.yScale=this.getScaleForId(C),r.rScale=this.getScaleForId(I),r.iScale=this.getScaleForId(N),r.vScale=this.getScaleForId(q)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(u){return this.chart.scales[u]}_getOtherScale(u){let r=this._cachedMeta;return u===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){let u=this._cachedMeta;this._data&&bw(this._data,this),u._stacked&&Pg(u)}_dataCheck(){let u=this.getDataset(),r=u.data||(u.data=[]),l=this._data;if(cn(r)){let t=this._cachedMeta;this._data=v4(r,t)}else if(l!==r){if(l){bw(l,this);let t=this._cachedMeta;Pg(t),t._parsed=[]}r&&Object.isExtensible(r)&&gE(r,this),this._syncList=[],this._data=r}}addElements(){let u=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(u.dataset=new this.datasetElementType)}buildOrUpdateElements(u){let r=this._cachedMeta,l=this.getDataset(),t=!1;this._dataCheck();let _=r._stacked;r._stacked=BE(r.vScale,r),r.stack!==l.stack&&(t=!0,Pg(r),r.stack=l.stack),this._resyncElements(u),(t||_!==r._stacked)&&VE(this,r._parsed)}configure(){let u=this.chart.config,r=u.datasetScopeKeys(this._type),l=u.getOptionScopes(this.getDataset(),r,!0);this.options=u.createResolver(l,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(u,r){let{_cachedMeta:l,_data:t}=this,{iScale:_,_stacked:C}=l,I=_.axis,O=u===0&&r===t.length?!0:l._sorted,N=u>0&&l._parsed[u-1],q,ie,de;if(this._parsing===!1)l._parsed=t,l._sorted=!0,de=t;else{nr(t[u])?de=this.parseArrayData(l,t,u,r):cn(t[u])?de=this.parseObjectData(l,t,u,r):de=this.parsePrimitiveData(l,t,u,r);let xe=()=>ie[I]===null||N&&ie[I]<N[I];for(q=0;q<r;++q)l._parsed[q+u]=ie=de[q],O&&(xe()&&(O=!1),N=ie);l._sorted=O}C&&VE(this,de)}parsePrimitiveData(u,r,l,t){let{iScale:_,vScale:C}=u,I=_.axis,O=C.axis,N=_.getLabels(),q=_===C,ie=new Array(t),de,xe,ke;for(de=0,xe=t;de<xe;++de)ke=de+l,ie[de]={[I]:q||_.parse(N[ke],ke),[O]:C.parse(r[ke],ke)};return ie}parseArrayData(u,r,l,t){let{xScale:_,yScale:C}=u,I=new Array(t),O,N,q,ie;for(O=0,N=t;O<N;++O)q=O+l,ie=r[q],I[O]={x:_.parse(ie[0],q),y:C.parse(ie[1],q)};return I}parseObjectData(u,r,l,t){let{xScale:_,yScale:C}=u,{xAxisKey:I="x",yAxisKey:O="y"}=this._parsing,N=new Array(t),q,ie,de,xe;for(q=0,ie=t;q<ie;++q)de=q+l,xe=r[de],N[q]={x:_.parse(Xl(xe,I),de),y:C.parse(Xl(xe,O),de)};return N}getParsed(u){return this._cachedMeta._parsed[u]}getDataElement(u){return this._cachedMeta.data[u]}applyStack(u,r,l){let t=this.chart,_=this._cachedMeta,C=r[u.axis],I={keys:FD(t,!0),values:r._stacks[u.axis]._visualValues};return zE(I,C,_.index,{mode:l})}updateRangeFromParsed(u,r,l,t){let _=l[r.axis],C=_===null?NaN:_,I=t&&l._stacks[r.axis];t&&I&&(t.values=I,C=zE(t,_,this._cachedMeta.index)),u.min=Math.min(u.min,C),u.max=Math.max(u.max,C)}getMinMax(u,r){let l=this._cachedMeta,t=l._parsed,_=l._sorted&&u===l.iScale,C=t.length,I=this._getOtherScale(u),O=k4(r,l,this.chart),N={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:q,max:ie}=w4(I),de,xe;function ke(){xe=t[de];let Ae=xe[I.axis];return!yr(xe[u.axis])||q>Ae||ie<Ae}for(de=0;de<C&&!(!ke()&&(this.updateRangeFromParsed(N,u,xe,O),_));++de);if(_){for(de=C-1;de>=0;--de)if(!ke()){this.updateRangeFromParsed(N,u,xe,O);break}}return N}getAllParsedValues(u){let r=this._cachedMeta._parsed,l=[],t,_,C;for(t=0,_=r.length;t<_;++t)C=r[t][u.axis],yr(C)&&l.push(C);return l}getMaxOverflow(){return!1}getLabelAndValue(u){let r=this._cachedMeta,l=r.iScale,t=r.vScale,_=this.getParsed(u);return{label:l?""+l.getLabelForValue(_[l.axis]):"",value:t?""+t.getLabelForValue(_[t.axis]):""}}_update(u){let r=this._cachedMeta;this.update(u||"default"),r._clip=y4(Yi(this.options.clip,b4(r.xScale,r.yScale,this.getMaxOverflow())))}update(u){}draw(){let u=this._ctx,r=this.chart,l=this._cachedMeta,t=l.data||[],_=r.chartArea,C=[],I=this._drawStart||0,O=this._drawCount||t.length-I,N=this.options.drawActiveElementsOnTop,q;for(l.dataset&&l.dataset.draw(u,_,I,O),q=I;q<I+O;++q){let ie=t[q];ie.hidden||(ie.active&&N?C.push(ie):ie.draw(u,_))}for(q=0;q<C.length;++q)C[q].draw(u,_)}getStyle(u,r){let l=r?"active":"default";return u===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(l):this.resolveDataElementOptions(u||0,l)}getContext(u,r,l){let t=this.getDataset(),_;if(u>=0&&u<this._cachedMeta.data.length){let C=this._cachedMeta.data[u];_=C.$context||(C.$context=M4(this.getContext(),u,C)),_.parsed=this.getParsed(u),_.raw=t.data[u],_.index=_.dataIndex=u}else _=this.$context||(this.$context=S4(this.chart.getContext(),this.index)),_.dataset=t,_.index=_.datasetIndex=this.index;return _.active=!!r,_.mode=l,_}resolveDatasetElementOptions(u){return this._resolveElementOptions(this.datasetElementType.id,u)}resolveDataElementOptions(u,r){return this._resolveElementOptions(this.dataElementType.id,r,u)}_resolveElementOptions(u,r="default",l){let t=r==="active",_=this._cachedDataOpts,C=u+"-"+r,I=_[C],O=this.enableOptionSharing&&Km(l);if(I)return jE(I,O);let N=this.chart.config,q=N.datasetElementScopeKeys(this._type,u),ie=t?[`${u}Hover`,"hover",u,""]:[u,""],de=N.getOptionScopes(this.getDataset(),q),xe=Object.keys(vr.elements[u]),ke=()=>this.getContext(l,t,r),Ae=N.resolveNamedOptions(de,xe,ke,ie);return Ae.$shared&&(Ae.$shared=O,_[C]=Object.freeze(jE(Ae,O))),Ae}_resolveAnimations(u,r,l){let t=this.chart,_=this._cachedDataOpts,C=`animation-${r}`,I=_[C];if(I)return I;let O;if(t.options.animation!==!1){let q=this.chart.config,ie=q.datasetAnimationScopeKeys(this._type,r),de=q.getOptionScopes(this.getDataset(),ie);O=q.createResolver(de,this.getContext(u,l,r))}let N=new gy(t,O&&O.animations);return O&&O._cacheable&&(_[C]=Object.freeze(N)),N}getSharedOptions(u){if(u.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},u))}includeOptions(u,r){return!r||Vw(u)||this.chart._animationsDisabled}_getSharedOptions(u,r){let l=this.resolveDataElementOptions(u,r),t=this._sharedOptions,_=this.getSharedOptions(l),C=this.includeOptions(r,_)||_!==t;return this.updateSharedOptions(_,r,l),{sharedOptions:_,includeOptions:C}}updateElement(u,r,l,t){Vw(t)?Object.assign(u,l):this._resolveAnimations(r,t).update(u,l)}updateSharedOptions(u,r,l){u&&!Vw(r)&&this._resolveAnimations(void 0,r).update(u,l)}_setStyle(u,r,l,t){u.active=t;let _=this.getStyle(r,t);this._resolveAnimations(r,l,t).update(u,{options:!t&&this.getSharedOptions(_)||_})}removeHoverStyle(u,r,l){this._setStyle(u,l,"active",!1)}setHoverStyle(u,r,l){this._setStyle(u,l,"active",!0)}_removeDatasetHoverStyle(){let u=this._cachedMeta.dataset;u&&this._setStyle(u,void 0,"active",!1)}_setDatasetHoverStyle(){let u=this._cachedMeta.dataset;u&&this._setStyle(u,void 0,"active",!0)}_resyncElements(u){let r=this._data,l=this._cachedMeta.data;for(let[I,O,N]of this._syncList)this[I](O,N);this._syncList=[];let t=l.length,_=r.length,C=Math.min(_,t);C&&this.parse(0,C),_>t?this._insertElements(t,_-t,u):_<t&&this._removeElements(_,t-_)}_insertElements(u,r,l=!0){let t=this._cachedMeta,_=t.data,C=u+r,I,O=N=>{for(N.length+=r,I=N.length-1;I>=C;I--)N[I]=N[I-r]};for(O(_),I=u;I<C;++I)_[I]=new this.dataElementType;this._parsing&&O(t._parsed),this.parse(u,r),l&&this.updateElements(_,u,r,"reset")}updateElements(u,r,l,t){}_removeElements(u,r){let l=this._cachedMeta;if(this._parsing){let t=l._parsed.splice(u,r);l._stacked&&Pg(l,t)}l.data.splice(u,r)}_sync(u){if(this._parsing)this._syncList.push(u);else{let[r,l,t]=u;this[r](l,t)}this.chart._dataChanges.push([this.index,...u])}_onDataPush(){let u=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-u,u])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(u,r){r&&this._sync(["_removeElements",u,r]);let l=arguments.length-2;l&&this._sync(["_insertElements",u,l])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return d})();function I4(d,s){if(!d._cache.$bar){let u=d.getMatchingVisibleMetas(s),r=[];for(let l=0,t=u.length;l<t;l++)r=r.concat(u[l].controller.getAllParsedValues(d));d._cache.$bar=yw(r.sort((l,t)=>l-t))}return d._cache.$bar}function T4(d){let s=d.iScale,u=I4(s,d.type),r=s._length,l,t,_,C,I=()=>{_===32767||_===-32768||(Km(C)&&(r=Math.min(r,Math.abs(_-C)||r)),C=_)};for(l=0,t=u.length;l<t;++l)_=s.getPixelForValue(u[l]),I();for(C=void 0,l=0,t=s.ticks.length;l<t;++l)_=s.getPixelForTick(l),I();return r}function E4(d,s,u,r){let l=u.barThickness,t,_;return vn(l)?(t=s.min*u.categoryPercentage,_=u.barPercentage):(t=l*r,_=1),{chunk:t/r,ratio:_,start:s.pixels[d]-t/2}}function D4(d,s,u,r){let l=s.pixels,t=l[d],_=d>0?l[d-1]:null,C=d<l.length-1?l[d+1]:null,I=u.categoryPercentage;_===null&&(_=t-(C===null?s.end-s.start:C-t)),C===null&&(C=t+t-_);let O=t-(t-Math.min(_,C))/2*I;return{chunk:Math.abs(C-_)/2*I/r,ratio:u.barPercentage,start:O}}function A4(d,s,u,r){let l=u.parse(d[0],r),t=u.parse(d[1],r),_=Math.min(l,t),C=Math.max(l,t),I=_,O=C;Math.abs(_)>Math.abs(C)&&(I=C,O=_),s[u.axis]=O,s._custom={barStart:I,barEnd:O,start:l,end:t,min:_,max:C}}function zD(d,s,u,r){return nr(d)?A4(d,s,u,r):s[u.axis]=u.parse(d,r),s}function UE(d,s,u,r){let l=d.iScale,t=d.vScale,_=l.getLabels(),C=l===t,I=[],O,N,q,ie;for(O=u,N=u+r;O<N;++O)ie=s[O],q={},q[l.axis]=C||l.parse(_[O],O),I.push(zD(ie,q,t,O));return I}function jw(d){return d&&d.barStart!==void 0&&d.barEnd!==void 0}function P4(d,s,u){return d!==0?Ms(d):(s.isHorizontal()?1:-1)*(s.min>=u?1:-1)}function O4(d){let s,u,r,l,t;return d.horizontal?(s=d.base>d.x,u="left",r="right"):(s=d.base<d.y,u="bottom",r="top"),s?(l="end",t="start"):(l="start",t="end"),{start:u,end:r,reverse:s,top:l,bottom:t}}function R4(d,s,u,r){let l=s.borderSkipped,t={};if(!l){d.borderSkipped=t;return}if(l===!0){d.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:_,end:C,reverse:I,top:O,bottom:N}=O4(d);l==="middle"&&u&&(d.enableBorderRadius=!0,(u._top||0)===r?l=O:(u._bottom||0)===r?l=N:(t[HE(N,_,C,I)]=!0,l=O)),t[HE(l,_,C,I)]=!0,d.borderSkipped=t}function HE(d,s,u,r){return r?(d=L4(d,s,u),d=WE(d,u,s)):d=WE(d,s,u),d}function L4(d,s,u){return d===s?u:d===u?s:d}function WE(d,s,u){return d==="start"?s:d==="end"?u:d}function F4(d,{inflateAmount:s},u){d.inflateAmount=s==="auto"?u===1?.33:0:s}var z4=(()=>{class d extends Ed{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(u,r,l,t){return UE(u,r,l,t)}parseArrayData(u,r,l,t){return UE(u,r,l,t)}parseObjectData(u,r,l,t){let{iScale:_,vScale:C}=u,{xAxisKey:I="x",yAxisKey:O="y"}=this._parsing,N=_.axis==="x"?I:O,q=C.axis==="x"?I:O,ie=[],de,xe,ke,Ae;for(de=l,xe=l+t;de<xe;++de)Ae=r[de],ke={},ke[_.axis]=_.parse(Xl(Ae,N),de),ie.push(zD(Xl(Ae,q),ke,C,de));return ie}updateRangeFromParsed(u,r,l,t){super.updateRangeFromParsed(u,r,l,t);let _=l._custom;_&&r===this._cachedMeta.vScale&&(u.min=Math.min(u.min,_.min),u.max=Math.max(u.max,_.max))}getMaxOverflow(){return 0}getLabelAndValue(u){let r=this._cachedMeta,{iScale:l,vScale:t}=r,_=this.getParsed(u),C=_._custom,I=jw(C)?"["+C.start+", "+C.end+"]":""+t.getLabelForValue(_[t.axis]);return{label:""+l.getLabelForValue(_[l.axis]),value:I}}initialize(){this.enableOptionSharing=!0,super.initialize();let u=this._cachedMeta;u.stack=this.getDataset().stack}update(u){let r=this._cachedMeta;this.updateElements(r.data,0,r.data.length,u)}updateElements(u,r,l,t){let _=t==="reset",{index:C,_cachedMeta:{vScale:I}}=this,O=I.getBasePixel(),N=I.isHorizontal(),q=this._getRuler(),{sharedOptions:ie,includeOptions:de}=this._getSharedOptions(r,t);for(let xe=r;xe<r+l;xe++){let ke=this.getParsed(xe),Ae=_||vn(ke[I.axis])?{base:O,head:O}:this._calculateBarValuePixels(xe),Xe=this._calculateBarIndexPixels(xe,q),qe=(ke._stacks||{})[I.axis],ut={horizontal:N,base:Ae.base,enableBorderRadius:!qe||jw(ke._custom)||C===qe._top||C===qe._bottom,x:N?Ae.head:Xe.center,y:N?Xe.center:Ae.head,height:N?Xe.size:Math.abs(Ae.size),width:N?Math.abs(Ae.size):Xe.size};de&&(ut.options=ie||this.resolveDataElementOptions(xe,u[xe].active?"active":t));let It=ut.options||u[xe].options;R4(ut,It,qe,C),F4(ut,It,q.ratio),this.updateElement(u[xe],xe,ut,t)}}_getStacks(u,r){let{iScale:l}=this._cachedMeta,t=l.getMatchingVisibleMetas(this._type).filter(O=>O.controller.options.grouped),_=l.options.stacked,C=[],I=O=>{let N=O.controller.getParsed(r),q=N&&N[O.vScale.axis];if(vn(q)||isNaN(q))return!0};for(let O of t)if(!(r!==void 0&&I(O))&&((_===!1||C.indexOf(O.stack)===-1||_===void 0&&O.stack===void 0)&&C.push(O.stack),O.index===u))break;return C.length||C.push(void 0),C}_getStackCount(u){return this._getStacks(void 0,u).length}_getStackIndex(u,r,l){let t=this._getStacks(u,l),_=r!==void 0?t.indexOf(r):-1;return _===-1?t.length-1:_}_getRuler(){let u=this.options,r=this._cachedMeta,l=r.iScale,t=[],_,C;for(_=0,C=r.data.length;_<C;++_)t.push(l.getPixelForValue(this.getParsed(_)[l.axis],_));let I=u.barThickness;return{min:I||T4(r),pixels:t,start:l._startPixel,end:l._endPixel,stackCount:this._getStackCount(),scale:l,grouped:u.grouped,ratio:I?1:u.categoryPercentage*u.barPercentage}}_calculateBarValuePixels(u){let{_cachedMeta:{vScale:r,_stacked:l,index:t},options:{base:_,minBarLength:C}}=this,I=_||0,O=this.getParsed(u),N=O._custom,q=jw(N),ie=O[r.axis],de=0,xe=l?this.applyStack(r,O,l):ie,ke,Ae;xe!==ie&&(de=xe-ie,xe=ie),q&&(ie=N.barStart,xe=N.barEnd-N.barStart,ie!==0&&Ms(ie)!==Ms(N.barEnd)&&(de=0),de+=ie);let Xe=!vn(_)&&!q?_:de,qe=r.getPixelForValue(Xe);if(this.chart.getDataVisibility(u)?ke=r.getPixelForValue(de+xe):ke=qe,Ae=ke-qe,Math.abs(Ae)<C){Ae=P4(Ae,r,I)*C,ie===I&&(qe-=Ae/2);let ut=r.getPixelForDecimal(0),It=r.getPixelForDecimal(1),wt=Math.min(ut,It),Et=Math.max(ut,It);qe=Math.max(Math.min(qe,Et),wt),ke=qe+Ae,l&&!q&&(O._stacks[r.axis]._visualValues[t]=r.getValueForPixel(ke)-r.getValueForPixel(qe))}if(qe===r.getPixelForValue(I)){let ut=Ms(Ae)*r.getLineWidthForValue(I)/2;qe+=ut,Ae-=ut}return{size:Ae,base:qe,head:ke,center:ke+Ae/2}}_calculateBarIndexPixels(u,r){let l=r.scale,t=this.options,_=t.skipNull,C=Yi(t.maxBarThickness,1/0),I,O;if(r.grouped){let N=_?this._getStackCount(u):r.stackCount,q=t.barThickness==="flex"?D4(u,r,t,N):E4(u,r,t,N),ie=this._getStackIndex(this.index,this._cachedMeta.stack,_?u:void 0);I=q.start+q.chunk*ie+q.chunk/2,O=Math.min(C,q.chunk*q.ratio)}else I=l.getPixelForValue(this.getParsed(u)[l.axis],u),O=Math.min(C,r.min*r.ratio);return{base:I-O/2,head:I+O/2,center:I,size:O}}draw(){let u=this._cachedMeta,r=u.vScale,l=u.data,t=l.length,_=0;for(;_<t;++_)this.getParsed(_)[r.axis]!==null&&!l[_].hidden&&l[_].draw(this._ctx)}}return d})(),B4=(()=>{class d extends Ed{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(u,r,l,t){let _=super.parsePrimitiveData(u,r,l,t);for(let C=0;C<_.length;C++)_[C]._custom=this.resolveDataElementOptions(C+l).radius;return _}parseArrayData(u,r,l,t){let _=super.parseArrayData(u,r,l,t);for(let C=0;C<_.length;C++){let I=r[l+C];_[C]._custom=Yi(I[2],this.resolveDataElementOptions(C+l).radius)}return _}parseObjectData(u,r,l,t){let _=super.parseObjectData(u,r,l,t);for(let C=0;C<_.length;C++){let I=r[l+C];_[C]._custom=Yi(I&&I.r&&+I.r,this.resolveDataElementOptions(C+l).radius)}return _}getMaxOverflow(){let u=this._cachedMeta.data,r=0;for(let l=u.length-1;l>=0;--l)r=Math.max(r,u[l].size(this.resolveDataElementOptions(l))/2);return r>0&&r}getLabelAndValue(u){let r=this._cachedMeta,l=this.chart.data.labels||[],{xScale:t,yScale:_}=r,C=this.getParsed(u),I=t.getLabelForValue(C.x),O=_.getLabelForValue(C.y),N=C._custom;return{label:l[u]||"",value:"("+I+", "+O+(N?", "+N:"")+")"}}update(u){let r=this._cachedMeta.data;this.updateElements(r,0,r.length,u)}updateElements(u,r,l,t){let _=t==="reset",{iScale:C,vScale:I}=this._cachedMeta,{sharedOptions:O,includeOptions:N}=this._getSharedOptions(r,t),q=C.axis,ie=I.axis;for(let de=r;de<r+l;de++){let xe=u[de],ke=!_&&this.getParsed(de),Ae={},Xe=Ae[q]=_?C.getPixelForDecimal(.5):C.getPixelForValue(ke[q]),qe=Ae[ie]=_?I.getBasePixel():I.getPixelForValue(ke[ie]);Ae.skip=isNaN(Xe)||isNaN(qe),N&&(Ae.options=O||this.resolveDataElementOptions(de,xe.active?"active":t),_&&(Ae.options.radius=0)),this.updateElement(xe,de,Ae,t)}}resolveDataElementOptions(u,r){let l=this.getParsed(u),t=super.resolveDataElementOptions(u,r);t.$shared&&(t=Object.assign({},t,{$shared:!1}));let _=t.radius;return r!=="active"&&(t.radius=0),t.radius+=Yi(l&&l._custom,_),t}}return d})();function N4(d,s,u){let r=1,l=1,t=0,_=0;if(s<or){let C=d,I=C+s,O=Math.cos(C),N=Math.sin(C),q=Math.cos(I),ie=Math.sin(I),de=(ut,It,wt)=>ep(ut,C,I,!0)?1:Math.max(It,It*u,wt,wt*u),xe=(ut,It,wt)=>ep(ut,C,I,!0)?-1:Math.min(It,It*u,wt,wt*u),ke=de(0,O,q),Ae=de(Mr,N,ie),Xe=xe(rr,O,q),qe=xe(rr+Mr,N,ie);r=(ke-Xe)/2,l=(Ae-qe)/2,t=-(ke+Xe)/2,_=-(Ae+qe)/2}return{ratioX:r,ratioY:l,offsetX:t,offsetY:_}}var fC=(()=>{class d extends Ed{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:u=>u!=="spacing",_indexable:u=>u!=="spacing"&&!u.startsWith("borderDash")&&!u.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(u){let r=u.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:l,color:t}}=u.legend.options;return r.labels.map((_,C)=>{let O=u.getDatasetMeta(0).controller.getStyle(C);return{text:_,fillStyle:O.backgroundColor,strokeStyle:O.borderColor,fontColor:t,lineWidth:O.borderWidth,pointStyle:l,hidden:!u.getDataVisibility(C),index:C}})}return[]}},onClick(u,r,l){l.chart.toggleDataVisibility(r.index),l.chart.update()}}}};constructor(u,r){super(u,r),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(u,r){let l=this.getDataset().data,t=this._cachedMeta;if(this._parsing===!1)t._parsed=l;else{let _=O=>+l[O];if(cn(l[u])){let{key:O="value"}=this._parsing;_=N=>+Xl(l[N],O)}let C,I;for(C=u,I=u+r;C<I;++C)t._parsed[C]=_(C)}}_getRotation(){return Xa(this.options.rotation-90)}_getCircumference(){return Xa(this.options.circumference)}_getRotationExtents(){let u=or,r=-or;for(let l=0;l<this.chart.data.datasets.length;++l)if(this.chart.isDatasetVisible(l)&&this.chart.getDatasetMeta(l).type===this._type){let t=this.chart.getDatasetMeta(l).controller,_=t._getRotation(),C=t._getCircumference();u=Math.min(u,_),r=Math.max(r,_+C)}return{rotation:u,circumference:r-u}}update(u){let r=this.chart,{chartArea:l}=r,t=this._cachedMeta,_=t.data,C=this.getMaxBorderWidth()+this.getMaxOffset(_)+this.options.spacing,I=Math.max((Math.min(l.width,l.height)-C)/2,0),O=Math.min(sE(this.options.cutout,I),1),N=this._getRingWeight(this.index),{circumference:q,rotation:ie}=this._getRotationExtents(),{ratioX:de,ratioY:xe,offsetX:ke,offsetY:Ae}=N4(ie,q,O),Xe=(l.width-C)/de,qe=(l.height-C)/xe,ut=Math.max(Math.min(Xe,qe)/2,0),It=uw(this.options.radius,ut),wt=Math.max(It*O,0),Et=(It-wt)/this._getVisibleDatasetWeightTotal();this.offsetX=ke*It,this.offsetY=Ae*It,t.total=this.calculateTotal(),this.outerRadius=It-Et*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Et*N,0),this.updateElements(_,0,_.length,u)}_circumference(u,r){let l=this.options,t=this._cachedMeta,_=this._getCircumference();return r&&l.animation.animateRotate||!this.chart.getDataVisibility(u)||t._parsed[u]===null||t.data[u].hidden?0:this.calculateCircumference(t._parsed[u]*_/or)}updateElements(u,r,l,t){let _=t==="reset",C=this.chart,I=C.chartArea,N=C.options.animation,q=(I.left+I.right)/2,ie=(I.top+I.bottom)/2,de=_&&N.animateScale,xe=de?0:this.innerRadius,ke=de?0:this.outerRadius,{sharedOptions:Ae,includeOptions:Xe}=this._getSharedOptions(r,t),qe=this._getRotation(),ut;for(ut=0;ut<r;++ut)qe+=this._circumference(ut,_);for(ut=r;ut<r+l;++ut){let It=this._circumference(ut,_),wt=u[ut],Et={x:q+this.offsetX,y:ie+this.offsetY,startAngle:qe,endAngle:qe+It,circumference:It,outerRadius:ke,innerRadius:xe};Xe&&(Et.options=Ae||this.resolveDataElementOptions(ut,wt.active?"active":t)),qe+=It,this.updateElement(wt,ut,Et,t)}}calculateTotal(){let u=this._cachedMeta,r=u.data,l=0,t;for(t=0;t<r.length;t++){let _=u._parsed[t];_!==null&&!isNaN(_)&&this.chart.getDataVisibility(t)&&!r[t].hidden&&(l+=Math.abs(_))}return l}calculateCircumference(u){let r=this._cachedMeta.total;return r>0&&!isNaN(u)?or*(Math.abs(u)/r):0}getLabelAndValue(u){let r=this._cachedMeta,l=this.chart,t=l.data.labels||[],_=tp(r._parsed[u],l.options.locale);return{label:t[u]||"",value:_}}getMaxBorderWidth(u){let r=0,l=this.chart,t,_,C,I,O;if(!u){for(t=0,_=l.data.datasets.length;t<_;++t)if(l.isDatasetVisible(t)){C=l.getDatasetMeta(t),u=C.data,I=C.controller;break}}if(!u)return 0;for(t=0,_=u.length;t<_;++t)O=I.resolveDataElementOptions(t),O.borderAlign!=="inner"&&(r=Math.max(r,O.borderWidth||0,O.hoverBorderWidth||0));return r}getMaxOffset(u){let r=0;for(let l=0,t=u.length;l<t;++l){let _=this.resolveDataElementOptions(l);r=Math.max(r,_.offset||0,_.hoverOffset||0)}return r}_getRingWeightOffset(u){let r=0;for(let l=0;l<u;++l)this.chart.isDatasetVisible(l)&&(r+=this._getRingWeight(l));return r}_getRingWeight(u){return Math.max(Yi(this.chart.data.datasets[u].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return d})(),V4=(()=>{class d extends Ed{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(u){let r=this._cachedMeta,{dataset:l,data:t=[],_dataset:_}=r,C=this.chart._animationsDisabled,{start:I,count:O}=ww(r,t,C);this._drawStart=I,this._drawCount=O,Cw(r)&&(I=0,O=t.length),l._chart=this.chart,l._datasetIndex=this.index,l._decimated=!!_._decimated,l.points=t;let N=this.resolveDatasetElementOptions(u);this.options.showLine||(N.borderWidth=0),N.segment=this.options.segment,this.updateElement(l,void 0,{animated:!C,options:N},u),this.updateElements(t,I,O,u)}updateElements(u,r,l,t){let _=t==="reset",{iScale:C,vScale:I,_stacked:O,_dataset:N}=this._cachedMeta,{sharedOptions:q,includeOptions:ie}=this._getSharedOptions(r,t),de=C.axis,xe=I.axis,{spanGaps:ke,segment:Ae}=this.options,Xe=Jh(ke)?ke:Number.POSITIVE_INFINITY,qe=this.chart._animationsDisabled||_||t==="none",ut=r+l,It=u.length,wt=r>0&&this.getParsed(r-1);for(let Et=0;Et<It;++Et){let Ht=u[Et],Ct=qe?Ht:{};if(Et<r||Et>=ut){Ct.skip=!0;continue}let Yt=this.getParsed(Et),zt=vn(Yt[xe]),Ii=Ct[de]=C.getPixelForValue(Yt[de],Et),Hi=Ct[xe]=_||zt?I.getBasePixel():I.getPixelForValue(O?this.applyStack(I,Yt,O):Yt[xe],Et);Ct.skip=isNaN(Ii)||isNaN(Hi)||zt,Ct.stop=Et>0&&Math.abs(Yt[de]-wt[de])>Xe,Ae&&(Ct.parsed=Yt,Ct.raw=N.data[Et]),ie&&(Ct.options=q||this.resolveDataElementOptions(Et,Ht.active?"active":t)),qe||this.updateElement(Ht,Et,Ct,t),wt=Yt}}getMaxOverflow(){let u=this._cachedMeta,r=u.dataset,l=r.options&&r.options.borderWidth||0,t=u.data||[];if(!t.length)return l;let _=t[0].size(this.resolveDataElementOptions(0)),C=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(l,_,C)/2}draw(){let u=this._cachedMeta;u.dataset.updateControlPoints(this.chart.chartArea,u.iScale.axis),super.draw()}}return d})(),BD=(()=>{class d extends Ed{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(u){let r=u.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:l,color:t}}=u.legend.options;return r.labels.map((_,C)=>{let O=u.getDatasetMeta(0).controller.getStyle(C);return{text:_,fillStyle:O.backgroundColor,strokeStyle:O.borderColor,fontColor:t,lineWidth:O.borderWidth,pointStyle:l,hidden:!u.getDataVisibility(C),index:C}})}return[]}},onClick(u,r,l){l.chart.toggleDataVisibility(r.index),l.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(u,r){super(u,r),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(u){let r=this._cachedMeta,l=this.chart,t=l.data.labels||[],_=tp(r._parsed[u].r,l.options.locale);return{label:t[u]||"",value:_}}parseObjectData(u,r,l,t){return Pw.bind(this)(u,r,l,t)}update(u){let r=this._cachedMeta.data;this._updateRadius(),this.updateElements(r,0,r.length,u)}getMinMax(){let u=this._cachedMeta,r={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return u.data.forEach((l,t)=>{let _=this.getParsed(t).r;!isNaN(_)&&this.chart.getDataVisibility(t)&&(_<r.min&&(r.min=_),_>r.max&&(r.max=_))}),r}_updateRadius(){let u=this.chart,r=u.chartArea,l=u.options,t=Math.min(r.right-r.left,r.bottom-r.top),_=Math.max(t/2,0),C=Math.max(l.cutoutPercentage?_/100*l.cutoutPercentage:1,0),I=(_-C)/u.getVisibleDatasetCount();this.outerRadius=_-I*this.index,this.innerRadius=this.outerRadius-I}updateElements(u,r,l,t){let _=t==="reset",C=this.chart,O=C.options.animation,N=this._cachedMeta.rScale,q=N.xCenter,ie=N.yCenter,de=N.getIndexAngle(0)-.5*rr,xe=de,ke,Ae=360/this.countVisibleElements();for(ke=0;ke<r;++ke)xe+=this._computeAngle(ke,t,Ae);for(ke=r;ke<r+l;ke++){let Xe=u[ke],qe=xe,ut=xe+this._computeAngle(ke,t,Ae),It=C.getDataVisibility(ke)?N.getDistanceFromCenterForValue(this.getParsed(ke).r):0;xe=ut,_&&(O.animateScale&&(It=0),O.animateRotate&&(qe=ut=de));let wt={x:q,y:ie,innerRadius:0,outerRadius:It,startAngle:qe,endAngle:ut,options:this.resolveDataElementOptions(ke,Xe.active?"active":t)};this.updateElement(Xe,ke,wt,t)}}countVisibleElements(){let u=this._cachedMeta,r=0;return u.data.forEach((l,t)=>{!isNaN(this.getParsed(t).r)&&this.chart.getDataVisibility(t)&&r++}),r}_computeAngle(u,r,l){return this.chart.getDataVisibility(u)?Xa(this.resolveDataElementOptions(u,r).angle||l):0}}return d})(),j4=(()=>{class d extends fC{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}return d})(),U4=(()=>{class d extends Ed{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(u){let r=this._cachedMeta.vScale,l=this.getParsed(u);return{label:r.getLabels()[u],value:""+r.getLabelForValue(l[r.axis])}}parseObjectData(u,r,l,t){return Pw.bind(this)(u,r,l,t)}update(u){let r=this._cachedMeta,l=r.dataset,t=r.data||[],_=r.iScale.getLabels();if(l.points=t,u!=="resize"){let C=this.resolveDatasetElementOptions(u);this.options.showLine||(C.borderWidth=0);let I={_loop:!0,_fullLoop:_.length===t.length,options:C};this.updateElement(l,void 0,I,u)}this.updateElements(t,0,t.length,u)}updateElements(u,r,l,t){let _=this._cachedMeta.rScale,C=t==="reset";for(let I=r;I<r+l;I++){let O=u[I],N=this.resolveDataElementOptions(I,O.active?"active":t),q=_.getPointPositionForValue(I,this.getParsed(I).r),ie=C?_.xCenter:q.x,de=C?_.yCenter:q.y,xe={x:ie,y:de,angle:q.angle,skip:isNaN(ie)||isNaN(de),options:N};this.updateElement(O,I,xe,t)}}}return d})(),H4=(()=>{class d extends Ed{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(u){let r=this._cachedMeta,l=this.chart.data.labels||[],{xScale:t,yScale:_}=r,C=this.getParsed(u),I=t.getLabelForValue(C.x),O=_.getLabelForValue(C.y);return{label:l[u]||"",value:"("+I+", "+O+")"}}update(u){let r=this._cachedMeta,{data:l=[]}=r,t=this.chart._animationsDisabled,{start:_,count:C}=ww(r,l,t);if(this._drawStart=_,this._drawCount=C,Cw(r)&&(_=0,C=l.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:I,_dataset:O}=r;I._chart=this.chart,I._datasetIndex=this.index,I._decimated=!!O._decimated,I.points=l;let N=this.resolveDatasetElementOptions(u);N.segment=this.options.segment,this.updateElement(I,void 0,{animated:!t,options:N},u)}else this.datasetElementType&&(delete r.dataset,this.datasetElementType=!1);this.updateElements(l,_,C,u)}addElements(){let{showLine:u}=this.options;!this.datasetElementType&&u&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(u,r,l,t){let _=t==="reset",{iScale:C,vScale:I,_stacked:O,_dataset:N}=this._cachedMeta,q=this.resolveDataElementOptions(r,t),ie=this.getSharedOptions(q),de=this.includeOptions(t,ie),xe=C.axis,ke=I.axis,{spanGaps:Ae,segment:Xe}=this.options,qe=Jh(Ae)?Ae:Number.POSITIVE_INFINITY,ut=this.chart._animationsDisabled||_||t==="none",It=r>0&&this.getParsed(r-1);for(let wt=r;wt<r+l;++wt){let Et=u[wt],Ht=this.getParsed(wt),Ct=ut?Et:{},Yt=vn(Ht[ke]),zt=Ct[xe]=C.getPixelForValue(Ht[xe],wt),Ii=Ct[ke]=_||Yt?I.getBasePixel():I.getPixelForValue(O?this.applyStack(I,Ht,O):Ht[ke],wt);Ct.skip=isNaN(zt)||isNaN(Ii)||Yt,Ct.stop=wt>0&&Math.abs(Ht[xe]-It[xe])>qe,Xe&&(Ct.parsed=Ht,Ct.raw=N.data[wt]),de&&(Ct.options=ie||this.resolveDataElementOptions(wt,Et.active?"active":t)),ut||this.updateElement(Et,wt,Ct,t),It=Ht}this.updateSharedOptions(ie,t,q)}getMaxOverflow(){let u=this._cachedMeta,r=u.data||[];if(!this.options.showLine){let I=0;for(let O=r.length-1;O>=0;--O)I=Math.max(I,r[O].size(this.resolveDataElementOptions(O))/2);return I>0&&I}let l=u.dataset,t=l.options&&l.options.borderWidth||0;if(!r.length)return t;let _=r[0].size(this.resolveDataElementOptions(0)),C=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(t,_,C)/2}}return d})(),W4=Object.freeze({__proto__:null,BarController:z4,BubbleController:B4,DoughnutController:fC,LineController:V4,PieController:j4,PolarAreaController:BD,RadarController:U4,ScatterController:H4});function tu(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var Xw=class d{static override(s){Object.assign(d.prototype,s)}options;constructor(s){this.options=s||{}}init(){}formats(){return tu()}parse(){return tu()}format(){return tu()}add(){return tu()}diff(){return tu()}startOf(){return tu()}endOf(){return tu()}},G4={_date:Xw};function q4(d,s,u,r){let{controller:l,data:t,_sorted:_}=d,C=l._cachedMeta.iScale;if(C&&s===C.axis&&s!=="r"&&_&&t.length){let I=C._reversePixels?mE:el;if(r){if(l._sharedOptions){let O=t[0],N=typeof O.getRange=="function"&&O.getRange(s);if(N){let q=I(t,s,u-N),ie=I(t,s,u+N);return{lo:q.lo,hi:ie.hi}}}}else return I(t,s,u)}return{lo:0,hi:t.length-1}}function Ug(d,s,u,r,l){let t=d.getSortedVisibleDatasetMetas(),_=u[s];for(let C=0,I=t.length;C<I;++C){let{index:O,data:N}=t[C],{lo:q,hi:ie}=q4(t[C],s,_,l);for(let de=q;de<=ie;++de){let xe=N[de];xe.skip||r(xe,O,de)}}}function $4(d){let s=d.indexOf("x")!==-1,u=d.indexOf("y")!==-1;return function(r,l){let t=s?Math.abs(r.x-l.x):0,_=u?Math.abs(r.y-l.y):0;return Math.sqrt(Math.pow(t,2)+Math.pow(_,2))}}function Uw(d,s,u,r,l){let t=[];return!l&&!d.isPointInArea(s)||Ug(d,u,s,function(C,I,O){!l&&!tl(C,d.chartArea,0)||C.inRange(s.x,s.y,r)&&t.push({element:C,datasetIndex:I,index:O})},!0),t}function Y4(d,s,u,r){let l=[];function t(_,C,I){let{startAngle:O,endAngle:N}=_.getProps(["startAngle","endAngle"],r),{angle:q}=_w(_,{x:s.x,y:s.y});ep(q,O,N)&&l.push({element:_,datasetIndex:C,index:I})}return Ug(d,u,s,t),l}function Z4(d,s,u,r,l,t){let _=[],C=$4(u),I=Number.POSITIVE_INFINITY;function O(N,q,ie){let de=N.inRange(s.x,s.y,l);if(r&&!de)return;let xe=N.getCenterPoint(l);if(!(!!t||d.isPointInArea(xe))&&!de)return;let Ae=C(s,xe);Ae<I?(_=[{element:N,datasetIndex:q,index:ie}],I=Ae):Ae===I&&_.push({element:N,datasetIndex:q,index:ie})}return Ug(d,u,s,O),_}function Hw(d,s,u,r,l,t){return!t&&!d.isPointInArea(s)?[]:u==="r"&&!r?Y4(d,s,u,l):Z4(d,s,u,r,l,t)}function GE(d,s,u,r,l){let t=[],_=u==="x"?"inXRange":"inYRange",C=!1;return Ug(d,u,s,(I,O,N)=>{I[_](s[u],l)&&(t.push({element:I,datasetIndex:O,index:N}),C=C||I.inRange(s.x,s.y,l))}),r&&!C?[]:t}var X4={evaluateInteractionItems:Ug,modes:{index(d,s,u,r){let l=Id(s,d),t=u.axis||"x",_=u.includeInvisible||!1,C=u.intersect?Uw(d,l,t,r,_):Hw(d,l,t,!1,r,_),I=[];return C.length?(d.getSortedVisibleDatasetMetas().forEach(O=>{let N=C[0].index,q=O.data[N];q&&!q.skip&&I.push({element:q,datasetIndex:O.index,index:N})}),I):[]},dataset(d,s,u,r){let l=Id(s,d),t=u.axis||"xy",_=u.includeInvisible||!1,C=u.intersect?Uw(d,l,t,r,_):Hw(d,l,t,!1,r,_);if(C.length>0){let I=C[0].datasetIndex,O=d.getDatasetMeta(I).data;C=[];for(let N=0;N<O.length;++N)C.push({element:O[N],datasetIndex:I,index:N})}return C},point(d,s,u,r){let l=Id(s,d),t=u.axis||"xy",_=u.includeInvisible||!1;return Uw(d,l,t,r,_)},nearest(d,s,u,r){let l=Id(s,d),t=u.axis||"xy",_=u.includeInvisible||!1;return Hw(d,l,t,u.intersect,r,_)},x(d,s,u,r){let l=Id(s,d);return GE(d,l,"x",u.intersect,r)},y(d,s,u,r){let l=Id(s,d);return GE(d,l,"y",u.intersect,r)}}},ND=["left","top","right","bottom"];function Og(d,s){return d.filter(u=>u.pos===s)}function qE(d,s){return d.filter(u=>ND.indexOf(u.pos)===-1&&u.box.axis===s)}function Rg(d,s){return d.sort((u,r)=>{let l=s?r:u,t=s?u:r;return l.weight===t.weight?l.index-t.index:l.weight-t.weight})}function Q4(d){let s=[],u,r,l,t,_,C;for(u=0,r=(d||[]).length;u<r;++u)l=d[u],{position:t,options:{stack:_,stackWeight:C=1}}=l,s.push({index:u,box:l,pos:t,horizontal:l.isHorizontal(),weight:l.weight,stack:_&&t+_,stackWeight:C});return s}function K4(d){let s={};for(let u of d){let{stack:r,pos:l,stackWeight:t}=u;if(!r||!ND.includes(l))continue;let _=s[r]||(s[r]={count:0,placed:0,weight:0,size:0});_.count++,_.weight+=t}return s}function J4(d,s){let u=K4(d),{vBoxMaxWidth:r,hBoxMaxHeight:l}=s,t,_,C;for(t=0,_=d.length;t<_;++t){C=d[t];let{fullSize:I}=C.box,O=u[C.stack],N=O&&C.stackWeight/O.weight;C.horizontal?(C.width=N?N*r:I&&s.availableWidth,C.height=l):(C.width=r,C.height=N?N*l:I&&s.availableHeight)}return u}function eB(d){let s=Q4(d),u=Rg(s.filter(O=>O.box.fullSize),!0),r=Rg(Og(s,"left"),!0),l=Rg(Og(s,"right")),t=Rg(Og(s,"top"),!0),_=Rg(Og(s,"bottom")),C=qE(s,"x"),I=qE(s,"y");return{fullSize:u,leftAndTop:r.concat(t),rightAndBottom:l.concat(I).concat(_).concat(C),chartArea:Og(s,"chartArea"),vertical:r.concat(l).concat(I),horizontal:t.concat(_).concat(C)}}function $E(d,s,u,r){return Math.max(d[u],s[u])+Math.max(d[r],s[r])}function VD(d,s){d.top=Math.max(d.top,s.top),d.left=Math.max(d.left,s.left),d.bottom=Math.max(d.bottom,s.bottom),d.right=Math.max(d.right,s.right)}function tB(d,s,u,r){let{pos:l,box:t}=u,_=d.maxPadding;if(!cn(l)){u.size&&(d[l]-=u.size);let q=r[u.stack]||{size:0,count:1};q.size=Math.max(q.size,u.horizontal?t.height:t.width),u.size=q.size/q.count,d[l]+=u.size}t.getPadding&&VD(_,t.getPadding());let C=Math.max(0,s.outerWidth-$E(_,d,"left","right")),I=Math.max(0,s.outerHeight-$E(_,d,"top","bottom")),O=C!==d.w,N=I!==d.h;return d.w=C,d.h=I,u.horizontal?{same:O,other:N}:{same:N,other:O}}function iB(d){let s=d.maxPadding;function u(r){let l=Math.max(s[r]-d[r],0);return d[r]+=l,l}d.y+=u("top"),d.x+=u("left"),u("right"),u("bottom")}function nB(d,s){let u=s.maxPadding;function r(l){let t={left:0,top:0,right:0,bottom:0};return l.forEach(_=>{t[_]=Math.max(s[_],u[_])}),t}return r(d?["left","right"]:["top","bottom"])}function zg(d,s,u,r){let l=[],t,_,C,I,O,N;for(t=0,_=d.length,O=0;t<_;++t){C=d[t],I=C.box,I.update(C.width||s.w,C.height||s.h,nB(C.horizontal,s));let{same:q,other:ie}=tB(s,u,C,r);O|=q&&l.length,N=N||ie,I.fullSize||l.push(C)}return O&&zg(l,s,u,r)||N}function sy(d,s,u,r,l){d.top=u,d.left=s,d.right=s+r,d.bottom=u+l,d.width=r,d.height=l}function YE(d,s,u,r){let l=u.padding,{x:t,y:_}=s;for(let C of d){let I=C.box,O=r[C.stack]||{count:1,placed:0,weight:1},N=C.stackWeight/O.weight||1;if(C.horizontal){let q=s.w*N,ie=O.size||I.height;Km(O.start)&&(_=O.start),I.fullSize?sy(I,l.left,_,u.outerWidth-l.right-l.left,ie):sy(I,s.left+O.placed,_,q,ie),O.start=_,O.placed+=q,_=I.bottom}else{let q=s.h*N,ie=O.size||I.width;Km(O.start)&&(t=O.start),I.fullSize?sy(I,t,l.top,ie,u.outerHeight-l.bottom-l.top):sy(I,t,s.top+O.placed,ie,q),O.start=t,O.placed+=q,t=I.right}}s.x=t,s.y=_}var Do={addBox(d,s){d.boxes||(d.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(u){s.draw(u)}}]},d.boxes.push(s)},removeBox(d,s){let u=d.boxes?d.boxes.indexOf(s):-1;u!==-1&&d.boxes.splice(u,1)},configure(d,s,u){s.fullSize=u.fullSize,s.position=u.position,s.weight=u.weight},update(d,s,u,r){if(!d)return;let l=fo(d.options.layout.padding),t=Math.max(s-l.width,0),_=Math.max(u-l.height,0),C=eB(d.boxes),I=C.vertical,O=C.horizontal;Bn(d.boxes,ke=>{typeof ke.beforeLayout=="function"&&ke.beforeLayout()});let N=I.reduce((ke,Ae)=>Ae.box.options&&Ae.box.options.display===!1?ke:ke+1,0)||1,q=Object.freeze({outerWidth:s,outerHeight:u,padding:l,availableWidth:t,availableHeight:_,vBoxMaxWidth:t/2/N,hBoxMaxHeight:_/2}),ie=Object.assign({},l);VD(ie,fo(r));let de=Object.assign({maxPadding:ie,w:t,h:_,x:l.left,y:l.top},l),xe=J4(I.concat(O),q);zg(C.fullSize,de,q,xe),zg(I,de,q,xe),zg(O,de,q,xe)&&zg(I,de,q,xe),iB(de),YE(C.leftAndTop,de,q,xe),de.x+=de.w,de.y+=de.h,YE(C.rightAndBottom,de,q,xe),d.chartArea={left:de.left,top:de.top,right:de.left+de.w,bottom:de.top+de.h,height:de.h,width:de.w},Bn(C.chartArea,ke=>{let Ae=ke.box;Object.assign(Ae,d.chartArea),Ae.update(de.w,de.h,{left:0,top:0,right:0,bottom:0})})}},_y=class{acquireContext(s,u){}releaseContext(s){return!1}addEventListener(s,u,r){}removeEventListener(s,u,r){}getDevicePixelRatio(){return 1}getMaximumSize(s,u,r,l){return u=Math.max(0,u||s.width),r=r||s.height,{width:u,height:Math.max(0,l?Math.floor(u/l):r)}}isAttached(s){return!0}updateConfig(s){}},Qw=class extends _y{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}},py="$chartjs",rB={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},ZE=d=>d===null||d==="";function oB(d,s){let u=d.style,r=d.getAttribute("height"),l=d.getAttribute("width");if(d[py]={initial:{height:r,width:l,style:{display:u.display,height:u.height,width:u.width}}},u.display=u.display||"block",u.boxSizing=u.boxSizing||"border-box",ZE(l)){let t=Rw(d,"width");t!==void 0&&(d.width=t)}if(ZE(r))if(d.style.height==="")d.height=d.width/(s||2);else{let t=Rw(d,"height");t!==void 0&&(d.height=t)}return d}var jD=DE?{passive:!0}:!1;function aB(d,s,u){d&&d.addEventListener(s,u,jD)}function sB(d,s,u){d&&d.canvas&&d.canvas.removeEventListener(s,u,jD)}function lB(d,s){let u=rB[d.type]||d.type,{x:r,y:l}=Id(d,s);return{type:u,chart:s,native:d,x:r!==void 0?r:null,y:l!==void 0?l:null}}function by(d,s){for(let u of d)if(u===s||u.contains(s))return!0}function cB(d,s,u){let r=d.canvas,l=new MutationObserver(t=>{let _=!1;for(let C of t)_=_||by(C.addedNodes,r),_=_&&!by(C.removedNodes,r);_&&u()});return l.observe(document,{childList:!0,subtree:!0}),l}function dB(d,s,u){let r=d.canvas,l=new MutationObserver(t=>{let _=!1;for(let C of t)_=_||by(C.removedNodes,r),_=_&&!by(C.addedNodes,r);_&&u()});return l.observe(document,{childList:!0,subtree:!0}),l}var Ng=new Map,XE=0;function UD(){let d=window.devicePixelRatio;d!==XE&&(XE=d,Ng.forEach((s,u)=>{u.currentDevicePixelRatio!==d&&s()}))}function hB(d,s){Ng.size||window.addEventListener("resize",UD),Ng.set(d,s)}function uB(d){Ng.delete(d),Ng.size||window.removeEventListener("resize",UD)}function mB(d,s,u){let r=d.canvas,l=r&&oy(r);if(!l)return;let t=xw((C,I)=>{let O=l.clientWidth;u(C,I),O<l.clientWidth&&u()},window),_=new ResizeObserver(C=>{let I=C[0],O=I.contentRect.width,N=I.contentRect.height;O===0&&N===0||t(O,N)});return _.observe(l),hB(d,t),_}function Ww(d,s,u){u&&u.disconnect(),s==="resize"&&uB(d)}function pB(d,s,u){let r=d.canvas,l=xw(t=>{d.ctx!==null&&u(lB(t,d))},d);return aB(r,s,l),l}var Kw=class extends _y{acquireContext(s,u){let r=s&&s.getContext&&s.getContext("2d");return r&&r.canvas===s?(oB(s,u),r):null}releaseContext(s){let u=s.canvas;if(!u[py])return!1;let r=u[py].initial;["height","width"].forEach(t=>{let _=r[t];vn(_)?u.removeAttribute(t):u.setAttribute(t,_)});let l=r.style||{};return Object.keys(l).forEach(t=>{u.style[t]=l[t]}),u.width=u.width,delete u[py],!0}addEventListener(s,u,r){this.removeEventListener(s,u);let l=s.$proxies||(s.$proxies={}),_={attach:cB,detach:dB,resize:mB}[u]||pB;l[u]=_(s,u,r)}removeEventListener(s,u){let r=s.$proxies||(s.$proxies={}),l=r[u];if(!l)return;({attach:Ww,detach:Ww,resize:Ww}[u]||sB)(s,u,l),r[u]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,u,r,l){return EE(s,u,r,l)}isAttached(s){let u=s&&oy(s);return!!(u&&u.isConnected)}};function fB(d){return!ry()||typeof OffscreenCanvas<"u"&&d instanceof OffscreenCanvas?Qw:Kw}var ks=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(s){let{x:u,y:r}=this.getProps(["x","y"],s);return{x:u,y:r}}hasValue(){return Jh(this.x)&&Jh(this.y)}getProps(s,u){let r=this.$animations;if(!u||!r)return this;let l={};return s.forEach(t=>{l[t]=r[t]&&r[t].active()?r[t]._to:this[t]}),l}};function gB(d,s){let u=d.options.ticks,r=_B(d),l=Math.min(u.maxTicksLimit||r,r),t=u.major.enabled?yB(s):[],_=t.length,C=t[0],I=t[_-1],O=[];if(_>l)return vB(s,O,t,_/l),O;let N=bB(t,s,l);if(_>0){let q,ie,de=_>1?Math.round((I-C)/(_-1)):null;for(ly(s,O,N,vn(de)?0:C-de,C),q=0,ie=_-1;q<ie;q++)ly(s,O,N,t[q],t[q+1]);return ly(s,O,N,I,vn(de)?s.length:I+de),O}return ly(s,O,N),O}function _B(d){let s=d.options.offset,u=d._tickSize(),r=d._length/u+(s?0:1),l=d._maxLength/u;return Math.floor(Math.min(r,l))}function bB(d,s,u){let r=xB(d),l=s.length/u;if(!r)return Math.max(l,1);let t=dE(r);for(let _=0,C=t.length-1;_<C;_++){let I=t[_];if(I>l)return I}return Math.max(l,1)}function yB(d){let s=[],u,r;for(u=0,r=d.length;u<r;u++)d[u].major&&s.push(u);return s}function vB(d,s,u,r){let l=0,t=u[0],_;for(r=Math.ceil(r),_=0;_<d.length;_++)_===t&&(s.push(d[_]),l++,t=u[l*r])}function ly(d,s,u,r,l){let t=Yi(r,0),_=Math.min(Yi(l,d.length),d.length),C=0,I,O,N;for(u=Math.ceil(u),l&&(I=l-r,u=I/Math.floor(I/u)),N=t;N<0;)C++,N=Math.round(t+C*u);for(O=Math.max(t,0);O<_;O++)O===N&&(s.push(d[O]),C++,N=Math.round(t+C*u))}function xB(d){let s=d.length,u,r;if(s<2)return!1;for(r=d[0],u=1;u<s;++u)if(d[u]-d[u-1]!==r)return!1;return r}var wB=d=>d==="left"?"right":d==="right"?"left":d,QE=(d,s,u)=>s==="top"||s==="left"?d[s]+u:d[s]-u,KE=(d,s)=>Math.min(s||d,d);function JE(d,s){let u=[],r=d.length/s,l=d.length,t=0;for(;t<l;t+=r)u.push(d[Math.floor(t)]);return u}function CB(d,s,u){let r=d.ticks.length,l=Math.min(s,r-1),t=d._startPixel,_=d._endPixel,C=1e-6,I=d.getPixelForTick(l),O;if(!(u&&(r===1?O=Math.max(I-t,_-I):s===0?O=(d.getPixelForTick(1)-I)/2:O=(I-d.getPixelForTick(l-1))/2,I+=l<s?O:-O,I<t-C||I>_+C)))return I}function SB(d,s){Bn(d,u=>{let r=u.gc,l=r.length/2,t;if(l>s){for(t=0;t<l;++t)delete u.data[r[t]];r.splice(0,l)}})}function Lg(d){return d.drawTicks?d.tickLength:0}function eD(d,s){if(!d.display)return 0;let u=jr(d.font,s),r=fo(d.padding);return(nr(d.text)?d.text.length:1)*u.lineHeight+r.height}function MB(d,s){return Ql(d,{scale:s,type:"scale"})}function kB(d,s,u){return Ql(d,{tick:u,index:s,type:"tick"})}function IB(d,s,u){let r=Jb(d);return(u&&s!=="right"||!u&&s==="right")&&(r=wB(r)),r}function TB(d,s,u,r){let{top:l,left:t,bottom:_,right:C,chart:I}=d,{chartArea:O,scales:N}=I,q=0,ie,de,xe,ke=_-l,Ae=C-t;if(d.isHorizontal()){if(de=po(r,t,C),cn(u)){let Xe=Object.keys(u)[0],qe=u[Xe];xe=N[Xe].getPixelForValue(qe)+ke-s}else u==="center"?xe=(O.bottom+O.top)/2+ke-s:xe=QE(d,u,s);ie=C-t}else{if(cn(u)){let Xe=Object.keys(u)[0],qe=u[Xe];de=N[Xe].getPixelForValue(qe)-Ae+s}else u==="center"?de=(O.left+O.right)/2-Ae+s:de=QE(d,u,s);xe=po(r,_,l),q=u==="left"?-Mr:Mr}return{titleX:de,titleY:xe,maxWidth:ie,rotation:q}}var nu=class d extends ks{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,u){return s}getUserBounds(){let{_userMin:s,_userMax:u,_suggestedMin:r,_suggestedMax:l}=this;return s=na(s,Number.POSITIVE_INFINITY),u=na(u,Number.NEGATIVE_INFINITY),r=na(r,Number.POSITIVE_INFINITY),l=na(l,Number.NEGATIVE_INFINITY),{min:na(s,r),max:na(u,l),minDefined:yr(s),maxDefined:yr(u)}}getMinMax(s){let{min:u,max:r,minDefined:l,maxDefined:t}=this.getUserBounds(),_;if(l&&t)return{min:u,max:r};let C=this.getMatchingVisibleMetas();for(let I=0,O=C.length;I<O;++I)_=C[I].controller.getMinMax(this,s),l||(u=Math.min(u,_.min)),t||(r=Math.max(r,_.max));return u=t&&u>r?r:u,r=l&&u>r?u:r,{min:na(u,na(r,u)),max:na(r,na(u,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}getLabelItems(s=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(s))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Yn(this.options.beforeUpdate,[this])}update(s,u,r){let{beginAtZero:l,grace:t,ticks:_}=this.options,C=_.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=u,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=CE(this,t,l),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let I=C<this.ticks.length;this._convertTicksToLabels(I?JE(this.ticks,C):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),_.display&&(_.autoSkip||_.source==="auto")&&(this.ticks=gB(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),I&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let s=this.options.reverse,u,r;this.isHorizontal()?(u=this.left,r=this.right):(u=this.top,r=this.bottom,s=!s),this._startPixel=u,this._endPixel=r,this._reversePixels=s,this._length=r-u,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Yn(this.options.afterUpdate,[this])}beforeSetDimensions(){Yn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Yn(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),Yn(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Yn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){let u=this.options.ticks,r,l,t;for(r=0,l=s.length;r<l;r++)t=s[r],t.label=Yn(u.callback,[t.value,r,s],this)}afterTickToLabelConversion(){Yn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Yn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let s=this.options,u=s.ticks,r=KE(this.ticks.length,s.ticks.maxTicksLimit),l=u.minRotation||0,t=u.maxRotation,_=l,C,I,O;if(!this._isVisible()||!u.display||l>=t||r<=1||!this.isHorizontal()){this.labelRotation=l;return}let N=this._getLabelSizes(),q=N.widest.width,ie=N.highest.height,de=Xr(this.chart.width-q,0,this.maxWidth);C=s.offset?this.maxWidth/r:de/(r-1),q+6>C&&(C=de/(r-(s.offset?.5:1)),I=this.maxHeight-Lg(s.grid)-u.padding-eD(s.title,this.chart.options.font),O=Math.sqrt(q*q+ie*ie),_=Qb(Math.min(Math.asin(Xr((N.highest.height+6)/C,-1,1)),Math.asin(Xr(I/O,-1,1))-Math.asin(Xr(ie/O,-1,1)))),_=Math.max(l,Math.min(t,_))),this.labelRotation=_}afterCalculateLabelRotation(){Yn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Yn(this.options.beforeFit,[this])}fit(){let s={width:0,height:0},{chart:u,options:{ticks:r,title:l,grid:t}}=this,_=this._isVisible(),C=this.isHorizontal();if(_){let I=eD(l,u.options.font);if(C?(s.width=this.maxWidth,s.height=Lg(t)+I):(s.height=this.maxHeight,s.width=Lg(t)+I),r.display&&this.ticks.length){let{first:O,last:N,widest:q,highest:ie}=this._getLabelSizes(),de=r.padding*2,xe=Xa(this.labelRotation),ke=Math.cos(xe),Ae=Math.sin(xe);if(C){let Xe=r.mirror?0:Ae*q.width+ke*ie.height;s.height=Math.min(this.maxHeight,s.height+Xe+de)}else{let Xe=r.mirror?0:ke*q.width+Ae*ie.height;s.width=Math.min(this.maxWidth,s.width+Xe+de)}this._calculatePadding(O,N,Ae,ke)}}this._handleMargins(),C?(this.width=this._length=u.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=u.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,u,r,l){let{ticks:{align:t,padding:_},position:C}=this.options,I=this.labelRotation!==0,O=C!=="top"&&this.axis==="x";if(this.isHorizontal()){let N=this.getPixelForTick(0)-this.left,q=this.right-this.getPixelForTick(this.ticks.length-1),ie=0,de=0;I?O?(ie=l*s.width,de=r*u.height):(ie=r*s.height,de=l*u.width):t==="start"?de=u.width:t==="end"?ie=s.width:t!=="inner"&&(ie=s.width/2,de=u.width/2),this.paddingLeft=Math.max((ie-N+_)*this.width/(this.width-N),0),this.paddingRight=Math.max((de-q+_)*this.width/(this.width-q),0)}else{let N=u.height/2,q=s.height/2;t==="start"?(N=0,q=s.height):t==="end"&&(N=u.height,q=0),this.paddingTop=N+_,this.paddingBottom=q+_}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Yn(this.options.afterFit,[this])}isHorizontal(){let{axis:s,position:u}=this.options;return u==="top"||u==="bottom"||s==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){this.beforeTickToLabelConversion(),this.generateTickLabels(s);let u,r;for(u=0,r=s.length;u<r;u++)vn(s[u].label)&&(s.splice(u,1),r--,u--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){let u=this.options.ticks.sampleSize,r=this.ticks;u<r.length&&(r=JE(r,u)),this._labelSizes=s=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return s}_computeLabelSizes(s,u,r){let{ctx:l,_longestTextCache:t}=this,_=[],C=[],I=Math.floor(u/KE(u,r)),O=0,N=0,q,ie,de,xe,ke,Ae,Xe,qe,ut,It,wt;for(q=0;q<u;q+=I){if(xe=s[q].label,ke=this._resolveTickFontOptions(q),l.font=Ae=ke.string,Xe=t[Ae]=t[Ae]||{data:{},gc:[]},qe=ke.lineHeight,ut=It=0,!vn(xe)&&!nr(xe))ut=Ig(l,Xe.data,Xe.gc,ut,xe),It=qe;else if(nr(xe))for(ie=0,de=xe.length;ie<de;++ie)wt=xe[ie],!vn(wt)&&!nr(wt)&&(ut=Ig(l,Xe.data,Xe.gc,ut,wt),It+=qe);_.push(ut),C.push(It),O=Math.max(ut,O),N=Math.max(It,N)}SB(t,u);let Et=_.indexOf(O),Ht=C.indexOf(N),Ct=Yt=>({width:_[Yt]||0,height:C[Yt]||0});return{first:Ct(0),last:Ct(u-1),widest:Ct(Et),highest:Ct(Ht),widths:_,heights:C}}getLabelForValue(s){return s}getPixelForValue(s,u){return NaN}getValueForPixel(s){}getPixelForTick(s){let u=this.ticks;return s<0||s>u.length-1?null:this.getPixelForValue(u[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);let u=this._startPixel+s*this._length;return uE(this._alignToPixels?Sd(this.chart,u,0):u)}getDecimalForPixel(s){let u=(s-this._startPixel)/this._length;return this._reversePixels?1-u:u}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:s,max:u}=this;return s<0&&u<0?u:s>0&&u>0?s:0}getContext(s){let u=this.ticks||[];if(s>=0&&s<u.length){let r=u[s];return r.$context||(r.$context=kB(this.getContext(),s,r))}return this.$context||(this.$context=MB(this.chart.getContext(),this))}_tickSize(){let s=this.options.ticks,u=Xa(this.labelRotation),r=Math.abs(Math.cos(u)),l=Math.abs(Math.sin(u)),t=this._getLabelSizes(),_=s.autoSkipPadding||0,C=t?t.widest.width+_:0,I=t?t.highest.height+_:0;return this.isHorizontal()?I*r>C*l?C/r:I/l:I*l<C*r?I/r:C/l}_isVisible(){let s=this.options.display;return s!=="auto"?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){let u=this.axis,r=this.chart,l=this.options,{grid:t,position:_,border:C}=l,I=t.offset,O=this.isHorizontal(),q=this.ticks.length+(I?1:0),ie=Lg(t),de=[],xe=C.setContext(this.getContext()),ke=xe.display?xe.width:0,Ae=ke/2,Xe=function(tn){return Sd(r,tn,ke)},qe,ut,It,wt,Et,Ht,Ct,Yt,zt,Ii,Hi,cr;if(_==="top")qe=Xe(this.bottom),Ht=this.bottom-ie,Yt=qe-Ae,Ii=Xe(s.top)+Ae,cr=s.bottom;else if(_==="bottom")qe=Xe(this.top),Ii=s.top,cr=Xe(s.bottom)-Ae,Ht=qe+Ae,Yt=this.top+ie;else if(_==="left")qe=Xe(this.right),Et=this.right-ie,Ct=qe-Ae,zt=Xe(s.left)+Ae,Hi=s.right;else if(_==="right")qe=Xe(this.left),zt=s.left,Hi=Xe(s.right)-Ae,Et=qe+Ae,Ct=this.left+ie;else if(u==="x"){if(_==="center")qe=Xe((s.top+s.bottom)/2+.5);else if(cn(_)){let tn=Object.keys(_)[0],jn=_[tn];qe=Xe(this.chart.scales[tn].getPixelForValue(jn))}Ii=s.top,cr=s.bottom,Ht=qe+Ae,Yt=Ht+ie}else if(u==="y"){if(_==="center")qe=Xe((s.left+s.right)/2);else if(cn(_)){let tn=Object.keys(_)[0],jn=_[tn];qe=Xe(this.chart.scales[tn].getPixelForValue(jn))}Et=qe-Ae,Ct=Et-ie,zt=s.left,Hi=s.right}let wi=Yi(l.ticks.maxTicksLimit,q),dn=Math.max(1,Math.ceil(q/wi));for(ut=0;ut<q;ut+=dn){let tn=this.getContext(ut),jn=t.setContext(tn),Ur=C.setContext(tn),Zn=jn.lineWidth,Ti=jn.color,aa=Ur.dash||[],Xn=Ur.dashOffset,Ma=jn.tickWidth,zo=jn.tickColor,ka=jn.tickBorderDash||[],Gt=jn.tickBorderDashOffset;It=CB(this,ut,I),It!==void 0&&(wt=Sd(r,It,Zn),O?Et=Ct=zt=Hi=wt:Ht=Yt=Ii=cr=wt,de.push({tx1:Et,ty1:Ht,tx2:Ct,ty2:Yt,x1:zt,y1:Ii,x2:Hi,y2:cr,width:Zn,color:Ti,borderDash:aa,borderDashOffset:Xn,tickWidth:Ma,tickColor:zo,tickBorderDash:ka,tickBorderDashOffset:Gt}))}return this._ticksLength=q,this._borderValue=qe,de}_computeLabelItems(s){let u=this.axis,r=this.options,{position:l,ticks:t}=r,_=this.isHorizontal(),C=this.ticks,{align:I,crossAlign:O,padding:N,mirror:q}=t,ie=Lg(r.grid),de=ie+N,xe=q?-N:de,ke=-Xa(this.labelRotation),Ae=[],Xe,qe,ut,It,wt,Et,Ht,Ct,Yt,zt,Ii,Hi,cr="middle";if(l==="top")Et=this.bottom-xe,Ht=this._getXAxisLabelAlignment();else if(l==="bottom")Et=this.top+xe,Ht=this._getXAxisLabelAlignment();else if(l==="left"){let dn=this._getYAxisLabelAlignment(ie);Ht=dn.textAlign,wt=dn.x}else if(l==="right"){let dn=this._getYAxisLabelAlignment(ie);Ht=dn.textAlign,wt=dn.x}else if(u==="x"){if(l==="center")Et=(s.top+s.bottom)/2+de;else if(cn(l)){let dn=Object.keys(l)[0],tn=l[dn];Et=this.chart.scales[dn].getPixelForValue(tn)+de}Ht=this._getXAxisLabelAlignment()}else if(u==="y"){if(l==="center")wt=(s.left+s.right)/2-de;else if(cn(l)){let dn=Object.keys(l)[0],tn=l[dn];wt=this.chart.scales[dn].getPixelForValue(tn)}Ht=this._getYAxisLabelAlignment(ie).textAlign}u==="y"&&(I==="start"?cr="top":I==="end"&&(cr="bottom"));let wi=this._getLabelSizes();for(Xe=0,qe=C.length;Xe<qe;++Xe){ut=C[Xe],It=ut.label;let dn=t.setContext(this.getContext(Xe));Ct=this.getPixelForTick(Xe)+t.labelOffset,Yt=this._resolveTickFontOptions(Xe),zt=Yt.lineHeight,Ii=nr(It)?It.length:1;let tn=Ii/2,jn=dn.color,Ur=dn.textStrokeColor,Zn=dn.textStrokeWidth,Ti=Ht;_?(wt=Ct,Ht==="inner"&&(Xe===qe-1?Ti=this.options.reverse?"left":"right":Xe===0?Ti=this.options.reverse?"right":"left":Ti="center"),l==="top"?O==="near"||ke!==0?Hi=-Ii*zt+zt/2:O==="center"?Hi=-wi.highest.height/2-tn*zt+zt:Hi=-wi.highest.height+zt/2:O==="near"||ke!==0?Hi=zt/2:O==="center"?Hi=wi.highest.height/2-tn*zt:Hi=wi.highest.height-Ii*zt,q&&(Hi*=-1),ke!==0&&!dn.showLabelBackdrop&&(wt+=zt/2*Math.sin(ke))):(Et=Ct,Hi=(1-Ii)*zt/2);let aa;if(dn.showLabelBackdrop){let Xn=fo(dn.backdropPadding),Ma=wi.heights[Xe],zo=wi.widths[Xe],ka=Hi-Xn.top,Gt=0-Xn.left;switch(cr){case"middle":ka-=Ma/2;break;case"bottom":ka-=Ma;break}switch(Ht){case"center":Gt-=zo/2;break;case"right":Gt-=zo;break;case"inner":Xe===qe-1?Gt-=zo:Xe>0&&(Gt-=zo/2);break}aa={left:Gt,top:ka,width:zo+Xn.width,height:Ma+Xn.height,color:dn.backdropColor}}Ae.push({label:It,font:Yt,textOffset:Hi,options:{rotation:ke,color:jn,strokeColor:Ur,strokeWidth:Zn,textAlign:Ti,textBaseline:cr,translation:[wt,Et],backdrop:aa}})}return Ae}_getXAxisLabelAlignment(){let{position:s,ticks:u}=this.options;if(-Xa(this.labelRotation))return s==="top"?"left":"right";let l="center";return u.align==="start"?l="left":u.align==="end"?l="right":u.align==="inner"&&(l="inner"),l}_getYAxisLabelAlignment(s){let{position:u,ticks:{crossAlign:r,mirror:l,padding:t}}=this.options,_=this._getLabelSizes(),C=s+t,I=_.widest.width,O,N;return u==="left"?l?(N=this.right+t,r==="near"?O="left":r==="center"?(O="center",N+=I/2):(O="right",N+=I)):(N=this.right-C,r==="near"?O="right":r==="center"?(O="center",N-=I/2):(O="left",N=this.left)):u==="right"?l?(N=this.left+t,r==="near"?O="right":r==="center"?(O="center",N-=I/2):(O="left",N-=I)):(N=this.left+C,r==="near"?O="left":r==="center"?(O="center",N+=I/2):(O="right",N=this.right)):O="right",{textAlign:O,x:N}}_computeLabelArea(){if(this.options.ticks.mirror)return;let s=this.chart,u=this.options.position;if(u==="left"||u==="right")return{top:0,left:this.left,bottom:s.height,right:this.right};if(u==="top"||u==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:s.width}}drawBackground(){let{ctx:s,options:{backgroundColor:u},left:r,top:l,width:t,height:_}=this;u&&(s.save(),s.fillStyle=u,s.fillRect(r,l,t,_),s.restore())}getLineWidthForValue(s){let u=this.options.grid;if(!this._isVisible()||!u.display)return 0;let l=this.ticks.findIndex(t=>t.value===s);return l>=0?u.setContext(this.getContext(l)).lineWidth:0}drawGrid(s){let u=this.options.grid,r=this.ctx,l=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s)),t,_,C=(I,O,N)=>{!N.width||!N.color||(r.save(),r.lineWidth=N.width,r.strokeStyle=N.color,r.setLineDash(N.borderDash||[]),r.lineDashOffset=N.borderDashOffset,r.beginPath(),r.moveTo(I.x,I.y),r.lineTo(O.x,O.y),r.stroke(),r.restore())};if(u.display)for(t=0,_=l.length;t<_;++t){let I=l[t];u.drawOnChartArea&&C({x:I.x1,y:I.y1},{x:I.x2,y:I.y2},I),u.drawTicks&&C({x:I.tx1,y:I.ty1},{x:I.tx2,y:I.ty2},{color:I.tickColor,width:I.tickWidth,borderDash:I.tickBorderDash,borderDashOffset:I.tickBorderDashOffset})}}drawBorder(){let{chart:s,ctx:u,options:{border:r,grid:l}}=this,t=r.setContext(this.getContext()),_=r.display?t.width:0;if(!_)return;let C=l.setContext(this.getContext(0)).lineWidth,I=this._borderValue,O,N,q,ie;this.isHorizontal()?(O=Sd(s,this.left,_)-_/2,N=Sd(s,this.right,C)+C/2,q=ie=I):(q=Sd(s,this.top,_)-_/2,ie=Sd(s,this.bottom,C)+C/2,O=N=I),u.save(),u.lineWidth=t.width,u.strokeStyle=t.color,u.beginPath(),u.moveTo(O,q),u.lineTo(N,ie),u.stroke(),u.restore()}drawLabels(s){if(!this.options.ticks.display)return;let r=this.ctx,l=this._computeLabelArea();l&&Dg(r,l);let t=this.getLabelItems(s);for(let _ of t){let C=_.options,I=_.font,O=_.label,N=_.textOffset;Md(r,O,0,N,I,C)}l&&Ag(r)}drawTitle(){let{ctx:s,options:{position:u,title:r,reverse:l}}=this;if(!r.display)return;let t=jr(r.font),_=fo(r.padding),C=r.align,I=t.lineHeight/2;u==="bottom"||u==="center"||cn(u)?(I+=_.bottom,nr(r.text)&&(I+=t.lineHeight*(r.text.length-1))):I+=_.top;let{titleX:O,titleY:N,maxWidth:q,rotation:ie}=TB(this,I,u,C);Md(s,r.text,0,0,t,{color:r.color,maxWidth:q,rotation:ie,textAlign:IB(C,u,l),textBaseline:"middle",translation:[O,N]})}draw(s){this._isVisible()&&(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){let s=this.options,u=s.ticks&&s.ticks.z||0,r=Yi(s.grid&&s.grid.z,-1),l=Yi(s.border&&s.border.z,0);return!this._isVisible()||this.draw!==d.prototype.draw?[{z:u,draw:t=>{this.draw(t)}}]:[{z:r,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:l,draw:()=>{this.drawBorder()}},{z:u,draw:t=>{this.drawLabels(t)}}]}getMatchingVisibleMetas(s){let u=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",l=[],t,_;for(t=0,_=u.length;t<_;++t){let C=u[t];C[r]===this.id&&(!s||C.type===s)&&l.push(C)}return l}_resolveTickFontOptions(s){let u=this.options.ticks.setContext(this.getContext(s));return jr(u.font)}_maxDigits(){let s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}},op=class{constructor(s,u,r){this.type=s,this.scope=u,this.override=r,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){let u=Object.getPrototypeOf(s),r;AB(u)&&(r=this.register(u));let l=this.items,t=s.id,_=this.scope+"."+t;if(!t)throw new Error("class does not have id: "+s);return t in l||(l[t]=s,EB(s,_,r),this.override&&vr.override(s.id,s.overrides)),_}get(s){return this.items[s]}unregister(s){let u=this.items,r=s.id,l=this.scope;r in u&&delete u[r],l&&r in vr[l]&&(delete vr[l][r],this.override&&delete Cd[r])}};function EB(d,s,u){let r=Zm(Object.create(null),[u?vr.get(u):{},vr.get(s),d.defaults]);vr.set(s,r),d.defaultRoutes&&DB(s,d.defaultRoutes),d.descriptors&&vr.describe(s,d.descriptors)}function DB(d,s){Object.keys(s).forEach(u=>{let r=u.split("."),l=r.pop(),t=[d].concat(r).join("."),_=s[u].split("."),C=_.pop(),I=_.join(".");vr.route(t,l,I,C)})}function AB(d){return"id"in d&&"defaults"in d}var Jw=class{constructor(){this.controllers=new op(Ed,"datasets",!0),this.elements=new op(ks,"elements"),this.plugins=new op(Object,"plugins"),this.scales=new op(nu,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,u,r){[...u].forEach(l=>{let t=r||this._getRegistryForType(l);r||t.isForType(l)||t===this.plugins&&l.id?this._exec(s,t,l):Bn(l,_=>{let C=r||this._getRegistryForType(_);this._exec(s,C,_)})})}_exec(s,u,r){let l=Xb(s);Yn(r["before"+l],[],r),u[s](r),Yn(r["after"+l],[],r)}_getRegistryForType(s){for(let u=0;u<this._typedRegistries.length;u++){let r=this._typedRegistries[u];if(r.isForType(s))return r}return this.plugins}_get(s,u,r){let l=u.get(s);if(l===void 0)throw new Error('"'+s+'" is not a registered '+r+".");return l}},ol=new Jw,eC=class{constructor(){this._init=[]}notify(s,u,r,l){u==="beforeInit"&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install"));let t=l?this._descriptors(s).filter(l):this._descriptors(s),_=this._notify(t,s,u,r);return u==="afterDestroy"&&(this._notify(t,s,"stop"),this._notify(this._init,s,"uninstall")),_}_notify(s,u,r,l){l=l||{};for(let t of s){let _=t.plugin,C=_[r],I=[u,l,t.options];if(Yn(C,I,_)===!1&&l.cancelable)return!1}return!0}invalidate(){vn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;let u=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),u}_createDescriptors(s,u){let r=s&&s.config,l=Yi(r.options&&r.options.plugins,{}),t=PB(r);return l===!1&&!u?[]:RB(s,t,l,u)}_notifyStateChanges(s){let u=this._oldCache||[],r=this._cache,l=(t,_)=>t.filter(C=>!_.some(I=>C.plugin.id===I.plugin.id));this._notify(l(u,r),s,"stop"),this._notify(l(r,u),s,"start")}};function PB(d){let s={},u=[],r=Object.keys(ol.plugins.items);for(let t=0;t<r.length;t++)u.push(ol.getPlugin(r[t]));let l=d.plugins||[];for(let t=0;t<l.length;t++){let _=l[t];u.indexOf(_)===-1&&(u.push(_),s[_.id]=!0)}return{plugins:u,localIds:s}}function OB(d,s){return!s&&d===!1?null:d===!0?{}:d}function RB(d,{plugins:s,localIds:u},r,l){let t=[],_=d.getContext();for(let C of s){let I=C.id,O=OB(r[I],l);O!==null&&t.push({plugin:C,options:LB(d.config,{plugin:C,local:u[I]},O,_)})}return t}function LB(d,{plugin:s,local:u},r,l){let t=d.pluginScopeKeys(s),_=d.getOptionScopes(r,t);return u&&s.defaults&&_.push(s.defaults),d.createResolver(_,l,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function tC(d,s){let u=vr.datasets[d]||{};return((s.datasets||{})[d]||{}).indexAxis||s.indexAxis||u.indexAxis||"x"}function FB(d,s){let u=d;return d==="_index_"?u=s:d==="_value_"&&(u=s==="x"?"y":"x"),u}function zB(d,s){return d===s?"_index_":"_value_"}function tD(d){if(d==="x"||d==="y"||d==="r")return d}function BB(d){if(d==="top"||d==="bottom")return"x";if(d==="left"||d==="right")return"y"}function iC(d,...s){if(tD(d))return d;for(let u of s){let r=u.axis||BB(u.position)||d.length>1&&tD(d[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${d}' axis. Please provide 'axis' or 'position' option.`)}function iD(d,s,u){if(u[s+"AxisID"]===d)return{axis:s}}function NB(d,s){if(s.data&&s.data.datasets){let u=s.data.datasets.filter(r=>r.xAxisID===d||r.yAxisID===d);if(u.length)return iD(d,"x",u[0])||iD(d,"y",u[0])}return{}}function VB(d,s){let u=Cd[d.type]||{scales:{}},r=s.scales||{},l=tC(d.type,s),t=Object.create(null);return Object.keys(r).forEach(_=>{let C=r[_];if(!cn(C))return console.error(`Invalid scale configuration for scale: ${_}`);if(C._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${_}`);let I=iC(_,C,NB(_,d),vr.scales[C.type]),O=zB(I,l),N=u.scales||{};t[_]=Qm(Object.create(null),[{axis:I},C,N[I],N[O]])}),d.data.datasets.forEach(_=>{let C=_.type||d.type,I=_.indexAxis||tC(C,s),N=(Cd[C]||{}).scales||{};Object.keys(N).forEach(q=>{let ie=FB(q,I),de=_[ie+"AxisID"]||ie;t[de]=t[de]||Object.create(null),Qm(t[de],[{axis:ie},r[de],N[q]])})}),Object.keys(t).forEach(_=>{let C=t[_];Qm(C,[vr.scales[C.type],vr.scale])}),t}function HD(d){let s=d.options||(d.options={});s.plugins=Yi(s.plugins,{}),s.scales=VB(d,s)}function WD(d){return d=d||{},d.datasets=d.datasets||[],d.labels=d.labels||[],d}function jB(d){return d=d||{},d.data=WD(d.data),HD(d),d}var nD=new Map,GD=new Set;function cy(d,s){let u=nD.get(d);return u||(u=s(),nD.set(d,u),GD.add(u)),u}var Fg=(d,s,u)=>{let r=Xl(s,u);r!==void 0&&d.add(r)},nC=class{constructor(s){this._config=jB(s),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=WD(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){let s=this._config;this.clearCache(),HD(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return cy(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,u){return cy(`${s}.transition.${u}`,()=>[[`datasets.${s}.transitions.${u}`,`transitions.${u}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,u){return cy(`${s}-${u}`,()=>[[`datasets.${s}.elements.${u}`,`datasets.${s}`,`elements.${u}`,""]])}pluginScopeKeys(s){let u=s.id,r=this.type;return cy(`${r}-plugin-${u}`,()=>[[`plugins.${u}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,u){let r=this._scopeCache,l=r.get(s);return(!l||u)&&(l=new Map,r.set(s,l)),l}getOptionScopes(s,u,r){let{options:l,type:t}=this,_=this._cachedScopes(s,r),C=_.get(u);if(C)return C;let I=new Set;u.forEach(N=>{s&&(I.add(s),N.forEach(q=>Fg(I,s,q))),N.forEach(q=>Fg(I,l,q)),N.forEach(q=>Fg(I,Cd[t]||{},q)),N.forEach(q=>Fg(I,vr,q)),N.forEach(q=>Fg(I,ey,q))});let O=Array.from(I);return O.length===0&&O.push(Object.create(null)),GD.has(u)&&_.set(u,O),O}chartOptionScopes(){let{options:s,type:u}=this;return[s,Cd[u]||{},vr.datasets[u]||{},{type:u},vr,ey]}resolveNamedOptions(s,u,r,l=[""]){let t={$shared:!0},{resolver:_,subPrefixes:C}=rD(this._resolverCache,s,l),I=_;if(HB(_,u)){t.$shared=!1,r=Yl(r)?r():r;let O=this.createResolver(s,r,C);I=Kh(_,r,O)}for(let O of u)t[O]=I[O];return t}createResolver(s,u,r=[""],l){let{resolver:t}=rD(this._resolverCache,s,r);return cn(u)?Kh(t,u,void 0,l):t}};function rD(d,s,u){let r=d.get(s);r||(r=new Map,d.set(s,r));let l=u.join(),t=r.get(l);return t||(t={resolver:ny(s,u),subPrefixes:u.filter(C=>!C.toLowerCase().includes("hover"))},r.set(l,t)),t}var UB=d=>cn(d)&&Object.getOwnPropertyNames(d).some(s=>Yl(d[s]));function HB(d,s){let{isScriptable:u,isIndexable:r}=Ew(d);for(let l of s){let t=u(l),_=r(l),C=(_||t)&&d[l];if(t&&(Yl(C)||UB(C))||_&&nr(C))return!0}return!1}var WB="4.4.3",GB=["top","bottom","left","right","chartArea"];function oD(d,s){return d==="top"||d==="bottom"||GB.indexOf(d)===-1&&s==="x"}function aD(d,s){return function(u,r){return u[d]===r[d]?u[s]-r[s]:u[d]-r[d]}}function sD(d){let s=d.chart,u=s.options.animation;s.notifyPlugins("afterRender"),Yn(u&&u.onComplete,[d],s)}function qB(d){let s=d.chart,u=s.options.animation;Yn(u&&u.onProgress,[d],s)}function qD(d){return ry()&&typeof d=="string"?d=document.getElementById(d):d&&d.length&&(d=d[0]),d&&d.canvas&&(d=d.canvas),d}var fy={},lD=d=>{let s=qD(d);return Object.values(fy).filter(u=>u.canvas===s).pop()};function $B(d,s,u){let r=Object.keys(d);for(let l of r){let t=+l;if(t>=s){let _=d[l];delete d[l],(u>0||t>s)&&(d[t+u]=_)}}}function YB(d,s,u,r){return!u||d.type==="mouseout"?null:r?s:d}function dy(d,s,u){return d.options.clip?d[u]:s[u]}function ZB(d,s){let{xScale:u,yScale:r}=d;return u&&r?{left:dy(u,s,"left"),right:dy(u,s,"right"),top:dy(r,s,"top"),bottom:dy(r,s,"bottom")}:s}var sp=(()=>{class d{static defaults=vr;static instances=fy;static overrides=Cd;static registry=ol;static version=WB;static getChart=lD;static register(...u){ol.add(...u),cD()}static unregister(...u){ol.remove(...u),cD()}constructor(u,r){let l=this.config=new nC(r),t=qD(u),_=lD(t);if(_)throw new Error("Canvas is already in use. Chart with ID '"+_.id+"' must be destroyed before the canvas with ID '"+_.canvas.id+"' can be reused.");let C=l.createResolver(l.chartOptionScopes(),this.getContext());this.platform=new(l.platform||fB(t)),this.platform.updateConfig(l);let I=this.platform.acquireContext(t,C.aspectRatio),O=I&&I.canvas,N=O&&O.height,q=O&&O.width;if(this.id=aE(),this.ctx=I,this.canvas=O,this.width=q,this.height=N,this._options=C,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new eC,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=_E(ie=>this.update(ie),C.resizeDelay||0),this._dataChanges=[],fy[this.id]=this,!I||!O){console.error("Failed to create chart: can't acquire context from the given item");return}Kl.listen(this,"complete",sD),Kl.listen(this,"progress",qB),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:u,maintainAspectRatio:r},width:l,height:t,_aspectRatio:_}=this;return vn(u)?r&&_?_:t?l/t:null:u}get data(){return this.config.data}set data(u){this.config.data=u}get options(){return this._options}set options(u){this.config.options=u}get registry(){return ol}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Ow(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return kw(this.canvas,this.ctx),this}stop(){return Kl.stop(this),this}resize(u,r){Kl.running(this)?this._resizeBeforeDraw={width:u,height:r}:this._resize(u,r)}_resize(u,r){let l=this.options,t=this.canvas,_=l.maintainAspectRatio&&this.aspectRatio,C=this.platform.getMaximumSize(t,u,r,_),I=l.devicePixelRatio||this.platform.getDevicePixelRatio(),O=this.width?"resize":"attach";this.width=C.width,this.height=C.height,this._aspectRatio=this.aspectRatio,Ow(this,I,!0)&&(this.notifyPlugins("resize",{size:C}),Yn(l.onResize,[this,C],this),this.attached&&this._doResize(O)&&this.render())}ensureScalesHaveIDs(){let r=this.options.scales||{};Bn(r,(l,t)=>{l.id=t})}buildOrUpdateScales(){let u=this.options,r=u.scales,l=this.scales,t=Object.keys(l).reduce((C,I)=>(C[I]=!1,C),{}),_=[];r&&(_=_.concat(Object.keys(r).map(C=>{let I=r[C],O=iC(C,I),N=O==="r",q=O==="x";return{options:I,dposition:N?"chartArea":q?"bottom":"left",dtype:N?"radialLinear":q?"category":"linear"}}))),Bn(_,C=>{let I=C.options,O=I.id,N=iC(O,I),q=Yi(I.type,C.dtype);(I.position===void 0||oD(I.position,N)!==oD(C.dposition))&&(I.position=C.dposition),t[O]=!0;let ie=null;if(O in l&&l[O].type===q)ie=l[O];else{let de=ol.getScale(q);ie=new de({id:O,type:q,ctx:this.ctx,chart:this}),l[ie.id]=ie}ie.init(I,u)}),Bn(t,(C,I)=>{C||delete l[I]}),Bn(l,C=>{Do.configure(this,C,C.options),Do.addBox(this,C)})}_updateMetasets(){let u=this._metasets,r=this.data.datasets.length,l=u.length;if(u.sort((t,_)=>t.index-_.index),l>r){for(let t=r;t<l;++t)this._destroyDatasetMeta(t);u.splice(r,l-r)}this._sortedMetasets=u.slice(0).sort(aD("order","index"))}_removeUnreferencedMetasets(){let{_metasets:u,data:{datasets:r}}=this;u.length>r.length&&delete this._stacks,u.forEach((l,t)=>{r.filter(_=>_===l._dataset).length===0&&this._destroyDatasetMeta(t)})}buildOrUpdateControllers(){let u=[],r=this.data.datasets,l,t;for(this._removeUnreferencedMetasets(),l=0,t=r.length;l<t;l++){let _=r[l],C=this.getDatasetMeta(l),I=_.type||this.config.type;if(C.type&&C.type!==I&&(this._destroyDatasetMeta(l),C=this.getDatasetMeta(l)),C.type=I,C.indexAxis=_.indexAxis||tC(I,this.options),C.order=_.order||0,C.index=l,C.label=""+_.label,C.visible=this.isDatasetVisible(l),C.controller)C.controller.updateIndex(l),C.controller.linkScales();else{let O=ol.getController(I),{datasetElementType:N,dataElementType:q}=vr.datasets[I];Object.assign(O,{dataElementType:ol.getElement(q),datasetElementType:N&&ol.getElement(N)}),C.controller=new O(this,l),u.push(C.controller)}}return this._updateMetasets(),u}_resetElements(){Bn(this.data.datasets,(u,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(u){let r=this.config;r.update();let l=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),t=this._animationsDisabled=!l.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:u,cancelable:!0})===!1)return;let _=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let C=0;for(let N=0,q=this.data.datasets.length;N<q;N++){let{controller:ie}=this.getDatasetMeta(N),de=!t&&_.indexOf(ie)===-1;ie.buildOrUpdateElements(de),C=Math.max(+ie.getMaxOverflow(),C)}C=this._minPadding=l.layout.autoPadding?C:0,this._updateLayout(C),t||Bn(_,N=>{N.reset()}),this._updateDatasets(u),this.notifyPlugins("afterUpdate",{mode:u}),this._layers.sort(aD("z","_idx"));let{_active:I,_lastEvent:O}=this;O?this._eventHandler(O,!0):I.length&&this._updateHoverStyles(I,I,!0),this.render()}_updateScales(){Bn(this.scales,u=>{Do.removeBox(this,u)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let u=this.options,r=new Set(Object.keys(this._listeners)),l=new Set(u.events);(!mw(r,l)||!!this._responsiveListeners!==u.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:u}=this,r=this._getUniformDataChanges()||[];for(let{method:l,start:t,count:_}of r){let C=l==="_removeElements"?-_:_;$B(u,t,C)}}_getUniformDataChanges(){let u=this._dataChanges;if(!u||!u.length)return;this._dataChanges=[];let r=this.data.datasets.length,l=_=>new Set(u.filter(C=>C[0]===_).map((C,I)=>I+","+C.splice(1).join(","))),t=l(0);for(let _=1;_<r;_++)if(!mw(t,l(_)))return;return Array.from(t).map(_=>_.split(",")).map(_=>({method:_[1],start:+_[2],count:+_[3]}))}_updateLayout(u){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Do.update(this,this.width,this.height,u);let r=this.chartArea,l=r.width<=0||r.height<=0;this._layers=[],Bn(this.boxes,t=>{l&&t.position==="chartArea"||(t.configure&&t.configure(),this._layers.push(...t._layers()))},this),this._layers.forEach((t,_)=>{t._idx=_}),this.notifyPlugins("afterLayout")}_updateDatasets(u){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:u,cancelable:!0})!==!1){for(let r=0,l=this.data.datasets.length;r<l;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,l=this.data.datasets.length;r<l;++r)this._updateDataset(r,Yl(u)?u({datasetIndex:r}):u);this.notifyPlugins("afterDatasetsUpdate",{mode:u})}}_updateDataset(u,r){let l=this.getDatasetMeta(u),t={meta:l,index:u,mode:r,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",t)!==!1&&(l.controller._update(r),t.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",t))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Kl.has(this)?this.attached&&!Kl.running(this)&&Kl.start(this):(this.draw(),sD({chart:this})))}draw(){let u;if(this._resizeBeforeDraw){let{width:l,height:t}=this._resizeBeforeDraw;this._resize(l,t),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let r=this._layers;for(u=0;u<r.length&&r[u].z<=0;++u)r[u].draw(this.chartArea);for(this._drawDatasets();u<r.length;++u)r[u].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(u){let r=this._sortedMetasets,l=[],t,_;for(t=0,_=r.length;t<_;++t){let C=r[t];(!u||C.visible)&&l.push(C)}return l}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let u=this.getSortedVisibleDatasetMetas();for(let r=u.length-1;r>=0;--r)this._drawDataset(u[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(u){let r=this.ctx,l=u._clip,t=!l.disabled,_=ZB(u,this.chartArea),C={meta:u,index:u.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",C)!==!1&&(t&&Dg(r,{left:l.left===!1?0:_.left-l.left,right:l.right===!1?this.width:_.right+l.right,top:l.top===!1?0:_.top-l.top,bottom:l.bottom===!1?this.height:_.bottom+l.bottom}),u.controller.draw(),t&&Ag(r),C.cancelable=!1,this.notifyPlugins("afterDatasetDraw",C))}isPointInArea(u){return tl(u,this.chartArea,this._minPadding)}getElementsAtEventForMode(u,r,l,t){let _=X4.modes[r];return typeof _=="function"?_(this,u,l,t):[]}getDatasetMeta(u){let r=this.data.datasets[u],l=this._metasets,t=l.filter(_=>_&&_._dataset===r).pop();return t||(t={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:u,_dataset:r,_parsed:[],_sorted:!1},l.push(t)),t}getContext(){return this.$context||(this.$context=Ql(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(u){let r=this.data.datasets[u];if(!r)return!1;let l=this.getDatasetMeta(u);return typeof l.hidden=="boolean"?!l.hidden:!r.hidden}setDatasetVisibility(u,r){let l=this.getDatasetMeta(u);l.hidden=!r}toggleDataVisibility(u){this._hiddenIndices[u]=!this._hiddenIndices[u]}getDataVisibility(u){return!this._hiddenIndices[u]}_updateVisibility(u,r,l){let t=l?"show":"hide",_=this.getDatasetMeta(u),C=_.controller._resolveAnimations(void 0,t);Km(r)?(_.data[r].hidden=!l,this.update()):(this.setDatasetVisibility(u,l),C.update(_,{visible:l}),this.update(I=>I.datasetIndex===u?t:void 0))}hide(u,r){this._updateVisibility(u,r,!1)}show(u,r){this._updateVisibility(u,r,!0)}_destroyDatasetMeta(u){let r=this._metasets[u];r&&r.controller&&r.controller._destroy(),delete this._metasets[u]}_stop(){let u,r;for(this.stop(),Kl.remove(this),u=0,r=this.data.datasets.length;u<r;++u)this._destroyDatasetMeta(u)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:u,ctx:r}=this;this._stop(),this.config.clearCache(),u&&(this.unbindEvents(),kw(u,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),delete fy[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...u){return this.canvas.toDataURL(...u)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let u=this._listeners,r=this.platform,l=(_,C)=>{r.addEventListener(this,_,C),u[_]=C},t=(_,C,I)=>{_.offsetX=C,_.offsetY=I,this._eventHandler(_)};Bn(this.options.events,_=>l(_,t))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let u=this._responsiveListeners,r=this.platform,l=(O,N)=>{r.addEventListener(this,O,N),u[O]=N},t=(O,N)=>{u[O]&&(r.removeEventListener(this,O,N),delete u[O])},_=(O,N)=>{this.canvas&&this.resize(O,N)},C,I=()=>{t("attach",I),this.attached=!0,this.resize(),l("resize",_),l("detach",C)};C=()=>{this.attached=!1,t("resize",_),this._stop(),this._resize(0,0),l("attach",I)},r.isAttached(this.canvas)?I():C()}unbindEvents(){Bn(this._listeners,(u,r)=>{this.platform.removeEventListener(this,r,u)}),this._listeners={},Bn(this._responsiveListeners,(u,r)=>{this.platform.removeEventListener(this,r,u)}),this._responsiveListeners=void 0}updateHoverStyle(u,r,l){let t=l?"set":"remove",_,C,I,O;for(r==="dataset"&&(_=this.getDatasetMeta(u[0].datasetIndex),_.controller["_"+t+"DatasetHoverStyle"]()),I=0,O=u.length;I<O;++I){C=u[I];let N=C&&this.getDatasetMeta(C.datasetIndex).controller;N&&N[t+"HoverStyle"](C.element,C.datasetIndex,C.index)}}getActiveElements(){return this._active||[]}setActiveElements(u){let r=this._active||[],l=u.map(({datasetIndex:_,index:C})=>{let I=this.getDatasetMeta(_);if(!I)throw new Error("No dataset found at index "+_);return{datasetIndex:_,element:I.data[C],index:C}});!Tg(l,r)&&(this._active=l,this._lastEvent=null,this._updateHoverStyles(l,r))}notifyPlugins(u,r,l){return this._plugins.notify(this,u,r,l)}isPluginEnabled(u){return this._plugins._cache.filter(r=>r.plugin.id===u).length===1}_updateHoverStyles(u,r,l){let t=this.options.hover,_=(O,N)=>O.filter(q=>!N.some(ie=>q.datasetIndex===ie.datasetIndex&&q.index===ie.index)),C=_(r,u),I=l?u:_(u,r);C.length&&this.updateHoverStyle(C,t.mode,!1),I.length&&t.mode&&this.updateHoverStyle(I,t.mode,!0)}_eventHandler(u,r){let l={event:u,replay:r,cancelable:!0,inChartArea:this.isPointInArea(u)},t=C=>(C.options.events||this.options.events).includes(u.native.type);if(this.notifyPlugins("beforeEvent",l,t)===!1)return;let _=this._handleEvent(u,r,l.inChartArea);return l.cancelable=!1,this.notifyPlugins("afterEvent",l,t),(_||l.changed)&&this.render(),this}_handleEvent(u,r,l){let{_active:t=[],options:_}=this,C=r,I=this._getActiveElements(u,t,l,C),O=cE(u),N=YB(u,this._lastEvent,l,O);l&&(this._lastEvent=null,Yn(_.onHover,[u,I,this],this),O&&Yn(_.onClick,[u,I,this],this));let q=!Tg(I,t);return(q||r)&&(this._active=I,this._updateHoverStyles(I,t,r)),this._lastEvent=N,q}_getActiveElements(u,r,l,t){if(u.type==="mouseout")return[];if(!l)return r;let _=this.options.hover;return this.getElementsAtEventForMode(u,_.mode,_,t)}}return d})();function cD(){return Bn(sp.instances,d=>d._plugins.invalidate())}function XB(d,s,u){let{startAngle:r,pixelMargin:l,x:t,y:_,outerRadius:C,innerRadius:I}=s,O=l/C;d.beginPath(),d.arc(t,_,C,r-O,u+O),I>l?(O=l/I,d.arc(t,_,I,u+O,r-O,!0)):d.arc(t,_,l,u+Mr,r-Mr),d.closePath(),d.clip()}function QB(d){return iy(d,["outerStart","outerEnd","innerStart","innerEnd"])}function KB(d,s,u,r){let l=QB(d.options.borderRadius),t=(u-s)/2,_=Math.min(t,r*s/2),C=I=>{let O=(u-Math.min(t,I))*r/2;return Xr(I,0,Math.min(t,O))};return{outerStart:C(l.outerStart),outerEnd:C(l.outerEnd),innerStart:Xr(l.innerStart,0,_),innerEnd:Xr(l.innerEnd,0,_)}}function rp(d,s,u,r){return{x:u+d*Math.cos(s),y:r+d*Math.sin(s)}}function yy(d,s,u,r,l,t){let{x:_,y:C,startAngle:I,pixelMargin:O,innerRadius:N}=s,q=Math.max(s.outerRadius+r+u-O,0),ie=N>0?N+r+u+O:0,de=0,xe=l-I;if(r){let dn=N>0?N-r:0,tn=q>0?q-r:0,jn=(dn+tn)/2,Ur=jn!==0?xe*jn/(jn+r):xe;de=(xe-Ur)/2}let ke=Math.max(.001,xe*q-u/rr)/q,Ae=(xe-ke)/2,Xe=I+Ae+de,qe=l-Ae-de,{outerStart:ut,outerEnd:It,innerStart:wt,innerEnd:Et}=KB(s,ie,q,qe-Xe),Ht=q-ut,Ct=q-It,Yt=Xe+ut/Ht,zt=qe-It/Ct,Ii=ie+wt,Hi=ie+Et,cr=Xe+wt/Ii,wi=qe-Et/Hi;if(d.beginPath(),t){let dn=(Yt+zt)/2;if(d.arc(_,C,q,Yt,dn),d.arc(_,C,q,dn,zt),It>0){let Zn=rp(Ct,zt,_,C);d.arc(Zn.x,Zn.y,It,zt,qe+Mr)}let tn=rp(Hi,qe,_,C);if(d.lineTo(tn.x,tn.y),Et>0){let Zn=rp(Hi,wi,_,C);d.arc(Zn.x,Zn.y,Et,qe+Mr,wi+Math.PI)}let jn=(qe-Et/ie+(Xe+wt/ie))/2;if(d.arc(_,C,ie,qe-Et/ie,jn,!0),d.arc(_,C,ie,jn,Xe+wt/ie,!0),wt>0){let Zn=rp(Ii,cr,_,C);d.arc(Zn.x,Zn.y,wt,cr+Math.PI,Xe-Mr)}let Ur=rp(Ht,Xe,_,C);if(d.lineTo(Ur.x,Ur.y),ut>0){let Zn=rp(Ht,Yt,_,C);d.arc(Zn.x,Zn.y,ut,Xe-Mr,Yt)}}else{d.moveTo(_,C);let dn=Math.cos(Yt)*q+_,tn=Math.sin(Yt)*q+C;d.lineTo(dn,tn);let jn=Math.cos(zt)*q+_,Ur=Math.sin(zt)*q+C;d.lineTo(jn,Ur)}d.closePath()}function JB(d,s,u,r,l){let{fullCircles:t,startAngle:_,circumference:C}=s,I=s.endAngle;if(t){yy(d,s,u,r,I,l);for(let O=0;O<t;++O)d.fill();isNaN(C)||(I=_+(C%or||or))}return yy(d,s,u,r,I,l),d.fill(),I}function eN(d,s,u,r,l){let{fullCircles:t,startAngle:_,circumference:C,options:I}=s,{borderWidth:O,borderJoinStyle:N,borderDash:q,borderDashOffset:ie}=I,de=I.borderAlign==="inner";if(!O)return;d.setLineDash(q||[]),d.lineDashOffset=ie,de?(d.lineWidth=O*2,d.lineJoin=N||"round"):(d.lineWidth=O,d.lineJoin=N||"bevel");let xe=s.endAngle;if(t){yy(d,s,u,r,xe,l);for(let ke=0;ke<t;++ke)d.stroke();isNaN(C)||(xe=_+(C%or||or))}de&&XB(d,s,xe),t||(yy(d,s,u,r,xe,l),d.stroke())}var rC=class extends ks{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:s=>s!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(s){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,s&&Object.assign(this,s)}inRange(s,u,r){let l=this.getProps(["x","y"],r),{angle:t,distance:_}=_w(l,{x:s,y:u}),{startAngle:C,endAngle:I,innerRadius:O,outerRadius:N,circumference:q}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),ie=(this.options.spacing+this.options.borderWidth)/2,xe=Yi(q,I-C)>=or||ep(t,C,I),ke=nl(_,O+ie,N+ie);return xe&&ke}getCenterPoint(s){let{x:u,y:r,startAngle:l,endAngle:t,innerRadius:_,outerRadius:C}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],s),{offset:I,spacing:O}=this.options,N=(l+t)/2,q=(_+C+O+I)/2;return{x:u+Math.cos(N)*q,y:r+Math.sin(N)*q}}tooltipPosition(s){return this.getCenterPoint(s)}draw(s){let{options:u,circumference:r}=this,l=(u.offset||0)/4,t=(u.spacing||0)/2,_=u.circular;if(this.pixelMargin=u.borderAlign==="inner"?.33:0,this.fullCircles=r>or?Math.floor(r/or):0,r===0||this.innerRadius<0||this.outerRadius<0)return;s.save();let C=(this.startAngle+this.endAngle)/2;s.translate(Math.cos(C)*l,Math.sin(C)*l);let I=1-Math.sin(Math.min(rr,r||0)),O=l*I;s.fillStyle=u.backgroundColor,s.strokeStyle=u.borderColor,JB(s,this,O,t,_),eN(s,this,O,t,_),s.restore()}};function $D(d,s,u=s){d.lineCap=Yi(u.borderCapStyle,s.borderCapStyle),d.setLineDash(Yi(u.borderDash,s.borderDash)),d.lineDashOffset=Yi(u.borderDashOffset,s.borderDashOffset),d.lineJoin=Yi(u.borderJoinStyle,s.borderJoinStyle),d.lineWidth=Yi(u.borderWidth,s.borderWidth),d.strokeStyle=Yi(u.borderColor,s.borderColor)}function tN(d,s,u){d.lineTo(u.x,u.y)}function iN(d){return d.stepped?xE:d.tension||d.cubicInterpolationMode==="monotone"?wE:tN}function YD(d,s,u={}){let r=d.length,{start:l=0,end:t=r-1}=u,{start:_,end:C}=s,I=Math.max(l,_),O=Math.min(t,C),N=l<_&&t<_||l>C&&t>C;return{count:r,start:I,loop:s.loop,ilen:O<I&&!N?r+O-I:O-I}}function nN(d,s,u,r){let{points:l,options:t}=s,{count:_,start:C,loop:I,ilen:O}=YD(l,u,r),N=iN(t),{move:q=!0,reverse:ie}=r||{},de,xe,ke;for(de=0;de<=O;++de)xe=l[(C+(ie?O-de:de))%_],!xe.skip&&(q?(d.moveTo(xe.x,xe.y),q=!1):N(d,ke,xe,ie,t.stepped),ke=xe);return I&&(xe=l[(C+(ie?O:0))%_],N(d,ke,xe,ie,t.stepped)),!!I}function rN(d,s,u,r){let l=s.points,{count:t,start:_,ilen:C}=YD(l,u,r),{move:I=!0,reverse:O}=r||{},N=0,q=0,ie,de,xe,ke,Ae,Xe,qe=It=>(_+(O?C-It:It))%t,ut=()=>{ke!==Ae&&(d.lineTo(N,Ae),d.lineTo(N,ke),d.lineTo(N,Xe))};for(I&&(de=l[qe(0)],d.moveTo(de.x,de.y)),ie=0;ie<=C;++ie){if(de=l[qe(ie)],de.skip)continue;let It=de.x,wt=de.y,Et=It|0;Et===xe?(wt<ke?ke=wt:wt>Ae&&(Ae=wt),N=(q*N+It)/++q):(ut(),d.lineTo(It,wt),xe=Et,q=0,ke=Ae=wt),Xe=wt}ut()}function oC(d){let s=d.options,u=s.borderDash&&s.borderDash.length;return!d._decimated&&!d._loop&&!s.tension&&s.cubicInterpolationMode!=="monotone"&&!s.stepped&&!u?rN:nN}function oN(d){return d.stepped?AE:d.tension||d.cubicInterpolationMode==="monotone"?PE:wd}function aN(d,s,u,r){let l=s._path;l||(l=s._path=new Path2D,s.path(l,u,r)&&l.closePath()),$D(d,s.options),d.stroke(l)}function sN(d,s,u,r){let{segments:l,options:t}=s,_=oC(s);for(let C of l)$D(d,t,C.style),d.beginPath(),_(d,s,C,{start:u,end:u+r-1})&&d.closePath(),d.stroke()}var lN=typeof Path2D=="function";function cN(d,s,u,r){lN&&!s.options.segment?aN(d,s,u,r):sN(d,s,u,r)}var wy=(()=>{class d extends ks{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:u=>u!=="borderDash"&&u!=="fill"};constructor(u){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,u&&Object.assign(this,u)}updateControlPoints(u,r){let l=this.options;if((l.tension||l.cubicInterpolationMode==="monotone")&&!l.stepped&&!this._pointsUpdated){let t=l.spanGaps?this._loop:this._fullLoop;TE(this._points,l,u,t,r),this._pointsUpdated=!0}}set points(u){this._points=u,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=RE(this,this.options.segment))}first(){let u=this.segments,r=this.points;return u.length&&r[u[0].start]}last(){let u=this.segments,r=this.points,l=u.length;return l&&r[u[l-1].end]}interpolate(u,r){let l=this.options,t=u[r],_=this.points,C=Bw(this,{property:r,start:t,end:t});if(!C.length)return;let I=[],O=oN(l),N,q;for(N=0,q=C.length;N<q;++N){let{start:ie,end:de}=C[N],xe=_[ie],ke=_[de];if(xe===ke){I.push(xe);continue}let Ae=Math.abs((t-xe[r])/(ke[r]-xe[r])),Xe=O(xe,ke,Ae,l.stepped);Xe[r]=u[r],I.push(Xe)}return I.length===1?I[0]:I}pathSegment(u,r,l){return oC(this)(u,this,r,l)}path(u,r,l){let t=this.segments,_=oC(this),C=this._loop;r=r||0,l=l||this.points.length-r;for(let I of t)C&=_(u,this,I,{start:r,end:r+l-1});return!!C}draw(u,r,l,t){let _=this.options||{};(this.points||[]).length&&_.borderWidth&&(u.save(),cN(u,this,l,t),u.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return d})();function dD(d,s,u,r){let l=d.options,{[u]:t}=d.getProps([u],r);return Math.abs(s-t)<l.radius+l.hitRadius}var dN=(()=>{class d extends ks{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(u){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,u&&Object.assign(this,u)}inRange(u,r,l){let t=this.options,{x:_,y:C}=this.getProps(["x","y"],l);return Math.pow(u-_,2)+Math.pow(r-C,2)<Math.pow(t.hitRadius+t.radius,2)}inXRange(u,r){return dD(this,u,"x",r)}inYRange(u,r){return dD(this,u,"y",r)}getCenterPoint(u){let{x:r,y:l}=this.getProps(["x","y"],u);return{x:r,y:l}}size(u){u=u||this.options||{};let r=u.radius||0;r=Math.max(r,r&&u.hoverRadius||0);let l=r&&u.borderWidth||0;return(r+l)*2}draw(u,r){let l=this.options;this.skip||l.radius<.1||!tl(this,r,this.size(l)/2)||(u.strokeStyle=l.borderColor,u.lineWidth=l.borderWidth,u.fillStyle=l.backgroundColor,ty(u,l,this.x,this.y))}getRange(){let u=this.options||{};return u.radius+u.hitRadius}}return d})();function ZD(d,s){let{x:u,y:r,base:l,width:t,height:_}=d.getProps(["x","y","base","width","height"],s),C,I,O,N,q;return d.horizontal?(q=_/2,C=Math.min(u,l),I=Math.max(u,l),O=r-q,N=r+q):(q=t/2,C=u-q,I=u+q,O=Math.min(r,l),N=Math.max(r,l)),{left:C,top:O,right:I,bottom:N}}function Td(d,s,u,r){return d?0:Xr(s,u,r)}function hN(d,s,u){let r=d.options.borderWidth,l=d.borderSkipped,t=Tw(r);return{t:Td(l.top,t.top,0,u),r:Td(l.right,t.right,0,s),b:Td(l.bottom,t.bottom,0,u),l:Td(l.left,t.left,0,s)}}function uN(d,s,u){let{enableBorderRadius:r}=d.getProps(["enableBorderRadius"]),l=d.options.borderRadius,t=kd(l),_=Math.min(s,u),C=d.borderSkipped,I=r||cn(l);return{topLeft:Td(!I||C.top||C.left,t.topLeft,0,_),topRight:Td(!I||C.top||C.right,t.topRight,0,_),bottomLeft:Td(!I||C.bottom||C.left,t.bottomLeft,0,_),bottomRight:Td(!I||C.bottom||C.right,t.bottomRight,0,_)}}function mN(d){let s=ZD(d),u=s.right-s.left,r=s.bottom-s.top,l=hN(d,u/2,r/2),t=uN(d,u/2,r/2);return{outer:{x:s.left,y:s.top,w:u,h:r,radius:t},inner:{x:s.left+l.l,y:s.top+l.t,w:u-l.l-l.r,h:r-l.t-l.b,radius:{topLeft:Math.max(0,t.topLeft-Math.max(l.t,l.l)),topRight:Math.max(0,t.topRight-Math.max(l.t,l.r)),bottomLeft:Math.max(0,t.bottomLeft-Math.max(l.b,l.l)),bottomRight:Math.max(0,t.bottomRight-Math.max(l.b,l.r))}}}}function Gw(d,s,u,r){let l=s===null,t=u===null,C=d&&!(l&&t)&&ZD(d,r);return C&&(l||nl(s,C.left,C.right))&&(t||nl(u,C.top,C.bottom))}function pN(d){return d.topLeft||d.topRight||d.bottomLeft||d.bottomRight}function fN(d,s){d.rect(s.x,s.y,s.w,s.h)}function qw(d,s,u={}){let r=d.x!==u.x?-s:0,l=d.y!==u.y?-s:0,t=(d.x+d.w!==u.x+u.w?s:0)-r,_=(d.y+d.h!==u.y+u.h?s:0)-l;return{x:d.x+r,y:d.y+l,w:d.w+t,h:d.h+_,radius:d.radius}}var aC=class extends ks{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){let{inflateAmount:u,options:{borderColor:r,backgroundColor:l}}=this,{inner:t,outer:_}=mN(this),C=pN(_.radius)?ip:fN;s.save(),(_.w!==t.w||_.h!==t.h)&&(s.beginPath(),C(s,qw(_,u,t)),s.clip(),C(s,qw(t,-u,_)),s.fillStyle=r,s.fill("evenodd")),s.beginPath(),C(s,qw(t,u)),s.fillStyle=l,s.fill(),s.restore()}inRange(s,u,r){return Gw(this,s,u,r)}inXRange(s,u){return Gw(this,s,null,u)}inYRange(s,u){return Gw(this,null,s,u)}getCenterPoint(s){let{x:u,y:r,base:l,horizontal:t}=this.getProps(["x","y","base","horizontal"],s);return{x:t?(u+l)/2:u,y:t?r:(r+l)/2}}getRange(s){return s==="x"?this.width/2:this.height/2}},gN=Object.freeze({__proto__:null,ArcElement:rC,BarElement:aC,LineElement:wy,PointElement:dN}),sC=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],hD=sC.map(d=>d.replace("rgb(","rgba(").replace(")",", 0.5)"));function XD(d){return sC[d%sC.length]}function QD(d){return hD[d%hD.length]}function _N(d,s){return d.borderColor=XD(s),d.backgroundColor=QD(s),++s}function bN(d,s){return d.backgroundColor=d.data.map(()=>XD(s++)),s}function yN(d,s){return d.backgroundColor=d.data.map(()=>QD(s++)),s}function vN(d){let s=0;return(u,r)=>{let l=d.getDatasetMeta(r).controller;l instanceof fC?s=bN(u,s):l instanceof BD?s=yN(u,s):l&&(s=_N(u,s))}}function uD(d){let s;for(s in d)if(d[s].borderColor||d[s].backgroundColor)return!0;return!1}function xN(d){return d&&(d.borderColor||d.backgroundColor)}var wN={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(d,s,u){if(!u.enabled)return;let{data:{datasets:r},options:l}=d.config,{elements:t}=l;if(!u.forceOverride&&(uD(r)||xN(l)||t&&uD(t)))return;let _=vN(d);r.forEach(_)}};function CN(d,s,u,r,l){let t=l.samples||r;if(t>=u)return d.slice(s,s+u);let _=[],C=(u-2)/(t-2),I=0,O=s+u-1,N=s,q,ie,de,xe,ke;for(_[I++]=d[N],q=0;q<t-2;q++){let Ae=0,Xe=0,qe,ut=Math.floor((q+1)*C)+1+s,It=Math.min(Math.floor((q+2)*C)+1,u)+s,wt=It-ut;for(qe=ut;qe<It;qe++)Ae+=d[qe].x,Xe+=d[qe].y;Ae/=wt,Xe/=wt;let Et=Math.floor(q*C)+1+s,Ht=Math.min(Math.floor((q+1)*C)+1,u)+s,{x:Ct,y:Yt}=d[N];for(de=xe=-1,qe=Et;qe<Ht;qe++)xe=.5*Math.abs((Ct-Ae)*(d[qe].y-Yt)-(Ct-d[qe].x)*(Xe-Yt)),xe>de&&(de=xe,ie=d[qe],ke=qe);_[I++]=ie,N=ke}return _[I++]=d[O],_}function SN(d,s,u,r){let l=0,t=0,_,C,I,O,N,q,ie,de,xe,ke,Ae=[],Xe=s+u-1,qe=d[s].x,It=d[Xe].x-qe;for(_=s;_<s+u;++_){C=d[_],I=(C.x-qe)/It*r,O=C.y;let wt=I|0;if(wt===N)O<xe?(xe=O,q=_):O>ke&&(ke=O,ie=_),l=(t*l+C.x)/++t;else{let Et=_-1;if(!vn(q)&&!vn(ie)){let Ht=Math.min(q,ie),Ct=Math.max(q,ie);Ht!==de&&Ht!==Et&&Ae.push(ja(Ji({},d[Ht]),{x:l})),Ct!==de&&Ct!==Et&&Ae.push(ja(Ji({},d[Ct]),{x:l}))}_>0&&Et!==de&&Ae.push(d[Et]),Ae.push(C),N=wt,t=0,xe=ke=O,q=ie=de=_}}return Ae}function KD(d){if(d._decimated){let s=d._data;delete d._decimated,delete d._data,Object.defineProperty(d,"data",{configurable:!0,enumerable:!0,writable:!0,value:s})}}function mD(d){d.data.datasets.forEach(s=>{KD(s)})}function MN(d,s){let u=s.length,r=0,l,{iScale:t}=d,{min:_,max:C,minDefined:I,maxDefined:O}=t.getUserBounds();return I&&(r=Xr(el(s,t.axis,_).lo,0,u-1)),O?l=Xr(el(s,t.axis,C).hi+1,r,u)-r:l=u-r,{start:r,count:l}}var kN={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(d,s,u)=>{if(!u.enabled){mD(d);return}let r=d.width;d.data.datasets.forEach((l,t)=>{let{_data:_,indexAxis:C}=l,I=d.getDatasetMeta(t),O=_||l.data;if(np([C,d.options.indexAxis])==="y"||!I.controller.supportsDecimation)return;let N=d.scales[I.xAxisID];if(N.type!=="linear"&&N.type!=="time"||d.options.parsing)return;let{start:q,count:ie}=MN(I,O),de=u.threshold||4*r;if(ie<=de){KD(l);return}vn(_)&&(l._data=O,delete l.data,Object.defineProperty(l,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(ke){this._data=ke}}));let xe;switch(u.algorithm){case"lttb":xe=CN(O,q,ie,r,u);break;case"min-max":xe=SN(O,q,ie,r);break;default:throw new Error(`Unsupported decimation algorithm '${u.algorithm}'`)}l._decimated=xe})},destroy(d){mD(d)}};function IN(d,s,u){let r=d.segments,l=d.points,t=s.points,_=[];for(let C of r){let{start:I,end:O}=C;O=gC(I,O,l);let N=lC(u,l[I],l[O],C.loop);if(!s.segments){_.push({source:C,target:N,start:l[I],end:l[O]});continue}let q=Bw(s,N);for(let ie of q){let de=lC(u,t[ie.start],t[ie.end],ie.loop),xe=zw(C,l,de);for(let ke of xe)_.push({source:ke,target:ie,start:{[u]:pD(N,de,"start",Math.max)},end:{[u]:pD(N,de,"end",Math.min)}})}}return _}function lC(d,s,u,r){if(r)return;let l=s[d],t=u[d];return d==="angle"&&(l=ia(l),t=ia(t)),{property:d,start:l,end:t}}function TN(d,s){let{x:u=null,y:r=null}=d||{},l=s.points,t=[];return s.segments.forEach(({start:_,end:C})=>{C=gC(_,C,l);let I=l[_],O=l[C];r!==null?(t.push({x:I.x,y:r}),t.push({x:O.x,y:r})):u!==null&&(t.push({x:u,y:I.y}),t.push({x:u,y:O.y}))}),t}function gC(d,s,u){for(;s>d;s--){let r=u[s];if(!isNaN(r.x)&&!isNaN(r.y))break}return s}function pD(d,s,u,r){return d&&s?r(d[u],s[u]):d?d[u]:s?s[u]:0}function JD(d,s){let u=[],r=!1;return nr(d)?(r=!0,u=d):u=TN(d,s),u.length?new wy({points:u,options:{tension:0},_loop:r,_fullLoop:r}):null}function fD(d){return d&&d.fill!==!1}function EN(d,s,u){let l=d[s].fill,t=[s],_;if(!u)return l;for(;l!==!1&&t.indexOf(l)===-1;){if(!yr(l))return l;if(_=d[l],!_)return!1;if(_.visible)return l;t.push(l),l=_.fill}return!1}function DN(d,s,u){let r=RN(d);if(cn(r))return isNaN(r.value)?!1:r;let l=parseFloat(r);return yr(l)&&Math.floor(l)===l?AN(r[0],s,l,u):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function AN(d,s,u,r){return(d==="-"||d==="+")&&(u=s+u),u===s||u<0||u>=r?!1:u}function PN(d,s){let u=null;return d==="start"?u=s.bottom:d==="end"?u=s.top:cn(d)?u=s.getPixelForValue(d.value):s.getBasePixel&&(u=s.getBasePixel()),u}function ON(d,s,u){let r;return d==="start"?r=u:d==="end"?r=s.options.reverse?s.min:s.max:cn(d)?r=d.value:r=s.getBaseValue(),r}function RN(d){let s=d.options,u=s.fill,r=Yi(u&&u.target,u);return r===void 0&&(r=!!s.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function LN(d){let{scale:s,index:u,line:r}=d,l=[],t=r.segments,_=r.points,C=FN(s,u);C.push(JD({x:null,y:s.bottom},r));for(let I=0;I<t.length;I++){let O=t[I];for(let N=O.start;N<=O.end;N++)zN(l,_[N],C)}return new wy({points:l,options:{}})}function FN(d,s){let u=[],r=d.getMatchingVisibleMetas("line");for(let l=0;l<r.length;l++){let t=r[l];if(t.index===s)break;t.hidden||u.unshift(t.dataset)}return u}function zN(d,s,u){let r=[];for(let l=0;l<u.length;l++){let t=u[l],{first:_,last:C,point:I}=BN(t,s,"x");if(!(!I||_&&C)){if(_)r.unshift(I);else if(d.push(I),!C)break}}d.push(...r)}function BN(d,s,u){let r=d.interpolate(s,u);if(!r)return{};let l=r[u],t=d.segments,_=d.points,C=!1,I=!1;for(let O=0;O<t.length;O++){let N=t[O],q=_[N.start][u],ie=_[N.end][u];if(nl(l,q,ie)){C=l===q,I=l===ie;break}}return{first:C,last:I,point:r}}var vy=class{constructor(s){this.x=s.x,this.y=s.y,this.radius=s.radius}pathSegment(s,u,r){let{x:l,y:t,radius:_}=this;return u=u||{start:0,end:or},s.arc(l,t,_,u.end,u.start,!0),!r.bounds}interpolate(s){let{x:u,y:r,radius:l}=this,t=s.angle;return{x:u+Math.cos(t)*l,y:r+Math.sin(t)*l,angle:t}}};function NN(d){let{chart:s,fill:u,line:r}=d;if(yr(u))return VN(s,u);if(u==="stack")return LN(d);if(u==="shape")return!0;let l=jN(d);return l instanceof vy?l:JD(l,r)}function VN(d,s){let u=d.getDatasetMeta(s);return u&&d.isDatasetVisible(s)?u.dataset:null}function jN(d){return(d.scale||{}).getPointPositionForValue?HN(d):UN(d)}function UN(d){let{scale:s={},fill:u}=d,r=PN(u,s);if(yr(r)){let l=s.isHorizontal();return{x:l?r:null,y:l?null:r}}return null}function HN(d){let{scale:s,fill:u}=d,r=s.options,l=s.getLabels().length,t=r.reverse?s.max:s.min,_=ON(u,s,t),C=[];if(r.grid.circular){let I=s.getPointPositionForValue(0,t);return new vy({x:I.x,y:I.y,radius:s.getDistanceFromCenterForValue(_)})}for(let I=0;I<l;++I)C.push(s.getPointPositionForValue(I,_));return C}function $w(d,s,u){let r=NN(s),{line:l,scale:t,axis:_}=s,C=l.options,I=C.fill,O=C.backgroundColor,{above:N=O,below:q=O}=I||{};r&&l.points.length&&(Dg(d,u),WN(d,{line:l,target:r,above:N,below:q,area:u,scale:t,axis:_}),Ag(d))}function WN(d,s){let{line:u,target:r,above:l,below:t,area:_,scale:C}=s,I=u._loop?"angle":s.axis;d.save(),I==="x"&&t!==l&&(gD(d,r,_.top),_D(d,{line:u,target:r,color:l,scale:C,property:I}),d.restore(),d.save(),gD(d,r,_.bottom)),_D(d,{line:u,target:r,color:t,scale:C,property:I}),d.restore()}function gD(d,s,u){let{segments:r,points:l}=s,t=!0,_=!1;d.beginPath();for(let C of r){let{start:I,end:O}=C,N=l[I],q=l[gC(I,O,l)];t?(d.moveTo(N.x,N.y),t=!1):(d.lineTo(N.x,u),d.lineTo(N.x,N.y)),_=!!s.pathSegment(d,C,{move:_}),_?d.closePath():d.lineTo(q.x,u)}d.lineTo(s.first().x,u),d.closePath(),d.clip()}function _D(d,s){let{line:u,target:r,property:l,color:t,scale:_}=s,C=IN(u,r,l);for(let{source:I,target:O,start:N,end:q}of C){let{style:{backgroundColor:ie=t}={}}=I,de=r!==!0;d.save(),d.fillStyle=ie,GN(d,_,de&&lC(l,N,q)),d.beginPath();let xe=!!u.pathSegment(d,I),ke;if(de){xe?d.closePath():bD(d,r,q,l);let Ae=!!r.pathSegment(d,O,{move:xe,reverse:!0});ke=xe&&Ae,ke||bD(d,r,N,l)}d.closePath(),d.fill(ke?"evenodd":"nonzero"),d.restore()}}function GN(d,s,u){let{top:r,bottom:l}=s.chart.chartArea,{property:t,start:_,end:C}=u||{};t==="x"&&(d.beginPath(),d.rect(_,r,C-_,l-r),d.clip())}function bD(d,s,u,r){let l=s.interpolate(u,r);l&&d.lineTo(l.x,l.y)}var qN={id:"filler",afterDatasetsUpdate(d,s,u){let r=(d.data.datasets||[]).length,l=[],t,_,C,I;for(_=0;_<r;++_)t=d.getDatasetMeta(_),C=t.dataset,I=null,C&&C.options&&C instanceof wy&&(I={visible:d.isDatasetVisible(_),index:_,fill:DN(C,_,r),chart:d,axis:t.controller.options.indexAxis,scale:t.vScale,line:C}),t.$filler=I,l.push(I);for(_=0;_<r;++_)I=l[_],!(!I||I.fill===!1)&&(I.fill=EN(l,_,u.propagate))},beforeDraw(d,s,u){let r=u.drawTime==="beforeDraw",l=d.getSortedVisibleDatasetMetas(),t=d.chartArea;for(let _=l.length-1;_>=0;--_){let C=l[_].$filler;C&&(C.line.updateControlPoints(t,C.axis),r&&C.fill&&$w(d.ctx,C,t))}},beforeDatasetsDraw(d,s,u){if(u.drawTime!=="beforeDatasetsDraw")return;let r=d.getSortedVisibleDatasetMetas();for(let l=r.length-1;l>=0;--l){let t=r[l].$filler;fD(t)&&$w(d.ctx,t,d.chartArea)}},beforeDatasetDraw(d,s,u){let r=s.meta.$filler;!fD(r)||u.drawTime!=="beforeDatasetDraw"||$w(d.ctx,r,d.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},yD=(d,s)=>{let{boxHeight:u=s,boxWidth:r=s}=d;return d.usePointStyle&&(u=Math.min(u,s),r=d.pointStyleWidth||Math.min(r,s)),{boxWidth:r,boxHeight:u,itemHeight:Math.max(s,u)}},$N=(d,s)=>d!==null&&s!==null&&d.datasetIndex===s.datasetIndex&&d.index===s.index,xy=class extends ks{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,u,r){this.maxWidth=s,this.maxHeight=u,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let s=this.options.labels||{},u=Yn(s.generateLabels,[this.chart],this)||[];s.filter&&(u=u.filter(r=>s.filter(r,this.chart.data))),s.sort&&(u=u.sort((r,l)=>s.sort(r,l,this.chart.data))),this.options.reverse&&u.reverse(),this.legendItems=u}fit(){let{options:s,ctx:u}=this;if(!s.display){this.width=this.height=0;return}let r=s.labels,l=jr(r.font),t=l.size,_=this._computeTitleHeight(),{boxWidth:C,itemHeight:I}=yD(r,t),O,N;u.font=l.string,this.isHorizontal()?(O=this.maxWidth,N=this._fitRows(_,t,C,I)+10):(N=this.maxHeight,O=this._fitCols(_,l,C,I)+10),this.width=Math.min(O,s.maxWidth||this.maxWidth),this.height=Math.min(N,s.maxHeight||this.maxHeight)}_fitRows(s,u,r,l){let{ctx:t,maxWidth:_,options:{labels:{padding:C}}}=this,I=this.legendHitBoxes=[],O=this.lineWidths=[0],N=l+C,q=s;t.textAlign="left",t.textBaseline="middle";let ie=-1,de=-N;return this.legendItems.forEach((xe,ke)=>{let Ae=r+u/2+t.measureText(xe.text).width;(ke===0||O[O.length-1]+Ae+2*C>_)&&(q+=N,O[O.length-(ke>0?0:1)]=0,de+=N,ie++),I[ke]={left:0,top:de,row:ie,width:Ae,height:l},O[O.length-1]+=Ae+C}),q}_fitCols(s,u,r,l){let{ctx:t,maxHeight:_,options:{labels:{padding:C}}}=this,I=this.legendHitBoxes=[],O=this.columnSizes=[],N=_-s,q=C,ie=0,de=0,xe=0,ke=0;return this.legendItems.forEach((Ae,Xe)=>{let{itemWidth:qe,itemHeight:ut}=YN(r,u,t,Ae,l);Xe>0&&de+ut+2*C>N&&(q+=ie+C,O.push({width:ie,height:de}),xe+=ie+C,ke++,ie=de=0),I[Xe]={left:xe,top:de,col:ke,width:qe,height:ut},ie=Math.max(ie,qe),de+=ut+C}),q+=ie,O.push({width:ie,height:de}),q}adjustHitBoxes(){if(!this.options.display)return;let s=this._computeTitleHeight(),{legendHitBoxes:u,options:{align:r,labels:{padding:l},rtl:t}}=this,_=eu(t,this.left,this.width);if(this.isHorizontal()){let C=0,I=po(r,this.left+l,this.right-this.lineWidths[C]);for(let O of u)C!==O.row&&(C=O.row,I=po(r,this.left+l,this.right-this.lineWidths[C])),O.top+=this.top+s+l,O.left=_.leftForLtr(_.x(I),O.width),I+=O.width+l}else{let C=0,I=po(r,this.top+s+l,this.bottom-this.columnSizes[C].height);for(let O of u)O.col!==C&&(C=O.col,I=po(r,this.top+s+l,this.bottom-this.columnSizes[C].height)),O.top=I,O.left+=this.left+l,O.left=_.leftForLtr(_.x(O.left),O.width),I+=O.height+l}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let s=this.ctx;Dg(s,this),this._draw(),Ag(s)}}_draw(){let{options:s,columnSizes:u,lineWidths:r,ctx:l}=this,{align:t,labels:_}=s,C=vr.color,I=eu(s.rtl,this.left,this.width),O=jr(_.font),{padding:N}=_,q=O.size,ie=q/2,de;this.drawTitle(),l.textAlign=I.textAlign("left"),l.textBaseline="middle",l.lineWidth=.5,l.font=O.string;let{boxWidth:xe,boxHeight:ke,itemHeight:Ae}=yD(_,q),Xe=function(Et,Ht,Ct){if(isNaN(xe)||xe<=0||isNaN(ke)||ke<0)return;l.save();let Yt=Yi(Ct.lineWidth,1);if(l.fillStyle=Yi(Ct.fillStyle,C),l.lineCap=Yi(Ct.lineCap,"butt"),l.lineDashOffset=Yi(Ct.lineDashOffset,0),l.lineJoin=Yi(Ct.lineJoin,"miter"),l.lineWidth=Yt,l.strokeStyle=Yi(Ct.strokeStyle,C),l.setLineDash(Yi(Ct.lineDash,[])),_.usePointStyle){let zt={radius:ke*Math.SQRT2/2,pointStyle:Ct.pointStyle,rotation:Ct.rotation,borderWidth:Yt},Ii=I.xPlus(Et,xe/2),Hi=Ht+ie;Iw(l,zt,Ii,Hi,_.pointStyleWidth&&xe)}else{let zt=Ht+Math.max((q-ke)/2,0),Ii=I.leftForLtr(Et,xe),Hi=kd(Ct.borderRadius);l.beginPath(),Object.values(Hi).some(cr=>cr!==0)?ip(l,{x:Ii,y:zt,w:xe,h:ke,radius:Hi}):l.rect(Ii,zt,xe,ke),l.fill(),Yt!==0&&l.stroke()}l.restore()},qe=function(Et,Ht,Ct){Md(l,Ct.text,Et,Ht+Ae/2,O,{strikethrough:Ct.hidden,textAlign:I.textAlign(Ct.textAlign)})},ut=this.isHorizontal(),It=this._computeTitleHeight();ut?de={x:po(t,this.left+N,this.right-r[0]),y:this.top+N+It,line:0}:de={x:this.left+N,y:po(t,this.top+It+N,this.bottom-u[0].height),line:0},Lw(this.ctx,s.textDirection);let wt=Ae+N;this.legendItems.forEach((Et,Ht)=>{l.strokeStyle=Et.fontColor,l.fillStyle=Et.fontColor;let Ct=l.measureText(Et.text).width,Yt=I.textAlign(Et.textAlign||(Et.textAlign=_.textAlign)),zt=xe+ie+Ct,Ii=de.x,Hi=de.y;I.setWidth(this.width),ut?Ht>0&&Ii+zt+N>this.right&&(Hi=de.y+=wt,de.line++,Ii=de.x=po(t,this.left+N,this.right-r[de.line])):Ht>0&&Hi+wt>this.bottom&&(Ii=de.x=Ii+u[de.line].width+N,de.line++,Hi=de.y=po(t,this.top+It+N,this.bottom-u[de.line].height));let cr=I.x(Ii);if(Xe(cr,Hi,Et),Ii=bE(Yt,Ii+xe+ie,ut?Ii+zt:this.right,s.rtl),qe(I.x(Ii),Hi,Et),ut)de.x+=zt+N;else if(typeof Et.text!="string"){let wi=O.lineHeight;de.y+=eA(Et,wi)+N}else de.y+=wt}),Fw(this.ctx,s.textDirection)}drawTitle(){let s=this.options,u=s.title,r=jr(u.font),l=fo(u.padding);if(!u.display)return;let t=eu(s.rtl,this.left,this.width),_=this.ctx,C=u.position,I=r.size/2,O=l.top+I,N,q=this.left,ie=this.width;if(this.isHorizontal())ie=Math.max(...this.lineWidths),N=this.top+O,q=po(s.align,q,this.right-ie);else{let xe=this.columnSizes.reduce((ke,Ae)=>Math.max(ke,Ae.height),0);N=O+po(s.align,this.top,this.bottom-xe-s.labels.padding-this._computeTitleHeight())}let de=po(C,q,q+ie);_.textAlign=t.textAlign(Jb(C)),_.textBaseline="middle",_.strokeStyle=u.color,_.fillStyle=u.color,_.font=r.string,Md(_,u.text,de,N,r)}_computeTitleHeight(){let s=this.options.title,u=jr(s.font),r=fo(s.padding);return s.display?u.lineHeight+r.height:0}_getLegendItemAt(s,u){let r,l,t;if(nl(s,this.left,this.right)&&nl(u,this.top,this.bottom)){for(t=this.legendHitBoxes,r=0;r<t.length;++r)if(l=t[r],nl(s,l.left,l.left+l.width)&&nl(u,l.top,l.top+l.height))return this.legendItems[r]}return null}handleEvent(s){let u=this.options;if(!QN(s.type,u))return;let r=this._getLegendItemAt(s.x,s.y);if(s.type==="mousemove"||s.type==="mouseout"){let l=this._hoveredItem,t=$N(l,r);l&&!t&&Yn(u.onLeave,[s,l,this],this),this._hoveredItem=r,r&&!t&&Yn(u.onHover,[s,r,this],this)}else r&&Yn(u.onClick,[s,r,this],this)}};function YN(d,s,u,r,l){let t=ZN(r,d,s,u),_=XN(l,r,s.lineHeight);return{itemWidth:t,itemHeight:_}}function ZN(d,s,u,r){let l=d.text;return l&&typeof l!="string"&&(l=l.reduce((t,_)=>t.length>_.length?t:_)),s+u.size/2+r.measureText(l).width}function XN(d,s,u){let r=d;return typeof s.text!="string"&&(r=eA(s,u)),r}function eA(d,s){let u=d.text?d.text.length:0;return s*u}function QN(d,s){return!!((d==="mousemove"||d==="mouseout")&&(s.onHover||s.onLeave)||s.onClick&&(d==="click"||d==="mouseup"))}var KN={id:"legend",_element:xy,start(d,s,u){let r=d.legend=new xy({ctx:d.ctx,options:u,chart:d});Do.configure(d,r,u),Do.addBox(d,r)},stop(d){Do.removeBox(d,d.legend),delete d.legend},beforeUpdate(d,s,u){let r=d.legend;Do.configure(d,r,u),r.options=u},afterUpdate(d){let s=d.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(d,s){s.replay||d.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(d,s,u){let r=s.datasetIndex,l=u.chart;l.isDatasetVisible(r)?(l.hide(r),s.hidden=!0):(l.show(r),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:d=>d.chart.options.color,boxWidth:40,padding:10,generateLabels(d){let s=d.data.datasets,{labels:{usePointStyle:u,pointStyle:r,textAlign:l,color:t,useBorderRadius:_,borderRadius:C}}=d.legend.options;return d._getSortedDatasetMetas().map(I=>{let O=I.controller.getStyle(u?0:void 0),N=fo(O.borderWidth);return{text:s[I.index].label,fillStyle:O.backgroundColor,fontColor:t,hidden:!I.visible,lineCap:O.borderCapStyle,lineDash:O.borderDash,lineDashOffset:O.borderDashOffset,lineJoin:O.borderJoinStyle,lineWidth:(N.width+N.height)/4,strokeStyle:O.borderColor,pointStyle:r||O.pointStyle,rotation:O.rotation,textAlign:l||O.textAlign,borderRadius:_&&(C||O.borderRadius),datasetIndex:I.index}},this)}},title:{color:d=>d.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:d=>!d.startsWith("on"),labels:{_scriptable:d=>!["generateLabels","filter","sort"].includes(d)}}},Vg=class extends ks{constructor(s){super(),this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,u){let r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=s,this.height=this.bottom=u;let l=nr(r.text)?r.text.length:1;this._padding=fo(r.padding);let t=l*jr(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=t:this.width=t}isHorizontal(){let s=this.options.position;return s==="top"||s==="bottom"}_drawArgs(s){let{top:u,left:r,bottom:l,right:t,options:_}=this,C=_.align,I=0,O,N,q;return this.isHorizontal()?(N=po(C,r,t),q=u+s,O=t-r):(_.position==="left"?(N=r+s,q=po(C,l,u),I=rr*-.5):(N=t-s,q=po(C,u,l),I=rr*.5),O=l-u),{titleX:N,titleY:q,maxWidth:O,rotation:I}}draw(){let s=this.ctx,u=this.options;if(!u.display)return;let r=jr(u.font),t=r.lineHeight/2+this._padding.top,{titleX:_,titleY:C,maxWidth:I,rotation:O}=this._drawArgs(t);Md(s,u.text,0,0,r,{color:u.color,maxWidth:I,rotation:O,textAlign:Jb(u.align),textBaseline:"middle",translation:[_,C]})}};function JN(d,s){let u=new Vg({ctx:d.ctx,options:s,chart:d});Do.configure(d,u,s),Do.addBox(d,u),d.titleBlock=u}var eV={id:"title",_element:Vg,start(d,s,u){JN(d,u)},stop(d){let s=d.titleBlock;Do.removeBox(d,s),delete d.titleBlock},beforeUpdate(d,s,u){let r=d.titleBlock;Do.configure(d,r,u),r.options=u},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},hy=new WeakMap,tV={id:"subtitle",start(d,s,u){let r=new Vg({ctx:d.ctx,options:u,chart:d});Do.configure(d,r,u),Do.addBox(d,r),hy.set(d,r)},stop(d){Do.removeBox(d,hy.get(d)),hy.delete(d)},beforeUpdate(d,s,u){let r=hy.get(d);Do.configure(d,r,u),r.options=u},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Bg={average(d){if(!d.length)return!1;let s,u,r=new Set,l=0,t=0;for(s=0,u=d.length;s<u;++s){let C=d[s].element;if(C&&C.hasValue()){let I=C.tooltipPosition();r.add(I.x),l+=I.y,++t}}return{x:[...r].reduce((C,I)=>C+I)/r.size,y:l/t}},nearest(d,s){if(!d.length)return!1;let u=s.x,r=s.y,l=Number.POSITIVE_INFINITY,t,_,C;for(t=0,_=d.length;t<_;++t){let I=d[t].element;if(I&&I.hasValue()){let O=I.getCenterPoint(),N=Yb(s,O);N<l&&(l=N,C=I)}}if(C){let I=C.tooltipPosition();u=I.x,r=I.y}return{x:u,y:r}}};function rl(d,s){return s&&(nr(s)?Array.prototype.push.apply(d,s):d.push(s)),d}function Jl(d){return(typeof d=="string"||d instanceof String)&&d.indexOf(`
`)>-1?d.split(`
`):d}function iV(d,s){let{element:u,datasetIndex:r,index:l}=s,t=d.getDatasetMeta(r).controller,{label:_,value:C}=t.getLabelAndValue(l);return{chart:d,label:_,parsed:t.getParsed(l),raw:d.data.datasets[r].data[l],formattedValue:C,dataset:t.getDataset(),dataIndex:l,datasetIndex:r,element:u}}function vD(d,s){let u=d.chart.ctx,{body:r,footer:l,title:t}=d,{boxWidth:_,boxHeight:C}=s,I=jr(s.bodyFont),O=jr(s.titleFont),N=jr(s.footerFont),q=t.length,ie=l.length,de=r.length,xe=fo(s.padding),ke=xe.height,Ae=0,Xe=r.reduce((It,wt)=>It+wt.before.length+wt.lines.length+wt.after.length,0);if(Xe+=d.beforeBody.length+d.afterBody.length,q&&(ke+=q*O.lineHeight+(q-1)*s.titleSpacing+s.titleMarginBottom),Xe){let It=s.displayColors?Math.max(C,I.lineHeight):I.lineHeight;ke+=de*It+(Xe-de)*I.lineHeight+(Xe-1)*s.bodySpacing}ie&&(ke+=s.footerMarginTop+ie*N.lineHeight+(ie-1)*s.footerSpacing);let qe=0,ut=function(It){Ae=Math.max(Ae,u.measureText(It).width+qe)};return u.save(),u.font=O.string,Bn(d.title,ut),u.font=I.string,Bn(d.beforeBody.concat(d.afterBody),ut),qe=s.displayColors?_+2+s.boxPadding:0,Bn(r,It=>{Bn(It.before,ut),Bn(It.lines,ut),Bn(It.after,ut)}),qe=0,u.font=N.string,Bn(d.footer,ut),u.restore(),Ae+=xe.width,{width:Ae,height:ke}}function nV(d,s){let{y:u,height:r}=s;return u<r/2?"top":u>d.height-r/2?"bottom":"center"}function rV(d,s,u,r){let{x:l,width:t}=r,_=u.caretSize+u.caretPadding;if(d==="left"&&l+t+_>s.width||d==="right"&&l-t-_<0)return!0}function oV(d,s,u,r){let{x:l,width:t}=u,{width:_,chartArea:{left:C,right:I}}=d,O="center";return r==="center"?O=l<=(C+I)/2?"left":"right":l<=t/2?O="left":l>=_-t/2&&(O="right"),rV(O,d,s,u)&&(O="center"),O}function xD(d,s,u){let r=u.yAlign||s.yAlign||nV(d,u);return{xAlign:u.xAlign||s.xAlign||oV(d,s,u,r),yAlign:r}}function aV(d,s){let{x:u,width:r}=d;return s==="right"?u-=r:s==="center"&&(u-=r/2),u}function sV(d,s,u){let{y:r,height:l}=d;return s==="top"?r+=u:s==="bottom"?r-=l+u:r-=l/2,r}function wD(d,s,u,r){let{caretSize:l,caretPadding:t,cornerRadius:_}=d,{xAlign:C,yAlign:I}=u,O=l+t,{topLeft:N,topRight:q,bottomLeft:ie,bottomRight:de}=kd(_),xe=aV(s,C),ke=sV(s,I,O);return I==="center"?C==="left"?xe+=O:C==="right"&&(xe-=O):C==="left"?xe-=Math.max(N,ie)+l:C==="right"&&(xe+=Math.max(q,de)+l),{x:Xr(xe,0,r.width-s.width),y:Xr(ke,0,r.height-s.height)}}function uy(d,s,u){let r=fo(u.padding);return s==="center"?d.x+d.width/2:s==="right"?d.x+d.width-r.right:d.x+r.left}function CD(d){return rl([],Jl(d))}function lV(d,s,u){return Ql(d,{tooltip:s,tooltipItems:u,type:"tooltip"})}function SD(d,s){let u=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return u?d.override(u):d}var tA={beforeTitle:il,title(d){if(d.length>0){let s=d[0],u=s.chart.data.labels,r=u?u.length:0;if(this&&this.options&&this.options.mode==="dataset")return s.dataset.label||"";if(s.label)return s.label;if(r>0&&s.dataIndex<r)return u[s.dataIndex]}return""},afterTitle:il,beforeBody:il,beforeLabel:il,label(d){if(this&&this.options&&this.options.mode==="dataset")return d.label+": "+d.formattedValue||d.formattedValue;let s=d.dataset.label||"";s&&(s+=": ");let u=d.formattedValue;return vn(u)||(s+=u),s},labelColor(d){let u=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{borderColor:u.borderColor,backgroundColor:u.backgroundColor,borderWidth:u.borderWidth,borderDash:u.borderDash,borderDashOffset:u.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(d){let u=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{pointStyle:u.pointStyle,rotation:u.rotation}},afterLabel:il,afterBody:il,beforeFooter:il,footer:il,afterFooter:il};function ra(d,s,u,r){let l=d[s].call(u,r);return typeof l>"u"?tA[s].call(u,r):l}var MD=(()=>{class d extends ks{static positioners=Bg;constructor(u){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=u.chart,this.options=u.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(u){this.options=u,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let u=this._cachedAnimations;if(u)return u;let r=this.chart,l=this.options.setContext(this.getContext()),t=l.enabled&&r.options.animation&&l.animations,_=new gy(this.chart,t);return t._cacheable&&(this._cachedAnimations=Object.freeze(_)),_}getContext(){return this.$context||(this.$context=lV(this.chart.getContext(),this,this._tooltipItems))}getTitle(u,r){let{callbacks:l}=r,t=ra(l,"beforeTitle",this,u),_=ra(l,"title",this,u),C=ra(l,"afterTitle",this,u),I=[];return I=rl(I,Jl(t)),I=rl(I,Jl(_)),I=rl(I,Jl(C)),I}getBeforeBody(u,r){return CD(ra(r.callbacks,"beforeBody",this,u))}getBody(u,r){let{callbacks:l}=r,t=[];return Bn(u,_=>{let C={before:[],lines:[],after:[]},I=SD(l,_);rl(C.before,Jl(ra(I,"beforeLabel",this,_))),rl(C.lines,ra(I,"label",this,_)),rl(C.after,Jl(ra(I,"afterLabel",this,_))),t.push(C)}),t}getAfterBody(u,r){return CD(ra(r.callbacks,"afterBody",this,u))}getFooter(u,r){let{callbacks:l}=r,t=ra(l,"beforeFooter",this,u),_=ra(l,"footer",this,u),C=ra(l,"afterFooter",this,u),I=[];return I=rl(I,Jl(t)),I=rl(I,Jl(_)),I=rl(I,Jl(C)),I}_createItems(u){let r=this._active,l=this.chart.data,t=[],_=[],C=[],I=[],O,N;for(O=0,N=r.length;O<N;++O)I.push(iV(this.chart,r[O]));return u.filter&&(I=I.filter((q,ie,de)=>u.filter(q,ie,de,l))),u.itemSort&&(I=I.sort((q,ie)=>u.itemSort(q,ie,l))),Bn(I,q=>{let ie=SD(u.callbacks,q);t.push(ra(ie,"labelColor",this,q)),_.push(ra(ie,"labelPointStyle",this,q)),C.push(ra(ie,"labelTextColor",this,q))}),this.labelColors=t,this.labelPointStyles=_,this.labelTextColors=C,this.dataPoints=I,I}update(u,r){let l=this.options.setContext(this.getContext()),t=this._active,_,C=[];if(!t.length)this.opacity!==0&&(_={opacity:0});else{let I=Bg[l.position].call(this,t,this._eventPosition);C=this._createItems(l),this.title=this.getTitle(C,l),this.beforeBody=this.getBeforeBody(C,l),this.body=this.getBody(C,l),this.afterBody=this.getAfterBody(C,l),this.footer=this.getFooter(C,l);let O=this._size=vD(this,l),N=Object.assign({},I,O),q=xD(this.chart,l,N),ie=wD(l,N,q,this.chart);this.xAlign=q.xAlign,this.yAlign=q.yAlign,_={opacity:1,x:ie.x,y:ie.y,width:O.width,height:O.height,caretX:I.x,caretY:I.y}}this._tooltipItems=C,this.$context=void 0,_&&this._resolveAnimations().update(this,_),u&&l.external&&l.external.call(this,{chart:this.chart,tooltip:this,replay:r})}drawCaret(u,r,l,t){let _=this.getCaretPosition(u,l,t);r.lineTo(_.x1,_.y1),r.lineTo(_.x2,_.y2),r.lineTo(_.x3,_.y3)}getCaretPosition(u,r,l){let{xAlign:t,yAlign:_}=this,{caretSize:C,cornerRadius:I}=l,{topLeft:O,topRight:N,bottomLeft:q,bottomRight:ie}=kd(I),{x:de,y:xe}=u,{width:ke,height:Ae}=r,Xe,qe,ut,It,wt,Et;return _==="center"?(wt=xe+Ae/2,t==="left"?(Xe=de,qe=Xe-C,It=wt+C,Et=wt-C):(Xe=de+ke,qe=Xe+C,It=wt-C,Et=wt+C),ut=Xe):(t==="left"?qe=de+Math.max(O,q)+C:t==="right"?qe=de+ke-Math.max(N,ie)-C:qe=this.caretX,_==="top"?(It=xe,wt=It-C,Xe=qe-C,ut=qe+C):(It=xe+Ae,wt=It+C,Xe=qe+C,ut=qe-C),Et=It),{x1:Xe,x2:qe,x3:ut,y1:It,y2:wt,y3:Et}}drawTitle(u,r,l){let t=this.title,_=t.length,C,I,O;if(_){let N=eu(l.rtl,this.x,this.width);for(u.x=uy(this,l.titleAlign,l),r.textAlign=N.textAlign(l.titleAlign),r.textBaseline="middle",C=jr(l.titleFont),I=l.titleSpacing,r.fillStyle=l.titleColor,r.font=C.string,O=0;O<_;++O)r.fillText(t[O],N.x(u.x),u.y+C.lineHeight/2),u.y+=C.lineHeight+I,O+1===_&&(u.y+=l.titleMarginBottom-I)}}_drawColorBox(u,r,l,t,_){let C=this.labelColors[l],I=this.labelPointStyles[l],{boxHeight:O,boxWidth:N}=_,q=jr(_.bodyFont),ie=uy(this,"left",_),de=t.x(ie),xe=O<q.lineHeight?(q.lineHeight-O)/2:0,ke=r.y+xe;if(_.usePointStyle){let Ae={radius:Math.min(N,O)/2,pointStyle:I.pointStyle,rotation:I.rotation,borderWidth:1},Xe=t.leftForLtr(de,N)+N/2,qe=ke+O/2;u.strokeStyle=_.multiKeyBackground,u.fillStyle=_.multiKeyBackground,ty(u,Ae,Xe,qe),u.strokeStyle=C.borderColor,u.fillStyle=C.backgroundColor,ty(u,Ae,Xe,qe)}else{u.lineWidth=cn(C.borderWidth)?Math.max(...Object.values(C.borderWidth)):C.borderWidth||1,u.strokeStyle=C.borderColor,u.setLineDash(C.borderDash||[]),u.lineDashOffset=C.borderDashOffset||0;let Ae=t.leftForLtr(de,N),Xe=t.leftForLtr(t.xPlus(de,1),N-2),qe=kd(C.borderRadius);Object.values(qe).some(ut=>ut!==0)?(u.beginPath(),u.fillStyle=_.multiKeyBackground,ip(u,{x:Ae,y:ke,w:N,h:O,radius:qe}),u.fill(),u.stroke(),u.fillStyle=C.backgroundColor,u.beginPath(),ip(u,{x:Xe,y:ke+1,w:N-2,h:O-2,radius:qe}),u.fill()):(u.fillStyle=_.multiKeyBackground,u.fillRect(Ae,ke,N,O),u.strokeRect(Ae,ke,N,O),u.fillStyle=C.backgroundColor,u.fillRect(Xe,ke+1,N-2,O-2))}u.fillStyle=this.labelTextColors[l]}drawBody(u,r,l){let{body:t}=this,{bodySpacing:_,bodyAlign:C,displayColors:I,boxHeight:O,boxWidth:N,boxPadding:q}=l,ie=jr(l.bodyFont),de=ie.lineHeight,xe=0,ke=eu(l.rtl,this.x,this.width),Ae=function(Yt){r.fillText(Yt,ke.x(u.x+xe),u.y+de/2),u.y+=de+_},Xe=ke.textAlign(C),qe,ut,It,wt,Et,Ht,Ct;for(r.textAlign=C,r.textBaseline="middle",r.font=ie.string,u.x=uy(this,Xe,l),r.fillStyle=l.bodyColor,Bn(this.beforeBody,Ae),xe=I&&Xe!=="right"?C==="center"?N/2+q:N+2+q:0,wt=0,Ht=t.length;wt<Ht;++wt){for(qe=t[wt],ut=this.labelTextColors[wt],r.fillStyle=ut,Bn(qe.before,Ae),It=qe.lines,I&&It.length&&(this._drawColorBox(r,u,wt,ke,l),de=Math.max(ie.lineHeight,O)),Et=0,Ct=It.length;Et<Ct;++Et)Ae(It[Et]),de=ie.lineHeight;Bn(qe.after,Ae)}xe=0,de=ie.lineHeight,Bn(this.afterBody,Ae),u.y-=_}drawFooter(u,r,l){let t=this.footer,_=t.length,C,I;if(_){let O=eu(l.rtl,this.x,this.width);for(u.x=uy(this,l.footerAlign,l),u.y+=l.footerMarginTop,r.textAlign=O.textAlign(l.footerAlign),r.textBaseline="middle",C=jr(l.footerFont),r.fillStyle=l.footerColor,r.font=C.string,I=0;I<_;++I)r.fillText(t[I],O.x(u.x),u.y+C.lineHeight/2),u.y+=C.lineHeight+l.footerSpacing}}drawBackground(u,r,l,t){let{xAlign:_,yAlign:C}=this,{x:I,y:O}=u,{width:N,height:q}=l,{topLeft:ie,topRight:de,bottomLeft:xe,bottomRight:ke}=kd(t.cornerRadius);r.fillStyle=t.backgroundColor,r.strokeStyle=t.borderColor,r.lineWidth=t.borderWidth,r.beginPath(),r.moveTo(I+ie,O),C==="top"&&this.drawCaret(u,r,l,t),r.lineTo(I+N-de,O),r.quadraticCurveTo(I+N,O,I+N,O+de),C==="center"&&_==="right"&&this.drawCaret(u,r,l,t),r.lineTo(I+N,O+q-ke),r.quadraticCurveTo(I+N,O+q,I+N-ke,O+q),C==="bottom"&&this.drawCaret(u,r,l,t),r.lineTo(I+xe,O+q),r.quadraticCurveTo(I,O+q,I,O+q-xe),C==="center"&&_==="left"&&this.drawCaret(u,r,l,t),r.lineTo(I,O+ie),r.quadraticCurveTo(I,O,I+ie,O),r.closePath(),r.fill(),t.borderWidth>0&&r.stroke()}_updateAnimationTarget(u){let r=this.chart,l=this.$animations,t=l&&l.x,_=l&&l.y;if(t||_){let C=Bg[u.position].call(this,this._active,this._eventPosition);if(!C)return;let I=this._size=vD(this,u),O=Object.assign({},C,this._size),N=xD(r,u,O),q=wD(u,O,N,r);(t._to!==q.x||_._to!==q.y)&&(this.xAlign=N.xAlign,this.yAlign=N.yAlign,this.width=I.width,this.height=I.height,this.caretX=C.x,this.caretY=C.y,this._resolveAnimations().update(this,q))}}_willRender(){return!!this.opacity}draw(u){let r=this.options.setContext(this.getContext()),l=this.opacity;if(!l)return;this._updateAnimationTarget(r);let t={width:this.width,height:this.height},_={x:this.x,y:this.y};l=Math.abs(l)<.001?0:l;let C=fo(r.padding),I=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;r.enabled&&I&&(u.save(),u.globalAlpha=l,this.drawBackground(_,u,t,r),Lw(u,r.textDirection),_.y+=C.top,this.drawTitle(_,u,r),this.drawBody(_,u,r),this.drawFooter(_,u,r),Fw(u,r.textDirection),u.restore())}getActiveElements(){return this._active||[]}setActiveElements(u,r){let l=this._active,t=u.map(({datasetIndex:I,index:O})=>{let N=this.chart.getDatasetMeta(I);if(!N)throw new Error("Cannot find a dataset at index "+I);return{datasetIndex:I,element:N.data[O],index:O}}),_=!Tg(l,t),C=this._positionChanged(t,r);(_||C)&&(this._active=t,this._eventPosition=r,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(u,r,l=!0){if(r&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let t=this.options,_=this._active||[],C=this._getActiveElements(u,_,r,l),I=this._positionChanged(C,u),O=r||!Tg(C,_)||I;return O&&(this._active=C,(t.enabled||t.external)&&(this._eventPosition={x:u.x,y:u.y},this.update(!0,r))),O}_getActiveElements(u,r,l,t){let _=this.options;if(u.type==="mouseout")return[];if(!t)return r.filter(I=>this.chart.data.datasets[I.datasetIndex]&&this.chart.getDatasetMeta(I.datasetIndex).controller.getParsed(I.index)!==void 0);let C=this.chart.getElementsAtEventForMode(u,_.mode,_,l);return _.reverse&&C.reverse(),C}_positionChanged(u,r){let{caretX:l,caretY:t,options:_}=this,C=Bg[_.position].call(this,u,r);return C!==!1&&(l!==C.x||t!==C.y)}}return d})(),cV={id:"tooltip",_element:MD,positioners:Bg,afterInit(d,s,u){u&&(d.tooltip=new MD({chart:d,options:u}))},beforeUpdate(d,s,u){d.tooltip&&d.tooltip.initialize(u)},reset(d,s,u){d.tooltip&&d.tooltip.initialize(u)},afterDraw(d){let s=d.tooltip;if(s&&s._willRender()){let u={tooltip:s};if(d.notifyPlugins("beforeTooltipDraw",ja(Ji({},u),{cancelable:!0}))===!1)return;s.draw(d.ctx),d.notifyPlugins("afterTooltipDraw",u)}},afterEvent(d,s){if(d.tooltip){let u=s.replay;d.tooltip.handleEvent(s.event,u,s.inChartArea)&&(s.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(d,s)=>s.bodyFont.size,boxWidth:(d,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:tA},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:d=>d!=="filter"&&d!=="itemSort"&&d!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},dV=Object.freeze({__proto__:null,Colors:wN,Decimation:kN,Filler:qN,Legend:KN,SubTitle:tV,Title:eV,Tooltip:cV}),hV=(d,s,u,r)=>(typeof s=="string"?(u=d.push(s)-1,r.unshift({index:u,label:s})):isNaN(s)&&(u=null),u);function uV(d,s,u,r){let l=d.indexOf(s);if(l===-1)return hV(d,s,u,r);let t=d.lastIndexOf(s);return l!==t?u:l}var mV=(d,s)=>d===null?null:Xr(Math.round(d),0,s);function kD(d){let s=this.getLabels();return d>=0&&d<s.length?s[d]:d}var pV=(()=>{class d extends nu{static id="category";static defaults={ticks:{callback:kD}};constructor(u){super(u),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(u){let r=this._addedLabels;if(r.length){let l=this.getLabels();for(let{index:t,label:_}of r)l[t]===_&&l.splice(t,1);this._addedLabels=[]}super.init(u)}parse(u,r){if(vn(u))return null;let l=this.getLabels();return r=isFinite(r)&&l[r]===u?r:uV(l,u,Yi(r,u),this._addedLabels),mV(r,l.length-1)}determineDataLimits(){let{minDefined:u,maxDefined:r}=this.getUserBounds(),{min:l,max:t}=this.getMinMax(!0);this.options.bounds==="ticks"&&(u||(l=0),r||(t=this.getLabels().length-1)),this.min=l,this.max=t}buildTicks(){let u=this.min,r=this.max,l=this.options.offset,t=[],_=this.getLabels();_=u===0&&r===_.length-1?_:_.slice(u,r+1),this._valueRange=Math.max(_.length-(l?0:1),1),this._startValue=this.min-(l?.5:0);for(let C=u;C<=r;C++)t.push({value:C});return t}getLabelForValue(u){return kD.call(this,u)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(u){return typeof u!="number"&&(u=this.parse(u)),u===null?NaN:this.getPixelForDecimal((u-this._startValue)/this._valueRange)}getPixelForTick(u){let r=this.ticks;return u<0||u>r.length-1?null:this.getPixelForValue(r[u].value)}getValueForPixel(u){return Math.round(this._startValue+this.getDecimalForPixel(u)*this._valueRange)}getBasePixel(){return this.bottom}}return d})();function fV(d,s){let u=[],{bounds:l,step:t,min:_,max:C,precision:I,count:O,maxTicks:N,maxDigits:q,includeBounds:ie}=d,de=t||1,xe=N-1,{min:ke,max:Ae}=s,Xe=!vn(_),qe=!vn(C),ut=!vn(O),It=(Ae-ke)/(q+1),wt=pw((Ae-ke)/xe/de)*de,Et,Ht,Ct,Yt;if(wt<1e-14&&!Xe&&!qe)return[{value:ke},{value:Ae}];Yt=Math.ceil(Ae/wt)-Math.floor(ke/wt),Yt>xe&&(wt=pw(Yt*wt/xe/de)*de),vn(I)||(Et=Math.pow(10,I),wt=Math.ceil(wt*Et)/Et),l==="ticks"?(Ht=Math.floor(ke/wt)*wt,Ct=Math.ceil(Ae/wt)*wt):(Ht=ke,Ct=Ae),Xe&&qe&&t&&hE((C-_)/t,wt/1e3)?(Yt=Math.round(Math.min((C-_)/wt,N)),wt=(C-_)/Yt,Ht=_,Ct=C):ut?(Ht=Xe?_:Ht,Ct=qe?C:Ct,Yt=O-1,wt=(Ct-Ht)/Yt):(Yt=(Ct-Ht)/wt,Jm(Yt,Math.round(Yt),wt/1e3)?Yt=Math.round(Yt):Yt=Math.ceil(Yt));let zt=Math.max(gw(wt),gw(Ht));Et=Math.pow(10,vn(I)?zt:I),Ht=Math.round(Ht*Et)/Et,Ct=Math.round(Ct*Et)/Et;let Ii=0;for(Xe&&(ie&&Ht!==_?(u.push({value:_}),Ht<_&&Ii++,Jm(Math.round((Ht+Ii*wt)*Et)/Et,_,ID(_,It,d))&&Ii++):Ht<_&&Ii++);Ii<Yt;++Ii){let Hi=Math.round((Ht+Ii*wt)*Et)/Et;if(qe&&Hi>C)break;u.push({value:Hi})}return qe&&ie&&Ct!==C?u.length&&Jm(u[u.length-1].value,C,ID(C,It,d))?u[u.length-1].value=C:u.push({value:C}):(!qe||Ct===C)&&u.push({value:Ct}),u}function ID(d,s,{horizontal:u,minRotation:r}){let l=Xa(r),t=(u?Math.sin(l):Math.cos(l))||.001,_=.75*s*(""+d).length;return Math.min(s/t,_)}var ap=class extends nu{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,u){return vn(s)||(typeof s=="number"||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){let{beginAtZero:s}=this.options,{minDefined:u,maxDefined:r}=this.getUserBounds(),{min:l,max:t}=this,_=I=>l=u?l:I,C=I=>t=r?t:I;if(s){let I=Ms(l),O=Ms(t);I<0&&O<0?C(0):I>0&&O>0&&_(0)}if(l===t){let I=t===0?1:Math.abs(t*.05);C(t+I),s||_(l-I)}this.min=l,this.max=t}getTickLimit(){let s=this.options.ticks,{maxTicksLimit:u,stepSize:r}=s,l;return r?(l=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,l>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${l} ticks. Limiting to 1000.`),l=1e3)):(l=this.computeTickLimit(),u=u||11),u&&(l=Math.min(u,l)),l}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let s=this.options,u=s.ticks,r=this.getTickLimit();r=Math.max(2,r);let l={maxTicks:r,bounds:s.bounds,min:s.min,max:s.max,precision:u.precision,step:u.stepSize,count:u.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:u.minRotation||0,includeBounds:u.includeBounds!==!1},t=this._range||this,_=fV(l,t);return s.bounds==="ticks"&&fw(_,this,"value"),s.reverse?(_.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),_}configure(){let s=this.ticks,u=this.min,r=this.max;if(super.configure(),this.options.offset&&s.length){let l=(r-u)/Math.max(s.length-1,1)/2;u-=l,r+=l}this._startValue=u,this._endValue=r,this._valueRange=r-u}getLabelForValue(s){return tp(s,this.chart.options.locale,this.options.ticks.format)}},cC=class extends ap{static id="linear";static defaults={ticks:{callback:Eg.formatters.numeric}};determineDataLimits(){let{min:s,max:u}=this.getMinMax(!0);this.min=yr(s)?s:0,this.max=yr(u)?u:1,this.handleTickRangeOptions()}computeTickLimit(){let s=this.isHorizontal(),u=s?this.width:this.height,r=Xa(this.options.ticks.minRotation),l=(s?Math.sin(r):Math.cos(r))||.001,t=this._resolveTickFontOptions(0);return Math.ceil(u/Math.min(40,t.lineHeight/l))}getPixelForValue(s){return s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}},jg=d=>Math.floor(Zl(d)),iu=(d,s)=>Math.pow(10,jg(d)+s);function TD(d){return d/Math.pow(10,jg(d))===1}function ED(d,s,u){let r=Math.pow(10,u),l=Math.floor(d/r);return Math.ceil(s/r)-l}function gV(d,s){let u=s-d,r=jg(u);for(;ED(d,s,r)>10;)r++;for(;ED(d,s,r)<10;)r--;return Math.min(r,jg(d))}function _V(d,{min:s,max:u}){s=na(d.min,s);let r=[],l=jg(s),t=gV(s,u),_=t<0?Math.pow(10,Math.abs(t)):1,C=Math.pow(10,t),I=l>t?Math.pow(10,l):0,O=Math.round((s-I)*_)/_,N=Math.floor((s-I)/C/10)*C*10,q=Math.floor((O-N)/Math.pow(10,t)),ie=na(d.min,Math.round((I+N+q*Math.pow(10,t))*_)/_);for(;ie<u;)r.push({value:ie,major:TD(ie),significand:q}),q>=10?q=q<15?15:20:q++,q>=20&&(t++,q=2,_=t>=0?1:_),ie=Math.round((I+N+q*Math.pow(10,t))*_)/_;let de=na(d.max,ie);return r.push({value:de,major:TD(de),significand:q}),r}var dC=class extends nu{static id="logarithmic";static defaults={ticks:{callback:Eg.formatters.logarithmic,major:{enabled:!0}}};constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(s,u){let r=ap.prototype.parse.apply(this,[s,u]);if(r===0){this._zero=!0;return}return yr(r)&&r>0?r:null}determineDataLimits(){let{min:s,max:u}=this.getMinMax(!0);this.min=yr(s)?Math.max(0,s):null,this.max=yr(u)?Math.max(0,u):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!yr(this._userMin)&&(this.min=s===iu(this.min,0)?iu(this.min,-1):iu(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:s,maxDefined:u}=this.getUserBounds(),r=this.min,l=this.max,t=C=>r=s?r:C,_=C=>l=u?l:C;r===l&&(r<=0?(t(1),_(10)):(t(iu(r,-1)),_(iu(l,1)))),r<=0&&t(iu(l,-1)),l<=0&&_(iu(r,1)),this.min=r,this.max=l}buildTicks(){let s=this.options,u={min:this._userMin,max:this._userMax},r=_V(u,this);return s.bounds==="ticks"&&fw(r,this,"value"),s.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(s){return s===void 0?"0":tp(s,this.chart.options.locale,this.options.ticks.format)}configure(){let s=this.min;super.configure(),this._startValue=Zl(s),this._valueRange=Zl(this.max)-Zl(s)}getPixelForValue(s){return(s===void 0||s===0)&&(s=this.min),s===null||isNaN(s)?NaN:this.getPixelForDecimal(s===this.min?0:(Zl(s)-this._startValue)/this._valueRange)}getValueForPixel(s){let u=this.getDecimalForPixel(s);return Math.pow(10,this._startValue+u*this._valueRange)}};function hC(d){let s=d.ticks;if(s.display&&d.display){let u=fo(s.backdropPadding);return Yi(s.font&&s.font.size,vr.font.size)+u.height}return 0}function bV(d,s,u){return u=nr(u)?u:[u],{w:vE(d,s.string,u),h:u.length*s.lineHeight}}function DD(d,s,u,r,l){return d===r||d===l?{start:s-u/2,end:s+u/2}:d<r||d>l?{start:s-u,end:s}:{start:s,end:s+u}}function yV(d){let s={l:d.left+d._padding.left,r:d.right-d._padding.right,t:d.top+d._padding.top,b:d.bottom-d._padding.bottom},u=Object.assign({},s),r=[],l=[],t=d._pointLabels.length,_=d.options.pointLabels,C=_.centerPointLabels?rr/t:0;for(let I=0;I<t;I++){let O=_.setContext(d.getPointLabelContext(I));l[I]=O.padding;let N=d.getPointPosition(I,d.drawingArea+l[I],C),q=jr(O.font),ie=bV(d.ctx,q,d._pointLabels[I]);r[I]=ie;let de=ia(d.getIndexAngle(I)+C),xe=Math.round(Qb(de)),ke=DD(xe,N.x,ie.w,0,180),Ae=DD(xe,N.y,ie.h,90,270);vV(u,s,de,ke,Ae)}d.setCenterPoint(s.l-u.l,u.r-s.r,s.t-u.t,u.b-s.b),d._pointLabelItems=CV(d,r,l)}function vV(d,s,u,r,l){let t=Math.abs(Math.sin(u)),_=Math.abs(Math.cos(u)),C=0,I=0;r.start<s.l?(C=(s.l-r.start)/t,d.l=Math.min(d.l,s.l-C)):r.end>s.r&&(C=(r.end-s.r)/t,d.r=Math.max(d.r,s.r+C)),l.start<s.t?(I=(s.t-l.start)/_,d.t=Math.min(d.t,s.t-I)):l.end>s.b&&(I=(l.end-s.b)/_,d.b=Math.max(d.b,s.b+I))}function xV(d,s,u){let r=d.drawingArea,{extra:l,additionalAngle:t,padding:_,size:C}=u,I=d.getPointPosition(s,r+l+_,t),O=Math.round(Qb(ia(I.angle+Mr))),N=kV(I.y,C.h,O),q=SV(O),ie=MV(I.x,C.w,q);return{visible:!0,x:I.x,y:N,textAlign:q,left:ie,top:N,right:ie+C.w,bottom:N+C.h}}function wV(d,s){if(!s)return!0;let{left:u,top:r,right:l,bottom:t}=d;return!(tl({x:u,y:r},s)||tl({x:u,y:t},s)||tl({x:l,y:r},s)||tl({x:l,y:t},s))}function CV(d,s,u){let r=[],l=d._pointLabels.length,t=d.options,{centerPointLabels:_,display:C}=t.pointLabels,I={extra:hC(t)/2,additionalAngle:_?rr/l:0},O;for(let N=0;N<l;N++){I.padding=u[N],I.size=s[N];let q=xV(d,N,I);r.push(q),C==="auto"&&(q.visible=wV(q,O),q.visible&&(O=q))}return r}function SV(d){return d===0||d===180?"center":d<180?"left":"right"}function MV(d,s,u){return u==="right"?d-=s:u==="center"&&(d-=s/2),d}function kV(d,s,u){return u===90||u===270?d-=s/2:(u>270||u<90)&&(d-=s),d}function IV(d,s,u){let{left:r,top:l,right:t,bottom:_}=u,{backdropColor:C}=s;if(!vn(C)){let I=kd(s.borderRadius),O=fo(s.backdropPadding);d.fillStyle=C;let N=r-O.left,q=l-O.top,ie=t-r+O.width,de=_-l+O.height;Object.values(I).some(xe=>xe!==0)?(d.beginPath(),ip(d,{x:N,y:q,w:ie,h:de,radius:I}),d.fill()):d.fillRect(N,q,ie,de)}}function TV(d,s){let{ctx:u,options:{pointLabels:r}}=d;for(let l=s-1;l>=0;l--){let t=d._pointLabelItems[l];if(!t.visible)continue;let _=r.setContext(d.getPointLabelContext(l));IV(u,_,t);let C=jr(_.font),{x:I,y:O,textAlign:N}=t;Md(u,d._pointLabels[l],I,O+C.lineHeight/2,C,{color:_.color,textAlign:N,textBaseline:"middle"})}}function iA(d,s,u,r){let{ctx:l}=d;if(u)l.arc(d.xCenter,d.yCenter,s,0,or);else{let t=d.getPointPosition(0,s);l.moveTo(t.x,t.y);for(let _=1;_<r;_++)t=d.getPointPosition(_,s),l.lineTo(t.x,t.y)}}function EV(d,s,u,r,l){let t=d.ctx,_=s.circular,{color:C,lineWidth:I}=s;!_&&!r||!C||!I||u<0||(t.save(),t.strokeStyle=C,t.lineWidth=I,t.setLineDash(l.dash),t.lineDashOffset=l.dashOffset,t.beginPath(),iA(d,u,_,r),t.closePath(),t.stroke(),t.restore())}function DV(d,s,u){return Ql(d,{label:u,index:s,type:"pointLabel"})}var uC=class extends ap{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Eg.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(s){return s},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(s){super(s),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let s=this._padding=fo(hC(this.options)/2),u=this.width=this.maxWidth-s.width,r=this.height=this.maxHeight-s.height;this.xCenter=Math.floor(this.left+u/2+s.left),this.yCenter=Math.floor(this.top+r/2+s.top),this.drawingArea=Math.floor(Math.min(u,r)/2)}determineDataLimits(){let{min:s,max:u}=this.getMinMax(!1);this.min=yr(s)&&!isNaN(s)?s:0,this.max=yr(u)&&!isNaN(u)?u:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/hC(this.options))}generateTickLabels(s){ap.prototype.generateTickLabels.call(this,s),this._pointLabels=this.getLabels().map((u,r)=>{let l=Yn(this.options.pointLabels.callback,[u,r],this);return l||l===0?l:""}).filter((u,r)=>this.chart.getDataVisibility(r))}fit(){let s=this.options;s.display&&s.pointLabels.display?yV(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(s,u,r,l){this.xCenter+=Math.floor((s-u)/2),this.yCenter+=Math.floor((r-l)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(s,u,r,l))}getIndexAngle(s){let u=or/(this._pointLabels.length||1),r=this.options.startAngle||0;return ia(s*u+Xa(r))}getDistanceFromCenterForValue(s){if(vn(s))return NaN;let u=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-s)*u:(s-this.min)*u}getValueForDistanceFromCenter(s){if(vn(s))return NaN;let u=s/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-u:this.min+u}getPointLabelContext(s){let u=this._pointLabels||[];if(s>=0&&s<u.length){let r=u[s];return DV(this.getContext(),s,r)}}getPointPosition(s,u,r=0){let l=this.getIndexAngle(s)-Mr+r;return{x:Math.cos(l)*u+this.xCenter,y:Math.sin(l)*u+this.yCenter,angle:l}}getPointPositionForValue(s,u){return this.getPointPosition(s,this.getDistanceFromCenterForValue(u))}getBasePosition(s){return this.getPointPositionForValue(s||0,this.getBaseValue())}getPointLabelPosition(s){let{left:u,top:r,right:l,bottom:t}=this._pointLabelItems[s];return{left:u,top:r,right:l,bottom:t}}drawBackground(){let{backgroundColor:s,grid:{circular:u}}=this.options;if(s){let r=this.ctx;r.save(),r.beginPath(),iA(this,this.getDistanceFromCenterForValue(this._endValue),u,this._pointLabels.length),r.closePath(),r.fillStyle=s,r.fill(),r.restore()}}drawGrid(){let s=this.ctx,u=this.options,{angleLines:r,grid:l,border:t}=u,_=this._pointLabels.length,C,I,O;if(u.pointLabels.display&&TV(this,_),l.display&&this.ticks.forEach((N,q)=>{if(q!==0||q===0&&this.min<0){I=this.getDistanceFromCenterForValue(N.value);let ie=this.getContext(q),de=l.setContext(ie),xe=t.setContext(ie);EV(this,de,I,_,xe)}}),r.display){for(s.save(),C=_-1;C>=0;C--){let N=r.setContext(this.getPointLabelContext(C)),{color:q,lineWidth:ie}=N;!ie||!q||(s.lineWidth=ie,s.strokeStyle=q,s.setLineDash(N.borderDash),s.lineDashOffset=N.borderDashOffset,I=this.getDistanceFromCenterForValue(u.ticks.reverse?this.min:this.max),O=this.getPointPosition(C,I),s.beginPath(),s.moveTo(this.xCenter,this.yCenter),s.lineTo(O.x,O.y),s.stroke())}s.restore()}}drawBorder(){}drawLabels(){let s=this.ctx,u=this.options,r=u.ticks;if(!r.display)return;let l=this.getIndexAngle(0),t,_;s.save(),s.translate(this.xCenter,this.yCenter),s.rotate(l),s.textAlign="center",s.textBaseline="middle",this.ticks.forEach((C,I)=>{if(I===0&&this.min>=0&&!u.reverse)return;let O=r.setContext(this.getContext(I)),N=jr(O.font);if(t=this.getDistanceFromCenterForValue(this.ticks[I].value),O.showLabelBackdrop){s.font=N.string,_=s.measureText(C.label).width,s.fillStyle=O.backdropColor;let q=fo(O.backdropPadding);s.fillRect(-_/2-q.left,-t-N.size/2-q.top,_+q.width,N.size+q.height)}Md(s,C.label,0,-t,N,{color:O.color,strokeColor:O.textStrokeColor,strokeWidth:O.textStrokeWidth})}),s.restore()}drawTitle(){}},Cy={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},oa=Object.keys(Cy);function AD(d,s){return d-s}function PD(d,s){if(vn(s))return null;let u=d._adapter,{parser:r,round:l,isoWeekday:t}=d._parseOpts,_=s;return typeof r=="function"&&(_=r(_)),yr(_)||(_=typeof r=="string"?u.parse(_,r):u.parse(_)),_===null?null:(l&&(_=l==="week"&&(Jh(t)||t===!0)?u.startOf(_,"isoWeek",t):u.startOf(_,l)),+_)}function OD(d,s,u,r){let l=oa.length;for(let t=oa.indexOf(d);t<l-1;++t){let _=Cy[oa[t]],C=_.steps?_.steps:Number.MAX_SAFE_INTEGER;if(_.common&&Math.ceil((u-s)/(C*_.size))<=r)return oa[t]}return oa[l-1]}function AV(d,s,u,r,l){for(let t=oa.length-1;t>=oa.indexOf(u);t--){let _=oa[t];if(Cy[_].common&&d._adapter.diff(l,r,_)>=s-1)return _}return oa[u?oa.indexOf(u):0]}function PV(d){for(let s=oa.indexOf(d)+1,u=oa.length;s<u;++s)if(Cy[oa[s]].common)return oa[s]}function RD(d,s,u){if(!u)d[s]=!0;else if(u.length){let{lo:r,hi:l}=Kb(u,s),t=u[r]>=s?u[r]:u[l];d[t]=!0}}function OV(d,s,u,r){let l=d._adapter,t=+l.startOf(s[0].value,r),_=s[s.length-1].value,C,I;for(C=t;C<=_;C=+l.add(C,1,r))I=u[C],I>=0&&(s[I].major=!0);return s}function LD(d,s,u){let r=[],l={},t=s.length,_,C;for(_=0;_<t;++_)C=s[_],l[C]=_,r.push({value:C,major:!1});return t===0||!u?r:OV(d,r,l,u)}var mC=(()=>{class d extends nu{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(u){super(u),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(u,r={}){let l=u.time||(u.time={}),t=this._adapter=new G4._date(u.adapters.date);t.init(r),Qm(l.displayFormats,t.formats()),this._parseOpts={parser:l.parser,round:l.round,isoWeekday:l.isoWeekday},super.init(u),this._normalized=r.normalized}parse(u,r){return u===void 0?null:PD(this,u)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let u=this.options,r=this._adapter,l=u.time.unit||"day",{min:t,max:_,minDefined:C,maxDefined:I}=this.getUserBounds();function O(N){!C&&!isNaN(N.min)&&(t=Math.min(t,N.min)),!I&&!isNaN(N.max)&&(_=Math.max(_,N.max))}(!C||!I)&&(O(this._getLabelBounds()),(u.bounds!=="ticks"||u.ticks.source!=="labels")&&O(this.getMinMax(!1))),t=yr(t)&&!isNaN(t)?t:+r.startOf(Date.now(),l),_=yr(_)&&!isNaN(_)?_:+r.endOf(Date.now(),l)+1,this.min=Math.min(t,_-1),this.max=Math.max(t+1,_)}_getLabelBounds(){let u=this.getLabelTimestamps(),r=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return u.length&&(r=u[0],l=u[u.length-1]),{min:r,max:l}}buildTicks(){let u=this.options,r=u.time,l=u.ticks,t=l.source==="labels"?this.getLabelTimestamps():this._generate();u.bounds==="ticks"&&t.length&&(this.min=this._userMin||t[0],this.max=this._userMax||t[t.length-1]);let _=this.min,C=this.max,I=pE(t,_,C);return this._unit=r.unit||(l.autoSkip?OD(r.minUnit,this.min,this.max,this._getLabelCapacity(_)):AV(this,I.length,r.minUnit,this.min,this.max)),this._majorUnit=!l.major.enabled||this._unit==="year"?void 0:PV(this._unit),this.initOffsets(t),u.reverse&&I.reverse(),LD(this,I,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(u=>+u.value))}initOffsets(u=[]){let r=0,l=0,t,_;this.options.offset&&u.length&&(t=this.getDecimalForValue(u[0]),u.length===1?r=1-t:r=(this.getDecimalForValue(u[1])-t)/2,_=this.getDecimalForValue(u[u.length-1]),u.length===1?l=_:l=(_-this.getDecimalForValue(u[u.length-2]))/2);let C=u.length<3?.5:.25;r=Xr(r,0,C),l=Xr(l,0,C),this._offsets={start:r,end:l,factor:1/(r+1+l)}}_generate(){let u=this._adapter,r=this.min,l=this.max,t=this.options,_=t.time,C=_.unit||OD(_.minUnit,r,l,this._getLabelCapacity(r)),I=Yi(t.ticks.stepSize,1),O=C==="week"?_.isoWeekday:!1,N=Jh(O)||O===!0,q={},ie=r,de,xe;if(N&&(ie=+u.startOf(ie,"isoWeek",O)),ie=+u.startOf(ie,N?"day":C),u.diff(l,r,C)>1e5*I)throw new Error(r+" and "+l+" are too far apart with stepSize of "+I+" "+C);let ke=t.ticks.source==="data"&&this.getDataTimestamps();for(de=ie,xe=0;de<l;de=+u.add(de,I,C),xe++)RD(q,de,ke);return(de===l||t.bounds==="ticks"||xe===1)&&RD(q,de,ke),Object.keys(q).sort(AD).map(Ae=>+Ae)}getLabelForValue(u){let r=this._adapter,l=this.options.time;return l.tooltipFormat?r.format(u,l.tooltipFormat):r.format(u,l.displayFormats.datetime)}format(u,r){let t=this.options.time.displayFormats,_=this._unit,C=r||t[_];return this._adapter.format(u,C)}_tickFormatFunction(u,r,l,t){let _=this.options,C=_.ticks.callback;if(C)return Yn(C,[u,r,l],this);let I=_.time.displayFormats,O=this._unit,N=this._majorUnit,q=O&&I[O],ie=N&&I[N],de=l[r],xe=N&&ie&&de&&de.major;return this._adapter.format(u,t||(xe?ie:q))}generateTickLabels(u){let r,l,t;for(r=0,l=u.length;r<l;++r)t=u[r],t.label=this._tickFormatFunction(t.value,r,u)}getDecimalForValue(u){return u===null?NaN:(u-this.min)/(this.max-this.min)}getPixelForValue(u){let r=this._offsets,l=this.getDecimalForValue(u);return this.getPixelForDecimal((r.start+l)*r.factor)}getValueForPixel(u){let r=this._offsets,l=this.getDecimalForPixel(u)/r.factor-r.end;return this.min+l*(this.max-this.min)}_getLabelSize(u){let r=this.options.ticks,l=this.ctx.measureText(u).width,t=Xa(this.isHorizontal()?r.maxRotation:r.minRotation),_=Math.cos(t),C=Math.sin(t),I=this._resolveTickFontOptions(0).size;return{w:l*_+I*C,h:l*C+I*_}}_getLabelCapacity(u){let r=this.options.time,l=r.displayFormats,t=l[r.unit]||l.millisecond,_=this._tickFormatFunction(u,0,LD(this,[u],this._majorUnit),t),C=this._getLabelSize(_),I=Math.floor(this.isHorizontal()?this.width/C.w:this.height/C.h)-1;return I>0?I:1}getDataTimestamps(){let u=this._cache.data||[],r,l;if(u.length)return u;let t=this.getMatchingVisibleMetas();if(this._normalized&&t.length)return this._cache.data=t[0].controller.getAllParsedValues(this);for(r=0,l=t.length;r<l;++r)u=u.concat(t[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(u)}getLabelTimestamps(){let u=this._cache.labels||[],r,l;if(u.length)return u;let t=this.getLabels();for(r=0,l=t.length;r<l;++r)u.push(PD(this,t[r]));return this._cache.labels=this._normalized?u:this.normalize(u)}normalize(u){return yw(u.sort(AD))}}return d})();function my(d,s,u){let r=0,l=d.length-1,t,_,C,I;u?(s>=d[r].pos&&s<=d[l].pos&&({lo:r,hi:l}=el(d,"pos",s)),{pos:t,time:C}=d[r],{pos:_,time:I}=d[l]):(s>=d[r].time&&s<=d[l].time&&({lo:r,hi:l}=el(d,"time",s)),{time:t,pos:C}=d[r],{time:_,pos:I}=d[l]);let O=_-t;return O?C+(I-C)*(s-t)/O:C}var pC=class extends mC{static id="timeseries";static defaults=mC.defaults;constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let s=this._getTimestampsForTable(),u=this._table=this.buildLookupTable(s);this._minPos=my(u,this.min),this._tableRange=my(u,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){let{min:u,max:r}=this,l=[],t=[],_,C,I,O,N;for(_=0,C=s.length;_<C;++_)O=s[_],O>=u&&O<=r&&l.push(O);if(l.length<2)return[{time:u,pos:0},{time:r,pos:1}];for(_=0,C=l.length;_<C;++_)N=l[_+1],I=l[_-1],O=l[_],Math.round((N+I)/2)!==O&&t.push({time:O,pos:_/(C-1)});return t}_generate(){let s=this.min,u=this.max,r=super.getDataTimestamps();return(!r.includes(s)||!r.length)&&r.splice(0,0,s),(!r.includes(u)||r.length===1)&&r.push(u),r.sort((l,t)=>l-t)}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;let u=this.getDataTimestamps(),r=this.getLabelTimestamps();return u.length&&r.length?s=this.normalize(u.concat(r)):s=u.length?u:r,s=this._cache.all=s,s}getDecimalForValue(s){return(my(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){let u=this._offsets,r=this.getDecimalForPixel(s)/u.factor-u.end;return my(this._table,r*this._tableRange+this._minPos,!0)}},RV=Object.freeze({__proto__:null,CategoryScale:pV,LinearScale:cC,LogarithmicScale:dC,RadialLinearScale:uC,TimeScale:mC,TimeSeriesScale:pC}),Sy=[W4,gN,dV,RV];sp.register(...Sy);var LV=["chartContainer"];sp.register(...Sy);var nA=(()=>{let s=class s{constructor(r,l,t){this.http=r,this.router=l,this.razorpayService=t,this.apiUrl=yn,this.earn=null,this.years=[],this.selectedYear=0,this.selectedMonth=0,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.currentWeek=0,this.totalWeeks=0,this.allChartData=[],this.allLabelsData=[],this.dateRange="";for(let _=2022;_<=2030;_++)this.years.push(_)}ngOnInit(){this.initializeChart(),this.loadDefaultEarnings(),this.getCredits()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}initializeChart(){let r=document.getElementById("MyChart");this.chart=new sp(r,{type:"bar",data:{labels:[],datasets:[{data:[],backgroundColor:"limegreen",barPercentage:.8,categoryPercentage:.8}]},options:{aspectRatio:1.8,plugins:{tooltip:{enabled:!1}},scales:{y:{display:!1},x:{display:!0,grid:{display:!1}}}}}),this.chart.canvas.addEventListener("click",l=>{let t=this.chart.getElementsAtEventForMode(l,"nearest",{intersect:!0},!1);if(t.length>0){let _=t[0],C=this.chart.data.labels[_.index],I=this.chart.data.datasets[_.datasetIndex].data[_.index];this.earn=I}})}loadDefaultEarnings(){let r=new Date;this.selectedYear=r.getFullYear(),this.selectedMonth=r.getMonth(),this.updateChartData(this.selectedYear,this.selectedMonth)}onYearMonthChange(){this.selectedYear!==0&&this.selectedMonth!==0&&this.updateChartData(this.selectedYear,this.selectedMonth)}updateChartData(r,l){let t=localStorage.getItem("providerId"),_=`${this.apiUrl}providers/earnings/get-earnings/${t}`;this.http.get(_).subscribe(C=>{console.log("API Response:",C);let O=C.sort((q,ie)=>{let de=new Date(q.date),xe=new Date(ie.date);return de.getTime()-xe.getTime()}).filter(q=>{let ie=new Date(q.date);return ie.getFullYear()===r&&ie.getMonth()===l});console.log("Filtered Data:",O);let N=this.transformData(O,r,l);this.allChartData=N.data,this.allLabelsData=N.labels,this.totalWeeks=Math.ceil(this.allChartData.length/7),this.currentWeek=0,this.displayCurrentWeek()},C=>{console.error(C)})}transformData(r,l,t){let _=new Date(l,t+1,0).getDate(),C=Array.from({length:_},(O,N)=>(N+1).toString()),I=new Array(_).fill(0);return r.forEach(O=>{let q=new Date(O.date).getDate();I[q-1]+=O.amount}),console.log("Transformed Data:",{labels:C,amounts:I}),{labels:C,data:I}}displayCurrentWeek(){let r=this.currentWeek*7,l=r+7,t=this.allLabelsData.slice(r,l),_=this.allChartData.slice(r,l);console.log("Week Labels:",t),console.log("Week Data:",_),this.chart.data.labels=t,this.chart.data.datasets[0].data=_,this.chart.update(),this.updateDateRange(t)}updateDateRange(r){if(r.length>0){let l=this.selectedYear,t=this.selectedMonth,_=new Date(l,t,parseInt(r[0])),C=new Date(l,t,parseInt(r[r.length-1]));this.dateRange=`${_.toDateString()} - ${C.toDateString()}`}else this.dateRange=""}previousWeek(){this.currentWeek>0?this.currentWeek--:this.navigateMonth("previous"),this.displayCurrentWeek()}nextWeek(){this.currentWeek<this.totalWeeks-1?this.currentWeek++:this.navigateMonth("next"),this.displayCurrentWeek()}navigateMonth(r){r==="previous"?this.selectedMonth===0?Number(this.selectedYear)>this.years[0]&&(this.selectedYear--,this.selectedMonth=11):this.selectedMonth--:this.selectedMonth===11?this.selectedYear<this.years[this.years.length-1]&&(this.selectedYear++,this.selectedMonth=0):this.selectedMonth++,this.updateChartData(this.selectedYear,this.selectedMonth)}navToCredit(){this.router.navigate(["credits"])}navToMenu(){this.router.navigate(["menu"])}navToPackage(){this.router.navigate(["packages"])}};s.\u0275fac=function(l){return new(l||s)(fe(Wi),fe(Nt),fe(Eo))},s.\u0275cmp=_t({type:s,selectors:[["app-earnings"]],viewQuery:function(l,t){if(l&1&&bi(LV,5),l&2){let _;gi(_=_i())&&(t.chartContainer=_.first)}},decls:76,vars:5,consts:[["chartContainer",""],[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"chart-container"],[1,"chart-navigation"],[2,"font-size","36px",3,"click"],[1,"date-range"],[1,"scroll-container"],[1,"icon2"],["id","MyChart"],[1,"bank-transfer"],[1,"middle-text"],[1,"withdraw-div"],[1,"big-text"],[1,"credit-div"],[1,"icon-credit"],[1,"icon"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"credit1"],[1,"title"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"credit-div",3,"click"],[1,"package"],["src","assets/packages/silver coin 1.png",1,"package-img"],[2,"height","5rem"]],template:function(l,t){if(l&1){let _=Xt();V(0,"div",1)(1,"div",2),Pe("click",function(){return mt(_),pt(t.navToMenu())}),$(2,"\u2630"),j(),V(3,"div",3)(4,"div",4),Pe("click",function(){return mt(_),pt(t.navToCredit())}),Me(5,"img",5),V(6,"pre"),$(7),j()(),V(8,"div",6)(9,"span",7),$(10,"notifications"),j()()(),V(11,"div",8)(12,"div",9)(13,"div",10)(14,"span",11),Pe("click",function(){return mt(_),pt(t.previousWeek())}),$(15,"	<"),j(),V(16,"p",12),$(17),j(),V(18,"span",11),Pe("click",function(){return mt(_),pt(t.nextWeek())}),$(19,">"),j()(),V(20,"div",13,0)(22,"span",14),$(23,"\u20B9 \xA0"),V(24,"span"),$(25),j()(),Me(26,"br")(27,"br"),V(28,"canvas",15),$(29),j()()(),V(30,"div")(31,"div",16)(32,"span",17),$(33,"Bank transfer"),j(),V(34,"span",7),$(35,"chevron_right"),j()(),Me(36,"br"),V(37,"div",18)(38,"div")(39,"span",19),$(40,"\u20B9 1897"),j(),V(41,"span",17),$(42,"28-29 Mar"),j(),V(43,"span",17),$(44,"Upcoming"),j()(),V(45,"div")(46,"span",19),$(47,"\u20B9 176"),j(),V(48,"span",17),$(49,"26-27 Mar"),j(),V(50,"span",17),$(51,"Success"),j()()()(),V(52,"div",20)(53,"div",21)(54,"div",22)(55,"span",23),$(56,"poker_chip"),j()(),$(57," \xA0 \xA0 "),V(58,"div",24)(59,"span",25),$(60,"Credits"),j(),V(61,"span",25),$(62),j()()(),V(63,"span",26),Pe("click",function(){return mt(_),pt(t.navToCredit())}),$(64,"chevron_right"),j()(),V(65,"div",27),Pe("click",function(){return mt(_),pt(t.navToPackage())}),V(66,"div",21)(67,"span",28),Me(68,"img",29),$(69,"\xA0 "),V(70,"pre"),$(71,"Silver"),j()()(),V(72,"span",26),Pe("click",function(){return mt(_),pt(t.navToPackage())}),$(73,"chevron_right"),j()()()(),Me(74,"div",30)(75,"app-fotter")}l&2&&(ue(7),Ft(t.credits),ue(10),Ft(t.dateRange),ue(8),Ft(t.earn),ue(4),Ft(t.chart),ue(33),Ft(t.credits))},dependencies:[Js],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100%;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh;display:grid;row-gap:2rem}.chart-container[_ngcontent-%COMP%]{width:100%;height:fit-content;display:grid;row-gap:1rem;box-shadow:0 5px 5px #00000080;border-radius:.5rem}.scroll-container[_ngcontent-%COMP%]{position:relative;width:100%;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}#MyChart[_ngcontent-%COMP%]{background-color:#d6ffdf3b;width:100%;display:inline-block;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none;min-width:100%}.chart-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .chart-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{float:left;text-align:left}.icon2[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.8rem;font-weight:500;line-height:24.2px;color:#49a010;float:left;text-align:left;display:flex;margin-left:1rem}.earning-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:24.2px;float:left;text-align:left}.bank-transfer[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.withdraw-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:49% 49%;column-gap:2%}.withdraw-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:grid;padding:1rem;row-gap:0;height:120px;border:.25px solid black;border-radius:.5rem}.credit-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;height:2rem}.icon[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:.4rem;border:.25px solid black}.icon-credit[_ngcontent-%COMP%]{display:flex;width:30%;height:2rem}.credit1[_ngcontent-%COMP%]{display:grid;border:none;justify-content:space-around}.rank[_ngcontent-%COMP%]{display:grid;float:left;text-align:left}.title[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22.94px}.middle-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px}.big-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:20px;font-weight:600;line-height:19.36px}.date-div[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:.5rem}.date-div[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:10rem;height:2rem;border:.25px solid black}.chart-navigation[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.date-range[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"inter" sans-serif;font-weight:500}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}']});let d=s;return d})();var rA=(()=>{let s=class s{constructor(r){this.router=r}navToHome(){this.router.navigate(["home"])}};s.\u0275fac=function(l){return new(l||s)(fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-waiting-page"]],decls:10,vars:0,consts:[[1,"container"],[1,"sub-container"],["src","assets/new/Man playing Basketball.gif"],[3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div"),Me(3,"img",2)(4,"br")(5,"br"),V(6,"p"),$(7,"Thanks for uploading your documents, your documents are under review. We will let you once you ready to work."),j()()(),V(8,"button",3),Pe("click",function(){return t.navToHome()}),$(9,"Next"),j()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:3rem}.sub-container[_ngcontent-%COMP%]{width:80%;margin-top:-5rem;height:max-content;display:grid;align-items:center}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60%;height:60%}p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:16.94px;text-align:center;color:#00000080}button[_ngcontent-%COMP%]{width:90%;height:2.5rem;background:#d16611;color:#f0f8ff;font-size:1.1rem;font-weight:400;line-height:16.94px;border:none;border-radius:.5rem}']});let d=s;return d})();var oA=(()=>{let s=class s{constructor(r){this.router=r}};s.\u0275fac=function(l){return new(l||s)(fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-notification"]],decls:2,vars:0,template:function(l,t){l&1&&(V(0,"p"),$(1,"notification works!"),j())}});let d=s;return d})();var FV=["dialogTemplate"],zV=d=>({selected:d});function BV(d,s){if(d&1){let u=Xt();hd(0),V(1,"div")(2,"p",3),Pe("click",function(){mt(u);let l=rt();return pt(l.extend())}),$(3,"expand_circle_right"),j()(),ud()}}function NV(d,s){if(d&1){let u=Xt();hd(0),V(1,"span",17)(2,"input",18),Pe("change",function(){mt(u);let l=rt().$implicit,t=rt();return pt(t.availabilityService(l.categoryId.name))}),j(),$(3,"\xA0 "),V(4,"span",19),$(5),j()(),ud()}if(d&2){let u=rt().$implicit,r=rt();ue(2),Fe("checked",r.selectedService===u.categoryId.name),ue(3),Ft(u.categoryId.name)}}function VV(d,s){if(d&1){let u=Xt();hd(0),V(1,"span",3),Pe("click",function(){mt(u);let l=rt(2);return pt(l.openServiceDialog())}),$(2,"expand_circle_down"),j(),ud()}}function jV(d,s){if(d&1){let u=Xt();V(0,"div",20)(1,"span",21)(2,"input",18),Pe("change",function(){mt(u);let l=rt().$implicit,t=rt();return pt(t.availabilityService(l.item.categoryId.name))}),j(),V(3,"span",19),$(4),j()()()}if(d&2){let u=rt().$implicit,r=rt();ue(2),Fe("checked",r.selectedService===u.item.categoryId.name),ue(2),Ft(u.item.categoryId.name)}}function UV(d,s){if(d&1&&(hd(0),Bt(1,NV,6,2,"ng-container",4)(2,VV,3,0,"ng-container",4)(3,jV,5,2,"div",16),ud()),d&2){let u=s.index,r=rt();ue(),Fe("ngIf",u<=1&&!r.extendServices),ue(),Fe("ngIf",u===2&&!r.extendServices),ue(),Fe("ngIf",r.extendServices)}}function HV(d,s){if(d&1){let u=Xt();hd(0),V(1,"div",22),Pe("click",function(){let l=mt(u),t=l.$implicit,_=l.index,C=rt();return pt(C.selected(t,_))}),V(2,"p"),$(3),j(),V(4,"p"),$(5),j(),V(6,"span",23),$(7),j()(),ud()}if(d&2){let u=s.$implicit,r=s.index,l=rt();ue(),Fe("ngClass",ci(4,zV,l.selectedIndex===r)),ue(2),Ft(u.day.substring(0,3).toUpperCase()),ue(2),Ft(u.date.split("-")[0]),ue(2),Ft(u.workingStaus?"check":"close")}}function WV(d,s){if(d&1){let u=Xt();V(0,"div",29)(1,"input",30),Er("ngModelChange",function(l){let t=mt(u).$implicit;return Tr(t.isSelected,l)||(t.isSelected=l),pt(l)}),Pe("change",function(l){let t=mt(u).$implicit,_=rt(2);return pt(_.onToggleChange(l,t))}),j(),V(2,"span",19),$(3),j()()}if(d&2){let u=s.$implicit;ue(),Ir("ngModel",u.isSelected),ue(2),Ft(u.time)}}function GV(d,s){if(d&1&&(V(0,"div",24)(1,"div",25)(2,"span",12),$(3,"check"),j(),V(4,"p"),$(5,"confirmation your working hours"),j(),V(6,"span",12),$(7,"expand_circle_up"),j()(),Me(8,"br")(9,"div",26),V(10,"section",27),Bt(11,WV,4,2,"div",28),j()()),d&2){let u=rt();ue(11),Fe("ngForOf",u.nextDaysOfIndex.timming)}}function qV(d,s){if(d&1){let u=Xt();V(0,"div")(1,"div",35)(2,"input",18),Pe("change",function(){let l=mt(u).$implicit,t=rt(2);return pt(t.availabilityService(l.categoryId.name))}),j(),$(3," \xA0"),V(4,"span",36),$(5),j()()()}if(d&2){let u=s.$implicit,r=rt(2);ue(2),Fe("checked",r.selectedService===u.categoryId.name),ue(3),Ft(u.categoryId.name)}}function $V(d,s){if(d&1){let u=Xt();V(0,"h1",31),$(1,"Select Services"),j(),V(2,"div",32)(3,"form"),Bt(4,qV,6,2,"div",5),j()(),V(5,"div",33)(6,"button",34),Pe("click",function(){mt(u);let l=rt();return pt(l.onCancel())}),$(7,"Cancel"),j(),V(8,"button",34),Pe("click",function(){mt(u);let l=rt();return pt(l.onSubmit())}),$(9,"Submit"),j()()}if(d&2){let u=rt();ue(4),Fe("ngForOf",u.services)}}var aA=(()=>{let s=class s{constructor(r,l,t,_,C,I,O,N){this.location=r,this.renderer=l,this.el=t,this.http=_,this.dialog=C,this.jobDetailsService=I,this.userService=O,this.dailogeBoxService=N,this.date=new Date,this.userId=localStorage.getItem("providerId"),this.apiUrl=yn,this.defaultMonth=this.date.toLocaleDateString("default",{month:"long"}),this.daySelected=String(this.date.getDate()).padStart(2,"0"),this.monthSelected=this.defaultMonth.substring(0,3),this.dateSelected=this.date.getDate(),this.isChecked=!1,this.working=!1,this.extendServices=!1,this.services=[],this.nextFourDays=[],this.nextDaysOfIndex=[],this.selectedService="",this.timing=[{time:"07AM-10AM",isSelected:!1},{time:"10AM-01PM",isSelected:!1},{time:"01PM-04Pm",isSelected:!1},{time:"04PM-07Pm",isSelected:!1},{time:"07PM-10Pm",isSelected:!1}],this.selectedIndex=0,this.api="",this.availabilityResponse=[]}extend(){this.extendServices=!this.extendServices}openServiceDialog(){this.dialogRef=this.dialog.open(this.dialogTemplate),this.dialogRef.afterClosed().subscribe(r=>{r&&(this.services=r)})}onCancel(){this.dialogRef.close()}onSubmit(){this.dialogRef.close(this.services)}ngOnInit(){this.getSelectedService(),this.getDetails(),this.getNextFourDays();let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];this.daySelected=r[this.date.getDay()]}getSelectedService(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.services=r.works},r=>{console.log(r)})}availabilityService(r){this.selectedService=r,this.showAvailabilityForService(r)}getNextFourDays(){let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=new Date;for(let t=0;t<10;t++){let _=new Date(l);_.setDate(l.getDate()+t);let C=this.formatDate(_),I=t===0?this.getFutureTimings():[...this.timing];this.nextFourDays.push({date:C,day:r[_.getDay()],workingStaus:!1,timming:I})}this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex]}getFutureTimings(){let r=this.date.getHours(),l=this.date.getMinutes();return this.timing.filter(t=>{let _=t.time,C=parseInt(_.slice(0,-2)),I=_.includes("AM");return!I&&C<12&&(C+=12),I&&C===12&&(C=0),C>r})}formatDate(r){let l=String(r.getDate()).padStart(2,"0"),t=r.getFullYear(),_=r.toLocaleDateString("default",{month:"long"});return`${l}-${_}-${t}`}selected(r,l){if(!this.selectedService){this.dailogeBoxService.openDialog("select the service from the above");return}console.log(r),this.isChecked=!1,r.workingStaus?this.working=!0:this.working=!1,this.selectedIndex=l,this.dateSelected=r.date.toString().split("-")[0],this.daySelected=r.day,this.monthSelected=r.date.toString().split("-")[1],this.yearSelected=r.date.toString().split("-")[2],this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex],console.log(this.nextDaysOfIndex),console.log(this.monthSelected),this.timing.forEach(t=>t.isSelected=!1)}workingChange(){if(!this.monthSelected||!this.dateSelected||!this.yearSelected){this.isChecked=!this.isChecked,this.working=!1,this.dailogeBoxService.openDialog("please select or confirm the date");return}this.nextFourDays[this.selectedIndex].workingStaus=!this.nextFourDays[this.selectedIndex].workingStaus}onToggleChange(r,l){let _=r.target?.checked??!1;console.log(_),this.nextDaysOfIndex.timming.forEach(de=>{de.time===l.time&&(de.isSelected=_)}),this.timeSelected=_?l.time:"",console.log(this.dateSelected);let C=new Date(`${this.monthSelected} ${this.dateSelected} ${this.yearSelected}`);C.setDate(this.dateSelected);let I=C.getDate(),O=C.getMonth()+1,N=I<10?`0${I}`:I,q=O<10?`0${O}`:O,ie=this.yearSelected;this.fullDate=`${ie}-${q}-${N}`,console.log(q)}submitAllData(){console.log(this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)),this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)?this.dailogeBoxService.openDialog("The same time slot on the selected date for the selected service is already taken."):this.sendingData()}sendingData(){this.timeSelected!=""?this.api=`${this.apiUrl}providers/provider-date`:this.api=`${this.apiUrl}providers/provider-date/delete`;let r={providerId:this.userId,service:this.selectedService,date:this.fullDate,availability:this.working,time:this.timeSelected};console.log(r),console.log(this.api),this.http.post(this.api,r).subscribe(l=>{console.log(l),this.dailogeBoxService.openDialog("Availability added successfully"),this.timing.forEach(t=>t.isSelected=!1),console.log(this.timing),this.getDetails()},l=>{console.log(l),this.dailogeBoxService.openDialog(l.error.message)})}getDetails(){let r=`${this.apiUrl}providers/provider-date/${this.userId}`;this.http.get(r).subscribe(l=>{console.log(l),this.availabilityResponse=l,this.showAvailability(this.availabilityResponse)},l=>{console.log(l)})}deleteData(){}showAvailability(r){console.log(this.services),r.forEach(l=>{let t=l.date,_=new Date(t),C=_.getDate(),I=_.toLocaleDateString("default",{month:"long"}),O=`${String(C).padStart(2,"0")}-${I}-${_.getFullYear()}`;this.nextFourDays.forEach(N=>{N.date===O&&(N.workingStaus=l.work,N.timming.forEach(q=>{q.time===l.time&&(q.isSelected=!0)}))})}),console.log(this.nextFourDays)}checkDuplicate(r,l,t){return this.availabilityResponse.some(_=>_.date===r&&_.time===l&&_.service===t)}navToBack(){this.location.back()}showAvailabilityForService(r){console.log("new called"),this.nextFourDays.forEach(l=>{l.workingStaus=!1,l.timming.forEach(t=>{t.isSelected=!1})}),console.log(this.availabilityResponse),this.availabilityResponse.forEach(l=>{if(l.service===r){let t=l.date,_=new Date(t),C=_.getDate(),I=_.toLocaleDateString("default",{month:"long"}),O=`${String(C).padStart(2,"0")}-${I}-${_.getFullYear()}`;this.nextFourDays.forEach(N=>{O===N.date&&(N.workingStaus=!0,N.timming.forEach(q=>{q.time===l.time&&(q.isSelected=!0)}))})}})}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(hk),fe(ln),fe(Wi),fe(Hm),fe(Cr),fe(Gn),fe(zn))},s.\u0275cmp=_t({type:s,selectors:[["app-calender"]],viewQuery:function(l,t){if(l&1&&bi(FV,5),l&2){let _;gi(_=_i())&&(t.dialogTemplate=_.first)}},decls:27,vars:12,consts:[["dialogTemplate",""],[1,"container"],[1,"headers"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"sub-container"],[1,"working-dates"],[1,"selected-date"],[1,"update"],[1,"custom-checkbox"],["type","checkbox",3,"change","ngModelChange","checked","ngModel"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],["class","confirmation-div",4,"ngIf"],[3,"click"],[2,"width","300px"],["class","extended",4,"ngIf"],[2,"display","flex","align-items","center","justify-content","center"],["type","checkbox",3,"change","checked"],[1,"service-tittle"],[1,"extended"],[1,"service"],[1,"datess",3,"click","ngClass"],[1,"material-symbols-outlined","notranslate"],[1,"confirmation-div"],[1,"conformation"],[1,"line"],[1,"time-section"],["class","time-confirm",4,"ngFor","ngForOf"],[1,"time-confirm"],["type","checkbox","color","accent",3,"ngModelChange","change","ngModel"],["mat-dialog-title",""],["mat-dialog-content","",2,"width","300px"],["mat-dialog-actions","",2,"display","flex","justify-content","space-evenly"],["mat-button","",2,"width","30%","height","2rem",3,"click"],[2,"display","flex","align-items","center","width","100%","height","3rem"],[2,"color","black"]],template:function(l,t){if(l&1){let _=Xt();V(0,"div",1)(1,"div",2)(2,"span",3),Pe("click",function(){return mt(_),pt(t.navToBack())}),$(3,"arrow_back"),j(),Bt(4,BV,4,0,"ng-container",4)(5,UV,4,3,"ng-container",5),j(),Me(6,"br")(7,"br"),V(8,"div",6)(9,"div",7),Bt(10,HV,8,6,"ng-container",5),j(),V(11,"div",8)(12,"span"),$(13),j()(),V(14,"div",9)(15,"div")(16,"label",10)(17,"input",11),Pe("change",function(){return mt(_),pt(t.workingChange())}),Er("ngModelChange",function(I){return mt(_),Tr(t.working,I)||(t.working=I),pt(I)}),j()(),V(18,"span"),$(19,"Working"),j()(),V(20,"span",12),$(21),j()(),Bt(22,GV,12,1,"div",13),V(23,"button",14),Pe("click",function(){return mt(_),pt(t.submitAllData())}),$(24,"submit"),j()()(),Bt(25,$V,10,1,"ng-template",15,0,Tm)}l&2&&(ue(4),Fe("ngIf",t.extendServices),ue(),Fe("ngForOf",t.services),ue(5),Fe("ngForOf",t.nextFourDays),ue(3),tb("",t.daySelected,",",t.monthSelected," ",t.dateSelected,""),ue(3),Mi("checked",t.isChecked),ue(),Fe("checked",t.isChecked),Ir("ngModel",t.working),ue(4),Ft(t.working?"expand_circle_right":"expand_circle_down"),ue(),Fe("ngIf",t.working))},dependencies:[Mo,Vr,fr,Io,Xs,ir,ko,Zo,Pk,rT,aT,oT],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.headers[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.service[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.service-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1rem;font-weight:500;line-height:16.94px;text-align:left}.extended[_ngcontent-%COMP%]{border:1px solid red}.sub-container[_ngcontent-%COMP%]{width:95%;position:relative;left:2.5%;display:grid;row-gap:3rem}.working-dates[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:2rem;justify-content:space-between;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;flex-direction:row;-ms-overflow-style:none;scrollbar-width:none}.datess[_ngcontent-%COMP%]{width:5rem;height:5rem;display:flex;text-align:center;flex-direction:column;border:1px solid black;border-radius:.5rem;flex:0 0 20%;padding-top:1rem;padding-bottom:1rem}.datess.selected[_ngcontent-%COMP%]{background-color:#72d388;border:none;color:#fff}.selected-date[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.07em}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:#72d388;border:0}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.update[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-around;border:.25px solid black;border-radius:.4rem;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:flex;justify-content:space-around;text-align:center;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;letter-spacing:.07em;text-align:center;align-items:center}.confirmation-div[_ngcontent-%COMP%]{background:#fcf5fc;border:.25px solid rgba(0,0,0,1);border-radius:.4rem;padding:1rem}.conformation[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.line[_ngcontent-%COMP%]{height:1rem;border-bottom:.2px solid transparent;border-top:.25px dashed black}.time-confirm[_ngcontent-%COMP%]{height:2rem;display:flex;align-items:center;justify-content:center;text-align:center;gap:.5rem}.time-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:45% 45%;column-gap:5%;row-gap:1rem}']});let d=s;return d})();function YV(d,s){if(d&1){let u=Xt();V(0,"div",5),Pe("click",function(){let l=mt(u).$implicit,t=rt();return pt(t.selectedJob(l))}),V(1,"div")(2,"p")(3,"span",6),$(4),j()(),V(5,"p")(6,"span",7),Pe("click",function(){mt(u);let l=rt();return pt(l.navToBack())}),$(7,"account_balance_wallet"),j(),$(8,"\xA0 "),V(9,"span",8),$(10),j()(),V(11,"p")(12,"span",7),Pe("click",function(){mt(u);let l=rt();return pt(l.navToBack())}),$(13,"description"),j(),$(14,"\xA0 "),V(15,"span",8),$(16),j()()(),V(17,"div")(18,"p",6),$(19),j(),V(20,"p",8),$(21),j()()(),Me(22,"br")}if(d&2){let u=s.$implicit;ue(4),Ft(u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].serviceId.name),ue(6),ki("Job value:",u.orderId==null?null:u.orderId.totalAmount,""),ue(6),ki("Online Payments:",u.orderId==null?null:u.orderId.totalAmount,""),ue(3),Ft(u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].selectedTime),ue(2),xa("",u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].selectedDate," - ",u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].selectedMonth,"")}}var sA=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r,l,t,_){this.location=r,this.jobDetailsService=l,this.router=t,this.orderService=_,this.jobs=[{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"}]}ngOnInit(){this.getOrderDetails()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r),this.jobs=r.data,this.filterOrder()},error:r=>{console.log(r)}})}filterOrder(){this.filteredJobs=this.jobs.filter(r=>r.status&&r.status.toLowerCase()==="completed"),console.log(this.filteredJobs),this.jobs=this.filteredJobs}selectedJob(r){console.log(r),this.jobDetailsService.selectedJobDetails(r),this.router.navigate(["jobDetails"])}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Cr),fe(Nt),fe(Sr))},s.\u0275cmp=_t({type:s,selectors:[["app-job-history"]],decls:11,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"section",3,"click"],[1,"main-text"],[1,"material-symbols-outlined","notranslate",2,"font-size","1rem",3,"click"],[1,"text"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Pe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0"),V(5,"span",3),$(6,"Job History"),j()(),V(7,"div",4)(8,"div"),mr(9,YV,23,6,null,null,Zr),j()()()),l&2&&(ue(9),pr(t.jobs))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%}.section[_ngcontent-%COMP%]{width:100%;height:7rem;border:.25px solid black;border-radius:.5rem;display:flex;justify-content:space-between;align-items:center;text-align:center}.section[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:.5rem;display:flexbox;text-align:left}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px}.main-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:19.36px}.text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px}']});let d=s;return d})();function ZV(d,s){if(d&1){let u=Xt();V(0,"div",16),Pe("click",function(){let l=mt(u).$implicit,t=rt();return pt(t.selected(l))}),$(1),j()}if(d&2){let u=s.$implicit;ue(),Ft(u)}}var lA=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r,l,t){this.location=r,this.http=l,this.razorPayService=t,this.credits=[20,50,100,250],this.selectedValue=0,this.AmountToPay=0,this.payOnline=!1,this.deductNextPayout=!1}entredAmount(){this.AmountToPay=this.selectedValue}selected(r){this.selectedValue=r,this.AmountToPay=this.selectedValue}togglePayOnline(r){this.payOnline=!this.payOnline,this.payOnline&&(this.deductNextPayout=!1,this.makePayment())}toggleDeductNextPayout(){this.deductNextPayout=!this.deductNextPayout,this.deductNextPayout&&(this.payOnline=!1)}makePayment(){let r=this.AmountToPay,l="INR",t="order_id_from_backend";this.razorPayService.createOrder(r).subscribe({next:_=>{console.log("Order created:",_),this.razorPayService.payWithRazorpay(r,_.id,l)},error:_=>{console.error("Error creating order:",_)}})}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Wi),fe(Eo))},s.\u0275cmp=_t({type:s,selectors:[["app-add-credit"]],decls:32,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","32px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"credit-input"],["src","assets/logo/credit12.png"],["type","number","placeholder","Enter number of credits",3,"ngModelChange","input","value","ngModel"],[1,"quickSelect-div"],[1,"maintext"],[1,"selec-div"],["class","maintext",3,"click",4,"ngFor","ngForOf"],[1,"Amount-div"],[1,"selecPayment-div"],[1,"minText"],["type","checkbox",3,"change","checked"],[1,"maintext",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Pe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Add credits"),j()(),V(7,"div",4)(8,"div",5),Me(9,"img",6),V(10,"input",7),Er("ngModelChange",function(C){return Tr(t.selectedValue,C)||(t.selectedValue=C),C}),Pe("input",function(){return t.entredAmount()}),j()(),V(11,"div",8)(12,"span",9),$(13,"Quick select"),j(),V(14,"div",10),Bt(15,ZV,2,1,"div",11),j()(),V(16,"div",12)(17,"span",9),$(18,"Amount to pay"),j(),V(19,"p",9),$(20),j()(),V(21,"div",13)(22,"span",9),$(23,"Select payment method"),j(),Me(24,"br")(25,"br"),V(26,"p",14)(27,"input",15),Pe("change",function(C){return t.togglePayOnline(C)}),j(),$(28,"\xA0Pay Online "),j(),V(29,"p",14)(30,"input",15),Pe("change",function(){return t.toggleDeductNextPayout()}),j(),$(31,"\xA0Deduct from next payout "),j()()()()),l&2&&(ue(10),Fe("value",t.selectedValue),Ir("ngModel",t.selectedValue),ue(5),Fe("ngForOf",t.credits),ue(5),ki("\u20B9\xA0 ",t.AmountToPay,""),ue(7),Fe("checked",t.payOnline),ue(3),Fe("checked",t.deductNextPayout))},dependencies:[Vr,ro,sb,ir,Zo],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.6rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:2rem}.maintext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.minText[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:19.36px}.credit-input[_ngcontent-%COMP%]{height:3rem;width:100%;border:.25px solid black;border-radius:.4rem;display:flex;align-items:center;justify-content:space-around}.credit-input[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1rem;height:1rem}.credit-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80%;height:2.5rem;outline:0;border-width:0;font-size:1.2rem}.quickSelect-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:grid;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;flex-wrap:wrap;column-gap:3rem;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{border:.25px solid black;width:4.8rem;height:2.5rem;display:flex;border-radius:.5rem;align-items:center;justify-content:center}.Amount-div[_ngcontent-%COMP%]{width:90%;height:4rem;display:flex;align-items:center;text-align:center;padding-left:5%;padding-right:5%;justify-content:space-between;border:.25px solid black;border-radius:.5rem}.minText[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}']});let d=s;return d})();var cA=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r,l){this.location=r,this.userDetails=l,this.bankDetails=[],this.getUserDetails()}getUserDetails(){this.userDetails.getFinancialDetails().subscribe(r=>{console.log(r),this.bankDetails=r},r=>{console.log(r)})}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Gn))},s.\u0275cmp=_t({type:s,selectors:[["app-financial-details"]],decls:61,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"gst-div"],[1,"largetext"],[1,"panDetails"],[1,"edit"],[1,"bankdetails"],[1,"normaltext"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Pe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Financial details"),j()(),V(7,"div",4)(8,"div",5)(9,"span",6),$(10,"GST Details"),j(),V(11,"span",6),$(12,"Add+"),j()(),V(13,"div",7)(14,"p")(15,"span",6),$(16,"Aadhar Card details"),j(),V(17,"span",8),$(18,"Edit"),j()(),V(19,"p")(20,"span",6),$(21,"Aadhar "),j(),V(22,"span",6),$(23),j()()(),V(24,"div",7)(25,"p")(26,"span",6),$(27,"PAN Card details"),j(),V(28,"span",8),$(29,"Edit"),j()(),V(30,"p")(31,"span",6),$(32,"PAN "),j(),V(33,"span",6),$(34),j()()(),V(35,"div",9)(36,"p")(37,"span",6),$(38,"Bank account details"),j(),V(39,"span",8),$(40,"Edit"),j()(),V(41,"p")(42,"span",10),$(43,"Account number"),j(),V(44,"span",6),$(45),j()(),V(46,"p")(47,"span",10),$(48,"Bank name"),j(),V(49,"span",6),$(50),j()(),V(51,"p")(52,"span",10),$(53,"IFSC code"),j(),V(54,"span",6),$(55),j()(),V(56,"p")(57,"span",10),$(58,"Name in account"),j(),V(59,"span",6),$(60),j()()()()()),l&2&&(ue(23),Ft(t.bankDetails.aadhaarNumber),ue(11),Ft(t.bankDetails.pan),ue(11),Ft(t.bankDetails.accountNumber),ue(5),Ft(t.bankDetails.bankName),ue(5),Ft(t.bankDetails.ifscCode),ue(5),Ft(t.bankDetails.accountName))},styles:['.container[_ngcontent-%COMP%]{width:93vw;height:100vh;padding:1rem .5rem 0 1rem}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:97%;position:relative;top:3.5%;display:grid;row-gap:2rem}.gst-div[_ngcontent-%COMP%]{width:90%;height:4rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center;text-align:center;padding:5%;border-radius:.5rem}.panDetails[_ngcontent-%COMP%]{width:90%;height:5rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}p[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;text-align:center}.bankdetails[_ngcontent-%COMP%]{width:90%;height:13rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}.largetext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.edit[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;color:#00000080}.normaltext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px}']});let d=s;return d})();var dA=(()=>{let s=class s{navToBack(){this.location.back()}navToHelp(){this.router.navigate(["help"])}constructor(r,l,t){this.jobDetailsService=r,this.location=l,this.router=t,this.jobDetailsService.getSelectedJob(),console.log(this.jobDetailsService.getSelectedJob())}ngOnInit(){this.orderDetails=this.jobDetailsService.getSelectedJob()}};s.\u0275fac=function(l){return new(l||s)(fe(Cr),fe(ii),fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-job-details"]],decls:65,vars:12,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px",3,"click"],[1,"help",3,"click"],[1,"sub-container"],[1,"name"],[1,"tittle"],[1,"customer-details"],[1,"sub-tittle"],[1,"Details"],[1,"para-section"],[1,"highlight-text"],[1,"line"],[1,"time-div"],[1,"summary"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Pe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),V(4,"div",3),Pe("click",function(){return t.navToHelp()}),$(5,"Help?"),j()(),V(6,"div",4)(7,"div",5)(8,"span",6),$(9),j(),V(10,"span"),$(11),j()(),V(12,"div",7)(13,"span",8),$(14,"Customers Details"),j(),V(15,"div",9)(16,"p",10)(17,"span",11),$(18,"Location"),j(),V(19,"span"),$(20),j()(),Me(21,"div",12)(22,"br"),V(23,"div",13)(24,"p",10)(25,"span",11),$(26,"Job start"),j(),V(27,"span"),$(28),j()(),V(29,"p",10)(30,"span",11),$(31,"Job End"),j(),V(32,"span"),$(33,"12 Apr 07:30 PM"),j()()()()(),V(34,"div",14)(35,"span",8),$(36,"Summary"),j(),V(37,"div",9)(38,"div",13)(39,"span",11),$(40),j(),V(41,"span",8),$(42),j()(),Me(43,"div",12)(44,"br"),V(45,"div",13)(46,"p")(47,"span"),$(48,"Others"),j(),Me(49,"br"),V(50,"span",11),$(51,"Convenience Fee"),j()(),V(52,"p",8),$(53,"69"),j()(),Me(54,"div",12)(55,"br"),V(56,"div",13)(57,"p")(58,"span",11),$(59,"Total value"),j(),Me(60,"br"),V(61,"span"),$(62,"commission 5 credits"),j()(),V(63,"p",8),$(64),j()()()()()()),l&2&&(ue(9),Ft(t.orderDetails.orderId.addressId.username),ue(2),Ft(t.orderDetails.orderId.items[0].scheduledDate),ue(9),fk(" ",t.orderDetails.orderId.addressId.address,",",t.orderDetails.orderId.addressId.landmark,", ",t.orderDetails.orderId.addressId.city,", ",t.orderDetails.orderId.addressId.state,", ",t.orderDetails.orderId.addressId.pincode," "),ue(8),ki(" ",t.orderDetails.workStartTime," "),ue(12),xa("",t.orderDetails.orderId.items[0].quantity," \xA0 X \xA0 ",t.orderDetails.orderId.categoryIds[0].name,""),ue(2),ki("\u20B9 \xA0",t.orderDetails.orderId.totalAmount,""),ue(22),Ft(t.orderDetails.orderId.totalAmount))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:space-between;align-items:center}.help[_ngcontent-%COMP%]{width:4rem;height:2.5rem;border:none;background:#20193f;border-radius:1.3rem;color:#fff;display:flex;justify-content:center;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px;margin-bottom:1rem}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:1.5rem}.name[_ngcontent-%COMP%]{position:relative;left:5%;display:flex;flex-direction:column}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;padding:0 0 1rem 1rem;margin-bottom:.5rem}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:600;line-height:16.94px;margin-bottom:.5rem}.customer-details[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;padding:1rem;border:.25px solid black;border-radius:.5rem}.summary[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.line[_ngcontent-%COMP%]{border:0;border-bottom:1px dashed rgb(45,44,44)}.para-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}']});let d=s;return d})();function XV(d,s){if(d&1&&(V(0,"div")(1,"label",6),Me(2,"input",7),j(),$(3," \xA0 "),V(4,"span",3),$(5),j()(),Me(6,"br")),d&2){let u=s.$implicit;ue(),Mi("checked",u.checked),ue(),Fe("checked",u.checked),ue(3),Ft(u.name)}}var hA=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r){this.location=r,this.items=[{name:"Contact Details",checked:!0},{name:"Aadhar card",checked:!0},{name:"Bank Details",checked:!0},{name:"Professional documents",checked:!1}]}toggleCheckbox(){}};s.\u0275fac=function(l){return new(l||s)(fe(ii))},s.\u0275cmp=_t({type:s,selectors:[["app-identity-verification"]],decls:13,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"para"],[1,"verify-div"],[1,"custom-checkbox"],["type","checkbox","disabled","",3,"checked"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Pe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Identity Verification"),j()(),V(7,"div",4)(8,"p"),$(9,"We were to successfully verify your details . As a part of our quality process we will request you to re-verify the information every 5months "),j()(),V(10,"div",5),mr(11,XV,7,4,null,null,Zr),j()()),l&2&&(ue(11),pr(t.items))},styles:['.container[_ngcontent-%COMP%]{width:92vw;padding:1rem;display:grid;row-gap:2rem}.para[_ngcontent-%COMP%]{background-color:#ef8c534d;width:90%;padding:1rem;border-radius:.5rem;color:#ffa800}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:green}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}input[type=checkbox][disabled][_ngcontent-%COMP%]{cursor:not-allowed;background-color:#f0f0f0}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}']});let d=s;return d})();var QV=["footer"],KV=d=>({active:d});function JV(d,s){if(d&1){let u=Xt();V(0,"button",13),Pe("click",function(){let l=mt(u).$implicit,t=rt();return pt(t.setActiveButton(l))}),$(1),j()}if(d&2){let u=s.$implicit,r=rt();Fe("ngClass",ci(2,KV,r.activeButton===u)),ue(),ki(" ",u," ")}}function ej(d,s){if(d&1){let u=Xt();V(0,"span",20)(1,"a",21)(2,"span",6),$(3," call "),j()(),V(4,"span",22),Pe("click",function(){mt(u);let l=rt().$implicit,t=rt();return pt(t.navToChat(l.userId))}),$(5," chat "),j(),V(6,"span",22),Pe("click",function(){mt(u);let l=rt().$implicit,t=rt();return pt(t.navToArrived(l))}),$(7," directions "),j()()}}function tj(d,s){if(d&1&&(V(0,"div",14)(1,"span",15)(2,"span",16),$(3),j(),Bt(4,ej,8,0,"span",17),j(),V(5,"span",16),$(6),j(),V(7,"span",18),$(8),j(),V(9,"span",19)(10,"span",18),$(11),j(),V(12,"span",16),$(13),j()(),V(14,"span",18),$(15),j()()),d&2){let u=s.$implicit;ue(3),Ft(u.orderId==null||u.orderId.addressId==null?null:u.orderId.addressId.username),ue(),Fe("ngIf",u.status==="Accepted"||u.status==="InProgress"),ue(2),Ft(u.orderId==null||u.orderId.categoryIds[0]==null?null:u.orderId.categoryIds[0].name),ue(2),Ft(u.orderId==null||u.orderId.subCategoryIds[0]==null?null:u.orderId.subCategoryIds[0].name),ue(3),Ft(u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].scheduledDate),ue(2),ki(" \u20B9 ",u.orderId.totalAmount,""),ue(2),pk("",u.orderId.addressId==null?null:u.orderId.addressId.address," ",u.orderId.addressId.city," ",u.orderId.addressId.state," ",u.orderId.addressId.pincode,"")}}var uA=(()=>{let s=class s{constructor(r,l,t,_){this.location=r,this.router=l,this.razorpayService=t,this.orderService=_,this.buttons=["Ongoing","Pending","Accepted","Completed","Cancelled"],this.activeButton="Ongoing",this.text=this.activeButton,this.filterStatus="InProgress",this.order=[],this.filteredOrder=[],this.getCredits(),this.getOrderDetails()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}navBack(){this.location.back()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r),this.order=r.data,this.filterOrder()},error:r=>{console.log(r)}})}setActiveButton(r){this.activeButton=r,this.text=r,this.assignOrder()}assignOrder(){switch(this.activeButton){case"Ongoing":this.filterStatus="InProgress";break;case"Pending":this.filterStatus="Workstart";break;case"Accepted":this.filterStatus="Accepted";break;case"Completed":this.filterStatus="Completed";break;case"Cancelled":this.filterStatus="Cancelled";break}this.filterOrder()}filterOrder(){console.log(this.order),this.filteredOrder=this.order.filter(r=>r.status&&r.status.toLowerCase()===this.filterStatus.toLowerCase()),console.log(this.filteredOrder)}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"menu":this.router.navigate(["menu"]);break}}navToArrived(r){this.activeButton==="Ongoing"?this.router.navigate(["completeWork",r._id]):this.activeButton==="Pending"&&this.router.navigate(["arrived",r._id])}navToChat(r){let l={role:"user",id:r};this.router.navigate(["help/chatbot"],{queryParams:l})}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Nt),fe(Eo),fe(Sr))},s.\u0275cmp=_t({type:s,selectors:[["app-ongoing"]],viewQuery:function(l,t){if(l&1&&bi(QV,5),l&2){let _;gi(_=_i())&&(t.footer=_.first)}},decls:20,vars:3,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content-container"],["class","content",4,"ngFor","ngForOf"],[2,"height","5rem"],[3,"click","ngClass"],[1,"content"],[1,"icons-div"],[1,"highlight-text"],["class","iconsss",4,"ngIf"],[1,"normal-text"],[1,"service-div"],[1,"iconsss"],["href","'tel:'+ item.orderId.address.mobileNumber"],[1,"material-symbols-outlined","notranslate",3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),Pe("click",function(){return t.navTo("menu")}),$(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Pe("click",function(){return t.navTo("credit")}),Me(5,"img",4),V(6,"pre"),$(7),j()(),V(8,"div",5),Pe("click",function(){return t.navTo("notification")}),V(9,"span",6),$(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8),Bt(13,JV,2,4,"button",9),j(),V(14,"div",10),Me(15,"br"),Bt(16,tj,16,10,"div",11),j(),Me(17,"br"),j()(),Me(18,"div",12)(19,"app-fotter")),l&2&&(ue(7),Ft(t.credits),ue(6),Fe("ngForOf",t.buttons),ue(3),Fe("ngForOf",t.filteredOrder))},dependencies:[Mo,Vr,fr,Js],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:1px solid #D70D09}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content-container[_ngcontent-%COMP%]{width:100%;height:92%;overflow-y:auto;scroll-snap-type:y;scrollbar-width:none;display:flex;flex-direction:column;gap:2rem}.content[_ngcontent-%COMP%]{width:85%;height:max-content;display:flex;flex-direction:column;gap:.8rem 5% 0 5%;padding:.8rem 1.2rem;border:.25px solid rgb(127,126,126);border-radius:.5rem}.icons-div[_ngcontent-%COMP%]{width:100%;display:flex;gap:1rem;justify-content:space-between}.iconsss[_ngcontent-%COMP%]{display:flex;gap:1rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:21.94px;text-align:left;color:#000}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:300;line-height:19.73px;text-align:left;color:#000}']});let d=s;return d})();var ij=["videoPlayer"],nj=["activeVideo"];function rj(d,s){if(d&1){let u=Xt();V(0,"div",10),Pe("click",function(){let l=mt(u).index,t=rt();return pt(t.getVideoUrl(l))}),V(1,"div",11),Pe("click",function(){let l=mt(u).index,t=rt();return pt(t.getVideoUrl(l))}),Me(2,"img",12),j(),Me(3,"br"),j()}}function oj(d,s){if(d&1){let u=Xt();V(0,"div",13),Pe("click",function(){mt(u);let l=rt();return pt(l.stopVideo())}),V(1,"video",14,0),Pe("ended",function(){mt(u);let l=rt();return pt(l.onVideoEnded())})("timeupdate",function(){mt(u);let l=va(2),t=rt();return pt(t.preventSeek(l))})("loadedmetadata",function(){mt(u);let l=va(2),t=rt();return pt(t.onVideoLoaded(l))}),j()()}if(d&2){let u=rt();ue(),Fe("src",u.getVideoUrl(u.currentVideoIndex),Fn)}}function aj(d,s){if(d&1){let u=Xt();V(0,"div")(1,"button",15),Pe("click",function(){mt(u);let l=rt();return pt(l.navigateWaiting())}),$(2,"Go to Home"),j()()}}var mA=(()=>{let s=class s{navBack(){}constructor(r,l,t,_){this.http=r,this.tranningService=l,this.router=t,this.userService=_,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1,this.showNavigationButton=!1}ngOnInit(){this.gettingVideos(),this.getWork()}gettingVideos(){this.tranningService.gettingInductionVeideos().subscribe(r=>{console.log(r),this.videos=r},r=>{console.log(r)})}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r);let l=r.works.map(t=>t.categoryId._id);this.getVideosForIds(["6701477d6cdbd8a62eb1bafa"])},r=>{console.log(r)})}getVideosForIds(r){console.log(r),this.tranningService.getInductionVideosByIds(r).subscribe(l=>{console.log(l.flat())},l=>{console.log(l)})}playVideo(r){this.pupUp=!0,this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){this.pupUp=!1,this.playNextVideo()}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):(this.isVideoPlaying=!1,alert("Congrats you have completed the traning"),this.navigateWaiting(),this.showNavigationButton=!0)}getVideoUrl(r){return this.pupUp=!0,`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[r].videoKey}`}navigateWaiting(){this.router.navigate(["waiting"])}};s.\u0275fac=function(l){return new(l||s)(fe(Wi),fe(Gm),fe(Nt),fe(Gn))},s.\u0275cmp=_t({type:s,selectors:[["app-induction"]],viewQuery:function(l,t){if(l&1&&(bi(ij,5),bi(nj,5)),l&2){let _;gi(_=_i())&&(t.videoPlayer=_.first),gi(_=_i())&&(t.activeVideo=_.first)}},decls:15,vars:5,consts:[["activeVideo",""],[1,"tittle-div"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-tittle-div"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"],[3,"click"]],template:function(l,t){l&1&&(V(0,"div",1)(1,"span",2),Pe("click",function(){return t.navBack()}),$(2,"arrow_back"),j(),V(3,"span",3),$(4,"Induction videos"),j()(),V(5,"div",4)(6,"span"),$(7," Complete the Training session!! "),j(),V(8,"span"),$(9," You will be moved to next process "),j()(),V(10,"div",5)(11,"div",6),Bt(12,rj,4,0,"div",7),j()(),Bt(13,oj,3,1,"div",8)(14,aj,3,0,"div",9)),l&2&&(ue(10),Mi("blur",t.isVideoPlaying),ue(2),Fe("ngForOf",t.videos),ue(),Fe("ngIf",t.pupUp),ue(),Fe("ngIf",t.showNavigationButton))},dependencies:[Vr,fr],styles:['.tittle-div[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin:1rem 0 2rem 1rem}.tittle[_ngcontent-%COMP%]{font-size:1.3rem;font-family:"inter" sans-serif;font-weight:500}.sub-tittle-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem;justify-content:center;text-align:center;margin-bottom:1rem}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:500;color:red}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:400;color:#0009}#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}']});let d=s;return d})();var pA=(()=>{let s=class s{constructor(r,l){this.logInService=r,this.router=l}navTo(){console.log(localStorage.getItem("providerId")),localStorage.getItem("providerId")?this.router.navigate(["home"]):this.router.navigate(["selectAccount"])}};s.\u0275fac=function(l){return new(l||s)(fe(Wn),fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-start"]],decls:17,vars:0,consts:[["id","main"],[1,"container"],[1,"logo"],["src","assets/logo/logo png1.png","alt","Coolie No. 1"],[1,"check"],[1,"content"],["src","assets/location/login-home-services-image.png","alt","Worker",1,"worker-image"],[1,"text"],[1,"cta-button",3,"click"],["src","assets/new/arrow.png"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2),Me(3,"img",3),j()(),V(4,"div",4)(5,"div",5),Me(6,"img",6),V(7,"div",7)(8,"span"),$(9,"Home "),V(10,"span"),$(11,"SERVICES"),j()(),V(12,"span"),$(13,"at your Door Step"),j(),V(14,"button",8),Pe("click",function(){return t.navTo()}),$(15,"Let's Go \xA0 "),Me(16,"img",9),j()()()()())},styles:["#main[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100vh;background:radial-gradient(circle at bottom right,#cd2e28 60%,#fff 40%)}.container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;flex:0 0 40%}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80%;max-width:300px;margin-bottom:20px}.content[_ngcontent-%COMP%]{width:100%;position:relative;display:flex;flex-direction:column;align-items:center}.worker-image[_ngcontent-%COMP%]{width:50%;height:50%}.check[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;flex:0 0 60%}.text[_ngcontent-%COMP%]{margin-top:5%;text-align:center;display:flex;flex-direction:column}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Roboto;font-size:1.5rem;color:#fff}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-weight:300;line-height:1.6rem}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1)   span[_ngcontent-%COMP%]{font-weight:500}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-weight:300;line-height:1.4rem}.cta-button[_ngcontent-%COMP%]{background-color:transparent;color:#ffffffde;border:none;padding:22px 30px;font-size:1.5rem;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border-radius:5px}.cta-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:38px;height:28px}"]});let d=s;return d})();function sj(d,s){d&1&&(V(0,"span"),$(1,"\u2192"),j())}function lj(d,s){d&1&&(V(0,"span"),$(1,"\u2714"),j())}function cj(d,s){d&1&&(V(0,"span"),$(1,"\u2192"),j())}function dj(d,s){d&1&&(V(0,"span"),$(1,"\u2714"),j())}var fA=(()=>{let s=class s{constructor(r,l,t){this.loginService=r,this.router=l,this.jobDetailsService=t,this.isExistingActive=!1,this.isNewActive=!1,this.startX=0,this.currentX=0,this.sliderPosition=5,this.isDragging=!1;let _=localStorage.getItem("providerId");this.jobDetailsService.getUserDetails(_)}onTouchStart(r,l){this.startX=r.touches[0].clientX,this.isDragging=!0}onTouchMove(r,l){this.isDragging&&(this.currentX=r.touches[0].clientX-this.startX,this.updateSliderPosition(this.currentX,l))}onTouchEnd(r){this.isDragging=!1,this.checkFinalPosition(r)}onMouseDown(r,l){this.startX=r.clientX,this.isDragging=!0}onMouseMove(r,l){this.isDragging&&(this.currentX=r.clientX-this.startX,this.updateSliderPosition(this.currentX,l))}onMouseUp(r){this.isDragging=!1,this.checkFinalPosition(r)}updateSliderPosition(r,l){if(l==="existing"){let C=Math.min(Math.max(5,5+r),240);this.sliderPosition=C}else if(l==="new"){let C=Math.min(Math.max(5,5+r),240);this.sliderPosition=C}}checkFinalPosition(r){r==="existing"?this.sliderPosition>150&&!this.isExistingActive?(this.isExistingActive=!0,this.sliderPosition=240,this.onToggleChange("existing")):(this.sliderPosition=5,this.isExistingActive=!1):r==="new"&&(this.sliderPosition>150&&!this.isNewActive?(this.isNewActive=!0,this.sliderPosition=240,this.onToggleChange("new")):(this.sliderPosition=5,this.isNewActive=!1))}onToggleChange(r){r==="existing"?(this.loginService.setLogInApi(),this.navigateBasedOnAccount()):r==="new"&&(this.loginService.setSignUpApi(),setTimeout(()=>{this.router.navigate(["log-in"])},1e3))}navigateBasedOnAccount(){localStorage.getItem("providerId")?this.jobDetailsService.userDetails?setTimeout(()=>{this.router.navigate(["home"])},1e3):setTimeout(()=>{this.router.navigate(["aboutUser"])},1e3):setTimeout(()=>{this.router.navigate(["log-in"])},1e3)}};s.\u0275fac=function(l){return new(l||s)(fe(Wn),fe(Nt),fe(Cr))},s.\u0275cmp=_t({type:s,selectors:[["app-select-account"]],decls:23,vars:8,consts:[[1,"container"],[1,"sub-container"],[1,"sp-div"],[1,"img-div"],["src","assets/logo/start2.png","alt","Logo"],[1,"slide-container",3,"touchstart","touchmove","touchend","mousedown","mousemove","mouseup"],[1,"placehlder"],[1,"slider"],[4,"ngIf"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),$(4,"Hey!"),j(),V(5,"span"),$(6,"Join now"),j()(),V(7,"div",3),Me(8,"img",4),j(),V(9,"div",5),Pe("touchstart",function(C){return t.onTouchStart(C,"existing")})("touchmove",function(C){return t.onTouchMove(C,"existing")})("touchend",function(){return t.onTouchEnd("existing")})("mousedown",function(C){return t.onMouseDown(C,"existing")})("mousemove",function(C){return t.onMouseMove(C,"existing")})("mouseup",function(){return t.onMouseUp("existing")}),V(10,"div",6)(11,"span"),$(12,"Existing Provider"),j()(),V(13,"div",7),Bt(14,sj,2,0,"span",8)(15,lj,2,0,"span",8),j()(),V(16,"div",5),Pe("touchstart",function(C){return t.onTouchStart(C,"new")})("touchmove",function(C){return t.onTouchMove(C,"new")})("touchend",function(){return t.onTouchEnd("new")})("mousedown",function(C){return t.onMouseDown(C,"new")})("mousemove",function(C){return t.onMouseMove(C,"new")})("mouseup",function(){return t.onMouseUp("new")}),V(17,"div",6)(18,"span"),$(19,"New Provider"),j()(),V(20,"div",7),Bt(21,cj,2,0,"span",8)(22,dj,2,0,"span",8),j()()()()),l&2&&(ue(13),Mi("active",t.isExistingActive),ue(),Fe("ngIf",!t.isExistingActive),ue(),Fe("ngIf",t.isExistingActive),ue(5),Mi("active",t.isNewActive),ue(),Fe("ngIf",!t.isNewActive),ue(),Fe("ngIf",t.isNewActive))},dependencies:[fr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;background-color:#f5f5f5}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:400px;display:flex;flex-direction:column;align-items:center;row-gap:1rem}.sp-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:left}span[_ngcontent-%COMP%]{float:left;font-family:Poppins,sans-serif;font-size:24px;font-weight:600;line-height:36px;text-align:left}.img-div[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.img-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.slide-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#d16611;border-radius:25px;position:relative;display:flex;align-items:center}.slider[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-size:14px;font-weight:200;position:absolute;left:calc(var(--sliderPosition, 5px));transition:left .3s}.slider.active[_ngcontent-%COMP%]{left:80%}.placehlder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:50px;font-family:"Poppins" sans-serif;font-size:16px;font-weight:400;color:#fff}']});let d=s;return d})();var gA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=_t({type:s,selectors:[["app-congrats"]],decls:14,vars:0,consts:[[1,"main"],[1,"container"],["src","assets/new/congrats.png"],[1,"text"],[1,"arrow-container"],["src","assets/new/round arrow.png"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"div"),Me(3,"img",2),j(),Me(4,"br"),V(5,"div",3)(6,"p"),$(7,"congratulations"),j(),V(8,"p"),$(9,"You have completed induction videos"),j(),V(10,"p"),$(11,"you are now. Partner of Coolieno1! You are successfully on boarded."),j()()(),V(12,"div",4),Me(13,"img",5),j()())},styles:['.main[_ngcontent-%COMP%]{width:100%;height:100vh}.container[_ngcontent-%COMP%]{width:100%;display:grid;row-gap:1rem;align-items:center;justify-content:center;text-align:center;position:relative;top:15%}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;height:max-content}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){width:100%;display:flex;align-items:center;justify-content:center}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:130px;height:130px}.arrow-container[_ngcontent-%COMP%]{position:fixed;bottom:10%;left:40%;display:flex;align-items:center;justify-content:center}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(1){font-family:"Archivo" sans-serif Black;font-size:1.2rem;font-weight:600;line-height:17.41px;letter-spacing:.04em}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(2){font-family:"inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.04em}']});let d=s;return d})();var hj=d=>({"first-package":d,package:!0});function uj(d,s){d&1&&(V(0,"span"),$(1," Activated Package "),j())}function mj(d,s){if(d&1){let u=Xt();V(0,"p",7)(1,"span"),$(2,"UPGRADE TO"),j(),V(3,"button",14),Pe("click",function(){mt(u);let l=rt().$implicit,t=rt();return pt(t.buy(l))}),$(4,"Buy Now"),j()()}if(d&2){let u=rt().$implicit,r=rt();ue(3),Fe("disabled",r.isPackageActivated(u))}}function pj(d,s){d&1&&(V(0,"span"),$(1,"Amount Payable"),j())}function fj(d,s){if(d&1&&(V(0,"div",6),Me(1,"br"),V(2,"div")(3,"p",7),Bt(4,uj,2,0,"span",8)(5,mj,5,1,"ng-template",null,0,Tm),j(),V(7,"p",9),Me(8,"img",10),$(9," \xA0"),V(10,"span"),$(11),j()(),V(12,"p",7)(13,"span")(14,"span",11),$(15,"Current"),j(),$(16," \xA0 "),V(17,"span",12),$(18,"lock_open"),j()(),V(19,"span"),$(20),j()(),V(21,"ul")(22,"li"),$(23),j(),V(24,"li"),$(25),j()(),V(26,"p",7),Bt(27,pj,2,0,"span",13),V(28,"span"),$(29),j()()()()),d&2){let u=s.$implicit,r=va(6),l=rt();Fe("ngClass",ci(11,hj,u.packageName==="silver")),ue(4),Fe("ngIf",l.isPackageActivated(u))("ngIfElse",r),ue(4),Fe("src",u.image,Fn),ue(3),Ft(u.packageName),ue(9),xa(" ",l.isPackageActivated(u)?"Expiry":"Validity"," : ",l.isPackageActivated(u)?l.getExpiryDate(u.packageName):u.validity," "),ue(3),ki("",u.noOfJobOffers," jobs"),ue(2),ki("",u.discountPlatformCom," % discount on platform commission"),ue(2),Fe("ngIf",!l.isEnrolled),ue(2),ki("\u20B9 ",u.priceRs,"")}}var _A=(()=>{let s=class s{constructor(r,l,t,_){this.userDetails=r,this.location=l,this.razorPayService=t,this.dailougeBoxService=_,this.isEnrolled=!0,this.packages=[],this.purchasedPackages=[],this.getPackage(),this.getPurchasedPackages()}navToBack(){this.location.back()}getPackage(){this.userDetails.getPackages().subscribe(r=>{console.log(r),this.packages=r},r=>{console.log(r)})}getPurchasedPackages(){let r=localStorage.getItem("providerId");this.userDetails.getPurchasedPackages(r).subscribe(l=>{console.log("Purchased packages:",l),this.purchasedPackages=l,this.getExpiryDate(l.packageName)},l=>{console.error("Error fetching purchased packages:",l)})}getExpiryDate(r){let l=this.purchasedPackages.find(t=>t.packageName===r);return l?l.expiryDate.split("T")[0]:"N/A"}isPackageActivated(r){return this.purchasedPackages.some(l=>l.packageName===r.packageName)}buy(r){if(this.isAnyPackageActivated()){this.dailougeBoxService.openDialog("You already have an active package. Please wait until it expires.");return}if(!this.validatePackageData(r)){this.dailougeBoxService.openDialog("Package data is not valid. Please check the package details.");return}let l=r.priceRs,t="INR";this.razorPayService.createOrder(l).subscribe({next:_=>{console.log("Order created:",_),this.payWithRazorpay(l,_.id,t,r)},error:_=>{console.error("Error creating order:",_),this.dailougeBoxService.openDialog(_.error.message)}})}isAnyPackageActivated(){return this.purchasedPackages.length>0&&this.purchasedPackages.some(r=>new Date(r.expiryDate)>new Date)}validatePackageData(r){return r&&r.packageName&&r.priceRs&&r.discountPlatformCom!==void 0&&r.comments&&r.validity&&r.image}payWithRazorpay(r,l,t,_){let C={key:"rzp_test_b8XfUOQ4u8dlSq",amount:r*100,currency:t,name:"Coolie no.1",description:"Test Transaction",image:"assets/location/logo-v3 3.png",handler:O=>{console.log(O),this.addPackages(O.razorpay_payment_id,_)},prefill:{name:"Customer Name",email:"customer@example.com",contact:"9999999999"},theme:{color:"#3399cc"},modal:{ondismiss:function(){console.log("Checkout form closed")}}};new Razorpay(C).open()}addPackages(r,l){let _={providerId:localStorage.getItem("providerId"),packageName:l.packageName,priceRs:l.priceRs,discountPlatformCom:l.discountPlatformCom,validity:l.validity,paymentId:r,image:l.image};console.log("Request Body:",_),this.userDetails.buyingPackages(_).subscribe({next:C=>{console.log("Package added successfully:",C),this.getPurchasedPackages()},error:C=>{console.error("Error adding package:",C),this.dailougeBoxService.openDialog(C.error.message)}})}};s.\u0275fac=function(l){return new(l||s)(fe(Gn),fe(ii),fe(Eo),fe(zn))},s.\u0275cmp=_t({type:s,selectors:[["app-packages"]],decls:6,vars:1,consts:[["buyButton",""],[1,"container"],[1,"sub-container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"upgrade"],[4,"ngIf","ngIfElse"],[1,"package-name"],[3,"src"],[1,"Current"],[1,"material-symbols-outlined","notranslate",2,"font-size","1rem"],[4,"ngIf"],[3,"click","disabled"]],template:function(l,t){l&1&&(V(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),Pe("click",function(){return t.navToBack()}),$(4,"arrow_back"),j()(),Bt(5,fj,30,13,"div",5),j()()),l&2&&(ue(5),Fe("ngForOf",t.packages))},dependencies:[Mo,Vr,fr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:2rem}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.package[_ngcontent-%COMP%]{border-radius:.6rem;background-color:#414141}.first-package[_ngcontent-%COMP%]{background:#605c5c}.package[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;width:90%;left:5%;top:5%;display:flex;flex-direction:column;gap:.5rem}.upgrade[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.package-name[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center}.package-name[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.package-name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], li[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.Current[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:18px;font-weight:500;line-height:21.78px;text-align:left;color:#fff}.material-symbols-outlined[_ngcontent-%COMP%]{font-variation-settings:"FILL" 0,"wght" 400,"GRAD" 0,"opsz" 20}button[_ngcontent-%COMP%]{background-color:transparent;border:1px solid rgba(212,175,55,1);color:#d4af37;border-radius:.2rem}ul[_ngcontent-%COMP%]{float:left}']});let d=s;return d})();var gj=["videoPlayer"],_j=["activeVideo"];function bj(d,s){if(d&1){let u=Xt();V(0,"div",6),Pe("click",function(){let l=mt(u).index,t=rt();return pt(t.getVideoUrl(l))}),V(1,"div",7),Pe("click",function(){let l=mt(u).index,t=rt();return pt(t.getVideoUrl(l))}),Me(2,"img",8),j(),Me(3,"br"),j()}}function yj(d,s){if(d&1){let u=Xt();V(0,"div",9),Pe("click",function(){mt(u);let l=rt();return pt(l.stopVideo())}),V(1,"video",10,0),Pe("ended",function(){mt(u);let l=rt();return pt(l.onVideoEnded())})("timeupdate",function(){mt(u);let l=va(2),t=rt();return pt(t.preventSeek(l))})("loadedmetadata",function(){mt(u);let l=va(2),t=rt();return pt(t.onVideoLoaded(l))}),j()()}if(d&2){let u=rt();ue(),Fe("src",u.getVideoUrl(u.currentVideoIndex),Fn)}}var bA=(()=>{let s=class s{navBack(){this.location.back()}constructor(r,l,t,_){this.http=r,this.tranningService=l,this.userService=t,this.location=_,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1}ngOnInit(){this.getWork()}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r);let l=r.works.map(t=>t.serviceId._id);this.getVideosForIds(["670ebee772f9da361fe4cdc4","670ebed072f9da361fe4cd1c"])},r=>{console.log(r)})}getVideosForIds(r){console.log(r),this.tranningService.getVideosByIds(r).subscribe(l=>{console.log(l.flat()),this.videos=l.filter(t=>t!==null)},l=>{console.log(l)})}playVideo(r){this.pupUp=!0,console.log(this.pupUp),this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){console.log("ended"),this.pupUp=!1}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):this.isVideoPlaying=!1}getVideoUrl(r){return this.pupUp=!0,console.log(this.pupUp),`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[r].videoKey}`}};s.\u0275fac=function(l){return new(l||s)(fe(Wi),fe(Gm),fe(Gn),fe(ii))},s.\u0275cmp=_t({type:s,selectors:[["app-training"]],viewQuery:function(l,t){if(l&1&&(bi(gj,5),bi(_j,5)),l&2){let _;gi(_=_i())&&(t.videoPlayer=_.first),gi(_=_i())&&(t.activeVideo=_.first)}},decls:11,vars:4,consts:[["activeVideo",""],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"]],template:function(l,t){l&1&&(Me(0,"br")(1,"br"),$(2,"\xA0\xA0 \xA0"),V(3,"span",1),Pe("click",function(){return t.navBack()}),$(4,"arrow_back"),j(),Me(5,"br")(6,"br"),V(7,"div",2)(8,"div",3),Bt(9,bj,4,0,"div",4),j()(),Bt(10,yj,3,1,"div",5)),l&2&&(ue(7),Mi("blur",t.isVideoPlaying),ue(2),Fe("ngForOf",t.videos),ue(),Fe("ngIf",t.pupUp))},dependencies:[Vr,fr],styles:["#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}"]});let d=s;return d})();var Ao=(()=>{let s=class s{constructor(r){this.http=r,this.apiUrl=yn}getOrderDetails(r){let l=`${this.apiUrl}users/order/order/${r}`;return this.http.get(l)}getOrderHistoryId(r){let l=`${this.apiUrl}users/order-history/order/${r}`;return this.http.get(l)}getOrderFromOrderId(r){let l=`${this.apiUrl}users/order/order/${r}`;return this.http.get(l)}uploadBeforeWorkImage(r){let l=`${this.apiUrl}users/order-history/before-work-upload-image`;return this.http.post(l,r)}gettingStatus(r){let l=`${this.apiUrl}users/order-history/order/${r}`;return this.http.get(l)}uploadAfterWorkImage(r){let l=`${this.apiUrl}users/order-history/after-work-upload-image`;return this.http.post(l,r)}feedBack(r){let l=`${this.apiUrl}users/user-feedback`;return this.http.post(l,r)}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var yA=(()=>{let s=class s{constructor(r,l,t,_,C,I,O,N,q){this.router=r,this.jobDetailsService=l,this.orderService=t,this.mapboxService=_,this.routerParam=C,this.location=I,this.afterOrderService=O,this.googleMapService=N,this.getOrderService=q,this.timeLeft=120,this.providerCurrentLocationPlace="",this.current=0,this.max=120,this.radius=100,this.color="rgba(255, 0, 0, 1)",this.background="rgba(253, 5, 0, 0.4)",this.cancelRate=0,this.workingHours=0,this.credits=0,this.userAddress="",this.userCoordinates=[0,0],this.orderIds=[],this.orderId="",this.extractedDetails=[],this.serviceName=[{name:"cleaning"},{name:"tank cleaning"},{name:"tankcleaning"}],this.workSeleceted=this.jobDetailsService.workDetails}ngOnInit(){this.getProvderLocation(),this.startTimer(),this.getOrderId()}startTimer(){this.interval=setInterval(()=>{this.timeLeft>0?(this.timeLeft--,this.current=this.timeLeft):(clearInterval(this.interval),this.getOrderService.clearOrderId(),this.router.navigate(["home"]))},1e3)}ngOnDestroy(){clearInterval(this.interval)}get minutes(){return Math.floor(this.timeLeft/60)}get seconds(){return this.timeLeft%60}getCartId(r){let l=this.order._id,t=_=>{let C=setInterval(()=>{if(this.acceptStatus)if(clearInterval(C),this.acceptStatus){this.acceptStatus=!1,this.acceptedOrder(),console.log("User accepted, exiting the loop");return}else console.log("User declined, moving to the next item"),this.acceptStatus=!1,t(_+1)},1e3);setTimeout(()=>{this.acceptStatus===null&&(clearInterval(C),console.log("Automatically moving to the next item"),t(_+1))},12e4)};t(0)}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{console.log(r);let l=r.get("id");this.getOrderDetails(l)},error:r=>{console.log(r)}})}getOrderDetails(r){r&&(this.orderId=r,console.log(r),this.afterOrderService.getOrderFromOrderId(r).subscribe({next:l=>{console.log(l),this.order=l,this.getUserLocation()},error:l=>{console.log(l)}}))}accepted(){this.acceptStatus=!0,this.acceptedOrder()}declined(){this.acceptStatus=!1,console.log("declined"),this.acceptStatus=!1,this.timeLeft=120,this.getOrderService.clearOrderId(),this.router.navigate(["home"])}acceptedOrder(){console.log("order accepted"),this.orderService.accept(this.orderId,this.order.totalAmount,this.order.userId._id).subscribe(r=>{console.log(r),setTimeout(()=>{this.router.navigate(["arrived",r.orderHistory.orderId])},2e3)},r=>{console.log(r)})}getProvderLocation(){this.googleMapService.getCoordinates().subscribe({next:r=>{console.log(r),this.providerCurrentLocation=r,this.getPlaceNameFromCorr(this.providerCurrentLocation,"provider")},error:r=>{console.log(r)}})}getUserLocation(){console.log("cing user");let r="user",l=this.order.addressId;console.log(this.order);let t={lat:l.latitude,lng:l.longitude};this.getPlaceNameFromCorr(t,r)}getPlaceNameFromCorr(r,l){this.googleMapService.getPlaceNameFromCoordinates(r.lat,r.lng).pipe(tk(1e4),ak(2),Vh(t=>(console.error("Failed to get place name:",t),sr({results:[{formatted_address:"Unknown Location"}]})))).subscribe({next:t=>{let _=t.results[0].formatted_address||"Unknown Location";l==="provider"?(this.providerCurrentLocationPlace=_,console.log("Provider location:",_)):l==="user"&&(this.userAddress=_,console.log("User location:",_))},error:t=>{console.error("Error fetching place name:",t)}})}};s.\u0275fac=function(l){return new(l||s)(fe(Nt),fe(Cr),fe(Sr),fe(qm),fe(To),fe(ii),fe(Ao),fe(Ks),fe(Wm))},s.\u0275cmp=_t({type:s,selectors:[["app-get-order"]],decls:60,vars:16,consts:[[1,"container"],[1,"timer"],[3,"current","max","color","background","radius","rounded","stroke"],[1,"timer-container"],[1,"time"],[1,"location-container"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px"],[1,"line"],[1,"address"],[1,"location-txt"],[1,"location"],[1,"service-details"],[1,"main-Text"],[1,"value-Text"],[1,"acc-rej-btns"],[3,"click"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1),Me(2,"round-progress",2),V(3,"div",3)(4,"p",4)(5,"span"),$(6),j(),V(7,"span"),$(8,"Time left"),j()()()(),V(9,"div",5)(10,"div")(11,"span",6),$(12," location_on "),j(),Me(13,"div",7),V(14,"span",6),$(15," location_on "),j()(),V(16,"div",8)(17,"p")(18,"span",9),$(19,"My location"),j(),V(20,"span",10),$(21),j()(),Me(22,"br")(23,"br"),V(24,"p")(25,"span",9),$(26,"User location"),j(),V(27,"span",10),$(28),j()()()(),V(29,"div",11)(30,"span")(31,"span",12),$(32,"Category Type :"),j(),V(33,"span",13),$(34),j()(),V(35,"span")(36,"span",12),$(37,"SubService Type :"),j(),V(38,"span",13),$(39),j()(),V(40,"span")(41,"span",12),$(42,"Service Name :"),j(),V(43,"span",13),$(44),j()(),V(45,"span")(46,"span",12),$(47,"Price :"),j(),V(48,"span",13),$(49),j()(),V(50,"span")(51,"span",12),$(52,"Schedule :"),j(),V(53,"span",13),$(54),j()()(),V(55,"div",14)(56,"button",15),Pe("click",function(){return t.declined()}),$(57,"Reject"),j(),V(58,"button",15),Pe("click",function(){return t.accepted()}),$(59,"Accept"),j()()()),l&2&&(ue(2),Fe("current",t.current)("max",t.max)("color",t.color)("background",t.background)("radius",t.radius)("rounded",!0)("stroke",10),ue(4),xa("",t.minutes,":",t.seconds<10?"0"+t.seconds:t.seconds,""),ue(15),Ft(t.providerCurrentLocationPlace),ue(7),Ft(t.userAddress),ue(6),Ft(t.order==null||t.order.categoryIds[0]==null?null:t.order.categoryIds[0].name),ue(5),Ft(t.order==null||t.order.subCategoryIds[0]==null?null:t.order.subCategoryIds[0].name),ue(5),Ft(t.order==null||t.order.subCategoryIds[0]==null?null:t.order.subCategoryIds[0].name),ue(5),Ft(t.order==null?null:t.order.totalAmount),ue(5),Ft(t.order==null||t.order.items[0]==null?null:t.order.items[0].scheduledDate))},dependencies:[Nb],styles:[".container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;top:5%;left:2.5%;display:flex;flex-direction:column;gap:2rem}.timer[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.timer-container[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center}.time[_ngcontent-%COMP%]{font-size:2em;text-align:center;display:flex;flex-direction:column;gap:.5rem}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1rem}.location-container[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:10% 80%}.location-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){display:flex;flex-direction:column;align-items:center;justify-content:center}.line[_ngcontent-%COMP%]{width:1px;height:6rem;border-left:.25px dashed black}.address[_ngcontent-%COMP%], .address[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:left}.location-txt[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500}.location[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:.9rem;font-weight:400;color:#b8b8b8}.service-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.main-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500;color:#5a5a5a80}.value-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:400;color:#515151}.acc-rej-btns[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-around}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:150px;height:50px;border:none;border-radius:.4rem;font-family:Inter,sans-serif;font-size:1rem;font-weight:500;letter-spacing:1px;color:#fff;text-align:center}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#d70d09}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:#409000}"]});let d=s;return d})();var vj=["map"],vA=(()=>{let s=class s{constructor(r,l,t,_,C,I,O,N){this.router=r,this.routerParam=l,this.mapboxService=t,this.orderService=_,this.location=C,this.googleMapsService=I,this.dailogeBoxService=O,this.afterOrderService=N,this.toggleChecked=!1,this.distanceThreshold=200,this.orderHistoryId=""}ngOnInit(){this.userFullAddress=this.orderService.userFullAddress,this.getOrderId()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.getUserLocation()},error:l=>{console.log(l)}}))}getUserLocation(){console.log("cing user");let r="user",l=this.order?.addressId;console.log(this.order);let t={lat:l?.latitude,lng:l?.longitude};this.userCoordinates=t,this.initializeMap()}initializeMap(){this.googleMapsService.getCoordinates().subscribe({next:r=>{if(!r){console.error("Provider coordinates are null");return}if(this.providerCoordinates=r,!this.userCoordinates){console.error("User coordinates are null");return}this.googleMapsService.initializeMap(this.providerCoordinates,this.mapElement.nativeElement),this.googleMapsService.addProviderMarker(this.providerCoordinates),this.googleMapsService.addUserMarker(this.userCoordinates),this.googleMapsService.showDirections(this.userCoordinates,this.providerCoordinates),this.trackProviderAndCheckArrival(),this.getUserFullAddress()},error:r=>{console.error("Error fetching provider coordinates:",r)}})}getUserFullAddress(){let r=this.userCoordinates.lat,l=this.userCoordinates.lng;this.googleMapsService.getPlaceNameFromCoordinates(r,l).subscribe({next:t=>{console.log("user full address",t),console.log(t.results[0].formatted_address),this.userFullAddress=t.results[0].formatted_address}})}trackProviderAndCheckArrival(){this.locationTrackingSubscription=this.googleMapsService.trackProviderLocation().subscribe(r=>{this.providerCoordinates=r,this.googleMapsService.updateProviderMarker(this.providerCoordinates);let l=this.googleMapsService.calculateDistance(this.userCoordinates.lat,this.userCoordinates.lng,this.providerCoordinates.lat,this.providerCoordinates.lng);console.log("Distance between user and provider:",l),this.googleMapsService.showDirections(this.userCoordinates,this.providerCoordinates),l<=this.distanceThreshold&&(this.toggleChecked=!0)})}navTOBack(){this.location.back()}toggleDisplay(r){this.toggleChecked&&(console.log("Arrived at user location"),this.router.navigate(["startWork",this.orderHistoryId])),console.log("Arrived at user location"),this.router.navigate(["startWork",this.orderHistoryId])}handleDisabledClick(){console.log("insideeeeeeee"),this.toggleChecked||this.dailogeBoxService.openDialog("You are not arrives at location.")}cancel(){this.orderService.cancelOrder().subscribe(r=>{console.log(r),this.router.navigate(["home"])},r=>{console.log(r)})}ngOnDestroy(){this.locationTrackingSubscription&&(this.locationTrackingSubscription.unsubscribe(),console.log("Stopped tracking provider\u2019s location."))}};s.\u0275fac=function(l){return new(l||s)(fe(Nt),fe(To),fe(qm),fe(Sr),fe(ii),fe(Ks),fe(zn),fe(Ao))},s.\u0275cmp=_t({type:s,selectors:[["app-arvied"]],viewQuery:function(l,t){if(l&1&&bi(vj,7),l&2){let _;gi(_=_i())&&(t.mapElement=_.first)}},decls:18,vars:1,consts:[["map",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"arival-status"],[3,"click"],["id","map",2,"height","500px","width","100%"],[1,"location"],[1,"material-symbols-outlined","notranslate"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"click","change"],["for","toggle",1,"already-label"]],template:function(l,t){if(l&1){let _=Xt();V(0,"section",1)(1,"span",2),Pe("click",function(){return mt(_),pt(t.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",3)(4,"span"),$(5,"On the way "),j(),V(6,"button",4),Pe("click",function(){return mt(_),pt(t.cancel())}),$(7,"Cancel"),j()(),Me(8,"div",5,0),V(10,"div",6)(11,"span",7),$(12," near_me "),j(),V(13,"span"),$(14),j()(),V(15,"div",8)(16,"input",9),Pe("click",function(){return mt(_),pt(t.handleDisabledClick())})("change",function(I){return mt(_),pt(t.toggleDisplay(I))}),j(),Me(17,"label",10),j()()}l&2&&(ue(14),ki(" ",t.userFullAddress," "))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;top:2.5%;display:flex;flex-direction:column;gap:2rem}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}.arival-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:6rem;height:2.5rem;color:#fff;background-color:transparent;border:.25px solid #ffff;font-family:"Poppins" sans-serif;font-size:1.1rem;font-weight:500;border-radius:.4rem;margin-right:1rem}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:46px;left:2%;bottom:5%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Arrived";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let d=s;return d})();var xj=["map"],xA=(()=>{let s=class s{constructor(r,l,t,_,C,I){this.router=r,this.routerParam=l,this.orderService=t,this.googleMapsService=_,this.location=C,this.afterOrderService=I,this.toggleChecked=!1,this.orderHistoryId=""}ngAfterViewInit(){this.getOrderId()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.getUserLocationCoordinates()},error:l=>{console.log(l)}}))}initializeMap(r){return Ln(this,null,function*(){let l=r;this.getUserFullAddress(l),this.locationTrackingSubscription=this.googleMapsService.getCoordinates().subscribe(t=>{if(!t){console.error("Provider coordinates are null");return}this.googleMapsService.initializeMap(t,this.mapElement.nativeElement),this.googleMapsService.addProviderMarker(t),this.googleMapsService.addUserMarker(l),this.googleMapsService.showDirections(t,l)})})}getUserLocationCoordinates(){return Ln(this,null,function*(){console.log("inside user location");let r=this.order?.addressId;if(r){let l={lat:r.latitude,lng:r.longitude};return console.log("user coordinates",l),this.initializeMap(l),l}else{let l={lat:0,lng:0};return this.initializeMap(l),l}})}getUserFullAddress(r){let l=r.lat,t=r.lng;this.googleMapsService.getPlaceNameFromCoordinates(l,t).subscribe({next:_=>{console.log("user full address",_),console.log(_.results[0].formatted_address),this.userFullAddress=_.results[0].formatted_address}})}navTOBack(){this.location.back()}toggleDisplay(r){this.toggleChecked=!this.toggleChecked,this.router.navigate(["work/otp",this.orderHistoryId])}navToChat(){let r={role:"user",id:this.order.userId};this.router.navigate(["help/chatbot"],{queryParams:r})}ngOnDestroy(){this.locationTrackingSubscription&&(this.locationTrackingSubscription.unsubscribe(),console.log("Stopped tracking provider\u2019s location."))}};s.\u0275fac=function(l){return new(l||s)(fe(Nt),fe(To),fe(Sr),fe(Ks),fe(ii),fe(Ao))},s.\u0275cmp=_t({type:s,selectors:[["app-start-work"]],viewQuery:function(l,t){if(l&1&&bi(xj,5),l&2){let _;gi(_=_i())&&(t.mapElement=_.first)}},decls:21,vars:1,consts:[["map",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"arival-status"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px","margin-right","1.5rem"],[1,"material-symbols-outlined","notranslate",2,"font-size","24px","margin-right","1.5rem",3,"click"],["id","map",2,"height","500px","width","100%"],[1,"location"],[1,"material-symbols-outlined","notranslate"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"change"],["for","toggle",1,"already-label"]],template:function(l,t){if(l&1){let _=Xt();V(0,"section",1)(1,"span",2),Pe("click",function(){return mt(_),pt(t.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",3)(4,"span"),$(5,"Reached customer location"),j(),V(6,"div")(7,"span",4),$(8,"call"),j(),V(9,"span",5),Pe("click",function(){return mt(_),pt(t.navToChat())}),$(10,"forum"),j()()(),Me(11,"div",6,0),V(13,"div",7)(14,"span",8),$(15,"near_me"),j(),V(16,"span"),$(17),j()(),V(18,"div",9)(19,"input",10),Pe("change",function(I){return mt(_),pt(t.toggleDisplay(I))}),j(),Me(20,"label",11),j()()}l&2&&(ue(17),Ft(t.userFullAddress))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;display:flex;flex-direction:column;gap:2rem;margin-top:2.5%}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.map[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:60px;left:2%;bottom:5%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:10px;left:15px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Start working";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let d=s;return d})();var wj=["input1"],Cj=["input2"],Sj=["input3"],Mj=["input4"],wA=(()=>{let s=class s{navTOBack(){this.location.back()}constructor(r,l,t,_,C,I,O){this.form=r,this.orderService=l,this.routerParam=t,this.afterOrderService=_,this.router=C,this.dialougeBOxService=I,this.location=O,this.orderHistoryId="",this.orderId=""}ngOnInit(){this.getOrderId(),this.getOtp(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,l){if(r.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.orderId=l._id,this.getOrderHistoryId(this.orderId)},error:l=>{console.log(l)}}))}getOrderHistoryId(r){this.afterOrderService.getOrderHistoryId(r).subscribe({next:l=>{console.log(l),this.orderHistoryId=l.data._id},error:l=>{console.log(l)}})}getOtp(){}verifyOtp(){let r=this.otp.value,l=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(l);let t={orderHistoryId:this.orderHistoryId,uniqueNumber:l,userId:this.order.userId,orderId:this.orderId};console.log(t),this.orderService.verifyStartOrder(t).subscribe({next:_=>{console.log(_),this.dialougeBOxService.openDialog("OTP verified sucessfully"),this.router.navigate(["workImage",this.orderId])},error:_=>{console.log(_),this.dialougeBOxService.openDialog(_.error.message)}})}};s.\u0275fac=function(l){return new(l||s)(fe(Qo),fe(Sr),fe(To),fe(Ao),fe(Nt),fe(zn),fe(ii))},s.\u0275cmp=_t({type:s,selectors:[["app-work-otp"]],viewQuery:function(l,t){if(l&1&&(bi(wj,5),bi(Cj,5),bi(Sj,5),bi(Mj,5)),l&2){let _;gi(_=_i())&&(t.input1=_.first),gi(_=_i())&&(t.input2=_.first),gi(_=_i())&&(t.input3=_.first),gi(_=_i())&&(t.input4=_.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){if(l&1){let _=Xt();V(0,"div",4)(1,"span",5),Pe("click",function(){return mt(_),pt(t.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),Me(5,"img",8),j(),V(6,"span")(7,"span",9),$(8,"Before start the work"),j(),Me(9,"br"),V(10,"span",10),$(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Pe("input",function(I){return mt(_),pt(t.onInput(I,1))}),j(),V(16,"input",14,1),Pe("input",function(I){return mt(_),pt(t.onInput(I,2))}),j(),V(18,"input",15,2),Pe("input",function(I){return mt(_),pt(t.onInput(I,3))}),j(),V(20,"input",16,3),Pe("input",function(I){return mt(_),pt(t.onInput(I,4))}),j()(),V(22,"button",17),Pe("click",function(){return mt(_),pt(t.verifyOtp())}),$(23,"Confirm"),j()()()()}l&2&&(ue(12),Fe("formGroup",t.otp))},dependencies:[Io,ro,ir,ko,Em,Xo,Ga],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;margin-top:2.5%}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-left:5%}"]});let d=s;return d})();var CA=(()=>{let s=class s{constructor(r,l,t,_,C){this.orderService=r,this.router=l,this.location=t,this.routerParam=_,this.afterOrderService=C,this.total=0,this.orderHistoryId="",this.work={},this.alreadyHasAccount=!1}ngOnInit(){this.getOrderId()}navTOBack(){this.location.back()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{let l=r.get("id");l&&(this.orderHistoryId=l,this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.work=this.order,console.log("work",this.work)},error:l=>{console.log(l)}})}toggleDisplay(){let r=this.work.userId;this.router.navigate(["workImage",this.orderHistoryId],{replaceUrl:!0})}};s.\u0275fac=function(l){return new(l||s)(fe(Sr),fe(Nt),fe(ii),fe(To),fe(Ao))},s.\u0275cmp=_t({type:s,selectors:[["app-work-complete"]],decls:36,vars:6,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"image"],["src","assets/new/Man washing hand.png"],[1,"details"],[1,"details-div"],[1,"about"],[1,"highlight-text"],[1,"sub-title"],[1,"line"],[1,"time-div"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"ngModelChange","change","ngModel"],["for","toggle",1,"already-label"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Pe("click",function(){return t.navTOBack()}),$(2," arrow_back "),j(),V(3,"div",2),Me(4,"img",3),j(),V(5,"section",4)(6,"div",5)(7,"span",6)(8,"span",7),$(9),j()(),V(10,"span",8),$(11),j(),Me(12,"div",9),j(),V(13,"div",10)(14,"p")(15,"span"),$(16,"Others"),j(),Me(17,"br"),V(18,"span",7),$(19,"Convenience Fee"),j()(),V(20,"p",7),$(21,"69"),j()(),Me(22,"div",9)(23,"br"),V(24,"div",10)(25,"p")(26,"span",7),$(27,"Total value"),j(),Me(28,"br"),V(29,"span"),$(30,"commission credits"),j()(),V(31,"p",7),$(32),j()()(),V(33,"div",11)(34,"input",12),Er("ngModelChange",function(C){return Tr(t.alreadyHasAccount,C)||(t.alreadyHasAccount=C),C}),Pe("change",function(){return t.toggleDisplay()}),j(),Me(35,"label",13),j()()),l&2&&(ue(9),xa("",t.work==null||t.work.orderId==null||t.work.orderId.items[0]==null?null:t.work.orderId.items[0].quantity," X ",t.work==null||t.work.orderId==null||t.work.orderId.categoryIds[0]==null?null:t.work.orderId.categoryIds[0].name,""),ue(2),xa("",t.work==null||t.work.orderId==null||t.work.orderId.items[0]==null?null:t.work.orderId.items[0].quantity," X ",t.work==null||t.work.orderId==null||t.work.orderId.subCategoryIds[0]==null?null:t.work.orderId.subCategoryIds[0].name,""),ue(21),Ft(t.work==null||t.work.orderId==null?null:t.work.orderId.totalAmount),ue(2),Ir("ngModel",t.alreadyHasAccount))},dependencies:[Xs,ir,Zo],styles:['.container[_ngcontent-%COMP%]{width:95vw;height:100%;display:flex;flex-direction:column;gap:1rem;position:relative;left:2.5%;right:2.5%;top:2.5%}.image[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.details[_ngcontent-%COMP%], .details-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem}.about[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.slide-toggle[_ngcontent-%COMP%]{position:relative;width:95%;height:46px;left:2%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Placeholder Text";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#bb0e0e;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-size:14px;pointer-events:none}.slide-toggle[_ngcontent-%COMP%]   label.already-label[_ngcontent-%COMP%]:before{content:"Swipe to Complete";color:#fff;font-family:Poppins;font-size:1.1rem;font-weight:500;line-height:22.82px;text-align:left}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;border:.25px solid black;border-radius:.5rem}.line[_ngcontent-%COMP%]{width:100%;height:0;border:0;border-bottom:1px dashed rgb(45,44,44)}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:.9rem;font-weight:400;line-height:14.52px;text-align:left}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:600;line-height:16.94px;text-align:left}']});let d=s;return d})();var kj=["input1"],Ij=["input2"],Tj=["input3"],Ej=["input4"],SA=(()=>{let s=class s{navTOBack(){this.location.back()}constructor(r,l,t,_,C,I){this.form=r,this.orderService=l,this.router=t,this.afterOrderService=_,this.routerParam=C,this.location=I,this.orderHistoryId="",this.orderId="",this.getOrderId(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,l){if(r.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{let l=r.get("id");l&&(this.orderId=l,this.getOrderDetails(l))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.getOrderHistoryId(this.orderId)},error:l=>{console.error(l)}}))}getOrderHistoryId(r){this.afterOrderService.getOrderHistoryId(r).subscribe({next:l=>{console.log(l),this.orderHistoryId=l.data._id},error:l=>{console.log(l)}})}login(){let r=this.otp.value,l=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(l),this.orderService.verifyAfterComplete(l,this.orderHistoryId,this.orderId).subscribe(t=>{console.log(t);let _={userId:this.order.userId?._id,orderHistoryId:this.orderHistoryId};this.router.navigate(["feedback"],{queryParams:_})},t=>{console.log(t)})}};s.\u0275fac=function(l){return new(l||s)(fe(Qo),fe(Sr),fe(Nt),fe(Ao),fe(To),fe(ii))},s.\u0275cmp=_t({type:s,selectors:[["app-verify-after-work"]],viewQuery:function(l,t){if(l&1&&(bi(kj,5),bi(Ij,5),bi(Tj,5),bi(Ej,5)),l&2){let _;gi(_=_i())&&(t.input1=_.first),gi(_=_i())&&(t.input2=_.first),gi(_=_i())&&(t.input3=_.first),gi(_=_i())&&(t.input4=_.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(l,t){if(l&1){let _=Xt();V(0,"div",4)(1,"span",5),Pe("click",function(){return mt(_),pt(t.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),Me(5,"img",8),j(),V(6,"span")(7,"span",9),$(8,"Before start the work"),j(),Me(9,"br"),V(10,"span",10),$(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Pe("input",function(I){return mt(_),pt(t.onInput(I,1))}),j(),V(16,"input",14,1),Pe("input",function(I){return mt(_),pt(t.onInput(I,2))}),j(),V(18,"input",15,2),Pe("input",function(I){return mt(_),pt(t.onInput(I,3))}),j(),V(20,"input",16,3),Pe("input",function(I){return mt(_),pt(t.onInput(I,4))}),j()(),V(22,"button",17),Pe("click",function(){return mt(_),pt(t.login())}),$(23,"Confirm"),j()()()()}l&2&&(ue(12),Fe("formGroup",t.otp))},dependencies:[Io,ro,ir,ko,Em,Xo,Ga],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;margin-top:2.5%;align-items:center}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#cd2e28;margin-left:5%}"]});let d=s;return d})();function Dj(d,s){if(d&1){let u=Xt();V(0,"div",5)(1,"div",6),Pe("click",function(){let l=mt(u).$implicit,t=rt();return pt(t.slect(l))}),Me(2,"img",7),$(3),j(),V(4,"div")(5,"input",8),Er("ngModelChange",function(l){let t=mt(u).$implicit;return Tr(t.checked,l)||(t.checked=l),pt(l)}),Pe("change",function(l){let t=mt(u).$implicit,_=rt();return pt(_.onChange(l,t))}),j()()()}if(d&2){let u=s.$implicit;ue(2),Fe("src",u.imageKey,Fn),ue(),Ft(u.name),ue(2),Ir("ngModel",u.checked)}}var MA=(()=>{let s=class s{constructor(r,l,t,_,C,I){this.loginService=r,this.logInService=l,this.router=t,this.location=_,this.dailougeService=C,this.userDetailsService=I,this.workSeleceted=[],this.items=[]}ngOnInit(){this.getSubServices()}getSubServices(){this.loginService.getSubCategory().subscribe(r=>{console.log(r),this.items=r,this.getWork()},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}autoCheckServices(){this.workSeleceted.forEach(r=>{let l=this.items.filter(t=>t.categoryId===r.categoryId._id);if(l.length>0&&r.serviceId.length>0){let t=r.subcategoryId;l.forEach(_=>{_._id===t._id&&(_.checked=!0,console.log(`Checked subcategory: ${_.name}`))})}})}send(){this.logInService.selectedSubCategories.length>0?this.router.navigate(["services"]):this.dailougeService.openDialog("Please select atleat one sub-category ")}slect(r){let l=this.items.indexOf(r);console.log("categoryId",r._),this.logInService.setSubCat(r._id),this.logInService.selectedSubCategories.length>0?this.router.navigate(["services"]):this.dailougeService.openDialog("Please select atleat one sub-category ")}onChange(r,l){let t=r.target;if(console.log(l),t&&t.checked){let C=this.items.indexOf(l);console.log("categoryId",l._),this.logInService.setSubCat(l._id),this.logInService.selectedSubCategories.length>0?this.router.navigate(["services"]):this.dailougeService.openDialog("Please select atleat one sub-category ")}}navToBack(){this.location.back()}};s.\u0275fac=function(l){return new(l||s)(fe(Wn),fe(Wn),fe(Nt),fe(ii),fe(zn),fe(Gn))},s.\u0275cmp=_t({type:s,selectors:[["app-sub-services"]],decls:10,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"serivce"],[1,"service-div"],[1,"names",3,"click"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Pe("click",function(){return t.navToBack()}),$(2," keyboard_backspace "),j(),V(3,"div",2)(4,"span",3),$(5,"Select Sub-Services"),j(),Me(6,"br"),V(7,"div",4),mr(8,Dj,6,3,"div",5,Zr),j()()()),l&2&&(ue(8),pr(t.items))},dependencies:[Xs,ir,Zo],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;left:5%;align-items:center;display:grid;grid-gap:.5rem;text-align:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.serivce[_ngcontent-%COMP%]{height:78vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.5rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=s;return d})();var kA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=_t({type:s,selectors:[["app-not-found"]],decls:11,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),$(2," wifi_off "),j(),V(3,"span"),$(4,"You're offline"),j(),V(5,"span"),$(6,"Please connect to internet and try again"),j(),V(7,"button")(8,"span",1),$(9," refresh "),j(),$(10," Retry "),j()())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}.material-symbols-outlined[_ngcontent-%COMP%]{font-weight:300}"]});let d=s;return d})();var IA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=_t({type:s,selectors:[["app-location"]],decls:2,vars:0,template:function(l,t){l&1&&(V(0,"p"),$(1,"location works!"),j())}});let d=s;return d})();function Aj(d,s){if(d&1){let u=Xt();V(0,"span",9),Pe("click",function(){mt(u);let l=rt().$implicit,t=rt(2).$implicit,_=rt();return pt(_.removeSubcategory(t._id,l._id))}),$(1," delete "),j()}}function Pj(d,s){if(d&1&&(V(0,"li"),$(1),Bt(2,Aj,2,0,"span",12),j()),d&2){let u=s.$implicit,r=rt(2).$implicit;ue(),ki(" ",u.name," "),ue(),Dn(2,r.serviceId.length>1?2:-1)}}function Oj(d,s){d&1&&(V(0,"p"),$(1,"No subcategories available"),j())}function Rj(d,s){if(d&1){let u=Xt();V(0,"div",7)(1,"h3"),$(2),j(),V(3,"section",8)(4,"h3"),$(5),j(),V(6,"span",9),Pe("click",function(){mt(u);let l=rt().$implicit,t=rt();return pt(t.removeWork(l._id))}),$(7," delete "),j()(),V(8,"div")(9,"h3"),$(10,"Services :"),j(),V(11,"ul"),Bt(12,Pj,3,2,"li",10),j()(),Bt(13,Oj,2,0,"p",11),V(14,"p"),$(15),j()()}if(d&2){let u=rt().$implicit;ue(2),ki("Category : ",u.categoryId.name,""),ue(3),ki(" SubCategory : ",u.subcategoryId.name,""),ue(7),Fe("ngForOf",u.serviceId),ue(),Fe("ngIf",u.subcategoryId.length===0),ue(2),ki("Experience: ",u.experience,"")}}function Lj(d,s){if(d&1&&Bt(0,Rj,16,5,"div",7),d&2){let u=s.$implicit;Dn(0,u.serviceId.length>0?0:-1)}}var TA=(()=>{let s=class s{constructor(r,l,t){this.location=r,this.userDetailsService=l,this.router=t,this.works=[]}ngOnInit(){this.getWork()}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r),this.works=r.works},error:r=>{console.log(r)}})}removeSubcategory(r,l){console.log(r,"subCat",l),this.userDetailsService.deleteServiceWork(r,l).subscribe({next:t=>{console.log(t),this.getWork()},error:t=>{console.log(t)}})}removeWork(r){let l={providerId:localStorage.getItem("providerId"),workId:r};this.userDetailsService.deleteWork(l).subscribe({next:t=>{console.log(t),this.getWork()},error:t=>{console.log(t)}})}navToSelectWork(){this.router.navigate(["selectWork"])}navToBack(){console.log("back"),this.location.back()}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Gn),fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-manage-services"]],decls:15,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined","notranslate",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"new-address",3,"click"],[1,"material-symbols-outlined","notranslate"],[1,"work-div"],[1,"service-section"],[1,"material-icons",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"material-icons"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Pe("click",function(){return t.navToBack()}),$(3,"arrow_back"),j(),V(4,"span",3),$(5,"Manage Services"),j()(),V(6,"div",4)(7,"div",5),Pe("click",function(){return t.navToSelectWork()}),V(8,"div")(9,"span",6),$(10," add "),j(),V(11,"span"),$(12,"Add new Services"),j()()(),mr(13,Lj,1,1,null,null,Zr),j()()),l&2&&(ue(13),pr(t.works))},dependencies:[Vr,fr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:1rem}.new-address[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.6rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:60%;display:flex;align-items:center;gap:.5rem;padding-left:.5rem}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px;color:#f9a600}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center;margin:1rem 0 0 1rem}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.work-div[_ngcontent-%COMP%]{margin-bottom:20px;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:2px 2px 10px #0000001a}h3[_ngcontent-%COMP%]{margin:0;color:#2c3e50}ul[_ngcontent-%COMP%]{list-style:none;padding:0}li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:5px 0;padding:5px;border:1px solid #ddd;border-radius:4px;background-color:#f9f9f9}p[_ngcontent-%COMP%]{color:#7f8c8d;font-size:14px;margin:5px 0}.material-icons[_ngcontent-%COMP%]{cursor:pointer;color:#e74c3c;font-size:24px;transition:color .2s ease}.material-icons[_ngcontent-%COMP%]:hover{color:#c0392b}p[ngIf][_ngcontent-%COMP%]{color:#95a5a6;font-style:italic}.service-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem}']});let d=s;return d})();var EA=(()=>{let s=class s{constructor(r,l,t,_,C){this.location=r,this.routerParam=l,this.afterOrderService=t,this.dailougeBoxService=_,this.router=C,this.rating=0,this.userFeedback="",this.userId="",this.orderHistoryId="",this.getUser()}getUser(){this.routerParam.queryParams.subscribe({next:r=>{this.userId=r.userId,this.orderHistoryId=r.orderHistoryId}})}rate(r){this.rating=r}submitFeedback(){if(this.rating===0){alert("Please provide a rating before submitting.");return}if(this.userFeedback.trim()===""){alert("Please provide your feedback before submitting.");return}console.log("Rating:",this.rating),console.log("Feedback:",this.userFeedback),console.log(this.userId);let r={userId:this.userId,providerId:localStorage.getItem("providerId"),orderHistoryId:this.orderHistoryId,rating:this.rating,description:this.userFeedback};console.log(r),this.afterOrderService.feedBack(r).subscribe({next:l=>{console.log(l),this.dailougeBoxService.openDialog("feedback send sucessfully"),this.router.navigate(["home"])},error:l=>{console.log(l)}}),this.rating=0,this.userFeedback=""}navToBack(){this.location.back()}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(To),fe(Ao),fe(zn),fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-feedback"]],decls:26,vars:11,consts:[[1,"feedback-container"],[1,"material-symbols-outlined","back-icon",3,"click"],[1,"success-icon"],["src","assets/demo/done.png"],[1,"star-div"],[1,"star-rating-section"],[1,"star-rating"],[1,"star",3,"click"],[1,"rating-text"],[1,"rating-subtext"],[1,"feedback-text"],["placeholder","Write your text","rows","4",3,"ngModelChange","ngModel"],[1,"submit-btn",3,"click"]],template:function(l,t){l&1&&(V(0,"section",0)(1,"span",1),Pe("click",function(){return t.navToBack()}),$(2,"arrow_back"),j(),V(3,"div",2),Me(4,"img",3),j(),V(5,"div",4)(6,"div",5)(7,"div",6)(8,"span",7),Pe("click",function(){return t.rate(1)}),$(9,"\u2605"),j(),V(10,"span",7),Pe("click",function(){return t.rate(2)}),$(11,"\u2605"),j(),V(12,"span",7),Pe("click",function(){return t.rate(3)}),$(13,"\u2605"),j(),V(14,"span",7),Pe("click",function(){return t.rate(4)}),$(15,"\u2605"),j(),V(16,"span",7),Pe("click",function(){return t.rate(5)}),$(17,"\u2605"),j()(),V(18,"p",8),$(19,"Excellent"),j(),V(20,"p",9),$(21,"You rated Sergio Ramos 5 star"),j()(),V(22,"div",10)(23,"textarea",11),Er("ngModelChange",function(C){return Tr(t.userFeedback,C)||(t.userFeedback=C),C}),j()(),V(24,"button",12),Pe("click",function(){return t.submitFeedback()}),$(25,"Submit"),j()()()),l&2&&(ue(8),Mi("filled",t.rating>=1),ue(2),Mi("filled",t.rating>=2),ue(2),Mi("filled",t.rating>=3),ue(2),Mi("filled",t.rating>=4),ue(2),Mi("filled",t.rating>=5),ue(7),Ir("ngModel",t.userFeedback))},dependencies:[ro,ir,Zo],styles:[".feedback-container[_ngcontent-%COMP%]{width:90%;height:95%;max-width:400px;margin:auto;font-family:Arial,sans-serif;padding:20px;box-shadow:0 4px 8px #0000001a;position:relative;text-align:center}.back-icon[_ngcontent-%COMP%]{font-size:24px;color:#555;position:absolute;top:15px;left:15px;cursor:pointer}.success-icon[_ngcontent-%COMP%]{height:90%;display:flex;align-items:center;justify-content:center;font-size:80px;color:#4caf50}.star-div[_ngcontent-%COMP%]{position:fixed;bottom:5%;width:90%}.star-rating-section[_ngcontent-%COMP%]{margin-top:20px;display:flex;flex-direction:column;gap:1rem}.star-rating[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:5px}.star[_ngcontent-%COMP%]{font-size:50px;color:#ccc;cursor:pointer;transition:color .2s;margin:0 5px}.star.filled[_ngcontent-%COMP%]{color:#ffc107}.rating-text[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin:5px 0;color:#333}.rating-subtext[_ngcontent-%COMP%]{font-size:14px;color:#777;margin-bottom:20px}.feedback-text[_ngcontent-%COMP%]{width:90%;margin:0 7% 20px 2%}textarea[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:14px;border-radius:8px;border:1px solid #ddd;resize:none}.submit-btn[_ngcontent-%COMP%]{width:90%;padding:12px;font-size:16px;color:#fff;background-color:#ff6f00;border:none;border-radius:8px;cursor:pointer;transition:background-color .2s}.submit-btn[_ngcontent-%COMP%]:hover{background-color:#ff8c00}"]});let d=s;return d})();var Ad=function(d){return d.Prompt="PROMPT",d.Camera="CAMERA",d.Photos="PHOTOS",d}(Ad||{}),Hg=function(d){return d.Rear="REAR",d.Front="FRONT",d}(Hg||{}),_C=function(d){return d.Uri="uri",d.Base64="base64",d.DataUrl="dataUrl",d}(_C||{});var Wg=class extends Wk{getPhoto(s){return Ln(this,null,function*(){return new Promise((u,r)=>Ln(this,null,function*(){if(s.webUseInput||s.source===Ad.Photos)this.fileInputExperience(s,u,r);else if(s.source===Ad.Prompt){let l=document.querySelector("pwa-action-sheet");l||(l=document.createElement("pwa-action-sheet"),document.body.appendChild(l)),l.header=s.promptLabelHeader||"Photo",l.cancelable=!1,l.options=[{title:s.promptLabelPhoto||"From Photos"},{title:s.promptLabelPicture||"Take Picture"}],l.addEventListener("onSelection",t=>Ln(this,null,function*(){t.detail===0?this.fileInputExperience(s,u,r):this.cameraExperience(s,u,r)}))}else this.cameraExperience(s,u,r)}))})}pickImages(s){return Ln(this,null,function*(){return new Promise((u,r)=>Ln(this,null,function*(){this.multipleFileInputExperience(u,r)}))})}cameraExperience(s,u,r){return Ln(this,null,function*(){if(customElements.get("pwa-camera-modal")){let l=document.createElement("pwa-camera-modal");l.facingMode=s.direction===Hg.Front?"user":"environment",document.body.appendChild(l);try{yield l.componentOnReady(),l.addEventListener("onPhoto",t=>Ln(this,null,function*(){let _=t.detail;_===null?r(new pb("User cancelled photos app")):_ instanceof Error?r(_):u(yield this._getCameraPhoto(_,s)),l.dismiss(),document.body.removeChild(l)})),l.present()}catch{this.fileInputExperience(s,u,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(s,u,r)})}fileInputExperience(s,u,r){let l=document.querySelector("#_capacitor-camera-input"),t=()=>{var _;(_=l.parentNode)===null||_===void 0||_.removeChild(l)};l||(l=document.createElement("input"),l.id="_capacitor-camera-input",l.type="file",l.hidden=!0,document.body.appendChild(l),l.addEventListener("change",_=>{let C=l.files[0],I="jpeg";if(C.type==="image/png"?I="png":C.type==="image/gif"&&(I="gif"),s.resultType==="dataUrl"||s.resultType==="base64"){let O=new FileReader;O.addEventListener("load",()=>{if(s.resultType==="dataUrl")u({dataUrl:O.result,format:I});else if(s.resultType==="base64"){let N=O.result.split(",")[1];u({base64String:N,format:I})}t()}),O.readAsDataURL(C)}else u({webPath:URL.createObjectURL(C),format:I}),t()}),l.addEventListener("cancel",_=>{r(new pb("User cancelled photos app")),t()})),l.accept="image/*",l.capture=!0,s.source===Ad.Photos||s.source===Ad.Prompt?l.removeAttribute("capture"):s.direction===Hg.Front?l.capture="user":s.direction===Hg.Rear&&(l.capture="environment"),l.click()}multipleFileInputExperience(s,u){let r=document.querySelector("#_capacitor-camera-input-multiple"),l=()=>{var t;(t=r.parentNode)===null||t===void 0||t.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",t=>{let _=[];for(let C=0;C<r.files.length;C++){let I=r.files[C],O="jpeg";I.type==="image/png"?O="png":I.type==="image/gif"&&(O="gif"),_.push({webPath:URL.createObjectURL(I),format:O})}s({photos:_}),l()}),r.addEventListener("cancel",t=>{u(new pb("User cancelled photos app")),l()})),r.accept="image/*",r.click()}_getCameraPhoto(s,u){return new Promise((r,l)=>{let t=new FileReader,_=s.type.split("/")[1];u.resultType==="uri"?r({webPath:URL.createObjectURL(s),format:_,saved:!1}):(t.readAsDataURL(s),t.onloadend=()=>{let C=t.result;u.resultType==="dataUrl"?r({dataUrl:C,format:_,saved:!1}):r({base64String:C.split(",")[1],format:_,saved:!1})},t.onerror=C=>{l(C)})})}checkPermissions(){return Ln(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return Ln(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return Ln(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return Ln(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},$G=new Wg;var DA=pd("Camera",{web:()=>new Wg});var Fj=["imageElement"];function zj(d,s){if(d&1){let u=Xt();V(0,"div",4),Me(1,"img",5),j(),V(2,"div",6)(3,"button",2),Pe("click",function(){mt(u);let l=rt();return pt(l.submit())}),$(4,"Submit"),j()()}if(d&2){let u=rt();ue(),Fe("src",u.imageUrl,Fn)}}var AA=(()=>{let s=class s{constructor(r,l,t,_,C){this.location=r,this.routerParam=l,this.afterOrderService=t,this.router=_,this.orderService=C,this.orderHistoryId="",this.orderId="",this.status=""}ngOnInit(){this.takePicture(),this.getOrderId()}takePicture(){return Ln(this,null,function*(){try{let r=yield DA.getPhoto({quality:100,allowEditing:!1,resultType:_C.Uri,source:Ad.Camera});this.imageUrl=r.webPath}catch(r){console.error("Error capturing image:",r)}})}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{if(r.get("id")){let t=r.get("id");this.getOrderDetails(t)}}})}getOrderDetails(r){r&&this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.orderId=l._id,this.getingStatus()},error:l=>{console.error(l)}})}getingStatus(){this.afterOrderService.gettingStatus(this.orderId).subscribe({next:r=>{console.log(r),this.status=r.data.status,this.orderHistoryId=r.data._id},error:r=>{console.log(r)}})}submit(){return Ln(this,null,function*(){let r=localStorage.getItem("providerId");if(!r||!this.orderId||!this.imageUrl||!this.order?.userId._id){console.error("Required data is missing");return}try{let t=yield(yield fetch(this.imageUrl)).blob(),_=new FormData;_.append("providerId",r),_.append("orderId",this.orderId),_.append("userId",this.order.userId?._id),_.append("image",t,"work-image.jpg"),this.status==="Workstart"&&this.afterOrderService.uploadBeforeWorkImage(_).subscribe(C=>{console.log("Data submitted successfully:",C),this.navToCompleteWork()},C=>{console.error("Error submitting data:",C)}),this.status==="InProgress"&&(_.append("orderHistoryId",this.orderHistoryId||""),this.afterOrderService.uploadAfterWorkImage(_).subscribe({next:C=>{console.log(C),this.completeWork()},error:C=>{console.log(C)}}))}catch(l){console.error("Error fetching and submitting image:",l)}})}completeWork(){let r=this.order.userId?._id,l={orderHistoryId:this.orderHistoryId,providerId:localStorage.getItem("providerId"),userId:r,orderId:this.orderId};console.log(l),this.orderService.completeOrder(l).subscribe({next:t=>{console.log(t),this.router.navigate(["verifyAfterWork",this.orderId])},error:t=>{console.log(t)}})}navTOBack(){this.location.back()}navToCompleteWork(){this.router.navigate(["completeWork",this.orderId])}ngOnDestroy(){this.imageUrl=void 0,this.orderHistoryId="",this.orderId="",this.order=[]}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(To),fe(Ao),fe(Nt),fe(Sr))},s.\u0275cmp=_t({type:s,selectors:[["app-work-image"]],viewQuery:function(l,t){if(l&1&&bi(Fj,5),l&2){let _;gi(_=_i())&&(t.imageElement=_.first)}},decls:7,vars:1,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[3,"click"],[1,"sub-container"],[1,"image"],["alt","Captured Image",3,"src"],[1,"button-div"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Pe("click",function(){return t.navTOBack()}),$(2," arrow_back "),j(),V(3,"button",2),Pe("click",function(){return t.takePicture()}),$(4,"Take Picture"),j(),V(5,"div",3),Bt(6,zj,5,1),j()()),l&2&&(ue(6),Dn(6,t.imageUrl?6:-1))},styles:[".container[_ngcontent-%COMP%]{width:90%;margin:1rem 5% 0}.sub-container[_ngcontent-%COMP%]{width:100%;height:80%;display:flex;flex-direction:column;gap:1rem;align-items:center;justify-content:center}.image[_ngcontent-%COMP%]{width:260px;height:50opx}.image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.button-div[_ngcontent-%COMP%]{position:fixed;bottom:5%}button[_ngcontent-%COMP%]{background-color:#d16611;color:#fff;padding:1rem 2rem;border:none;border-radius:.4rem}"]});let d=s;return d})();function Bj(d,s){if(d&1){let u=Xt();V(0,"div",5)(1,"div",7),Me(2,"img",8),$(3),j(),V(4,"div")(5,"input",9),Er("ngModelChange",function(l){let t=mt(u).$implicit;return Tr(t.checked,l)||(t.checked=l),pt(l)}),Pe("change",function(l){let t=mt(u).$implicit,_=rt();return pt(_.onChange(l,t))}),j()()()}if(d&2){let u=s.$implicit;ue(2),Fe("src",u.image,Fn),ue(),Ft(u.name),ue(2),Ir("ngModel",u.checked)}}var PA=(()=>{let s=class s{constructor(r,l,t,_){this.location=r,this.logInService=l,this.router=t,this.userDetailsService=_,this.workSeleceted=[],this.selectedCatId="",this.selectedSubCatId="",this.selectedServicesId=[],this.items=[]}ngOnInit(){this.selectedCatId=this.logInService.workId,this.selectedSubCatId=this.logInService.selectedSubCategories,this.getServices()}getServices(){console.log(this.selectedCatId,this.selectedSubCatId," cat ans sub cat ids"),this.logInService.getServices(this.selectedCatId,this.selectedSubCatId).subscribe(r=>{console.log(r),this.items=r,this.getWork()},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}autoCheckServices(){this.workSeleceted.forEach(r=>{console.log(`Checking work category: ${r.categoryId.name}`);let l=this.items.filter(t=>t.categoryId._id===r.categoryId._id);l.length>0?(console.log(`Found matching items for category: ${r.categoryId.name}`),r.serviceId.forEach(t=>{console.log(`Checking service: ${t.name}`),l.forEach(_=>{_._id===t._id?(_.checked=!0,console.log(`Checked item: ${_.name} with service: ${t.name}`)):console.log(`No match found for service: ${t.name} in item: ${_.name}`)})})):console.log(`No matching items found for categoryId: ${r.categoryId._id}`)})}send(){this.logInService.selectedSubCategories.length>0?(this.logInService.setservices(this.selectedServicesId),this.router.navigate(["aboutWork"])):alert("Please select atleat one sub-category ")}onChange(r,l){let t=r.target;if(console.log(l),t&&t.checked){let C=this.items.indexOf(l);console.log("categoryId",l._),this.selectedServicesId.push(l._id)}console.log(this.selectedServicesId)}navToBack(){this.location.back()}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Wn),fe(Nt),fe(Gn))},s.\u0275cmp=_t({type:s,selectors:[["app-service"]],decls:12,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined","notranslate",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"serivce"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(l,t){l&1&&(V(0,"div",0)(1,"span",1),Pe("click",function(){return t.navToBack()}),$(2," keyboard_backspace "),j(),V(3,"div",2)(4,"span",3),$(5,"Select Services"),j(),Me(6,"br"),V(7,"div",4),mr(8,Bj,6,3,"div",5,Zr),j()(),V(10,"button",6),Pe("click",function(){return t.send()}),$(11,"Continue"),j()()),l&2&&(ue(8),pr(t.items))},dependencies:[Xs,ir,Zo],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;left:5%;align-items:center;display:grid;grid-gap:.5rem;text-align:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.serivce[_ngcontent-%COMP%]{height:78vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.5rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=s;return d})();var Nj=[{path:"",component:pT},{path:"language",component:fT},{path:"log-in",component:vT},{path:"location",component:IA},{path:"verify",component:xT},{path:"aboutUser",component:wT},{path:"selectWork",component:ST},{path:"aboutWork",component:MT},{path:"workExperiance",component:kT},{path:"aadharVerify",component:IT},{path:"pancard",component:TT},{path:"bankDetails",component:ET},{path:"waiting",component:rA},{path:"home",component:AT},{path:"fotter",component:Js},{path:"credits",component:PT},{path:"notification",component:oA},{path:"menu",component:OT},{path:"visitingCard",component:RT},{path:"referAndEarn",component:LT},{path:"awards",component:FT},{path:"help",loadChildren:()=>import("./chunk-PIXWQOOF.js").then(d=>d.HelpModule)},{path:"target",component:UT},{path:"earnings",component:nA},{path:"calender",component:aA},{path:"jobHistory",component:sA},{path:"jobDetails",component:dA},{path:"addCredit",component:lA},{path:"financialDetails",component:cA},{path:"identityVerification",component:hA},{path:"ongoing",component:uA},{path:"demo",component:Rb},{path:"induction",component:mA},{path:"started",component:pA},{path:"selectAccount",component:fA},{path:"congrats",component:gA},{path:"packages",component:_A},{path:"training",component:bA},{path:"getOrder/:id",component:yA},{path:"arrived/:id",component:vA},{path:"startWork/:id",component:xA},{path:"work/otp/:id",component:wA},{path:"completeWork/:id",component:CA},{path:"verifyAfterWork/:id",component:SA},{path:"subServices",component:MA},{path:"notFound",component:kA},{path:"manageServices",component:TA},{path:"feedback",component:EA},{path:"workImage/:id",component:AA},{path:"services",component:PA}],OA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s}),s.\u0275inj=ui({imports:[t1.forRoot(Nj),t1]});let d=s;return d})();var My=pd("App",{web:()=>import("./chunk-EGBBIWLX.js").then(d=>new d.AppWeb)});var bC=pd("Network",{web:()=>import("./chunk-YLNCHRU7.js").then(d=>new d.NetworkWeb)});var RA=(()=>{let s=class s{constructor(r,l,t){this.location=r,this.messagingService=l,this.router=t,this.title="CoolieNo.1_Provider",this.myObject={},this.initializePushNotifications(),this.checkForOrderNavigation(),this.gettingNotification()}ngOnInit(){this.messagingService.requestPermission(),setTimeout(()=>{this.myObject=this.messagingService.token?{token:this.messagingService.token}:{}},5e3),this.messagingService.listenForMessages(),this.monitorNetworkStatus(),this.registerBackButtonListener()}initializePushNotifications(){ql.addListener("pushNotificationActionPerformed",r=>{let l=r.notification.data?.orderId;alert(l),l&&(this.messagingService.setOrderId(l),this.router.navigate(["getOrder",l]))})}checkForOrderNavigation(){let r=this.messagingService.getOrderId();r&&(this.router.navigate(["getOrder",r]),this.messagingService.clearOrderId())}gettingNotification(){My.addListener("appStateChange",({isActive:r})=>{r&&ql.getDeliveredNotifications().then(l=>{l.notifications.forEach(_=>{if(_.title==="New Order"){let C=_.data?.orderId;C&&this.router.navigate(["getOrder",C])}})}).catch(l=>{console.error("Error fetching delivered notifications:",l)})})}registerBackButtonListener(){My.addListener("backButton",r=>{r.canGoBack?(this.location.back(),console.log("Back button pressed, navigating back")):(console.log("Back button pressed, exiting app"),My.exitApp())})}monitorNetworkStatus(){return Ln(this,null,function*(){(yield bC.getStatus()).connected||this.router.navigate(["not-found"]),bC.addListener("networkStatusChange",l=>{l.connected||this.router.navigate(["not-found"])})})}};s.\u0275fac=function(l){return new(l||s)(fe(ii),fe(Wm),fe(Nt))},s.\u0275cmp=_t({type:s,selectors:[["app-root"]],decls:1,vars:0,template:function(l,t){l&1&&Me(0,"router-outlet")},dependencies:[hb]});let d=s;return d})();var Vj="@",jj=(()=>{let s=class s{constructor(r,l,t,_,C){this.doc=r,this.delegate=l,this.zone=t,this.animationType=_,this.moduleImpl=C,this._rendererFactoryPromise=null,this.scheduler=wn(K0,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-4C2XSBWM.js")).catch(l=>{throw new sk(5300,!1)}).then(({\u0275createEngine:l,\u0275AnimationRendererFactory:t})=>{this._engine=l(this.animationType,this.doc,this.scheduler);let _=new t(this.delegate,this._engine,this.zone);return this.delegate=_,_})}createRenderer(r,l){let t=this.delegate.createRenderer(r,l);if(t.\u0275type===0)return t;typeof t.throwOnSyntheticProps=="boolean"&&(t.throwOnSyntheticProps=!1);let _=new yC(t);return l?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(C=>{let I=C.createRenderer(r,l);_.use(I)}).catch(C=>{_.use(t)}),_}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};s.\u0275fac=function(l){km()},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})(),yC=class{constructor(s){this.delegate=s,this.replay=[],this.\u0275type=1}use(s){if(this.delegate=s,this.replay!==null){for(let u of this.replay)u(s);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(s,u){return this.delegate.createElement(s,u)}createComment(s){return this.delegate.createComment(s)}createText(s){return this.delegate.createText(s)}get destroyNode(){return this.delegate.destroyNode}appendChild(s,u){this.delegate.appendChild(s,u)}insertBefore(s,u,r,l){this.delegate.insertBefore(s,u,r,l)}removeChild(s,u,r){this.delegate.removeChild(s,u,r)}selectRootElement(s,u){return this.delegate.selectRootElement(s,u)}parentNode(s){return this.delegate.parentNode(s)}nextSibling(s){return this.delegate.nextSibling(s)}setAttribute(s,u,r,l){this.delegate.setAttribute(s,u,r,l)}removeAttribute(s,u,r){this.delegate.removeAttribute(s,u,r)}addClass(s,u){this.delegate.addClass(s,u)}removeClass(s,u){this.delegate.removeClass(s,u)}setStyle(s,u,r,l){this.delegate.setStyle(s,u,r,l)}removeStyle(s,u,r){this.delegate.removeStyle(s,u,r)}setProperty(s,u,r){this.shouldReplay(u)&&this.replay.push(l=>l.setProperty(s,u,r)),this.delegate.setProperty(s,u,r)}setValue(s,u){this.delegate.setValue(s,u)}listen(s,u,r){return this.shouldReplay(u)&&this.replay.push(l=>l.listen(s,u,r)),this.delegate.listen(s,u,r)}shouldReplay(s){return this.replay!==null&&s.startsWith(Vj)}};function LA(d="animations"){return qx("NgAsyncAnimations"),ck([{provide:J0,useFactory:(s,u,r)=>new jj(s,u,r,d),deps:[mn,ob,zi]},{provide:io,useValue:d==="noop"?"NoopAnimations":"BrowserAnimations"}])}var Uj=QM(iw());var ky={production:!1,firebase:{apiKey:"AIzaSyAcziwgDyx2SxCSeuGbgFDr9_94R2tpDfk",authDomain:"coolie-9cc38.firebaseapp.com",projectId:"coolie-9cc38",storageBucket:"coolie-9cc38.appspot.com",messagingSenderId:"425618348845",appId:"1:425618348845:android:dfb682ab264340b4f611a4",measurementId:"G-X6752VX6L5",vapidKey:"BFLySRIkI2i4ZrxUJjrsCDeG921cCUs-9zLhyulNlP7HUawhIVFefo8GFfxxgnpTWV9zgiKJ9m9Vx8C39MRgPYA"}};var FA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=mi({type:s,bootstrap:[RA]}),s.\u0275inj=ui({providers:[LA(),zn],imports:[ab,OA,zk,Bk,Tk,Zk,wI,SI,MI,kI,TI,sT,DI,NT,QI,bI,hT.initializeApp(ky.firebase),mT,bT]});let d=s;return d})();ky.production&&void 0;Ek().bootstrapModule(FA).catch(d=>console.error(d));"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(d=>{console.log("Service Worker registered with scope:",d.scope)}).catch(d=>{console.log("Service Worker registration failed:",d)});
