import{A as zk,a as Qx,b as ig,c as ud,d as Kx,e as Jx,f as ng,l as Rk,m as rg,n as sb,s as Lk,t as lb,v as Fk}from"./chunk-TEO2LLVX.js";import{i as Vk,j as bs,k as jk}from"./chunk-VR2CY5TD.js";import{A as Ok,B as cb,C as Io,D as db,E as Nt,F as hb,G as ub,H as e1,b as Wi,c as Ck,d as rb,e as Sk,f as ob,g as Mk,h as hd,i as no,j as kk,k as ro,l as dr,m as Mo,n as Ik,o as Ba,p as ko,q as ab,r as Yo,s as Na,t as Tk,u as Ek,v as Dk,w as Ak,x as km,y as Zo,z as Pk}from"./chunk-6HHNQLDM.js";import{$ as Ut,A as zh,Aa as sn,Ab as bi,Ac as cr,B as ga,Ba as an,Bb as fi,Bc as yk,C as Bx,Cb as gi,Cc as vk,D as q0,Db as fs,Dc as xk,Eb as $,Ec as ib,F as Nx,Fa as ld,Fb as Rt,Fc as nb,G as rk,Ga as to,Gb as zi,Gc as qs,H as La,Ha as ck,Hb as gs,Ia as Hn,Ib as J0,Ic as wk,J as Vx,Jb as mk,Kb as pk,La as ue,Lb as qr,Ma as _e,Mb as $r,Na as Sm,Nb as Yr,O as jx,Oa as Nh,Ob as _s,P as ok,Pa as X0,Pb as jn,Qa as eg,Qb as eb,R as Ux,Ra as Q0,Rb as li,S as $0,Sa as dk,Sb as $x,T as us,Ta as Gx,Tb as fk,U as ms,Ua as Fi,Ub as tb,V as Hx,Vb as Yx,W as Bh,Wa as Mm,Wb as gk,Xa as Ro,Y as ak,Ya as wo,_ as Y0,a as hs,aa as hi,ab as Bt,bb as bn,c as ho,ca as pn,cb as Fe,db as za,dc as _k,ea as st,eb as Si,f as En,fa as wn,fb as ps,fc as bk,g as Jf,ga as Z0,gb as Vn,h as QM,ha as sk,hb as Lo,hc as Zx,i as KM,ib as tg,ic as uo,j as JM,ja as Xi,jb as Or,k as Fl,ka as ft,kb as Rr,l as zl,la as ui,lb as V,lc as io,ma as Kn,mb as j,mc as Xx,n as br,na as lk,nb as Me,ob as cd,pb as dd,qb as qx,r as ek,ra as xo,rb as Kt,rc as un,s as xm,sa as _t,sb as Bl,t as tk,ta as bt,tb as hk,u as ik,ua as sd,ub as Oe,va as Wx,vb as uk,w as W0,wa as wm,wb as dt,wc as _i,x as G0,xa as Cm,xb as $o,ya as Fa,yb as Co,yc as So,z as nk,zb as K0,zc as yr}from"./chunk-XQ4NAJ6T.js";import{a as mb,b as Bk,c as md,d as Nk}from"./chunk-HJO2KOHN.js";import{a as Zi,b as Ra,c as ZM,d as g3,f as XM,g as Rn}from"./chunk-MON7YFGF.js";var K1=g3((X1,Q1)=>{"use strict";(function(d,s){typeof X1=="object"&&typeof Q1<"u"?Q1.exports=s():typeof define=="function"&&define.amd?define(s):(d=typeof globalThis<"u"?globalThis:d||self,d.mapboxgl=s())})(X1,function(){"use strict";var d,s,u;function r(i,_){if(!d)d=_;else if(!s)s=_;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+d+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",I={};d(I),u=_(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}r(["exports"],function(i){var _="3.5.1";let C,I={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{C=t}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!I.API_URL)return null;try{let t=new URL(I.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function O(t){return I.API_URL_REGEX.test(t)}function N(t){return t.indexOf("mapbox:")===0}function q(t){return I.API_CDN_URL_REGEX.test(t)}function ie(t){return I.API_SPRITE_REGEX.test(t)}function de(t){return I.API_STYLE_REGEX.test(t)&&!ie(t)}let xe={create:"create",load:"load",fullLoad:"fullLoad"},ke={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function Ae(t){let e=t.name.split("?")[0];return q(e)&&e.includes("mapbox-gl.js")?"javascript":q(e)&&e.includes("mapbox-gl.css")?"css":function(n){return I.API_FONTS_REGEX.test(n)}(e)?"fontRange":ie(e)?"sprite":de(e)?"style":function(n){return I.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Xe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var qe={},ut={};Object.defineProperty(ut,"__esModule",{value:!0}),ut.setMatrixArrayType=function(t){ut.ARRAY_TYPE=wt=t},ut.toRadian=function(t){return t*Ht},ut.equals=function(t,e){return Math.abs(t-e)<=It*Math.max(1,Math.abs(t),Math.abs(e))},ut.RANDOM=ut.ARRAY_TYPE=ut.EPSILON=void 0;var It=1e-6;ut.EPSILON=It;var wt=typeof Float32Array<"u"?Float32Array:Array;ut.ARRAY_TYPE=wt;var Et=Math.random;ut.RANDOM=Et;var Ht=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ct={};function Yt(t){return Yt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yt(t)}Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.create=function(){var t=new zt.ARRAY_TYPE(4);return zt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Ct.clone=function(t){var e=new zt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ct.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ct.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Ct.fromValues=function(t,e,n,a){var c=new zt.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=a,c},Ct.set=function(t,e,n,a,c){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t},Ct.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Ct.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n*m-c*a;return p?(t[0]=m*(p=1/p),t[1]=-a*p,t[2]=-c*p,t[3]=n*p,t):null},Ct.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Ct.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Ct.multiply=Hi,Ct.rotate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return t[0]=a*y+m*b,t[1]=c*y+p*b,t[2]=a*-b+m*y,t[3]=c*-b+p*y,t},Ct.scale=function(t,e,n){var a=e[1],c=e[2],m=e[3],p=n[0],b=n[1];return t[0]=e[0]*p,t[1]=a*p,t[2]=c*b,t[3]=m*b,t},Ct.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t},Ct.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Ct.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ct.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Ct.LDU=function(t,e,n,a){return t[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-t[2]*n[1],[t,e,n]},Ct.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Ct.subtract=or,Ct.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ct.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=e[0],b=e[1],y=e[2],w=e[3];return Math.abs(n-p)<=zt.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-b)<=zt.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(c-y)<=zt.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(m-w)<=zt.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))},Ct.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Ct.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},Ct.sub=Ct.mul=void 0;var zt=function(t,e){if(t&&t.__esModule)return t;if(t===null||Yt(t)!=="object"&&typeof t!="function")return{default:t};var n=ki(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ut);function ki(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ki=function(a){return a?n:e})(t)}function Hi(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return t[0]=a*b+m*y,t[1]=c*b+p*y,t[2]=a*w+m*M,t[3]=c*w+p*M,t}function or(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Ct.mul=Hi,Ct.sub=or;var wi={};function cn(t){return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cn(t)}Object.defineProperty(wi,"__esModule",{value:!0}),wi.create=function(){var t=new tn.ARRAY_TYPE(6);return tn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},wi.clone=function(t){var e=new tn.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},wi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},wi.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},wi.fromValues=function(t,e,n,a,c,m){var p=new tn.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=n,p[3]=a,p[4]=c,p[5]=m,p},wi.set=function(t,e,n,a,c,m,p){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=m,t[5]=p,t},wi.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=n*m-a*c;return y?(t[0]=m*(y=1/y),t[1]=-a*y,t[2]=-c*y,t[3]=n*y,t[4]=(c*b-m*p)*y,t[5]=(a*p-n*b)*y,t):null},wi.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},wi.multiply=Nr,wi.rotate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=Math.sin(n),M=Math.cos(n);return t[0]=a*M+m*w,t[1]=c*M+p*w,t[2]=a*-w+m*M,t[3]=c*-w+p*M,t[4]=b,t[5]=y,t},wi.scale=function(t,e,n){var a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=n[0],w=n[1];return t[0]=e[0]*y,t[1]=a*y,t[2]=c*w,t[3]=m*w,t[4]=p,t[5]=b,t},wi.translate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=n[0],M=n[1];return t[0]=a,t[1]=c,t[2]=m,t[3]=p,t[4]=a*w+m*M+b,t[5]=c*w+p*M+y,t},wi.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t[4]=0,t[5]=0,t},wi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},wi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},wi.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},wi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},wi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},wi.subtract=qn,wi.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},wi.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t},wi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},wi.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=t[4],b=t[5],y=e[0],w=e[1],M=e[2],T=e[3],E=e[4],P=e[5];return Math.abs(n-y)<=tn.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-w)<=tn.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-M)<=tn.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(m-T)<=tn.EPSILON*Math.max(1,Math.abs(m),Math.abs(T))&&Math.abs(p-E)<=tn.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(b-P)<=tn.EPSILON*Math.max(1,Math.abs(b),Math.abs(P))},wi.sub=wi.mul=void 0;var tn=function(t,e){if(t&&t.__esModule)return t;if(t===null||cn(t)!=="object"&&typeof t!="function")return{default:t};var n=Bn(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ut);function Bn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Bn=function(a){return a?n:e})(t)}function Nr(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=n[0],M=n[1],T=n[2],E=n[3],P=n[4],R=n[5];return t[0]=a*w+m*M,t[1]=c*w+p*M,t[2]=a*T+m*E,t[3]=c*T+p*E,t[4]=a*P+m*R+b,t[5]=c*P+p*R+y,t}function qn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}wi.mul=Nr,wi.sub=qn;var Ii={};function na(t){return na=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},na(t)}Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.create=function(){var t=new $n.ARRAY_TYPE(9);return $n.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Ii.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Ii.clone=function(t){var e=new $n.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Ii.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Ii.fromValues=function(t,e,n,a,c,m,p,b,y){var w=new $n.ARRAY_TYPE(9);return w[0]=t,w[1]=e,w[2]=n,w[3]=a,w[4]=c,w[5]=m,w[6]=p,w[7]=b,w[8]=y,w},Ii.set=function(t,e,n,a,c,m,p,b,y,w){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=m,t[5]=p,t[6]=b,t[7]=y,t[8]=w,t},Ii.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Ii.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Ii.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=M*p-b*w,E=-M*m+b*y,P=w*m-p*y,R=n*T+a*E+c*P;return R?(t[0]=T*(R=1/R),t[1]=(-M*a+c*w)*R,t[2]=(b*a-c*p)*R,t[3]=E*R,t[4]=(M*n-c*y)*R,t[5]=(-b*n+c*m)*R,t[6]=P*R,t[7]=(-w*n+a*y)*R,t[8]=(p*n-a*m)*R,t):null},Ii.adjoint=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8];return t[0]=p*M-b*w,t[1]=c*w-a*M,t[2]=a*b-c*p,t[3]=b*y-m*M,t[4]=n*M-c*y,t[5]=c*m-n*b,t[6]=m*w-p*y,t[7]=a*y-n*w,t[8]=n*p-a*m,t},Ii.determinant=function(t){var e=t[3],n=t[4],a=t[5],c=t[6],m=t[7],p=t[8];return t[0]*(p*n-a*m)+t[1]*(-p*e+a*c)+t[2]*(m*e-n*c)},Ii.multiply=Fo,Ii.translate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=n[0],P=n[1];return t[0]=a,t[1]=c,t[2]=m,t[3]=p,t[4]=b,t[5]=y,t[6]=E*a+P*p+w,t[7]=E*c+P*b+M,t[8]=E*m+P*y+T,t},Ii.rotate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=Math.sin(n),P=Math.cos(n);return t[0]=P*a+E*p,t[1]=P*c+E*b,t[2]=P*m+E*y,t[3]=P*p-E*a,t[4]=P*b-E*c,t[5]=P*y-E*m,t[6]=w,t[7]=M,t[8]=T,t},Ii.scale=function(t,e,n){var a=n[0],c=n[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=c*e[3],t[4]=c*e[4],t[5]=c*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Ii.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Ii.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Ii.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Ii.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Ii.fromQuat=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n+n,b=a+a,y=c+c,w=n*p,M=a*p,T=a*b,E=c*p,P=c*b,R=c*y,F=m*p,B=m*b,W=m*y;return t[0]=1-T-R,t[3]=M-W,t[6]=E+B,t[1]=M+W,t[4]=1-w-R,t[7]=P-F,t[2]=E-B,t[5]=P+F,t[8]=1-w-T,t},Ii.normalFromMat4=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],B=e[14],W=e[15],J=n*b-a*p,ee=n*y-c*p,te=n*w-m*p,pe=a*y-c*b,he=a*w-m*b,ve=c*w-m*y,Ce=M*F-T*R,De=M*B-E*R,Ue=M*W-P*R,ze=T*B-E*F,$e=T*W-P*F,rt=E*W-P*B,We=J*rt-ee*$e+te*ze+pe*Ue-he*De+ve*Ce;return We?(t[0]=(b*rt-y*$e+w*ze)*(We=1/We),t[1]=(y*Ue-p*rt-w*De)*We,t[2]=(p*$e-b*Ue+w*Ce)*We,t[3]=(c*$e-a*rt-m*ze)*We,t[4]=(n*rt-c*Ue+m*De)*We,t[5]=(a*Ue-n*$e-m*Ce)*We,t[6]=(F*ve-B*he+W*pe)*We,t[7]=(B*te-R*ve-W*ee)*We,t[8]=(R*he-F*te+W*J)*We,t):null},Ii.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Ii.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Ii.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Ii.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},Ii.subtract=ya,Ii.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},Ii.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t},Ii.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Ii.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=t[4],b=t[5],y=t[6],w=t[7],M=t[8],T=e[0],E=e[1],P=e[2],R=e[3],F=e[4],B=e[5],W=e[6],J=e[7],ee=e[8];return Math.abs(n-T)<=$n.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-E)<=$n.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(c-P)<=$n.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(m-R)<=$n.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(p-F)<=$n.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(b-B)<=$n.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(y-W)<=$n.EPSILON*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(w-J)<=$n.EPSILON*Math.max(1,Math.abs(w),Math.abs(J))&&Math.abs(M-ee)<=$n.EPSILON*Math.max(1,Math.abs(M),Math.abs(ee))},Ii.sub=Ii.mul=void 0;var $n=function(t,e){if(t&&t.__esModule)return t;if(t===null||na(t)!=="object"&&typeof t!="function")return{default:t};var n=ba(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ut);function ba(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ba=function(a){return a?n:e})(t)}function Fo(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=n[0],P=n[1],R=n[2],F=n[3],B=n[4],W=n[5],J=n[6],ee=n[7],te=n[8];return t[0]=E*a+P*p+R*w,t[1]=E*c+P*b+R*M,t[2]=E*m+P*y+R*T,t[3]=F*a+B*p+W*w,t[4]=F*c+B*b+W*M,t[5]=F*m+B*y+W*T,t[6]=J*a+ee*p+te*w,t[7]=J*c+ee*b+te*M,t[8]=J*m+ee*y+te*T,t}function ya(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}Ii.mul=Fo,Ii.sub=ya;var Gt={};function Kl(t){return Kl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kl(t)}Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var t=new Cn.ARRAY_TYPE(16);return Cn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Gt.clone=function(t){var e=new Cn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Gt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Gt.fromValues=function(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F){var B=new Cn.ARRAY_TYPE(16);return B[0]=t,B[1]=e,B[2]=n,B[3]=a,B[4]=c,B[5]=m,B[6]=p,B[7]=b,B[8]=y,B[9]=w,B[10]=M,B[11]=T,B[12]=E,B[13]=P,B[14]=R,B[15]=F,B},Gt.set=function(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=m,t[5]=p,t[6]=b,t[7]=y,t[8]=w,t[9]=M,t[10]=T,t[11]=E,t[12]=P,t[13]=R,t[14]=F,t[15]=B,t},Gt.identity=nu,Gt.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],c=e[3],m=e[6],p=e[7],b=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=m,t[11]=e[14],t[12]=c,t[13]=p,t[14]=b}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Gt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],B=e[14],W=e[15],J=n*b-a*p,ee=n*y-c*p,te=n*w-m*p,pe=a*y-c*b,he=a*w-m*b,ve=c*w-m*y,Ce=M*F-T*R,De=M*B-E*R,Ue=M*W-P*R,ze=T*B-E*F,$e=T*W-P*F,rt=E*W-P*B,We=J*rt-ee*$e+te*ze+pe*Ue-he*De+ve*Ce;return We?(t[0]=(b*rt-y*$e+w*ze)*(We=1/We),t[1]=(c*$e-a*rt-m*ze)*We,t[2]=(F*ve-B*he+W*pe)*We,t[3]=(E*he-T*ve-P*pe)*We,t[4]=(y*Ue-p*rt-w*De)*We,t[5]=(n*rt-c*Ue+m*De)*We,t[6]=(B*te-R*ve-W*ee)*We,t[7]=(M*ve-E*te+P*ee)*We,t[8]=(p*$e-b*Ue+w*Ce)*We,t[9]=(a*Ue-n*$e-m*Ce)*We,t[10]=(R*he-F*te+W*J)*We,t[11]=(T*te-M*he-P*J)*We,t[12]=(b*De-p*ze-y*Ce)*We,t[13]=(n*ze-a*De+c*Ce)*We,t[14]=(F*ee-R*pe-B*J)*We,t[15]=(M*pe-T*ee+E*J)*We,t):null},Gt.adjoint=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=e[4],b=e[5],y=e[6],w=e[7],M=e[8],T=e[9],E=e[10],P=e[11],R=e[12],F=e[13],B=e[14],W=e[15];return t[0]=b*(E*W-P*B)-T*(y*W-w*B)+F*(y*P-w*E),t[1]=-(a*(E*W-P*B)-T*(c*W-m*B)+F*(c*P-m*E)),t[2]=a*(y*W-w*B)-b*(c*W-m*B)+F*(c*w-m*y),t[3]=-(a*(y*P-w*E)-b*(c*P-m*E)+T*(c*w-m*y)),t[4]=-(p*(E*W-P*B)-M*(y*W-w*B)+R*(y*P-w*E)),t[5]=n*(E*W-P*B)-M*(c*W-m*B)+R*(c*P-m*E),t[6]=-(n*(y*W-w*B)-p*(c*W-m*B)+R*(c*w-m*y)),t[7]=n*(y*P-w*E)-p*(c*P-m*E)+M*(c*w-m*y),t[8]=p*(T*W-P*F)-M*(b*W-w*F)+R*(b*P-w*T),t[9]=-(n*(T*W-P*F)-M*(a*W-m*F)+R*(a*P-m*T)),t[10]=n*(b*W-w*F)-p*(a*W-m*F)+R*(a*w-m*b),t[11]=-(n*(b*P-w*T)-p*(a*P-m*T)+M*(a*w-m*b)),t[12]=-(p*(T*B-E*F)-M*(b*B-y*F)+R*(b*E-y*T)),t[13]=n*(T*B-E*F)-M*(a*B-c*F)+R*(a*E-c*T),t[14]=-(n*(b*B-y*F)-p*(a*B-c*F)+R*(a*y-c*b)),t[15]=n*(b*E-y*T)-p*(a*E-c*T)+M*(a*y-c*b),t},Gt.determinant=function(t){var e=t[0],n=t[1],a=t[2],c=t[3],m=t[4],p=t[5],b=t[6],y=t[7],w=t[8],M=t[9],T=t[10],E=t[11],P=t[12],R=t[13],F=t[14],B=t[15];return(e*p-n*m)*(T*B-E*F)-(e*b-a*m)*(M*B-E*R)+(e*y-c*m)*(M*F-T*R)+(n*b-a*p)*(w*B-E*P)-(n*y-c*p)*(w*F-T*P)+(a*y-c*b)*(w*R-M*P)},Gt.multiply=ru,Gt.translate=function(t,e,n){var a,c,m,p,b,y,w,M,T,E,P,R,F=n[0],B=n[1],W=n[2];return e===t?(t[12]=e[0]*F+e[4]*B+e[8]*W+e[12],t[13]=e[1]*F+e[5]*B+e[9]*W+e[13],t[14]=e[2]*F+e[6]*B+e[10]*W+e[14],t[15]=e[3]*F+e[7]*B+e[11]*W+e[15]):(c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=e[9],P=e[10],R=e[11],t[0]=a=e[0],t[1]=c,t[2]=m,t[3]=p,t[4]=b,t[5]=y,t[6]=w,t[7]=M,t[8]=T,t[9]=E,t[10]=P,t[11]=R,t[12]=a*F+b*B+T*W+e[12],t[13]=c*F+y*B+E*W+e[13],t[14]=m*F+w*B+P*W+e[14],t[15]=p*F+M*B+R*W+e[15]),t},Gt.scale=function(t,e,n){var a=n[0],c=n[1],m=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*m,t[9]=e[9]*m,t[10]=e[10]*m,t[11]=e[11]*m,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Gt.rotate=function(t,e,n,a){var c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he,ve,Ce,De,Ue,ze,$e=a[0],rt=a[1],We=a[2],et=Math.hypot($e,rt,We);return et<Cn.EPSILON?null:($e*=et=1/et,rt*=et,We*=et,c=Math.sin(n),m=Math.cos(n),y=e[1],w=e[2],M=e[3],E=e[5],P=e[6],R=e[7],B=e[9],W=e[10],J=e[11],ee=$e*$e*(p=1-m)+m,he=$e*rt*p-We*c,ve=rt*rt*p+m,Ce=We*rt*p+$e*c,De=$e*We*p+rt*c,Ue=rt*We*p-$e*c,ze=We*We*p+m,t[0]=(b=e[0])*ee+(T=e[4])*(te=rt*$e*p+We*c)+(F=e[8])*(pe=We*$e*p-rt*c),t[1]=y*ee+E*te+B*pe,t[2]=w*ee+P*te+W*pe,t[3]=M*ee+R*te+J*pe,t[4]=b*he+T*ve+F*Ce,t[5]=y*he+E*ve+B*Ce,t[6]=w*he+P*ve+W*Ce,t[7]=M*he+R*ve+J*Ce,t[8]=b*De+T*Ue+F*ze,t[9]=y*De+E*Ue+B*ze,t[10]=w*De+P*Ue+W*ze,t[11]=M*De+R*Ue+J*ze,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Gt.rotateX=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),m=e[4],p=e[5],b=e[6],y=e[7],w=e[8],M=e[9],T=e[10],E=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=m*c+w*a,t[5]=p*c+M*a,t[6]=b*c+T*a,t[7]=y*c+E*a,t[8]=w*c-m*a,t[9]=M*c-p*a,t[10]=T*c-b*a,t[11]=E*c-y*a,t},Gt.rotateY=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),m=e[0],p=e[1],b=e[2],y=e[3],w=e[8],M=e[9],T=e[10],E=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=m*c-w*a,t[1]=p*c-M*a,t[2]=b*c-T*a,t[3]=y*c-E*a,t[8]=m*a+w*c,t[9]=p*a+M*c,t[10]=b*a+T*c,t[11]=y*a+E*c,t},Gt.rotateZ=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),m=e[0],p=e[1],b=e[2],y=e[3],w=e[4],M=e[5],T=e[6],E=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=m*c+w*a,t[1]=p*c+M*a,t[2]=b*c+T*a,t[3]=y*c+E*a,t[4]=w*c-m*a,t[5]=M*c-p*a,t[6]=T*c-b*a,t[7]=E*c-y*a,t},Gt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Gt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromRotation=function(t,e,n){var a,c,m,p=n[0],b=n[1],y=n[2],w=Math.hypot(p,b,y);return w<Cn.EPSILON?null:(p*=w=1/w,b*=w,y*=w,a=Math.sin(e),c=Math.cos(e),t[0]=p*p*(m=1-c)+c,t[1]=b*p*m+y*a,t[2]=y*p*m-b*a,t[3]=0,t[4]=p*b*m-y*a,t[5]=b*b*m+c,t[6]=y*b*m+p*a,t[7]=0,t[8]=p*y*m+b*a,t[9]=b*y*m-p*a,t[10]=y*y*m+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Gt.fromXRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromYRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromZRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromRotationTranslation=Dd,Gt.fromQuat2=function(t,e){var n=new Cn.ARRAY_TYPE(3),a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=a*a+c*c+m*m+p*p;return T>0?(n[0]=2*(b*p+M*a+y*m-w*c)/T,n[1]=2*(y*p+M*c+w*a-b*m)/T,n[2]=2*(w*p+M*m+b*c-y*a)/T):(n[0]=2*(b*p+M*a+y*m-w*c),n[1]=2*(y*p+M*c+w*a-b*m),n[2]=2*(w*p+M*m+b*c-y*a)),Dd(t,e,n),t},Gt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Gt.getScaling=Jl,Gt.getRotation=function(t,e){var n=new Cn.ARRAY_TYPE(3);Jl(n,e);var a=1/n[0],c=1/n[1],m=1/n[2],p=e[0]*a,b=e[1]*c,y=e[2]*m,w=e[4]*a,M=e[5]*c,T=e[6]*m,E=e[8]*a,P=e[9]*c,R=e[10]*m,F=p+M+R,B=0;return F>0?(B=2*Math.sqrt(F+1),t[3]=.25*B,t[0]=(T-P)/B,t[1]=(E-y)/B,t[2]=(b-w)/B):p>M&&p>R?(B=2*Math.sqrt(1+p-M-R),t[3]=(T-P)/B,t[0]=.25*B,t[1]=(b+w)/B,t[2]=(E+y)/B):M>R?(B=2*Math.sqrt(1+M-p-R),t[3]=(E-y)/B,t[0]=(b+w)/B,t[1]=.25*B,t[2]=(T+P)/B):(B=2*Math.sqrt(1+R-p-M),t[3]=(b-w)/B,t[0]=(E+y)/B,t[1]=(T+P)/B,t[2]=.25*B),t},Gt.fromRotationTranslationScale=function(t,e,n,a){var c=e[0],m=e[1],p=e[2],b=e[3],y=c+c,w=m+m,M=p+p,T=c*y,E=c*w,P=c*M,R=m*w,F=m*M,B=p*M,W=b*y,J=b*w,ee=b*M,te=a[0],pe=a[1],he=a[2];return t[0]=(1-(R+B))*te,t[1]=(E+ee)*te,t[2]=(P-J)*te,t[3]=0,t[4]=(E-ee)*pe,t[5]=(1-(T+B))*pe,t[6]=(F+W)*pe,t[7]=0,t[8]=(P+J)*he,t[9]=(F-W)*he,t[10]=(1-(T+R))*he,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Gt.fromRotationTranslationScaleOrigin=function(t,e,n,a,c){var m=e[0],p=e[1],b=e[2],y=e[3],w=m+m,M=p+p,T=b+b,E=m*w,P=m*M,R=m*T,F=p*M,B=p*T,W=b*T,J=y*w,ee=y*M,te=y*T,pe=a[0],he=a[1],ve=a[2],Ce=c[0],De=c[1],Ue=c[2],ze=(1-(F+W))*pe,$e=(P+te)*pe,rt=(R-ee)*pe,We=(P-te)*he,et=(1-(E+W))*he,He=(B+J)*he,tt=(R+ee)*ve,lt=(B-J)*ve,nt=(1-(E+F))*ve;return t[0]=ze,t[1]=$e,t[2]=rt,t[3]=0,t[4]=We,t[5]=et,t[6]=He,t[7]=0,t[8]=tt,t[9]=lt,t[10]=nt,t[11]=0,t[12]=n[0]+Ce-(ze*Ce+We*De+tt*Ue),t[13]=n[1]+De-($e*Ce+et*De+lt*Ue),t[14]=n[2]+Ue-(rt*Ce+He*De+nt*Ue),t[15]=1,t},Gt.fromQuat=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n+n,b=a+a,y=c+c,w=n*p,M=a*p,T=a*b,E=c*p,P=c*b,R=c*y,F=m*p,B=m*b,W=m*y;return t[0]=1-T-R,t[1]=M+W,t[2]=E-B,t[3]=0,t[4]=M-W,t[5]=1-w-R,t[6]=P+F,t[7]=0,t[8]=E+B,t[9]=P-F,t[10]=1-w-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.frustum=function(t,e,n,a,c,m,p){var b=1/(n-e),y=1/(c-a),w=1/(m-p);return t[0]=2*m*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*m*y,t[6]=0,t[7]=0,t[8]=(n+e)*b,t[9]=(c+a)*y,t[10]=(p+m)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*m*2*w,t[15]=0,t},Gt.perspectiveNO=ra,Gt.perspectiveZO=function(t,e,n,a,c){var m,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=c*(m=1/(a-c)),t[14]=c*a*m):(t[10]=-1,t[14]=-a),t},Gt.perspectiveFromFieldOfView=function(t,e,n,a){var c=Math.tan(e.upDegrees*Math.PI/180),m=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),b=Math.tan(e.rightDegrees*Math.PI/180),y=2/(p+b),w=2/(c+m);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=-(p-b)*y*.5,t[9]=(c-m)*w*.5,t[10]=a/(n-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n/(n-a),t[15]=0,t},Gt.orthoNO=oa,Gt.orthoZO=function(t,e,n,a,c,m,p){var b=1/(e-n),y=1/(a-c),w=1/(m-p);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=w,t[11]=0,t[12]=(e+n)*b,t[13]=(c+a)*y,t[14]=m*w,t[15]=1,t},Gt.lookAt=function(t,e,n,a){var c,m,p,b,y,w,M,T,E,P,R=e[0],F=e[1],B=e[2],W=a[0],J=a[1],ee=a[2],te=n[0],pe=n[1],he=n[2];return Math.abs(R-te)<Cn.EPSILON&&Math.abs(F-pe)<Cn.EPSILON&&Math.abs(B-he)<Cn.EPSILON?nu(t):(M=R-te,T=F-pe,E=B-he,c=J*(E*=P=1/Math.hypot(M,T,E))-ee*(T*=P),m=ee*(M*=P)-W*E,p=W*T-J*M,(P=Math.hypot(c,m,p))?(c*=P=1/P,m*=P,p*=P):(c=0,m=0,p=0),b=T*p-E*m,y=E*c-M*p,w=M*m-T*c,(P=Math.hypot(b,y,w))?(b*=P=1/P,y*=P,w*=P):(b=0,y=0,w=0),t[0]=c,t[1]=b,t[2]=M,t[3]=0,t[4]=m,t[5]=y,t[6]=T,t[7]=0,t[8]=p,t[9]=w,t[10]=E,t[11]=0,t[12]=-(c*R+m*F+p*B),t[13]=-(b*R+y*F+w*B),t[14]=-(M*R+T*F+E*B),t[15]=1,t)},Gt.targetTo=function(t,e,n,a){var c=e[0],m=e[1],p=e[2],b=a[0],y=a[1],w=a[2],M=c-n[0],T=m-n[1],E=p-n[2],P=M*M+T*T+E*E;P>0&&(M*=P=1/Math.sqrt(P),T*=P,E*=P);var R=y*E-w*T,F=w*M-b*E,B=b*T-y*M;return(P=R*R+F*F+B*B)>0&&(R*=P=1/Math.sqrt(P),F*=P,B*=P),t[0]=R,t[1]=F,t[2]=B,t[3]=0,t[4]=T*B-E*F,t[5]=E*R-M*B,t[6]=M*F-T*R,t[7]=0,t[8]=M,t[9]=T,t[10]=E,t[11]=0,t[12]=c,t[13]=m,t[14]=p,t[15]=1,t},Gt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Gt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Gt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Gt.subtract=Ad,Gt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Gt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t[9]=e[9]+n[9]*a,t[10]=e[10]+n[10]*a,t[11]=e[11]+n[11]*a,t[12]=e[12]+n[12]*a,t[13]=e[13]+n[13]*a,t[14]=e[14]+n[14]*a,t[15]=e[15]+n[15]*a,t},Gt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Gt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=t[4],b=t[5],y=t[6],w=t[7],M=t[8],T=t[9],E=t[10],P=t[11],R=t[12],F=t[13],B=t[14],W=t[15],J=e[0],ee=e[1],te=e[2],pe=e[3],he=e[4],ve=e[5],Ce=e[6],De=e[7],Ue=e[8],ze=e[9],$e=e[10],rt=e[11],We=e[12],et=e[13],He=e[14],tt=e[15];return Math.abs(n-J)<=Cn.EPSILON*Math.max(1,Math.abs(n),Math.abs(J))&&Math.abs(a-ee)<=Cn.EPSILON*Math.max(1,Math.abs(a),Math.abs(ee))&&Math.abs(c-te)<=Cn.EPSILON*Math.max(1,Math.abs(c),Math.abs(te))&&Math.abs(m-pe)<=Cn.EPSILON*Math.max(1,Math.abs(m),Math.abs(pe))&&Math.abs(p-he)<=Cn.EPSILON*Math.max(1,Math.abs(p),Math.abs(he))&&Math.abs(b-ve)<=Cn.EPSILON*Math.max(1,Math.abs(b),Math.abs(ve))&&Math.abs(y-Ce)<=Cn.EPSILON*Math.max(1,Math.abs(y),Math.abs(Ce))&&Math.abs(w-De)<=Cn.EPSILON*Math.max(1,Math.abs(w),Math.abs(De))&&Math.abs(M-Ue)<=Cn.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ue))&&Math.abs(T-ze)<=Cn.EPSILON*Math.max(1,Math.abs(T),Math.abs(ze))&&Math.abs(E-$e)<=Cn.EPSILON*Math.max(1,Math.abs(E),Math.abs($e))&&Math.abs(P-rt)<=Cn.EPSILON*Math.max(1,Math.abs(P),Math.abs(rt))&&Math.abs(R-We)<=Cn.EPSILON*Math.max(1,Math.abs(R),Math.abs(We))&&Math.abs(F-et)<=Cn.EPSILON*Math.max(1,Math.abs(F),Math.abs(et))&&Math.abs(B-He)<=Cn.EPSILON*Math.max(1,Math.abs(B),Math.abs(He))&&Math.abs(W-tt)<=Cn.EPSILON*Math.max(1,Math.abs(W),Math.abs(tt))},Gt.sub=Gt.mul=Gt.ortho=Gt.perspective=void 0;var Cn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Kl(t)!=="object"&&typeof t!="function")return{default:t};var n=iu(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ut);function iu(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(iu=function(a){return a?n:e})(t)}function nu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ru(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=e[8],E=e[9],P=e[10],R=e[11],F=e[12],B=e[13],W=e[14],J=e[15],ee=n[0],te=n[1],pe=n[2],he=n[3];return t[0]=ee*a+te*b+pe*T+he*F,t[1]=ee*c+te*y+pe*E+he*B,t[2]=ee*m+te*w+pe*P+he*W,t[3]=ee*p+te*M+pe*R+he*J,t[4]=(ee=n[4])*a+(te=n[5])*b+(pe=n[6])*T+(he=n[7])*F,t[5]=ee*c+te*y+pe*E+he*B,t[6]=ee*m+te*w+pe*P+he*W,t[7]=ee*p+te*M+pe*R+he*J,t[8]=(ee=n[8])*a+(te=n[9])*b+(pe=n[10])*T+(he=n[11])*F,t[9]=ee*c+te*y+pe*E+he*B,t[10]=ee*m+te*w+pe*P+he*W,t[11]=ee*p+te*M+pe*R+he*J,t[12]=(ee=n[12])*a+(te=n[13])*b+(pe=n[14])*T+(he=n[15])*F,t[13]=ee*c+te*y+pe*E+he*B,t[14]=ee*m+te*w+pe*P+he*W,t[15]=ee*p+te*M+pe*R+he*J,t}function Dd(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=a+a,y=c+c,w=m+m,M=a*b,T=a*y,E=a*w,P=c*y,R=c*w,F=m*w,B=p*b,W=p*y,J=p*w;return t[0]=1-(P+F),t[1]=T+J,t[2]=E-W,t[3]=0,t[4]=T-J,t[5]=1-(M+F),t[6]=R+B,t[7]=0,t[8]=E+W,t[9]=R-B,t[10]=1-(M+P),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Jl(t,e){var n=e[4],a=e[5],c=e[6],m=e[8],p=e[9],b=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,a,c),t[2]=Math.hypot(m,p,b),t}function ra(t,e,n,a,c){var m,p=1/Math.tan(e/2);return t[0]=p/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+a)*(m=1/(a-c)),t[14]=2*c*a*m):(t[10]=-1,t[14]=-2*a),t}function oa(t,e,n,a,c,m,p){var b=1/(e-n),y=1/(a-c),w=1/(m-p);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*b,t[13]=(c+a)*y,t[14]=(p+m)*w,t[15]=1,t}function Ad(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Gt.perspective=ra,Gt.ortho=oa,Gt.mul=ru,Gt.sub=Ad;var Xt={},Jt={};function ec(t){return ec=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ec(t)}Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=tc,Jt.clone=function(t){var e=new fo.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Jt.length=ic,Jt.fromValues=function(t,e,n){var a=new fo.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=n,a},Jt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Jt.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},Jt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Jt.subtract=Pd,Jt.multiply=Ss,Jt.divide=ol,Jt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Jt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Jt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Jt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Jt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Jt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Jt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t},Jt.distance=nc,Jt.squaredDistance=Od,Jt.squaredLength=rc,Jt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Jt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Jt.normalize=function(t,e){var n=e[0],a=e[1],c=e[2],m=n*n+a*a+c*c;return m>0&&(m=1/Math.sqrt(m)),t[0]=e[0]*m,t[1]=e[1]*m,t[2]=e[2]*m,t},Jt.dot=oc,Jt.cross=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=n[0],b=n[1],y=n[2];return t[0]=c*y-m*b,t[1]=m*p-a*y,t[2]=a*b-c*p,t},Jt.lerp=function(t,e,n,a){var c=e[0],m=e[1],p=e[2];return t[0]=c+a*(n[0]-c),t[1]=m+a*(n[1]-m),t[2]=p+a*(n[2]-p),t},Jt.hermite=function(t,e,n,a,c,m){var p=m*m,b=p*(2*m-3)+1,y=p*(m-2)+m,w=p*(m-1),M=p*(3-2*m);return t[0]=e[0]*b+n[0]*y+a[0]*w+c[0]*M,t[1]=e[1]*b+n[1]*y+a[1]*w+c[1]*M,t[2]=e[2]*b+n[2]*y+a[2]*w+c[2]*M,t},Jt.bezier=function(t,e,n,a,c,m){var p=1-m,b=p*p,y=m*m,w=b*p,M=3*m*b,T=3*y*p,E=y*m;return t[0]=e[0]*w+n[0]*M+a[0]*T+c[0]*E,t[1]=e[1]*w+n[1]*M+a[1]*T+c[1]*E,t[2]=e[2]*w+n[2]*M+a[2]*T+c[2]*E,t},Jt.random=function(t,e){e=e||1;var n=2*fo.RANDOM()*Math.PI,a=2*fo.RANDOM()-1,c=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(n)*c,t[1]=Math.sin(n)*c,t[2]=a*e,t},Jt.transformMat4=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=n[3]*a+n[7]*c+n[11]*m+n[15];return t[0]=(n[0]*a+n[4]*c+n[8]*m+n[12])/(p=p||1),t[1]=(n[1]*a+n[5]*c+n[9]*m+n[13])/p,t[2]=(n[2]*a+n[6]*c+n[10]*m+n[14])/p,t},Jt.transformMat3=function(t,e,n){var a=e[0],c=e[1],m=e[2];return t[0]=a*n[0]+c*n[3]+m*n[6],t[1]=a*n[1]+c*n[4]+m*n[7],t[2]=a*n[2]+c*n[5]+m*n[8],t},Jt.transformQuat=function(t,e,n){var a=n[0],c=n[1],m=n[2],p=e[0],b=e[1],y=e[2],w=c*y-m*b,M=m*p-a*y,T=a*b-c*p,E=c*T-m*M,P=m*w-a*T,R=a*M-c*w,F=2*n[3];return M*=F,T*=F,P*=2,R*=2,t[0]=p+(w*=F)+(E*=2),t[1]=b+M+P,t[2]=y+T+R,t},Jt.rotateX=function(t,e,n,a){var c=[],m=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],m[0]=c[0],m[1]=c[1]*Math.cos(a)-c[2]*Math.sin(a),m[2]=c[1]*Math.sin(a)+c[2]*Math.cos(a),t[0]=m[0]+n[0],t[1]=m[1]+n[1],t[2]=m[2]+n[2],t},Jt.rotateY=function(t,e,n,a){var c=[],m=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],m[0]=c[2]*Math.sin(a)+c[0]*Math.cos(a),m[1]=c[1],m[2]=c[2]*Math.cos(a)-c[0]*Math.sin(a),t[0]=m[0]+n[0],t[1]=m[1]+n[1],t[2]=m[2]+n[2],t},Jt.rotateZ=function(t,e,n,a){var c=[],m=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],m[0]=c[0]*Math.cos(a)-c[1]*Math.sin(a),m[1]=c[0]*Math.sin(a)+c[1]*Math.cos(a),m[2]=c[2],t[0]=m[0]+n[0],t[1]=m[1]+n[1],t[2]=m[2]+n[2],t},Jt.angle=function(t,e){var n=t[0],a=t[1],c=t[2],m=e[0],p=e[1],b=e[2],y=Math.sqrt(n*n+a*a+c*c)*Math.sqrt(m*m+p*p+b*b),w=y&&oc(t,e)/y;return Math.acos(Math.min(Math.max(w,-1),1))},Jt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Jt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Jt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Jt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=e[0],p=e[1],b=e[2];return Math.abs(n-m)<=fo.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-p)<=fo.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(c-b)<=fo.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))},Jt.forEach=Jt.sqrLen=Jt.len=Jt.sqrDist=Jt.dist=Jt.div=Jt.mul=Jt.sub=void 0;var fo=function(t,e){if(t&&t.__esModule)return t;if(t===null||ec(t)!=="object"&&typeof t!="function")return{default:t};var n=rl(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ut);function rl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(rl=function(a){return a?n:e})(t)}function tc(){var t=new fo.ARRAY_TYPE(3);return fo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ic(t){return Math.hypot(t[0],t[1],t[2])}function Pd(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ss(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ol(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function nc(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Od(t,e){var n=e[0]-t[0],a=e[1]-t[1],c=e[2]-t[2];return n*n+a*a+c*c}function rc(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a}function oc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Jt.sub=Pd,Jt.mul=Ss,Jt.div=ol,Jt.dist=nc,Jt.sqrDist=Od,Jt.len=ic,Jt.sqrLen=rc;var zo,ou=(zo=tc(),function(t,e,n,a,c,m){var p,b;for(e||(e=3),n||(n=0),b=a?Math.min(a*e+n,t.length):t.length,p=n;p<b;p+=e)zo[0]=t[p],zo[1]=t[p+1],zo[2]=t[p+2],c(zo,zo,m),t[p]=zo[0],t[p+1]=zo[1],t[p+2]=zo[2];return t});Jt.forEach=ou;var ei={};function Rd(t){return Rd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rd(t)}Object.defineProperty(ei,"__esModule",{value:!0}),ei.create=al,ei.clone=function(t){var e=new Nn.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ei.fromValues=function(t,e,n,a){var c=new Nn.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=a,c},ei.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ei.set=function(t,e,n,a,c){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t},ei.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},ei.subtract=va,ei.multiply=xa,ei.divide=Ld,ei.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},ei.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},ei.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},ei.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},ei.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},ei.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},ei.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},ei.distance=Ms,ei.squaredDistance=ks,ei.length=sc,ei.squaredLength=lc,ei.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},ei.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},ei.normalize=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n*n+a*a+c*c+m*m;return p>0&&(p=1/Math.sqrt(p)),t[0]=n*p,t[1]=a*p,t[2]=c*p,t[3]=m*p,t},ei.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},ei.cross=function(t,e,n,a){var c=n[0]*a[1]-n[1]*a[0],m=n[0]*a[2]-n[2]*a[0],p=n[0]*a[3]-n[3]*a[0],b=n[1]*a[2]-n[2]*a[1],y=n[1]*a[3]-n[3]*a[1],w=n[2]*a[3]-n[3]*a[2],M=e[0],T=e[1],E=e[2],P=e[3];return t[0]=T*w-E*y+P*b,t[1]=-M*w+E*p-P*m,t[2]=M*y-T*p+P*c,t[3]=-M*b+T*m-E*c,t},ei.lerp=function(t,e,n,a){var c=e[0],m=e[1],p=e[2],b=e[3];return t[0]=c+a*(n[0]-c),t[1]=m+a*(n[1]-m),t[2]=p+a*(n[2]-p),t[3]=b+a*(n[3]-b),t},ei.random=function(t,e){var n,a,c,m,p,b;e=e||1;do p=(n=2*Nn.RANDOM()-1)*n+(a=2*Nn.RANDOM()-1)*a;while(p>=1);do b=(c=2*Nn.RANDOM()-1)*c+(m=2*Nn.RANDOM()-1)*m;while(b>=1);var y=Math.sqrt((1-p)/b);return t[0]=e*n,t[1]=e*a,t[2]=e*c*y,t[3]=e*m*y,t},ei.transformMat4=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3];return t[0]=n[0]*a+n[4]*c+n[8]*m+n[12]*p,t[1]=n[1]*a+n[5]*c+n[9]*m+n[13]*p,t[2]=n[2]*a+n[6]*c+n[10]*m+n[14]*p,t[3]=n[3]*a+n[7]*c+n[11]*m+n[15]*p,t},ei.transformQuat=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=n[0],b=n[1],y=n[2],w=n[3],M=w*a+b*m-y*c,T=w*c+y*a-p*m,E=w*m+p*c-b*a,P=-p*a-b*c-y*m;return t[0]=M*w+P*-p+T*-y-E*-b,t[1]=T*w+P*-b+E*-p-M*-y,t[2]=E*w+P*-y+M*-b-T*-p,t[3]=e[3],t},ei.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},ei.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ei.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},ei.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=e[0],b=e[1],y=e[2],w=e[3];return Math.abs(n-p)<=Nn.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-b)<=Nn.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(c-y)<=Nn.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(m-w)<=Nn.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))},ei.forEach=ei.sqrLen=ei.len=ei.sqrDist=ei.dist=ei.div=ei.mul=ei.sub=void 0;var Nn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Rd(t)!=="object"&&typeof t!="function")return{default:t};var n=ac(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ut);function ac(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ac=function(a){return a?n:e})(t)}function al(){var t=new Nn.ARRAY_TYPE(4);return Nn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function va(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function xa(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Ld(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Ms(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function ks(t,e){var n=e[0]-t[0],a=e[1]-t[1],c=e[2]-t[2],m=e[3]-t[3];return n*n+a*a+c*c+m*m}function sc(t){return Math.hypot(t[0],t[1],t[2],t[3])}function lc(t){var e=t[0],n=t[1],a=t[2],c=t[3];return e*e+n*n+a*a+c*c}ei.sub=va,ei.mul=xa,ei.div=Ld,ei.dist=Ms,ei.sqrDist=ks,ei.len=sc,ei.sqrLen=lc;var au=function(){var t=al();return function(e,n,a,c,m,p){var b,y;for(n||(n=4),a||(a=0),y=c?Math.min(c*n+a,e.length):e.length,b=a;b<y;b+=n)t[0]=e[b],t[1]=e[b+1],t[2]=e[b+2],t[3]=e[b+3],m(t,t,p),e[b]=t[0],e[b+1]=t[1],e[b+2]=t[2],e[b+3]=t[3];return e}}();function cc(t){return cc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cc(t)}ei.forEach=au,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=dc,Xt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Xt.setAxisAngle=Fd,Xt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>Bo.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n},Xt.getAngle=function(t,e){var n=ye(t,e);return Math.acos(2*n*n-1)},Xt.multiply=hc,Xt.rotateX=function(t,e,n){n*=.5;var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return t[0]=a*y+p*b,t[1]=c*y+m*b,t[2]=m*y-c*b,t[3]=p*y-a*b,t},Xt.rotateY=function(t,e,n){n*=.5;var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return t[0]=a*y-m*b,t[1]=c*y+p*b,t[2]=m*y+a*b,t[3]=p*y-c*b,t},Xt.rotateZ=function(t,e,n){n*=.5;var a=e[0],c=e[1],m=e[2],p=e[3],b=Math.sin(n),y=Math.cos(n);return t[0]=a*y+c*b,t[1]=c*y-a*b,t[2]=m*y+p*b,t[3]=p*y-m*b,t},Xt.calculateW=function(t,e){var n=e[0],a=e[1],c=e[2];return t[0]=n,t[1]=a,t[2]=c,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-c*c)),t},Xt.exp=Se,Xt.ln=G,Xt.pow=function(t,e,n){return G(t,e),be(t,t,n),Se(t,t),t},Xt.slerp=K,Xt.random=function(t){var e=Bo.RANDOM(),n=Bo.RANDOM(),a=Bo.RANDOM(),c=Math.sqrt(1-e),m=Math.sqrt(e);return t[0]=c*Math.sin(2*Math.PI*n),t[1]=c*Math.cos(2*Math.PI*n),t[2]=m*Math.sin(2*Math.PI*a),t[3]=m*Math.cos(2*Math.PI*a),t},Xt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=n*n+a*a+c*c+m*m,b=p?1/p:0;return t[0]=-n*b,t[1]=-a*b,t[2]=-c*b,t[3]=m*b,t},Xt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Xt.fromMat3=ce,Xt.fromEuler=function(t,e,n,a){var c=.5*Math.PI/180;e*=c,n*=c,a*=c;var m=Math.sin(e),p=Math.cos(e),b=Math.sin(n),y=Math.cos(n),w=Math.sin(a),M=Math.cos(a);return t[0]=m*y*M-p*b*w,t[1]=p*b*M+m*y*w,t[2]=p*y*w-m*b*M,t[3]=p*y*M+m*b*w,t},Xt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Xt.setAxes=Xt.sqlerp=Xt.rotationTo=Xt.equals=Xt.exactEquals=Xt.normalize=Xt.sqrLen=Xt.squaredLength=Xt.len=Xt.length=Xt.lerp=Xt.dot=Xt.scale=Xt.mul=Xt.add=Xt.set=Xt.copy=Xt.fromValues=Xt.clone=void 0;var Bo=sl(ut),Is=sl(Ii),No=sl(Jt),Mr=sl(ei);function su(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(su=function(a){return a?n:e})(t)}function sl(t,e){if(t&&t.__esModule)return t;if(t===null||cc(t)!=="object"&&typeof t!="function")return{default:t};var n=su(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}function dc(){var t=new Bo.ARRAY_TYPE(4);return Bo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Fd(t,e,n){n*=.5;var a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t}function hc(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return t[0]=a*M+p*b+c*w-m*y,t[1]=c*M+p*y+m*b-a*w,t[2]=m*M+p*w+a*y-c*b,t[3]=p*M-a*b-c*y-m*w,t}function Se(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=Math.sqrt(n*n+a*a+c*c),b=Math.exp(m),y=p>0?b*Math.sin(p)/p:0;return t[0]=n*y,t[1]=a*y,t[2]=c*y,t[3]=b*Math.cos(p),t}function G(t,e){var n=e[0],a=e[1],c=e[2],m=e[3],p=Math.sqrt(n*n+a*a+c*c),b=p>0?Math.atan2(p,m)/p:0;return t[0]=n*b,t[1]=a*b,t[2]=c*b,t[3]=.5*Math.log(n*n+a*a+c*c+m*m),t}function K(t,e,n,a){var c,m,p,b,y,w=e[0],M=e[1],T=e[2],E=e[3],P=n[0],R=n[1],F=n[2],B=n[3];return(m=w*P+M*R+T*F+E*B)<0&&(m=-m,P=-P,R=-R,F=-F,B=-B),1-m>Bo.EPSILON?(c=Math.acos(m),p=Math.sin(c),b=Math.sin((1-a)*c)/p,y=Math.sin(a*c)/p):(b=1-a,y=a),t[0]=b*w+y*P,t[1]=b*M+y*R,t[2]=b*T+y*F,t[3]=b*E+y*B,t}function ce(t,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var m=(c+1)%3,p=(c+2)%3;n=Math.sqrt(e[3*c+c]-e[3*m+m]-e[3*p+p]+1),t[c]=.5*n,t[3]=(e[3*m+p]-e[3*p+m])*(n=.5/n),t[m]=(e[3*m+c]+e[3*c+m])*n,t[p]=(e[3*p+c]+e[3*c+p])*n}return t}Xt.clone=Mr.clone,Xt.fromValues=Mr.fromValues,Xt.copy=Mr.copy,Xt.set=Mr.set,Xt.add=Mr.add,Xt.mul=hc;var be=Mr.scale;Xt.scale=be;var ye=Mr.dot;Xt.dot=ye,Xt.lerp=Mr.lerp;var Ee=Mr.length;Xt.length=Ee,Xt.len=Ee;var Ne=Mr.squaredLength;Xt.squaredLength=Ne,Xt.sqrLen=Ne;var Ie=Mr.normalize;Xt.normalize=Ie,Xt.exactEquals=Mr.exactEquals,Xt.equals=Mr.equals;var je,mt,at,Lt=(je=No.create(),mt=No.fromValues(1,0,0),at=No.fromValues(0,1,0),function(t,e,n){var a=No.dot(e,n);return a<-.999999?(No.cross(je,mt,e),No.len(je)<1e-6&&No.cross(je,at,e),No.normalize(je,je),Fd(t,je,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(No.cross(je,e,n),t[0]=je[0],t[1]=je[1],t[2]=je[2],t[3]=1+a,Ie(t,t))});Xt.rotationTo=Lt;var $t,mi,yi=($t=dc(),mi=dc(),function(t,e,n,a,c,m){return K($t,e,c,m),K(mi,n,a,m),K(t,$t,mi,2*m*(1-m)),t});Xt.sqlerp=yi;var ni,Ti=(ni=Is.create(),function(t,e,n,a){return ni[0]=n[0],ni[3]=n[1],ni[6]=n[2],ni[1]=a[0],ni[4]=a[1],ni[7]=a[2],ni[2]=-e[0],ni[5]=-e[1],ni[8]=-e[2],Ie(t,ce(t,ni))});Xt.setAxes=Ti;var At={};function Sn(t){return Sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sn(t)}Object.defineProperty(At,"__esModule",{value:!0}),At.create=function(){var t=new Ki.ARRAY_TYPE(8);return Ki.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},At.clone=function(t){var e=new Ki.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},At.fromValues=function(t,e,n,a,c,m,p,b){var y=new Ki.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=a,y[4]=c,y[5]=m,y[6]=p,y[7]=b,y},At.fromRotationTranslationValues=function(t,e,n,a,c,m,p){var b=new Ki.ARRAY_TYPE(8);b[0]=t,b[1]=e,b[2]=n,b[3]=a;var y=.5*c,w=.5*m,M=.5*p;return b[4]=y*a+w*n-M*e,b[5]=w*a+M*t-y*n,b[6]=M*a+y*e-w*t,b[7]=-y*t-w*e-M*n,b},At.fromRotationTranslation=Vr,At.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},At.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},At.fromMat4=function(t,e){var n=Pi.create();Yn.getRotation(n,e);var a=new Ki.ARRAY_TYPE(3);return Yn.getTranslation(a,e),Vr(t,n,a),t},At.copy=jr,At.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},At.set=function(t,e,n,a,c,m,p,b,y){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=m,t[5]=p,t[6]=b,t[7]=y,t},At.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},At.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},At.getTranslation=function(t,e){var n=e[4],a=e[5],c=e[6],m=e[7],p=-e[0],b=-e[1],y=-e[2],w=e[3];return t[0]=2*(n*w+m*p+a*y-c*b),t[1]=2*(a*w+m*b+c*p-n*y),t[2]=2*(c*w+m*y+n*b-a*p),t},At.translate=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=.5*n[0],y=.5*n[1],w=.5*n[2],M=e[4],T=e[5],E=e[6],P=e[7];return t[0]=a,t[1]=c,t[2]=m,t[3]=p,t[4]=p*b+c*w-m*y+M,t[5]=p*y+m*b-a*w+T,t[6]=p*w+a*y-c*b+E,t[7]=-a*b-c*y-m*w+P,t},At.rotateX=function(t,e,n){var a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*a+y*m-w*c,E=y*p+M*c+w*a-b*m,P=w*p+M*m+b*c-y*a,R=M*p-b*a-y*c-w*m;return Pi.rotateX(t,e,n),t[4]=T*(p=t[3])+R*(a=t[0])+E*(m=t[2])-P*(c=t[1]),t[5]=E*p+R*c+P*a-T*m,t[6]=P*p+R*m+T*c-E*a,t[7]=R*p-T*a-E*c-P*m,t},At.rotateY=function(t,e,n){var a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*a+y*m-w*c,E=y*p+M*c+w*a-b*m,P=w*p+M*m+b*c-y*a,R=M*p-b*a-y*c-w*m;return Pi.rotateY(t,e,n),t[4]=T*(p=t[3])+R*(a=t[0])+E*(m=t[2])-P*(c=t[1]),t[5]=E*p+R*c+P*a-T*m,t[6]=P*p+R*m+T*c-E*a,t[7]=R*p-T*a-E*c-P*m,t},At.rotateZ=function(t,e,n){var a=-e[0],c=-e[1],m=-e[2],p=e[3],b=e[4],y=e[5],w=e[6],M=e[7],T=b*p+M*a+y*m-w*c,E=y*p+M*c+w*a-b*m,P=w*p+M*m+b*c-y*a,R=M*p-b*a-y*c-w*m;return Pi.rotateZ(t,e,n),t[4]=T*(p=t[3])+R*(a=t[0])+E*(m=t[2])-P*(c=t[1]),t[5]=E*p+R*c+P*a-T*m,t[6]=P*p+R*m+T*c-E*a,t[7]=R*p-T*a-E*c-P*m,t},At.rotateByQuatAppend=function(t,e,n){var a=n[0],c=n[1],m=n[2],p=n[3],b=e[0],y=e[1],w=e[2],M=e[3];return t[0]=b*p+M*a+y*m-w*c,t[1]=y*p+M*c+w*a-b*m,t[2]=w*p+M*m+b*c-y*a,t[3]=M*p-b*a-y*c-w*m,t[4]=(b=e[4])*p+(M=e[7])*a+(y=e[5])*m-(w=e[6])*c,t[5]=y*p+M*c+w*a-b*m,t[6]=w*p+M*m+b*c-y*a,t[7]=M*p-b*a-y*c-w*m,t},At.rotateByQuatPrepend=function(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[0],y=n[1],w=n[2],M=n[3];return t[0]=a*M+p*b+c*w-m*y,t[1]=c*M+p*y+m*b-a*w,t[2]=m*M+p*w+a*y-c*b,t[3]=p*M-a*b-c*y-m*w,t[4]=a*(M=n[7])+p*(b=n[4])+c*(w=n[6])-m*(y=n[5]),t[5]=c*M+p*y+m*b-a*w,t[6]=m*M+p*w+a*y-c*b,t[7]=p*M-a*b-c*y-m*w,t},At.rotateAroundAxis=function(t,e,n,a){if(Math.abs(a)<Ki.EPSILON)return jr(t,e);var c=Math.hypot(n[0],n[1],n[2]);a*=.5;var m=Math.sin(a),p=m*n[0]/c,b=m*n[1]/c,y=m*n[2]/c,w=Math.cos(a),M=e[0],T=e[1],E=e[2],P=e[3];t[0]=M*w+P*p+T*y-E*b,t[1]=T*w+P*b+E*p-M*y,t[2]=E*w+P*y+M*b-T*p,t[3]=P*w-M*p-T*b-E*y;var R=e[4],F=e[5],B=e[6],W=e[7];return t[4]=R*w+W*p+F*y-B*b,t[5]=F*w+W*b+B*p-R*y,t[6]=B*w+W*y+R*b-F*p,t[7]=W*w-R*p-F*b-B*y,t},At.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},At.multiply=ll,At.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},At.lerp=function(t,e,n,a){var c=1-a;return op(e,n)<0&&(a=-a),t[0]=e[0]*c+n[0]*a,t[1]=e[1]*c+n[1]*a,t[2]=e[2]*c+n[2]*a,t[3]=e[3]*c+n[3]*a,t[4]=e[4]*c+n[4]*a,t[5]=e[5]*c+n[5]*a,t[6]=e[6]*c+n[6]*a,t[7]=e[7]*c+n[7]*a,t},At.invert=function(t,e){var n=zd(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},At.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},At.normalize=function(t,e){var n=zd(e);if(n>0){n=Math.sqrt(n);var a=e[0]/n,c=e[1]/n,m=e[2]/n,p=e[3]/n,b=e[4],y=e[5],w=e[6],M=e[7],T=a*b+c*y+m*w+p*M;t[0]=a,t[1]=c,t[2]=m,t[3]=p,t[4]=(b-a*T)/n,t[5]=(y-c*T)/n,t[6]=(w-m*T)/n,t[7]=(M-p*T)/n}return t},At.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},At.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},At.equals=function(t,e){var n=t[0],a=t[1],c=t[2],m=t[3],p=t[4],b=t[5],y=t[6],w=t[7],M=e[0],T=e[1],E=e[2],P=e[3],R=e[4],F=e[5],B=e[6],W=e[7];return Math.abs(n-M)<=Ki.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(a-T)<=Ki.EPSILON*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(c-E)<=Ki.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(m-P)<=Ki.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(p-R)<=Ki.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(b-F)<=Ki.EPSILON*Math.max(1,Math.abs(b),Math.abs(F))&&Math.abs(y-B)<=Ki.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(w-W)<=Ki.EPSILON*Math.max(1,Math.abs(w),Math.abs(W))},At.sqrLen=At.squaredLength=At.len=At.length=At.dot=At.mul=At.setReal=At.getReal=void 0;var Ki=ar(ut),Pi=ar(Xt),Yn=ar(Gt);function Mn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Mn=function(a){return a?n:e})(t)}function ar(t,e){if(t&&t.__esModule)return t;if(t===null||Sn(t)!=="object"&&typeof t!="function")return{default:t};var n=Mn(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}function Vr(t,e,n){var a=.5*n[0],c=.5*n[1],m=.5*n[2],p=e[0],b=e[1],y=e[2],w=e[3];return t[0]=p,t[1]=b,t[2]=y,t[3]=w,t[4]=a*w+c*y-m*b,t[5]=c*w+m*p-a*y,t[6]=m*w+a*b-c*p,t[7]=-a*p-c*b-m*y,t}function jr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function ll(t,e,n){var a=e[0],c=e[1],m=e[2],p=e[3],b=n[4],y=n[5],w=n[6],M=n[7],T=e[4],E=e[5],P=e[6],R=e[7],F=n[0],B=n[1],W=n[2],J=n[3];return t[0]=a*J+p*F+c*W-m*B,t[1]=c*J+p*B+m*F-a*W,t[2]=m*J+p*W+a*B-c*F,t[3]=p*J-a*F-c*B-m*W,t[4]=a*M+p*b+c*w-m*y+T*J+R*F+E*W-P*B,t[5]=c*M+p*y+m*b-a*w+E*J+R*B+P*F-T*W,t[6]=m*M+p*w+a*y-c*b+P*J+R*W+T*B-E*F,t[7]=p*M-a*b-c*y-m*w+R*J-T*F-E*B-P*W,t}At.getReal=Pi.copy,At.setReal=Pi.copy,At.mul=ll;var op=Pi.dot;At.dot=op;var Ug=Pi.length;At.length=Ug,At.len=Ug;var zd=Pi.squaredLength;At.squaredLength=zd,At.sqrLen=zd;var ci={};function ap(t){return ap=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ap(t)}Object.defineProperty(ci,"__esModule",{value:!0}),ci.create=lp,ci.clone=function(t){var e=new Ts.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},ci.fromValues=function(t,e){var n=new Ts.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},ci.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},ci.set=function(t,e,n){return t[0]=e,t[1]=n,t},ci.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},ci.subtract=cp,ci.multiply=dp,ci.divide=hp,ci.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},ci.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},ci.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},ci.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},ci.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},ci.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},ci.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t},ci.distance=up,ci.squaredDistance=mp,ci.length=pp,ci.squaredLength=fp,ci.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},ci.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},ci.normalize=function(t,e){var n=e[0],a=e[1],c=n*n+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t},ci.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},ci.cross=function(t,e,n){var a=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=a,t},ci.lerp=function(t,e,n,a){var c=e[0],m=e[1];return t[0]=c+a*(n[0]-c),t[1]=m+a*(n[1]-m),t},ci.random=function(t,e){e=e||1;var n=2*Ts.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},ci.transformMat2=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[2]*c,t[1]=n[1]*a+n[3]*c,t},ci.transformMat2d=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[2]*c+n[4],t[1]=n[1]*a+n[3]*c+n[5],t},ci.transformMat3=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[3]*c+n[6],t[1]=n[1]*a+n[4]*c+n[7],t},ci.transformMat4=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[4]*c+n[12],t[1]=n[1]*a+n[5]*c+n[13],t},ci.rotate=function(t,e,n,a){var c=e[0]-n[0],m=e[1]-n[1],p=Math.sin(a),b=Math.cos(a);return t[0]=c*b-m*p+n[0],t[1]=c*p+m*b+n[1],t},ci.angle=function(t,e){var n=t[0],a=t[1],c=e[0],m=e[1],p=Math.sqrt(n*n+a*a)*Math.sqrt(c*c+m*m);return Math.acos(Math.min(Math.max(p&&(n*c+a*m)/p,-1),1))},ci.zero=function(t){return t[0]=0,t[1]=0,t},ci.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},ci.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ci.equals=function(t,e){var n=t[0],a=t[1],c=e[0],m=e[1];return Math.abs(n-c)<=Ts.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-m)<=Ts.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))},ci.forEach=ci.sqrLen=ci.sqrDist=ci.dist=ci.div=ci.mul=ci.sub=ci.len=void 0;var Ts=function(t,e){if(t&&t.__esModule)return t;if(t===null||ap(t)!=="object"&&typeof t!="function")return{default:t};var n=sp(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}(ut);function sp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(sp=function(a){return a?n:e})(t)}function lp(){var t=new Ts.ARRAY_TYPE(2);return Ts.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function cp(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function dp(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function hp(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function up(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function mp(t,e){var n=e[0]-t[0],a=e[1]-t[1];return n*n+a*a}function pp(t){return Math.hypot(t[0],t[1])}function fp(t){var e=t[0],n=t[1];return e*e+n*n}ci.len=pp,ci.sub=cp,ci.mul=dp,ci.div=hp,ci.dist=up,ci.sqrDist=mp,ci.sqrLen=fp;var Hg=function(){var t=lp();return function(e,n,a,c,m,p){var b,y;for(n||(n=2),a||(a=0),y=c?Math.min(c*n+a,e.length):e.length,b=a;b<y;b+=n)t[0]=e[b],t[1]=e[b+1],m(t,t,p),e[b]=t[0],e[b+1]=t[1];return e}}();function uc(t){return uc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uc(t)}ci.forEach=Hg,Object.defineProperty(qe,"__esModule",{value:!0}),i.aA=qe.vec4=i._=qe.vec3=qe.vec2=qe.quat2=i.av=qe.quat=i.ad=qe.mat4=i.bC=qe.mat3=qe.mat2d=i.aC=qe.mat2=qe.glMatrix=void 0;var lu=wa(ut);qe.glMatrix=lu;var cu=wa(Ct);i.aC=qe.mat2=cu;var Wg=wa(wi);qe.mat2d=Wg;var Gg=wa(Ii);i.bC=qe.mat3=Gg;var qg=wa(Gt);i.ad=qe.mat4=qg;var mc=wa(Xt);i.av=qe.quat=mc;var Mi=wa(At);qe.quat2=Mi;var Iy=wa(ci);qe.vec2=Iy;var Ty=wa(Jt);i._=qe.vec3=Ty;var Ey=wa(ei);function gp(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(gp=function(a){return a?n:e})(t)}function wa(t,e){if(t&&t.__esModule)return t;if(t===null||uc(t)!=="object"&&typeof t!="function")return{default:t};var n=gp(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in t)if(m!=="default"&&Object.prototype.hasOwnProperty.call(t,m)){var p=c?Object.getOwnPropertyDescriptor(t,m):null;p&&(p.get||p.set)?Object.defineProperty(a,m,p):a[m]=t[m]}return a.default=t,n&&n.set(t,a),a}i.aA=qe.vec4=Ey;var _p=Bd;function Bd(t,e,n,a){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=a}Bd.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,a=0;a<8;a++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var p=0,b=1;for(n=t,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));a++)t>c?p=n:b=n,n=.5*(b-p)+p;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Nd=Xe(_p),du=cl;function cl(t,e){this.x=t,this.y=e}cl.prototype={clone:function(){return new cl(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(t,e){var n=Math.cos(t),a=Math.sin(t),c=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},cl.convert=function(t){return t instanceof cl?t:Array.isArray(t)?new cl(t[0],t[1]):t};var xt=Xe(du);let $g=Math.PI/180,Vd=180/Math.PI;function Ei(t){return t*$g}function Ur(t){return t*Vd}let Yg=[[0,0],[1,0],[1,1],[0,1]];function bp(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function jd(t,e,n,a){let c=new Nd(t,e,n,a);return function(m){return c.solve(m)}}let pc=jd(.25,.1,.25,1);function pi(t,e,n){return Math.min(n,Math.max(e,t))}function dl(t,e,n){return(n=pi((n-t)/(e-t),0,1))*n*(3-2*n)}function hl(t,e,n){let a=n-e,c=((t-e)%a+a)%a+e;return c===e?n:c}function fc(t,e,n){if(!t.length)return n(null,[]);let a=t.length,c=new Array(t.length),m=null;t.forEach((p,b)=>{e(p,(y,w)=>{y&&(m=y),c[b]=w,--a==0&&n(m,c)})})}function Vo(t){let e=[];for(let n in t)e.push(t[n]);return e}function Hr(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}let Dy=1;function hu(){return Dy++}function uu(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function yp(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function vp(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function mu(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Ud(t,e){return t.indexOf(e,t.length-e.length)!==-1}function gc(t,e,n){let a={};for(let c in t)a[c]=e.call(this,t[c],c,t);return a}function ul(t,e,n){let a={};for(let c in t)e.call(this,t[c],c,t)&&(a[c]=t[c]);return a}function Ca(t){return Array.isArray(t)?t.map(Ca):typeof t=="object"&&t?gc(t,Ca):t}let xp={};function Zn(t){xp[t]||(typeof console<"u"&&console.warn(t),xp[t]=!0)}function Sa(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Xr(t){let e=0;for(let n,a,c=0,m=t.length,p=m-1;c<m;p=c++)n=t[c],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function $a([t,e,n]){let a=Ei(e+90),c=Ei(n);return{x:t*Math.cos(a)*Math.sin(c),y:t*Math.sin(a)*Math.sin(c),z:t*Math.cos(c),azimuthal:e,polar:n}}function kr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function wp(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,c,m)=>{let p=c||m;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Cp,pu,_c,Hd,Ya,Wd,fu=null;function ml(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Gd(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Sp(t,e,n,a){for(;e<n;){let c=e+n>>1;t[c]<a?e=c+1:n=c}return e}function Zg(t,e,n,a){for(;e<n;){let c=e+n>>1;t[c]<=a?e=c+1:n=c}return e}function gu(t){return t>0?1/(1.001-t):1+t}function _u(t){return t>0?1-1/(1.001-t):-t}function bc(){return Cp==null&&(Cp=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Cp}let Ir={now:()=>Hd!==void 0?Hd:performance.now(),setNow(t){Hd=t},restoreNow(){Hd=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:a}=t;Ya||(Ya=document.createElement("canvas"));let c=Ya.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>Ya.width||a>Ya.height)&&(Ya.width=n,Ya.height=a),c.clearRect(-e,-e,n+2*e,a+2*e),c.drawImage(t,0,0,n,a),c.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:t=>(pu||(pu=document.createElement("a")),pu.href=t,pu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(_c==null&&(_c=window.matchMedia("(prefers-reduced-motion: reduce)")),_c.matches)},hasCanvasFingerprintNoise(){if(Wd!==void 0)return Wd;if(!bc())return Wd=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let c=0;c<t.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);let a=e.getImageData(0,0,t.width,t.height);n=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&n++!==a.data[c])return Wd=!0,!0;return Wd=!1,!1}};function bu(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(t.slice(n));for(let c in e)a.set(c,e[c]);return`${t.slice(0,n)}?${a.toString()}`}function Mp(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let a=new URLSearchParams,c=new URLSearchParams(t.slice(n));for(let p of e.persistentParams){let b=c.get(p);b&&a.set(p,b)}let m=a.toString();return`${t.slice(0,n)}${m.length>0?`?${m}`:""}`}let Xg="mapbox-tiles",kp=500,Ip=50,Za,yu;function Qg(){try{return caches}catch{}}function qd(){let t=Qg();t&&!Za&&(Za=t.open(Xg))}let vu=1/0,xu={supported:!1,testSupport:function(t){!Tp&&vc&&(Ep?Kg(t):yc=t)}},yc,vc,Tp=!1,Ep=!1,Dp=typeof self<"u"?self:{};function Kg(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,vc),t.isContextLost())return;xu.supported=!0}catch{}t.deleteTexture(e),Tp=!0}Dp.document&&(vc=Dp.document.createElement("img"),vc.onload=function(){yc&&Kg(yc),yc=null,Ep=!0},vc.onerror=function(){Tp=!0,yc=null},vc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let wu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(wu);class Ap extends Error{constructor(e,n,a){n===401&&O(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Cu=kr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,$d=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Cu())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){let m=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Cu(),referrerPolicy:a.referrerPolicy,signal:m.signal}),b=!1,y=!1,w=(M=p.url).indexOf("sku=")>0&&O(M);var M;a.type==="json"&&p.headers.set("Accept","application/json");let T=(P,R,F)=>{if(y)return;if(P&&P.message!=="SecurityError"&&Zn(P.toString()),R&&F)return E(R);let B=Date.now();fetch(p).then(W=>{if(W.ok){let J=w?W.clone():null;return E(W,J,B)}return c(new Ap(W.statusText,W.status,a.url))}).catch(W=>{W.name!=="AbortError"&&c(new Error(`${W.message} ${a.url}`))})},E=(P,R,F)=>{(a.type==="arrayBuffer"?P.arrayBuffer():a.type==="json"?P.json():P.text()).then(B=>{y||(R&&F&&function(W,J,ee){if(qd(),!Za)return;let te=wp(J.headers.get("Cache-Control")||"");if(te["no-store"])return;let pe={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach((Ce,De)=>pe.headers.set(De,Ce)),te["max-age"]&&pe.headers.set("Expires",new Date(ee+1e3*te["max-age"]).toUTCString());let he=pe.headers.get("Expires");if(!he||new Date(he).getTime()-ee<42e4)return;let ve=Mp(W.url,{persistentParams:["language","worldview"]});if(J.status===206){let Ce=W.headers.get("Range");if(!Ce)return;pe.status=200,ve=bu(ve,{range:Ce})}(function(Ce,De){if(yu===void 0)try{new Response(new ReadableStream),yu=!0}catch{yu=!1}yu?De(Ce.body):Ce.blob().then(De)})(J,Ce=>{let De=new Response((Ue=J.status)!==200&&Ue!==404&&[101,103,204,205,304].includes(Ue)?null:Ce,pe);var Ue;qd(),Za&&Za.then(ze=>ze.put(ve,De)).catch(ze=>Zn(ze.message))})}(p,R,F),b=!0,c(null,B,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(B=>{y||c(new Error(B.message))})};return w?function(P,R){if(qd(),!Za)return R(null);Za.then(F=>{let B=Mp(P.url,{persistentParams:["language","worldview"]}),W=P.headers.get("Range");W&&(B=bu(B,{range:W})),F.match(B).then(J=>{let ee=function(te){if(!te)return!1;let pe=new Date(te.headers.get("Expires")||0),he=wp(te.headers.get("Cache-Control")||"");return pe>Date.now()&&!he["no-cache"]}(J);F.delete(B),ee&&F.put(B,J.clone()),R(null,J,ee)}).catch(R)}).catch(R)}(p,T):T(null,null),{cancel:()=>{y=!0,b||m.abort()}}}(t,e);if(kr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(a,c){let m=new XMLHttpRequest;m.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let p in a.headers)m.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=a.credentials==="include",m.onerror=()=>{c(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let p=m.response;if(a.type==="json")try{p=JSON.parse(m.response)}catch(b){return c(b)}c(null,p,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else c(new Ap(m.statusText,m.status,a.url))},m.send(a.body),{cancel:()=>m.abort()}}(t,e)},pl=function(t,e){return $d(Hr(t,{type:"arrayBuffer"}),e)};function Jg(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let Pp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Yd,Zd;Yd=[],Zd=0;let Es=function(t,e){if(xu.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Zd>=I.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Yd.push(m),m}Zd++;let n=!1,a=()=>{if(!n)for(n=!0,Zd--;Yd.length&&Zd<I.MAX_PARALLEL_IMAGE_REQUESTS;){let m=Yd.shift(),{requestParameters:p,callback:b,cancelled:y}=m;y||(m.cancel=Es(p,b).cancel)}},c=pl(t,(m,p,b,y)=>{a(),m?e(m):p&&(self.createImageBitmap?function(w,M){let T=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(T).then(E=>{M(null,E)}).catch(E=>{M(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,M)=>e(w,M,b,y)):function(w,M){let T=new Image;T.onload=()=>{M(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=Pp})},T.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let E=new Blob([new Uint8Array(w)],{type:"image/png"});T.src=w.byteLength?URL.createObjectURL(E):Pp}(p,(w,M)=>e(w,M,b,y)))});return{cancel:()=>{c.cancel(),a()}}},Op="01",Rp="NO_ACCESS_TOKEN",Ay=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function aa(t){let e=t.match(Ay);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function xc(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Su="mapbox.eventData";function e_(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Xd{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=e_(I.ACCESS_TOKEN),a="";return a=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,m)=>String.fromCharCode(+("0x"+m)))):I.ACCESS_TOKEN||"",e?`${Su}.${e}:${a}`:`${Su}:${a}`}fetchEventData(){let e=ml("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let c=localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));let m=localStorage.getItem(a);m&&(this.anonId=m)}catch{Zn("Unable to read from LocalStorage")}}saveEventData(){let e=ml("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(a,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Zn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,c){if(!I.EVENTS_URL)return;let m=aa(I.EVENTS_URL);m.params.push(`access_token=${c||I.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},b=n?Hr(p,n):p,y={url:xc(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(w,M){return $d(Hr(w,{method:"POST"}),M)}(y,w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let t_=new class extends Xd{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){I.EVENTS_URL&&I.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>N(n)||O(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=e_(I.ACCESS_TOKEN),n=e?e.u:I.ACCESS_TOKEN,a=n!==this.eventData.tokenU;vp(this.anonId)||(this.anonId=uu(),a=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let m=new Date(this.eventData.lastSuccess),p=new Date(c),b=(c-this.eventData.lastSuccess)/864e5;a=a||b>=1||b<-1||m.getDate()!==p.getDate()}else a=!0;a?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:Op,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},Lp=t_.postTurnstileEvent.bind(t_),Qd=new class extends Xd{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,a){this.skuToken=e,this.errorCb=a,I.EVENTS_URL&&(n||I.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Rp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),vp(this.anonId)||(this.anonId=uu()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:Op,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},i_=Qd.postMapLoadEvent.bind(Qd),n_=new class extends Xd{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=uu(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:a,importedStyles:c}=e;if(!I.EVENTS_URL||!t&&!I.ACCESS_TOKEN)return;let m=this.getMapInstanceId(n),p={mapInstanceId:m,eventId:this.getEventId(m),style:a};c.length&&(p.importedStyles=c),this.queueRequest({timestamp:Date.now(),payload:p},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},Py=n_.postStyleLoadEvent.bind(n_),Mu=new class extends Xd{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){I.EVENTS_URL&&(t||I.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),a=function(c){let m=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),b=function(P){let R={};if(P){for(let F in P)if(F!=="other")for(let B of P[F]){let W=`${F}ResolveRangeMin`,J=`${F}ResolveRangeMax`,ee=`${F}RequestCount`,te=`${F}RequestCachedCount`;R[W]=Math.min(R[W]||1/0,B.startTime),R[J]=Math.max(R[J]||-1/0,B.responseEnd);let pe=he=>{R[he]===void 0&&(R[he]=0),++R[he]};B.transferSize!==void 0&&B.transferSize===0&&pe(te),pe(ee)}}return R}(function(P,R){let F={};if(P)for(let B of P){let W=R(B);F[W]===void 0&&(F[W]=[]),F[W].push(B)}return F}(m,Ae)),y=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=w?w.effectiveType:void 0,T={counters:[],metadata:[],attributes:[]},E=(P,R,F)=>{F!=null&&P.push({name:R,value:F.toString()})};for(let P in b)E(T.counters,P,b[P]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(E(T.counters,"interactionRangeMin",c.interactionRange[0]),E(T.counters,"interactionRangeMax",c.interactionRange[1])),p)for(let P of Object.keys(xe)){let R=xe[P],F=p.find(B=>B.name===R);F&&E(T.counters,R,F.startTime)}return E(T.counters,"visibilityHidden",c.visibilityHidden),E(T.attributes,"style",function(P){if(P)for(let R of P){let F=R.name.split("?")[0];if(de(F)){let B=F.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(m)),E(T.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),E(T.attributes,"fogEnabled",c.fogEnabled?"true":"false"),E(T.attributes,"projection",c.projection),E(T.attributes,"zoom",c.zoom),E(T.metadata,"devicePixelRatio",y),E(T.metadata,"connectionEffectiveType",M),E(T.metadata,"navigatorUserAgent",navigator.userAgent),E(T.metadata,"screenWidth",window.screen.width),E(T.metadata,"screenHeight",window.screen.height),E(T.metadata,"windowWidth",window.innerWidth),E(T.metadata,"windowHeight",window.innerHeight),E(T.metadata,"mapWidth",c.width/y),E(T.metadata,"mapHeight",c.height/y),E(T.metadata,"webglRenderer",c.renderer),E(T.metadata,"webglVendor",c.vendor),E(T.metadata,"sdkVersion",_),E(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(n);for(let c of a.metadata);for(let c of a.counters);for(let c of a.attributes);this.postEvent(e,a,()=>{},t)}},Oy=Mu.postPerformanceEvent.bind(Mu),wc=new class extends Xd{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,a){if(!I.API_URL||!I.SESSION_PATH)return;let c=aa(I.API_URL+I.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${a||I.ACCESS_TOKEN||""}`);let m={url:xc(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,b){return $d(Hr(p,{method:"GET"}),b)}(m,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,n,a){this.skuToken=e,this.errorCb=a,I.SESSION_PATH&&I.API_URL&&(n||I.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Rp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},ku=wc.getSessionAPI.bind(wc),Kd=new Set;var fl={exports:{}},r_={exports:function(t,e){var n,a,c,m,p,b,y,w;for(a=t.length-(n=3&t.length),c=e,p=3432918353,b=461845907,w=0;w<a;)y=255&t.charCodeAt(w)|(255&t.charCodeAt(++w))<<8|(255&t.charCodeAt(++w))<<16|(255&t.charCodeAt(++w))<<24,++w,c=27492+(65535&(m=5*(65535&(c=(c^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*b+(((y>>>16)*b&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&t.charCodeAt(w+2))<<16;case 2:y^=(255&t.charCodeAt(w+1))<<8;case 1:c^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(w)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*b+(((y>>>16)*b&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}},Ry={exports:function(t,e){for(var n,a=t.length,c=e^a,m=0;a>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(m)|(255&t.charCodeAt(++m))<<8|(255&t.charCodeAt(++m))<<16|(255&t.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:c^=(255&t.charCodeAt(m+2))<<16;case 2:c^=(255&t.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}},o_=r_.exports,Fp=Ry.exports;fl.exports=o_,fl.exports.murmur3=o_,fl.exports.murmur2=Fp;var Cc=Xe(fl.exports);function zp(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Sc(t,e,n){if(n&&n[t]){let a=n[t].indexOf(e);a!==-1&&n[t].splice(a,1)}}class oo{constructor(e,n={}){Hr(this,n),this.type=e}}class Iu extends oo{constructor(e,n={}){super("error",Hr({error:e},n))}}class gl{on(e,n){return this._listeners=this._listeners||{},zp(e,n,this._listeners),this}off(e,n){return Sc(e,n,this._listeners),Sc(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},zp(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new oo(e,n||{}));let a=e.type;if(this.listens(a)){e.target=this;let c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let b of c)b.call(this,e);let m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let b of m)Sc(a,b,this._oneTimeListeners),b.call(this,e);let p=this._eventedParent;p&&(Hr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Iu&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}i.F=void 0;var a_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Tu(t){return(t=Math.round(t))<0?0:t>255?255:t}function Bp(t){return Tu(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Jd(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function eh(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{i.F={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in a_)return a_[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),c=n.indexOf(")");if(a!==-1&&c+1===n.length){var m=n.substr(0,a),p=n.substr(a+1,c-(a+1)).split(","),b=1;switch(m){case"rgba":if(p.length!==4)return null;b=Jd(p.pop());case"rgb":return p.length!==3?null:[Bp(p[0]),Bp(p[1]),Bp(p[2]),b];case"hsla":if(p.length!==4)return null;b=Jd(p.pop());case"hsl":if(p.length!==3)return null;var y=(parseFloat(p[0])%360+360)%360/360,w=Jd(p[1]),M=Jd(p[2]),T=M<=.5?M*(w+1):M+w-M*w,E=2*M-T;return[Tu(255*eh(E,T,y+1/3)),Tu(255*eh(E,T,y)),Tu(255*eh(E,T,y-1/3)),b];default:return null}}return null}}catch{}class Bi{constructor(e,n,a,c=1){this.r=e,this.g=n,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof Bi)return e;if(typeof e!="string")return;let n=i.F(e);return n?new Bi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,a,c]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${c})`}toRenderColor(e){let{r:n,g:a,b:c,a:m}=this;return new Ly(e,n,a,c,m)}}class Ly{constructor(e,n,a,c,m){if(e){let p=e.image.height,b=p*p;n=m===0?0:n/m*(p-1),a=m===0?0:a/m*(p-1),c=m===0?0:c/m*(p-1);let y=Math.floor(n),w=Math.floor(a),M=Math.floor(c),T=Math.ceil(n),E=Math.ceil(a),P=Math.ceil(c),R=n-y,F=a-w,B=c-M,W=e.image.data,J=4*(y+w*b+M*p),ee=4*(y+w*b+P*p),te=4*(y+E*b+M*p),pe=4*(y+E*b+P*p),he=4*(T+w*b+M*p),ve=4*(T+w*b+P*p),Ce=4*(T+E*b+M*p),De=4*(T+E*b+P*p);if(J<0||De>=W.length)throw new Error("out of range");this.r=Wt(Wt(Wt(W[J],W[ee],B),Wt(W[te],W[pe],B),F),Wt(Wt(W[he],W[ve],B),Wt(W[Ce],W[De],B),F),R)/255*m,this.g=Wt(Wt(Wt(W[J+1],W[ee+1],B),Wt(W[te+1],W[pe+1],B),F),Wt(Wt(W[he+1],W[ve+1],B),Wt(W[Ce+1],W[De+1],B),F),R)/255*m,this.b=Wt(Wt(Wt(W[J+2],W[ee+2],B),Wt(W[te+2],W[pe+2],B),F),Wt(Wt(W[he+2],W[ve+2],B),Wt(W[Ce+2],W[De+2],B),F),R)/255*m,this.a=m}else this.r=n,this.g=a,this.b=c,this.a=m}toArray(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*a/c,c]}toArray01(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,a/c,c]}toArray01Scaled(e){let{r:n,g:a,b:c,a:m}=this;return m===0?[0,0,0]:[n/m*e,a/m*e,c/m*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:a,a:c}=this;return[e,n,a,c]}toArray01Linear(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(n/c,2.2),Math.pow(a/c,2.2),c]}}function Wt(t,e,n){return t*(1-n)+e*n}function s_(t,e,n){return t.map((a,c)=>Wt(a,e[c],n))}Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1),Bi.blue=new Bi(0,0,1,1);var Eu=Object.freeze({__proto__:null,array:s_,color:function(t,e,n){return new Bi(Wt(t.r,e.r,n),Wt(t.g,e.g,n),Wt(t.b,e.b,n),Wt(t.a,e.a,n))},number:Wt});function Np(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}class Ma extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Vp{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[a,c]of n)this.bindings[a]=c}concat(e){return new Vp(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Mc={kind:"null"},Tt={kind:"number"},Ni={kind:"string"},Vi={kind:"boolean"},ao={kind:"color"},kc={kind:"object"},Ri={kind:"value"},sa={kind:"collator"},Ic={kind:"formatted"},ka={kind:"resolvedImage"};function go(t,e){return{kind:"array",itemType:t,N:e}}function Xn(t){if(t.kind==="array"){let e=Xn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let Fy=[Mc,Tt,Ni,Vi,ao,Ic,kc,go(Ri),ka];function th(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!th(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of Fy)if(!th(n,e))return null}}return`Expected ${Xn(t)} but found ${Xn(e)} instead.`}function jp(t,e){return e.some(n=>n.kind===t.kind)}function Tc(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class ih{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _l{constructor(e,n,a,c,m){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=c,this.textColor=m}}class Wr{constructor(e){this.sections=e}static fromString(e){return new Wr([new _l(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Wr?e:Wr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class so{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new so({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function l_(t,e,n,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,n,a]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function lo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Bi||t instanceof ih||t instanceof Wr||t instanceof so)return!0;if(Array.isArray(t)){for(let e of t)if(!lo(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!lo(t[e]))return!1;return!0}return!1}function sr(t){if(t===null)return Mc;if(typeof t=="string")return Ni;if(typeof t=="boolean")return Vi;if(typeof t=="number")return Tt;if(t instanceof Bi)return ao;if(t instanceof ih)return sa;if(t instanceof Wr)return Ic;if(t instanceof so)return ka;if(Array.isArray(t)){let e=t.length,n;for(let a of t){let c=sr(a);if(n){if(n===c)continue;n=Ri;break}n=c}return go(n||Ri,e)}return kc}function jo(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Bi||t instanceof Wr||t instanceof so?t.toString():JSON.stringify(t)}class Xa{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!lo(e[1]))return n.error("invalid value");let a=e[1],c=sr(a),m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new Xa(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Wr?this.value.serialize():this.value}}class gr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Up={string:Ni,number:Tt,boolean:Vi,object:kc};class la{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,c=1,m=e[0];if(m==="array"){let b,y;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in Up)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=Up[w],c++}else b=Ri;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],c++}a=go(b,y)}else a=Up[m];let p=[];for(;c<e.length;c++){let b=n.parse(e[c],c,Ri);if(!b)return null;p.push(b)}return new la(a,p)}evaluate(e){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(e);if(!th(this.type,sr(a)))return a;if(n===this.args.length-1)throw new gr(`Expected value to be of type ${Xn(this.type)}, but found ${Xn(sr(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);let c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(a=>a.serialize()))}}class nh{constructor(e){this.type=Ic,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let c=[],m=!1;for(let p=1;p<=e.length-1;++p){let b=e[p];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let y=null;if(b["font-scale"]&&(y=n.parse(b["font-scale"],1,Tt),!y))return null;let w=null;if(b["text-font"]&&(w=n.parse(b["text-font"],1,go(Ni)),!w))return null;let M=null;if(b["text-color"]&&(M=n.parse(b["text-color"],1,ao),!M))return null;let T=c[c.length-1];T.scale=y,T.font=w,T.textColor=M}else{let y=n.parse(e[p],1,Ri);if(!y)return null;let w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:y,scale:null,font:null,textColor:null})}}return new nh(c)}evaluate(e){return new Wr(this.sections.map(n=>{let a=n.content.evaluate(e);return sr(a)===ka?new _l("",a,null,null,null):new _l(jo(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class rh{constructor(e,n){this.type=ka,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=n.parse(e[1],1,Ni);if(!a)return n.error("No image name provided.");if(e.length===2)return new rh(a);let c=n.parse(e[2],1,Ni);return c?new rh(a,c):n.error("Secondary image variant is not a string.")}evaluate(e){let n=so.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function bl(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let zy={"to-boolean":Vi,"to-color":ao,"to-number":Tt,"to-string":Ni};class ca{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[0],c=[],m=Mc;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);m=go(n.expectedType.itemType,p)}else{if(!(p>0&&lo(e[1][0])))return null;m=go(sr(e[1][0]),p)}for(let b=0;b<p;b++){let y=e[1][b],w;if(bl(y)==="array")w=n.parse(y,void 0,m.itemType);else{let M=bl(y);if(M!==m.itemType.kind)return n.error(`Expected ${m.itemType.kind} but found ${M}.`);w=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!w)return null;c.push(w)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");m=zy[a];for(let p=1;p<e.length;p++){let b=n.parse(e[p],p,Ri);if(!b)return null;c.push(b)}}return new ca(m,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(let c of this.args){if(n=c.evaluate(e),a=null,n instanceof Bi)return n;if(typeof n=="string"){let m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:l_(n[0],n[1],n[2],n[3]),!a))return new Bi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new gr(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let a of this.args){if(n=a.evaluate(e),n===null)return 0;let c=Number(n);if(!isNaN(c))return c}throw new gr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Wr.fromString(jo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?so.fromString(jo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):jo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new nh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rh(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let c_=["Unknown","Point","LineString","Polygon"];class d_{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?c_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Bi.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Qr{constructor(e,n,a,c,m){this.name=e,this.type=n,this._evaluate=a,this.args=c,this._overloadIndex=m}evaluate(e){if(!this._evaluate){let n=Qr.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let a=e[0],c=Qr.definitions[a];if(!c)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,b=[],y=null,w=-1;for(let[M,T]of p){if(Array.isArray(M)&&M.length!==e.length-1)continue;b.push(M),w++,y=new x_(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let E=[],P=!1;for(let R=1;R<e.length;R++){let F=e[R],B=Array.isArray(M)?M[R-1]:M.type,W=y.parse(F,1+E.length,B);if(!W){P=!0;break}E.push(W)}if(!P)if(Array.isArray(M)&&M.length!==E.length)y.error(`Expected ${M.length} arguments, but found ${E.length} instead.`);else{for(let R=0;R<E.length;R++){let F=Array.isArray(M)?M[R]:M.type,B=E[R];y.concat(R+1).checkSubtype(F,B.type)}if(y.errors.length===0)return new Qr(a,m,T,E,w)}}if(b.length===1)n.errors.push(...y.errors);else{let M=(b.length?b:p.map(([E])=>E)).map(Hp).join(" | "),T=[];for(let E=1;E<e.length;E++){let P=n.parse(e[E],1+T.length);if(!P)return null;T.push(Xn(P.type))}n.error(`Expected arguments of type ${M}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){Qr.definitions=n;for(let a in n)e[a]=Qr}}function Hp(t){return Array.isArray(t)?`(${t.map(Xn).join(", ")})`:`(${Xn(t.type)}...)`}class Ds{constructor(e,n,a){this.type=sa,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let c=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Vi);if(!c)return null;let m=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Vi);if(!m)return null;let p=null;return a.locale&&(p=n.parse(a.locale,1,Ni),!p)?null:new Ds(c,m,p)}evaluate(e){return new ih(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Wp={exports:{}};Wp.exports=function(){function t(a,c,m,p,b){for(;p>m;){if(p-m>600){var y=p-m+1,w=c-m+1,M=Math.log(y),T=.5*Math.exp(2*M/3),E=.5*Math.sqrt(M*T*(y-T)/y)*(w-y/2<0?-1:1);t(a,c,Math.max(m,Math.floor(c-w*T/y+E)),Math.min(p,Math.floor(c+(y-w)*T/y+E)),b)}var P=a[c],R=m,F=p;for(e(a,m,c),b(a[p],P)>0&&e(a,m,p);R<F;){for(e(a,R,F),R++,F--;b(a[R],P)<0;)R++;for(;b(a[F],P)>0;)F--}b(a[m],P)===0?e(a,m,F):e(a,++F,p),F<=c&&(m=F+1),c<=F&&(p=F-1)}}function e(a,c,m){var p=a[c];a[c]=a[m],a[m]=p}function n(a,c){return a<c?-1:a>c?1:0}return function(a,c,m,p,b){t(a,c,m||0,p||a.length-1,b||n)}}();var By=Xe(Wp.exports);function Ny(t){let e=0;for(let n,a,c=0,m=t.length,p=m-1;c<m;p=c++)n=t[c],a=t[p],e+=(a.x-n.x)*(n.y+a.y);return e}function oh(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ec(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Vy(t,e,n){let a=t[0]-e[0],c=t[1]-e[1],m=t[0]-n[0],p=t[1]-n[1];return a*p-m*c==0&&a*m<=0&&c*p<=0}function Dc(t,e,n=!1){let a=!1;for(let b=0,y=e.length;b<y;b++){let w=e[b];for(let M=0,T=w.length,E=T-1;M<T;E=M++){let P=w[E],R=w[M];if(Vy(t,P,R))return n;(m=P)[1]>(c=t)[1]!=(p=R)[1]>c[1]&&c[0]<(p[0]-m[0])*(c[1]-m[1])/(p[1]-m[1])+m[0]&&(a=!a)}}var c,m,p;return a}function Gp(t,e,n,a){let c=a[0]-n[0],m=a[1]-n[1],p=(t[0]-n[0])*m-c*(t[1]-n[1]),b=(e[0]-n[0])*m-c*(e[1]-n[1]);return p>0&&b<0||p<0&&b>0}function Oi(t,e,n,a){return(c=[a[0]-n[0],a[1]-n[1]])[0]*(m=[e[0]-t[0],e[1]-t[1]])[1]-c[1]*m[0]!=0&&!(!Gp(t,e,n,a)||!Gp(n,a,t,e));var c,m}let Qa=8192;function h_(t,e){let n=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*Qa),Math.round(a*c*Qa)]}function jy(t,e){for(let n=0;n<e.length;n++)if(Dc(t,e[n]))return!0;return!1}function Uy(t,e,n){for(let a of n)for(let c=0,m=a.length,p=m-1;c<m;p=c++)if(Oi(t,e,a[p],a[c]))return!0;return!1}function ah(t,e){for(let n=0;n<t.length;++n)if(!Dc(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Uy(t[n],t[n+1],e))return!1;return!0}function Du(t,e){for(let n=0;n<e.length;n++)if(ah(t,e[n]))return!0;return!1}function Ac(t,e,n){let a=[];for(let c=0;c<t.length;c++){let m=[];for(let p=0;p<t[c].length;p++){let b=h_(t[c][p],n);oh(e,b),m.push(b)}a.push(m)}return a}function u_(t,e,n){let a=[];for(let c=0;c<t.length;c++){let m=Ac(t[c],e,n);a.push(m)}return a}function qp(t,e,n,a){if(t[0]<n[0]||t[0]>n[2]){let c=.5*a,m=t[0]-n[0]>c?-a:n[0]-t[0]>c?a:0;m===0&&(m=t[0]-n[2]>c?-a:n[2]-t[0]>c?a:0),t[0]+=m}oh(e,t)}function da(t,e,n,a){let c=Math.pow(2,a.z)*Qa,m=[a.x*Qa,a.y*Qa],p=[];if(!t)return p;for(let b of t)for(let y of b){let w=[y.x+m[0],y.y+m[1]];qp(w,e,n,c),p.push(w)}return p}function m_(t,e,n,a){let c=Math.pow(2,a.z)*Qa,m=[a.x*Qa,a.y*Qa],p=[];if(!t)return p;for(let y of t){let w=[];for(let M of y){let T=[M.x+m[0],M.y+m[1]];oh(e,T),w.push(T)}p.push(w)}if(e[2]-e[0]<=c/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let y of p)for(let w of y)qp(w,e,n,c)}var b;return p}class As{constructor(e,n){this.type=Vi,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(lo(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){let m=a.features[c].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new As(a,a.features[c].geometry)}else if(a.type==="Feature"){let c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new As(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new As(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let b=Ac(a.coordinates,m,p),y=da(n.geometry(),c,m,p);if(!Ec(c,m))return!1;for(let w of y)if(!Dc(w,b))return!1}if(a.type==="MultiPolygon"){let b=u_(a.coordinates,m,p),y=da(n.geometry(),c,m,p);if(!Ec(c,m))return!1;for(let w of y)if(!jy(w,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let b=Ac(a.coordinates,m,p),y=m_(n.geometry(),c,m,p);if(!Ec(c,m))return!1;for(let w of y)if(!ah(w,b))return!1}if(a.type==="MultiPolygon"){let b=u_(a.coordinates,m,p),y=m_(n.geometry(),c,m,p);if(!Ec(c,m))return!1;for(let w of y)if(!Du(w,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Ps={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Au=1/298.257223563,p_=Au*(2-Au),sh=Math.PI/180;class lh{static fromTile(e,n,a){let c=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),m=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/sh;return new lh(m,a)}static get units(){return Ps}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Ps[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Ps).join(", ")}`);let a=6378.137*sh*(n?Ps[n]:1),c=Math.cos(e*sh),m=1/(1-p_*(1-c*c)),p=Math.sqrt(m);this.kx=a*p*c,this.ky=a*p*m*(1-p_)}distance(e,n){let a=Uo(e[0]-n[0])*this.kx,c=(e[1]-n[1])*this.ky;return Math.sqrt(a*a+c*c)}bearing(e,n){let a=Uo(n[0]-e[0])*this.kx;return Math.atan2(a,(n[1]-e[1])*this.ky)/sh}destination(e,n,a){let c=a*sh;return this.offset(e,Math.sin(c)*n,Math.cos(c)*n)}offset(e,n,a){return[e[0]+n/this.kx,e[1]+a/this.ky]}lineDistance(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}area(e){let n=0;for(let a=0;a<e.length;a++){let c=e[a];for(let m=0,p=c.length,b=p-1;m<p;b=m++)n+=Uo(c[m][0]-c[b][0])*(c[m][1]+c[b][1])*(a?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let a=0;if(n<=0)return e[0];for(let c=0;c<e.length-1;c++){let m=e[c],p=e[c+1],b=this.distance(m,p);if(a+=b,a>n)return ch(m,p,(n-(a-b))/b)}return e[e.length-1]}pointToSegmentDistance(e,n,a){let[c,m]=n,p=Uo(a[0]-c)*this.kx,b=(a[1]-m)*this.ky;if(p!==0||b!==0){let y=(Uo(e[0]-c)*this.kx*p+(e[1]-m)*this.ky*b)/(p*p+b*b);y>1?(c=a[0],m=a[1]):y>0&&(c+=p/this.kx*y,m+=b/this.ky*y)}return p=Uo(e[0]-c)*this.kx,b=(e[1]-m)*this.ky,Math.sqrt(p*p+b*b)}pointOnLine(e,n){let a=1/0,c=e[0][0],m=e[0][1],p=0,b=0;for(let y=0;y<e.length-1;y++){let w=e[y][0],M=e[y][1],T=Uo(e[y+1][0]-w)*this.kx,E=(e[y+1][1]-M)*this.ky,P=0;T===0&&E===0||(P=(Uo(n[0]-w)*this.kx*T+(n[1]-M)*this.ky*E)/(T*T+E*E),P>1?(w=e[y+1][0],M=e[y+1][1]):P>0&&(w+=T/this.kx*P,M+=E/this.ky*P)),T=Uo(n[0]-w)*this.kx,E=(n[1]-M)*this.ky;let R=T*T+E*E;R<a&&(a=R,c=w,m=M,p=y,b=P)}return{point:[c,m],index:p,t:Math.max(0,Math.min(1,b))}}lineSlice(e,n,a){let c=this.pointOnLine(a,e),m=this.pointOnLine(a,n);if(c.index>m.index||c.index===m.index&&c.t>m.t){let w=c;c=m,m=w}let p=[c.point],b=c.index+1,y=m.index;!$p(a[b],p[0])&&b<=y&&p.push(a[b]);for(let w=b+1;w<=y;w++)p.push(a[w]);return $p(a[y],m.point)||p.push(m.point),p}lineSliceAlong(e,n,a){let c=0,m=[];for(let p=0;p<a.length-1;p++){let b=a[p],y=a[p+1],w=this.distance(b,y);if(c+=w,c>e&&m.length===0&&m.push(ch(b,y,(e-(c-w))/w)),c>=n)return m.push(ch(b,y,(n-(c-w))/w)),m;c>e&&m.push(y)}return m}bufferPoint(e,n){let a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[0]+c,e[1]+a]}bufferBBox(e,n){let a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[2]+c,e[3]+a]}insideBBox(e,n){return Uo(e[0]-n[0])>=0&&Uo(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function $p(t,e){return t[0]===e[0]&&t[1]===e[1]}function ch(t,e,n){let a=Uo(e[0]-t[0]);return[t[0]+a*n,t[1]+(e[1]-t[1])*n]}function Uo(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}var dh={exports:{}};(function(t,e){t.exports=function(){var n=function(c,m){if(c===void 0&&(c=[]),m===void 0&&(m=a),this.data=c,this.length=this.data.length,this.compare=m,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function a(c,m){return c<m?-1:c>m?1:0}return n.prototype.push=function(c){this.data.push(c),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var c=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),c}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(c){for(var m=this.data,p=this.compare,b=m[c];c>0;){var y=c-1>>1,w=m[y];if(p(b,w)>=0)break;m[c]=w,c=y}m[c]=b},n.prototype._down=function(c){for(var m=this.data,p=this.compare,b=this.length>>1,y=m[c];c<b;){var w=1+(c<<1),M=m[w],T=w+1;if(T<this.length&&p(m[T],M)<0&&(w=T,M=m[T]),p(M,y)>=0)break;m[c]=M,c=w}m[c]=y},n}()})(dh);var Yp=Xe(dh.exports),pt=8192;function f_(t,e){return e.dist-t.dist}let Zp=100,Xp=50;function g_(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Pu(t){return t[1]-t[0]+1}function Ia(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Os(t,e){if(t[0]>t[1])return[null,null];let n=Pu(t);if(e){if(n===2)return[t,null];let a=Math.floor(n/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(n===1)return[t,null];let a=Math.floor(n/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function yl(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!Ia(e,t.length))return n;for(let a=e[0];a<=e[1];++a)oh(n,t[a]);return n}function Ou(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let a=0;a<t[n].length;++a)oh(e,t[n][a]);return e}function Rs(t,e,n){if(g_(t)||g_(e))return NaN;let a=0,c=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(c=t[1]-e[3]),t[3]<e[1]&&(c=e[1]-t[3]),n.distance([0,0],[a,c])}function Hy(t){return 360*t-180}function Wy(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Qp(t,e){let n=Math.pow(2,e.z),a=(t.y/pt+e.y)/n;return[Hy((t.x/pt+e.x)/n),Wy(a)]}function Gy(t,e){let n=[];for(let a=0;a<t.length;++a)n.push(Qp(t[a],e));return n}function __(t,e,n){let a=n.pointOnLine(e,t).point;return n.distance(t,a)}function Ls(t,e,n,a,c){let m=n.slice(a[0],a[1]+1),p=1/0;for(let b=e[0];b<=e[1];++b)if((p=Math.min(p,__(t[b],m,c)))===0)return 0;return p}function Kp(t,e,n,a,c){let m=Math.min(c.pointToSegmentDistance(t,n,a),c.pointToSegmentDistance(e,n,a)),p=Math.min(c.pointToSegmentDistance(n,t,e),c.pointToSegmentDistance(a,t,e));return Math.min(m,p)}function qy(t,e,n,a,c){if(!Ia(e,t.length)||!Ia(a,n.length))return NaN;let m=1/0;for(let p=e[0];p<e[1];++p)for(let b=a[0];b<a[1];++b){if(Oi(t[p],t[p+1],n[b],n[b+1]))return 0;m=Math.min(m,Kp(t[p],t[p+1],n[b],n[b+1],c))}return m}function b_(t,e,n,a,c){if(!Ia(e,t.length)||!Ia(a,n.length))return NaN;let m=1/0;for(let p=e[0];p<=e[1];++p)for(let b=a[0];b<=a[1];++b)if((m=Math.min(m,c.distance(t[p],n[b])))===0)return m;return m}function y_(t,e,n){if(Dc(t,e,!0))return 0;let a=1/0;for(let c of e){let m=c.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[m-1]&&(a=Math.min(a,n.pointToSegmentDistance(t,c[m-1],c[0])))===0||(a=Math.min(a,__(t,c,n)))===0)return a}return a}function ha(t,e,n,a){if(!Ia(e,t.length))return NaN;for(let m=e[0];m<=e[1];++m)if(Dc(t[m],n,!0))return 0;let c=1/0;for(let m=e[0];m<e[1];++m)for(let p of n)for(let b=0,y=p.length,w=y-1;b<y;w=b++){if(Oi(t[m],t[m+1],p[w],p[b]))return 0;c=Math.min(c,Kp(t[m],t[m+1],p[w],p[b],a))}return c}function Jp(t,e){for(let n of t)for(let a=0;a<=n.length-1;++a)if(Dc(n[a],e,!0))return!0;return!1}function $y(t,e,n,a=1/0){let c=Ou(t),m=Ou(e);if(a!==1/0&&Rs(c,m,n)>=a)return a;if(Ec(c,m)){if(Jp(t,e))return 0}else if(Jp(e,t))return 0;let p=a;for(let b of t)for(let y=0,w=b.length,M=w-1;y<w;M=y++)for(let T of e)for(let E=0,P=T.length,R=P-1;E<P;R=E++){if(Oi(b[M],b[y],T[R],T[E]))return 0;p=Math.min(p,Kp(b[M],b[y],T[R],T[E],n))}return p}function hh(t,e,n,a,c,m,p){if(m===null||p===null)return;let b=Rs(yl(a,m),yl(c,p),n);b<e&&t.push({dist:b,range1:m,range2:p})}function Ru(t,e,n,a,c=1/0){let m=Math.min(a.distance(t[0],n[0][0]),c);if(m===0)return m;let p=new Yp([{dist:0,range1:[0,t.length-1],range2:[0,0]}],f_),b=e?Xp:Zp,y=Ou(n);for(;p.length;){let w=p.pop();if(w.dist>=m)continue;let M=w.range1;if(Pu(M)<=b){if(!Ia(M,t.length))return NaN;if(e){let T=ha(t,M,n,a);if((m=Math.min(m,T))===0)return m}else for(let T=M[0];T<=M[1];++T){let E=y_(t[T],n,a);if((m=Math.min(m,E))===0)return m}}else{let T=Os(M,e);if(T[0]!==null){let E=Rs(yl(t,T[0]),y,a);E<m&&p.push({dist:E,range1:T[0],range2:[0,0]})}if(T[1]!==null){let E=Rs(yl(t,T[1]),y,a);E<m&&p.push({dist:E,range1:T[1],range2:[0,0]})}}}return m}function v_(t,e,n,a,c,m=1/0){let p=Math.min(m,c.distance(t[0],n[0]));if(p===0)return p;let b=new Yp([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],f_),y=e?Xp:Zp,w=a?Xp:Zp;for(;b.length;){let M=b.pop();if(M.dist>=p)continue;let T=M.range1,E=M.range2;if(Pu(T)<=y&&Pu(E)<=w){if(!Ia(T,t.length)||!Ia(E,n.length))return NaN;if(e&&a?p=Math.min(p,qy(t,T,n,E,c)):e||a?e&&!a?p=Math.min(p,Ls(n,E,t,T,c)):!e&&a&&(p=Math.min(p,Ls(t,T,n,E,c))):p=Math.min(p,b_(t,T,n,E,c)),p===0)return p}else{let P=Os(T,e),R=Os(E,a);hh(b,p,c,t,n,P[0],R[0]),hh(b,p,c,t,n,P[0],R[1]),hh(b,p,c,t,n,P[1],R[0]),hh(b,p,c,t,n,P[1],R[1])}}return p}function ef(t,e,n,a,c=1/0){let m=c,p=yl(t,[0,t.length-1]);for(let b of n)if(!(m!==1/0&&Rs(p,yl(b,[0,b.length-1]),a)>=m)&&(m=Math.min(m,v_(t,e,b,!0,a,m)),m===0))return m;return m}function Lu(t,e,n,a,c=1/0){let m=c,p=yl(t,[0,t.length-1]);for(let b of n){if(m!==1/0&&Rs(p,Ou(b),a)>=m)continue;let y=Ru(t,e,b,a,m);if(isNaN(y))return y;if((m=Math.min(m,y))===0)return m}return m}function tf(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class vl{constructor(e,n){this.type=Tt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(lo(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(tf(a.features[c].geometry.type))return new vl(a,a.features[c].geometry)}else if(a.type==="Feature"){if(tf(a.geometry.type))return new vl(a,a.geometry)}else if(tf(a.type))return new vl(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(c,m,p){let b=[];for(let w of c)for(let M of w)b.push(Qp(M,m));let y=new lh(b[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?v_(b,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y):p.type==="MultiLineString"?ef(b,!1,p.coordinates,y):p.type==="Polygon"||p.type==="MultiPolygon"?Lu(b,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,y):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(c,m,p){let b=[];for(let w of c){let M=[];for(let T of w)M.push(Qp(T,m));b.push(M)}let y=new lh(b[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return ef(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,y);if(p.type==="MultiLineString"){let w=1/0;for(let M=0;M<p.coordinates.length;M++){let T=ef(p.coordinates[M],!0,b,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}if(p.type==="Polygon"||p.type==="MultiPolygon"){let w=1/0;for(let M=0;M<b.length;M++){let T=Lu(b[M],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,m,p){let b=[];for(let w of function(M,T){let E=M.length;if(E<=1)return[M];let P=[],R,F;for(let B=0;B<E;B++){let W=Ny(M[B]);W!==0&&(M[B].area=Math.abs(W),F===void 0&&(F=W<0),F===W<0?(R&&P.push(R),R=[M[B]]):R.push(M[B]))}return R&&P.push(R),P}(c)){let M=[];for(let T=0;T<w.length;++T)M.push(Gy(w[T],m));b.push(M)}let y=new lh(b[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Lu(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b,y);if(p.type==="MultiLineString"){let w=1/0;for(let M=0;M<p.coordinates.length;M++){let T=Lu(p.coordinates[M],!0,b,y,w);if(isNaN(T))return T;if((w=Math.min(w,T))===0)return w}return w}return p.type==="Polygon"||p.type==="MultiPolygon"?function(w,M,T){let E=1/0;for(let P of w)for(let R of M){let F=$y(P,R,T,E);if(isNaN(F))return F;if((E=Math.min(E,F))===0)return E}return E}(p.type==="Polygon"?[p.coordinates]:p.coordinates,b,y):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Pc(t,e){switch(t){case"string":return jo(e);case"number":return+e;case"boolean":return!!e;case"color":return Bi.parse(e);case"formatted":return Wr.fromString(jo(e));case"resolvedImage":return so.fromString(jo(e))}return e}function uh(t,e,n,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class Tr{constructor(e,n,a){this.type=e,this.key=n,this.scope=a}static parse(e,n){let a=n.expectedType;if(a==null&&(a=Ri),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let c=n.parse(e[1],1);if(!(c instanceof Xa))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let m=n.parse(e[2],2);return m instanceof Xa?new Tr(a,jo(c.value),jo(m.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Tr(a,jo(c.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(n);if(!a)return null;let{type:c,value:m,values:p,minValue:b,maxValue:y,stepValue:w}=a,M=a.default.evaluate(e),T=M;if(m){let E=e.scope;e.scope=(E||"").split("").slice(1).join(""),T=m.evaluate(e),e.scope=E}return c&&(T=Pc(c,T)),T===void 0||b===void 0&&y===void 0&&w===void 0||(typeof T=="number"?T=uh(T,b,y,w):Array.isArray(T)&&(T=T.map(E=>typeof E=="number"?uh(E,b,y,w):E))),m!==void 0&&T!==void 0&&p&&!p.includes(T)&&(T=M,c&&(T=Pc(c,T))),(c&&c!==this.type||T!==void 0&&sr(T)!==this.type)&&(T=Pc(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Fs(t){if(t instanceof Qr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof As||t instanceof vl)return!1;let e=!0;return t.eachChild(n=>{e&&!Fs(n)&&(e=!1)}),e}function Fu(t){if(t instanceof Qr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Fu(n)&&(e=!1)}),e}function nf(t){if(t instanceof Tr)return!1;let e=!0;return t.eachChild(n=>{e&&!nf(n)&&(e=!1)}),e}function mh(t,e){if(t instanceof Qr&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(a=>{n&&!mh(a,e)&&(n=!1)}),n}class zu{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=e[1];return n.scope.has(a)?new zu(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ph{constructor(e,n=[],a,c=new Vp,m=[],p,b){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=c,this.errors=m,this.expectedType=a,this._scope=p,this.options=b}parse(e,n,a,c,m={}){return n||a?this.concat(n,a,c)._parse(e,m):this._parse(e,m)}_parse(e,n){function a(c,m,p){return p==="assert"?new la(m,[c]):p==="coerce"?new ca(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let m=c.parse(e,this);if(!m)return null;if(this.expectedType){let p=this.expectedType,b=m.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||b.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(p,b))return null}else m=a(m,p,n.typeAnnotation||"coerce");else m=a(m,p,n.typeAnnotation||"assert")}if(!(m instanceof Xa)&&m.type.kind!=="resolvedImage"&&fh(m)){let p=new d_(this._scope,this.options);try{m=new Xa(m.type,m.evaluate(p))}catch(b){return this.error(b.message),null}}return m}return ca.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){let c=typeof e=="number"?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new ph(this.registry,c,n||null,m,this.errors,this._scope,this.options)}error(e,...n){let a=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Ma(a,e))}checkSubtype(e,n){let a=th(e,n);return a&&this.error(a),a}}var x_=ph;function fh(t){if(t instanceof zu)return fh(t.boundExpression);if(t instanceof Qr&&t.name==="error"||t instanceof Ds||t instanceof As||t instanceof vl||t instanceof Tr)return!1;let e=t instanceof ca||t instanceof la,n=!0;return t.eachChild(a=>{n=e?n&&fh(a):n&&a instanceof Xa}),!!n&&Fs(t)&&mh(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Bu(t,e){let n=t.length-1,a,c,m=0,p=n,b=0;for(;m<=p;)if(b=Math.floor((m+p)/2),a=t[b],c=t[b+1],a<=e){if(b===n||e<c)return b;m=b+1}else{if(!(a>e))throw new gr("Input is not a number.");p=b-1}return 0}class gh{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[c,m]of a)this.labels.push(c),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(e[1],1,Tt);if(!a)return null;let c=[],m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let p=1;p<e.length;p+=2){let b=p===1?-1/0:e[p],y=e[p+1],w=p,M=p+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let T=n.parse(y,M,m);if(!T)return null;m=m||T.type,c.push([b,T])}return new gh(m,a,c)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let m=n.length;return c>=n[m-1]?a[m-1].evaluate(e):a[Bu(n,c)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let Nu=.95047,w_=1.08883,rf=4/29,xl=6/29,C_=3*xl*xl,of=xl*xl*xl,Vu=Math.PI/180,S_=180/Math.PI;function af(t){return t>of?Math.pow(t,1/3):t/C_+rf}function ju(t){return t>xl?t*t*t:C_*(t-rf)}function sf(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function _h(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function M_(t){let e=_h(t.r),n=_h(t.g),a=_h(t.b),c=af((.4124564*e+.3575761*n+.1804375*a)/Nu),m=af((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*m-16,a:500*(c-m),b:200*(m-af((.0193339*e+.119192*n+.9503041*a)/w_)),alpha:t.a}}function k_(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*ju(e),n=Nu*ju(n),a=w_*ju(a),new Bi(sf(3.2404542*n-1.5371385*e-.4985314*a),sf(-.969266*n+1.8760108*e+.041556*a),sf(.0556434*n-.2040259*e+1.0572252*a),t.alpha)}function Yy(t,e,n){let a=e-t;return t+n*(a>180||a<-180?a-360*Math.round(a/360):a)}let bh={forward:M_,reverse:k_,interpolate:function(t,e,n){return{l:Wt(t.l,e.l,n),a:Wt(t.a,e.a,n),b:Wt(t.b,e.b,n),alpha:Wt(t.alpha,e.alpha,n)}}},Oc={forward:function(t){let{l:e,a:n,b:a}=M_(t),c=Math.atan2(a,n)*S_;return{h:c<0?c+360:c,c:Math.sqrt(n*n+a*a),l:e,alpha:t.a}},reverse:function(t){let e=t.h*Vu,n=t.c;return k_({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Yy(t.h,e.h,n),c:Wt(t.c,e.c,n),l:Wt(t.l,e.l,n),alpha:Wt(t.alpha,e.alpha,n)}}};var I_=Object.freeze({__proto__:null,hcl:Oc,lab:bh});class Do{constructor(e,n,a,c,m){this.type=e,this.operator=n,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(let[p,b]of m)this.labels.push(p),this.outputs.push(b)}static interpolationFactor(e,n,a,c){let m=0;if(e.name==="exponential")m=lf(n,e.base,a,c);else if(e.name==="linear")m=lf(n,1,a,c);else if(e.name==="cubic-bezier"){let p=e.controlPoints;m=new Nd(p[0],p[1],p[2],p[3]).solve(lf(n,1,a,c))}return m}static parse(e,n){let[a,c,m,...p]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let w=c[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let w=c.slice(1);if(w.length!==4||w.some(M=>typeof M!="number"||M<0||M>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,Tt),!m)return null;let b=[],y=null;a==="interpolate-hcl"||a==="interpolate-lab"?y=ao:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let w=0;w<p.length;w+=2){let M=p[w],T=p[w+1],E=w+3,P=w+4;if(typeof M!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(b.length&&b[b.length-1][0]>=M)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);let R=n.parse(T,P,y);if(!R)return null;y=y||R.type,b.push([M,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Do(y,a,c,m,b):n.error(`Type ${Xn(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let m=n.length;if(c>=n[m-1])return a[m-1].evaluate(e);let p=Bu(n,c),b=Do.interpolationFactor(this.interpolation,c,n[p],n[p+1]),y=a[p].evaluate(e),w=a[p+1].evaluate(e);return this.operator==="interpolate"?Eu[this.type.kind.toLowerCase()](y,w,b):this.operator==="interpolate-hcl"?Oc.reverse(Oc.interpolate(Oc.forward(y),Oc.forward(w),b)):bh.reverse(bh.interpolate(bh.forward(y),bh.forward(w),b))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function lf(t,e,n,a){let c=a-n,m=t-n;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class Uu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null,c=n.expectedType;c&&c.kind!=="value"&&(a=c);let m=[];for(let b of e.slice(1)){let y=n.parse(b,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!y)return null;a=a||y.type,m.push(y)}let p=c&&m.some(b=>th(c,b.type));return new Uu(p?Ri:a,m)}evaluate(e){let n,a=null,c=0;for(let m of this.args){if(c++,a=m.evaluate(e),a&&a instanceof so&&!a.available&&(n||(n=a),a=null,c===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Hu{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let m=1;m<e.length-1;m+=2){let p=e[m];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,m);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);let b=n.parse(e[m+1],m+1);if(!b)return null;a.push([p,b])}let c=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return c?new Hu(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class cf{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Tt),c=n.parse(e[2],2,go(n.expectedType||Ri));return a&&c?new cf(c.type.itemType,a,c):null}evaluate(e){let n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new gr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new gr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new gr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class df{constructor(e,n){this.type=Vi,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Ri),c=n.parse(e[2],2,Ri);return a&&c?jp(a.type,[Vi,Ni,Tt,Mc,Ri])?new df(a,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(a.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Tc(n,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(sr(n))} instead.`);if(!Tc(a,["string","array"]))throw new gr(`Expected second argument to be of type array or string, but found ${Xn(sr(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Wu{constructor(e,n,a){this.type=Tt,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Ri),c=n.parse(e[2],2,Ri);if(!a||!c)return null;if(!jp(a.type,[Vi,Ni,Tt,Mc,Ri]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(a.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,Tt);return m?new Wu(a,c,m):null}return new Wu(a,c)}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Tc(n,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(sr(n))} instead.`);if(!Tc(a,["string","array"]))throw new gr(`Expected second argument to be of type array or string, but found ${Xn(sr(a))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(e);return a.indexOf(n,c)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Rc{constructor(e,n,a,c,m,p){this.inputType=e,this.type=n,this.input=a,this.cases=c,this.outputs=m,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);let m={},p=[];for(let w=2;w<e.length-1;w+=2){let M=e[w],T=e[w+1];Array.isArray(M)||(M=[M]);let E=n.concat(w);if(M.length===0)return E.error("Expected at least one branch label.");for(let R of M){if(typeof R!="number"&&typeof R!="string")return E.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return E.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return E.error("Numeric branch labels must be integer values.");if(a){if(E.checkSubtype(a,sr(R)))return null}else a=sr(R);if(m[String(R)]!==void 0)return E.error("Branch labels must be unique.");m[String(R)]=p.length}let P=n.parse(T,w,c);if(!P)return null;c=c||P.type,p.push(P)}let b=n.parse(e[1],1,Ri);if(!b)return null;let y=n.parse(e[e.length-1],e.length-1,c);return y?b.type.kind!=="value"&&n.concat(1).checkSubtype(a,b.type)?null:new Rc(a,c,b,m,p,y):null}evaluate(e){let n=this.input.evaluate(e);return(sr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],c={};for(let p of n){let b=c[this.cases[p]];b===void 0?(c[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[b][1].push(p)}let m=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,b]of a)e.push(b.length===1?m(b[0]):b.map(m)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class hf{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let c=[];for(let p=1;p<e.length-1;p+=2){let b=n.parse(e[p],p,Vi);if(!b)return null;let y=n.parse(e[p+1],p+1,a);if(!y)return null;c.push([b,y]),a=a||y.type}let m=n.parse(e[e.length-1],e.length-1,a);return m?new hf(a,c,m):null}evaluate(e){for(let[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Gu{constructor(e,n,a,c){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Ri),c=n.parse(e[2],2,Tt);if(!a||!c)return null;if(!jp(a.type,[go(Ri),Ni,Ri]))return n.error(`Expected first argument to be of type array or string, but found ${Xn(a.type)} instead`);if(e.length===4){let m=n.parse(e[3],3,Tt);return m?new Gu(a.type,a,c,m):null}return new Gu(a.type,a,c)}evaluate(e){let n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Tc(n,["string","array"]))throw new gr(`Expected first argument to be of type array or string, but found ${Xn(sr(n))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(e);return n.slice(a,c)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function yh(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function T_(t,e,n,a){return a.compare(e,n)===0}function wl(t,e,n){let a=t!=="=="&&t!=="!=";return class bT{constructor(m,p,b){this.type=Vi,this.lhs=m,this.rhs=p,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||p.type.kind==="value"}static parse(m,p){if(m.length!==3&&m.length!==4)return p.error("Expected two or three arguments.");let b=m[0],y=p.parse(m[1],1,Ri);if(!y)return null;if(!yh(b,y.type))return p.concat(1).error(`"${b}" comparisons are not supported for type '${Xn(y.type)}'.`);let w=p.parse(m[2],2,Ri);if(!w)return null;if(!yh(b,w.type))return p.concat(2).error(`"${b}" comparisons are not supported for type '${Xn(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Xn(y.type)}' and '${Xn(w.type)}'.`);a&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new la(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new la(y.type,[w])));let M=null;if(m.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(m[3],3,sa),!M)return null}return new bT(y,w,M)}evaluate(m){let p=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){let y=sr(p),w=sr(b);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new gr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let y=sr(p),w=sr(b);if(y.kind!=="string"||w.kind!=="string")return e(m,p,b)}return this.collator?n(m,p,b,this.collator.evaluate(m)):e(m,p,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[t];return this.eachChild(p=>{m.push(p.serialize())}),m}}}let Zy=wl("==",function(t,e,n){return e===n},T_),E_=wl("!=",function(t,e,n){return e!==n},function(t,e,n,a){return!T_(0,e,n,a)}),D_=wl("<",function(t,e,n){return e<n},function(t,e,n,a){return a.compare(e,n)<0}),A_=wl(">",function(t,e,n){return e>n},function(t,e,n,a){return a.compare(e,n)>0}),P_=wl("<=",function(t,e,n){return e<=n},function(t,e,n,a){return a.compare(e,n)<=0}),uf=wl(">=",function(t,e,n){return e>=n},function(t,e,n,a){return a.compare(e,n)>=0});class vh{constructor(e,n,a,c,m,p){this.type=Ni,this.number=e,this.locale=n,this.currency=a,this.unit=c,this.minFractionDigits=m,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let a=n.parse(e[1],1,Tt);if(!a)return null;let c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,Ni),!m))return null;let p=null;if(c.currency&&(p=n.parse(c.currency,1,Ni),!p))return null;let b=null;if(c.unit&&(b=n.parse(c.unit,1,Ni),!b))return null;let y=null;if(c["min-fraction-digits"]&&(y=n.parse(c["min-fraction-digits"],1,Tt),!y))return null;let w=null;return c["max-fraction-digits"]&&(w=n.parse(c["max-fraction-digits"],1,Tt),!w)?null:new vh(a,m,p,b,y,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class mf{constructor(e){this.type=Tt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Xn(a.type)} instead.`):new mf(a):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new gr(`Expected value to be of type string or array, but found ${Xn(sr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function O_(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Cl={"==":Zy,"!=":E_,">":A_,"<":D_,">=":uf,"<=":P_,array:la,at:cf,boolean:la,case:hf,coalesce:Uu,collator:Ds,format:nh,image:rh,in:df,"index-of":Wu,interpolate:Do,"interpolate-hcl":Do,"interpolate-lab":Do,length:mf,let:Hu,literal:Xa,match:Rc,number:la,"number-format":vh,object:la,slice:Gu,step:gh,string:la,"to-boolean":ca,"to-color":ca,"to-number":ca,"to-string":ca,var:zu,within:As,distance:vl,config:Tr};function R_(t,[e,n,a,c]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let m=c?c.evaluate(t):1,p=l_(e,n,a,m);if(p)throw new gr(p);return new Bi(e/255*m,n/255*m,a/255*m,m)}function L_(t,[e,n,a,c]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let m=c?c.evaluate(t):1,p=function(w,M,T,E){return typeof w=="number"&&w>=0&&w<=360?typeof M=="number"&&M>=0&&M<=100&&typeof T=="number"&&T>=0&&T<=100?E===void 0||typeof E=="number"&&E>=0&&E<=1?null:`Invalid hsla value [${[w,M,T,E].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof E=="number"?[w,M,T,E]:[w,M,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof E=="number"?[w,M,T,E]:[w,M,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,m);if(p)throw new gr(p);let b=`hsla(${e}, ${n}%, ${a}%, ${m})`,y=Bi.parse(b);if(!y)throw new gr(`Failed to parse HSLA color: ${b}`);return y}function F_(t,e){return t in e}function pf(t,e){let n=e[t];return n===void 0?null:n}function Sl(t){return{type:t}}function z_(t){return{result:"success",value:t}}function Ml(t){return{result:"error",value:t}}function B_(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function qu(t){return t["property-type"]==="data-driven"}function Xy(t){return B_(t.expression,"measure-light")}function f(t){return B_(t.expression,"zoom")}function o(t){return!!t.expression&&t.expression.interpolated}function h(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function g(t){return t}function v(t,e){let n=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",c=a||!(a||t.property!==void 0),m=t.type||(o(e)?"exponential":"interval");if(n&&((t=Np({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],Bi.parse(w[1])])),t.default=Bi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!I_[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,b,y;if(m==="exponential")p=D;else if(m==="interval")p=k;else if(m==="categorical"){p=S,b=Object.create(null);for(let w of t.stops)b[w[0]]=w[1];y=typeof t.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);p=A}if(a){let w={},M=[];for(let P=0;P<t.stops.length;P++){let R=t.stops[P],F=R[0].zoom;w[F]===void 0&&(w[F]={zoom:F,type:t.type,property:t.property,default:t.default,stops:[]},M.push(F)),w[F].stops.push([R[0].value,R[1]])}let T=[];for(let P of M)T.push([w[P].zoom,v(w[P],e)]);let E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:Do.interpolationFactor.bind(void 0,E),zoomStops:T.map(P=>P[0]),evaluate:({zoom:P},R)=>D({stops:T,base:t.base},e,P).evaluate(P,R)}}if(c){let w=m==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Do.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(M=>M[0]),evaluate:({zoom:M})=>p(t,e,M,b,y)}}return{kind:"source",evaluate(w,M){let T=M&&M.properties?M.properties[t.property]:void 0;return T===void 0?x(t.default,e.default):p(t,e,T,b,y)}}}function x(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function S(t,e,n,a,c){return x(typeof n===c?a[n]:void 0,t.default,e.default)}function k(t,e,n){if(bl(n)!=="number")return x(t.default,e.default);let a=t.stops.length;if(a===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];let c=Bu(t.stops.map(m=>m[0]),n);return t.stops[c][1]}function D(t,e,n){let a=t.base!==void 0?t.base:1;if(bl(n)!=="number")return x(t.default,e.default);let c=t.stops.length;if(c===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];let m=Bu(t.stops.map(M=>M[0]),n),p=function(M,T,E,P){let R=P-E,F=M-E;return R===0?0:T===1?F/R:(Math.pow(T,F)-1)/(Math.pow(T,R)-1)}(n,a,t.stops[m][0],t.stops[m+1][0]),b=t.stops[m][1],y=t.stops[m+1][1],w=Eu[e.type]||g;if(t.colorSpace&&t.colorSpace!=="rgb"){let M=I_[t.colorSpace];w=(T,E)=>M.reverse(M.interpolate(M.forward(T),M.forward(E),p))}return typeof b.evaluate=="function"?{evaluate(...M){let T=b.evaluate.apply(void 0,M),E=y.evaluate.apply(void 0,M);if(T!==void 0&&E!==void 0)return w(T,E,p)}}:w(b,y,p)}function A(t,e,n){return e.type==="color"?n=Bi.parse(n):e.type==="formatted"?n=Wr.fromString(n.toString()):e.type==="resolvedImage"?n=so.fromString(n.toString()):bl(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),x(n,t.default,e.default)}Qr.register(Cl,{error:[{kind:"error"},[Ni],(t,[e])=>{throw new gr(e.evaluate(t))}],typeof:[Ni,[Ri],(t,[e])=>Xn(sr(e.evaluate(t)))],"to-rgba":[go(Tt,4),[ao],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[ao,[Tt,Tt,Tt],R_],rgba:[ao,[Tt,Tt,Tt,Tt],R_],hsl:[ao,[Tt,Tt,Tt],L_],hsla:[ao,[Tt,Tt,Tt,Tt],L_],has:{type:Vi,overloads:[[[Ni],(t,[e])=>F_(e.evaluate(t),t.properties())],[[Ni,kc],(t,[e,n])=>F_(e.evaluate(t),n.evaluate(t))]]},get:{type:Ri,overloads:[[[Ni],(t,[e])=>pf(e.evaluate(t),t.properties())],[[Ni,kc],(t,[e,n])=>pf(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Ri,[Ni],(t,[e])=>pf(e.evaluate(t),t.featureState||{})],properties:[kc,[],t=>t.properties()],"geometry-type":[Ni,[],t=>t.geometryType()],id:[Ri,[],t=>t.id()],zoom:[Tt,[],t=>t.globals.zoom],pitch:[Tt,[],t=>t.globals.pitch||0],"distance-from-center":[Tt,[],t=>t.distanceFromCenter()],"measure-light":[Tt,[Ni],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Tt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Tt,[],t=>t.globals.lineProgress||0],"raster-value":[Tt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[Tt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[Tt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ri,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Tt,Sl(Tt),(t,e)=>{let n=0;for(let a of e)n+=a.evaluate(t);return n}],"*":[Tt,Sl(Tt),(t,e)=>{let n=1;for(let a of e)n*=a.evaluate(t);return n}],"-":{type:Tt,overloads:[[[Tt,Tt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Tt],(t,[e])=>-e.evaluate(t)]]},"/":[Tt,[Tt,Tt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Tt,[Tt,Tt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Tt,[],()=>Math.LN2],pi:[Tt,[],()=>Math.PI],e:[Tt,[],()=>Math.E],"^":[Tt,[Tt,Tt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Tt,[Tt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Tt,[Tt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Tt,[Tt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Tt,[Tt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Tt,[Tt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Tt,[Tt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Tt,[Tt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Tt,[Tt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Tt,[Tt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Tt,[Tt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Tt,Sl(Tt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Tt,Sl(Tt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Tt,[Tt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Tt,[Tt],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Tt,[Tt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Tt,[Tt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Vi,[Ni,Ri],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Vi,[Ri],(t,[e])=>t.id()===e.value],"filter-type-==":[Vi,[Ni],(t,[e])=>t.geometryType()===e.value],"filter-<":[Vi,[Ni,Ri],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Vi,[Ri],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Vi,[Ni,Ri],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>c}],"filter-id->":[Vi,[Ri],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Vi,[Ni,Ri],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Vi,[Ri],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Vi,[Ni,Ri],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Vi,[Ri],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Vi,[Ri],(t,[e])=>e.value in t.properties()],"filter-has-id":[Vi,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Vi,[go(Ni)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Vi,[go(Ri)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Vi,[Ni,go(Ri)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Vi,[Ni,go(Ri)],(t,[e,n])=>function(a,c,m,p){for(;m<=p;){let b=m+p>>1;if(c[b]===a)return!0;c[b]>a?p=b-1:m=b+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Vi,overloads:[[[Vi,Vi],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Sl(Vi),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Vi,overloads:[[[Vi,Vi],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Sl(Vi),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Vi,[Vi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Vi,[Ni],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Ni,[Ni],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ni,[Ni],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ni,Sl(Ri),(t,e)=>e.map(n=>jo(n.evaluate(t))).join("")],"resolved-locale":[Ni,[sa],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Tt,[Tt,Tt,Ri],(t,e)=>{let[n,a,c]=e.map(p=>p.evaluate(t));if(n>a||n===a)return n;let m;if(typeof c=="string")m=function(p){let b=0;if(p.length===0)return b;for(let y=0;y<p.length;y++)b=(b<<5)-b+p.charCodeAt(y),b|=0;return b}(c);else{if(typeof c!="number")throw new gr(`Invalid seed input: ${c}`);m=c}return n+O_(m)()*(a-n)}]});class L{constructor(e,n,a,c){this.expression=e,this._warningHistory={},this._evaluator=new d_(a,c),this._defaultValue=n?function(m){return m.type==="color"&&(h(m.default)||Array.isArray(m.default))?new Bi(0,0,0,0):m.type==="color"?Bi.parse(m.default)||null:m.default===void 0?null:m.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,c,m,p,b,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,c,m,p,b,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=y||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new gr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function z(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Cl}function U(t,e,n,a){let c=new x_(Cl,[],e?function(p){let b={color:ao,string:Ni,number:Tt,enum:Ni,boolean:Vi,formatted:Ic,resolvedImage:ka};return p.type==="array"?go(b[p.value]||Ri,p.length):b[p.type]}(e):void 0,void 0,void 0,n,a),m=c.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?z_(new L(m,e,n,a)):Ml(c.errors)}class H{constructor(e,n,a){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!Fu(n.expression),this.isConfigDependent=!nf(n.expression)}evaluateWithoutErrorHandling(e,n,a,c,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,m,p)}evaluate(e,n,a,c,m,p){return this._styleExpression.evaluate(e,n,a,c,m,p)}}class Y{constructor(e,n,a,c,m){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Fu(n.expression),this.isLightConstant=m,this.isConfigDependent=!nf(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,a,c,m,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,m,p)}evaluate(e,n,a,c,m,p){return this._styleExpression.evaluate(e,n,a,c,m,p)}interpolationFactor(e,n,a){return this.interpolationType?Do.interpolationFactor(this.interpolationType,e,n,a):0}}function Z(t,e,n,a){if((t=U(t,e,n,a)).result==="error")return t;let c=t.value.expression,m=Fs(c);if(!m&&!qu(e))return Ml([new Ma("","data expressions not supported")]);let p=mh(c,["zoom","pitch","distance-from-center"]);if(!p&&!f(e))return Ml([new Ma("","zoom expressions not supported")]);let b=mh(c,["measure-light"]);if(!b&&!Xy(e))return Ml([new Ma("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,w=Q(c);return w||p||y?w instanceof Ma?Ml([w]):w instanceof Do&&!o(e)?Ml([new Ma("",'"interpolate" expressions cannot be used with this property')]):z_(w?new Y(m?"camera":"composite",t.value,w.labels,w instanceof Do?w.interpolation:void 0,b):new H(m?"constant":"source",t.value,b)):Ml([new Ma("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class X{constructor(e,n){this._parameters=e,this._specification=n,Np(this,v(this._parameters,this._specification))}static deserialize(e){return new X(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Q(t){let e=null;if(t instanceof Hu)e=Q(t.result);else if(t instanceof Uu){for(let n of t.args)if(e=Q(n),e)break}else(t instanceof gh||t instanceof Do)&&t.input instanceof Qr&&t.input.name==="zoom"&&(e=t);return e instanceof Ma||t.eachChild(n=>{let a=Q(n);a instanceof Ma?e=a:e&&a&&e!==a&&(e=new Ma("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var re=ae,oe=3;function ae(t,e,n){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var m=0;m<this.d*this.d;m++){var p=c[oe+m],b=c[oe+m+1];a.push(p===b?null:c.subarray(p,b))}var y=c[oe+a.length+1];this.keys=c.subarray(c[oe+a.length],y),this.bboxes=c.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var M=n/e*t;this.min=-M,this.max=t+M}ae.prototype.insert=function(t,e,n,a,c){this._forEachCell(e,n,a,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c)},ae.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ae.prototype._insertCell=function(t,e,n,a,c,m){this.cells[c].push(m)},ae.prototype.query=function(t,e,n,a,c){var m=this.min,p=this.max;if(t<=m&&e<=m&&p<=n&&p<=a&&!c)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(t,e,n,a,this._queryCell,b,{},c),b},ae.prototype._queryCell=function(t,e,n,a,c,m,p,b){var y=this.cells[c];if(y!==null)for(var w=this.keys,M=this.bboxes,T=0;T<y.length;T++){var E=y[T];if(p[E]===void 0){var P=4*E;(b?b(M[P+0],M[P+1],M[P+2],M[P+3]):t<=M[P+2]&&e<=M[P+3]&&n>=M[P+0]&&a>=M[P+1])?(p[E]=!0,m.push(w[E])):p[E]=!1}}},ae.prototype._forEachCell=function(t,e,n,a,c,m,p,b){for(var y=this._convertToCellCoord(t),w=this._convertToCellCoord(e),M=this._convertToCellCoord(n),T=this._convertToCellCoord(a),E=y;E<=M;E++)for(var P=w;P<=T;P++){var R=this.d*P+E;if((!b||b(this._convertFromCellCoord(E),this._convertFromCellCoord(P),this._convertFromCellCoord(E+1),this._convertFromCellCoord(P+1)))&&c.call(this,t,e,n,a,R,m,p,b))return}},ae.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ae.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ae.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=oe+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var m=e,p=0;p<t.length;p++){var b=t[p];c[oe+p]=m,c.set(b,m),m+=b.length}return c[oe+t.length]=m,c.set(this.keys,m),c[oe+t.length+1]=m+=this.keys.length,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer};var ge=Xe(re);let fe={};function ne(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),fe[e]={klass:t,omit:n.omit||[]}}ne(Object,"Object"),ge.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},ge.deserialize=function(t){return new ge(t.buffer)},Object.defineProperty(ge,"name",{value:"Grid"}),ne(ge,"Grid"),ne(Bi,"Color"),ne(Error,"Error"),ne(Wr,"Formatted"),ne(_l,"FormattedSection"),ne(Ap,"AJAXError"),ne(so,"ResolvedImage"),ne(X,"StylePropertyFunction"),ne(L,"StyleExpression",{omit:["_evaluator"]}),ne(Y,"ZoomDependentExpression"),ne(H,"ZoomConstantExpression"),ne(Qr,"CompoundExpression",{omit:["_evaluate"]});for(let t in Cl)fe[Cl[t]._classRegistryKey]||ne(Cl[t],`Expression${t}`);function se(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function le(t){return self.ImageBitmap&&t instanceof ImageBitmap}function we(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(se(t)||le(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let a of t)n.push(we(a,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[a,c]of t.entries())n[a]=we(c);return n}if(typeof t=="object"){let n=t.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let m in t)t.hasOwnProperty(m)&&(fe[a].omit.indexOf(m)>=0||(c[m]=we(t[m],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof t)}function Re(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||se(t)||le(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Re);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let c=new Map;for(let m of Object.keys(t))m!=="$name"&&c.set(m,Re(t[m]));return c}let{klass:n}=fe[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let a=Object.create(n.prototype);for(let c of Object.keys(t))c!=="$name"&&(a[c]=Re(t[c]));return a}throw new Error("can't deserialize object of type "+typeof t)}let me={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Le(t){for(let e of t)if(Je(e.charCodeAt(0)))return!0;return!1}function Be(t){for(let e of t)if(!Qe(e.charCodeAt(0)))return!1;return!0}function Qe(t){return!(me.Arabic(t)||me["Arabic Supplement"](t)||me["Arabic Extended-A"](t)||me["Arabic Presentation Forms-A"](t)||me["Arabic Presentation Forms-B"](t))}function Je(t){return!(t!==746&&t!==747&&(t<4352||!(me["Bopomofo Extended"](t)||me.Bopomofo(t)||me["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||me["CJK Compatibility Ideographs"](t)||me["CJK Compatibility"](t)||me["CJK Radicals Supplement"](t)||me["CJK Strokes"](t)||!(!me["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||me["CJK Unified Ideographs Extension A"](t)||me["CJK Unified Ideographs"](t)||me["Enclosed CJK Letters and Months"](t)||me["Hangul Compatibility Jamo"](t)||me["Hangul Jamo Extended-A"](t)||me["Hangul Jamo Extended-B"](t)||me["Hangul Jamo"](t)||me["Hangul Syllables"](t)||me.Hiragana(t)||me["Ideographic Description Characters"](t)||me.Kanbun(t)||me["Kangxi Radicals"](t)||me["Katakana Phonetic Extensions"](t)||me.Katakana(t)&&t!==12540||!(!me["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!me["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||me["Unified Canadian Aboriginal Syllabics"](t)||me["Unified Canadian Aboriginal Syllabics Extended"](t)||me["Vertical Forms"](t)||me["Yijing Hexagram Symbols"](t)||me["Yi Syllables"](t)||me["Yi Radicals"](t))))}function Ze(t){return!(Je(t)||function(e){return!!(me["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||me["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||me["Letterlike Symbols"](e)||me["Number Forms"](e)||me["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||me["Control Pictures"](e)&&e!==9251||me["Optical Character Recognition"](e)||me["Enclosed Alphanumerics"](e)||me["Geometric Shapes"](e)||me["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||me["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||me["CJK Symbols and Punctuation"](e)||me.Katakana(e)||me["Private Use Area"](e)||me["CJK Compatibility Forms"](e)||me["Small Form Variants"](e)||me["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Te(t){return t>=1424&&t<=2303||me["Arabic Presentation Forms-A"](t)||me["Arabic Presentation Forms-B"](t)}function Ve(t,e){return!(!e&&Te(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||me.Khmer(t))}function Ye(t){for(let e of t)if(Te(e.charCodeAt(0)))return!0;return!1}let gt="deferred",yt="loading",kt="loaded",vt=null,it="unavailable",Ge=null,Dt=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(it="error"),vt&&vt(t)};function oi(){ti.fire(new oo("pluginStateChange",{pluginStatus:it,pluginURL:Ge}))}let ti=new gl,vi=function(){return it},Di=function(){if(it!==gt||!Ge)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");it=yt,oi(),Ge&&pl({url:Ge},t=>{t?Dt(t):(it=kt,oi())})},Ji={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>it===kt||Ji.applyArabicShaping!=null,isLoading:()=>it===yt,setState(t){it=t.pluginStatus,Ge=t.pluginURL},isParsed:()=>Ji.applyArabicShaping!=null&&Ji.processBidirectionalText!=null&&Ji.processStyledBidirectionalText!=null,getPluginURL:()=>Ge};class Qt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(let c of n)if(!Ve(c.charCodeAt(0),a))return!1;return!0}(e,Ji.isLoaded())}}class Gi{constructor(e,n,a,c){this.property=e,this.value=n,this.expression=function(m,p,b,y){if(h(m))return new X(m,p);if(z(m)||Array.isArray(m)&&m.length>0){let w=Z(m,p,b,y);if(w.result==="error")throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));return w.value}{let w=m;return typeof m=="string"&&p.type==="color"&&(w=Bi.parse(m)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(n===void 0?e.specification.default:n,e.specification,a,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class dn{constructor(e,n,a){this.property=e,this.value=new Gi(e,void 0,n,a)}transitioned(e,n){return new Ci(this.property,this.value,n,Hr({},e.transition,this.transition),e.now)}untransitioned(){return new Ci(this.property,this.value,null,{},0)}}class Qi{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Ca(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new dn(this._values[e].property,this._scope,this._options)),this._values[e].value=new Gi(this._values[e].property,n===null?void 0:Ca(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let a=this._properties.properties;if(e)for(let c in e){let m=e[c];if(Ud(c,"-transition")){let p=c.slice(0,-11);a[p]&&this.setTransition(p,m)}else a.hasOwnProperty(c)&&this.setValue(c,m)}}getTransition(e){return Ca(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new dn(this._values[e].property)),this._values[e].transition=Ca(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a);let c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){let a=new ii(this._properties);for(let c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,n._values[c]);return a}untransitioned(){let e=new ii(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Ci{constructor(e,n,a,c,m){let p=c.delay||0,b=c.duration||0;m=m||0,this.property=e,this.value=n,this.begin=m+p,this.end=this.begin+b,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){let c=e.now||0,m=this.value.possiblyEvaluate(e,n,a),p=this.prior;if(p){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return p.possiblyEvaluate(e,n,a);{let b=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,a),m,bp(b))}}return m}}class ii{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){let c=new nn(this._properties);for(let m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,a);return c}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class gn{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Ca(this._values[e].value)}setValue(e,n){this._values[e]=new Gi(this._values[e].property,n===null?void 0:Ca(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){let c=new nn(this._properties);for(let m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,a);return c}}class xn{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,c){return this.property.evaluate(this.value,this.parameters,e,n,a,c)}}class nn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ke{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){let c=Eu[this.specification.type];return c?c(e,n,a):e}}class St{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,c){return new xn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,c)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new xn(this,{kind:"constant",value:void 0},e.parameters);let c=Eu[this.specification.type];return c?new xn(this,{kind:"constant",value:c(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,c,m,p){return e.kind==="constant"?e.value:e.evaluate(n,a,c,m,p)}}class Dn{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,c){return!!e.expression.evaluate(n,null,{},a,c)}interpolate(){return!1}}class qi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Qt(0,{});for(let a in e){let c=e[a];c.specification.overridable&&this.overridableProperties.push(a);let m=this.defaultPropertyValues[a]=new Gi(c,void 0),p=this.defaultTransitionablePropertyValues[a]=new dn(c);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=m.possiblyEvaluate(n)}}}ne(St,"DataDrivenProperty"),ne(Ke,"DataConstantProperty"),ne(Dn,"ColorRampProperty");var Pe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ao(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Er(t){if(Array.isArray(t))return t.map(Er);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Er(t[n]);return e}return Ao(t)}function Kr(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Kr(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function _r(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Kr(t)||(t=Ta(t));let n=t,a=!0;try{a=function(w){if(!Po(w))return w;let M=Er(w);return ua(M),M=co(M),M}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let c=Pe[`filter_${e}`],m=U(a,c),p=null;if(m.result==="error")throw new Error(m.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,M,T)=>m.value.evaluate(w,M,{},T);let b=null,y=null;if(a!==n){let w=U(n,c);if(w.result==="error")throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));b=(M,T,E,P,R)=>w.value.evaluate(M,T,{},E,void 0,void 0,P,R),y=!Fs(w.value.expression)}return{filter:p,dynamicFilter:b||void 0,needGeometry:Ka(a),needFeature:!!y}}function co(t){if(!Array.isArray(t))return t;let e=function(n){if(zs.has(n[0])){for(let a=1;a<n.length;a++)if(Po(n[a]))return!0}return n}(t);return e===!0?e:e.map(n=>co(n))}function ua(t){let e=!1,n=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||Po(t[a]),n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Po(t[1]);for(let a=2;a<t.length-1;a+=2)n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Po(t[1]);for(let a=1;a<t.length-1;a+=2)n.push(t[a+1])}e&&(t.length=0,t.push("any",...n));for(let a=1;a<t.length;a++)ua(t[a])}function Po(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Po(t[n]))return!0;return!1}let zs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Bs(t,e){return t<e?-1:t>e?1:0}function Ka(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Ka(t[e]))return!0;return!1}function Ta(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?Ja(t[1],t[2],"=="):e==="!="?kl(Ja(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ja(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Ta))):e==="all"?["all"].concat(t.slice(1).map(Ta)):e==="none"?["all"].concat(t.slice(1).map(Ta).map(kl)):e==="in"?Lc(t[1],t.slice(2)):e==="!in"?kl(Lc(t[1],t.slice(2))):e==="has"?Fc(t[1]):e!=="!has"||kl(Fc(t[1]));var n}function Ja(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Lc(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Bs)]]:["filter-in-small",t,["literal",e]]}}function Fc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function kl(t){return["!",t]}let zc="";function $u(t,e){return e?`${t}${zc}${e}`:t}let Yu="-transition",ff=new Set(["fill","line","background","hillshade","raster"]);class hr extends gl{constructor(e,n,a,c,m){if(super(),this.id=e.id,this.fqid=$u(this.id,a),this.type=e.type,this.scope=a,this.lut=c,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new gn(n.layout,this.scope,m),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Qi(n.paint,this.scope,m);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nn(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return ff.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Ud(e,Yu)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let a=this._transitionablePaint,c=a._properties.properties;if(Ud(e,Yu)){let T=e.slice(0,-11);return c[T]&&a.setTransition(T,n||void 0),!1}if(!c[e])return!1;let m=a._values[e],p=m.value.isDataDriven(),b=m.value;a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=a._values[e].value,w=y.isDataDriven(),M=Ud(e,"pattern")||e==="line-dasharray";return w||p||M||this._handleOverridablePaintPropertyUpdate(e,b,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,a){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return ul({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof xn&&qu(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=_r(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,a,c,m,p,b,y,w){}queryIntersectsMatchingFeature(e,n,a,c){}}let gf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bc{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $i(t,e=1){let n=0,a=0;return{members:t.map(c=>{let m=gf[c.type].BYTES_PER_ELEMENT,p=n=yC(n,Math.max(e,m)),b=c.components||1;return a=Math.max(a,m),n+=m*b,{name:c.name,type:c.type,components:b,offset:p}}),size:yC(n,Math.max(a,e)),alignment:e}}function yC(t,e){return Math.ceil(t/e)*e}class es extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.int16[c+0]=n,this.int16[c+1]=a,e}}es.prototype.bytesPerElement=4,ne(es,"StructArrayLayout2i4");class N_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let m=3*e;return this.int16[m+0]=n,this.int16[m+1]=a,this.int16[m+2]=c,e}}N_.prototype.bytesPerElement=6,ne(N_,"StructArrayLayout3i6");class Nc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=4*e;return this.int16[p+0]=n,this.int16[p+1]=a,this.int16[p+2]=c,this.int16[p+3]=m,e}}Nc.prototype.bytesPerElement=8,ne(Nc,"StructArrayLayout4i8");class Qy extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=5*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+3]=m,this.int16[b+4]=p,e}}Qy.prototype.bytesPerElement=10,ne(Qy,"StructArrayLayout5i10");class Ky extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=6*e,M=12*e,T=3*e;return this.int16[w+0]=n,this.int16[w+1]=a,this.uint8[M+4]=c,this.uint8[M+5]=m,this.uint8[M+6]=p,this.uint8[M+7]=b,this.float32[T+2]=y,e}}Ky.prototype.bytesPerElement=12,ne(Ky,"StructArrayLayout2i4ub1f12");class Vc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=4*e;return this.float32[p+0]=n,this.float32[p+1]=a,this.float32[p+2]=c,this.float32[p+3]=m,e}}Vc.prototype.bytesPerElement=16,ne(Vc,"StructArrayLayout4f16");class jc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let m=3*e;return this.float32[m+0]=n,this.float32[m+1]=a,this.float32[m+2]=c,e}}jc.prototype.bytesPerElement=12,ne(jc,"StructArrayLayout3f12");class Uc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=6*e,y=3*e;return this.uint16[b+0]=n,this.uint16[b+1]=a,this.uint16[b+2]=c,this.uint16[b+3]=m,this.float32[y+2]=p,e}}Uc.prototype.bytesPerElement=12,ne(Uc,"StructArrayLayout4ui1f12");class V_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=a,this.uint16[p+2]=c,this.uint16[p+3]=m,e}}V_.prototype.bytesPerElement=8,ne(V_,"StructArrayLayout4ui8");class j_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,c,m,p)}emplace(e,n,a,c,m,p,b){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=c,this.int16[y+3]=m,this.int16[y+4]=p,this.int16[y+5]=b,e}}j_.prototype.bytesPerElement=12,ne(j_,"StructArrayLayout6i12");class Jy extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E){let P=this.length;return this.resize(P+1),this.emplace(P,e,n,a,c,m,p,b,y,w,M,T,E)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P){let R=12*e;return this.int16[R+0]=n,this.int16[R+1]=a,this.int16[R+2]=c,this.int16[R+3]=m,this.uint16[R+4]=p,this.uint16[R+5]=b,this.uint16[R+6]=y,this.uint16[R+7]=w,this.int16[R+8]=M,this.int16[R+9]=T,this.int16[R+10]=E,this.int16[R+11]=P,e}}Jy.prototype.bytesPerElement=24,ne(Jy,"StructArrayLayout4i4ui4i24");class ev extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,c,m,p)}emplace(e,n,a,c,m,p,b){let y=10*e,w=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=c,this.float32[w+2]=m,this.float32[w+3]=p,this.float32[w+4]=b,e}}ev.prototype.bytesPerElement=20,ne(ev,"StructArrayLayout3i3f20");class tv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}tv.prototype.bytesPerElement=4,ne(tv,"StructArrayLayout1ul4");class xh extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}xh.prototype.bytesPerElement=4,ne(xh,"StructArrayLayout1f4");class Hc extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=a,e}}Hc.prototype.bytesPerElement=4,ne(Hc,"StructArrayLayout2ui4");class iv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,a,c,m,p,b,y,w,M,T,E,P)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R){let F=20*e,B=10*e;return this.int16[F+0]=n,this.int16[F+1]=a,this.int16[F+2]=c,this.int16[F+3]=m,this.int16[F+4]=p,this.float32[B+3]=b,this.float32[B+4]=y,this.float32[B+5]=w,this.float32[B+6]=M,this.int16[F+14]=T,this.uint32[B+8]=E,this.uint16[F+18]=P,this.uint16[F+19]=R,e}}iv.prototype.bytesPerElement=40,ne(iv,"StructArrayLayout5i4f1i1ul2ui40");class U_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=8*e;return this.int16[w+0]=n,this.int16[w+1]=a,this.int16[w+2]=c,this.int16[w+4]=m,this.int16[w+5]=p,this.int16[w+6]=b,this.int16[w+7]=y,e}}U_.prototype.bytesPerElement=16,ne(U_,"StructArrayLayout3i2i2i16");class nv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=4*e,y=8*e;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=c,this.int16[y+6]=m,this.int16[y+7]=p,e}}nv.prototype.bytesPerElement=16,ne(nv,"StructArrayLayout2f1f2i16");class rv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=12*e,b=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=a,this.float32[b+1]=c,this.float32[b+2]=m,e}}rv.prototype.bytesPerElement=12,ne(rv,"StructArrayLayout2ub2f12");class wr extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=a,this.uint16[m+2]=c,e}}wr.prototype.bytesPerElement=6,ne(wr,"StructArrayLayout3ui6");class ov extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe){let he=this.length;return this.resize(he+1),this.emplace(he,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he){let ve=30*e,Ce=15*e,De=60*e;return this.int16[ve+0]=n,this.int16[ve+1]=a,this.int16[ve+2]=c,this.float32[Ce+2]=m,this.float32[Ce+3]=p,this.uint16[ve+8]=b,this.uint16[ve+9]=y,this.uint32[Ce+5]=w,this.uint32[Ce+6]=M,this.uint32[Ce+7]=T,this.uint16[ve+16]=E,this.uint16[ve+17]=P,this.uint16[ve+18]=R,this.float32[Ce+10]=F,this.float32[Ce+11]=B,this.uint8[De+48]=W,this.uint8[De+49]=J,this.uint8[De+50]=ee,this.uint32[Ce+13]=te,this.int16[ve+28]=pe,this.uint8[De+58]=he,e}}ov.prototype.bytesPerElement=60,ne(ov,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class av extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he,ve,Ce,De,Ue,ze,$e,rt,We,et,He,tt,lt){let nt=this.length;return this.resize(nt+1),this.emplace(nt,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he,ve,Ce,De,Ue,ze,$e,rt,We,et,He,tt,lt)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W,J,ee,te,pe,he,ve,Ce,De,Ue,ze,$e,rt,We,et,He,tt,lt,nt){let Mt=22*e,ot=44*e,ht=88*e;return this.float32[Mt+0]=n,this.float32[Mt+1]=a,this.int16[ot+4]=c,this.int16[ot+5]=m,this.int16[ot+6]=p,this.int16[ot+7]=b,this.int16[ot+8]=y,this.int16[ot+9]=w,this.int16[ot+10]=M,this.int16[ot+11]=T,this.int16[ot+12]=E,this.uint16[ot+13]=P,this.uint16[ot+14]=R,this.uint16[ot+15]=F,this.uint16[ot+16]=B,this.uint16[ot+17]=W,this.uint16[ot+18]=J,this.uint16[ot+19]=ee,this.uint16[ot+20]=te,this.uint16[ot+21]=pe,this.uint16[ot+22]=he,this.uint16[ot+23]=ve,this.uint16[ot+24]=Ce,this.uint16[ot+25]=De,this.uint16[ot+26]=Ue,this.uint16[ot+27]=ze,this.uint32[Mt+14]=$e,this.float32[Mt+15]=rt,this.float32[Mt+16]=We,this.float32[Mt+17]=et,this.float32[Mt+18]=He,this.float32[Mt+19]=tt,this.float32[Mt+20]=lt,this.uint8[ht+84]=nt,e}}av.prototype.bytesPerElement=88,ne(av,"StructArrayLayout2f9i15ui1ul6f1ub88");class wh extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m){let p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,m)}emplace(e,n,a,c,m,p){let b=5*e;return this.float32[b+0]=n,this.float32[b+1]=a,this.float32[b+2]=c,this.float32[b+3]=m,this.float32[b+4]=p,e}}wh.prototype.bytesPerElement=20,ne(wh,"StructArrayLayout5f20");class sv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=7*e;return this.float32[w+0]=n,this.float32[w+1]=a,this.float32[w+2]=c,this.float32[w+3]=m,this.float32[w+4]=p,this.float32[w+5]=b,this.float32[w+6]=y,e}}sv.prototype.bytesPerElement=28,ne(sv,"StructArrayLayout7f28");class Zu extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.float32[c+0]=n,this.float32[c+1]=a,e}}Zu.prototype.bytesPerElement=8,ne(Zu,"StructArrayLayout2f8");class lv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c)}emplace(e,n,a,c,m){let p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=a,this.uint16[p+3]=c,this.uint16[p+4]=m,e}}lv.prototype.bytesPerElement=12,ne(lv,"StructArrayLayout1ul3ui12");class _f extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}_f.prototype.bytesPerElement=2,ne(_f,"StructArrayLayout1ui2");class cv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B){let W=this.length;return this.resize(W+1),this.emplace(W,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B)}emplace(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W){let J=16*e;return this.float32[J+0]=n,this.float32[J+1]=a,this.float32[J+2]=c,this.float32[J+3]=m,this.float32[J+4]=p,this.float32[J+5]=b,this.float32[J+6]=y,this.float32[J+7]=w,this.float32[J+8]=M,this.float32[J+9]=T,this.float32[J+10]=E,this.float32[J+11]=P,this.float32[J+12]=R,this.float32[J+13]=F,this.float32[J+14]=B,this.float32[J+15]=W,e}}cv.prototype.bytesPerElement=64,ne(cv,"StructArrayLayout16f64");class H_ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,m,p,b){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,m,p,b)}emplace(e,n,a,c,m,p,b,y){let w=10*e,M=5*e;return this.uint16[w+0]=n,this.uint16[w+1]=a,this.uint16[w+2]=c,this.uint16[w+3]=m,this.float32[M+2]=p,this.float32[M+3]=b,this.float32[M+4]=y,e}}H_.prototype.bytesPerElement=20,ne(H_,"StructArrayLayout4ui3f20");class dv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}dv.prototype.bytesPerElement=2,ne(dv,"StructArrayLayout1i2");class hv extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}hv.prototype.bytesPerElement=1,ne(hv,"StructArrayLayout1ub1");class vC extends Bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}vC.prototype.size=40;class uv extends iv{get(e){return new vC(this,e)}}ne(uv,"CollisionBoxArray");class xC extends Bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}xC.prototype.size=60;class wC extends ov{get(e){return new xC(this,e)}}ne(wC,"PlacedSymbolArray");class CC extends Bc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}CC.prototype.size=88;class SC extends av{get(e){return new CC(this,e)}}ne(SC,"SymbolInstanceArray");class MC extends xh{getoffsetX(e){return this.float32[1*e+0]}}ne(MC,"GlyphOffsetArray");class kC extends es{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ne(kC,"SymbolLineVertexArray");class IC extends Bc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}IC.prototype.size=12;class TC extends lv{get(e){return new IC(this,e)}}ne(TC,"FeatureIndexArray");class EC extends Hc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ne(EC,"FillExtrusionCentroidArray");let AA=$i([{name:"a_pos",components:2,type:"Int16"}],4),PA=$i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class An{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,c){let m=this.segments[this.segments.length-1];return e>An.MAX_VERTEX_ARRAY_LENGTH&&Zn(`Max vertices per segment is ${An.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>An.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}prepareSegment(e,n,a,c){return this._prepareSegment(e,n.length,a.length,c)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,c){return new An([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function DC(t,e){return 256*(t=pi(Math.floor(t),0,255))+pi(Math.floor(e),0,255)}An.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ne(An,"SegmentVector");let OA=$i([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),RA=$i([{name:"a_dash",components:4,type:"Uint16"}]);class bf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,c){this.ids.push(AC(e)),this.positions.push(n,a,c)}eachPosition(e,n){let a=AC(e),c=0,m=this.ids.length-1;for(;c<m;){let p=c+m>>1;this.ids[p]>=a?m=p:c=p+1}for(;this.ids[c]===a;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){let a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return mv(a,c,0,a.length-1),n&&(n.add(a.buffer),n.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){let n=new bf,a;n.ids=e.ids,n.positions=e.positions;for(let c of n.ids)c!==a&&n.uniqueIds.push(c),a=c;return n.indexed=!0,n}}function AC(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Cc(String(t))}function mv(t,e,n,a){for(;n<a;){let c=t[n+a>>1],m=n-1,p=a+1;for(;;){do m++;while(t[m]<c);do p--;while(t[p]>c);if(m>=p)break;W_(t,m,p),W_(e,3*m,3*p),W_(e,3*m+1,3*p+1),W_(e,3*m+2,3*p+2)}p-n<a-p?(mv(t,e,n,p),n=p+1):(mv(t,e,p+1,a),a=p)}}function W_(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}ne(bf,"FeaturePositionMap");class Il{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class G_ extends Il{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class _o extends Il{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Tl extends Il{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class pv extends Il{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class fv extends Il{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class PC extends Il{constructor(e){super(e),this.current=Bi.transparent.toRenderColor(null)}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let LA=new Float32Array(16);class yf extends Il{constructor(e){super(e),this.current=LA}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let FA=new Float32Array(9),zA=new Float32Array(4);class gv extends Il{constructor(e){super(e),this.current=zA}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function _v(t){return[DC(255*t.r,255*t.g),DC(255*t.b,255*t.a)]}class vf{constructor(e,n,a,c){this.value=e,this.uniformNames=n.map(m=>`u_${m}`),this.type=a,this.context=c}setUniform(e,n,a,c,m){let p=c.constantOr(this.value);n.set(e,m,p instanceof Bi?p.toRenderColor(this.context.lut):p)}getBinding(e,n){return this.type==="color"?new PC(e):new _o(e)}}class Xu{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,c,m){let p=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,m,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new fv(e):new _o(e)}}class El{constructor(e,n,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,a,c,m,p,b){let y=this.paintVertexArray.length,w=this.expression.evaluate(new Qt(0,{brightness:p}),n,{},m,c,b);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w,this.context)}updatePaintArray(e,n,a,c,m,p,b){let y=this.expression.evaluate({zoom:0,brightness:b},a,c,void 0,m);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,a,c){if(this.type==="color"){let m=_v(a.toRenderColor(c.lut));for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,m[0],m[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ts{constructor(e,n,a,c,m,p){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=a,this.useIntegerZoom=c,this.context=m,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,a,c,m,p,b){let y=this.expression.evaluate(new Qt(this.context.zoom,{brightness:p}),n,{},m,c,b),w=this.expression.evaluate(new Qt(this.context.zoom+1,{brightness:p}),n,{},m,c,b),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,y,w,this.context)}updatePaintArray(e,n,a,c,m,p,b){let y=this.expression.evaluate({zoom:this.context.zoom,brightness:b},a,c,void 0,m),w=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},a,c,void 0,m);this._setPaintValue(e,n,y,w,this.context)}_setPaintValue(e,n,a,c,m){if(this.type==="color"){let p=_v(a.toRenderColor(m.lut)),b=_v(a.toRenderColor(m.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,p[0],p[1],b[0],b[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,c,m){let p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,b=pi(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);n.set(e,m,b)}getBinding(e,n){return new _o(e)}}class Wc{constructor(e,n,a,c,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(a==="array"?RA:OA).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new c}populatePaintArray(e,n,a,c){let m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,c,m,p,b){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,n,a,c){if(!c||!a)return;let m=c[a];if(!m)return;let{tl:p,br:b,pixelRatio:y}=m;for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,p[0],p[1],b[0],b[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ch{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[],this.context=n;let c=[];for(let m in e.paint._values){let p=e.paint.get(m);if(!a(m)||!(p instanceof xn&&qu(p.property.specification)))continue;let b=NA(m,e.type),y=p.value,w=p.property.specification.type,M=!!p.property.useIntegerZoom,T=m==="line-dasharray"||m.endsWith("pattern"),E=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||E)if(y.kind==="source"||E||T){let P=OC(m,w,"source");this.binders[m]=T?new Wc(y,b,w,P,e.id):new El(y,b,w,P),c.push(`/a_${m}`)}else{let P=OC(m,w,"composite");this.binders[m]=new ts(y,b,w,M,n,P),c.push(`/z_${m}`)}else this.binders[m]=T?new Xu(y.value,b):new vf(y.value,b,w,n),c.push(`/u_${m}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof El||n instanceof ts?n.maxValue:0}populatePaintArrays(e,n,a,c,m,p,b){for(let y in this.binders){let w=this.binders[y];w.context=this.context,(w instanceof El||w instanceof ts||w instanceof Wc)&&w.populatePaintArray(e,n,a,c,m,p,b)}}setConstantPatternPositions(e){for(let n in this.binders){let a=this.binders[n];a instanceof Xu&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,c,m,p,b,y){let w=!1,M=Object.keys(e),T=M.length!==0,E=T?M:n.uniqueIds;this.context.lut=m.lut;for(let P in this.binders){let R=this.binders[P];if(R.context=this.context,(R instanceof El||R instanceof ts||R instanceof Wc)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let F=m.paint.get(P);R.expression=F.value;for(let B of E){let W=e[B.toString()];n.eachPosition(B,(J,ee,te)=>{let pe=c.feature(J);R.updatePaintArray(ee,te,pe,W,p,b,y)})}if(!T)for(let B of a.uniqueIds){let W=e[B.toString()];a.eachPosition(B,(J,ee,te)=>{let pe=c.feature(J);R.updatePaintArray(ee,te,pe,W,p,b,y)})}w=!0}}return w}defines(){let e=[];for(let n in this.binders){let a=this.binders[n];(a instanceof vf||a instanceof Xu)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof El||a instanceof ts||a instanceof Wc)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof vf||a instanceof Xu||a instanceof ts)for(let c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let a in this.binders){let c=this.binders[a];if(c instanceof vf||c instanceof Xu||c instanceof ts)for(let m of c.uniformNames)n.push({name:m,property:a,binding:c.getBinding(e,m)})}return n}setUniforms(e,n,a,c,m){for(let{name:p,property:b,binding:y}of a)this.binders[b].setUniform(e,y,m,c.get(b),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof El||n instanceof ts||n instanceof Wc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let a=this.binders[n];(a instanceof El||a instanceof ts||a instanceof Wc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof El||n instanceof ts||n instanceof Wc)&&n.destroy()}}}class Gc{constructor(e,n,a=()=>!0){this.programConfigurations={};for(let c of e)this.programConfigurations[c.id]=new Ch(c,n,a);this.needsUpload=!1,this._featureMap=new bf,this._featureMapWithoutIds=new bf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,c,m,p,b,y){for(let w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,n,c,m,p,b,y);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,c,m,p){for(let b of a)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,b,c,m,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let BA={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function NA(t,e){return BA[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let VA={"line-pattern":{source:Uc,composite:Uc},"fill-pattern":{source:Uc,composite:Uc},"fill-extrusion-pattern":{source:Uc,composite:Uc},"line-dasharray":{source:V_,composite:V_}},jA={color:{source:Zu,composite:Vc},number:{source:xh,composite:Zu}};function OC(t,e,n){let a=VA[t];return a&&a[n]||jA[e][n]}ne(vf,"ConstantBinder"),ne(Xu,"PatternConstantBinder"),ne(El,"SourceExpressionBinder"),ne(Wc,"PatternCompositeBinder"),ne(ts,"CompositeExpressionBinder"),ne(Ch,"ProgramConfiguration",{omit:["_buffers"]}),ne(Gc,"ProgramConfigurationSet");let bo=pt/Math.PI/2,bv=5,RC=6,UA=16383,Qu=64,yv=[Qu,32,16],Ea=-bo,Da=bo;function Ku(t,e,n,a=bo){return n=Ei(n),[t*Math.sin(n)*a,-e*a,t*Math.cos(n)*a]}function Sh(t,e,n){return Ku(Math.cos(Ei(t)),Math.sin(Ei(t)),e,n)}let Ju=63710088e-1,vv=2*Math.PI*Ju;class Li{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Li(hl(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,a=this.lat*n,c=e.lat*n,m=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Ju*Math.acos(Math.min(m,1))}toBounds(e=0){let n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new qc({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return Sh(this.lat,this.lng,bo+e*bo/Ju)}static convert(e){if(e instanceof Li)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Li(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Li(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class qc{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof Li?new Li(e.lng,e.lat):Li.convert(e),this}setSouthWest(e){return this._sw=e instanceof Li?new Li(e.lng,e.lat):Li.convert(e),this}extend(e){let n=this._sw,a=this._ne,c,m;if(e instanceof Li)c=e,m=e;else{if(!(e instanceof qc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(qc.convert(e)):this.extend(Li.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Li.convert(e)):this;if(c=e._sw,m=e._ne,!c||!m)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new Li(c.lng,c.lat),this._ne=new Li(m.lng,m.lat)),this}getCenter(){return new Li((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Li(this.getWest(),this.getNorth())}getSouthEast(){return new Li(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:a}=Li.convert(e),c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return!e||e instanceof qc?e:new qc(e)}}var LC={};(function(t,e){(function(n){function a(m,p,b){var y=c(256*m,256*(p=Math.pow(2,b)-p-1),b),w=c(256*(m+1),256*(p+1),b);return y[0]+","+y[1]+","+w[0]+","+w[1]}function c(m,p,b){var y=2*Math.PI*6378137/256/Math.pow(2,b);return[m*y-2*Math.PI*6378137/2,p*y-2*Math.PI*6378137/2]}n.getURL=function(m,p,b,y,w,M){return M=M||{},m+"?"+["bbox="+a(b,y,w),"format="+(M.format||"image/png"),"service="+(M.service||"WMS"),"version="+(M.version||"1.1.1"),"request="+(M.request||"GetMap"),"srs="+(M.srs||"EPSG:3857"),"width="+(M.width||256),"height="+(M.height||256),"layers="+p].join("&")},n.getTileBBox=a,n.getMercCoords=c,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,LC);var HA=LC;class Mh{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=xf(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let a=HA.getTileBBox(this.x,this.y,this.z),c=function(m,p,b){let y,w="";for(let M=m;M>0;M--)y=1<<M-1,w+=(p&y?1:0)+(b&y?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class FC{constructor(e,n){this.wrap=e,this.canonical=n,this.key=xf(e,n.z,n.z,n.x,n.y)}}class ur{constructor(e,n,a,c,m){this.overscaledZ=e,this.wrap=n,this.canonical=new Mh(a,+c,+m),this.key=n===0&&e===a?this.canonical.key:xf(n,e,a,c,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new ur(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ur(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return xf(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return xf(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new ur(n,this.wrap,n,a,c),new ur(n,this.wrap,n,a+1,c),new ur(n,this.wrap,n,a,c+1),new ur(n,this.wrap,n,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ur(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new FC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function xf(t,e,n,a,c){let m=1<<Math.min(n,22),p=m*(c%m)+a%m;return t&&n<22&&(p+=m*m*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}let WA=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new ur(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new ur(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new ur(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new ur(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];ne(Mh,"CanonicalTileID"),ne(ur,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let GA=0,qA=25.5;function xv(t){return vv*Math.cos(t*Math.PI/180)}function Ns(t){return(180+t)/360}function Vs(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function yo(t,e){return t/xv(e)}function Oo(t){return 360*t-180}function Dr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function zC(t,e){return t*xv(Dr(e))}let Qn=85.051129;function BC(t){return Math.cos(Ei(pi(t,-Qn,Qn)))}function kh(t,e){let n=pi(e,GA,qA),a=Math.pow(2,n);return BC(t)*vv/(512*a)}function NC(t){return 1/Math.cos(t*Math.PI/180)}function q_(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/pt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/pt/(1<<t.z)}class Jr{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){let a=Li.convert(e);return new Jr(Ns(a.lng),Vs(a.lat),yo(n,a.lat))}toLngLat(){return new Li(Oo(this.x),Dr(this.y))}toAltitude(){return zC(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vv*NC(Dr(this.y))}}function wv(t,e,n,a,c,m,p,b,y){let w=(e+a)/2,M=(n+c)/2,T=new xt(w,M);b(T),function(E,P,R,F,B,W){let J=R-B,ee=F-W;return Math.abs((F-P)*J-(R-E)*ee)/Math.hypot(J,ee)}(T.x,T.y,m.x,m.y,p.x,p.y)>=y?(wv(t,e,n,w,M,m,T,b,y),wv(t,w,M,a,c,T,p,b,y)):t.push(p)}function VC(t,e,n){let a=t[0],c=a.x,m=a.y;e(a);let p=[a];for(let b=1;b<t.length;b++){let y=t[b],{x:w,y:M}=y;e(y),wv(p,c,m,w,M,a,y,e,n),c=w,m=M,a=y}return p}function Cv(t,e,n,a){if(a(e,n)){let c=e.add(n)._mult(.5);Cv(t,e,c,a),Cv(t,c,n,a)}else t.push(n)}function $A(t,e){let n=t[0],a=[n];for(let c=1;c<t.length;c++){let m=t[c];Cv(a,n,m,e),n=m}return a}let Sv=Math.pow(2,14)-1,jC=-Sv-1;function YA(t,e){let n=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=pi(n,jC,Sv),t.y=pi(a,jC,Sv),(n<t.x||n>t.x+1||a<t.y||a>t.y+1)&&Zn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function is(t,e,n){let a=t.loadGeometry(),c=t.extent,m=pt/c;if(e&&n&&n.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:b,x:y,y:w,projection:M}=n,T=E=>{let P=Oo((e.x+E.x/c)/p),R=Dr((e.y+E.y/c)/p),F=M.project(P,R);E.x=(F.x*b-y)*c,E.y=(F.y*b-w)*c};for(let E=0;E<a.length;E++)if(t.type!==1)a[E]=VC(a[E],T,1);else{let P=[];for(let R of a[E])R.x<0||R.x>=c||R.y<0||R.y>=c||(T(R),P.push(R));a[E]=P}}for(let p of a)for(let b of p)YA(b,m);return a}function Dl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?is(t):[]}}function $_(t,e,n,a,c){t.emplaceBack(2*e+(a+1)/2,2*n+(c+1)/2)}function Y_(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Mv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new es,this.indexArray=new wr,this.segments=new An,this.programConfigurations=new Gc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,a,c){let m=this.layers[0],p=[],b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(let{feature:w,id:M,index:T,sourceLayerIndex:E}of e){let P=this.layers[0]._featureFilter.needGeometry,R=Dl(w,P);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),R,a))continue;let F=b?b.evaluate(R,{},a):void 0,B={id:M,properties:w.properties,type:w.type,sourceLayerIndex:E,index:T,geometry:P?R.geometry:is(w,a,c),patterns:{},sortKey:F};p.push(B)}b&&p.sort((w,M)=>w.sortKey-M.sortKey);let y=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new j_,y=c.projection);for(let w of p){let{geometry:M,index:T,sourceLayerIndex:E}=w,P=e[T].feature;this.addFeature(w,M,T,n.availableImages,a,y,n.brightness),n.featureIndex.insert(P,M,T,E,this.index)}}update(e,n,a,c,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,AA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,PA.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,c,m,p,b){for(let y of n)for(let w of y){let M=w.x,T=w.y;if(M<0||M>=pt||T<0||T>=pt)continue;if(p){let R=p.projectTilePoint(M,T,m),F=p.upVector(m,M,T),B=this.globeExtVertexArray;Y_(B,R,F),Y_(B,R,F),Y_(B,R,F),Y_(B,R,F)}let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=E.vertexLength;$_(this.layoutVertexArray,M,T,-1,-1),$_(this.layoutVertexArray,M,T,1,-1),$_(this.layoutVertexArray,M,T,1,1),$_(this.layoutVertexArray,M,T,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,m,b)}}function kv(t,e){for(let n=0;n<t.length;n++)if($c(e,t[n]))return!0;for(let n=0;n<e.length;n++)if($c(t,e[n]))return!0;return!!Iv(t,e)}function ZA(t,e,n){return!!$c(t,e)||!!Tv(e,t,n)}function UC(t,e){if(t.length===1)return WC(e,t[0]);for(let n=0;n<e.length;n++){let a=e[n];for(let c=0;c<a.length;c++)if($c(t,a[c]))return!0}for(let n=0;n<t.length;n++)if(WC(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Iv(t,e[n]))return!0;return!1}function XA(t,e,n){if(t.length>1){if(Iv(t,e))return!0;for(let a=0;a<e.length;a++)if(Tv(e[a],t,n))return!0}for(let a=0;a<t.length;a++)if(Tv(t[a],e,n))return!0;return!1}function Iv(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let a=t[n],c=t[n+1];for(let m=0;m<e.length-1;m++)if(QA(a,c,e[m],e[m+1]))return!0}return!1}function QA(t,e,n,a){return Sa(t,n,a)!==Sa(e,n,a)&&Sa(t,e,n)!==Sa(t,e,a)}function Tv(t,e,n){let a=n*n;if(e.length===1)return t.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(HC(t,e[c-1],e[c])<a)return!0;return!1}function HC(t,e,n){let a=e.distSqr(n);if(a===0)return t.distSqr(e);let c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function WC(t,e){let n,a,c,m=!1;for(let p=0;p<t.length;p++){n=t[p];for(let b=0,y=n.length-1;b<n.length;y=b++)a=n[b],c=n[y],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(m=!m)}return m}function $c(t,e){let n=!1;for(let a=0,c=t.length-1;a<t.length;c=a++){let m=t[a],p=t[c];m.y>e.y!=p.y>e.y&&e.x<(p.x-m.x)*(e.y-m.y)/(p.y-m.y)+m.x&&(n=!n)}return n}function GC(t,e,n,a,c){for(let p of t)if(e<=p.x&&n<=p.y&&a>=p.x&&c>=p.y)return!0;let m=[new xt(e,n),new xt(e,c),new xt(a,c),new xt(a,n)];if(t.length>2){for(let p of m)if($c(t,p))return!0}for(let p=0;p<t.length-1;p++)if(KA(t[p],t[p+1],m))return!0;return!1}function KA(t,e,n){let a=n[0],c=n[2];if(t.x<a.x&&e.x<a.x||t.x>c.x&&e.x>c.x||t.y<a.y&&e.y<a.y||t.y>c.y&&e.y>c.y)return!1;let m=Sa(t,e,n[0]);return m!==Sa(t,e,n[1])||m!==Sa(t,e,n[2])||m!==Sa(t,e,n[3])}function em(t,e,n,a,c,m){let p=e.y-t.y,b=t.x-e.x;if(m=m||0){let y=p*p+b*b;if(y===0)return!0;let w=Math.sqrt(y);p/=w,b/=w}return!((n.x-t.x)*p+(n.y-t.y)*b-m<0||(a.x-t.x)*p+(a.y-t.y)*b-m<0||(c.x-t.x)*p+(c.y-t.y)*b-m<0)}function Ev(t,e,n,a,c,m,p){return!(em(t,e,a,c,m,p)||em(e,n,a,c,m,p)||em(n,t,a,c,m,p)||em(a,c,t,e,n,p)||em(c,m,t,e,n,p)||em(m,a,t,e,n,p))}function tm(t,e,n){let a=e.paint.get(t).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Z_(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function qC(t,e,n,a,c){if(!e[0]&&!e[1])return t;let m=xt.convert(e)._mult(c);n==="viewport"&&m._rotate(-a);let p=[];for(let b=0;b<t.length;b++)p.push(t[b].sub(m));return p}function $C(t,e,n,a){let c=xt.convert(t)._mult(a);return e==="viewport"&&c._rotate(-n),c}ne(Mv,"CircleBucket",{omit:["layers"]});let JA=new qi({"circle-sort-key":new St(Pe.layout_circle["circle-sort-key"]),visibility:new Ke(Pe.layout_circle.visibility)});var eP={paint:new qi({"circle-radius":new St(Pe.paint_circle["circle-radius"]),"circle-color":new St(Pe.paint_circle["circle-color"]),"circle-blur":new St(Pe.paint_circle["circle-blur"]),"circle-opacity":new St(Pe.paint_circle["circle-opacity"]),"circle-translate":new Ke(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new St(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new St(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new St(Pe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ke(Pe.paint_circle["circle-emissive-strength"])}),layout:JA};class Dv{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){let c=i._.dot(n,this.dir);if(Math.abs(c)<1e-6)return!1;let m=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,a[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,n,a){if(i._.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;let[c,m,p]=this.dir,b=this.pos[0]-e[0],y=this.pos[1]-e[1],w=this.pos[2]-e[2],M=c*c+m*m+p*p,T=2*(b*c+y*m+w*p),E=T*T-4*M*(b*b+y*y+w*w-n*n);if(E<0){let P=Math.max(-T/2,0),R=b+c*P,F=y+m*P,B=w+p*P,W=Math.hypot(R,F,B);return a[0]=R*n/W,a[1]=F*n/W,a[2]=B*n/W,!1}{let P=(-T-Math.sqrt(E))/(2*M);if(P<0){let R=Math.hypot(b,y,w);return a[0]=b*n/R,a[1]=y*n/R,a[2]=w*n/R,!1}return a[0]=b+c*P,a[1]=y+m*P,a[2]=w+p*P,!0}}}class Av{constructor(e,n,a,c,m){this.TL=e,this.TR=n,this.BR=a,this.BL=c,this.horizon=m}static fromInvProjectionMatrix(e,n,a){let c=[-1,1,1],m=[1,1,1],p=[1,-1,1],b=[-1,-1,1],y=i._.transformMat4(c,c,e),w=i._.transformMat4(m,m,e),M=i._.transformMat4(p,p,e),T=i._.transformMat4(b,b,e);return new Av(y,w,M,T,n/a)}}function wf(t,e,n){let a=1/0,c=-1/0,m=[];for(let p of t){i._.sub(m,p,e);let b=i._.dot(m,n);a=Math.min(a,b),c=Math.max(c,b)}return[a,c]}function YC(t,e){let n=!0;for(let a=0;a<t.planes.length;a++){let c=t.planes[a],m=0;for(let p=0;p<e.length;p++)m+=i._.dot(c,e[p])+c[3]>=0;if(m===0)return 0;m!==e.length&&(n=!1)}return n?2:1}function ZC(t,e){for(let n of t.projections){let a=wf(e,t.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function XC(t,e){let n=0,a=[0,0,0,0];for(let c=0;c<t.length;c++)a[0]=t[c][0],a[1]=t[c][1],a[2]=t[c][2],a[3]=1,i.aA.dot(a,e)>=0&&n++;return n}class Pv{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Pn.fromPoints(this.points),this.projections=[],this.frustumEdges=[i._.sub([],this.points[2],this.points[3]),i._.sub([],this.points[0],this.points[3]),i._.sub([],this.points[4],this.points[0]),i._.sub([],this.points[5],this.points[1]),i._.sub([],this.points[6],this.points[2]),i._.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let c=[0,-a[2],a[1]],m=[a[2],0,-a[0]];this.projections.push({axis:c,projection:wf(this.points,this.points[0],c)}),this.projections.push({axis:m,projection:wf(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,n,a,c){let m=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let M=i.aA.transformMat4([],w,e),T=1/M[3]/n*m;return i.aA.mul(M,M,[T,T,c?1/M[3]:T,T])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let M=i._.sub([],p[w[0]],p[w[1]]),T=i._.sub([],p[w[2]],p[w[1]]),E=i._.normalize([],i._.cross([],M,T)),P=-i._.dot(E,p[w[1]]);return E.concat(P)}),y=[];for(let w=0;w<p.length;w++)y.push([p[w][0],p[w][1],p[w][2]]);return new Pv(y,b)}intersectsPrecise(e,n,a){for(let c=0;c<n.length;c++)if(!XC(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!XC(e,this.planes[c]))return 0;for(let c of a)for(let m of this.frustumEdges){let p=i._.cross([],c,m),b=i._.length(p);if(b===0)continue;i._.scale(p,p,1/b);let y=wf(this.points,this.points[0],p),w=wf(e,this.points[0],p);if(y[0]>w[1]||w[0]>y[1])return 0}return 1}}class Pn{static fromPoints(e){let n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let c of e)i._.min(n,n,c),i._.max(a,a,c);return new Pn(n,a)}static fromTileIdAndHeight(e,n,a){let c=1<<e.canonical.z,m=e.canonical.x,p=e.canonical.y;return new Pn([m/c,p/c,n],[(m+1)/c,(p+1)/c,a])}static applyTransform(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)i._.transformMat4(a[c],a[c],n);return Pn.fromPoints(a)}static projectAabbCorners(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)i._.transformMat4(a[c],a[c],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=i._.scale([],i._.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],a=i._.clone(this.min),c=i._.clone(this.max);for(let m=0;m<n.length;m++)a[m]=n[m]?this.min[m]:this.center[m],c[m]=n[m]?this.center[m]:this.max[m];return c[2]=this.max[2],new Pn(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?YC(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?YC(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?ZC(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?ZC(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ne(Pn,"Aabb");let tP=$i([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:X_}=tP,QC=$i([{name:"a_pos_3",components:3,type:"Int16"}]);var Cf=$i([{name:"a_pos",type:"Int16",components:2}]);function Q_(t){return t*bo/Ju}let iP=[new Pn([Ea,Ea,Ea],[Da,Da,Da]),new Pn([Ea,Ea,Ea],[0,0,Da]),new Pn([0,Ea,Ea],[Da,0,Da]),new Pn([Ea,0,Ea],[0,Da,Da]),new Pn([0,0,Ea],[Da,Da,Da])];function KC(t,e,n,a=!0){let c=i._.scale([],t._camera.position,t.worldSize),m=[e,n,1,1];i.aA.transformMat4(m,m,t.pixelMatrixInverse),i.aA.scale(m,m,1/m[3]);let p=i._.sub([],m,c),b=i._.normalize([],p),y=t.globeMatrix,w=[y[12],y[13],y[14]],M=i._.sub([],w,c),T=i._.length(M),E=i._.normalize([],M),P=t.worldSize/(2*Math.PI),R=i._.dot(E,b),F=Math.asin(P/T);if(F<Math.acos(R)){if(!a)return null;let ze=[],$e=[];i._.scale(ze,b,T/R),i._.normalize($e,i._.sub($e,ze,M)),i._.normalize(b,i._.add(b,M,i._.scale(b,$e,Math.tan(F)*T)))}let B=[];new Dv(c,b).closestPointOnSphere(w,P,B);let W=i._.normalize([],Gd(y,0)),J=i._.normalize([],Gd(y,1)),ee=i._.normalize([],Gd(y,2)),te=i._.dot(W,B),pe=i._.dot(J,B),he=i._.dot(ee,B),ve=Ur(Math.asin(-pe/P)),Ce=Ur(Math.atan2(te,he));Ce=t.center.lng+function(ze,$e){let rt=($e-ze+180)%360-180;return rt<-180?rt+360:rt}(t.center.lng,Ce);let De=Ns(Ce),Ue=pi(Vs(ve),0,1);return new Jr(De,Ue)}class nP{constructor(e,n,a){this.a=i._.sub([],e,a),this.b=i._.sub([],n,a),this.center=a;let c=i._.normalize([],this.a),m=i._.normalize([],this.b);this.angle=Math.acos(i._.dot(c,m))}}function Ov(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(a,c,m,p){let b=Math.sin(m);return a*(Math.sin((1-p)*m)/b)+c*(Math.sin(p*m)/b)}(t.a[e],t.b[e],t.angle,pi(n,0,1))+t.center[e]}function js(t){if(t.z<=1)return iP[t.z+2*t.y+t.x];let e=Rv(K_(t));return Pn.fromPoints(e)}function Al(t,e,n){return i._.scale(t,t,1-n),i._.scaleAndAdd(t,t,e,n)}function JC(t,e){let n=Pl(e.zoom);if(n===0)return js(t);let a=K_(t),c=Rv(a),m=Ns(a.getWest())*e.worldSize,p=Ns(a.getEast())*e.worldSize,b=Vs(a.getNorth())*e.worldSize,y=Vs(a.getSouth())*e.worldSize,w=[m,b,0],M=[p,b,0],T=[m,y,0],E=[p,y,0],P=i.ad.invert([],e.globeMatrix);return i._.transformMat4(w,w,P),i._.transformMat4(M,M,P),i._.transformMat4(T,T,P),i._.transformMat4(E,E,P),c[0]=Al(c[0],T,n),c[1]=Al(c[1],E,n),c[2]=Al(c[2],M,n),c[3]=Al(c[3],w,n),Pn.fromPoints(c)}function e2(t,e,n){for(let a of t)i._.transformMat4(a,a,e),i._.scale(a,a,n)}function t2(t,e,n,a){let c=e/t.worldSize,m=t.globeMatrix;if(n.z<=1){let De=js(n).getCorners();return e2(De,m,c),Pn.fromPoints(De)}let p=K_(n,a),b=Rv(p,bo+Q_(t._tileCoverLift));e2(b,m,c);let y=Number.MAX_VALUE,w=[-y,-y,-y],M=[y,y,y];if(p.contains(t.center)){for(let ze of b)i._.min(M,M,ze),i._.max(w,w,ze);w[2]=0;let De=t.point,Ue=[De.x*c,De.y*c,0];return i._.min(M,M,Ue),i._.max(w,w,Ue),new Pn(M,w)}if(t._tileCoverLift>0){for(let De of b)i._.min(M,M,De),i._.max(w,w,De);return new Pn(M,w)}let T=[m[12]*c,m[13]*c,m[14]*c],E=p.getCenter(),P=pi(t.center.lat,-Qn,Qn),R=pi(E.lat,-Qn,Qn),F=Ns(t.center.lng),B=Vs(P),W=F-Ns(E.lng),J=B-Vs(R);W>.5?W-=1:W<-.5&&(W+=1);let ee=0;if(Math.abs(W)>Math.abs(J))ee=W>=0?1:3;else{ee=J>=0?0:2;let De=[m[4]*c,m[5]*c,m[6]*c],Ue=-Math.sin(Ei(J>=0?p.getSouth():p.getNorth()))*bo;i._.scaleAndAdd(T,T,De,Ue)}let te=b[ee],pe=b[(ee+1)%4],he=new nP(te,pe,T),ve=[Ov(he,0)||te[0],Ov(he,1)||te[1],Ov(he,2)||te[2]],Ce=Pl(t.zoom);if(Ce>0){let De=function({x:ze,y:$e,z:rt},We,et,He,tt){let lt=1/(1<<rt),nt=ze*lt,Mt=nt+lt,ot=$e*lt,ht=ot+lt,Vt=0,Ft=(nt+Mt)/2-He;return Ft>.5?Vt=-1:Ft<-.5&&(Vt=1),nt=((nt+Vt)*We-(He*=We))*et+He,Mt=((Mt+Vt)*We-He)*et+He,ot=(ot*We-(tt*=We))*et+tt,ht=(ht*We-tt)*et+tt,[[nt,ht,0],[Mt,ht,0],[Mt,ot,0],[nt,ot,0]]}(n,e,t._pixelsPerMercatorPixel,F,B);for(let ze=0;ze<b.length;ze++)Al(b[ze],De[ze],Ce);let Ue=i._.add([],De[ee],De[(ee+1)%4]);i._.scale(Ue,Ue,.5),Al(ve,Ue,Ce)}for(let De of b)i._.min(M,M,De),i._.max(w,w,De);return M[2]=Math.min(te[2],pe[2]),i._.min(M,M,ve),i._.max(w,w,ve),new Pn(M,w)}function K_({x:t,y:e,z:n},a=!1){let c=1/(1<<n),m=new Li(Oo(t*c),e===(1<<n)-1&&a?-90:Dr((e+1)*c)),p=new Li(Oo((t+1)*c),e===0&&a?90:Dr(e*c));return new qc(m,p)}function Rv(t,e=bo){let n=Ei(t.getNorth()),a=Ei(t.getSouth()),c=Math.cos(n),m=Math.cos(a),p=Math.sin(n),b=Math.sin(a),y=t.getWest(),w=t.getEast();return[Ku(m,b,y,e),Ku(m,b,w,e),Ku(c,p,w,e),Ku(c,p,y,e)]}function Sf(t,e,n,a){let c=1<<n.z,m=(t/pt+n.x)/c;return Sh(Dr((e/pt+n.y)/c),Oo(m),a)}function J_({min:t,max:e}){return UA/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let i2=new Float64Array(16);function Mf(t){let e=J_(t),n=i.ad.fromScaling(i2,[e,e,e]);return i.ad.translate(n,n,i._.negate([],t.min))}function Lv(t){let e=i.ad.fromTranslation(i2,t.min),n=1/J_(t);return i.ad.scale(e,e,[n,n,n])}function Fv(t){let e=pt/(2*Math.PI);return t/(2*Math.PI)/e}function n2(t,e){return pt/(512*Math.pow(2,t))*J_(js(e))}function r2(t,e,n,a,c){let m=Fv(n),p=[t,e,-n/(2*Math.PI)],b=i.ad.identity(new Float64Array(16));return i.ad.translate(b,b,p),i.ad.scale(b,b,[m,m,m]),i.ad.rotateX(b,b,Ei(-c)),i.ad.rotateY(b,b,Ei(-a)),b}function Pl(t){return dl(bv,RC,t)}function o2(t,e){let n=Sh(e.lat,e.lng),a=function(m){let p=Sh(m._center.lat,m._center.lng),b=i._.fromValues(0,1,0),y=i._.cross([],b,p),w=i.ad.fromRotation([],-m.angle,p);y=i._.transformMat4(y,y,w),i.ad.fromRotation(w,-m._pitch,y);let M=i._.normalize([],p);return i._.scale(M,M,Q_(m.cameraToCenterDistance/m.pixelsPerMeter)),i._.transformMat4(M,M,w),i._.add([],p,M)}(t),c=i._.subtract([],a,n);return i._.angle(c,n)}function zv(t,e){return o2(t,e)>Math.PI/2*1.01}let a2=Ei(85),rP=Math.cos(a2),oP=Math.sin(a2),aP=i.ad.create(),s2=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function l2(t,e,n,a,c,m,p,b,y){if(m&&t.queryGeometry.isAboveHorizon)return!1;m&&(y*=t.pixelToTileUnitsFactor);let w=t.tileID.canonical,M=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(let T of e)for(let E of T){let P=E.add(b),R=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(P.x,P.y,!0):0,F=n.projection.projectTilePoint(P.x,P.y,w);if(R>0){let ee=n.projection.upVector(w,P.x,P.y);F.x+=ee[0]*M*R,F.y+=ee[1]*M*R,F.z+=ee[2]*M*R}let B=m?P:sP(F.x,F.y,F.z,a),W=m?t.tilespaceRays.map(ee=>cP(ee,R)):t.queryGeometry.screenGeometry,J=i.aA.transformMat4([],[F.x,F.y,F.z,1],a);if(!p&&m?y*=J[3]/n.cameraToCenterDistance:p&&!m&&(y*=n.cameraToCenterDistance/J[3]),m){let ee=Dr((E.y/pt+w.y)/(1<<w.z));y/=n.projection.pixelsPerMeter(ee,1)/yo(1,ee)}if(ZA(W,B,y))return!0}return!1}function sP(t,e,n,a){let c=i.aA.transformMat4([],[t,e,n,1],a);return new xt(c[0]/c[3],c[1]/c[3])}let c2=i._.fromValues(0,0,0),lP=i._.fromValues(0,0,1);function cP(t,e){let n=i._.create();return c2[2]=e,t.intersectsPlane(c2,lP,n),new xt(n[0],n[1])}class d2 extends Mv{}function h2(t,{width:e,height:n},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*a);return t.width=e,t.height=n,t.data=c,t}function u2(t,e,n){let{width:a,height:c}=e;a===t.width&&c===t.height||(Bv(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,c)},n,null),t.width=a,t.height=c,t.data=e.data)}function Bv(t,e,n,a,c,m,p,b){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,w=e.data,M=m===4&&b;for(let T=0;T<c.height;T++){let E=((n.y+T)*t.width+n.x)*m,P=((a.y+T)*e.width+a.x)*m;if(M)for(let R=0;R<c.width;R++){let F=E+R*m+3,B=P+R*m;w[B+0]=255,w[B+1]=255,w[B+2]=255,w[B+3]=y[F]}else if(p)for(let R=0;R<c.width;R++){let F=E+R*m,B=P+R*m,W=y[F+3],J=new Bi(y[F+0]/255*W,y[F+1]/255*W,y[F+2]/255*W,W).toRenderColor(p).toArray();w[B+0]=J[0],w[B+1]=J[1],w[B+2]=J[2],w[B+3]=J[3]}else for(let R=0;R<c.width*m;R++)w[P+R]=y[E+R]}return e}ne(d2,"HeatmapBucket",{omit:["layers"]});class Yc{constructor(e,n){h2(this,e,1,n)}resize(e){u2(this,new Yc(e),1)}clone(){return new Yc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,m){Bv(e,n,a,c,m,1,null)}}class ma{constructor(e,n){h2(this,e,4,n)}resize(e){u2(this,new ma(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ma({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,m,p,b){Bv(e,n,a,c,m,4,p,b)}}class m2{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}ne(Yc,"AlphaImage"),ne(ma,"RGBAImage");let dP=new qi({visibility:new Ke(Pe.layout_heatmap.visibility)});var hP={paint:new qi({"heatmap-radius":new St(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new St(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Dn(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(Pe.paint_heatmap["heatmap-opacity"])}),layout:dP};function kf(t){let e={},n=t.resolution||256,a=t.clips?t.clips.length:1,c=t.image||new ma({width:n,height:a}),m=(p,b,y)=>{e[t.evaluationKey]=y;let w=t.expression.evaluate(e);w&&(c.data[p+b+0]=Math.floor(255*w.r/w.a),c.data[p+b+1]=Math.floor(255*w.g/w.a),c.data[p+b+2]=Math.floor(255*w.b/w.a),c.data[p+b+3]=Math.floor(255*w.a))};if(t.clips)for(let p=0,b=0;p<a;++p,b+=4*n)for(let y=0,w=0;y<n;y++,w+=4){let M=y/(n-1),{start:T,end:E}=t.clips[p];m(b,w,T*(1-M)+E*M)}else for(let p=0,b=0;p<n;p++,b+=4)m(0,b,p/(n-1));return c}let uP=new qi({visibility:new Ke(Pe.layout_hillshade.visibility)});var mP={paint:new qi({"hillshade-illumination-direction":new Ke(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(Pe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ke(Pe.paint_hillshade["hillshade-emissive-strength"])}),layout:uP};let pP=$i([{name:"a_pos",components:2,type:"Int16"}],4),{members:fP}=pP;function If(t,e,n=2){let a=e&&e.length,c=a?e[0]*n:t.length,m=p2(t,0,c,n,!0),p=[];if(!m||m.next===m.prev)return p;let b,y,w;if(a&&(m=function(M,T,E,P){let R=[];for(let F=0,B=T.length;F<B;F++){let W=p2(M,T[F]*P,F<B-1?T[F+1]*P:M.length,P,!1);W===W.next&&(W.steiner=!0),R.push(CP(W))}R.sort(vP);for(let F=0;F<R.length;F++)E=xP(R[F],E);return E}(t,e,m,n)),t.length>80*n){b=1/0,y=1/0;let M=-1/0,T=-1/0;for(let E=n;E<c;E+=n){let P=t[E],R=t[E+1];P<b&&(b=P),R<y&&(y=R),P>M&&(M=P),R>T&&(T=R)}w=Math.max(M-b,T-y),w=w!==0?32767/w:0}return Tf(m,p,n,b,y,w,0),p}function p2(t,e,n,a,c){let m;if(c===function(p,b,y,w){let M=0;for(let T=b,E=y-w;T<y;T+=w)M+=(p[E]-p[T])*(p[T+1]+p[E+1]),E=T;return M}(t,e,n,a)>0)for(let p=e;p<n;p+=a)m=_2(p/a|0,t[p],t[p+1],m);else for(let p=n-a;p>=e;p-=a)m=_2(p/a|0,t[p],t[p+1],m);return m&&e0(m,m.next)&&(Df(m),m=m.next),m}function Ih(t,e){if(!t)return t;e||(e=t);let n,a=t;do if(n=!1,a.steiner||!e0(a,a.next)&&mr(a.prev,a,a.next)!==0)a=a.next;else{if(Df(a),a=e=a.prev,a===a.next)break;n=!0}while(n||a!==e);return e}function Tf(t,e,n,a,c,m,p){if(!t)return;!p&&m&&function(y,w,M,T){let E=y;do E.z===0&&(E.z=Nv(E.x,E.y,w,M,T)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==y);E.prevZ.nextZ=null,E.prevZ=null,function(P){let R,F=1;do{let B,W=P;P=null;let J=null;for(R=0;W;){R++;let ee=W,te=0;for(let he=0;he<F&&(te++,ee=ee.nextZ,ee);he++);let pe=F;for(;te>0||pe>0&&ee;)te!==0&&(pe===0||!ee||W.z<=ee.z)?(B=W,W=W.nextZ,te--):(B=ee,ee=ee.nextZ,pe--),J?J.nextZ=B:P=B,B.prevZ=J,J=B;W=ee}J.nextZ=null,F*=2}while(R>1)}(E)}(t,a,c,m);let b=t;for(;t.prev!==t.next;){let y=t.prev,w=t.next;if(m?_P(t,a,c,m):gP(t))e.push(y.i,t.i,w.i),Df(t),t=w.next,b=w.next;else if((t=w)===b){p?p===1?Tf(t=bP(Ih(t),e),e,n,a,c,m,2):p===2&&yP(t,e,n,a,c,m):Tf(Ih(t),e,n,a,c,m,1);break}}}function gP(t){let e=t.prev,n=t,a=t.next;if(mr(e,n,a)>=0)return!1;let c=e.x,m=n.x,p=a.x,b=e.y,y=n.y,w=a.y,M=c<m?c<p?c:p:m<p?m:p,T=b<y?b<w?b:w:y<w?y:w,E=c>m?c>p?c:p:m>p?m:p,P=b>y?b>w?b:w:y>w?y:w,R=a.next;for(;R!==e;){if(R.x>=M&&R.x<=E&&R.y>=T&&R.y<=P&&im(c,b,m,y,p,w,R.x,R.y)&&mr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function _P(t,e,n,a){let c=t.prev,m=t,p=t.next;if(mr(c,m,p)>=0)return!1;let b=c.x,y=m.x,w=p.x,M=c.y,T=m.y,E=p.y,P=b<y?b<w?b:w:y<w?y:w,R=M<T?M<E?M:E:T<E?T:E,F=b>y?b>w?b:w:y>w?y:w,B=M>T?M>E?M:E:T>E?T:E,W=Nv(P,R,e,n,a),J=Nv(F,B,e,n,a),ee=t.prevZ,te=t.nextZ;for(;ee&&ee.z>=W&&te&&te.z<=J;){if(ee.x>=P&&ee.x<=F&&ee.y>=R&&ee.y<=B&&ee!==c&&ee!==p&&im(b,M,y,T,w,E,ee.x,ee.y)&&mr(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,te.x>=P&&te.x<=F&&te.y>=R&&te.y<=B&&te!==c&&te!==p&&im(b,M,y,T,w,E,te.x,te.y)&&mr(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;ee&&ee.z>=W;){if(ee.x>=P&&ee.x<=F&&ee.y>=R&&ee.y<=B&&ee!==c&&ee!==p&&im(b,M,y,T,w,E,ee.x,ee.y)&&mr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;te&&te.z<=J;){if(te.x>=P&&te.x<=F&&te.y>=R&&te.y<=B&&te!==c&&te!==p&&im(b,M,y,T,w,E,te.x,te.y)&&mr(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function bP(t,e){let n=t;do{let a=n.prev,c=n.next.next;!e0(a,c)&&f2(a,n,n.next,c)&&Ef(a,c)&&Ef(c,a)&&(e.push(a.i,n.i,c.i),Df(n),Df(n.next),n=t=c),n=n.next}while(n!==t);return Ih(n)}function yP(t,e,n,a,c,m){let p=t;do{let b=p.next.next;for(;b!==p.prev;){if(p.i!==b.i&&SP(p,b)){let y=g2(p,b);return p=Ih(p,p.next),y=Ih(y,y.next),Tf(p,e,n,a,c,m,0),void Tf(y,e,n,a,c,m,0)}b=b.next}p=p.next}while(p!==t)}function vP(t,e){return t.x-e.x}function xP(t,e){let n=function(c,m){let p=m,b=c.x,y=c.y,w,M=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){let F=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=b&&F>M&&(M=F,w=p.x<p.next.x?p:p.next,F===b))return w}p=p.next}while(p!==m);if(!w)return null;let T=w,E=w.x,P=w.y,R=1/0;p=w;do{if(b>=p.x&&p.x>=E&&b!==p.x&&im(y<P?b:M,y,E,P,y<P?M:b,y,p.x,p.y)){let F=Math.abs(y-p.y)/(b-p.x);Ef(p,c)&&(F<R||F===R&&(p.x>w.x||p.x===w.x&&wP(w,p)))&&(w=p,R=F)}p=p.next}while(p!==T);return w}(t,e);if(!n)return e;let a=g2(n,t);return Ih(a,a.next),Ih(n,n.next)}function wP(t,e){return mr(t.prev,t,e.prev)<0&&mr(e.next,t,t.next)<0}function Nv(t,e,n,a,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function CP(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function im(t,e,n,a,c,m,p,b){return(c-p)*(e-b)>=(t-p)*(m-b)&&(t-p)*(a-b)>=(n-p)*(e-b)&&(n-p)*(m-b)>=(c-p)*(a-b)}function SP(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,a){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==a.i&&c.next.i!==a.i&&f2(c,c.next,n,a))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(Ef(t,e)&&Ef(e,t)&&function(n,a){let c=n,m=!1,p=(n.x+a.x)/2,b=(n.y+a.y)/2;do c.y>b!=c.next.y>b&&c.next.y!==c.y&&p<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(t,e)&&(mr(t.prev,t,e.prev)||mr(t,e.prev,e))||e0(t,e)&&mr(t.prev,t,t.next)>0&&mr(e.prev,e,e.next)>0)}function mr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function e0(t,e){return t.x===e.x&&t.y===e.y}function f2(t,e,n,a){let c=i0(mr(t,e,n)),m=i0(mr(t,e,a)),p=i0(mr(n,a,t)),b=i0(mr(n,a,e));return c!==m&&p!==b||!(c!==0||!t0(t,n,e))||!(m!==0||!t0(t,a,e))||!(p!==0||!t0(n,t,a))||!(b!==0||!t0(n,e,a))}function t0(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function i0(t){return t>0?1:t<0?-1:0}function Ef(t,e){return mr(t.prev,t,t.next)<0?mr(t,e,t.next)>=0&&mr(t,t.prev,e)>=0:mr(t,e,t.prev)<0||mr(t,t.next,e)<0}function g2(t,e){let n=Vv(t.i,t.x,t.y),a=Vv(e.i,e.x,e.y),c=t.next,m=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,a.next=n,n.prev=a,m.next=a,a.prev=m,a}function _2(t,e,n,a){let c=Vv(t,e,n);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Df(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Vv(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function n0(t,e){let n=t.length;if(n<=1)return[t];let a=[],c,m;for(let p=0;p<n;p++){let b=Xr(t[p]);b!==0&&(t[p].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(c&&a.push(c),c=[t[p]]):c.push(t[p]))}if(c&&a.push(c),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(By(a[p],e,1,a[p].length-1,MP),a[p]=a[p].slice(0,e));return a}function MP(t,e){return e.area-t.area}function jv(t,e,n){let a=n.patternDependencies,c=!1;for(let m of e){let p=m.paint.get(`${t}-pattern`);p.isConstant()||(c=!0);let b=p.constantOr(null);b&&(c=!0,a[b]=!0)}return c}function Uv(t,e,n,a,c){let m=c.patternDependencies;for(let p of e){let b=p.paint.get(`${t}-pattern`).value;if(b.kind!=="constant"){let y=b.evaluate({zoom:a},n,{},c.availableImages);y=y&&y.name?y.name:y,m[y]=!0,n.patterns[p.id]=y}}return n}class r0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new es,this.indexArray=new wr,this.indexArray2=new Hc,this.programConfigurations=new Gc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new An,this.segments2=new An,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,a,c){this.hasPattern=jv("fill",this.layers,n);let m=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:b,id:y,index:w,sourceLayerIndex:M}of e){let T=this.layers[0]._featureFilter.needGeometry,E=Dl(b,T);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),E,a))continue;let P=m?m.evaluate(E,{},a,n.availableImages):void 0,R={id:y,properties:b.properties,type:b.type,sourceLayerIndex:M,index:w,geometry:T?E.geometry:is(b,a,c),patterns:{},sortKey:P};p.push(R)}m&&p.sort((b,y)=>b.sortKey-y.sortKey);for(let b of p){let{geometry:y,index:w,sourceLayerIndex:M}=b;if(this.hasPattern){let T=Uv("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(T)}else this.addFeature(b,y,w,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[w].feature,y,w,M,this.index)}}update(e,n,a,c,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,c,m)}addFeatures(e,n,a,c,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,a,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,c,m,p=[],b){for(let y of n0(n,500)){let w=0;for(let F of y)w+=F.length;let M=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),T=M.vertexLength,E=[],P=[];for(let F of y){if(F.length===0)continue;F!==y[0]&&P.push(E.length/2);let B=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),W=B.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(W+F.length-1,W),E.push(F[0].x),E.push(F[0].y);for(let J=1;J<F.length;J++)this.layoutVertexArray.emplaceBack(F[J].x,F[J].y),this.indexArray2.emplaceBack(W+J-1,W+J),E.push(F[J].x),E.push(F[J].y);B.vertexLength+=F.length,B.primitiveLength+=F.length}let R=If(E,P);for(let F=0;F<R.length;F+=3)this.indexArray.emplaceBack(T+R[F],T+R[F+1],T+R[F+2]);M.vertexLength+=w,M.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,p,c,b)}}ne(r0,"FillBucket",{omit:["layers","patternFeatures"]});let kP=new qi({"fill-sort-key":new St(Pe.layout_fill["fill-sort-key"]),visibility:new Ke(Pe.layout_fill.visibility)});var IP={paint:new qi({"fill-antialias":new Ke(Pe.paint_fill["fill-antialias"]),"fill-opacity":new St(Pe.paint_fill["fill-opacity"]),"fill-color":new St(Pe.paint_fill["fill-color"]),"fill-outline-color":new St(Pe.paint_fill["fill-outline-color"]),"fill-translate":new Ke(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new St(Pe.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ke(Pe.paint_fill["fill-emissive-strength"])}),layout:kP};class Hv{constructor(e,n,a,c){if(this.triangleCount=n.length/3,this.min=new xt(0,0),this.max=new xt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[m,p]=[e[0].clone(),e[0].clone()];for(let T=1;T<e.length;++T){let E=e[T];m.x=Math.min(m.x,E.x),m.y=Math.min(m.y,E.y),p.x=Math.max(p.x,E.x),p.y=Math.max(p.y,E.y)}if(c){let T=Math.ceil(Math.max(p.x-m.x,p.y-m.y)/c);a=Math.max(a,T)}if(a===0)return;this.min=m,this.max=p;let b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);let y=Math.max(b.x,b.y)/a;this.cellsX=Math.max(1,Math.ceil(b.x/y)),this.cellsY=Math.max(1,Math.ceil(b.y/y)),this.xScale=1/y,this.yScale=1/y;let w=[];for(let T=0;T<this.triangleCount;T++){let E=e[n[3*T+0]].sub(this.min),P=e[n[3*T+1]].sub(this.min),R=e[n[3*T+2]].sub(this.min),F=Us(Math.floor(Math.min(E.x,P.x,R.x)),this.xScale,this.cellsX),B=Us(Math.floor(Math.max(E.x,P.x,R.x)),this.xScale,this.cellsX),W=Us(Math.floor(Math.min(E.y,P.y,R.y)),this.yScale,this.cellsY),J=Us(Math.floor(Math.max(E.y,P.y,R.y)),this.yScale,this.cellsY),ee=new xt(0,0),te=new xt(0,0),pe=new xt(0,0),he=new xt(0,0);for(let ve=W;ve<=J;++ve){ee.y=te.y=ve*y,pe.y=he.y=(ve+1)*y;for(let Ce=F;Ce<=B;++Ce)ee.x=pe.x=Ce*y,te.x=he.x=(Ce+1)*y,(Ev(E,P,R,ee,te,he)||Ev(E,P,R,ee,he,pe))&&w.push({cellIdx:ve*this.cellsX+Ce,triIdx:T})}}if(w.length===0)return;w.sort((T,E)=>T.cellIdx-E.cellIdx||T.triIdx-E.triIdx);let M=0;for(;M<w.length;){let T=w[M].cellIdx,E={start:this.payload.length,len:0};for(;M<w.length&&w[M].cellIdx===T;)++E.len,this.payload.push(w[M++].triIdx);this.cells[T]=E}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let a=Us(e.x-this.min.x,this.xScale,this.cellsX),c=Us(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[c*this.cellsX+a];if(m){this._lazyInitLookup();for(let p=0;p<m.len;p++){let b=this.payload[m.start+p],y=Math.floor(b/8),w=1<<b%8;if(!(this.lookup[y]&w)&&(this.lookup[y]|=w,n.push(b),n.length===this.triangleCount))return}}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();let c=Us(e.x-this.min.x,this.xScale,this.cellsX),m=Us(n.x-this.min.x,this.xScale,this.cellsX),p=Us(e.y-this.min.y,this.yScale,this.cellsY),b=Us(n.y-this.min.y,this.yScale,this.cellsY);for(let y=p;y<=b;y++)for(let w=c;w<=m;w++){let M=this.cells[y*this.cellsX+w];if(M)for(let T=0;T<M.len;T++){let E=this.payload[M.start+T],P=Math.floor(E/8),R=1<<E%8;if(!(this.lookup[P]&R)&&(this.lookup[P]|=R,a.push(E),a.length===this.triangleCount))return}}}}function Us(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}ne(Hv,"TriangleGridIndex");class b2{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(let a of this.footprints)n.push({footprint:a,id:e})}populate(e,n,a,c){let m=[];for(let{feature:p,id:b,index:y,sourceLayerIndex:w}of e){let M=this.layers[0]._featureFilter.needGeometry,T=Dl(p,M);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),T,a))continue;let E={id:b,properties:p.properties,type:p.type,sourceLayerIndex:w,index:y,geometry:M?T.geometry:is(p,a,c),patterns:{}};m.push(E)}for(let p of m){let{geometry:b,index:y,sourceLayerIndex:w}=p;this.addFeature(p,b,y,a,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,b,y,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,a,c,m){}destroy(){}addFeature(e,n,a,c,m,p=[],b){for(let y of n0(n,2)){let w=[],M=[],T=[],E=new xt(1/0,1/0),P=new xt(-1/0,-1/0);for(let B of y)if(B.length!==0){B!==y[0]&&T.push(M.length/2);for(let W=0;W<B.length;W++)M.push(B[W].x),M.push(B[W].y),w.push(B[W]),E.x=Math.min(E.x,B[W].x),E.y=Math.min(E.y,B[W].y),P.x=Math.max(P.x,B[W].x),P.y=Math.max(P.y,B[W].y)}let R=If(M,T),F=new Hv(w,R,8,256);this.footprints.push({vertices:w,indices:R,grid:F,min:E,max:P})}}}ne(b2,"ClipBucket",{omit:["layers"]});let TP=new qi({"clip-layer-types":new Ke(Pe.layout_clip["clip-layer-types"])});var EP={paint:new qi({}),layout:TP};let DP=$i([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),AP=$i([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),PP=$i([{name:"a_centroid_pos",components:2,type:"Uint16"}]),OP=$i([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),RP=$i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:LP}=DP;var o0={},FP=du,y2=nm;function nm(t,e,n,a,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=c,t.readFields(zP,this,e)}function zP(t,e,n){t==1?e.id=n.readVarint():t==2?function(a,c){for(var m=a.readVarint()+a.pos;a.pos<m;){var p=c._keys[a.readVarint()],b=c._values[a.readVarint()];c.properties[p]=b}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function BP(t){for(var e,n,a=0,c=0,m=t.length,p=m-1;c<m;p=c++)a+=((n=t[p]).x-(e=t[c]).x)*(e.y+n.y);return a}nm.types=["Unknown","Point","LineString","Polygon"],nm.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,a=1,c=0,m=0,p=0,b=[];t.pos<n;){if(c<=0){var y=t.readVarint();a=7&y,c=y>>3}if(c--,a===1||a===2)m+=t.readSVarint(),p+=t.readSVarint(),a===1&&(e&&b.push(e),e=[]),e.push(new FP(m,p));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&b.push(e),b},nm.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,a=0,c=0,m=0,p=1/0,b=-1/0,y=1/0,w=-1/0;t.pos<e;){if(a<=0){var M=t.readVarint();n=7&M,a=M>>3}if(a--,n===1||n===2)(c+=t.readSVarint())<p&&(p=c),c>b&&(b=c),(m+=t.readSVarint())<y&&(y=m),m>w&&(w=m);else if(n!==7)throw new Error("unknown command "+n)}return[p,y,b,w]},nm.prototype.toGeoJSON=function(t,e,n){var a,c,m=this.extent*Math.pow(2,n),p=this.extent*t,b=this.extent*e,y=this.loadGeometry(),w=nm.types[this.type];function M(P){for(var R=0;R<P.length;R++){var F=P[R];P[R]=[360*(F.x+p)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(a=0;a<y.length;a++)T[a]=y[a][0];M(y=T);break;case 2:for(a=0;a<y.length;a++)M(y[a]);break;case 3:for(y=function(P){var R=P.length;if(R<=1)return[P];for(var F,B,W=[],J=0;J<R;J++){var ee=BP(P[J]);ee!==0&&(B===void 0&&(B=ee<0),B===ee<0?(F&&W.push(F),F=[P[J]]):F.push(P[J]))}return F&&W.push(F),W}(y),a=0;a<y.length;a++)for(c=0;c<y[a].length;c++)M(y[a][c])}y.length===1?y=y[0]:w="Multi"+w;var E={type:"Feature",geometry:{type:w,coordinates:y},properties:this.properties};return"id"in this&&(E.id=this.id),E};var NP=y2,v2=x2;function x2(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(VP,this,e),this.length=this._features.length}function VP(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(a){for(var c=null,m=a.readVarint()+a.pos;a.pos<m;){var p=a.readVarint()>>3;c=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return c}(n))}x2.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new NP(this._pbf,e,this.extent,this._keys,this._values)};var jP=v2;function UP(t,e,n){if(t===3){var a=new jP(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var Wv=o0.VectorTile=function(t,e){this.layers=t.readFields(UP,{},e)},a0=o0.VectorTileFeature=y2;o0.VectorTileLayer=v2;class Th extends xt{constructor(e,n,a){super(e,n),this.z=a}}class w2 extends Th{constructor(e,n,a,c){super(e,n,a),this.w=c}}function s0(t,e,n,a){let c=[],m=a===0?(p,b,y,w,M,T)=>{p.push(new xt(T,y+(T-b)/(w-b)*(M-y)))}:(p,b,y,w,M,T)=>{p.push(new xt(b+(T-y)/(M-y)*(w-b),T))};for(let p of t){let b=[];for(let y of p){if(y.length<=2)continue;let w=[];for(let E=0;E<y.length-1;E++){let P=y[E].x,R=y[E].y,F=y[E+1].x,B=y[E+1].y,W=a===0?P:R,J=a===0?F:B;W<e?J>e&&m(w,P,R,F,B,e):W>n?J<n&&m(w,P,R,F,B,n):w.push(y[E]),J<e&&W>=e&&m(w,P,R,F,B,e),J>n&&W<=n&&m(w,P,R,F,B,n)}let M=y[y.length-1],T=a===0?M.x:M.y;T>=e&&T<=n&&w.push(M),w.length&&(M=w[w.length-1],w[0].x===M.x&&w[0].y===M.y||w.push(w[0]),b.push(w))}b.length&&c.push(b)}return c}function C2(t,e,n,a){let c=n==="x"?"y":"x",m=(a-t[n])/(e[n]-t[n]);t[c]=t[c]+(e[c]-t[c])*m,t[n]=a,t.hasOwnProperty("z")&&(t.z=Wt(t.z,e.z,m)),t.hasOwnProperty("w")&&(t.w=Wt(t.w,e.w,m))}function S2(t,e,n,a){let c=n,m=a;for(let p of["x","y"]){let b=t,y=e;b[p]>=y[p]&&(b=e,y=t),b[p]<c&&y[p]>c&&C2(b,y,p,c),b[p]<m&&y[p]>m&&C2(y,b,p,m)}}function l0(t,e){return t.x-e.x||t.y-e.y}function M2(t,e){return l0(t.min,e.min)===0&&l0(t.max,e.max)===0}function Gv(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function qv(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!M2(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask)return!1;return!0}function k2(t,e,n){let a=1/pt,c=1/(1<<n.canonical.z),m=(e.x*a+n.canonical.x)*c+n.wrap,p=(e.y*a+n.canonical.y)*c;return{min:new xt((t.x*a+n.canonical.x)*c+n.wrap,(t.y*a+n.canonical.y)*c),max:new xt(m,p)}}function HP(t,e,n){let a=1<<n.canonical.z,c=((e.x-n.wrap)*a-n.canonical.x)*pt,m=(e.y*a-n.canonical.y)*pt;return{min:new xt(((t.x-n.wrap)*a-n.canonical.x)*pt,(t.y*a-n.canonical.y)*pt),max:new xt(c,m)}}function I2(t,e,n,a,c,m,p){let b=t.indices,y=t.vertices,w=[];for(let M=a;M<a+c;M+=3){let T=e[n[M+0]+m],E=e[n[M+1]+m],P=e[n[M+2]+m],R=Math.min(T.x,E.x,P.x),F=Math.max(T.x,E.x,P.x),B=Math.min(T.y,E.y,P.y),W=Math.max(T.y,E.y,P.y);w.length=0,t.grid.query(new xt(R,B),new xt(F,W),w);for(let J=0;J<w.length;J++){let ee=w[J];if(Ev(y[b[3*ee+0]],y[b[3*ee+1]],y[b[3*ee+2]],T,E,P,p))return!0}}return!1}function T2(t,e,n,a){if(!t||!n)return!1;let c=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<t.vertices.length)return T2(n,a,t,e);let m=e.canonical,p=a.canonical,b=Math.pow(2,p.z-m.z);c=t.vertices.map(y=>new xt((y.x+m.x*pt)*b-p.x*pt,(y.y+m.y*pt)*b-p.y*pt))}return I2(n,c,t.indices,0,t.indices.length,0,0)}function E2(t,e,n,a){let c=Math.pow(2,a.z-n.z);return new xt((t+n.x*pt)*c-a.x*pt,(e+n.y*pt)*c-a.y*pt)}function D2(t,e){let n=[];e.footprint.grid.queryPoint(t,n);let a=e.footprint.indices,c=e.footprint.vertices;for(let m=0;m<n.length;m++){let p=n[m];if($c([c[a[3*p+0]],c[a[3*p+1]],c[a[3*p+2]]],t))return!0}return!1}class A2{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function P2(t,e,n,a){let c=0,m=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(n[p]<t[p]||n[p]>e[p])return null}else{let b=1/a[p],y=(t[p]-n[p])*b,w=(e[p]-n[p])*b;if(y>w){let M=y;y=w,w=M}if(y>c&&(c=y),w<m&&(m=w),c>m)return null}return c}function O2(t,e,n,a,c,m,p,b,y,w,M){let T=a-t,E=c-e,P=m-n,R=p-t,F=b-e,B=y-n,W=M[1]*B-M[2]*F,J=M[2]*R-M[0]*B,ee=M[0]*F-M[1]*R,te=T*W+E*J+P*ee;if(Math.abs(te)<1e-15)return null;let pe=1/te,he=w[0]-t,ve=w[1]-e,Ce=w[2]-n,De=(he*W+ve*J+Ce*ee)*pe;if(De<0||De>1)return null;let Ue=ve*P-Ce*E,ze=Ce*T-he*P,$e=he*E-ve*T,rt=(M[0]*Ue+M[1]*ze+M[2]*$e)*pe;return rt<0||De+rt>1?null:(R*Ue+F*ze+B*$e)*pe}function R2(t,e,n){return(t-e)/(n-e)}function L2(t,e,n,a,c,m,p,b,y){let w=1<<n,M=m-a,T=p-c,E=(t+1)/w*M+a,P=(e+0)/w*T+c,R=(e+1)/w*T+c;b[0]=(t+0)/w*M+a,b[1]=P,y[0]=E,y[1]=R}class F2{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(m){let p=Math.ceil(Math.log2(m.dim/8)),b=[],y=Math.ceil(Math.pow(2,p)),w=1/y,M=(P,R,F,B,W)=>{let J=B?1:0,ee=(P+1)*F-J,te=R*F,pe=(R+1)*F-J;W[0]=P*F,W[1]=te,W[2]=ee,W[3]=pe},T=new A2(y),E=[];for(let P=0;P<y*y;P++){M(P%y,Math.floor(P/y),w,!1,E);let R=Zc(E[0],E[1],m),F=Zc(E[2],E[1],m),B=Zc(E[2],E[3],m),W=Zc(E[0],E[3],m);T.minimums.push(Math.min(R,F,B,W)),T.maximums.push(Math.max(R,F,B,W)),T.leaves.push(1)}for(b.push(T),y/=2;y>=1;y/=2){let P=b[b.length-1];T=new A2(y);for(let R=0;R<y*y;R++){M(R%y,Math.floor(R/y),2,!0,E);let F=P.getElevation(E[0],E[1]),B=P.getElevation(E[2],E[1]),W=P.getElevation(E[2],E[3]),J=P.getElevation(E[0],E[3]),ee=P.isLeaf(E[0],E[1]),te=P.isLeaf(E[2],E[1]),pe=P.isLeaf(E[2],E[3]),he=P.isLeaf(E[0],E[3]),ve=Math.min(F.min,B.min,W.min,J.min),Ce=Math.max(F.max,B.max,W.max,J.max),De=ee&&te&&pe&&he;T.maximums.push(Ce),T.minimums.push(ve),T.leaves.push(Ce-ve<=5&&De?1:0)}b.push(T)}return b}(this.dem),a=n.length-1,c=n[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,c,m,p,b=1){return P2([e,n,-100],[a,c,this.maximums[0]*b],m,p)}raycast(e,n,a,c,m,p,b=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,a,c,m,p,b);if(y==null)return null;let w=[],M=[],T=[],E=[],P=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;P.length>0;){let{idx:R,t:F,nodex:B,nodey:W,depth:J}=P.pop();if(this.leaves[R]){L2(B,W,J,e,n,a,c,T,E);let te=1<<J,pe=(B+0)/te,he=(B+1)/te,ve=(W+0)/te,Ce=(W+1)/te,De=Zc(pe,ve,this.dem)*b,Ue=Zc(he,ve,this.dem)*b,ze=Zc(he,Ce,this.dem)*b,$e=Zc(pe,Ce,this.dem)*b,rt=O2(T[0],T[1],De,E[0],T[1],Ue,E[0],E[1],ze,m,p),We=O2(E[0],E[1],ze,T[0],E[1],$e,T[0],T[1],De,m,p),et=Math.min(rt!==null?rt:Number.MAX_VALUE,We!==null?We:Number.MAX_VALUE);if(et!==Number.MAX_VALUE)return et;{let He=i._.scaleAndAdd([],m,p,F);if(z2(De,Ue,$e,ze,R2(He[0],T[0],E[0]),R2(He[1],T[1],E[1]))>=He[2])return F}continue}let ee=0;for(let te=0;te<this._siblingOffset.length;te++){L2((B<<1)+this._siblingOffset[te][0],(W<<1)+this._siblingOffset[te][1],J+1,e,n,a,c,T,E),T[2]=-100,E[2]=this.maximums[this.childOffsets[R]+te]*b;let pe=P2(T,E,m,p);if(pe!=null){let he=pe;w[te]=he;let ve=!1;for(let Ce=0;Ce<ee&&!ve;Ce++)he>=w[M[Ce]]&&(M.splice(Ce,0,te),ve=!0);ve||(M[ee]=te),ee++}}for(let te=0;te<ee;te++){let pe=M[te];P.push({idx:this.childOffsets[R]+pe,t:w[pe],nodex:(B<<1)+this._siblingOffset[pe][0],nodey:(W<<1)+this._siblingOffset[pe][1],depth:J+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,c,m){if(e[c].isLeaf(n,a)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let p=c-1,b=e[p],y=0,w=0;for(let M=0;M<this._siblingOffset.length;M++){let T=2*n+this._siblingOffset[M][0],E=2*a+this._siblingOffset[M][1],P=b.getElevation(T,E),R=b.isLeaf(T,E),F=this._addNode(P.min,P.max,R);R&&(y|=1<<M),w||(w=F)}for(let M=0;M<this._siblingOffset.length;M++)y&1<<M||this._construct(e,2*n+this._siblingOffset[M][0],2*a+this._siblingOffset[M][1],p,w+M)}}function z2(t,e,n,a,c,m){return Wt(Wt(t,n,m),Wt(e,a,m),c)}function Zc(t,e,n){let a=n.dim,c=pi(t*a-.5,0,a-1),m=pi(e*a-.5,0,a-1),p=Math.floor(c),b=Math.floor(m),y=Math.min(p+1,a-1),w=Math.min(b+1,a-1);return z2(n.get(p,b),n.get(y,b),n.get(p,w),n.get(y,w),c-p,m-b)}let WP={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function GP(t,e,n){return(256*t*256+256*e+n)/10-1e4}function qP(t,e,n){return 256*t+e+n/256-32768}class c0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Zn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let m=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let y=0;y<m;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(m,y)]=p[this._idx(m-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,m)]=p[this._idx(y,m-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(m,-1)]=p[this._idx(m-1,0)],p[this._idx(-1,m)]=p[this._idx(0,m-1)],p[this._idx(m,m)]=p[this._idx(m-1,m-1)]}let b=a==="terrarium"?qP:GP;for(let y=0;y<p.length;++y){let w=4*y;this.floatView[y]=b(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Ir.now()}_buildQuadTree(){this._tree=new F2(this)}get(e,n,a=!1){a&&(e=pi(e,-1,this.dim),n=pi(n,-1,this.dim));let c=this._idx(e,n);return this.floatView[c]}set(e,n,a){let c=this._idx(e,n),m=this.floatView[c];return this.floatView[c]=a,a-m}static getUnpackVector(e){return WP[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let a=[0,0,0,0],c=c0.getUnpackVector(n),m=Math.floor((e+c[3])/c[2]);return a[2]=m%256,m=Math.floor(m/256),a[1]=m%256,m=Math.floor(m/256),a[0]=m,a}getPixels(){return new m2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,p=a*this.dim,b=a*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(a){case-1:p=b-1;break;case 1:b=p+1}let y=-n*this.dim,w=-a*this.dim;for(let M=p;M<b;M++)for(let T=c;T<m;T++){let E=4*this._idx(T,M),P=4*this._idx(T+y,M+w);this.pixels[E+0]=e.pixels[P+0],this.pixels[E+1]=e.pixels[P+1],this.pixels[E+2]=e.pixels[P+2],this.pixels[E+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ne(c0,"DEMData"),ne(F2,"DemMinMaxQuadTree",{omit:["dem"]});class rm{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){let c=a||e.findDEMTileFor(n);if(!c||!c.dem)return;let m=c.dem,p=c.tileID,b=1<<n.canonical.z-p.canonical.z;return new rm(c,m.dim/pt/b,[(n.canonical.x/b-p.canonical.x)*m.dim,(n.canonical.y/b-p.canonical.y)*m.dim])}tileCoordToPixel(e,n){let a=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(a);return new xt(c,m)}getElevationAt(e,n,a,c){let m=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],b=Math.floor(m),y=Math.floor(p),w=this._dem;return c=!!c,a?Wt(Wt(w.get(b,y,c),w.get(b,y+1,c),p-y),Wt(w.get(b+1,y,c),w.get(b+1,y+1,c),p-y),m-b):w.get(b,y,c)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*yo(1,e)*this._dem.stride}}let B2={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},$P=a0.types,YP=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],ZP=["fill-extrusion-flood-light-ground-radius"],XP=Math.pow(2,13),QP=Math.pow(2,15)-1,N2=new xt(0,1),Xc=2147483648;function Af(t,e,n,a,c,m,p,b){t.emplaceBack((e<<1)+p,(n<<1)+m,(Math.floor(a*XP)<<1)+c,Math.round(b))}function d0(t,e,n,a,c,m){t.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+c,m)}function Pf(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class V2{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class j2{constructor(){this.centroidXY=new xt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new xt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new xt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new xt(this.max.x-this.min.x,this.max.y-this.min.y)}}class U2{constructor(){this.acc=new xt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((n.x===0||n.x===pt)&&n.x===a.x)!=((n.y===0||n.y===pt)&&n.y===a.y)&&this.processBorderOverlap(n,a),c&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Wt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>pt!=e.x>pt&&this.addBorderIntersection(1,Wt(n.y,e.y,(pt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Wt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>pt!=e.y>pt&&this.addBorderIntersection(3,Wt(n.x,e.x,(pt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new xt(0,0):new xt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function H2(t,e){let n=t.add(e)._unit(),a=pi(t.x*n.x+t.y*n.y,-1,1);var c,m,p;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*QP*((m=t).x*(p=e).y-m.y*p.x<0?-1:1)}let KP=[t=>t.x<0,t=>t.x>pt,t=>t.y<0,t=>t.y>pt];function JP(t,e,n,a){let c=[4];if(a===0)return c;n._mult(a);let m=t.sub(n),p=e.sub(n),b=[t,e,m,p];for(let y=0;y<4;y++)for(let w of b)if(KP[y](w)){c.push(y);break}return c}class W2{constructor(e){this.vertexArray=new Qy,this.indexArray=new wr,this.programConfigurations=new Gc(e.layers,{zoom:e.zoom,lut:e.lut},n=>ZP.includes(n)),this._segments=new An,this.hiddenByLandmarkVertexArray=new hv,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new An}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,c=!1){let m=e.length;if(m>2){let p=Math.max(0,this._segments.get().length-1),b=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),y;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let w=e[0],M=e[1];y=H2(w.sub(e[m-1])._perp()._unit(),M.sub(w)._perp()._unit())}for(let w=0;w<m;w++){let M=w===m-1?0:w+1,T=e[w],E=e[M],P=e[M===m-1?0:M+1],R=E.sub(T)._perp()._unit(),F=H2(R,P.sub(E)._perp()._unit()),B=y,W=F;if($v(T,E,n)||c&&$2(T,n)&&$2(E,n)){y=F;continue}let J=b.vertexLength;d0(this.vertexArray,T,E,1,1,B),d0(this.vertexArray,T,E,1,0,B),d0(this.vertexArray,T,E,0,1,W),d0(this.vertexArray,T,E,0,0,W),b.vertexLength+=4;let ee=JP(T,E,R,a);for(let te of ee)this._segmentToGroundQuads[p].push({id:J,region:te}),this._segmentToRegionTriCounts[p][te]+=2,b.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((c,m)=>c.region-m.region);for(let a=0;a<n;a++){let c=this._segmentToGroundQuads[a],m=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((y,w)=>y+w,0);let b=0;for(let y=0;y<=4;y++){let w=p[y];if(w!==0){let M=this.regionSegments[y];M||(M=this.regionSegments[y]=new An);let T={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+b,vertexLength:m.vertexLength,primitiveLength:w};M.get().push(T)}b+=w}for(let y=0;y<c.length;y++){let w=c[y].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,c,m,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,c,m,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,AP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,c,m,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,c,m,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&Xc?1:0;for(let c=e.groundVertexArrayOffset;c<n;++c)this.hiddenByLandmarkVertexArray.emplace(c,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,OP.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class h0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new wr,this.footprintVertices=new es,this.footprintSegments=[],this.layoutVertexArray=new Nc,this.centroidVertexArray=new EC,this.indexArray=new wr,this.programConfigurations=new Gc(e.layers,{zoom:e.zoom,lut:e.lut},n=>YP.includes(n)),this.segments=new An,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new W2(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,a,c){this.features=[],this.hasPattern=jv("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=q_(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:m,id:p,index:b,sourceLayerIndex:y}of e){let w=this.layers[0]._featureFilter.needGeometry,M=Dl(m,w);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),M,a))continue;let T={id:p,sourceLayerIndex:y,index:b,geometry:w?M.geometry:is(m,a,c),properties:m.properties,type:m.type,patterns:{}},E=this.layoutVertexArray.length;this.hasPattern?this.features.push(Uv("fill-extrusion",this.layers,T,this.zoom,n)):this.addFeature(T,T.geometry,b,a,{},n.availableImages,c,n.brightness),n.featureIndex.insert(m,T.geometry,b,y,this.index,E)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,c,m,p){for(let b of this.features){let{geometry:y}=b;this.addFeature(b,y,b.index,n,a,c,m,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,c,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,b,a,c,m),this.groundEffect.update(e,n,b,a,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,RP.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,PP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,c,m,p,b,y){let w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,M=[new xt(0,0),new xt(pt,pt)],T=b.projection,E=T.name==="globe",P=$P[e.type]==="Polygon",R=new U2;R.centroidDataIndex=this.centroidData.length;let F=new j2,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);F.height=W,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new j_);let J=n0(n,500);for(let Ce=J.length-1;Ce>=0;Ce--){let De=J[Ce];(De.length===0||(ee=De[0]).every(Ue=>Ue.x<=0)||ee.every(Ue=>Ue.x>=pt)||ee.every(Ue=>Ue.y<=0)||ee.every(Ue=>Ue.y>=pt))&&J.splice(Ce,1)}var ee;let te;if(E)te=Q2(J,M,c);else{te=[];for(let Ce of J)te.push({polygon:Ce,bounds:M})}let pe=P?this.edgeRadius:0,he=pe>0&&this.zoom<17,ve=(Ce,De)=>{if(Ce.length===0)return!1;let Ue=Ce[Ce.length-1];return De.x===Ue.x&&De.y===Ue.y};for(let{polygon:Ce,bounds:De}of te){let Ue=0,ze=0;for(let et of Ce)P&&!et[0].equals(et[et.length-1])&&et.push(et[0]),ze+=P?et.length-1:et.length;let $e=this.segments.prepareSegment((P?5:4)*ze,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);let rt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},We=new V2;if(We.vertexOffset=this.footprintVertices.length,We.indexOffset=3*this.footprintIndices.length,We.ringIndices=[],P){let et=[],He=[];Ue=$e.vertexLength;for(let lt=0;lt<Ce.length;lt++){let nt=Ce[lt];nt.length&&lt!==0&&He.push(et.length/2);let Mt=[],ot,ht;ot=nt[1].sub(nt[0])._perp()._unit(),We.ringIndices.push(nt.length-1);for(let Vt=1;Vt<nt.length;Vt++){let Ft=nt[Vt],Ot=nt[Vt===nt.length-1?1:Vt+1],ct=Ft.clone();if(pe){ht=Ot.sub(Ft)._perp()._unit();let jt=ot.add(ht)._unit(),ai=pe*Math.min(4,1/(ot.x*jt.x+ot.y*jt.y));ct.x+=ai*jt.x,ct.y+=ai*jt.y,ct.x=Math.round(ct.x),ct.y=Math.round(ct.y),ot=ht}!B||pe!==0&&!he||ve(Mt,ct)||Mt.push(ct),Af(this.layoutVertexArray,ct.x,ct.y,0,0,1,1,0),$e.vertexLength++,this.footprintVertices.emplaceBack(Ft.x,Ft.y),et.push(Ft.x,Ft.y),E&&Pf(this.layoutVertexExtArray,T.projectTilePoint(ct.x,ct.y,c),T.upVector(c,ct.x,ct.y))}B&&(pe===0||he)&&(Mt.length!==0&&ve(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,De,w))}let tt=If(et,He);for(let lt=0;lt<tt.length;lt+=3)this.footprintIndices.emplaceBack(We.vertexOffset+tt[lt+0],We.vertexOffset+tt[lt+1],We.vertexOffset+tt[lt+2]),this.indexArray.emplaceBack(Ue+tt[lt],Ue+tt[lt+2],Ue+tt[lt+1]),$e.primitiveLength++;We.indexCount+=tt.length,We.vertexCount+=this.footprintVertices.length-We.vertexOffset}for(let et=0;et<Ce.length;et++){let He=Ce[et];R.startRing(F,He[0]);let tt=He.length>4&&Y2(He[He.length-2],He[0],He[1]),lt=pe?eO(He[He.length-2],He[0],He[1],pe):0,nt=[],Mt,ot,ht;ot=He[1].sub(He[0])._perp()._unit();let Vt=!0;for(let Ft=1,Ot=0;Ft<He.length;Ft++){let ct=He[Ft-1],jt=He[Ft],ai=He[Ft===He.length-1?1:Ft+1];if(R.appendEdge(F,jt,ct),$v(jt,ct,De)){pe&&(ot=ai.sub(jt)._perp()._unit(),Vt=!Vt);continue}let Zt=jt.sub(ct)._perp(),di=Zt.x/(Math.abs(Zt.x)+Math.abs(Zt.y)),si=Zt.y>0?1:0,xi=ct.dist(jt);if(Ot+xi>32768&&(Ot=0),pe){ht=ai.sub(jt)._perp()._unit();let ji=q2(ct,jt,ai,G2(ot,ht),pe);isNaN(ji)&&(ji=0);let Ai=jt.sub(ct)._unit();ct=ct.add(Ai.mult(lt))._round(),jt=jt.add(Ai.mult(-ji))._round(),lt=ji,ot=ht,B&&this.zoom>=17&&(ve(nt,ct)||nt.push(ct),ve(nt,jt)||nt.push(jt))}let qt=$e.vertexLength,on=He.length>4&&Y2(ct,jt,ai),rn=Z2(Ot,tt,Vt);if(Af(this.layoutVertexArray,ct.x,ct.y,di,si,0,0,rn),Af(this.layoutVertexArray,ct.x,ct.y,di,si,0,1,rn),Ot+=xi,rn=Z2(Ot,on,!Vt),tt=on,Af(this.layoutVertexArray,jt.x,jt.y,di,si,0,0,rn),Af(this.layoutVertexArray,jt.x,jt.y,di,si,0,1,rn),$e.vertexLength+=4,this.indexArray.emplaceBack(qt+0,qt+1,qt+2),this.indexArray.emplaceBack(qt+1,qt+3,qt+2),$e.primitiveLength+=2,pe){let ji=Ue+(Ft===1?He.length-2:Ft-2),Ai=Ft===1?Ue:ji+1;if(this.indexArray.emplaceBack(qt+1,ji,qt+3),this.indexArray.emplaceBack(ji,Ai,qt+3),$e.primitiveLength+=2,Mt===void 0&&(Mt=qt),!$v(ai,He[Ft],De)){let Ui=Ft===He.length-1?Mt:$e.vertexLength;this.indexArray.emplaceBack(qt+2,qt+3,Ui),this.indexArray.emplaceBack(qt+3,Ui+1,Ui),this.indexArray.emplaceBack(qt+3,Ai,Ui+1),$e.primitiveLength+=3}Vt=!Vt}if(E){let ji=this.layoutVertexExtArray,Ai=T.projectTilePoint(ct.x,ct.y,c),Ui=T.projectTilePoint(jt.x,jt.y,c),_n=T.upVector(c,ct.x,ct.y),hn=T.upVector(c,jt.x,jt.y);Pf(ji,Ai,_n),Pf(ji,Ai,_n),Pf(ji,Ui,hn),Pf(ji,Ui,hn)}}P&&(Ue+=He.length-1),B&&pe&&this.zoom>=17&&(nt.length!==0&&ve(nt,nt[0])&&nt.pop(),this.groundEffect.addData(nt,De,w,pe>0))}this.footprintSegments.push(We),rt.triangleCount=this.indexArray.length-rt.triangleArrayOffset,this.polygonSegments.push(rt),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=R.borders?N2:this.encodeCentroid(R,F),this.centroidData.push(F),R.borders){this.featuresOnBorder.push(R);let Ce=this.featuresOnBorder.length-1;for(let De=0;De<R.borders.length;De++)R.borders[De][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[De].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,p,c,y),this.groundEffect.addPaintPropertiesData(e,a,m,p,c,y),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let b=0;b<this.centroidData.length;b++){let y=this.centroidData[b],w=+(y.min.y+y.max.y>pt),M=2*w+(+(y.min.x+y.max.x>pt)^w);for(let T=0;T<y.polygonSegLen;T++){let E=y.polygonSegIdx+T;e.push({centroidIdx:b,subtile:M,polygonSegmentIdx:E,triangleSegmentIdx:this.polygonSegments[E].triangleSegIdx})}}let n=new wr;e.sort((b,y)=>b.triangleSegmentIdx===y.triangleSegmentIdx?b.subtile-y.subtile:b.triangleSegmentIdx-y.triangleSegmentIdx);let a=0,c=0,m=0;for(let b of e){if(b.triangleSegmentIdx!==a)break;m++}let p=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let b=0,y=c,w=c;for(let M=y;M<m&&e[M].subtile===b;M++)w++;for(;y!==m;){let M=e[y];b=M.subtile;let T=this.centroidData[M.centroidIdx].min.clone(),E=this.centroidData[M.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=y;R<w;R++){let F=e[R],B=this.polygonSegments[F.polygonSegmentIdx],W=this.centroidData[F.centroidIdx].min,J=this.centroidData[F.centroidIdx].max,ee=this.indexArray.uint16;for(let te=B.triangleArrayOffset;te<B.triangleArrayOffset+B.triangleCount;te++)n.emplaceBack(ee[3*te],ee[3*te+1],ee[3*te+2]);P.primitiveLength+=B.triangleCount,T.x=Math.min(T.x,W.x),T.y=Math.min(T.y,W.y),E.x=Math.max(E.x,J.x),E.y=Math.max(E.y,J.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:T,max:E}),y=w;for(let R=y;R<m&&e[R].subtile===e[y].subtile;R++)w++}c=m;for(let M=c;M<p&&e[M].triangleSegmentIdx===e[c].triangleSegmentIdx;M++)m++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){let c=0,m=0,p=1<<e.canonical.z;if(n){let F=n.getMinMaxForTile(e);F&&(c=F.min,m=F.max)}m+=this.maxHeight;let b=e.toUnwrapped(),y,w=[b.canonical.x/p+b.wrap,b.canonical.y/p],M=[(b.canonical.x+1)/p+b.wrap,(b.canonical.y+1)/p],T=new An,E=(F,B,W)=>[F[0]*(1-W[0])+B[0]*W[0],F[1]*(1-W[1])+B[1]*W[1]],P=[],R=[];for(let F of this.triangleSubSegments){P[0]=F.min.x/pt,P[1]=F.min.y/pt,R[0]=F.max.x/pt,R[1]=F.max.y/pt;let B=E(w,M,P),W=E(w,M,R);if(new Pn([B[0],B[1],c],[W[0],W[1],m]).intersectsPrecise(a)===0){y&&(T.segments.push(y),y=void 0);continue}let J=F.segment;y&&y.vertexOffset!==J.vertexOffset&&(T.segments.push(y),y=void 0),y?(y.vertexLength+=J.vertexLength,y.primitiveLength+=J.primitiveLength):y={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&T.segments.push(y),T}encodeCentroid(e,n){let a=e.centroid(),c=n.span(),m=Math.min(7,Math.round(c.x*this.tileToMeter/10)),p=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new xt(pi(a.x,1,pt-1)<<3|m,pi(a.y,1,pt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new xt(0,0);let n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){let c=n[0][0]!==a?0:1;return new xt(6|(n[0][0]!==a?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{let c=n[2][0]!==a?2:3;return new xt((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=Xc,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&Xc?N2:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||m!==c.x){for(let p=n;p<a;++p)this.centroidVertexArray.emplace(p,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let c=n.getReplacementRegionsForTile(e.toUnwrapped());if(qv(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let m=[];for(let p of this.activeReplacements){if(p.order<a)continue;let b=Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&Xc||p.min.x>y.max.x||y.min.x>p.max.x||p.min.y>y.max.y||y.min.y>p.max.y))for(let w=0;w<y.footprintSegLen;w++){let M=this.footprintSegments[y.footprintSegIdx+w];if(m.length=0,tO(this.footprintVertices,M.vertexOffset,M.vertexCount,p.footprintTileId.canonical,e.canonical,m),I2(p.footprint,m,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-b)){y.flags|=Xc;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let c=!1;for(let m=0;m<a.footprintSegLen;m++){let p=this.footprintSegments[a.footprintSegIdx+m],b=0;for(let y of p.ringIndices){for(let w=b,M=y+b-1;w<y+b;M=w++){let T=this.footprintVertices.int16[2*(w+p.vertexOffset)+0],E=this.footprintVertices.int16[2*(w+p.vertexOffset)+1],P=this.footprintVertices.int16[2*(M+p.vertexOffset)+1];E>n!=P>n&&e<(this.footprintVertices.int16[2*(M+p.vertexOffset)+0]-T)*(n-E)/(P-E)+T&&(c=!c)}b=y}}return c}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,c=!0,m=4*(e+pt)*pt+(n+pt);if(this.partLookup.hasOwnProperty(m)){let p=this.partLookup[m];return p?{height:p.height,hidden:!!(p.flags&Xc)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>a&&(a=p.height,this.partLookup[m]=p,c=!!(p.flags&Xc));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[m]=void 0}}function G2(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function eO(t,e,n,a){let c=e.sub(t)._perp()._unit(),m=n.sub(e)._perp()._unit();return q2(t,e,n,G2(c,m),a)}function q2(t,e,n,a,c){let m=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(n)/3,c*m/a)}function $v(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function $2(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function Y2(t,e,n){if(t.x<0||t.x>=pt||e.x<0||e.x>=pt||n.x<0||n.x>=pt)return!1;let a=n.sub(e),c=a.perp(),m=t.sub(e);return(a.x*m.x+a.y*m.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(m.x*m.x+m.y*m.y))>-.866&&c.x*m.x+c.y*m.y<0}function Z2(t,e,n){let a=e?2|t:-3&t;return n?1|a:-2&a}function X2(){let t=Math.PI/32,e=Math.tan(t),n=Ju;return n*Math.sqrt(1+2*e*e)-n}function Q2(t,e,n){let a=1<<n.z,c=Oo(n.x/a),m=Oo((n.x+1)/a),p=Dr(n.y/a),b=Dr((n.y+1)/a);return function(y,w,M,T,E=0,P){let R=[];if(!y.length||!M||!T)return R;let F=(he,ve)=>{for(let Ce of he)R.push({polygon:Ce,bounds:ve})},B=Math.ceil(Math.log2(M)),W=Math.ceil(Math.log2(T)),J=B-W,ee=[];for(let he=0;he<Math.abs(J);he++)ee.push(J>0?0:1);for(let he=0;he<Math.min(B,W);he++)ee.push(0),ee.push(1);let te=y;if(te=s0(te,w[0].y-E,w[1].y+E,1),te=s0(te,w[0].x-E,w[1].x+E,0),!te.length)return R;let pe=[];for(ee.length?pe.push({polygons:te,bounds:w,depth:0}):F(te,w);pe.length;){let he=pe.pop(),ve=he.depth,Ce=ee[ve],De=he.bounds[0],Ue=he.bounds[1],ze=Ce===0?De.x:De.y,$e=Ce===0?Ue.x:Ue.y,rt=P?P(Ce,ze,$e):.5*(ze+$e),We=s0(he.polygons,ze-E,rt+E,Ce),et=s0(he.polygons,rt-E,$e+E,Ce);if(We.length){let He=[De,new xt(Ce===0?rt:Ue.x,Ce===1?rt:Ue.y)];ee.length>ve+1?pe.push({polygons:We,bounds:He,depth:ve+1}):F(We,He)}if(et.length){let He=[new xt(Ce===0?rt:De.x,Ce===1?rt:De.y),Ue];ee.length>ve+1?pe.push({polygons:et,bounds:He,depth:ve+1}):F(et,He)}}return R}(t,e,Math.ceil((m-c)/11.25),Math.ceil((p-b)/11.25),1,(y,w,M)=>{if(y===0)return .5*(w+M);{let T=Dr((n.y+w/pt)/a);return(Vs(.5*(Dr((n.y+M/pt)/a)+T))*a-n.y)*pt}})}function tO(t,e,n,a,c,m){let p=Math.pow(2,a.z-c.z);for(let b=0;b<n;b++){let y=t.int16[2*(b+e)+0],w=t.int16[2*(b+e)+1];y=(y+c.x*pt)*p-a.x*pt,w=(w+c.y*pt)*p-a.y*pt,m.push(new xt(y,w))}}ne(h0,"FillExtrusionBucket",{omit:["layers","features"]}),ne(j2,"PartData"),ne(V2,"FootprintSegment"),ne(U2,"BorderCentroidData"),ne(W2,"GroundEffect");let iO=new qi({visibility:new Ke(Pe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ke(Pe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var nO={paint:new qi({"fill-extrusion-opacity":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new St(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new St(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new St(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new St(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new St(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new St(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ke(Pe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:iO};function Of(t,e){return t.x*e.x+t.y*e.y}function K2(t,e){if(t.length===1){let n=0,a=e[n++],c;for(;!c||a.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){let m=e[n],p=t[0],b=c.sub(a),y=m.sub(a),w=p.sub(a),M=Of(b,b),T=Of(b,y),E=Of(y,y),P=Of(w,b),R=Of(w,y),F=M*E-T*T,B=(E*P-T*R)/F,W=(M*R-T*P)/F,J=a.z*(1-B-W)+c.z*B+m.z*W;if(isFinite(J))return J}return 1/0}{let n=1/0;for(let a of e)n=Math.min(n,a.z);return n}}function J2(t,e,n,a,c,m,p,b){let y=p*c.getElevationAt(t,e,!0,!0),w=m[0]!==0,M=w?m[1]===0?p*(m[0]/7-450):p*function(T,E,P){let R=Math.floor(E[0]/8),F=Math.floor(E[1]/8),B=10*(E[0]-8*R),W=10*(E[1]-8*F),J=T.getElevationAt(R,F,!0,!0),ee=T.getMeterToDEM(P),te=Math.floor(.5*(B*ee-1)),pe=Math.floor(.5*(W*ee-1)),he=T.tileCoordToPixel(R,F),ve=2*te+1,Ce=2*pe+1,De=function(et,He,tt,lt,nt){return[et.getElevationAtPixel(He,tt,!0),et.getElevationAtPixel(He+nt,tt,!0),et.getElevationAtPixel(He,tt+nt,!0),et.getElevationAtPixel(He+lt,tt+nt,!0)]}(T,he.x-te,he.y-pe,ve,Ce),Ue=Math.abs(De[0]-De[1]),ze=Math.abs(De[2]-De[3]),$e=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),rt=Math.min(.25,.5*ee*(Ue+ze)/ve),We=Math.min(.25,.5*ee*$e/Ce);return J+Math.max(rt*B,We*W)}(c,m,b):y;return{base:y+(n===0)?-1:n,top:w?Math.max(M+a,y+n+2):y+a}}let rO=$i([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:oO}=rO,aO=$i([{name:"a_packed",components:4,type:"Float32"}]),{members:sO}=aO,lO=$i([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:cO}=lO,dO=$i([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hO=$i([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),uO=$i([{name:"a_projected_pos",components:4,type:"Float32"}],4);$i([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Yv=$i([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),eS=$i([{name:"a_z_offset",components:1,type:"Float32"}],4),mO=$i([{name:"a_texb",components:2,type:"Uint16"}]),pO=$i([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),fO=$i([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);$i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let tS=$i([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gO=$i([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$i([{name:"triangle",components:3,type:"Uint16"}]),$i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$i([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),$i([{type:"Float32",name:"offsetX"}]),$i([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class iS{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Yc({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let a=this.getKey(e,n);return this.positions[a]}trim(){let e=this.width,n=this.height=yp(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){let c=[],m=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,b=!0;c.push({left:m,right:p,isDash:b,zeroLength:e[0]===0});let y=e[0];for(let w=1;w<e.length;w++){b=!b;let M=e[w];m=y*a,y+=M,p=y*a,c.push({left:m,right:p,isDash:b,zeroLength:M===0})}return c}addRoundDash(e,n,a){let c=n/2;for(let m=-a;m<=a;m++){let p=this.width*(this.nextRow+a+m),b=0,y=e[b];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++b]);let M=Math.abs(w-y.left),T=Math.abs(w-y.right),E=Math.min(M,T),P,R=m/a*(c+1);if(y.isDash){let F=c-Math.abs(R);P=Math.sqrt(E*E+F*F)}else P=c-Math.sqrt(E*E+R*R);this.image.data[p+w]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let w=e[y],M=e[y+1];w.zeroLength?e.splice(y,1):M&&M.isDash===w.isDash&&(M.left=w.left,e.splice(y,1))}let a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);let m=this.width*this.nextRow,p=0,b=e[p];for(let y=0;y<this.width;y++){y/b.right>1&&(b=e[++p]);let w=Math.abs(y-b.left),M=Math.abs(y-b.right),T=Math.min(w,M);this.image.data[m+y]=Math.max(0,Math.min(255,(b.isDash?T:-T)+n+128))}}addDash(e,n){let a=this.getKey(e,n);if(this.positions[a])return this.positions[a];let c=n==="round",m=c?7:0,p=2*m+1;if(this.nextRow+p>this.height)return Zn("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let M=0;M<e.length;M++)e[M]<0&&(Zn("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),b+=e[M];if(b!==0){let M=this.width/b,T=this.getDashRanges(e,this.width,M);c?this.addRoundDash(T,M,m):this.addRegularDash(T,n==="square"?.5*M:0)}let y=this.nextRow+m;this.nextRow+=p;let w={tl:[y,m],br:[b,0]};return this.positions[a]=w,w}}ne(iS,"LineAtlas");let _O=a0.types,bO=Math.cos(Math.PI/180*37.5),yO=Math.cos(Math.PI/180*5);class u0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Ky,this.layoutVertexArray2=new Vc,this.patternVertexArray=new jc,this.indexArray=new wr,this.programConfigurations=new Gc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new An,this.maxLineLength=0,this.zOffsetVertexArray=new xh,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:pt/64}updateFootprints(e,n){}populate(e,n,a,c){this.hasPattern=jv("line",this.layers,n);let m=this.layers[0].layout.get("line-sort-key"),p=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!p.isConstant()||!!p.constantOr(0);let b=[];for(let{feature:T,id:E,index:P,sourceLayerIndex:R}of e){let F=this.layers[0]._featureFilter.needGeometry,B=Dl(T,F);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),B,a))continue;let W=m?m.evaluate(B,{},a):void 0,J={id:E,properties:T.properties,type:T.type,sourceLayerIndex:R,index:P,geometry:F?B.geometry:is(T,a,c),patterns:{},sortKey:W};b.push(J)}m&&b.sort((T,E)=>T.sortKey-E.sortKey);let{lineAtlas:y,featureIndex:w}=n,M=this.addConstantDashes(y);for(let T of b){let{geometry:E,index:P,sourceLayerIndex:R}=T;if(M&&this.addFeatureDashes(T,y),this.hasPattern){let F=Uv("line",this.layers,T,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(T,E,P,a,y.positions,n.availableImages,n.brightness);w.insert(e[P].feature,E,P,R,this.index)}}addConstantDashes(e){let n=!1;for(let a of this.layers){let c=a.paint.get("line-dasharray").value,m=a.layout.get("line-cap").value;if(c.kind!=="constant"||m.kind!=="constant")n=!0;else{let p=m.value,b=c.value;if(!b)continue;e.addDash(b,p)}}return n}addFeatureDashes(e,n){let a=this.zoom;for(let c of this.layers){let m=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(m.kind==="constant"&&p.kind==="constant")continue;let b,y;if(m.kind==="constant"){if(b=m.value,!b)continue}else b=m.evaluate({zoom:a},e);y=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),n.addDash(b,y),e.patterns[c.id]=n.getKey(b,y)}}update(e,n,a,c,m){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,p?this.stateDependentLayers:this.layers,a,c,m)}addFeatures(e,n,a,c,m,p){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,n,a,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,sO)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,cO)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,eS.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oO),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,c,m,p,b){let y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),M=y.get("line-cap").evaluate(e,{}),T=y.get("line-miter-limit"),E=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let P of n)this.addLine(P,e,c,w,M,T,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,p,c,b)}addLine(e,n,a,c,m,p,b){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;let y={zoom:this.zoom,lineProgress:void 0},w=this.layers[0].layout,M=c==="none";if(this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<e.length-1;he++)this.totalDistance+=e[he].dist(e[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let T=_O[n.type]==="Polygon",E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let P=0;for(;P<E-1&&e[P].equals(e[P+1]);)P++;if(E<(T?3:2))return;c==="bevel"&&(p=1.05);let R=this.overscaling<=16?15*pt/(512*this.overscaling):0,F=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray),B,W,J,ee,te,pe;this.e1=this.e2=-1,T&&(B=e[E-2],te=e[P].sub(B)._unit()._perp());for(let he=P;he<E;he++){if(J=he===E-1?T?e[P+1]:void 0:e[he+1],J&&e[he].equals(J))continue;if(te&&(ee=te),B&&(W=B),B=e[he],this.hasZOffset){let He=w.get("line-z-offset").value;if(He.kind==="constant")pe=He.value;else{if(this.lineClips){let tt=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(tt*this.lineClips.start+this.distance+(W?W.dist(B):0))/tt}else Zn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;pe=He.evaluate(y,n)}pe=pe||0}te=J?J.sub(B)._unit()._perp():ee,ee=ee||te;let ve=W&&J,Ce=ve?c:T||M?"butt":m,De=ee.x*te.x+ee.y*te.y;if(M){let He=function(tt){if(tt.patternJoinNone){let lt=tt.segmentPoints.length/2,nt=tt.lineSoFar-tt.segmentStart;for(let Mt=0;Mt<lt;++Mt){let ot=tt.segmentPoints[2*Mt+1],ht=Math.round(tt.segmentPoints[2*Mt])+.5+.25*ot;tt.patternVertexArray.emplaceBack(ht,nt,tt.segmentStart),tt.patternVertexArray.emplaceBack(ht,nt,tt.segmentStart)}tt.segmentPoints.length=0}tt.e1=tt.e2=-1};if(ve&&De<yO){this.updateDistance(W,B),this.addCurrentVertex(B,ee,1,1,F,pe),He(this),this.addCurrentVertex(B,te,-1,-1,F,pe);continue}if(W){if(!J){this.updateDistance(W,B),this.addCurrentVertex(B,ee,1,1,F,pe),He(this);continue}Ce="miter"}}let Ue=ee.add(te);Ue.x===0&&Ue.y===0||Ue._unit();let ze=Ue.x*te.x+Ue.y*te.y,$e=ze!==0?1/ze:1/0,rt=2*Math.sqrt(2-2*ze),We=ze<bO&&W&&J,et=ee.x*te.y-ee.y*te.x>0;if(We&&he>P){let He=B.dist(W);if(He>2*R){let tt=B.sub(B.sub(W)._mult(R/He)._round());this.updateDistance(W,tt),this.addCurrentVertex(tt,ee,0,0,F,pe),W=tt}}if(ve&&Ce==="round"&&($e<b?Ce="miter":$e<=2&&(Ce="fakeround")),Ce==="miter"&&$e>p&&(Ce="bevel"),Ce==="bevel"&&($e>2&&(Ce="flipbevel"),$e<p&&(Ce="miter")),W&&this.updateDistance(W,B),Ce==="miter")Ue._mult($e),this.addCurrentVertex(B,Ue,0,0,F,pe);else if(Ce==="flipbevel"){if($e>100)Ue=te.mult(-1);else{let He=$e*ee.add(te).mag()/ee.sub(te).mag();Ue._perp()._mult(He*(et?-1:1))}this.addCurrentVertex(B,Ue,0,0,F,pe),this.addCurrentVertex(B,Ue.mult(-1),0,0,F,pe)}else if(Ce==="bevel"||Ce==="fakeround"){let He=-Math.sqrt($e*$e-1),tt=et?He:0,lt=et?0:He;if(W&&this.addCurrentVertex(B,ee,tt,lt,F,pe),Ce==="fakeround"){let nt=Math.round(180*rt/Math.PI/20);for(let Mt=1;Mt<nt;Mt++){let ot=Mt/nt;if(ot!==.5){let Vt=ot-.5;ot+=ot*Vt*(ot-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*Vt*Vt+(.848013+De*(.215638*De-1.06021)))}let ht=te.sub(ee)._mult(ot)._add(ee)._unit()._mult(et?-1:1);this.addHalfVertex(B,ht.x,ht.y,!1,et,0,F,pe)}}J&&this.addCurrentVertex(B,te,-tt,-lt,F,pe)}else Ce==="butt"?this.addCurrentVertex(B,Ue,0,0,F,pe):Ce==="square"?(W||this.addCurrentVertex(B,Ue,-1,-1,F,pe),this.addCurrentVertex(B,Ue,0,0,F,pe),W&&this.addCurrentVertex(B,Ue,1,1,F,pe)):Ce==="round"&&(W&&(this.addCurrentVertex(B,ee,0,0,F,pe),this.addCurrentVertex(B,ee,1,1,F,pe,!0)),J&&(this.addCurrentVertex(B,te,-1,-1,F,pe,!0),this.addCurrentVertex(B,te,0,0,F,pe)));if(We&&he<E-1){let He=B.dist(J);if(He>2*R){let tt=B.add(J.sub(B)._mult(R/He)._round());this.updateDistance(B,tt),this.addCurrentVertex(tt,te,0,0,F,pe),B=tt}}}}addVerticesTo(e,n,a,c,m,p,b,y,w,M){let T=(n.w-e.w)/this.tessellationStep|0;if(T>1){this.lineSoFar=e.w;let E=(n.x-e.x)/T,P=(n.y-e.y)/T,R=(n.z-e.z)/T,F=(n.w-e.w)/T;for(let B=1;B<T;++B)e.x+=E,e.y+=P,e.z+=R,this.lineSoFar+=F,this.addHalfVertex(e,a,c,M,!1,b,w,e.z),this.addHalfVertex(e,m,p,M,!0,-y,w,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,a,c,M,!1,b,w,n.z),this.addHalfVertex(n,m,p,M,!0,-y,w,n.z)}addCurrentVertex(e,n,a,c,m,p,b=!1){let y=n.x+n.y*a,w=n.y-n.x*a,M=n.y*c-n.x,T=-n.y-n.x*c;if(p!=null){let P=pt+10,R=p,F=new w2(e.x,e.y,R,this.lineSoFar),B=nS(e,-10,P),W=this.lineSoFar;if(this.currentVertex)if(B){let J=this.currentVertexIsOutside,ee=this.currentVertex,te=new w2(e.x,e.y,R,this.lineSoFar);S2(ee,te,-10,P),nS(te,-10,P)||(J&&(this.e1=this.e2=-1,this.lineSoFar=ee.w,this.addHalfVertex(ee,y,w,b,!1,a,m,ee.z),this.addHalfVertex(ee,M,T,b,!0,-c,m,ee.z)),this.addVerticesTo(ee,te,y,w,M,T,a,c,m,b))}else{let J=this.currentVertex;this.currentVertexIsOutside&&(S2(J,F,-10,P),this.e1=this.e2=-1,this.lineSoFar=J.w,this.addHalfVertex(J,y,w,b,!1,a,m,J.z),this.addHalfVertex(J,M,T,b,!0,-c,m,J.z)),this.addVerticesTo(J,F,y,w,M,T,a,c,m,b)}else B||(this.addHalfVertex(e,y,w,b,!1,a,m,p),this.addHalfVertex(e,M,T,b,!0,-c,m,p));this.currentVertex=F,this.currentVertexIsOutside=B,this.lineSoFar=W}else this.addHalfVertex(e,y,w,b,!1,a,m,p),this.addHalfVertex(e,M,T,b,!0,-c,m,p)}addHalfVertex({x:e,y:n},a,c,m,p,b,y,w){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let M=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),y.primitiveLength++),p?this.e2=M:this.e1=M,w!=null&&this.zOffsetVertexArray.emplaceBack(w)}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function nS(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}ne(u0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let vO=new qi({"line-cap":new St(Pe.layout_line["line-cap"]),"line-join":new St(Pe.layout_line["line-join"]),"line-miter-limit":new Ke(Pe.layout_line["line-miter-limit"]),"line-round-limit":new Ke(Pe.layout_line["line-round-limit"]),"line-sort-key":new St(Pe.layout_line["line-sort-key"]),"line-z-offset":new St(Pe.layout_line["line-z-offset"]),visibility:new Ke(Pe.layout_line.visibility)});var m0={paint:new qi({"line-opacity":new St(Pe.paint_line["line-opacity"]),"line-color":new St(Pe.paint_line["line-color"]),"line-translate":new Ke(Pe.paint_line["line-translate"]),"line-translate-anchor":new Ke(Pe.paint_line["line-translate-anchor"]),"line-width":new St(Pe.paint_line["line-width"]),"line-gap-width":new St(Pe.paint_line["line-gap-width"]),"line-offset":new St(Pe.paint_line["line-offset"]),"line-blur":new St(Pe.paint_line["line-blur"]),"line-dasharray":new St(Pe.paint_line["line-dasharray"]),"line-pattern":new St(Pe.paint_line["line-pattern"]),"line-gradient":new Dn(Pe.paint_line["line-gradient"]),"line-trim-offset":new Ke(Pe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ke(Pe.paint_line["line-trim-fade-range"]),"line-trim-color":new Ke(Pe.paint_line["line-trim-color"]),"line-emissive-strength":new Ke(Pe.paint_line["line-emissive-strength"]),"line-border-width":new St(Pe.paint_line["line-border-width"]),"line-border-color":new St(Pe.paint_line["line-border-color"]),"line-occlusion-opacity":new Ke(Pe.paint_line["line-occlusion-opacity"])}),layout:vO};function rS(t,e,n){return e*(pt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function oS(t,e){return 1/rS(t,1,e.tileZoom)}function aS(t,e,n,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let sS=t=>{let e=[];lS(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=t.layout.get("line-join").constantOr("miter")==="none",c=!!t.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function lS(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class cS{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var xO={read:function(t,e,n,a,c){var m,p,b=8*c-a-1,y=(1<<b)-1,w=y>>1,M=-7,T=n?c-1:0,E=n?-1:1,P=t[e+T];for(T+=E,m=P&(1<<-M)-1,P>>=-M,M+=b;M>0;m=256*m+t[e+T],T+=E,M-=8);for(p=m&(1<<-M)-1,m>>=-M,M+=a;M>0;p=256*p+t[e+T],T+=E,M-=8);if(m===0)m=1-w;else{if(m===y)return p?NaN:1/0*(P?-1:1);p+=Math.pow(2,a),m-=w}return(P?-1:1)*p*Math.pow(2,m-a)},write:function(t,e,n,a,c,m){var p,b,y,w=8*m-c-1,M=(1<<w)-1,T=M>>1,E=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=a?0:m-1,R=a?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,p=M):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+T>=1?E/y:E*Math.pow(2,1-T))*y>=2&&(p++,y/=2),p+T>=M?(b=0,p=M):p+T>=1?(b=(e*y-1)*Math.pow(2,c),p+=T):(b=e*Math.pow(2,T-1)*Math.pow(2,c),p=0));c>=8;t[n+P]=255&b,P+=R,b/=256,c-=8);for(p=p<<c|b,w+=c;w>0;t[n+P]=255&p,P+=R,p/=256,w-=8);t[n+P-R]|=128*F}},dS=In,p0=xO;function In(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}In.Varint=0,In.Fixed64=1,In.Bytes=2,In.Fixed32=5;var Zv=4294967296,hS=1/Zv,uS=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ol(t){return t.type===In.Bytes?t.readVarint()+t.pos:t.pos+1}function om(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function mS(t,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var c=n.pos-1;c>=t;c--)n.buf[c+a]=n.buf[c]}function wO(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function CO(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function SO(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function MO(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function kO(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function IO(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function TO(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function EO(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function DO(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function f0(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function am(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function pS(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}In.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),c=a>>3,m=this.pos;this.type=7&a,t(c,e,this),this.pos===m&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=f0(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=pS(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=f0(this.buf,this.pos)+f0(this.buf,this.pos+4)*Zv;return this.pos+=8,t},readSFixed64:function(){var t=f0(this.buf,this.pos)+pS(this.buf,this.pos+4)*Zv;return this.pos+=8,t},readFloat:function(){var t=p0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=p0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(c,m,p){var b,y,w=p.buf;if(b=(112&(y=w[p.pos++]))>>4,y<128||(b|=(127&(y=w[p.pos++]))<<3,y<128)||(b|=(127&(y=w[p.pos++]))<<10,y<128)||(b|=(127&(y=w[p.pos++]))<<17,y<128)||(b|=(127&(y=w[p.pos++]))<<24,y<128)||(b|=(1&(y=w[p.pos++]))<<31,y<128))return om(c,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&uS?function(n,a,c){return uS.decode(n.subarray(a,c))}(this.buf,e,t):function(n,a,c){for(var m="",p=a;p<c;){var b,y,w,M=n[p],T=null,E=M>239?4:M>223?3:M>191?2:1;if(p+E>c)break;E===1?M<128&&(T=M):E===2?(192&(b=n[p+1]))==128&&(T=(31&M)<<6|63&b)<=127&&(T=null):E===3?(y=n[p+2],(192&(b=n[p+1]))==128&&(192&y)==128&&((T=(15&M)<<12|(63&b)<<6|63&y)<=2047||T>=55296&&T<=57343)&&(T=null)):E===4&&(y=n[p+2],w=n[p+3],(192&(b=n[p+1]))==128&&(192&y)==128&&(192&w)==128&&((T=(15&M)<<18|(63&b)<<12|(63&y)<<6|63&w)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,E=1):T>65535&&(T-=65536,m+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),m+=String.fromCharCode(T),p+=E}return m}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==In.Bytes)return t.push(this.readVarint(e));var n=Ol(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==In.Bytes)return t.push(this.readSVarint());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==In.Bytes)return t.push(this.readBoolean());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==In.Bytes)return t.push(this.readFloat());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==In.Bytes)return t.push(this.readDouble());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==In.Bytes)return t.push(this.readFixed32());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==In.Bytes)return t.push(this.readSFixed32());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==In.Bytes)return t.push(this.readFixed64());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==In.Bytes)return t.push(this.readSFixed64());var e=Ol(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===In.Varint)for(;this.buf[this.pos++]>127;);else if(e===In.Bytes)this.pos=this.readVarint()+this.pos;else if(e===In.Fixed32)this.pos+=4;else{if(e!==In.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),am(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),am(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),am(this.buf,-1&t,this.pos),am(this.buf,Math.floor(t*hS),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),am(this.buf,-1&t,this.pos),am(this.buf,Math.floor(t*hS),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,p,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(a,0,n),function(m,p){var b=(7&m)<<4;p.buf[p.pos++]|=b|((m>>>=3)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m|((m>>>=7)?128:0),m&&(p.buf[p.pos++]=127&m)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,c,m){for(var p,b,y=0;y<c.length;y++){if((p=c.charCodeAt(y))>55295&&p<57344){if(!b){p>56319||y+1===c.length?(a[m++]=239,a[m++]=191,a[m++]=189):b=p;continue}if(p<56320){a[m++]=239,a[m++]=191,a[m++]=189,b=p;continue}p=b-55296<<10|p-56320|65536,b=null}else b&&(a[m++]=239,a[m++]=191,a[m++]=189,b=null);p<128?a[m++]=p:(p<2048?a[m++]=p>>6|192:(p<65536?a[m++]=p>>12|224:(a[m++]=p>>18|240,a[m++]=p>>12&63|128),a[m++]=p>>6&63|128),a[m++]=63&p|128)}return m}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&mS(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),p0.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),p0.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var a=this.pos-n;a>=128&&mS(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,n){this.writeTag(t,In.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,wO,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,CO,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,kO,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,SO,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,MO,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,IO,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,TO,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,EO,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,DO,e)},writeBytesField:function(t,e){this.writeTag(t,In.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,In.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,In.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,In.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,In.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,In.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,In.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,In.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,In.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,In.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var sm=Xe(dS);let AO=["id","tile","layer","source","sourceLayer","state"];class fS{constructor(e,n,a,c,m){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=c,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let n of AO)this[n]!==void 0&&(e[n]=this[n]);return e}}class PO{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){let c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Hr(this.stateChanges[e][c],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(let m in this.state[e])m!==c&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(let m in this.state[e][c])a[m]||(this.deletedStates[e][c][m]=null)}else for(let m in a)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][m]===null&&delete this.deletedStates[e][c][m]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;let c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){let a=String(n),c=Hr({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let m=this.deletedStates[e][n];if(m===null)return{};for(let p in m)delete c[p]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let a={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let m={};for(let p in this.stateChanges[c])this.state[c][p]||(this.state[c][p]={}),Hr(this.state[c][p],this.stateChanges[c][p]),m[p]=this.state[c][p];a[c]=m}for(let c in this.deletedStates){this.state[c]=this.state[c]||{};let m={};if(this.deletedStates[c]===null)for(let p in this.state[c])m[p]={},this.state[c][p]={};else for(let p in this.deletedStates[c]){if(this.deletedStates[c][p]===null)this.state[c][p]={};else if(this.state[c][p])for(let b of Object.keys(this.deletedStates[c][p]))delete this.state[c][p][b];m[p]=this.state[c][p]}a[c]=a[c]||{},Hr(a[c],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let c in e)e[c].setFeatureState(a,n)}}class gS{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ge(pt,16,0),this.featureIndexArray=new TC,this.promoteId=n,this.is3DTile=!1}insert(e,n,a,c,m,p=0,b=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,m,p);let w=this.grid;for(let M=0;M<n.length;M++){let T=n[M],E=[1/0,1/0,-1/0,-1/0];for(let P=0;P<T.length;P++){let R=T[P];E[0]=Math.min(E[0],R.x),E[1]=Math.min(E[1],R.y),E[2]=Math.max(E[2],R.x),E[3]=Math.max(E[3],R.y)}b!==0&&(E[0]-=b,E[1]-=b,E[2]+=b,E[3]+=b),E[0]<pt&&E[1]<pt&&E[2]>=0&&E[3]>=0&&w.insert(y,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Wv(new sm(this.rawTileData)).layers,this.sourceLayerCoder=new cS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,c){this.loadVTLayers();let m=e.params||{},p=_r(m.filter),b=e.tileResult,y=e.transform,w=b.bufferedTilespaceBounds,M=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(R,F,B,W)=>GC(b.bufferedTilespaceGeometry,R,F,B,W));M.sort(OO);let T=null;y.elevation&&M.length>0&&(T=rm.create(y.elevation,this.tileID));let E={},P;for(let R=0;R<M.length;R++){let F=M[R];if(F===P)continue;P=F;let B=this.featureIndexArray.get(F),W=null;if(this.is3DTile){let J=this.bucketLayerIDs[0][0],ee=n[J];if(ee.type!=="model")continue;let{queryFeature:te,intersectionZ:pe}=ee.queryIntersectsMatchingFeature(b,B.featureIndex,p,y);te&&this.appendToResult(E,J,B.featureIndex,te,pe)}else this.loadMatchingFeature(E,B,p,m.layers,m.availableImages,n,a,c,(J,ee,te,pe=0)=>(W||(W=is(J,this.tileID.canonical,e.tileTransform)),ee.queryIntersectsFeature(b,J,te,W,this.z,e.transform,e.pixelPosMatrix,T,pe)))}return E}loadMatchingFeature(e,n,a,c,m,p,b,y,w){let{featureIndex:M,bucketIndex:T,sourceLayerIndex:E,layoutVertexArrayOffset:P}=n,R=this.bucketLayerIDs[T];if(c&&!function(J,ee){for(let te=0;te<J.length;te++)if(ee.indexOf(J[te])>=0)return!0;return!1}(c,R))return;let F=this.sourceLayerCoder.decode(E),B=this.vtLayers[F].feature(M);if(a.needGeometry){let J=Dl(B,!0);if(!a.filter(new Qt(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!a.filter(new Qt(this.tileID.overscaledZ),B))return;let W=this.getId(B,F);for(let J=0;J<R.length;J++){let ee=R[J];if(c&&c.indexOf(ee)<0)continue;let te=p[ee];if(!te)continue;let pe={};W!==void 0&&y&&(pe=y.getState(te.sourceLayer||"_geojsonTileLayer",W));let he=!w||w(B,te,pe,P);if(!he)continue;let ve=new fS(B,this.z,this.x,this.y,W),Ce=Hr({},b[ee]);Ce.paint=_S(Ce.paint,te.paint,B,pe,m),Ce.layout=_S(Ce.layout,te.layout,B,pe,m),ve.layer=Ce,this.appendToResult(e,ee,M,ve,he)}}appendToResult(e,n,a,c,m){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:a,feature:c,intersectionZ:m})}lookupSymbolFeatures(e,n,a,c,m,p,b,y){let w={};this.loadVTLayers();let M=_r(m);for(let T of e)this.loadMatchingFeature(w,{bucketIndex:a,sourceLayerIndex:c,featureIndex:T,layoutVertexArrayOffset:0},M,p,b,y,n);return w}loadFeature(e){let{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();let c=this.sourceLayerCoder.decode(a),m=this.vtFeatures[c];if(m[n])return m[n];let p=this.vtLayers[c].feature(n);return m[n]=p,p}hasLayer(e){for(let n of this.bucketLayerIDs)for(let a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];c!=null&&(a=e.properties[c]),typeof a=="boolean"&&(a=Number(a))}return a}}function _S(t,e,n,a,c){return gc(t,(m,p)=>{let b=e instanceof nn?e.get(p):null;return b&&b.evaluate?b.evaluate(n,a,c):b})}function OO(t,e){return e-t}ne(gS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Gr=24;let ns=128;function Xv(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Qt(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:c}=n,m=0;for(;m<a.length&&a[m]<=t;)m++;m=Math.max(0,m-1);let p=m;for(;p<a.length&&a[p]<t+1;)p++;p=Math.min(a.length-1,p);let b=a[m],y=a[p];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:y,interpolationType:c}:{kind:"camera",minZoom:b,maxZoom:y,minSize:n.evaluate(new Qt(b)),maxSize:n.evaluate(new Qt(y)),interpolationType:c}}}function g0(t,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:c}){return t.kind==="source"?a/ns:t.kind==="composite"?Wt(a/ns,c/ns,n):e}function lm(t,e){let n=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:c,minZoom:m,maxZoom:p}=t,b=c?pi(Do.interpolationFactor(c,e,m,p),0,1):0;t.kind==="camera"?a=Wt(t.minSize,t.maxSize,b):n=b}return{uSizeT:n,uSize:a}}var RO=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ns,evaluateSizeForFeature:g0,evaluateSizeForZoom:lm,getSizeData:Xv});function LO(t,e,n){return t.sections.forEach(a=>{a.text=function(c,m,p){let b=m.layout.get("text-transform").evaluate(p,{});return b==="uppercase"?c=c.toLocaleUpperCase():b==="lowercase"&&(c=c.toLocaleLowerCase()),Ji.applyArabicShaping&&(c=Ji.applyArabicShaping(c)),c}(a.text,e,n)}),t}let Rf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function FO(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function zO(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let Qv=3;function BO(t,e,n){e.glyphs=[],t===1&&n.readMessage(NO,e)}function NO(t,e,n){if(t===3){let{id:a,bitmap:c,width:m,height:p,left:b,top:y,advance:w}=n.readMessage(VO,{});e.glyphs.push({id:a,bitmap:new Yc({width:m+2*Qv,height:p+2*Qv},c),metrics:{width:m,height:p,left:b,top:y,advance:w}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function VO(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let bS=Qv,pa={horizontal:1,vertical:2,horizontalOnly:3};class Lf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let a=new Lf;return a.scale=e||1,a.fontStack=n,a}static forImage(e){let n=new Lf;return n.imageName=e,n}}class cm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let a=new cm;for(let c=0;c<e.sections.length;c++){let m=e.sections[c];m.image?a.addImageSection(m):a.addTextSection(m,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let c="";for(let m=0;m<n.length;m++){let p=n.charCodeAt(m+1)||null,b=n.charCodeAt(m-1)||null;c+=!a&&(p&&Ze(p)&&!Rf[n[m+1]]||b&&Ze(b)&&!Rf[n[m-1]])||!Rf[n[m]]?n[m]:Rf[n[m]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&_0[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&_0[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let a=new cm;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Lf.forText(e.scale,e.fontStack||n));let a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void Zn("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Lf.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Zn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Kv(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R){let F=cm.fromFeature(t,c);T===pa.vertical&&F.verticalizePunctuation(E);let B=[],W=function(he,ve,Ce,De,Ue,ze){if(!he)return[];let $e=[],rt=function(tt,lt,nt,Mt,ot,ht){let Vt=0;for(let Ft=0;Ft<tt.length();Ft++){let Ot=tt.getSection(Ft);Vt+=yS(tt.getCodePoint(Ft),Ot,Mt,ot,lt,ht)}return Vt/Math.max(1,Math.ceil(Vt/nt))}(he,ve,Ce,De,Ue,ze),We=he.text.indexOf("\u200B")>=0,et=0;for(let tt=0;tt<he.length();tt++){let lt=he.getSection(tt),nt=he.getCodePoint(tt);if(_0[nt]||(et+=yS(nt,lt,De,Ue,ve,ze)),tt<he.length()-1){let Mt=!((He=nt)<11904||!(me["Bopomofo Extended"](He)||me.Bopomofo(He)||me["CJK Compatibility Forms"](He)||me["CJK Compatibility Ideographs"](He)||me["CJK Compatibility"](He)||me["CJK Radicals Supplement"](He)||me["CJK Strokes"](He)||me["CJK Symbols and Punctuation"](He)||me["CJK Unified Ideographs Extension A"](He)||me["CJK Unified Ideographs"](He)||me["Enclosed CJK Letters and Months"](He)||me["Halfwidth and Fullwidth Forms"](He)||me.Hiragana(He)||me["Ideographic Description Characters"](He)||me["Kangxi Radicals"](He)||me["Katakana Phonetic Extensions"](He)||me.Katakana(He)||me["Vertical Forms"](He)||me["Yi Radicals"](He)||me["Yi Syllables"](He)));(jO[nt]||Mt||lt.imageName)&&$e.push(xS(tt+1,et,rt,$e,UO(nt,he.getCodePoint(tt+1),Mt&&We),!1))}}var He;return wS(xS(he.length(),et,rt,$e,0,!0))}(F,w,m,e,a,P),{processBidirectionalText:J,processStyledBidirectionalText:ee}=Ji;if(J&&F.sections.length===1){let he=J(F.toString(),W);for(let ve of he){let Ce=new cm;Ce.text=ve,Ce.sections=F.sections;for(let De=0;De<ve.length;De++)Ce.sectionIndex.push(0);B.push(Ce)}}else if(ee){let he=ee(F.text,F.sectionIndex,W);for(let ve of he){let Ce=new cm;Ce.text=ve[0],Ce.sectionIndex=ve[1],Ce.sections=F.sections,B.push(Ce)}}else B=function(he,ve){let Ce=[],De=he.text,Ue=0;for(let ze of ve)Ce.push(he.substring(Ue,ze)),Ue=ze;return Ue<De.length&&Ce.push(he.substring(Ue,De.length)),Ce}(F,W);let te=[],pe={positionedLines:te,text:F.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,ve,Ce,De,Ue,ze,$e,rt,We,et,He,tt){let lt=0,nt=0,Mt=0,ot=rt==="right"?1:rt==="left"?0:.5,ht=!1;for(let ai of Ue){let Zt=ai.getSections();for(let di of Zt){if(di.imageName)continue;let si=ve[di.fontStack];if(si&&(ht=si.ascender!==void 0&&si.descender!==void 0,!ht))break}if(!ht)break}let Vt=0;for(let ai of Ue){ai.trim();let Zt=ai.getMaxScale(),di=(Zt-1)*Gr,si={positionedGlyphs:[],lineOffset:0};he.positionedLines[Vt]=si;let xi=si.positionedGlyphs,qt=0;if(!ai.length()){nt+=ze,++Vt;continue}let on=0,rn=0;for(let Ai=0;Ai<ai.length();Ai++){let Ui=ai.getSection(Ai),_n=ai.getSectionIndex(Ai),hn=ai.getCodePoint(Ai),Fn=Ui.scale,On=null,eo=null,Un=null,Tn=Gr,lr=0,Ar=!(We===pa.horizontal||!He&&!Je(hn)||He&&(_0[hn]||(Ft=hn,me.Arabic(Ft)||me["Arabic Supplement"](Ft)||me["Arabic Extended-A"](Ft)||me["Arabic Presentation Forms-A"](Ft)||me["Arabic Presentation Forms-B"](Ft))));if(Ui.imageName){let Pr=De[Ui.imageName];if(!Pr)continue;Un=Ui.imageName,he.iconsInText=he.iconsInText||!0,eo=Pr.paddedRect;let mn=Pr.displaySize;Fn=Fn*Gr/tt,On={width:mn[0],height:mn[1],left:0,top:-bS,advance:Ar?mn[1]:mn[0],localGlyph:!1},lr=ht?-On.height*Fn:Zt*Gr-17-mn[1]*Fn,Tn=On.advance;let vo=(Ar?mn[0]:mn[1])*Fn-Gr*Zt;vo>0&&vo>qt&&(qt=vo)}else{let Pr=Ce[Ui.fontStack];if(!Pr)continue;Pr[hn]&&(eo=Pr[hn]);let mn=ve[Ui.fontStack];if(!mn)continue;let vo=mn.glyphs[hn];if(!vo)continue;if(On=vo.metrics,Tn=hn!==8203?Gr:0,ht){let Ll=mn.ascender!==void 0?Math.abs(mn.ascender):0,Oa=mn.descender!==void 0?Math.abs(mn.descender):0,ds=(Ll+Oa)*Fn;on<ds&&(on=ds,rn=(Ll-Oa)/2*Fn),lr=-Ll*Fn}else lr=(Zt-Fn)*Gr-17}Ar?(he.verticalizable=!0,xi.push({glyph:hn,imageName:Un,x:lt,y:nt+lr,vertical:Ar,scale:Fn,localGlyph:On.localGlyph,fontStack:Ui.fontStack,sectionIndex:_n,metrics:On,rect:eo}),lt+=Tn*Fn+et):(xi.push({glyph:hn,imageName:Un,x:lt,y:nt+lr,vertical:Ar,scale:Fn,localGlyph:On.localGlyph,fontStack:Ui.fontStack,sectionIndex:_n,metrics:On,rect:eo}),lt+=On.advance*Fn+et)}xi.length!==0&&(Mt=Math.max(lt-et,Mt),ht?CS(xi,ot,qt,rn,ze*Zt/2):CS(xi,ot,qt,0,ze/2)),lt=0;let ji=ze*Zt+qt;si.lineOffset=Math.max(qt,di),nt+=ji,++Vt}var Ft;let Ot=nt,{horizontalAlign:ct,verticalAlign:jt}=Jv($e);(function(ai,Zt,di,si,xi,qt){let on=(Zt-di)*xi,rn=-qt*si;for(let ji of ai)for(let Ai of ji.positionedGlyphs)Ai.x+=on,Ai.y+=rn})(he.positionedLines,ot,ct,jt,Mt,Ot),he.top+=-jt*Ot,he.bottom=he.top+Ot,he.left+=-ct*Mt,he.right=he.left+Mt,he.hasBaseline=ht}(pe,e,n,a,B,p,b,y,T,w,E,R),!function(he){for(let ve of he)if(ve.positionedGlyphs.length!==0)return!1;return!0}(te)&&pe}let _0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yS(t,e,n,a,c,m){if(e.imageName){let p=a[e.imageName];return p?p.displaySize[0]*e.scale*Gr/m+c:0}{let p=n[e.fontStack],b=p&&p.glyphs[t];return b?b.metrics.advance*e.scale+c:0}}function vS(t,e,n,a){let c=Math.pow(t-e,2);return a?t<e?c/2:2*c:c+Math.abs(n)*n}function UO(t,e,n){let a=0;return t===10&&(a-=1e4),n&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function xS(t,e,n,a,c,m){let p=null,b=vS(e,n,c,m);for(let y of a){let w=vS(e-y.x,n,c,m)+y.badness;w<=b&&(p=y,b=w)}return{index:t,x:e,priorBreak:p,badness:b}}function wS(t){return t?wS(t.priorBreak).concat(t.index):[]}function Jv(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function CS(t,e,n,a,c){if(!(e||n||a||c))return;let m=t.length-1,p=t[m],b=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=m;y++)t[y].x-=b,t[y].y+=n+a+c}function HO(t,e,n,a){let{horizontalAlign:c,verticalAlign:m}=Jv(a),p=n[0]-t.displaySize[0]*c,b=n[1]-t.displaySize[1]*m;return{imagePrimary:t,imageSecondary:e,top:b,bottom:b+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function SS(t,e,n,a,c,m){let p=t.imagePrimary,b;if(p.content){let B=p.content,W=p.pixelRatio||1;b=[B[0]/W,B[1]/W,p.displaySize[0]-B[2]/W,p.displaySize[1]-B[3]/W]}let y=e.left*m,w=e.right*m,M,T,E,P;n==="width"||n==="both"?(P=c[0]+y-a[3],T=c[0]+w+a[1]):(P=c[0]+(y+w-p.displaySize[0])/2,T=P+p.displaySize[0]);let R=e.top*m,F=e.bottom*m;return n==="height"||n==="both"?(M=c[1]+R-a[0],E=c[1]+F+a[2]):(M=c[1]+(R+F-p.displaySize[1])/2,E=M+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:M,right:T,bottom:E,left:P,collisionPadding:b}}class Rl extends xt{constructor(e,n,a,c,m){super(e,n),this.angle=c,this.z=a,m!==void 0&&(this.segment=m)}clone(){return new Rl(this.x,this.y,this.z,this.angle,this.segment)}}function MS(t,e,n,a,c){if(e.segment===void 0)return!0;let m=e,p=e.segment+1,b=0;for(;b>-n/2;){if(p--,p<0)return!1;b-=t[p].dist(m),m=t[p]}b+=t[p].dist(t[p+1]),p++;let y=[],w=0;for(;b<n/2;){let M=t[p],T=t[p+1];if(!T)return!1;let E=t[p-1].angleTo(M)-M.angleTo(T);for(E=Math.abs((E+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:b,angleDelta:E}),w+=E;b-y[0].distance>a;)w-=y.shift().angleDelta;if(w>c)return!1;p++,b+=M.dist(T)}return!0}function kS(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function IS(t,e,n){return t?.6*e*n:0}function TS(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function WO(t,e,n,a,c,m){let p=IS(n,c,m),b=TS(n,a)*m,y=0,w=kS(t)/2;for(let M=0;M<t.length-1;M++){let T=t[M],E=t[M+1],P=T.dist(E);if(y+P>w){let R=(w-y)/P,F=Wt(T.x,E.x,R),B=Wt(T.y,E.y,R),W=new Rl(F,B,0,E.angleTo(T),M);return!p||MS(t,W,b,p,e)?W:void 0}y+=P}}function GO(t,e,n,a,c,m,p,b,y){let w=IS(a,m,p),M=TS(a,c),T=M*p,E=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-T<e/4&&(e=T+e/4),ES(t,E?e/2*b%e:(M/2+2*m)*p*b%e,e,w,n,T,E,!1,y)}function ES(t,e,n,a,c,m,p,b,y){let w=m/2,M=kS(t),T=0,E=e-n,P=[];for(let R=0;R<t.length-1;R++){let F=t[R],B=t[R+1],W=F.dist(B),J=B.angleTo(F);for(;E+n<T+W;){E+=n;let ee=(E-T)/W,te=Wt(F.x,B.x,ee),pe=Wt(F.y,B.y,ee);if(te>=0&&te<y&&pe>=0&&pe<y&&E-w>=0&&E+w<=M){let he=new Rl(te,pe,0,J,R);a&&!MS(t,he,m,a,c)||P.push(he)}}T+=W}return b||P.length||p||(P=ES(t,T/2,n,a,c,m,p,!0,y)),P}function DS(t,e,n,a,c){let m=[];for(let p=0;p<t.length;p++){let b=t[p],y;for(let w=0;w<b.length-1;w++){let M=b[w],T=b[w+1];M.x<e&&T.x<e||(M.x<e?M=new xt(e,M.y+(e-M.x)/(T.x-M.x)*(T.y-M.y))._round():T.x<e&&(T=new xt(e,M.y+(e-M.x)/(T.x-M.x)*(T.y-M.y))._round()),M.y<n&&T.y<n||(M.y<n?M=new xt(M.x+(n-M.y)/(T.y-M.y)*(T.x-M.x),n)._round():T.y<n&&(T=new xt(M.x+(n-M.y)/(T.y-M.y)*(T.x-M.x),n)._round()),M.x>=a&&T.x>=a||(M.x>=a?M=new xt(a,M.y+(a-M.x)/(T.x-M.x)*(T.y-M.y))._round():T.x>=a&&(T=new xt(a,M.y+(a-M.x)/(T.x-M.x)*(T.y-M.y))._round()),M.y>=c&&T.y>=c||(M.y>=c?M=new xt(M.x+(c-M.y)/(T.y-M.y)*(T.x-M.x),c)._round():T.y>=c&&(T=new xt(M.x+(c-M.y)/(T.y-M.y)*(T.x-M.x),c)._round()),y&&M.equals(y[y.length-1])||(y=[M],m.push(y)),y.push(T)))))}}return m}function AS(t){let e=0,n=0;for(let p of t)e+=p.w*p.h,n=Math.max(n,p.w);t.sort((p,b)=>b.h-p.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],c=0,m=0;for(let p of t)for(let b=a.length-1;b>=0;b--){let y=a[b];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,m=Math.max(m,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===y.w&&p.h===y.h){let w=a.pop();b<a.length&&(a[b]=w)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(a.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}ne(Rl,"Anchor");let Ho=1;class ex{constructor(e,{pixelRatio:n,version:a,stretchX:c,stretchY:m,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+Ho,this.paddedRect.y+Ho]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ho,this.paddedRect.y+this.paddedRect.h-Ho]}get displaySize(){return[(this.paddedRect.w-2*Ho)/this.pixelRatio,(this.paddedRect.h-2*Ho)/this.pixelRatio]}}class PS{constructor(e,n,a){let c={},m={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,c,p),this.addImages(n,m,p);let{w:b,h:y}=AS(p),w=new ma({width:b||1,height:y||1});for(let M in e){let T=e[M],E=c[M].paddedRect;ma.copy(T.data,w,{x:0,y:0},{x:E.x+Ho,y:E.y+Ho},T.data,a,T.sdf)}for(let M in n){let T=n[M],E=m[M].paddedRect,P=E.x+Ho,R=E.y+Ho,F=T.data.width,B=T.data.height;ma.copy(T.data,w,{x:0,y:0},{x:P,y:R},T.data,a),ma.copy(T.data,w,{x:0,y:B-1},{x:P,y:R-1},{width:F,height:1},a),ma.copy(T.data,w,{x:0,y:0},{x:P,y:R+B},{width:F,height:1},a),ma.copy(T.data,w,{x:F-1,y:0},{x:P-1,y:R},{width:1,height:B},a),ma.copy(T.data,w,{x:0,y:0},{x:P+F,y:R},{width:1,height:B},a)}this.image=w,this.iconPositions=c,this.patternPositions=m}addImages(e,n,a){for(let c in e){let m=e[c],p={x:0,y:0,w:m.data.width+2*Ho,h:m.data.height+2*Ho};a.push(p),n[c]=new ex(p,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let c in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,a),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;let[c,m]=e.tl,p=!!Object.keys(this.patternPositions).length;a.update(n.data,{useMipmap:p},{x:c,y:m})}}ne(ex,"ImagePosition"),ne(PS,"ImageAtlas");let Ff=1e20;function OS(t,e,n,a,c,m,p,b,y){for(let w=e;w<e+a;w++)RS(t,n*m+w,m,c,p,b,y);for(let w=n;w<n+c;w++)RS(t,w*m+e,1,a,p,b,y)}function RS(t,e,n,a,c,m,p){m[0]=0,p[0]=-Ff,p[1]=Ff,c[0]=t[e];for(let b=1,y=0,w=0;b<a;b++){c[b]=t[e+b*n];let M=b*b;do{let T=m[y];w=(c[b]-c[T]+M-T*T)/(b-T)/2}while(w<=p[y]&&--y>-1);y++,m[y]=b,p[y]=w,p[y+1]=Ff}for(let b=0,y=0;b<a;b++){for(;p[y+1]<b;)y++;let w=m[y],M=b-w;t[e+b*n]=c[w]+M*M}}let rs=2,tx={none:0,ideographs:1,all:2};class dm{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){let c=[],m=this.urls[n]||I.GLYPHS_URL;for(let p in e)for(let b of e[p])c.push({stack:p,id:b});fc(c,({stack:p,id:b},y)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=w.glyphs[b];if(M!==void 0)return void y(null,{stack:p,id:b,glyph:M});if(M=this._tinySDF(w,p,b),M)return w.glyphs[b]=M,void y(null,{stack:p,id:b,glyph:M});let T=Math.floor(b/256);if(256*T>65535)return void y(new Error("glyphs > 65535 not supported"));if(w.ranges[T])return void y(null,{stack:p,id:b,glyph:M});let E=w.requests[T];E||(E=w.requests[T]=[],dm.loadGlyphRange(p,T,m,this.requestManager,(P,R)=>{if(R){w.ascender=R.ascender,w.descender=R.descender;for(let F in R.glyphs)this._doesCharSupportLocalGlyph(+F)||(w.glyphs[+F]=R.glyphs[+F]);w.ranges[T]=!0}for(let F of E)F(P,R);delete w.requests[T]})),E.push((P,R)=>{P?y(P):R&&y(null,{stack:p,id:b,glyph:R.glyphs[b]||null})})},(p,b)=>{if(p)a(p);else if(b){let y={};for(let{stack:w,id:M,glyph:T}of b)y[w]===void 0&&(y[w]={}),y[w].glyphs===void 0&&(y[w].glyphs={}),y[w].glyphs[M]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;a(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==tx.none&&(this.localGlyphMode===tx.all?!!this.localFontFamily:!!this.localFontFamily&&(me["CJK Unified Ideographs"](e)||me["Hangul Syllables"](e)||me.Hiragana(e)||me.Katakana(e)||me["CJK Symbols and Punctuation"](e)||me["CJK Unified Ideographs Extension A"](e)||me["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,a){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let m=e.tinySDF;if(!m){let F="400";/bold/i.test(n)?F="900":/medium/i.test(n)?F="500":/light/i.test(n)&&(F="200"),m=e.tinySDF=new dm.TinySDF({fontFamily:c,fontWeight:F,fontSize:24*rs,buffer:3*rs,radius:8*rs}),m.fontWeight=F}if(this.localGlyphs[m.fontWeight][a])return this.localGlyphs[m.fontWeight][a];let p=String.fromCodePoint(a),{data:b,width:y,height:w,glyphWidth:M,glyphHeight:T,glyphLeft:E,glyphTop:P,glyphAdvance:R}=m.draw(p);return this.localGlyphs[m.fontWeight][a]={id:a,bitmap:new Yc({width:y,height:w},b),metrics:{width:M/rs,height:T/rs,left:E/rs,top:P/rs-27,advance:R/rs,localGlyph:!0}}}}dm.loadGlyphRange=function(t,e,n,a,c){let m=256*e,p=m+255,b=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${m}-${p}`),wu.Glyphs);pl(b,(y,w)=>{if(y)c(y);else if(w){let M={},T=function(E){return new sm(E).readFields(BO,{})}(w);for(let E of T.glyphs)M[E.id]=E;c(null,{glyphs:M,ascender:T.ascender,descender:T.descender})}})},dm.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:m="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;let b=this.size=t+4*e,y=this._createCanvas(b),w=this.ctx=y.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${m} ${t}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:m}=this.ctx.measureText(t),p=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-c))),y=Math.min(this.size-this.buffer,p+Math.ceil(a)),w=b+2*this.buffer,M=y+2*this.buffer,T=Math.max(w*M,0),E=new Uint8ClampedArray(T),P={data:E,width:w,height:M,glyphWidth:b,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(b===0||y===0)return P;let{ctx:R,buffer:F,gridInner:B,gridOuter:W}=this;R.clearRect(F,F,b,y),R.fillText(t,F,F+p);let J=R.getImageData(F,F,b,y);W.fill(Ff,0,T),B.fill(0,0,T);for(let ee=0;ee<y;ee++)for(let te=0;te<b;te++){let pe=J.data[4*(ee*b+te)+3]/255;if(pe===0)continue;let he=(ee+F)*w+te+F;if(pe===1)W[he]=0,B[he]=Ff;else{let ve=.5-pe;W[he]=ve>0?ve*ve:0,B[he]=ve<0?ve*ve:0}}OS(W,0,0,w,M,w,this.f,this.v,this.z),OS(B,F,F,b,y,w,this.f,this.v,this.z);for(let ee=0;ee<T;ee++){let te=Math.sqrt(W[ee])-Math.sqrt(B[ee]);E[ee]=Math.round(255-255*(te/this.radius+this.cutoff))}return P}};let Qc=Ho;function LS(t,e,n,a){let c=[],m=t.imagePrimary,p=m.pixelRatio,b=m.paddedRect.w-2*Qc,y=m.paddedRect.h-2*Qc,w=t.right-t.left,M=t.bottom-t.top,T=m.stretchX||[[0,b]],E=m.stretchY||[[0,y]],P=(ze,$e)=>ze+$e[1]-$e[0],R=T.reduce(P,0),F=E.reduce(P,0),B=b-R,W=y-F,J=0,ee=R,te=0,pe=F,he=0,ve=B,Ce=0,De=W;if(m.content&&a){let ze=m.content;J=b0(T,0,ze[0]),te=b0(E,0,ze[1]),ee=b0(T,ze[0],ze[2]),pe=b0(E,ze[1],ze[3]),he=ze[0]-J,Ce=ze[1]-te,ve=ze[2]-ze[0]-ee,De=ze[3]-ze[1]-pe}let Ue=(ze,$e,rt,We)=>{let et=y0(ze.stretch-J,ee,w,t.left),He=v0(ze.fixed-he,ve,ze.stretch,R),tt=y0($e.stretch-te,pe,M,t.top),lt=v0($e.fixed-Ce,De,$e.stretch,F),nt=y0(rt.stretch-J,ee,w,t.left),Mt=v0(rt.fixed-he,ve,rt.stretch,R),ot=y0(We.stretch-te,pe,M,t.top),ht=v0(We.fixed-Ce,De,We.stretch,F),Vt=new xt(et,tt),Ft=new xt(nt,tt),Ot=new xt(nt,ot),ct=new xt(et,ot),jt=new xt(He/p,lt/p),ai=new xt(Mt/p,ht/p),Zt=e*Math.PI/180;if(Zt){let rn=Math.sin(Zt),ji=Math.cos(Zt),Ai=[ji,-rn,rn,ji];Vt._matMult(Ai),Ft._matMult(Ai),ct._matMult(Ai),Ot._matMult(Ai)}let di=ze.stretch+ze.fixed,si=rt.stretch+rt.fixed,xi=$e.stretch+$e.fixed,qt=We.stretch+We.fixed,on=t.imageSecondary;return{tl:Vt,tr:Ft,bl:ct,br:Ot,texPrimary:{x:m.paddedRect.x+Qc+di,y:m.paddedRect.y+Qc+xi,w:si-di,h:qt-xi},texSecondary:on?{x:on.paddedRect.x+Qc+di,y:on.paddedRect.y+Qc+xi,w:si-di,h:qt-xi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jt,pixelOffsetBR:ai,minFontScaleX:ve/p/w,minFontScaleY:De/p/M,isSDF:n}};if(a&&(m.stretchX||m.stretchY)){let ze=FS(T,B,R),$e=FS(E,W,F);for(let rt=0;rt<ze.length-1;rt++){let We=ze[rt],et=ze[rt+1];for(let He=0;He<$e.length-1;He++)c.push(Ue(We,$e[He],et,$e[He+1]))}}else c.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:y+1}));return c}function b0(t,e,n){let a=0;for(let c of t)a+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return a}function FS(t,e,n){let a=[{fixed:-Qc,stretch:0}];for(let[c,m]of t){let p=a[a.length-1];a.push({fixed:c-p.stretch,stretch:p.stretch}),a.push({fixed:c-p.stretch,stretch:p.stretch+(m-c)})}return a.push({fixed:e+Qc,stretch:n}),a}function y0(t,e,n,a){return t/e*n+a}function v0(t,e,n,a){return t-e*n/a}function qO(t,e,n,a){let c=e+t.positionedLines[a].lineOffset;return a===0?n+c/2:n+(c+(e+t.positionedLines[a-1].lineOffset))/2}function $O(t,e=1,n=!1){let a=1/0,c=1/0,m=-1/0,p=-1/0,b=t[0];for(let P=0;P<b.length;P++){let R=b[P];(!P||R.x<a)&&(a=R.x),(!P||R.y<c)&&(c=R.y),(!P||R.x>m)&&(m=R.x),(!P||R.y>p)&&(p=R.y)}let y=Math.min(m-a,p-c),w=y/2,M=new Yp([],YO);if(y===0)return new xt(a,c);for(let P=a;P<m;P+=y)for(let R=c;R<p;R+=y)M.push(new hm(P+w,R+w,w,t));let T=function(P){let R=0,F=0,B=0,W=P[0];for(let J=0,ee=W.length,te=ee-1;J<ee;te=J++){let pe=W[J],he=W[te],ve=pe.x*he.y-he.x*pe.y;F+=(pe.x+he.x)*ve,B+=(pe.y+he.y)*ve,R+=3*ve}return new hm(F/R,B/R,0,P)}(t),E=M.length;for(;M.length;){let P=M.pop();(P.d>T.d||!T.d)&&(T=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,E)),P.max-T.d<=e||(w=P.h/2,M.push(new hm(P.p.x-w,P.p.y-w,w,t)),M.push(new hm(P.p.x+w,P.p.y-w,w,t)),M.push(new hm(P.p.x-w,P.p.y+w,w,t)),M.push(new hm(P.p.x+w,P.p.y+w,w,t)),E+=4)}return n&&(console.log(`num probes: ${E}`),console.log(`best distance: ${T.d}`)),T.p}function YO(t,e){return e.max-t.max}class hm{constructor(e,n,a,c){this.p=new xt(e,n),this.h=a,this.d=function(m,p){let b=!1,y=1/0;for(let w=0;w<p.length;w++){let M=p[w];for(let T=0,E=M.length,P=E-1;T<E;P=T++){let R=M[T],F=M[P];R.y>m.y!=F.y>m.y&&m.x<(F.x-R.x)*(m.y-R.y)/(F.y-R.y)+R.x&&(b=!b),y=Math.min(y,HC(m,R,F))}}return(b?1:-1)*Math.sqrt(y)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let ix=Number.POSITIVE_INFINITY,ZO=Math.sqrt(2);function zS(t,[e,n]){let a=0,c=0;if(n===ix){e<0&&(e=0);let m=e/ZO;switch(t){case"top-right":case"top-left":c=m-7;break;case"bottom-right":case"bottom-left":c=7-m;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(t){case"top-right":case"bottom-right":a=-m;break;case"top-left":case"bottom-left":a=m;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function nx(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function XO(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R){let F=m.textMaxSize.evaluate(e,{},T);F===void 0&&(F=p);let B=t.layers[0].layout,W=B.get("icon-offset").evaluate(e,{},T),J=NS(n.horizontal)||n.vertical,ee=E.name==="globe",te=Gr,pe=p/te,he=t.tilePixelRatio*F/te,ve=(et=t.overscaling,t.zoom>18&&et>2&&(et>>=1),Math.max(pt/(512*et),1)*B.get("symbol-spacing")),Ce=B.get("text-padding")*t.tilePixelRatio,De=B.get("icon-padding")*t.tilePixelRatio,Ue=Ei(B.get("text-max-angle")),ze=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",$e=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",rt=B.get("symbol-placement"),We=ve/2;var et;let He=B.get("icon-text-fit").evaluate(e,{},T),tt=B.get("icon-text-fit-padding").evaluate(e,{},T),lt=He!=="none",nt;t.hasAnyIconTextFit===!1&&lt&&(t.hasAnyIconTextFit=!0),a&&lt&&(t.allowVerticalPlacement&&n.vertical&&(nt=SS(a,n.vertical,He,tt,W,pe)),J&&(a=SS(a,J,He,tt,W,pe)));let Mt=(ot,ht,Vt)=>{if(ht.x<0||ht.x>=pt||ht.y<0||ht.y>=pt)return;let Ft=null;if(ee){let{x:Ot,y:ct,z:jt}=E.projectTilePoint(ht.x,ht.y,Vt);Ft={anchor:new Rl(Ot,ct,jt,0,void 0),up:E.upVector(Vt,ht.x,ht.y)}}(function(Ot,ct,jt,ai,Zt,di,si,xi,qt,on,rn,ji,Ai,Ui,_n,hn,Fn,On,eo,Un,Tn,lr,Ar,Pr,mn,vo,Ll){let Oa=Ot.addToLineVertexArray(ct,ai),ds,rd,od,Rh,VM,jM,UM,HM=0,WM=0,GM=0,qM=0,Px=-1,Ox=-1,Gs={},$M=Cc(""),Lh=jt?jt.anchor:ct,Rx=qt.layout.get("icon-text-fit").evaluate(Tn,{},mn)!=="none",Lx=0,Fx=0;if(qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Lx,Fx]=qt.layout.get("text-offset").evaluate(Tn,{},mn).map(Go=>Go*Gr):(Lx=qt.layout.get("text-radial-offset").evaluate(Tn,{},mn)*Gr,Fx=ix),Ot.allowVerticalPlacement&&Zt.vertical){let Go=Zt.vertical;if(_n)jM=rx(Go),xi&&(UM=rx(xi));else{let qo=qt.layout.get("text-rotate").evaluate(Tn,{},mn)+90;od=x0(on,Lh,ct,rn,ji,Ai,Go,Ui,qo,hn),xi&&(Rh=x0(on,Lh,ct,rn,ji,Ai,xi,On,qo))}}if(di){let Go=qt.layout.get("icon-rotate").evaluate(Tn,{},mn),qo=LS(di,Go,Ar,Rx),vm=xi?LS(xi,Go,Ar,Rx):void 0;rd=x0(on,Lh,ct,rn,ji,Ai,di,On,Go),HM=4*qo.length;let YM=Ot.iconSizeData,Fh=null;YM.kind==="source"?(Fh=[ns*qt.layout.get("icon-size").evaluate(Tn,{},mn)],Fh[0]>Kc&&Zn(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${zf}. Reduce your "icon-size".`)):YM.kind==="composite"&&(Fh=[ns*lr.compositeIconSizes[0].evaluate(Tn,{},mn),ns*lr.compositeIconSizes[1].evaluate(Tn,{},mn)],(Fh[0]>Kc||Fh[1]>Kc)&&Zn(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${zf}. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,qo,Fh,Un,eo,Tn,!1,jt,ct,Oa.lineStartIndex,Oa.lineLength,-1,Pr,mn,vo,Ll),Px=Ot.icon.placedSymbolArray.length-1,vm&&(WM=4*vm.length,Ot.addSymbols(Ot.icon,vm,Fh,Un,eo,Tn,pa.vertical,jt,ct,Oa.lineStartIndex,Oa.lineLength,-1,Pr,mn,vo,Ll),Ox=Ot.icon.placedSymbolArray.length-1)}for(let Go in Zt.horizontal){let qo=Zt.horizontal[Go];ds||($M=Cc(qo.text),_n?VM=rx(qo):ds=x0(on,Lh,ct,rn,ji,Ai,qo,Ui,qt.layout.get("text-rotate").evaluate(Tn,{},mn),hn));let vm=qo.positionedLines.length===1;if(GM+=BS(Ot,jt,ct,qo,si,qt,_n,Tn,hn,Oa,Zt.vertical?pa.horizontal:pa.horizontalOnly,vm?Object.keys(Zt.horizontal):[Go],Gs,Px,lr,Pr,mn,vo),vm)break}Zt.vertical&&(qM+=BS(Ot,jt,ct,Zt.vertical,si,qt,_n,Tn,hn,Oa,pa.vertical,["vertical"],Gs,Ox,lr,Pr,mn,vo));let ad=-1,zx=(Go,qo)=>Go?Math.max(Go,qo):qo;ad=zx(VM,ad),ad=zx(jM,ad),ad=zx(UM,ad);let f3=ad>-1?1:0;Ot.glyphOffsetArray.length>=65535&&Zn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tn.sortKey!==void 0&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,Tn.sortKey),Ot.symbolInstances.emplaceBack(ct.x,ct.y,Lh.x,Lh.y,Lh.z,Gs.right>=0?Gs.right:-1,Gs.center>=0?Gs.center:-1,Gs.left>=0?Gs.left:-1,Gs.vertical>=0?Gs.vertical:-1,Px,Ox,$M,ds!==void 0?ds:Ot.collisionBoxArray.length,ds!==void 0?ds+1:Ot.collisionBoxArray.length,od!==void 0?od:Ot.collisionBoxArray.length,od!==void 0?od+1:Ot.collisionBoxArray.length,rd!==void 0?rd:Ot.collisionBoxArray.length,rd!==void 0?rd+1:Ot.collisionBoxArray.length,Rh||Ot.collisionBoxArray.length,Rh?Rh+1:Ot.collisionBoxArray.length,rn,GM,qM,HM,WM,f3,0,Lx,Fx,ad,0,1,1,Rx?1:0)})(t,ht,Ft,ot,n,a,c,nt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Ce,ze,y,0,De,$e,W,e,m,w,M,T,P,R)};if(rt==="line")for(let ot of DS(e.geometry,0,0,pt,pt)){let ht=GO(ot,ve,Ue,n.vertical||J,a,te,he,t.overscaling,pt);for(let Vt of ht)J&&QO(t,J.text,We,Vt)||Mt(ot,Vt,T)}else if(rt==="line-center"){for(let ot of e.geometry)if(ot.length>1){let ht=WO(ot,Ue,n.vertical||J,a,te,he);ht&&Mt(ot,ht,T)}}else if(e.type==="Polygon")for(let ot of n0(e.geometry,0)){let ht=$O(ot,16);Mt(ot[0],new Rl(ht.x,ht.y,0,0,void 0),T)}else if(e.type==="LineString")for(let ot of e.geometry)Mt(ot,new Rl(ot[0].x,ot[0].y,0,0,void 0),T);else if(e.type==="Point")for(let ot of e.geometry)for(let ht of ot)Mt([ht],new Rl(ht.x,ht.y,0,0,void 0),T)}let zf=255,Kc=zf*ns;function BS(t,e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B,W){let J=function(pe,he,ve,Ce,De,Ue,ze,$e){let rt=[];if(he.positionedLines.length===0)return rt;let We=Ce.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,et=function(Mt){let ot=Mt[0],ht=Mt[1],Vt=ot*ht;return Vt>0?[ot,-ht]:Vt<0?[-ot,ht]:ot===0?[ht,ot]:[ht,-ot]}(ve),He=Math.abs(he.top-he.bottom);for(let Mt of he.positionedLines)He-=Mt.lineOffset;let tt=he.positionedLines.length,lt=He/tt,nt=he.top-ve[1];for(let Mt=0;Mt<tt;++Mt){let ot=he.positionedLines[Mt];nt=qO(he,lt,nt,Mt);for(let ht of ot.positionedGlyphs){if(!ht.rect)continue;let Vt=ht.rect||{},Ft=bS+1,Ot=!0,ct=1,jt=0;if(ht.imageName){let Un=ze[ht.imageName];if(!Un)continue;if(Un.sdf){Zn("SDF images are not supported in formatted text and will be ignored.");continue}Ot=!1,ct=Un.pixelRatio,Ft=Ho/ct}let ai=(De||$e)&&ht.vertical,Zt=ht.metrics.advance*ht.scale/2,di=ht.metrics,si=ht.rect;if(si===null)continue;$e&&he.verticalizable&&(jt=ht.imageName?Zt-ht.metrics.width*ht.scale/2:0);let xi=De?[ht.x+Zt,ht.y]:[0,0],qt=[0,0],on=[0,0],rn=!1;De||(ai?(on=[ht.x+Zt+et[0],ht.y+et[1]-jt],rn=!0):qt=[ht.x+Zt+ve[0],ht.y+ve[1]-jt]);let ji=si.w*ht.scale/(ct*(ht.localGlyph?rs:1)),Ai=si.h*ht.scale/(ct*(ht.localGlyph?rs:1)),Ui,_n,hn,Fn;if(ai){let Un=ht.y-nt,Tn=new xt(-Zt,Zt-Un),lr=-Math.PI/2,Ar=new xt(...on);Ui=new xt(-Zt+qt[0],qt[1]),Ui._rotateAround(lr,Tn)._add(Ar),Ui.x+=-Un+Zt,Ui.y-=(di.left-Ft)*ht.scale;let Pr=ht.imageName?di.advance*ht.scale:Gr*ht.scale,mn=String.fromCodePoint(ht.glyph);FO(mn)?Ui.x+=(1-Ft)*ht.scale:zO(mn)?Ui.x+=Pr-di.height*ht.scale+(-Ft-1)*ht.scale:Ui.x+=ht.imageName||di.width+2*Ft===si.w&&di.height+2*Ft===si.h?(Pr-Ai)/2:(Pr-(di.height+2*Ft)*ht.scale)/2,_n=new xt(Ui.x,Ui.y-ji),hn=new xt(Ui.x+Ai,Ui.y),Fn=new xt(Ui.x+Ai,Ui.y-ji)}else{let Un=(di.left-Ft)*ht.scale-Zt+qt[0],Tn=(-di.top-Ft)*ht.scale+qt[1],lr=Un+ji,Ar=Tn+Ai;Ui=new xt(Un,Tn),_n=new xt(lr,Tn),hn=new xt(Un,Ar),Fn=new xt(lr,Ar)}if(We){let Un;Un=De?new xt(0,0):rn?new xt(et[0],et[1]):new xt(ve[0],ve[1]),Ui._rotateAround(We,Un),_n._rotateAround(We,Un),hn._rotateAround(We,Un),Fn._rotateAround(We,Un)}let On=new xt(0,0),eo=new xt(0,0);rt.push({tl:Ui,tr:_n,bl:hn,br:Fn,texPrimary:Vt,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:xi,sectionIndex:ht.sectionIndex,isSDF:Ot,pixelOffsetTL:On,pixelOffsetBR:eo,minFontScaleX:0,minFontScaleY:0})}}return rt}(0,a,y,m,p,b,c,t.allowVerticalPlacement),ee=t.textSizeData,te=null;ee.kind==="source"?(te=[ns*m.layout.get("text-size").evaluate(b,{},B)],te[0]>Kc&&Zn(`${t.layerIds[0]}: Value for "text-size" is >= ${zf}. Reduce your "text-size".`)):ee.kind==="composite"&&(te=[ns*R.compositeTextSizes[0].evaluate(b,{},B),ns*R.compositeTextSizes[1].evaluate(b,{},B)],(te[0]>Kc||te[1]>Kc)&&Zn(`${t.layerIds[0]}: Value for "text-size" is >= ${zf}. Reduce your "text-size".`)),t.addSymbols(t.text,J,te,y,p,b,M,e,n,w.lineStartIndex,w.lineLength,P,F,B,W,!1);for(let pe of T)E[pe]=t.text.placedSymbolArray.length-1;return 4*J.length}function NS(t){for(let e in t)return t[e];return null}function x0(t,e,n,a,c,m,p,b,y,w){let M=p.top,T=p.bottom,E=p.left,P=p.right,R=p.collisionPadding;if(R&&(E-=R[0],M-=R[1],P+=R[2],T+=R[3]),y){let F=new xt(E,M),B=new xt(P,M),W=new xt(E,T),J=new xt(P,T),ee=Ei(y),te=new xt(0,0);w&&(te=new xt(w[0],w[1])),F._rotateAround(ee,te),B._rotateAround(ee,te),W._rotateAround(ee,te),J._rotateAround(ee,te),E=Math.min(F.x,B.x,W.x,J.x),P=Math.max(F.x,B.x,W.x,J.x),M=Math.min(F.y,B.y,W.y,J.y),T=Math.max(F.y,B.y,W.y,J.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,E,M,P,T,b,a,c,m),t.length-1}function rx(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function QO(t,e,n,a){let c=t.compareText;if(e in c){let m=c[e];for(let p=m.length-1;p>=0;p--)if(a.dist(m[p])<n)return!0}else c[e]=[];return c[e].push(a),!1}function VS(t,e){let n=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),m=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),p=Math.sin(t._pitch)*m+c;return Math.min(1.01*p,c*(1/t._horizonShift))}function Eh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),a=t.x*n,c=(t.x+1)*n,m=t.y*n,p=(t.y+1)*n,b=Oo(a),y=Oo(c),w=Dr(m),M=Dr(p),T=e.project(b,w),E=e.project(y,w),P=e.project(y,M),R=e.project(b,M),F=Math.min(T.x,E.x,P.x,R.x),B=Math.min(T.y,E.y,P.y,R.y),W=Math.max(T.x,E.x,P.x,R.x),J=Math.max(T.y,E.y,P.y,R.y),ee=n/16;function te(he,ve,Ce,De,Ue,ze){let $e=(Ce+Ue)/2,rt=(De+ze)/2,We=e.project(Oo($e),Dr(rt)),et=Math.max(0,F-We.x,B-We.y,We.x-W,We.y-J);F=Math.min(F,We.x),W=Math.max(W,We.x),B=Math.min(B,We.y),J=Math.max(J,We.y),et>ee&&(te(he,We,Ce,De,$e,rt),te(We,ve,$e,rt,Ue,ze))}te(T,E,a,m,c,m),te(E,P,c,m,c,p),te(P,R,c,p,a,p),te(R,T,a,p,a,m),F-=ee,B-=ee,W+=ee,J+=ee;let pe=1/Math.max(W-F,J-B);return{scale:pe,x:F*pe,y:B*pe,x2:W*pe,y2:J*pe,projection:e}}function jS(t,{x:e,y:n},a=0){return new xt(((e-a)*t.scale-t.x)*pt,(n*t.scale-t.y)*pt)}let KO=i.ad.identity(new Float32Array(16));class Jc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Li(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return yo(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return VS(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,c){let m=e.horizonLineFromTop(!1),p=new xt(n,Math.max(m,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,n,a){let c=new xt(n,a);if(e.elevation)return e.elevation.pointCoordinate(c);{let m=this.pointCoordinate(e,c.x,c.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);let a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return KO}createTileMatrix(e,n,a){let c,m,p,b=a.canonical,y=i.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=Eh(b,this);c=1,m=w.x+a.wrap*w.scale,p=w.y,i.ad.scale(y,y,[c/w.scale,c/w.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*a.wrap)*c,p=b.y*c;return i.ad.translate(y,y,[m,p,0]),i.ad.scale(y,y,[c/pt,c/pt,1]),y}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class JO extends Jc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Ei(n));this.n=(c+Math.sin(Ei(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:a,c,r0:m}=this,p=Ei(e-this.center[0]),b=Ei(n),y=Math.sqrt(c-2*a*Math.sin(b))/a;return{x:y*Math.sin(p*a),y:y*Math.cos(p*a)-m,z:0}}unproject(e,n){let{n:a,c,r0:m}=this,p=m+n,b=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(b-=Math.PI*Math.sign(e)*Math.sign(p));let y=Ei(this.center[0])*a;b=hl(b,-Math.PI-y,Math.PI-y);let w=pi(Ur(b/a)+this.center[0],-180,180),M=Math.asin(pi((c-(e*e+p*p)*a*a)/(2*a),-1,1)),T=pi(Ur(M),-Qn,Qn);return new Li(w,T)}}let Bf=1.340264,Nf=-.081106,Vf=893e-6,jf=.003796,w0=Math.sqrt(3)/2;class eR extends Jc{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(w0*Math.sin(n)),c=a*a,m=c*c*c;return{x:.5*(e*Math.cos(a)/(w0*(Bf+3*Nf*c+m*(7*Vf+9*jf*c)))/Math.PI+.5),y:1-.5*(a*(Bf+Nf*c+m*(Vf+jf*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=a*a,m=c*c*c;for(let M,T,E,P=0;P<12&&(T=a*(Bf+Nf*c+m*(Vf+jf*c))-n,E=Bf+3*Nf*c+m*(7*Vf+9*jf*c),M=T/E,a=pi(a-M,-Math.PI/3,Math.PI/3),c=a*a,m=c*c*c,!(Math.abs(M)<1e-12));++P);let p=w0*e*(Bf+3*Nf*c+m*(7*Vf+9*jf*c))/Math.cos(a),b=Math.asin(Math.sin(a)/w0),y=pi(180*p/Math.PI,-180,180),w=pi(180*b/Math.PI,-Qn,Qn);return new Li(y,w)}}class tR extends Jc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let a=360*(e-.5),c=pi(360*(.5-n),-Qn,Qn);return new Li(a,c)}}let um=Math.PI/2;function C0(t){return Math.tan((um+t)/2)}class iR extends Jc{constructor(e){super(e),this.center=e.center||[0,30];let[n,a]=this.parallels=e.parallels||[30,30],c=Ei(n),m=Ei(a);this.southernCenter=c+m<0,this.southernCenter&&(c=-c,m=-m);let p=Math.cos(c),b=C0(c);this.n=c===m?Math.sin(c):Math.log(p/Math.cos(m))/Math.log(C0(m)/b),this.f=p*Math.pow(C0(c),this.n)/this.n}project(e,n){n=Ei(n),this.southernCenter&&(n=-n),e=Ei(e-this.center[0]);let a=1e-6,{n:c,f:m}=this;m>0?n<-um+a&&(n=-um+a):n>um-a&&(n=um-a);let p=m/Math.pow(C0(n),c),b=p*Math.sin(c*e),y=m-p*Math.cos(c*e);return b=.5*(b/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:b,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:a,f:c}=this,m=c-n,p=Math.sign(m),b=Math.sign(a)*Math.sqrt(e*e+m*m),y=Math.atan2(e,Math.abs(m))*p;m*a<0&&(y-=Math.PI*Math.sign(e)*p);let w=pi(Ur(y/a)+this.center[0],-180,180),M=pi(Ur(2*Math.atan(Math.pow(c/b,1/a))-um),-Qn,Qn);return new Li(w,this.southernCenter?-M:M)}}class US extends Jc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ns(e),y:Vs(n),z:0}}unproject(e,n){let a=Oo(e),c=Dr(n);return new Li(a,c)}}let HS=Ei(Qn);class nR extends Jc{project(e,n){let a=(n=Ei(n))*n,c=a*a;return{x:.5*((e=Ei(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=25,m=0,p=a*a;do{p=a*a;let w=p*p;m=(a*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-n)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),a=pi(a-m,-HS,HS)}while(Math.abs(m)>1e-6&&--c>0);p=a*a;let b=pi(Ur(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=Ur(a);return new Li(b,y)}}let WS=Ei(Qn);class rR extends Jc{project(e,n){n=Ei(n),e=Ei(e);let a=Math.cos(n),c=2/Math.PI,m=Math.acos(a*Math.cos(e/2)),p=Math.sin(m)/m,b=.5*(e*c+2*a*Math.sin(e/2)/p)||0,y=.5*(n+Math.sin(n)/p)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,m=25,p=1e-6,b=0,y=0;do{let w=Math.cos(c),M=Math.sin(c),T=2*M*w,E=M*M,P=w*w,R=Math.cos(a/2),F=Math.sin(a/2),B=2*R*F,W=F*F,J=1-P*R*R,ee=J?1/J:0,te=J?Math.acos(w*R)*Math.sqrt(1/J):0,pe=.5*(2*te*w*F+2*a/Math.PI)-e,he=.5*(te*M+c)-n,ve=.5*ee*(P*W+te*w*R*E)+1/Math.PI,Ce=ee*(B*T/4-te*M*F),De=.125*ee*(T*F-te*M*P*B),Ue=.5*ee*(E*R+te*W*w)+.5,ze=Ce*De-Ue*ve;b=(he*Ce-pe*Ue)/ze,y=(pe*De-he*ve)/ze,a=pi(a-b,-Math.PI,Math.PI),c=pi(c-y,-WS,WS)}while((Math.abs(b)>p||Math.abs(y)>p)&&--m>0);return new Li(Ur(a),Ur(c))}}class GS extends Jc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ei(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:a,cosPhi:c}=this;return{x:Ei(e)*c*a+.5,y:-Math.sin(Ei(n))/c*a+.5,z:0}}unproject(e,n){let{scale:a,cosPhi:c}=this,m=-(n-.5)/a,p=pi(Ur((e-.5)/a)/c,-180,180),b=Math.asin(pi(m*c,-1,1)),y=pi(Ur(b),-Qn,Qn);return new Li(p,y)}}class oR extends US{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){let c=Sf(e,n,a),m=Mf(js(a));return i._.transformMat4(c,c,m),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){let a=Sh(n.lat,n.lng),c=i._.normalize([],a),m=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=yo(1,0)*pt*m;i._.scaleAndAdd(a,a,c,p);let b=i.ad.identity(new Float64Array(16));return i.ad.multiply(b,e.pixelMatrix,e.globeMatrix),i._.transformMat4(a,a,b),new xt(a[0],a[1])}pixelsPerMeter(e,n){return yo(1,0)*n}pixelSpaceConversion(e,n,a){let c=yo(1,e)*n,m=Wt(yo(1,45)*n,c,a);return this.pixelsPerMeter(e,n)/m}createTileMatrix(e,n,a){let c=Lv(js(a.canonical));return i.ad.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){let{center:a}=e,c=Mf(js(n));return i.ad.rotateY(c,c,Ei(a.lng)),i.ad.rotateX(c,c,Ei(a.lat)),i.ad.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,a,c){return KC(e,n,a,!0)||new Jr(0,0)}pointCoordinate3D(e,n,a){let c=this.pointCoordinate(e,n,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!KC(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(c,m){let p=c.cameraToCenterDistance,b=c._centerAltitude*m,y=c._camera,w=c._camera.forward(),M=i._.add([],i._.scale([],w,-p),[0,0,b]),T=c.worldSize/(2*Math.PI),E=[0,0,-T],P=c.width/c.height,R=Math.tan(c.fovAboveCenter),F=i._.scale([],y.up(),R),B=i._.scale([],y.right(),R*P),W=i._.normalize([],i._.add([],i._.add([],w,F),B)),J=[],ee;if(new Dv(M,W).closestPointOnSphere(E,T,J)){let te=i._.add([],J,E),pe=i._.sub([],te,M);ee=Math.cos(c.fovAboveCenter)*i._.length(pe)}else{let te=i._.sub([],M,E),pe=i._.sub([],E,M);i._.normalize(pe,pe);let he=i._.length(te)-T;ee=Math.sqrt(he*(he+2*T));let ve=Math.acos(ee/(T+he))-Math.acos(i._.dot(w,pe));ee*=Math.cos(ve)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Pl(e.zoom);if(a>0){let c=VS(e,yo(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Wt(n,c+m*(1-Math.cos(p)),Math.pow(a,10))}return n}upVector(e,n,a){return Sf(n,a,e,1)}upVectorScale(e){return{metersToTile:Q_(J_(js(e)))}}}function qS(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new US(t);case"equirectangular":return new tR(t);case"naturalEarth":return new nR(t);case"equalEarth":return new eR(t);case"winkelTripel":return new rR(t);case"albers":return n?new GS(t):new JO(t);case"lambertConformalConic":return n?new GS(t):new iR(t);case"globe":return new oR(t)}throw new Error(`Invalid projection name: ${t.name}`)}let aR=(()=>{class t{constructor(n,a,c,m){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||m||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class mm{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}mm.ReadOnly=!1,mm.ReadWrite=!0,mm.disabled=new mm(519,mm.ReadOnly,[0,1]);let ox=7680;class ax{constructor(e,n,a,c,m,p){this.test=e,this.ref=n,this.mask=a,this.fail=c,this.depthFail=m,this.pass=p}}ax.disabled=new ax({func:519,mask:0},0,0,ox,ox,ox);let Uf=771;class Wo{constructor(e,n,a,c){this.blendFunction=e,this.blendColor=n,this.mask=a,this.blendEquation=c}}Wo.Replace=[1,0,1,0],Wo.disabled=new Wo(Wo.Replace,Bi.transparent,[!1,!1,!1,!1]),Wo.unblended=new Wo(Wo.Replace,Bi.transparent,[!0,!0,!0,!0]),Wo.alphaBlended=new Wo([1,Uf,1,Uf],Bi.transparent,[!0,!0,!0,!0]),Wo.alphaBlendedNonPremultiplied=new Wo([770,Uf,770,Uf],Bi.transparent,[!0,!0,!0,!0]),Wo.multiply=new Wo([774,0,774,0],Bi.transparent,[!0,!0,!0,!0]);let sx=1029,lx=2305;class os{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}os.disabled=new os(!1,sx,lx),os.backCCW=new os(!0,sx,lx),os.backCW=new os(!0,sx,2304),os.frontCW=new os(!0,1028,2304),os.frontCCW=new os(!0,1028,lx);let sR=a0.types,lR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function S0(t,e,n,a,c,m,p,b,y,w,M,T,E){let P=b?Math.min(Kc,Math.round(b[0])):0,R=b?Math.min(Kc,Math.round(b[1])):0;t.emplaceBack(e,n,Math.round(32*a),Math.round(32*c),m,p,(P<<1)+(y?1:0),R,16*w,16*M,256*T,256*E)}function M0(t,e,n){t.emplaceBack(e,n)}function k0(t,e,n,a,c,m,p){t.emplaceBack(e,n,a,c,m,p)}function I0(t,e,n,a,c){t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c)}function cR(t){for(let e of t.sections)if(Ye(e.text))return!0;return!1}class cx{constructor(e){this.layoutVertexArray=new Jy,this.indexArray=new wr,this.programConfigurations=e,this.segments=new An,this.dynamicLayoutVertexArray=new Vc,this.opacityVertexArray=new tv,this.occlusionQueryOpacityVertexArray=new xh,this.placedSymbolArray=new wC,this.iconTransitioningVertexArray=new Hc,this.globeExtVertexArray=new ev,this.zOffsetVertexArray=new xh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,c,m){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,uO.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,lR,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,Yv.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,mO.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hO.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,eS.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ne(cx,"SymbolBuffers");class dx{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new An,this.collisionVertexArray=new rv,this.collisionVertexArrayExt=new Vc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,pO.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,fO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ne(dx,"CollisionBuffers");class pm{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=i.ad.identity([]),this.placementViewportMatrix=i.ad.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Xv(this.zoom,n["text-size"]),this.iconSizeData=Xv(this.zoom,n["icon-size"]);let a=this.layers[0].layout,c=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>pa[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new cx(new Gc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new cx(new Gc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new MC,this.lineVertexArray=new kC,this.symbolInstances=new SC}calculateGlyphDependencies(e,n,a,c,m){for(let p=0;p<e.length;p++){let b=e.codePointAt(p);if(b===void 0)break;if(n[b]=!0,c&&m&&b<=65535){let y=Rf[e.charAt(p)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!qv(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,n,a,c){let m=this.layers[0],p=m.layout,b=this.projection.name==="globe",y=p.get("text-font"),w=p.get("text-field"),M=p.get("icon-image"),T=(w.value.kind!=="constant"||w.value.value instanceof Wr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),E=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,P=p.get("symbol-sort-key");if(this.features=[],!T&&!E)return;let R=n.iconDependencies,F=n.glyphDependencies,B=n.availableImages,W=new Qt(this.zoom);for(let{feature:J,id:ee,index:te,sourceLayerIndex:pe}of e){let he=m._featureFilter.needGeometry,ve=Dl(J,he);if(!m._featureFilter.filter(W,ve,a))continue;if(he||(ve.geometry=is(J,a,c)),b&&J.type!==1&&a.z<=5){let ze=ve.geometry,$e=.98078528056,rt=(We,et)=>{let He=Sf(We.x,We.y,a,1),tt=Sf(et.x,et.y,a,1);return i._.dot(He,tt)<$e};for(let We=0;We<ze.length;We++)ze[We]=$A(ze[We],rt)}let Ce,De;if(T){let ze=m.getValueAndResolveTokens("text-field",ve,a,B),$e=Wr.factory(ze);cR($e)&&(this.hasRTLText=!0),(!this.hasRTLText||vi()==="unavailable"||this.hasRTLText&&Ji.isParsed())&&(Ce=LO($e,m,ve))}if(E){let ze=m.getValueAndResolveTokens("icon-image",ve,a,B);De=ze instanceof so?ze:so.fromString(ze)}if(!Ce&&!De)continue;let Ue=this.sortFeaturesByKey?P.evaluate(ve,{},a):void 0;if(this.features.push({id:ee,text:Ce,icon:De,index:te,sourceLayerIndex:pe,geometry:ve.geometry,properties:J.properties,type:sR[J.type],sortKey:Ue}),De&&(R[De.namePrimary]=!0,De.nameSecondary&&(R[De.nameSecondary]=!0)),Ce){let ze=y.evaluate(ve,{},a).join(","),$e=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(pa.vertical)>=0;for(let rt of Ce.sections)if(rt.image)R[rt.image.namePrimary]=!0;else{let We=Le(Ce.toString()),et=rt.fontStack||ze,He=F[et]=F[et]||{};this.calculateGlyphDependencies(rt.text,He,$e,this.allowVerticalPlacement,We)}}}p.get("symbol-placement")==="line"&&(this.features=function(J){let ee={},te={},pe=[],he=0;function ve(ze){pe.push(J[ze]),he++}function Ce(ze,$e,rt){let We=te[ze];return delete te[ze],te[$e]=We,pe[We].geometry[0].pop(),pe[We].geometry[0]=pe[We].geometry[0].concat(rt[0]),We}function De(ze,$e,rt){let We=ee[$e];return delete ee[$e],ee[ze]=We,pe[We].geometry[0].shift(),pe[We].geometry[0]=rt[0].concat(pe[We].geometry[0]),We}function Ue(ze,$e,rt){let We=rt?$e[0][$e[0].length-1]:$e[0][0];return`${ze}:${We.x}:${We.y}`}for(let ze=0;ze<J.length;ze++){let $e=J[ze],rt=$e.geometry,We=$e.text?$e.text.toString():null;if(!We){ve(ze);continue}let et=Ue(We,rt),He=Ue(We,rt,!0);if(et in te&&He in ee&&te[et]!==ee[He]){let tt=De(et,He,rt),lt=Ce(et,He,pe[tt].geometry);delete ee[et],delete te[He],te[Ue(We,pe[lt].geometry,!0)]=lt,pe[tt].geometry=null}else et in te?Ce(et,He,rt):He in ee?De(et,He,rt):(ve(ze),ee[et]=he-1,te[He]=he-1)}return pe.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ee)=>J.sortKey-ee.sortKey)}update(e,n,a,c,m){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let b=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,b,a,c,m),this.icon.programConfigurations.updatePaintArrays(e,n,b,a,c,m)}updateOcclusionOpacities(e,n,a){if(!n.useOcclusionQueries)return!1;let c=this;if(c.projection.name==="globe")return!1;let m=!1;c.hasTextData()&&(m=m||c.text.occlusionQueryOpacityVertexArray.length!==0),c.hasIconData()&&(m=m||c.icon.occlusionQueryOpacityVertexArray.length!==0);let p=c.layers[0].paint,b=p.get("icon-occlusion-opacity").constantOr(0),y=p.get("text-occlusion-opacity").constantOr(0);if(!c.layers[0].hasInitialOcclusionOpacityProperties||b===1&&y===1)return!1;let w=!m;for(let P=0;P<c.symbolInstances.length;P++){let R=c.symbolInstances.get(P),F=R.occlusionOpacity;R.occlusionOpacity+=(R.occlusionState>.5?1:-1)*n.fadeSpeed*a*.001,R.occlusionOpacity=pi(R.occlusionOpacity,0,1),w=w||R.occlusionOpacity!==F}if(!w)return!1;let M=0,T=0,E=(P,R,F,B)=>{let W=0,J=0;F?(W=T,T+=B,J=T):(W=M,M+=B,J=M),J>R.occlusionQueryOpacityVertexArray.length&&R.occlusionQueryOpacityVertexArray.resize(J);let ee=P.occlusionOpacity;for(let te=0;te<B;te++)R.occlusionQueryOpacityVertexArray.emplace(te+W,ee)};for(let P=0;P<c.symbolInstances.length;P++){let R=c.symbolInstances.get(P),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:B,numIconVertices:W}=R,J=W>0;if((F>0||B>0)&&(E(R,c.text,!1,F),E(R,c.text,!1,B)),J){let{placedIconSymbolIndex:ee,verticalPlacedIconSymbolIndex:te}=R;ee>=0&&E(R,c.icon,!0,W),te>=0&&E(R,c.icon,!0,R.numVerticalIconVertices)}}return c.hasTextData()&&c.text.occlusionQueryOpacityVertexBuffer&&(c.text.occlusionQueryOpacityVertexBuffer.length<c.text.occlusionQueryOpacityVertexArray.length?c.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.text.occlusionQueryOpacityVertexArray,Yv.members,!0):c.text.occlusionQueryOpacityVertexBuffer.updateData(c.text.occlusionQueryOpacityVertexArray)),c.hasIconData()&&c.icon.occlusionQueryOpacityVertexBuffer&&(c.icon.occlusionQueryOpacityVertexBuffer.length<c.icon.occlusionQueryOpacityVertexArray.length?c.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(c.icon.occlusionQueryOpacityVertexArray,Yv.members,!0):c.icon.occlusionQueryOpacityVertexBuffer.updateData(c.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){let e=(m,p,b)=>{a+=p,a>m.length&&m.resize(a);for(let y=-p;y<0;y++)m.emplace(y+a,b)},n=(m,p,b)=>{c+=p,c>m.length&&m.resize(c);for(let y=-p;y<0;y++)m.emplace(y+c,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:y,numIconVertices:w}=p,M=p.zOffset,T=w>0;if((b>0||y>0)&&(e(this.text.zOffsetVertexArray,b,M),e(this.text.zOffsetVertexArray,y,M)),T){let{placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:P}=p;E>=0&&n(this.icon.zOffsetVertexArray,w,M),P>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=qS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(let e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:c,y:m}of n)this.lineVertexArray.emplaceBack(c,m);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,c,m,p,b,y,w,M,T,E,P,R,F,B){let W=e.indexArray,J=e.layoutVertexArray,ee=e.globeExtVertexArray,te=e.segments.prepareSegment(4*n.length,J,W,this.canOverlap?p.sortKey:void 0),pe=this.glyphOffsetArray.length,he=te.vertexLength,ve=this.allowVerticalPlacement&&b===pa.vertical?Math.PI/2:0,Ce=p.text&&p.text.sections;for(let Ue=0;Ue<n.length;Ue++){let{tl:ze,tr:$e,bl:rt,br:We,texPrimary:et,texSecondary:He,pixelOffsetTL:tt,pixelOffsetBR:lt,minFontScaleX:nt,minFontScaleY:Mt,glyphOffset:ot,isSDF:ht,sectionIndex:Vt}=n[Ue],Ft=te.vertexLength,Ot=ot[1];if(S0(J,w.x,w.y,ze.x,Ot+ze.y,et.x,et.y,a,ht,tt.x,tt.y,nt,Mt),S0(J,w.x,w.y,$e.x,Ot+$e.y,et.x+et.w,et.y,a,ht,lt.x,tt.y,nt,Mt),S0(J,w.x,w.y,rt.x,Ot+rt.y,et.x,et.y+et.h,a,ht,tt.x,lt.y,nt,Mt),S0(J,w.x,w.y,We.x,Ot+We.y,et.x+et.w,et.y+et.h,a,ht,lt.x,lt.y,nt,Mt),y){let{x:ct,y:jt,z:ai}=y.anchor,[Zt,di,si]=y.up;k0(ee,ct,jt,ai,Zt,di,si),k0(ee,ct,jt,ai,Zt,di,si),k0(ee,ct,jt,ai,Zt,di,si),k0(ee,ct,jt,ai,Zt,di,si),I0(e.dynamicLayoutVertexArray,ct,jt,ai,ve)}else I0(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ve);if(B){let ct=He||et;M0(e.iconTransitioningVertexArray,ct.x,ct.y),M0(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y),M0(e.iconTransitioningVertexArray,ct.x,ct.y+ct.h),M0(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y+ct.h)}W.emplaceBack(Ft,Ft+1,Ft+2),W.emplaceBack(Ft+1,Ft+2,Ft+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),Ue!==n.length-1&&Vt===n[Ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,p,p.index,{},P,R,F,Ce&&Ce[Vt])}let De=y?y.anchor:w;e.placedSymbolArray.emplaceBack(De.x,De.y,De.z,w.x,w.y,pe,this.glyphOffsetArray.length-pe,he,M,T,w.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],b,0,!1,0,E,0)}_commitLayoutVertex(e,n,a,c,m,p,b){e.emplaceBack(n,a,c,m,p,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,n,a,c,m,p,b){let y=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),w=y.vertexLength,M=b.tileAnchorX,T=b.tileAnchorY;for(let P=0;P<4;P++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,b.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new xt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new xt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new xt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,m,p,M,T,new xt(e.x1,e.y2)),y.vertexLength+=4;let E=a.indexArray;E.emplaceBack(w,w+1),E.emplaceBack(w+1,w+2),E.emplaceBack(w+2,w+3),E.emplaceBack(w+3,w),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceTextSize(e,p,n,b);this._addCollisionDebugVertices(y,w,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(y,w,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dx(U_,tS.members,Hc),this.iconCollisionBox=new dx(U_,tS.members,Hc);let a=lm(this.iconSizeData,e),c=lm(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,a,c){let m=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),p=g0(this.textSizeData,e,m)/Gr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,a){let c=this.icon.placedSymbolArray.get(a),m=g0(this.iconSizeData,e,c);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,n,a,c){e.emplaceBack(n,-a,-a,c),e.emplaceBack(n,a,-a,c),e.emplaceBack(n,a,a,c),e.emplaceBack(n,-a,a,c)}_updateTextDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceTextSize(e,p,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,y.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,c,m,p){for(let b=c;b<m;b++){let y=a.get(b),w=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,y.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=lm(this.iconSizeData,e),c=lm(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){let p=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,c,m,p,b,y,w){let M={};if(n<a){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(n);M.textBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.textFeatureIndex=pe}if(c<m){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(c);M.verticalTextBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.verticalTextFeatureIndex=pe}if(p<b){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(p);M.iconBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.iconFeatureIndex=pe}if(y<w){let{x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te,featureIndex:pe}=e.get(y);M.verticalIconBox={x1:T,y1:E,x2:P,y2:R,padding:F,projectedAnchorX:B,projectedAnchorY:W,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:te},M.verticalIconFeatureIndex=pe}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let a=e.placedSymbolArray.get(n),c=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),a=Math.cos(e),c=[],m=[],p=[];for(let b=0;b<this.symbolInstances.length;++b){p.push(b);let y=this.symbolInstances.get(b);c.push(0|Math.round(n*y.tileAnchorX+a*y.tileAnchorY)),m.push(y.featureIndex)}return p.sort((b,y)=>c[b]-c[y]||m[y]-m[b]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:w}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),m>=0&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),p>=0&&p!==m&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ne(pm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),pm.addDynamicAttributes=I0;class Aa{constructor(e,n,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,a){let{width:c,height:m}=e,{context:p}=this,{gl:b}=p;if(b.bindTexture(b.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===c&&this.size[1]===m){let{x:y,y:w}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)b.texSubImage2D(b.TEXTURE_2D,0,y,w,b.RGBA,b.UNSIGNED_BYTE,e);else{let M=this.format,T=b.UNSIGNED_BYTE;this.format===b.R32F&&(M=b.RED,T=b.FLOAT),b.texSubImage2D(b.TEXTURE_2D,0,y,w,c,m,M,T,e.data)}}else if(this.size=[c,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===b.R8&&(y=b.RED),b.texImage2D(b.TEXTURE_2D,0,this.format,y,b.UNSIGNED_BYTE,e)}else{let y=this.format,w=this.format,M=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(y=b.DEPTH_COMPONENT16,M=b.UNSIGNED_SHORT),this.format===b.R8&&(w=b.RED),this.format===b.R32F&&(M=b.FLOAT,w=b.RED),b.texImage2D(b.TEXTURE_2D,0,y,c,m,0,w,M,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n,a=!1){let{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,c){let{context:m}=this,{gl:p}=m;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class T0{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}let Pa=32,Hs=33,ed=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,a=0,c=0,m=0,p=0,b=0;for(1&e?c=m=p=Pa:n=a=b=Pa;(e>>=1)>1;){let w=n+c>>1,M=a+m>>1;1&e?(c=n,m=a,n=p,a=b):(n=c,a=m,c=p,m=b),p=w,b=M}let y=4*t;ed[y+0]=n,ed[y+1]=a,ed[y+2]=c,ed[y+3]=m}let Ws=new Uint16Array(2178),td=new Uint8Array(1089),E0=new Uint16Array(1089);function $S(t){return t===0?-.03125:t===32?.03125:0}var D0=$i([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),dR=$i([{name:"a_index",type:"Int16",components:1}]);let YS={type:2,extent:pt,loadGeometry:()=>[[new xt(0,0),new xt(pt+1,0),new xt(pt+1,pt+1),new xt(0,pt+1),new xt(0,0)]]};class A0{constructor(e,n,a,c,m){this.tileID=e,this.uid=hu(),this.uses=0,this.tileSize=n,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,c&&c.style&&(this._lastUpdatedBrightness=c.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Ir.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Eh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,m){let p={};if(!m)return p;for(let b of c){let y=b.layerIds.map(w=>m.getLayer(w)).filter(Boolean);if(y.length!==0){b.layers=y,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(w=>y.filter(M=>M.id===w)[0]));for(let w of y)p[w.fqid]=b}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let c in this.buckets){let m=this.buckets[c];if(m instanceof pm){if(this.hasSymbolBuckets=!0,!a)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let c in this.buckets){let m=this.buckets[c];if(m instanceof pm&&m.hasRTLText){this.hasRTLText=!0,Ji.isLoading()||Ji.isLoaded()||vi()!=="deferred"||Di();break}}this.queryPadding=0;for(let c in this.buckets){let m=this.buckets[c],p=n.style.getOwnLayer(c);if(!p)continue;let b=p.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,b)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new uv}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let c in this.buckets){let m=this.buckets[c];m.uploadPending()&&m.upload(e)}let n=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){let c=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new Aa(e,a.image,n.RGBA,{useMipmap:c}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Aa(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Aa(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let c=n.style.getBrightness();(this._lastUpdatedBrightness||c)&&(this._lastUpdatedBrightness&&c&&Math.abs(this._lastUpdatedBrightness-c)<.001||(this._lastUpdatedBrightness=c,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,a,c,m,p,b,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:b,transform:p,params:m,tileTransform:this.tileTransform},e,n,a):{}}querySourceFeatures(e,n){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let c=a.loadVTLayers(),m=n?n.sourceLayer:"",p=c._geojsonTileLayer||c[m];if(!p)return;let b=_r(n&&n.filter),{z:y,x:w,y:M}=this.tileID.canonical,T={z:y,x:w,y:M};for(let E=0;E<p.length;E++){let P=p.feature(E);if(b.needGeometry){let B=Dl(P,!0);if(!b.filter(new Qt(this.tileID.overscaledZ),B,this.tileID.canonical))continue}else if(!b.filter(new Qt(this.tileID.overscaledZ),P))continue;let R=a.getId(P,m),F=new fS(P,y,w,M,R);F.tile=T,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let a=wp(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let a=Date.now(),c=!1;if(this.expirationTime>a)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{let m=this.expirationTime-n;m?this.expirationTime=a+Math.max(m,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let a=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages(),m=n.style.getBrightness();for(let p in this.buckets){if(!n.style.hasLayer(p))continue;let b=this.buckets[p],y=b.layers[0].sourceLayer||"_geojsonTileLayer",w=a[y],M={};if(e&&(M=e[y],!w||!M||Object.keys(M).length===0))continue;if(b.update(M,w,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},m),b instanceof u0||b instanceof r0){let E=n.style.getOwnSourceCache(b.layers[0].source);n._terrain&&n._terrain.enabled&&E&&b.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(E.id,this.tileID)}let T=n&&n.style&&n.style.getOwnLayer(p);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ir.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ir.now()+e}setTexture(e,n){let a=n.context,c=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Aa?this.texture.update(e,{useMipmap:!0}):(this.texture=new Aa(a,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,n){let a={};for(let c of n)a[c]=!0;this.dependencies[e]=a}hasDependency(e,n){for(let a of e){let c=this.dependencies[a];if(c){for(let m of n)if(c[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let a=is(YS,this.tileID.canonical,this.tileTransform)[0],c=new es,m=new _f;for(let p=0;p<a.length;p++){let{x:b,y}=a[p];c.emplaceBack(b,y),m.emplaceBack(p)}m.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(c,Cf.members),this._tileDebugSegments=An.simpleSegment(0,0,c.length,m.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let a=is(YS,this.tileID.canonical,this.tileTransform)[0],c,m;if(this.isRaster){let p=function(b,y){let w=Eh(b,y),M=Math.pow(2,b.z);for(let B=0;B<Hs;B++)for(let W=0;W<Hs;W++){let J=Oo((b.x+(W+$S(W))/Pa)/M),ee=Dr((b.y+(B+$S(B))/Pa)/M),te=y.project(J,ee),pe=B*Hs+W;Ws[2*pe+0]=Math.round((te.x*w.scale-w.x)*pt),Ws[2*pe+1]=Math.round((te.y*w.scale-w.y)*pt)}td.fill(0),E0.fill(0);for(let B=2045;B>=0;B--){let W=4*B,J=ed[W+0],ee=ed[W+1],te=ed[W+2],pe=ed[W+3],he=J+te>>1,ve=ee+pe>>1,Ce=he+ve-ee,De=ve+J-he,Ue=ee*Hs+J,ze=pe*Hs+te,$e=ve*Hs+he,rt=Math.hypot((Ws[2*Ue+0]+Ws[2*ze+0])/2-Ws[2*$e+0],(Ws[2*Ue+1]+Ws[2*ze+1])/2-Ws[2*$e+1])>=16;td[$e]=td[$e]||(rt?1:0),B<1022&&(td[$e]=td[$e]||td[(ee+De>>1)*Hs+(J+Ce>>1)]||td[(pe+De>>1)*Hs+(te+Ce>>1)])}let T=new Nc,E=new wr,P=0;function R(B,W){let J=W*Hs+B;return E0[J]===0&&(T.emplaceBack(Ws[2*J+0],Ws[2*J+1],B*pt/Pa,W*pt/Pa),E0[J]=++P),E0[J]-1}function F(B,W,J,ee,te,pe){let he=B+J>>1,ve=W+ee>>1;if(Math.abs(B-te)+Math.abs(W-pe)>1&&td[ve*Hs+he])F(te,pe,B,W,he,ve),F(J,ee,te,pe,he,ve);else{let Ce=R(B,W),De=R(J,ee),Ue=R(te,pe);E.emplaceBack(Ce,De,Ue)}}return F(0,0,Pa,Pa,Pa,0),F(Pa,Pa,0,0,0,Pa),{vertices:T,indices:E}}(this.tileID.canonical,n);c=p.vertices,m=p.indices}else{c=new Nc,m=new wr;for(let{x:b,y}of a)c.emplaceBack(b,y,0,0);let p=If(c.int16,void 0,4);for(let b=0;b<p.length;b+=3)m.emplaceBack(p[b],p[b+1],p[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,D0.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(m),this._tileBoundsSegments=An.simpleSegment(0,0,c.length,m.length)}_makeGlobeTileDebugBuffers(e,n){let a=n.projection;if(!a||a.name!=="globe"||n.freezeTileCoverage)return;let c=this.tileID.canonical,m=Mf(JC(c,n)),p=Pl(n.zoom),b;p>0&&(b=i.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,n,m,b,p),this._makeGlobeTileDebugTextBuffer(e,c,n,m,b,p)}_globePoint(e,n,a,c,m,p,b){let y=Sf(e,n,a);if(p){let w=1<<a.z,M=Ns(c.center.lng),T=Vs(c.center.lat),E=(a.x+.5)/w-M,P=0;E>.5?P=-1:E<-.5&&(P=1);let R=(e/pt+a.x)/w+P,F=(n/pt+a.y)/w;R=(R-M)*c._pixelsPerMercatorPixel+M,F=(F-T)*c._pixelsPerMercatorPixel+T;let B=[R*c.worldSize,F*c.worldSize,0];i._.transformMat4(B,B,p),y=Al(y,B,b)}return i._.transformMat4(y,y,m)}_makeGlobeTileDebugBorderBuffer(e,n,a,c,m,p){let b=new es,y=new _f,w=new N_,M=(E,P,R,F,B)=>{let W=(R-E)/(B-1),J=(F-P)/(B-1),ee=b.length;for(let te=0;te<B;te++){let pe=E+te*W,he=P+te*J;b.emplaceBack(pe,he);let ve=this._globePoint(pe,he,n,a,c,m,p);w.emplaceBack(ve[0],ve[1],ve[2]),y.emplaceBack(ee+te)}},T=pt;M(0,0,T,0,16),M(T,0,T,T,16),M(T,T,0,T,16),M(0,T,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(b,Cf.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,QC.members),this._tileDebugSegments=An.simpleSegment(0,0,b.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,a,c,m,p){let b=pt/4,y=new es,w=new wr,M=new N_,T=25;w.reserve(32),y.reserve(T),M.reserve(T);let E=(P,R)=>T*P+R;for(let P=0;P<T;P++){let R=P*b;for(let F=0;F<T;F++){let B=F*b;y.emplaceBack(B,R);let W=this._globePoint(B,R,n,a,c,m,p);M.emplaceBack(W[0],W[1],W[2])}}for(let P=0;P<4;P++)for(let R=0;R<4;R++){let F=E(P,R),B=E(P,R+1),W=E(P+1,R),J=E(P+1,R+1);w.emplaceBack(F,B,W),w.emplaceBack(W,B,J)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(y,Cf.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(M,QC.members),this._tileDebugTextSegments=An.simpleSegment(0,0,T,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Aa&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let ri={read:function(t,e){return t.readFields(ri._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(ri.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};ri.Filter.read=function(t,e){return t.readFields(ri.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},ri.Filter._readField=function(t,e,n){t===1?(e.delta_filter=ri.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=ri.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=ri.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=ri.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},ri.Filter.Delta={},ri.Filter.Delta.read=function(t,e){return t.readFields(ri.Filter.Delta._readField,{block_size:0},e)},ri.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},ri.Filter.Zigzag={},ri.Filter.Zigzag.read=function(t,e){return t.readFields(ri.Filter.Zigzag._readField,{},e)},ri.Filter.Zigzag._readField=function(t,e,n){},ri.Filter.BitShuffle={},ri.Filter.BitShuffle.read=function(t,e){return t.readFields(ri.Filter.BitShuffle._readField,{},e)},ri.Filter.BitShuffle._readField=function(t,e,n){},ri.Filter.ByteShuffle={},ri.Filter.ByteShuffle.read=function(t,e){return t.readFields(ri.Filter.ByteShuffle._readField,{},e)},ri.Filter.ByteShuffle._readField=function(t,e,n){},ri.Codec={},ri.Codec.read=function(t,e){return t.readFields(ri.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},ri.Codec._readField=function(t,e,n){t===1?(e.gzip_data=ri.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=ri.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=ri.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=ri.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},ri.Codec.GzipData={},ri.Codec.GzipData.read=function(t,e){return t.readFields(ri.Codec.GzipData._readField,{},e)},ri.Codec.GzipData._readField=function(t,e,n){},ri.Codec.JpegImage={},ri.Codec.JpegImage.read=function(t,e){return t.readFields(ri.Codec.JpegImage._readField,{},e)},ri.Codec.JpegImage._readField=function(t,e,n){},ri.Codec.WebpImage={},ri.Codec.WebpImage.read=function(t,e){return t.readFields(ri.Codec.WebpImage._readField,{},e)},ri.Codec.WebpImage._readField=function(t,e,n){},ri.Codec.PngImage={},ri.Codec.PngImage.read=function(t,e){return t.readFields(ri.Codec.PngImage._readField,{},e)},ri.Codec.PngImage._readField=function(t,e,n){},ri.DataIndexEntry={},ri.DataIndexEntry.read=function(t,e){return t.readFields(ri.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},ri.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(ri.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=ri.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},ri.Layer={},ri.Layer.read=function(t,e){return t.readFields(ri.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},ri.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(ri.DataIndexEntry.read(n,n.readVarint()+n.pos))};let as={read:function(t,e){return t.readFields(as._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=as.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=as.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};as.Uint32Values.read=function(t,e){return t.readFields(as.Uint32Values._readField,{values:[]},e)},as.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(a){if(a.type!==2)throw new Error(`Unsupported pbf type "${a.type}"`);let c=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(a),m=a.pos;return a.pos=c,function(p){a.pos=m;let b=0;for(;a.pos<c;){let y=a.readVarint();p[b++]=y}return p}}(n))},as.Fixed32Values={},as.Fixed32Values.read=function(t,e){return t.readFields(as.Fixed32Values._readField,{values:[]},e)},as.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class hR{constructor(e=0,n=0,a=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=a,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let a=this.items[e];this.ttl>0&&a.expiry<=Date.now()?this.delete(e):(n=a.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,a=!1,c=this.resetTtl){let m;if(a||this.has(e)){if(m=this.items[e],m.value=n,a===!1&&c&&(m.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==m){let p=this.last,b=m.next,y=m.prev;this.first===m&&(this.first=m.next),m.next=null,m.prev=this.last,p.next=m,y!==null&&(y.next=b),b!==null&&(b.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),m=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=m:this.last.next=m;return this.last=m,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function uR(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){let c=a===1?1:0,m=a===2?1:0;for(let p=0;p<e[0];p++){let b=e[1]*p;for(let y=c;y<e[1];y++){let w=e[2]*(y+b);for(let M=m;M<e[2];M++){let T=e[3]*(M+w);for(let E=0;E<e[3];E++){let P=T+E;t[P]+=t[P-n]}}}}n*=e[a]}return t}function mR(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function pR(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let a=t[n],c=t[n+1];t[n]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,t[n+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let a=t[n],c=t[n+1],m=t[n+2],p=t[n+3];t[n+0]=(192&a)>>6|(192&c)>>4|(192&m)>>2|192&p,t[n+1]=(48&a)>>4|(48&c)>>2|48&m|(48&p)<<2,t[n+2]=(12&a)>>2|12&c|(12&m)<<2|(12&p)<<4,t[n+3]=3&a|(3&c)<<2|(3&m)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class id extends Error{constructor(e){super(e),this.name="MRTError"}}var fa=Uint8Array,fm=Uint16Array,fR=Int32Array,ZS=new fa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),XS=new fa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gR=new fa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),QS=function(t,e){for(var n=new fm(31),a=0;a<31;++a)n[a]=e+=1<<t[a-1];var c=new fR(n[30]);for(a=1;a<30;++a)for(var m=n[a];m<n[a+1];++m)c[m]=m-n[a]<<5|a;return{b:n,r:c}},KS=QS(ZS,2),JS=KS.b,_R=KS.r;JS[28]=258,_R[258]=28;for(var bR=QS(XS,0).b,hx=new fm(32768),nr=0;nr<32768;++nr){var gm=(43690&nr)>>1|(21845&nr)<<1;hx[nr]=((65280&(gm=(61680&(gm=(52428&gm)>>2|(13107&gm)<<2))>>4|(3855&gm)<<4))>>8|(255&gm)<<8)>>1}var Hf=function(t,e,n){for(var a=t.length,c=0,m=new fm(e);c<a;++c)t[c]&&++m[t[c]-1];var p,b=new fm(e);for(c=1;c<e;++c)b[c]=b[c-1]+m[c-1]<<1;if(n){p=new fm(1<<e);var y=15-e;for(c=0;c<a;++c)if(t[c])for(var w=c<<4|t[c],M=e-t[c],T=b[t[c]-1]++<<M,E=T|(1<<M)-1;T<=E;++T)p[hx[T]>>y]=w}else for(p=new fm(a),c=0;c<a;++c)t[c]&&(p[c]=hx[b[t[c]-1]++]>>15-t[c]);return p},Wf=new fa(288);for(nr=0;nr<144;++nr)Wf[nr]=8;for(nr=144;nr<256;++nr)Wf[nr]=9;for(nr=256;nr<280;++nr)Wf[nr]=7;for(nr=280;nr<288;++nr)Wf[nr]=8;var eM=new fa(32);for(nr=0;nr<32;++nr)eM[nr]=5;var yR=Hf(Wf,9,1),vR=Hf(eM,5,1),ux=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ss=function(t,e,n){var a=e/8|0;return(t[a]|t[a+1]<<8)>>(7&e)&n},mx=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},xR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ls=function(t,e,n){var a=new Error(e||xR[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,ls),!n)throw a;return a},wR=new fa(0),CR=typeof TextDecoder<"u"&&new TextDecoder;try{CR.decode(wR,{stream:!0})}catch{}let SR={gzip_data:"gzip"},MR={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},kR={uint32:1,uint16:2,uint8:4},IR={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class px{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new id("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new id(`Expected header with length >= ${a} but got buffer of length ${n.length}`);let c=new sm(n.subarray(0,a)),m=ri.read(c);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new id(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(let p of m.layers)this.layers[p.name]=new TR(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],a=this.getLayer(e.layerName);for(let c=0;c<a.dataIndex.length;c++){let m=a.dataIndex[c],p=m.first_byte-e.firstByte,b=m.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||a._blocksInProgress.has(c))continue;let y={layerName:a.name,firstByte:p,lastByte:b,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[m.bands.length].concat(a.bandShape),buffer:a.buffer,codec:m.codec.codec,filters:m.filters.map(w=>w.filter)};a._blocksInProgress.add(c),n.push(y)}return new tM(n,()=>{n.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,m)=>{if(n.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),c)throw c;m.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class TR{constructor({version:e,name:n,units:a,tilesize:c,pixel_format:m,buffer:p,data_index:b},y){if(this.version=e,this.version!==1)throw new id(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=c,this.buffer=p,this.pixelFormat=MR[m],this.dataIndex=b,this.bandShape=[c+2*p,c+2*p,kR[this.pixelFormat]],this._decodedBlocks=function(w=1e3,M=0,T=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(M)||M<0)throw new TypeError("Invalid ttl value");if(typeof T!="boolean")throw new TypeError("Invalid resetTtl value");return new hR(w,M,T)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[a,c]of this.dataIndex.entries()){for(let[m,p]of c.bands.entries())if(p===e)return{bandIndex:n+m,blockIndex:a,blockBandIndex:m};n+=c.bands.length}break;case"number":for(let[a,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new id(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new id(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,a=-1/0,c=1/0,m=-1/0;for(let p of e){let{blockIndex:b}=this.getBlockForBand(p);if(b<0)throw new id(`Invalid band: ${JSON.stringify(p)}`);let y=this.dataIndex[b];c=Math.min(c,b),m=Math.max(m,b),n=Math.min(n,y.first_byte),a=Math.max(a,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:a,firstBlock:c,lastBlock:m}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e),c=this._decodedBlocks.get(n.toString());if(!c)throw new id(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[n],p=this.bandShape.reduce((w,M)=>w*M,1),b=a*p,y=c.subarray(b,b+p);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:m.offset,scale:m.scale}}}class tM{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}px.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:a,firstByte:c,lastByte:m,pixelFormat:p,blockShape:b,blockIndex:y,filters:w,codec:M}=n,T=new Uint8Array(t).subarray(c,m+1),E=new Uint32Array(b[0]*b[1]*b[2]),P;if(M!=="gzip_data")throw new Error(`Unhandled codec: ${M}`);return P=function(R,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((ee=function(he){he[0]==31&&he[1]==139&&he[2]==8||ls(6,"invalid gzip data");var ve=he[3],Ce=10;4&ve&&(Ce+=2+(he[10]|he[11]<<8));for(var De=(ve>>3&1)+(ve>>4&1);De>0;De-=!he[Ce++]);return Ce+(2&ve)}(J=R))+8>J.length&&ls(6,"invalid gzip data"),function(he,ve,Ce,De){var Ue=he.length;if(!Ue||ve.f&&!ve.l)return Ce||new fa(0);var ze=!Ce,$e=ze||ve.i!=2,rt=ve.i;ze&&(Ce=new fa(3*Ue));var We,et,He=function(rd){var od=Ce.length;if(rd>od){var Rh=new fa(Math.max(2*od,rd));Rh.set(Ce),Ce=Rh}},tt=ve.f||0,lt=ve.p||0,nt=ve.b||0,Mt=ve.l,ot=ve.d,ht=ve.m,Vt=ve.n,Ft=8*Ue;do{if(!Mt){tt=ss(he,lt,1);var Ot=ss(he,lt+1,3);if(lt+=3,!Ot){var ct=he[(Ai=4+((lt+7)/8|0))-4]|he[Ai-3]<<8,jt=Ai+ct;if(jt>Ue){rt&&ls(0);break}$e&&He(nt+ct),Ce.set(he.subarray(Ai,jt),nt),ve.b=nt+=ct,ve.p=lt=8*jt,ve.f=tt;continue}if(Ot==1)Mt=yR,ot=vR,ht=9,Vt=5;else if(Ot==2){var ai=ss(he,lt,31)+257,Zt=ss(he,lt+10,15)+4,di=ai+ss(he,lt+5,31)+1;lt+=14;for(var si=new fa(di),xi=new fa(19),qt=0;qt<Zt;++qt)xi[gR[qt]]=ss(he,lt+3*qt,7);lt+=3*Zt;var on=ux(xi),rn=(1<<on)-1,ji=Hf(xi,on,1);for(qt=0;qt<di;){var Ai,Ui=ji[ss(he,lt,rn)];if(lt+=15&Ui,(Ai=Ui>>4)<16)si[qt++]=Ai;else{var _n=0,hn=0;for(Ai==16?(hn=3+ss(he,lt,3),lt+=2,_n=si[qt-1]):Ai==17?(hn=3+ss(he,lt,7),lt+=3):Ai==18&&(hn=11+ss(he,lt,127),lt+=7);hn--;)si[qt++]=_n}}var Fn=si.subarray(0,ai),On=si.subarray(ai);ht=ux(Fn),Vt=ux(On),Mt=Hf(Fn,ht,1),ot=Hf(On,Vt,1)}else ls(1);if(lt>Ft){rt&&ls(0);break}}$e&&He(nt+131072);for(var eo=(1<<ht)-1,Un=(1<<Vt)-1,Tn=lt;;Tn=lt){var lr=(_n=Mt[mx(he,lt)&eo])>>4;if((lt+=15&_n)>Ft){rt&&ls(0);break}if(_n||ls(2),lr<256)Ce[nt++]=lr;else{if(lr==256){Tn=lt,Mt=null;break}var Ar=lr-254;lr>264&&(Ar=ss(he,lt,(1<<(vo=ZS[qt=lr-257]))-1)+JS[qt],lt+=vo);var Pr=ot[mx(he,lt)&Un],mn=Pr>>4;if(Pr||ls(3),lt+=15&Pr,On=bR[mn],mn>3){var vo=XS[mn];On+=mx(he,lt)&(1<<vo)-1,lt+=vo}if(lt>Ft){rt&&ls(0);break}$e&&He(nt+131072);var Ll=nt+Ar;if(nt<On){var Oa=0-On,ds=Math.min(On,Ll);for(Oa+nt<0&&ls(3);nt<ds;++nt)Ce[nt]=(void 0)[Oa+nt]}for(;nt<Ll;++nt)Ce[nt]=Ce[nt-On]}}ve.l=Mt,ve.p=Tn,ve.b=nt,ve.f=tt,Mt&&(tt=1,ve.m=ht,ve.d=ot,ve.n=Vt)}while(!tt);return nt!=Ce.length&&ze?(We=Ce,((et=nt)==null||et>We.length)&&(et=We.length),new fa(We.subarray(0,et))):Ce.subarray(0,nt)}(J.subarray(ee,-8),{i:2},new fa(((B=J)[(W=B.length)-4]|B[W-3]<<8|B[W-2]<<16|B[W-1]<<24)>>>0))));var B,W,J,ee;let te=SR[F];if(!te)throw new Error(`Unhandled codec: ${F}`);let pe=new globalThis.DecompressionStream(te);return new Response(new Blob([R]).stream().pipeThrough(pe)).arrayBuffer().then(he=>new Uint8Array(he))}(T,M).then(R=>{let F=as.read(new sm(R));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(E),new IR[p](E.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),P.then(R=>{for(let F=w.length-1;F>=0;F--)switch(w[F]){case"delta_filter":uR(R,b);break;case"zigzag_filter":mR(R);break;case"bitshuffle_filter":pR(R,p);break;default:throw new Error(`Unhandled filter "${w[F]}"`)}return{layerName:a,blockIndex:y,data:R}}).catch(R=>{throw R})}))};class iM extends A0{constructor(e,n,a,c,m){super(e,n,a,c,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){let a=n.context,c=a.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Aa?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new Aa(a,e,c.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){let a=this._mrt=new px(30),c=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=pl(c,(m,p,b,y)=>{if(m)n(m);else try{let w=a.getHeaderLength(p);if(w>e)return void(this.request=this.fetchHeader(w,n));a.parseHeader(p),this._isHeaderLoaded=!0;let M=0;for(let T of Object.values(a.layers))M=Math.max(M,T.dataIndex[T.dataIndex.length-1].last_byte);p.byteLength>=M&&(this.entireBuffer=p),n(null,this.entireBuffer||p,b,y)}catch(w){n(w)}}),this.request}fetchBand(e,n,a){let c=this._mrt;if(!this._isHeaderLoaded||!c)return void a(new Error("Tile header is not ready"));let m=this.actor;if(!m)return void a(new Error("Can't fetch tile band without an actor"));let p,b=(T,E)=>{p.complete(T,E),T?a(T):(this.updateTextureDescriptor(e,n),a(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(T,E)=>{if(T)return a(T);let P=m.send("decodeRasterArray",{buffer:E,task:p},b,void 0,!0);this._workQueue.push(()=>{P&&P.cancel(),p.cancel()})},w=c.getLayer(e);if(!w)return void a(new Error(`Unknown sourceLayer "${e}"`));if(w.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void a(null,this.textureDescriptor?this.textureDescriptor.img:null);let M=w.getDataRange([n]);if(p=c.createDecodingTask(M),!p||p.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(M.firstByte,M.lastByte+1));else{let T=Object.assign({},this.requestParams,{headers:{Range:`bytes=${M.firstByte}-${M.lastByte}`}}),E=pl(T,y);this._fetchQueue.push(()=>{E.cancel(),p.cancel()})}else a(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;let a=this._mrt.getLayer(e);if(!a||!a.hasBand(n)||!a.hasDataForBand(n))return;let{bytes:c,tileSize:m,buffer:p,offset:b,scale:y}=a.getBandView(n),w=m+2*p,M={data:c,width:w,height:w},T=this.texture;T&&T instanceof Aa&&T.update(M,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:M,buffer:p,offset:b,tileSize:m,format:a.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class ER{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){let c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);let m={value:n,timeout:void 0};if(a!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},a)),this.data[c].push(m),this.order.push(c),this.order.length>this.max){let p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let a=e.wrapped().key,c=n===void 0?0:this.data[a].indexOf(n),m=this.data[a][c];return this.data[a].splice(c,1),m.timeout&&clearTimeout(m.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(m.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let a in this.data)for(let c of this.data[a])e(c.value)||n.push(c);for(let a of n)this.remove(a.value.tileID,a)}}class Dh extends gl{constructor(e,n,a){super(),this.id=e,this._onlySymbols=a,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new ER(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new PO,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Vo(this._tiles).map(e=>e.tileID).sort(nM).map(e=>e.key)}getRenderableIds(e,n){let a=[];for(let c in this._tiles)this._isIdRenderable(+c,e,n)&&a.push(this._tiles[c]);return e?a.sort((c,m)=>{let p=c.tileID,b=m.tileID,y=new xt(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new xt(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-b.overscaledZ||w.y-y.y||w.x-y.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(nM).map(c=>c.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,e,n)))}_tileLoaded(e,n,a,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new Iu(c,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new oo("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Ir.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new oo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let c=0;c<n.length;c++){let m=n[c];if(e.neighboringTiles&&e.neighboringTiles[m]){let p=this.getTileByID(m);a(e,p),a(p,e)}}function a(c,m){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let p=m.tileID.canonical.x-c.tileID.canonical.x,b=m.tileID.canonical.y-c.tileID.canonical.y,y=Math.pow(2,c.tileID.canonical.z),w=m.tileID.key;p===0&&b===0||Math.abs(b)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),m.dem&&c.dem&&(c.dem.backfillBorder(m.dem,p,b),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,c){for(let m in this._tiles){let p=this._tiles[m];if(c[m]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>a)continue;let b=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){let w=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[w.key],p&&p.hasData()&&(b=w)}let y=b;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){c[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){let c=e.scaledTo(a),m=this._getLoadedTile(c);if(m)return m}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let a=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,m=Math.floor(a*c*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(b)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let a={};for(let c in this._tiles){let m=this._tiles[c];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),a[m.tileID.key]=m}this._tiles=a;for(let c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(let c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,a,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let m;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)m=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new ur(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){let y=e.clone();y.tileCoverLift=this.tileCoverLift,m=y.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(m.push(new ur(1,0,1,0,0)),m.push(new ur(1,0,1,1,0)),m.push(new ur(1,0,1,0,1)),m.push(new ur(1,0,1,1,1)))}else if(m=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){let y=this._source.hasTile.bind(this._source);m=m.filter(w=>y(w))}}else m=[];if(m.length>0&&this.castsShadows&&c&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!fx(this._source.type)){let y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),w=Math.min(y,this._source.maxzoom),M=e.extendTileCoverForShadows(m,c,w);for(let T of M)this._shadowCasterTiles[T.key]=!0,m.push(T)}let p=this._updateRetainedTiles(m);if(fx(this._source.type)&&m.length!==0){let y={},w={},M=Object.keys(p);for(let E of M){let P=p[E],R=this._tiles[E];if(!R||R.fadeEndTime&&R.fadeEndTime<=Ir.now())continue;let F=this.findLoadedParent(P,Math.max(P.overscaledZ-Dh.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),w[E]=P}let T=m[m.length-1].overscaledZ;for(let E in this._tiles){let P=this._tiles[E];if(p[E]||!P.hasData())continue;let R=P.tileID;for(;R.overscaledZ>T;){R=R.scaledTo(R.overscaledZ-1);let F=this._tiles[R.key];if(F&&F.hasData()&&w[R.key]){p[E]=P.tileID;break}}}for(let E in y)p[E]||(this._coveredTiles[E]=!0,p[E]=y[E])}for(let y in p)this._tiles[y].clearFadeHold();let b=function(y,w){let M=[];for(let T in y)T in w||M.push(T);return M}(this._tiles,p);for(let y of b){let w=this._tiles[y];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let a={},c=e.reduce((w,M)=>Math.min(w,M.overscaledZ),1/0),m=e[0].overscaledZ,p=Math.max(m-Dh.maxOverzooming,this._source.minzoom),b=Math.max(m+Dh.maxUnderzooming,this._source.minzoom),y={};for(let w of e){let M=this._addTile(w);n[w.key]=w,M.hasData()||c<this._source.maxzoom&&(y[w.key]=w)}this._retainLoadedChildren(y,c,b,n);for(let w of e){let M=this._tiles[w.key];if(M.hasData())continue;if(w.canonical.z>=this._source.maxzoom){let E=w.children(this._source.maxzoom)[0],P=this.getTile(E);if(P&&P.hasData()){n[E.key]=E;continue}}else{let E=w.children(this._source.maxzoom);if(n[E[0].key]&&n[E[1].key]&&n[E[2].key]&&n[E[3].key])continue}let T=M.wasRequested();for(let E=w.overscaledZ-1;E>=p;--E){let P=w.scaledTo(E);if(a[P.key]||(a[P.key]=!0,M=this.getTile(P),!M&&T&&(M=this._addTile(P)),M&&(n[P.key]=P,T=M.wasRequested(),M.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}n.push(c.key);let m=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(m),a)break;c=m}for(let m of n)this._loadedParentTiles[m]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let a=!!n;if(!a){let c=this.map?this.map.painter:null,m=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new iM(e,m,this.transform.tileZoom,c,this._isRaster):new A0(e,m,this.transform.tileZoom,c,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,a||this._source.fire(new oo("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,a){let c=[],m=this.transform;if(!m)return c;let p=m.projection.name==="globe",b=Ns(m.center.lng);for(let y in this._tiles){let w=this._tiles[y];if(a&&w.clearQueryDebugViz(),w.holdingForFade())continue;let M;if(p){let T=w.tileID.canonical;if(T.z===0){let E=[Math.abs(pi(b,...Gf(T,-1))-b),Math.abs(pi(b,...Gf(T,1))-b)];M=[0,2*E.indexOf(Math.min(...E))-1]}else{let E=[Math.abs(pi(b,...Gf(T,-1))-b),Math.abs(pi(b,...Gf(T,0))-b),Math.abs(pi(b,...Gf(T,1))-b)];M=[E.indexOf(Math.min(...E))-1]}}else M=[0];for(let T of M){let E=e.containsTile(w,m,n,T);E&&c.push(E)}}return c}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let a=this.getRenderableIds(e,n).map(m=>this._tiles[m].tileID),c=this.transform.projection.name==="globe";for(let m of a)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=c?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return a}sortCoordinatesByDistance(e){let n=e.slice(),a=this.transform._camera.position,c=this.transform._camera.forward(),m={};for(let p of n){let b=1/(1<<p.canonical.z);m[p.key]=((p.canonical.x+.5)*b+p.wrap-a[0])*c[0]+((p.canonical.y+.5)*b-a[1])*c[1]-a[2]*c[2]}return n.sort((p,b)=>m[p.key]-m[b.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(fx(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Ir.now())return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){let c=this._tiles[e];c&&c.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(let a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(e,n))};return void this._source.on("data",b)}let a=new Map,c=Array.isArray(e)?e:[e],m=this.map.painter.terrain,p=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(let b of c){let y=b.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let w of y)a.set(w.key,w);this.usedForTerrain&&b.updateElevation(!1)}fc(Array.from(a.values()),(b,y)=>{let w=new A0(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,M=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),y(M,w)})},n)}}function nM(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||a-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function fx(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Gf(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Dh.maxOverzooming=10,Dh.maxUnderzooming=3;let rM=new class extends St{possiblyEvaluate(t,e){return e=new Qt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,a){return e=Hr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,a)}}(m0.paint.properties["line-width"].specification);function oM(t,e){return e>0?e+2*t:t}rM.useIntegerZoom=!0;let DR=new qi({"symbol-placement":new Ke(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new St(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(Pe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ke(Pe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ke(Pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ke(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new St(Pe.layout_symbol["icon-size"]),"icon-text-fit":new St(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new St(Pe.layout_symbol["icon-image"]),"icon-rotate":new St(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Ke(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new St(Pe.layout_symbol["icon-offset"]),"icon-anchor":new St(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new St(Pe.layout_symbol["text-field"]),"text-font":new St(Pe.layout_symbol["text-font"]),"text-size":new St(Pe.layout_symbol["text-size"]),"text-max-width":new St(Pe.layout_symbol["text-max-width"]),"text-line-height":new St(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new St(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new St(Pe.layout_symbol["text-justify"]),"text-radial-offset":new St(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(Pe.layout_symbol["text-variable-anchor"]),"text-anchor":new St(Pe.layout_symbol["text-anchor"]),"text-max-angle":new Ke(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new St(Pe.layout_symbol["text-rotate"]),"text-padding":new Ke(Pe.layout_symbol["text-padding"]),"text-keep-upright":new Ke(Pe.layout_symbol["text-keep-upright"]),"text-transform":new St(Pe.layout_symbol["text-transform"]),"text-offset":new St(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(Pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ke(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(Pe.layout_symbol["text-optional"]),visibility:new Ke(Pe.layout_symbol.visibility)});var gx={paint:new qi({"icon-opacity":new St(Pe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new St(Pe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new St(Pe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new St(Pe.paint_symbol["text-emissive-strength"]),"icon-color":new St(Pe.paint_symbol["icon-color"]),"icon-halo-color":new St(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new St(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new St(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(Pe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new St(Pe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new St(Pe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new St(Pe.paint_symbol["text-occlusion-opacity"]),"text-color":new St(Pe.paint_symbol["text-color"],{runtimeType:ao,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new St(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new St(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new St(Pe.paint_symbol["text-halo-blur"]),"text-translate":new Ke(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(Pe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ke(Pe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ke(Pe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ke(Pe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ke(Pe.paint_symbol["icon-color-brightness-max"])}),layout:DR};class aM{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Mc,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ne(aM,"FormatSectionOverride",{omit:["defaultValue"]});class P0 extends hr{constructor(e,n,a,c){super(e,gx,n,a,c),this._colorAdjustmentMatrix=i.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let c=[];for(let m of a)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,c){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(m,p,b,y){m=_u(m),p=gu(p);let w=i.ad.create(),M=m/3,T=1-2*M,E=[T,M,M,0,M,T,M,0,M,M,T,0,0,0,0,1],P=.5-.5*p,R=y-b;return i.ad.multiply(w,[R,0,0,0,0,R,0,0,0,0,R,0,b,b,b,1],[p,0,0,0,0,p,0,0,0,0,p,0,P,P,P,1]),i.ad.multiply(w,w,E),w}(e,n,a,c),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,c){let m=this.layout.get(e).evaluate(n,{},a,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||z(p.value)||!m?m:function(b,y){return y.replace(/{([^{}]+)}/g,(w,M)=>M in b?String(b[M]):"")}(n.properties,m)}createBucket(e){return new pm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of gx.paint.overridableProperties){if(!P0.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),a=new aM(n),c=new L(a,n.property.specification,this.scope,this.options),m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new H("source",c):new Y("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new xn(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&P0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let a=e.get("text-field"),c=gx.paint.properties[n],m=!1,p=b=>{for(let y of b)if(c.overrides&&c.overrides.hasOverride(y))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Wr)p(a.value.value.sections);else if(a.value.kind==="source"){let b=w=>{m||(w instanceof Xa&&sr(w.value)===Ic?p(w.value.sections):w instanceof nh?p(w.sections):w.eachChild(b))},y=a.value;y._styleExpression&&b(y._styleExpression.expression)}return m}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),n&&a.push("symbolSDF"),a}getDefaultProgramParams(e,n,a){return{config:new Ch(this,{zoom:n,lut:a}),overrideFog:!1}}}let AR=new qi({visibility:new Ke(Pe.layout_background.visibility)});var PR={paint:new qi({"background-color":new Ke(Pe.paint_background["background-color"]),"background-pattern":new Ke(Pe.paint_background["background-pattern"]),"background-opacity":new Ke(Pe.paint_background["background-opacity"]),"background-emissive-strength":new Ke(Pe.paint_background["background-emissive-strength"])}),layout:AR};let OR=new qi({visibility:new Ke(Pe.layout_raster.visibility)});var RR={paint:new qi({"raster-opacity":new Ke(Pe.paint_raster["raster-opacity"]),"raster-color":new Dn(Pe.paint_raster["raster-color"]),"raster-color-mix":new Ke(Pe.paint_raster["raster-color-mix"]),"raster-color-range":new Ke(Pe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ke(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(Pe.paint_raster["raster-saturation"]),"raster-contrast":new Ke(Pe.paint_raster["raster-contrast"]),"raster-resampling":new Ke(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(Pe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ke(Pe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ke(Pe.paint_raster["raster-array-band"]),"raster-elevation":new Ke(Pe.paint_raster["raster-elevation"])}),layout:OR};function O0(t,e,n,a,c,m,p,b){let y=[t,e,1,n,a,1,c,m,1],w=[p,b,1],M=i.bC.adjoint([],y),[T,E,P]=i._.transformMat3(w,w,M);return i.bC.multiply(y,y,[T,0,0,0,E,0,0,0,P])}function sM(t,e,n,a,c,m,p,b){let y=function(w,M,T,E,P,R,F,B){let W=O0(0,0,1,0,1,1,0,1),J=O0(w,M,T,E,P,R,F,B),ee=i.bC.adjoint([],W);return i.bC.multiply(J,J,ee)}(t,e,n,a,c,m,p,b);return[y[2]/y[8]/pt,y[5]/y[8]/pt]}function R0(t){return[t[0],Math.min(Math.max(t[1],-Qn),Qn)]}class lM extends gl{constructor(e,n,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new oo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Es(this.map._requestManager.transformRequest(this.url,wu.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Iu(a)):c&&(this.image=c instanceof HTMLImageElement?Ir.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new T0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new oo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof T0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(let m of e)m[1]>a&&(a=m[1]),m[1]<n&&(n=m[1]);let c=(a+n)/2;if(c>Qn?this.onNorthPole=!0:c<-Qn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=e.map(Jr.fromLngLat);this.tileID=function(p){let b=1/0,y=1/0,w=-1/0,M=-1/0;for(let F of p)b=Math.min(b,F.x),y=Math.min(y,F.y),w=Math.max(w,F.x),M=Math.max(M,F.y);let T=Math.max(w-b,M-y),E=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),P=Math.pow(2,E),R=Math.floor((b+w)/2*P);return R>1&&(R-=1),new Mh(E,R,Math.floor((y+M)/2*P))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new oo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let B in this.tiles){let W=this.tiles[B];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=Eh(new Mh(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(B){let W=B[1].x-B[0].x,J=B[1].y-B[0].y,ee=B[2].x-B[1].x,te=B[2].y-B[1].y,pe=B[3].x-B[2].x,he=B[3].y-B[2].y,ve=B[0].x-B[3].x,Ce=B[0].y-B[3].y,De=W*te-ee*J,Ue=ee*he-pe*te,ze=pe*Ce-ve*he,$e=ve*J-W*Ce;return De>0&&Ue>0&&ze>0&&$e>0||De<0&&Ue<0&&ze<0&&$e<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let c=Eh(this.tileID,this.map.transform.projection),[m,p,b,y]=this.coordinates.map(B=>{let W=c.projection.project(B[0],B[1]);return jS(c,W)._round()});this.perspectiveTransform=sM(m.x,m.y,p.x,p.y,b.x,b.y,y.x,y.y);let w=this._boundsArray=new Nc;w.emplaceBack(m.x,m.y,0,0),w.emplaceBack(p.x,p.y,pt,0),w.emplaceBack(y.x,y.y,0,pt),w.emplaceBack(b.x,b.y,pt,pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,D0.members),this.boundsSegments=An.simpleSegment(0,0,4,2);let M=[],T=function(B){return[R0(B[0]),R0(B[1]),R0(B[2]),R0(B[3])]}(this.coordinates),[E,P,R,F]=function(B){let W=B[0][0],J=W,ee=B[0][1],te=ee;for(let pe=1;pe<B.length;pe++)B[pe][0]<W?W=B[pe][0]:B[pe][0]>J&&(J=B[pe][0]),B[pe][1]<ee?ee=B[pe][1]:B[pe][1]>te&&(te=B[pe][1]);return[W,ee,J-W,te-ee]}(T);{let B=new Nc,[W,J,ee,te]=function(He){let tt=He[0].x,lt=tt,nt=He[0].y,Mt=nt;for(let ot=1;ot<He.length;ot++)He[ot].x<tt?tt=He[ot].x:He[ot].x>lt&&(lt=He[ot].x),He[ot].y<nt?nt=He[ot].y:He[ot].y>Mt&&(Mt=He[ot].y);return[tt,nt,lt-tt,Mt-nt]}(a),pe=He=>[(He.x-W)/ee,(He.y-J)/te],[he,ve,Ce,De]=a.map(pe),Ue=function(He,tt,lt,nt,Mt,ot,ht,Vt){let Ft=O0(0,0,1,0,1,1,0,1),Ot=O0(He,tt,lt,nt,Mt,ot,ht,Vt),ct=i.bC.adjoint([],Ot);return i.bC.multiply(Ft,Ft,ct)}(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],De[0],De[1]);this.elevatedGlobePerspectiveTransform=sM(he[0],he[1],ve[0],ve[1],Ce[0],Ce[1],De[0],De[1]);let ze=(He,tt)=>{M.push(He.lng);let lt=Math.round((He.lng-E)/R*pt),nt=Math.round((He.lat-P)/F*pt),Mt=pe(tt),ot=i._.transformMat3([],[Mt[0],Mt[1],1],Ue),ht=Math.round(ot[0]/ot[2]*pt),Vt=Math.round(ot[1]/ot[2]*pt);B.emplaceBack(lt,nt,ht,Vt)},$e=a[3].x-a[0].x,rt=a[3].y-a[0].y,We=a[2].x-a[1].x,et=a[2].y-a[1].y;for(let He=0;He<65;He++){let tt=He/64,lt=[a[0].x+tt*$e,a[0].y+tt*rt],nt=[a[1].x+tt*We,a[1].y+tt*et],Mt=nt[0]-lt[0],ot=nt[1]-lt[1];for(let ht=0;ht<65;ht++){let Vt=ht/64,Ft={x:lt[0]+Mt*Vt,y:lt[1]+ot*Vt,z:0};ze(n.projection.unproject(Ft.x,Ft.y),Ft)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(B,D0.members)}{this.maxLongitudeTriangleSize=0;let B=[],W=new wr,J=(ee,te,pe)=>{W.emplaceBack(ee,te,pe);let he=M[ee],ve=M[te],Ce=M[pe],De=Math.min(Math.min(he,ve),Ce),Ue=Math.max(Math.max(he,ve),Ce)-De;Ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ue),B.push(De+Ue/2)};for(let ee=0;ee<64;ee++)for(let te=0;te<64;te++){let pe=65*ee+te,he=pe+1,ve=pe+65,Ce=ve+1;J(pe,ve,he),J(he,ve,Ce)}[B,W]=function(ee,te){let pe=Array.from({length:ee.length},(Ce,De)=>De);pe.sort((Ce,De)=>ee[Ce]-ee[De]);let he=[],ve=new wr;for(let Ce=0;Ce<pe.length;Ce++){let De=pe[Ce];he.push(ee[De]);let Ue=3*De,ze=Ue+1;ve.emplaceBack(te.uint16[Ue],te.uint16[ze],te.uint16[ze+1])}return[he,ve]}(B,W),this.elevatedGlobeTrianglesCenterLongitudes=B,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=An.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/pt,0,F/pt,0,0,P,E,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof T0||(this.texture?this.texture.update(this.image):(this.texture=new Aa(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,c=(m=e+180)+360*Math.round((a[0]-m)/360);var m;let p=new An,b=(T,E)=>{p.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:n.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=y){let T=Zg(a,0,a.length,c+y);return T===a.length||b(T,Sp(a,T+1,a.length,c+360-y)-T),p}c<a[0]&&(c+=360);let w=Sp(a,0,a.length,c-y);if(w===a.length)return b(0,a.length),p;b(0,w-0);let M=Zg(a,w+1,a.length,c+y);return M!==a.length&&b(M,a.length-M),p}}let LR=(Math.pow(256,2)-1)/16907520;class cM extends hr{constructor(e,n,a,c){super(e,RR,n,a,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof lM&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=kf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let FR=new qi({visibility:new Ke(Pe["layout_raster-particle"].visibility)});var zR={paint:new qi({"raster-particle-array-band":new Ke(Pe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ke(Pe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Dn(Pe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ke(Pe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ke(Pe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ke(Pe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ke(Pe["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:FR};class dM extends hr{constructor(e,n,a,c){super(e,zR,n,a,c),this._updateColorRamp(),this.lastInvalidatedAt=Ir.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=kf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ir.now()}}class BR extends hr{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let NR=new qi({visibility:new Ke(Pe.layout_sky.visibility)});var VR={paint:new qi({"sky-type":new Ke(Pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ke(Pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ke(Pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ke(Pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ke(Pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Dn(Pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ke(Pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ke(Pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ke(Pe.paint_sky["sky-opacity"])}),layout:NR};function _x(t,e,n){let a=[0,0,1],c=i.av.identity([]);return i.av.rotateY(c,c,n?-Ei(t)+Math.PI:Ei(t)),i.av.rotateX(c,c,-Ei(e)),i._.transformQuat(a,a,c),i._.normalize(a,a)}var jR={paint:new qi({})};function hM(t,e){let n=L0(t.projection,t.zoom,t.width,t.height),a=function(m,p,b,y,w){let M=new Li(b.lng-180*nd,b.lat),T=new Li(b.lng+180*nd,b.lat),E=m.project(M.lng,M.lat),P=m.project(T.lng,T.lat),R=-Math.atan2(P.y-E.y,P.x-E.x),F=Jr.fromLngLat(b);F.y=pi(F.y,-1+nd,1-nd);let B=F.toLngLat(),W=m.project(B.lng,B.lat),J=Jr.fromLngLat(B);J.x+=nd;let ee=J.toLngLat(),te=m.project(ee.lng,ee.lat),pe=pM(te.x-W.x,te.y-W.y,R),he=Jr.fromLngLat(B);he.y+=nd;let ve=he.toLngLat(),Ce=m.project(ve.lng,ve.lat),De=pM(Ce.x-W.x,Ce.y-W.y,R),Ue=Math.abs(pe.x)/Math.abs(De.y),ze=i.ad.identity([]);i.ad.rotateZ(ze,ze,-R*(1-(w?0:y)));let $e=i.ad.identity([]);return i.ad.scale($e,$e,[1,1-(1-Ue)*y,1]),$e[4]=-De.x/De.y*y,i.ad.rotateZ($e,$e,R),i.ad.multiply($e,ze,$e),$e}(t.projection,0,t.center,n,e),c=uM(t);return i.ad.scale(a,a,[c,c,1]),a}function uM(t){let e=t.projection,n=L0(t.projection,t.zoom,t.width,t.height),a=mM(e,t.center),c=mM(e,Li.convert(e.center));return Math.pow(2,a*n+(1-n)*c)}function L0(t,e,n,a,c=1/0){let m=t.range;if(!m)return 0;let p=Math.min(c,Math.max(n,a)),b=Math.log(p/1024)/Math.LN2;return dl(m[0]+b,m[1]+b,e)}let nd=1/4e4;function mM(t,e){let n=pi(e.lat,-Qn,Qn),a=new Li(e.lng-180*nd,n),c=new Li(e.lng+180*nd,n),m=t.project(a.lng,n),p=t.project(c.lng,n),b=Jr.fromLngLat(a),y=Jr.fromLngLat(c),w=p.x-m.x,M=p.y-m.y,T=y.x-b.x,E=y.y-b.y,P=Math.sqrt((T*T+E*E)/(w*w+M*M));return Math.log(P)/Math.LN2}function pM(t,e,n){let a=Math.cos(n),c=Math.sin(n);return{x:t*a-e*c,y:t*c+e*a}}function fM(t,e,n){i.ad.identity(t),i.ad.rotateZ(t,t,Ei(e[2])),i.ad.rotateX(t,t,Ei(e[0])),i.ad.rotateY(t,t,Ei(e[1])),i.ad.scale(t,t,n),i.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function F0(t,e,n,a,c,m,p,b){let y=[n[0]-e[0],n[1]-e[1],0],w=[a[0]-e[0],a[1]-e[1],0];if(i._.length(y)<1e-12||i._.length(w)<1e-12)return i.av.identity(t);let M=i._.cross([],y,w);i._.normalize(M,M),i._.subtract(w,a,e),y[2]=(m-c)*b,w[2]=(p-c)*b;let T=y;return i._.cross(T,y,w),i._.normalize(T,T),i.av.rotationTo(t,M,T)}function bx(t,e,n=!1){let a=Pl(e.zoom),c=function(m,p,b){let y=p.worldSize,w=[m[12],m[13],m[14]],M=Dr(w[1]/y),T=Oo(w[0]/y),E=i.ad.identity([]),P=yo(1,M)*y,R=yo(1,0)*y*kh(M,p.zoom),F=1/Fv(y),B=R*F;if(b){let te=L0(p.projection,p.zoom,p.width,p.height,1024);B=F*p.projection.pixelSpaceConversion(p.center.lat,y,te)}let W=Sh(M,T);i._.add(W,W,i._.scale([],i._.normalize([],W),P*B*w[2]));let J=function(te){let pe=[te[0],te[1],te[2]],he=[0,1,0],ve=i._.cross([],he,pe);return i._.cross(he,pe,ve),i._.squaredLength(he)===0&&(he=[0,1,0],i._.cross(ve,pe,he)),i._.normalize(ve,ve),i._.normalize(he,he),i._.normalize(pe,pe),[ve[0],ve[1],ve[2],0,he[0],he[1],he[2],0,pe[0],pe[1],pe[2],0,te[0],te[1],te[2],1]}(W);i.ad.scale(E,E,[B,B,B*P]),i.ad.translate(E,E,[-w[0],-w[1],-w[2]]);let ee=i.ad.multiply([],p.globeMatrix,J);return i.ad.multiply(ee,ee,E),i.ad.multiply(ee,ee,m),ee}(t,e,n);if(a>0){let m=function(p,b){let y=b.worldSize,w=yo(1,0)*y*kh(b.center.lat,b.zoom)/Fv(y),M=yo(1,b.center.lat)*y,T=i.ad.identity([]);return i.ad.rotateY(T,T,Ei(b.center.lng)),i.ad.rotateX(T,T,Ei(b.center.lat)),i.ad.translate(T,T,[0,0,bo]),i.ad.scale(T,T,[w,w,w*M]),i.ad.translate(T,T,[b.point.x-.5*y,b.point.y-.5*y,0]),i.ad.multiply(T,T,p),i.ad.multiply(T,b.globeMatrix,T)}(t,e);return function(p,b,y){let w=(R,F,B)=>{let W=i._.length(R),J=i._.length(F),ee=Al(R,F,B);return i._.scale(ee,ee,1/i._.length(ee)*Wt(W,J,B))},M=w([p[0],p[1],p[2]],[b[0],b[1],b[2]],y),T=w([p[4],p[5],p[6]],[b[4],b[5],b[6]],y),E=w([p[8],p[9],p[10]],[b[8],b[9],b[10]],y),P=Al([p[12],p[13],p[14]],[b[12],b[13],b[14]],y);return[M[0],M[1],M[2],0,T[0],T[1],T[2],0,E[0],E[1],E[2],0,P[0],P[1],P[2],1]}(c,m,a)}return c}function gM(t,e,n,a){let c=Pn.projectAabbCorners(a,n),m=Number.MAX_VALUE,p=-1;for(let w=0;w<c.length;++w){let M=c[w];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<m&&(p=w,m=M[2])}let b=w=>new xt(c[w][0],c[w][1]),y;switch(p){case 0:case 6:y=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:y=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:y=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:y=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(kv(t,y))return m}let UR=$i([{name:"a_pos_3f",components:3,type:"Float32"}]),HR=$i([{name:"a_color_3f",components:3,type:"Float32"}]),WR=$i([{name:"a_color_4f",components:4,type:"Float32"}]),GR=$i([{name:"a_uv_2f",components:2,type:"Float32"}]),qR=$i([{name:"a_normal_3f",components:3,type:"Float32"}]),$R=$i([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),YR=$i([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class z0{constructor(e,n,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function _M(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class bM{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class yM{constructor(){this.instancedDataArray=new cv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class yx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,a,c){this.tileToMeter=q_(a);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:b,index:y,sourceLayerIndex:w}of e){let M=b??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),T=Dl(p,m);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),T,a))continue;let E={id:M,sourceLayerIndex:w,index:y,geometry:m?T.geometry:is(p,a,c),properties:p.properties,type:p.type,patterns:{}},P=this.addFeature(E,E.geometry,T);P&&n.featureIndex.insert(p,E.geometry,y,w,this.index,this.instancesPerModel[P].instancedDataArray.length,pt/32)}this.lookup=null}update(e,n,a,c){for(let m in this.instancesPerModel){let p=this.instancesPerModel[m];for(let b in e)p.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(p.features[p.idToFeaturesIndex[b]],e[b],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];for(let c of a.features){let m=this.layers[0],p=c.feature,b=this.canonical,y=m.paint.get("model-rotation").evaluate(p,{},b),w=m.paint.get("model-scale").evaluate(p,{},b),M=m.paint.get("model-translation").evaluate(p,{},b);i._.exactEquals(c.rotation,y)&&i._.exactEquals(c.scale,w)&&i._.exactEquals(c.translation,M)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;let c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(qv(this.activeReplacements,c))return!1;this.activeReplacements=c;let m=!1;for(let p in this.instancesPerModel){let b=this.instancesPerModel[p],y=b.instancedDataArray;for(let w of b.features){let M=w.instancedDataOffset,T=w.instancedDataCount;for(let E=0;E<T;E++){let P=16*(E+M),R=y.float32[P+0];R=R>pt?R-pt:R;let F=Math.floor(R),B=y.float32[P+1],W=!1;for(let J of this.activeReplacements)if(!(J.order<a||J.order===1/0)&&J.clipMask&B2.Model&&!(J.min.x>F||F>J.max.x||J.min.y>B||B>J.max.y)&&(W=D2(E2(F,B,e.canonical,J.footprintTileId.canonical),J),W))break;y.float32[P]=W?R+pt:R,m=m||W}}}return m}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,$R.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,a){let c=this.layers[0],m=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!m)return Zn(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),m;_M(m,!1)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new yM);let p=this.instancesPerModel[m],b=p.instancedDataArray,y=new bM(a,b.length);for(let w of n)for(let M of w){if(M.x<0||M.x>=pt||M.y<0||M.y>=pt)continue;let T=(this.lookupDim-1)/pt,E=this.lookupDim*(M.y*T|0)+M.x*T|0;if(this.lookup){if(this.lookup[E]!==0)continue;this.lookup[E]=1}this.instanceCount++;let P=b.length;b.resize(P+1),p.instancesEvaluatedElevation.push(0),b.float32[16*P]=M.x,b.float32[16*P+1]=M.y}return y.instancedDataCount=p.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(y),this.evaluate(y,{},p,!1)),m}getModelUris(){return this.modelUris}evaluate(e,n,a,c){let m=this.layers[0],p=e.feature,b=this.canonical,y=e.rotation=m.paint.get("model-rotation").evaluate(p,n,b),w=e.scale=m.paint.get("model-scale").evaluate(p,n,b),M=e.translation=m.paint.get("model-translation").evaluate(p,n,b),T=m.paint.get("model-color").evaluate(p,n,b);T.a=m.paint.get("model-color-mix-intensity").evaluate(p,n,b);let E=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),fM(E,y,w);let P=Math.round(100*T.a)+T.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let F=e.instancedDataOffset+R,B=16*F,W=a.instancedDataArray.float32,J=0;c&&(J=W[B+6]-a.instancesEvaluatedElevation[F]);let ee=0|W[B+1];W[B]=(0|W[B])+T.r/1.05,W[B+1]=ee+T.g/1.05,W[B+2]=P,W[B+3]=1/(b.z>10?this.tileToMeter:q_(b,ee)),W[B+4]=M[0],W[B+5]=M[1],W[B+6]=M[2]+J,W[B+7]=E[0],W[B+8]=E[1],W[B+9]=E[2],W[B+10]=E[4],W[B+11]=E[5],W[B+12]=E[6],W[B+13]=E[8],W[B+14]=E[9],W[B+15]=E[10],a.instancesEvaluatedElevation[F]=M[2]}}}ne(yx,"ModelBucket",{omit:["layers"]}),ne(yM,"PerModelAttributes"),ne(bM,"ModelFeature");let ZR=new qi({visibility:new Ke(Pe.layout_model.visibility),"model-id":new St(Pe.layout_model["model-id"])});var XR={paint:new qi({"model-opacity":new Ke(Pe.paint_model["model-opacity"]),"model-rotation":new St(Pe.paint_model["model-rotation"]),"model-scale":new St(Pe.paint_model["model-scale"]),"model-translation":new St(Pe.paint_model["model-translation"]),"model-color":new St(Pe.paint_model["model-color"]),"model-color-mix-intensity":new St(Pe.paint_model["model-color-mix-intensity"]),"model-type":new Ke(Pe.paint_model["model-type"]),"model-cast-shadows":new Ke(Pe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ke(Pe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ke(Pe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new St(Pe.paint_model["model-emissive-strength"]),"model-roughness":new St(Pe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new St(Pe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ke(Pe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ke(Pe.paint_model["model-front-cutoff"])}),layout:ZR};let Ah=64,_m={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function vM(t,e,n,a,c,m,p,b,y,w=!1){let M=n.zoom,T=n.project(a),E=kh(a.lat,M),P=1/E;i.ad.identity(t),i.ad.translate(t,t,[T.x+p[0]*P,T.y+p[1]*P,p[2]]);let R=1,F=1,B=n.worldSize;if(w){if(n.projection.name==="mercator"){let te=0;n.elevation&&(te=n.elevation.getAtPointOrZero(new Jr(T.x/B,T.y/B),0));let pe=i.aA.transformMat4([],[T.x,T.y,te,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=pe,F=pe*kh(n.center.lat,M)}else if(n.projection.name==="globe"){let te=bx(t,n),pe=i.ad.multiply([],n.projMatrix,te),he=[0,0,0,1];i.aA.transformMat4(he,he,pe);let ve=he[3]/n.cameraToCenterDistance,Ce=Pl(M),De=n.projection.pixelsPerMeter(a.lat,B)*kh(a.lat,M),Ue=n.projection.pixelsPerMeter(n.center.lat,B)*kh(n.center.lat,M);R=ve/Wt(De,BC(n.center.lat),Ce),F=ve*E/De,R*=Ue,F*=Ue}}else R=P;i.ad.scale(t,t,[R,R,F]);let W=[...t],J=e.orientation,ee=[];if(fM(ee,[J[0]+c[0],J[1]+c[1],J[2]+c[2]],m),i.ad.multiply(t,W,ee),b&&n.elevation){let te=0,pe=[];if(y&&n.elevation){te=function(Ce,De,Ue,ze,$e){let rt=De.elevation;if(!rt)return 0;let We=Pn.projectAabbCorners(Ue,ze),et=yo(1,$e.lat)*De.worldSize,He=function(jt,ai){let Zt=[0,0,1],di=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let si of di){let xi=jt[si.corners[0]],qt=jt[si.corners[1]],on=jt[si.corners[2]],rn=[qt[0]-xi[0],qt[1]-xi[1],ai*(qt[2]-xi[2])],ji=i._.cross(rn,rn,[on[0]-xi[0],on[1]-xi[1],ai*(on[2]-xi[2])]);i._.normalize(ji,ji),si.dotProductWithUp=i._.dot(ji,Zt)}return di.sort((si,xi)=>si.dotProductWithUp-xi.dotProductWithUp),di[0].corners}(We,et),tt=We[He[0]],lt=We[He[1]],nt=We[He[2]],Mt=We[He[3]],ot=rt.getAtPointOrZero(new Jr(tt[0]/De.worldSize,tt[1]/De.worldSize),0),ht=rt.getAtPointOrZero(new Jr(lt[0]/De.worldSize,lt[1]/De.worldSize),0),Vt=rt.getAtPointOrZero(new Jr(nt[0]/De.worldSize,nt[1]/De.worldSize),0),Ft=rt.getAtPointOrZero(new Jr(Mt[0]/De.worldSize,Mt[1]/De.worldSize),0),Ot=(ot+Ft)/2,ct=(ht+Vt)/2;return Ot>ct?ht<Vt?F0(Ce,lt,Mt,tt,ht,Ft,ot,et):F0(Ce,nt,tt,Mt,Vt,ot,Ft,et):ot<Ft?F0(Ce,tt,lt,nt,ot,ht,Vt,et):F0(Ce,Mt,nt,lt,Ft,Vt,ht,et),Math.max(Ot,ct)}(pe,n,e.aabb,t,a);let he=i.ad.fromQuat([],pe),ve=i.ad.multiply([],he,ee);i.ad.multiply(t,W,ve)}else te=n.elevation.getAtPointOrZero(new Jr(T.x/B,T.y/B),0);te!==0&&(t[14]+=te)}}function qf(t,e,n=!1){t.uploaded||(t.gfxTexture=new Aa(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function QR(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,UR.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,qR.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,GR.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?HR:WR).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,YR.members,!0)),t.segments=An.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let a=t.material;a.pbrMetallicRoughness.baseColorTexture&&qf(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&qf(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&qf(a.normalTexture,e),a.occlusionTexture&&qf(a.occlusionTexture,e,n),a.emissionTexture&&qf(a.emissionTexture,e)}function vx(t,e,n){if(t.meshes)for(let a of t.meshes)QR(a,e,n);if(t.children)for(let a of t.children)vx(a,e,n)}function B0(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)B0(e)}function xx(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)xx(n)}class KR{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class JR{constructor(){this.tasks={},this.taskQueue=[],mu(["process"],this),this.invoker=new KR(this.process),this.nextId=0}add(e,n){let a=this.nextId++,c=function({type:m,isSymbolTile:p,zoom:b}){return b=b||0,m==="message"?0:m!=="maybePrepare"||p?m!=="parseTile"||p?m==="parseTile"&&p?300-b:m==="maybePrepare"&&p?400-b:500:200-b:100-b}(n);if(c===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){let m=this.tasks[this.taskQueue[c]];m.priority<n&&(n=m.priority,e=c)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class xM{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},mu(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new JR}send(e,n,a,c,m=!1,p){let b=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[b]=a);let y=new Set;return this.target.postMessage({id:b,type:e,hasCallback:!!a,targetMapId:c,mustQueue:m,sourceMapId:this.mapId,data:we(n,y)},y),{cancel:()=>{a&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){let n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(n.mustQueue||kr()){let c=this.callbacks[a],m=this.scheduler.add(()=>this.processTask(a,n),c&&c.metadata||{type:"message"});m&&(this.cancelCallbacks[a]=m)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(Re(n.error)):a(null,Re(n.data)))}else{let a=new Set,c=n.hasCallback?(p,b)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?we(p):null,data:we(b,a)},a)}:p=>{},m=Re(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,m,c);else if(this.parent.getWorkerSource){let p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],m.source,m.scope)[p[1]](m,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let wx=(()=>{class t{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=hu();let c=this.workerPool.acquire(this.id);for(let m=0;m<c.length;m++){let p=new t.Actor(c[m],a,this.id);p.name=`Worker ${m}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,c){fc(this.actors,(m,p)=>{m.send(n,a,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=xM,t})();var $f={workerUrl:"",workerClass:null,workerParams:void 0};function e3(){return $f.workerClass!=null?new $f.workerClass:new self.Worker($f.workerUrl,$f.workerParams)}let Cx="mapboxgl_preloaded_worker_pool";class Yf{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Yf.workerCount;)this.workers.push(new e3);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Cx]}numActive(){return Object.keys(this.active).length}}let Zf;function N0(){return Zf||(Zf=new Yf),Zf}Yf.workerCount=2;let V0,Sx,cs,bm,Mx,ym=null;function wM(){return kr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Sx||I.DRACO_URL}function CM(){if(kr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(bm)return bm;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return bm=WebAssembly.validate(t)?I.MESHOPT_SIMD_URL:I.MESHOPT_URL,bm}let j0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},t3={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Xf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function SM(t,e,n){let a=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:c,byteLength:t.byteLength},n.buffers[c]=t}let kx="KHR_draco_mesh_compression";function i3(t,e){let n=t.extensions&&t.extensions[kx];if(!n)return;let a=new cs.Decoder,c=TM(e,n.bufferView),m=new cs.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,m))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[t.indices],b=j0[p.componentType],y=p.count*b.BYTES_PER_ELEMENT,w=cs._malloc(y);b===Uint16Array?a.GetTrianglesUInt16Array(m,y,w):a.GetTrianglesUInt32Array(m,y,w),SM(cs.memory.buffer.slice(w,w+y),p,e),cs._free(w);for(let M of Object.keys(n.attributes)){let T=a.GetAttributeByUniqueId(m,n.attributes[M]),E=e.json.accessors[t.attributes[M]],P=t3[E.componentType],R=E.count*Xf[E.type]*j0[E.componentType].BYTES_PER_ELEMENT,F=cs._malloc(R);a.GetAttributeDataArrayForAllPoints(m,T,cs[P],R,F),SM(cs.memory.buffer.slice(F,F+R),E,e),cs._free(F)}a.destroy(),m.destroy(),delete t.extensions[kx]}let U0="EXT_meshopt_compression";function n3(t,e){if(!t.extensions||!t.extensions[U0])return;let n=t.extensions[U0],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);Mx.decodeGltfBuffer(c,n.count,n.byteStride,a,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=c.buffer,delete t.extensions[U0]}let MM=1179937895,kM=new TextDecoder("utf8");function IM(t,e){return new URL(t,e).href}function r3(t,e,n,a){return fetch(IM(t.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function TM(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function o3(t,e,n,a){if(t.uri){let c=IM(t.uri,a);return fetch(c).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[n]=m})}if(t.bufferView!==void 0){let c=TM(e,t.bufferView),m=new Blob([c],{type:t.mimeType});return createImageBitmap(m).then(p=>{e.images[n]=p})}}function EM(t,e=0,n){let a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===MM){let M=new Uint32Array(t,e),T=2,E=(M[T++]>>2)-3,P=M[T++]>>2;if(T++,a.json=JSON.parse(kM.decode(M.subarray(T,T+P))),T+=P,T<E){let R=M[T++];T++;let F=e+(T<<2);a.buffers[0]=t.slice(F,F+R)}}else a.json=JSON.parse(kM.decode(new Uint8Array(t,e)));let{buffers:c,images:m,meshes:p,extensionsUsed:b,bufferViews:y}=a.json,w=Promise.resolve();if(c){let M=[];for(let T=0;T<c.length;T++){let E=c[T];E.uri?M.push(r3(E,a,T,n)):a.buffers[T]||(a.buffers[T]=null)}w=Promise.all(M)}return w.then(()=>{let M=[],T=b&&b.includes(kx),E=b&&b.includes(U0);if(T&&M.push(function(){if(!cs)return V0||(V0=function(P){let R,F=null;function B(){R=new Uint8Array(F.buffer)}function W(){throw new Error("Unexpected Draco error.")}let J={a:{a:W,d:function(ee,te,pe){return R.copyWithin(ee,te,te+pe)},c:function(ee){let te=R.length,pe=Math.max(ee>>>0,Math.ceil(1.2*te)),he=Math.ceil((pe-te)/65536);try{return F.grow(he),B(),!0}catch{return!1}},b:W}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,J):P.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,J))).then(ee=>{let{Rb:te,Qb:pe,P:he,T:ve,X:Ce,Ja:De,La:Ue,Qa:ze,Va:$e,Wa:rt,eb:We,jb:et,f:He,e:tt,yb:lt,zb:nt,Ab:Mt,Bb:ot,Db:ht,Gb:Vt}=ee.instance.exports;F=tt;let Ft=(()=>{let Ot=0,ct=0,jt=0,ai=0;return Zt=>{jt&&(te(ai),te(Ot),ct+=jt,jt=Ot=0),Ot||(ct+=128,Ot=pe(ct));let di=Zt.length+7&-8,si=Ot;di>=ct&&(jt=di,si=ai=pe(di));for(let xi=0;xi<Zt.length;xi++)R[si+xi]=Zt[xi];return si}})();return B(),He(),{memory:tt,_free:te,_malloc:pe,Mesh:class{constructor(){this.ptr=he()}destroy(){ve(this.ptr)}},Decoder:class{constructor(){this.ptr=De()}destroy(){et(this.ptr)}DecodeArrayToMesh(Ot,ct,jt){let ai=Ft(Ot),Zt=Ue(this.ptr,ai,ct,jt.ptr);return!!Ce(Zt)}GetAttributeByUniqueId(Ot,ct){return{ptr:ze(this.ptr,Ot.ptr,ct)}}GetTrianglesUInt16Array(Ot,ct,jt){$e(this.ptr,Ot.ptr,ct,jt)}GetTrianglesUInt32Array(Ot,ct,jt){rt(this.ptr,Ot.ptr,ct,jt)}GetAttributeDataArrayForAllPoints(Ot,ct,jt,ai,Zt){We(this.ptr,Ot.ptr,ct.ptr,jt,ai,Zt)}},DT_INT8:lt(),DT_UINT8:nt(),DT_INT16:Mt(),DT_UINT16:ot(),DT_UINT32:ht(),DT_FLOAT32:Vt()}})}(fetch(wM())),V0.then(P=>{cs=P,V0=void 0}))}()),E&&M.push(function(){if(Mx)return;let P=function(R){let F,B=WebAssembly.instantiateStreaming(R,{}).then(ee=>{F=ee.instance,F.exports.__wasm_call_ctors()}),W={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(ee,te,pe,he,ve,Ce){(function(De,Ue,ze,$e,rt,We,et){let He=De.exports.sbrk,tt=$e+3&-4,lt=He(tt*rt),nt=He(We.length),Mt=new Uint8Array(De.exports.memory.buffer);Mt.set(We,nt);let ot=Ue(lt,$e,rt,nt,We.length);if(ot===0&&et&&et(lt,tt,rt),ze.set(Mt.subarray(lt,lt+$e*rt)),He(lt-He(0)),ot!==0)throw new Error(`Malformed buffer data: ${ot}`)})(F,F.exports[J[ve]],ee,te,pe,he,F.exports[W[Ce]])}}}(fetch(CM()));return P.ready.then(()=>{Mx=P})}()),m)for(let P=0;P<m.length;P++)M.push(o3(m[P],a,P,n));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(T&&p)for(let{primitives:P}of p)for(let R of P)i3(R,a);if(E&&p&&y)for(let P of y)n3(P,a);return a})})}function Ph(t,e){let n=t.json.bufferViews[e.bufferView],a=j0[e.componentType];return new a(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Xf[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:Xf[e.type]))}function Ix(t,e,n,a){let c=j0[e.componentType],m=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),p=t.json.bufferViews[e.bufferView],b=p.byteStride?p.byteStride/c.BYTES_PER_ELEMENT:Xf[e.type],y=n.float32,w=y.length/n.capacity;for(let M=0,T=0;M<e.count*b;M+=b,T+=w)for(let E=0;E<w;E++)y[T+E]=a[M+E]*m;n._trim()}function a3(t,e,n){let a=t.indices,c=t.attributes,m={};m.indexArray=new wr;let p=e.json.accessors[a],b=p.count/3;m.indexArray.reserve(b);let y=Ph(e,p);for(let E=0;E<b;E++)m.indexArray.emplaceBack(y[3*E],y[3*E+1],y[3*E+2]);m.indexArray._trim(),m.vertexArray=new jc;let w=e.json.accessors[c.POSITION];m.vertexArray.reserve(w.count);let M=Ph(e,w);for(let E=0;E<w.count;E++)m.vertexArray.emplaceBack(M[3*E],M[3*E+1],M[3*E+2]);if(m.vertexArray._trim(),m.aabb=new Pn(w.min,w.max),m.centroid=function(E,P){let R=[0,0,0],F=E.length;if(F>0){for(let B=0;B<F;B++){let W=3*E[B];R[0]+=P[W],R[1]+=P[W+1],R[2]+=P[W+2]}R[0]/=F,R[1]/=F,R[2]/=F}return R}(y,M),c.COLOR_0!==void 0){let E=e.json.accessors[c.COLOR_0],P=Xf[E.type],R=Ph(e,E);m.colorArray=P===3?new jc:new Vc,m.colorArray.resize(E.count),Ix(e,E,m.colorArray,R)}if(c.NORMAL!==void 0){m.normalArray=new jc;let E=e.json.accessors[c.NORMAL];m.normalArray.resize(E.count);let P=Ph(e,E);Ix(e,E,m.normalArray,P)}if(c.TEXCOORD_0!==void 0&&n.length>0){m.texcoordArray=new Zu;let E=e.json.accessors[c.TEXCOORD_0];m.texcoordArray.resize(E.count);let P=Ph(e,E);Ix(e,E,m.texcoordArray,P)}if(c._FEATURE_ID_RGBA4444!==void 0){let E=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Ph(e,E))}c._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Ph(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));let T=t.material;return m.material=function(E,P){let{emissiveFactor:R=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:B=.5,normalTexture:W,occlusionTexture:J,emissiveTexture:ee,doubleSided:te}=E,{baseColorFactor:pe=[1,1,1,1],metallicFactor:he=1,roughnessFactor:ve=1,baseColorTexture:Ce,metallicRoughnessTexture:De}=E.pbrMetallicRoughness||{},Ue=J?P[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&Ue){let ze=J.extensions.KHR_texture_transform;Ue.offsetScale=[ze.offset[0],ze.offset[1],ze.scale[0],ze.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Bi(...pe),metallicFactor:he,roughnessFactor:ve,baseColorTexture:Ce?P[Ce.index]:void 0,metallicRoughnessTexture:De?P[De.index]:void 0},doubleSided:te,emissiveFactor:R,alphaMode:F,alphaCutoff:B,normalTexture:W?P[W.index]:void 0,occlusionTexture:Ue,emissionTexture:ee?P[ee.index]:void 0,defined:E.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},n),m}function DM(t,e,n){let{matrix:a,rotation:c,translation:m,scale:p,mesh:b,extras:y,children:w}=t,M={};if(M.matrix=a||i.ad.fromRotationTranslationScale([],c||[0,0,0,1],m||[0,0,0],p||[1,1,1]),b!==void 0){M.meshes=n[b];let T=M.anchor=[0,0];for(let E of M.meshes){let{min:P,max:R}=E.aabb;T[0]+=P[0]+R[0],T[1]+=P[1]+R[1]}T[0]=Math.floor(T[0]/M.meshes.length/2),T[1]=Math.floor(T[1]/M.meshes.length/2)}if(y&&(y.id&&(M.id=y.id),y.lights&&(M.lights=function(T){if(!T.length)return[];let E=function(W){let J=atob(W),ee=new Uint8Array(J.length);for(let te=0;te<J.length;te++)ee[te]=J.codePointAt(te);return ee}(T),P=[],R=E.length/24,F=new Uint16Array(E.buffer),B=new Float32Array(E.buffer);for(let W=0;W<R;W++){let J=F[2*W*6]/30,ee=F[2*W*6+1]/30,te=F[2*W*6+10]/100,pe=B[6*W+1],he=B[6*W+2],ve=B[6*W+3],Ce=B[6*W+4],De=ve-pe,Ue=Ce-he,ze=Math.hypot(De,Ue);P.push({pos:[pe+.5*De,he+.5*Ue,ee],normal:[Ue/ze,-De/ze,0],width:ze,height:J,depth:te,points:[pe,he,ve,Ce]})}return P}(y.lights))),w){let T=[];for(let E of w)T.push(DM(e.json.nodes[E],e,n));M.children=T}return M}function s3(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new Hv(t.vertices,t.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:a}}function l3(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let a=[];for(let p of n){if(!Array.isArray(p)||p.length!==2)continue;let b=p[0],y=p[1];typeof b=="number"&&typeof y=="number"&&a.push(new xt(b,y))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let p=0;p<a.length;p++){let b=a[p],y=a[(p+1)%a.length],w=a[(p+2)%a.length];c+=(b.x-y.x)*(w.y-y.y)-(w.x-y.x)*(b.y-y.y)}c>0&&a.reverse();let m=If(a.flatMap(p=>[p.x,p.y]),[]);return m.length===0?null:{vertices:a,indices:m}}function c3(t,e){let n=[],a=[],c=0,m=[];for(let p of t){c=n.length;let b=p.vertexArray.float32,y=p.indexArray.uint16;for(let w=0;w<p.vertexArray.length;w++)m[0]=b[3*w+0],m[1]=b[3*w+1],m[2]=b[3*w+2],i._.transformMat4(m,m,e),n.push(new xt(m[0],m[1]));for(let w=0;w<3*p.indexArray.length;w++)a.push(y[w]+c)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){let b=n[a[p+0]],y=n[a[p+1]],w=n[a[p+2]];(b.x-y.x)*(w.y-y.y)-(w.x-y.x)*(b.y-y.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:n,indices:a}}function AM(t){let e=function(y,w){let M=[],T=WebGL2RenderingContext;if(y.json.textures)for(let E of y.json.textures){let P={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};E.sampler!==void 0&&Object.assign(P,y.json.samplers[E.sampler]),M.push({image:w[E.source],sampler:P,uploaded:!1})}return M}(t,t.images),n=function(y,w){let M=[];for(let T of y.json.meshes){let E=[];for(let P of T.primitives)E.push(a3(P,y,w));M.push(E)}return M}(t,e),{scenes:a,scene:c,nodes:m}=t.json,p=a?a[c||0].nodes:m,b=[];for(let y of p)b.push(DM(m[y],t,n));return function(y,w,M){let T={},E=new Set;for(let P=0;P<y.length;P++){let R=M[w[P]];if(!R.extras)continue;let F=R.extras["mapbox:footprint:version"],B=R.extras["mapbox:footprint:id"];(F||B)&&E.add(P),F==="1.0.0"&&B&&(T[B]=P)}for(let P=0;P<y.length;P++){if(E.has(P))continue;let R=y[P],F=M[w[P]];if(!F.extras)continue;let B=null;R.id in T&&(B=c3(y[T[R.id]].meshes,R.matrix)),B||(B=l3(F)),B&&(R.footprint=s3(B))}if(E.size>0){let P=Array.from(E.values()).sort((R,F)=>R-F);for(let R=P.length-1;R>=0;R--)y.splice(P[R],1)}}(b,p,t.json.nodes),b}function d3(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,a=t.aabb.min[1]-1,c=Ah/(t.aabb.max[0]-n+2),m=Ah/(t.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){let b=e[p+2],y=(e[p+0]-n)*c|0,w=(e[p+1]-a)*m|0;b>t.heightmap[w*Ah+y]&&(t.heightmap[w*Ah+y]=b)}}function h3(t,e){let n={};n.indexArray=new wr,n.indexArray.reserve(4*t.length),n.vertexArray=new jc,n.vertexArray.reserve(10*t.length),n.colorArray=new Vc,n.vertexArray.reserve(10*t.length);let a=0;for(let p of t){let b=Math.min(10,Math.max(4,1.3*p.height))*e,y=[-p.normal[1],p.normal[0],0],w=Math.min(.29,.1*p.width/p.depth),M=p.width-2*p.depth*e*(w+.01),T=i._.scaleAndAdd([],p.pos,y,M/2),E=i._.scaleAndAdd([],p.pos,y,-M/2),P=[T[0],T[1],T[2]+p.height],R=[E[0],E[1],E[2]+p.height],F=i._.scaleAndAdd([],p.normal,y,w);i._.scale(F,F,b);let B=i._.scaleAndAdd([],p.normal,y,-w);i._.scale(B,B,b),i._.add(F,T,F),i._.add(B,E,B),T[2]+=.1,E[2]+=.1,n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]);let W=M/b/2;n.colorArray.emplaceBack(-W-w,-1,W,.8),n.colorArray.emplaceBack(W+w,-1,W,.8),n.colorArray.emplaceBack(-W,0,W,1.3),n.colorArray.emplaceBack(W,0,W,1.3),n.colorArray.emplaceBack(W+w,-.8,W,.7),n.colorArray.emplaceBack(W+w,-.8,W,.7),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(W+w,-1.2,W,.8),n.colorArray.emplaceBack(W+w,-1.2,W,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let c={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=Bi.white,c.pbrMetallicRoughness=m,n.material=c,n.aabb=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}let Tx=new Float32Array(262144),Oh=new Uint8Array(262144);function PM(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,PM(n));return e}function OM(t,e,n){if(t.meshes)for(let a of t.meshes)a.aabb.min[0]!==1/0&&n.insert(e,a.aabb.min[0],a.aabb.min[1],a.aabb.max[0],a.aabb.max[1]);if(t.children)for(let a of t.children)OM(a,e,n)}let RM=["","wall","door","roof","window","lamp","logo"];class LM{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:PM(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=Pn.applyTransform(a.aabb,this.node.matrix),n.encapsulate(a.transformedAabb)),e++;this.aabb=n}return this.aabb}}class H0{constructor(e,n,a,c,m,p){this.id=n,this.modelTraits|=_m.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=_m.HasMapboxMeshFeatures),c&&(this.modelTraits|=_m.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let b of e)this.nodesInfo.push(new LM(b)),OM(b,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(let a of this.getNodesInfo()){let c=a.node;c.footprint&&n.push({footprint:c.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let a of n){let c=a.node;this.uploaded?this.updatePbrBuffer(c):vx(c,e,!0)}for(let a of n)B0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){let c=e.transform.projectionOptions,m=e.style.getBrightness(),p=this.brightness!==m;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||Qf(a.paint.get("model-color").value,p)||Qf(a.paint.get("model-color-mix-intensity").value,p)||Qf(a.paint.get("model-roughness").value,p)||Qf(a.paint.get("model-emissive-strength").value,p)||Qf(a.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=c,this.brightness=m,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),c=this.id.canonical;for(let m of a){let p=m.feature;m.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},c)}}evaluate(e){let n=this.getNodesInfo();for(let a of n){if(!a.node.meshes)continue;let c=a.feature,m=a.node.meshes&&a.node.meshes[0].featureData,p=a.evaluatedColor[2],b=a.evaluatedRMEA[2],y=this.id.canonical;if(a.hasTranslucentParts=!1,m){for(let w=0;w<RM.length;w++){let M=RM[w];M.length&&(c.properties.part=M);let T=e.paint.get("model-color").evaluate(c,{},y).toRenderColor(null),E=e.paint.get("model-color-mix-intensity").evaluate(c,{},y);a.evaluatedColor[w]=[T.r,T.g,T.b,E],a.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(c,{},y),a.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y),a.evaluatedRMEA[w][3]=T.a,a.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},y),!a.hasTranslucentParts&&T.a<1&&(a.hasTranslucentParts=!0)}delete c.properties.part,m3(a,p!==a.evaluatedColor[2]||b!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},y);a.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},y),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,c){let m=e.findDEMTileFor(a);if(m&&(m.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let p=rm.create(e,a,m);if(!p)return;this.modelTraits&_m.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,c);for(let b of this.getNodesInfo()){let y=b.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let w=y.footprint.vertices,M=p.getElevationAt(w[0].x,w[0].y,!0,!0);for(let T=1;T<w.length;T++)M=Math.min(M,p.getElevationAt(w[T].x,w[T].y,!0,!0));y.elevation=M}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,c){let m=n._dem._modifiedForSources[c];if(m===void 0&&(n._dem._modifiedForSources[c]=[],m=n._dem._modifiedForSources[c]),m.includes(a.canonical))return;let p=n._dem.dim;m.push(a.canonical);let b=!1;for(let y of this.getNodesInfo()){let w=y.node;if(!w.footprint||!w.footprint.grid)continue;let M=w.footprint.grid,T=n.tileCoordToPixel(M.min.x,M.min.y),E=n.tileCoordToPixel(M.max.x,M.max.y),P=Math.min(Math.min(p-E.y,T.x),Math.min(T.y,p-E.x));if(P<0)continue;let R=pi(P,2,5),F=Math.max(0,T.x-R),B=Math.max(0,T.y-R),W=Math.min(E.x+R,p-1),J=Math.min(E.y+R,p-1);for(let he=B;he<=J;++he)for(let ve=F;ve<=W;++ve)Oh[he*p+ve]=255;let ee=0,te=0;for(let he=0;he<M.cellsY;++he)for(let ve=0;ve<M.cellsX;++ve){if(!M.cells[he*M.cellsX+ve])continue;let Ce=n.tileCoordToPixel(M.min.x+ve/M.xScale,M.min.y+he/M.yScale),De=n.tileCoordToPixel(M.min.x+(ve+1)/M.xScale,M.min.y+(he+1)/M.yScale);for(let Ue=Ce.y;Ue<=Math.min(De.y+1,p-1);++Ue)for(let ze=Ce.x;ze<=Math.min(De.x+1,p-1);++ze)Oh[Ue*p+ze]===255&&(Oh[Ue*p+ze]=0,ee+=n.getElevationAtPixel(ze,Ue),te++)}let pe=ee/te;F=Math.max(1,T.x-R),B=Math.max(1,T.y-R),W=Math.min(E.x+R,p-2),J=Math.min(E.y+R,p-2),b=!0;for(let he=B;he<=J;++he)for(let ve=F;ve<=W;++ve)Oh[he*p+ve]===0&&(Tx[he*p+ve]=n._dem.set(ve,he,pe));for(let he=1;he<R;++he){F=Math.max(1,T.x-he),B=Math.max(1,T.y-he),W=Math.min(E.x+he,p-2),J=Math.min(E.y+he,p-2);for(let ve=B;ve<=J;++ve)for(let Ce=F;Ce<=W;++Ce){let De=ve*p+Ce;if(Oh[De]===255){let Ue=0,ze=0,$e=-1,rt=-1;for(let We=-1;We<=1;++We)for(let et=-1;et<=1;++et){let He=(ve+We)*p+Ce+et;if(Oh[He]>=he)continue;let tt=Tx[He],lt=Math.abs(tt);lt>ze&&(Ue=tt,ze=lt,$e=et,rt=We)}if(ze>.1){let We=1-(he+.5*Math.abs($e*rt))/R,et=n._dem.get(Ce,ve)+Ue*We,He=n._dem.get(Ce+$e,ve+rt),tt=n._dem.get(Ce-$e,ve-rt,!0);(et-He)*(et-tt)>0&&(et=(He+tt)/2),Tx[De]=n._dem.set(Ce,ve,et),Oh[De]=he}}}}}b&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Ir.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)B0(n.node),xx(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){let p=c[m].node;c[m].hiddenByReplacement=!!p.footprint&&!a.find(b=>b.footprint===p.footprint)}}getHeightAtTileCoord(e,n){let a=this.getNodesInfo(),c=[],m=[0,0,0],p=i.ad.identity([]);for(let b=0;b<this.nodesInfo.length;b++){let y=a[b],w=y.node.meshes[0],M=w.transformedAabb;if(e<M.min[0]||n<M.min[1]||e>M.max[0]||n>M.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};i.ad.invert(p,y.node.matrix),m[0]=e,m[1]=n,i._.transformMat4(m,m,p);let T=(m[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*Ah|0,E=Math.min(63,(m[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*Ah|0)*Ah+Math.min(63,T),P=w.heightmap[E];if(!(P<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:P,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new xt(e,n),new xt(e,n),c),c.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Qf(t,e){return!t.isLightConstant&&e}function u3(t,e,n,a,c,m,p,b){let y=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;n[3]>0&&(y=Wt(y,255*n[0],n[3]),w=Wt(w,255*n[1],n[3]),M=Wt(M,255*n[2],n[3]));let T=y<<8|w,E=M<<8|Math.floor(255*a[3]),P=function(he){let ve=pi(he,0,2);return Math.min(Math.round(.5*ve*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],R=pi(c[0],0,1),F=pi(c[1],0,1),B=pi(c[2],0,1),W=pi(c[3],0,1),J,ee,te,pe;if(R!==F&&p!==m&&F!==R){let he=p-m;ee=1/(he*(F-R)),te=-(m+he*R)/(he*(F-R));let ve=pi(c[4],-1,1);pe=Math.pow(10,ve),J=255*B<<8|255*W}else J=65535,ee=0,te=1,pe=1;if(t.emplaceBack(T,E,P,J,ee,te,pe),b){let he=b.length;b.clear();for(let ve=0;ve<he;ve++)b.emplaceBack(T,E,P,J,ee,te,pe)}}function m3(t,e,n){let a=t.node,c=0,m=n&_m.HasMeshoptCompression;for(let p of a.meshes){if(a.lights&&a.lightMeshIndex===c||!p.featureData)continue;p.featureArray=new H_,p.featureArray.reserve(p.featureData.length);let b=e;for(let y of p.featureData){let w=m?65535&y:y>>16&65535,M=m?y>>16&65535:65535&y,T=(15&M)<8?15&M:0,E=t.evaluatedRMEA[T],P=t.evaluatedColor[T],R=t.emissionHeightBasedParams[T],F;if(b&&T===2&&a.lights&&(F=new H_,F.resize(10*a.lights.length)),u3(p.featureArray,w,P,E,R,p.aabb.min[2],p.aabb.max[2],F),F&&b){b=!1;let B=a.meshes[a.lightMeshIndex];B.featureArray=F,B.featureArray._trim()}}p.featureArray._trim(),c++}}function FM(t,e,n,a){let c=1<<t.z;e.lat=Dr((a/pt+t.y)/c),e.lng=Oo((n/pt+t.x)/c)}ne(H0,"Tiled3dModelBucket",{omit:["layers"]}),ne(LM,"Tiled3dModelFeature");let p3={circle:class extends hr{constructor(t,e,n,a){super(t,eP,e,n,a)}createBucket(t){return new Mv(t)}queryRadius(t){let e=t;return tm("circle-radius",this,e)+tm("circle-stroke-width",this,e)+Z_(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,a,c,m,p,b){let y=$C(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return l2(t,a,m,p,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){let a=s2(this);return{config:new Ch(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}},heatmap:class extends hr{createBucket(t){return new d2(t)}constructor(t,e,n,a){super(t,hP,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return tm("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,a,c,m,p,b){let y=this.paint.get("heatmap-radius").evaluate(e,n);return l2(t,a,m,p,b,!0,!0,new xt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return t==="heatmap"?{config:new Ch(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends hr{constructor(t,e,n,a){super(t,mP,e,n,a)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends hr{constructor(t,e,n,a){super(t,IP,e,n,a)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new Ch(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new r0(t)}queryRadius(){return Z_(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,a,c,m){return!t.queryGeometry.isAboveHorizon&&UC(qC(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends hr{constructor(t,e,n,a){super(t,nO,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new h0(t)}queryRadius(){return Z_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,a,c,m,p,b,y){let w=$C(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,n),T=this.paint.get("fill-extrusion-base").evaluate(e,n),E=[0,0],P=b&&m.elevation,R=m.elevation?m.elevation.exaggeration():1,F=t.tile.getBucket(this);if(P&&F instanceof h0){let te=F.centroidVertexArray,pe=y+1;pe<te.length&&(E[0]=te.geta_centroid_pos0(pe),E[1]=te.geta_centroid_pos1(pe))}if(E[0]===0&&E[1]===1)return!1;m.projection.name==="globe"&&(a=Q2([a],[new xt(0,0),new xt(pt,pt)],t.tileID.canonical).map(te=>te.polygon).flat());let B=P?b:null,[W,J]=function(te,pe,he,ve,Ce,De,Ue,ze,$e,rt,We){return te.projection.name==="globe"?function(et,He,tt,lt,nt,Mt,ot,ht,Vt,Ft,Ot){let ct=[],jt=[],ai=et.projection.upVectorScale(Ot,et.center.lat,et.worldSize).metersToTile,Zt=[0,0,0,1],di=[0,0,0,1],si=(qt,on,rn,ji)=>{qt[0]=on,qt[1]=rn,qt[2]=ji,qt[3]=1},xi=X2();tt>0&&(tt+=xi),lt+=xi;for(let qt of He){let on=[],rn=[];for(let ji of qt){let Ai=ji.x+nt.x,Ui=ji.y+nt.y,_n=et.projection.projectTilePoint(Ai,Ui,Ot),hn=et.projection.upVector(Ot,ji.x,ji.y),Fn=tt,On=lt;if(ot){let eo=J2(Ai,Ui,tt,lt,ot,ht,Vt,Ft);Fn+=eo.base,On+=eo.top}tt!==0?si(Zt,_n.x+hn[0]*ai*Fn,_n.y+hn[1]*ai*Fn,_n.z+hn[2]*ai*Fn):si(Zt,_n.x,_n.y,_n.z),si(di,_n.x+hn[0]*ai*On,_n.y+hn[1]*ai*On,_n.z+hn[2]*ai*On),i._.transformMat4(Zt,Zt,Mt),i._.transformMat4(di,di,Mt),on.push(new Th(Zt[0],Zt[1],Zt[2])),rn.push(new Th(di[0],di[1],di[2]))}ct.push(on),jt.push(rn)}return[ct,jt]}(te,pe,he,ve,Ce,De,Ue,ze,$e,rt,We):Ue?function(et,He,tt,lt,nt,Mt,ot,ht,Vt){let Ft=[],Ot=[],ct=[0,0,0,1];for(let jt of et){let ai=[],Zt=[];for(let di of jt){let si=di.x+lt.x,xi=di.y+lt.y,qt=J2(si,xi,He,tt,Mt,ot,ht,Vt);ct[0]=si,ct[1]=xi,ct[2]=qt.base,ct[3]=1,i.aA.transformMat4(ct,ct,nt),ct[3]=Math.max(ct[3],1e-5);let on=new Th(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ct[0]=si,ct[1]=xi,ct[2]=qt.top,ct[3]=1,i.aA.transformMat4(ct,ct,nt),ct[3]=Math.max(ct[3],1e-5);let rn=new Th(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ai.push(on),Zt.push(rn)}Ft.push(ai),Ot.push(Zt)}return[Ft,Ot]}(pe,he,ve,Ce,De,Ue,ze,$e,rt):function(et,He,tt,lt,nt){let Mt=[],ot=[],ht=nt[8]*He,Vt=nt[9]*He,Ft=nt[10]*He,Ot=nt[11]*He,ct=nt[8]*tt,jt=nt[9]*tt,ai=nt[10]*tt,Zt=nt[11]*tt;for(let di of et){let si=[],xi=[];for(let qt of di){let on=qt.x+lt.x,rn=qt.y+lt.y,ji=nt[0]*on+nt[4]*rn+nt[12],Ai=nt[1]*on+nt[5]*rn+nt[13],Ui=nt[2]*on+nt[6]*rn+nt[14],_n=nt[3]*on+nt[7]*rn+nt[15],hn=ji+ht,Fn=Ai+Vt,On=Ui+Ft,eo=Math.max(_n+Ot,1e-5),Un=ji+ct,Tn=Ai+jt,lr=Ui+ai,Ar=Math.max(_n+Zt,1e-5);si.push(new Th(hn/eo,Fn/eo,On/eo)),xi.push(new Th(Un/Ar,Tn/Ar,lr/Ar))}Mt.push(si),ot.push(xi)}return[Mt,ot]}(pe,he,ve,Ce,De)}(m,a,T,M,w,p,B,E,R,m.center.lat,t.tileID.canonical),ee=t.queryGeometry;return function(te,pe,he){let ve=1/0;UC(he,pe)&&(ve=K2(he,pe[0]));for(let Ce=0;Ce<pe.length;Ce++){let De=pe[Ce],Ue=te[Ce];for(let ze=0;ze<De.length-1;ze++){let $e=De[ze],rt=[$e,De[ze+1],Ue[ze+1],Ue[ze],$e];kv(he,rt)&&(ve=Math.min(ve,K2(he,rt)))}}return ve!==1/0&&ve}(W,J,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends hr{constructor(t,e,n,a){super(t,m0,e,n,a),m0.layout&&(this.layout=new nn(m0.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof gh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=rM.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new u0(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){let a=sS(this);return{config:new Ch(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}queryRadius(t){let e=t,n=oM(tm("line-width",this,e),tm("line-gap-width",this,e)),a=tm("line-offset",this,e);return n/2+Math.abs(a)+Z_(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,a,c,m){if(t.queryGeometry.isAboveHorizon)return!1;let p=qC(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,t.pixelToTileUnitsFactor),b=t.pixelToTileUnitsFactor/2*oM(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(a=function(w,M){let T=[],E=new xt(0,0);for(let P=0;P<w.length;P++){let R=w[P],F=[];for(let B=0;B<R.length;B++){let W=R[B],J=R[B+1],ee=B===0?E:W.sub(R[B-1])._unit()._perp(),te=B===R.length-1?E:J.sub(W)._unit()._perp(),pe=ee._add(te)._unit();pe._mult(1/(pe.x*te.x+pe.y*te.y)),F.push(pe._mult(M)._add(W))}T.push(F)}return T}(a,y*t.pixelToTileUnitsFactor)),function(w,M,T){for(let E=0;E<M.length;E++){let P=M[E];if(w.length>=3){for(let R=0;R<P.length;R++)if($c(w,P[R]))return!0}if(XA(w,P,T))return!0}return!1}(p,a,b)}isTileClipped(){return!0}isDraped(t){let e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:P0,background:class extends hr{constructor(t,e,n,a){super(t,PR,e,n,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:cM,"raster-particle":dM,sky:class extends hr{constructor(t,e,n,a){super(t,VR,e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=kf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),c=!a,m=t.style.light,p=m.properties.get("position");return c&&m.properties.get("anchor")==="viewport"&&Zn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?_x(p.azimuthal,90-p.polar,e):_x(a[0],90-a[1],e)}let n=this.paint.get("sky-gradient-center");return _x(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends hr{constructor(t,e,n,a){super(t,jR,e,null)}},model:class extends hr{constructor(t,e,n,a){super(t,XR,e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new yx(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof H0?pt-1:0}queryIntersectsFeature(t,e,n,a,c,m){if(!this.modelManager)return!1;let p=this.modelManager,b=t.tile.getBucket(this);if(!(b&&b instanceof yx))return!1;let y=b;for(let w in y.instancesPerModel){let M=y.instancesPerModel[w],T=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(T)){let E=M.features[M.idToFeaturesIndex[T]],P=p.getModel(w,this.scope);if(!P)return!1;let R=i.ad.create(),F=new Li(0,0),B=y.canonical,W=Number.MAX_VALUE;for(let J=0;J<E.instancedDataCount;++J){let ee=16*(E.instancedDataOffset+J),te=M.instancedDataArray.float32,pe=[te[ee+4],te[ee+5],te[ee+6]];FM(B,F,te[ee],0|te[ee+1]),vM(R,P,m,F,E.rotation,E.scale,pe,!1,!1,!1),m.projection.name==="globe"&&(R=bx(R,m));let he=i.ad.multiply([],m.projMatrix,R),ve=t.queryGeometry,Ce=gM(ve.isPointQuery()?ve.screenBounds:ve.screenGeometry,m,he,P.aabb);Ce!=null&&(W=Math.min(Ce,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Y}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,a){let c=t.tile,m=c.getBucket(this),p=null,b=Number.MAX_VALUE;if(!(m&&m instanceof H0))return{queryFeature:p,intersectionZ:b};let y=m.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new Qt(c.tileID.overscaledZ),y.feature,c.tileID.canonical))return{queryFeature:p,intersectionZ:b};let w=y.node,M=a.calculatePosMatrix(c.tileID.toUnwrapped(),a.worldSize),T=y.evaluatedScale,E=0;a.elevation&&w.elevation&&(E=w.elevation*a.elevation.exaggeration()),i.ad.translate(M,M,[(w.anchor?w.anchor[0]:0)*(T[0]-1),(w.anchor?w.anchor[1]:0)*(T[1]-1),E]),i.ad.scale(M,M,T),i.ad.multiply(M,M,w.matrix);let P=t.queryGeometry,R=P.isPointQuery()?P.screenBounds:P.screenGeometry,F=function(W){let J=i.ad.multiply([],M,W.matrix),ee=i.ad.multiply(J,a.expandedFarZProjMatrix,J);for(let te=0;te<W.meshes.length;++te){let pe=W.meshes[te];if(te===W.lightMeshIndex)continue;let he=gM(R,a,ee,pe.aabb);he!=null&&(b=Math.min(he,b))}if(W.children)for(let te of W.children)F(te)};if(F(w),b===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:b};let B=new Li(0,0);return FM(c.tileID.canonical,B,y.node.anchor[0],y.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[B.lng,B.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:b}}},clip:class extends hr{constructor(t,e,n,a){super(t,EP,e,n,a)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new b2(t)}isTileClipped(){return!0}is3D(){return!0}}};ne(tM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let zM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ex{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let m=zM[15&a];if(!m)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new Ex(b,p,m,e)}constructor(e,n=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let m=zM.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+b+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Dx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:p,nodeSize:b}=this,y=[0,m.length-1,0],w=[];for(;y.length;){let M=y.pop()||0,T=y.pop()||0,E=y.pop()||0;if(T-E<=b){for(let B=E;B<=T;B++){let W=p[2*B],J=p[2*B+1];W>=e&&W<=a&&J>=n&&J<=c&&w.push(m[B])}continue}let P=E+T>>1,R=p[2*P],F=p[2*P+1];R>=e&&R<=a&&F>=n&&F<=c&&w.push(m[P]),(M===0?e<=R:n<=F)&&(y.push(E),y.push(P-1),y.push(1-M)),(M===0?a>=R:c>=F)&&(y.push(P+1),y.push(T),y.push(1-M))}return w}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:m,nodeSize:p}=this,b=[0,c.length-1,0],y=[],w=a*a;for(;b.length;){let M=b.pop()||0,T=b.pop()||0,E=b.pop()||0;if(T-E<=p){for(let B=E;B<=T;B++)NM(m[2*B],m[2*B+1],e,n)<=w&&y.push(c[B]);continue}let P=E+T>>1,R=m[2*P],F=m[2*P+1];NM(R,F,e,n)<=w&&y.push(c[P]),(M===0?e-a<=R:n-a<=F)&&(b.push(E),b.push(P-1),b.push(1-M)),(M===0?e+a>=R:n+a>=F)&&(b.push(P+1),b.push(T),b.push(1-M))}return y}}function Dx(t,e,n,a,c,m){if(c-a<=n)return;let p=a+c>>1;BM(t,e,p,a,c,m),Dx(t,e,n,a,p-1,1-m),Dx(t,e,n,p+1,c,1-m)}function BM(t,e,n,a,c,m){for(;c>a;){if(c-a>600){let w=c-a+1,M=n-a+1,T=Math.log(w),E=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*E*(w-E)/w)*(M-w/2<0?-1:1);BM(t,e,n,Math.max(a,Math.floor(n-M*E/w+P)),Math.min(c,Math.floor(n+(w-M)*E/w+P)),m)}let p=e[2*n+m],b=a,y=c;for(Kf(t,e,a,n),e[2*c+m]>p&&Kf(t,e,a,c);b<y;){for(Kf(t,e,b,y),b++,y--;e[2*b+m]<p;)b++;for(;e[2*y+m]>p;)y--}e[2*a+m]===p?Kf(t,e,a,y):(y++,Kf(t,e,y,c)),y<=n&&(a=y+1),n<=y&&(c=y-1)}}function Kf(t,e,n,a){Ax(t,n,a),Ax(e,2*n,2*a),Ax(e,2*n+1,2*a+1)}function Ax(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}function NM(t,e,n,a){let c=t-n,m=e-a;return c*c+m*m}i.$=dl,i.A=mh,i.B=Fs,i.C=Bi,i.D=Qr,i.E=gl,i.G=Kr,i.H=h,i.I=aR,i.J=Xy,i.K=function(t){let e=t.value,n=[];if(!e)return n;let a=bl(e);return a!=="string"?(n=n.concat([new z0(t.key,e,`string expected, "${a}" found`)]),n):(_M(e,!0)||(n=n.concat([new z0(t.key,e,`invalid url "${e}"`)])),n)},i.L=Pe,i.M=class{constructor(t,e,n,a){this.id=t,this.position=e!=null?new Li(e[0],e[1]):new Li(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(i.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let a=Pn.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=i.ad.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,a,c,m,p=!1){vM(this.matrix,this,t.transform,this.position,e,n,a,c,m,p)}upload(t){if(!this.uploaded){for(let e of this.nodes)vx(e,t);for(let e of this.nodes)B0(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)xx(t)}},i.N=qi,i.O=Ke,i.P=xt,i.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return $a(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Wt(t.x,e.x,n),y:Wt(t.y,e.y,n),z:Wt(t.z,e.z,n),azimuthal:Wt(t.azimuthal,e.azimuthal,n),polar:Wt(t.polar,e.polar,n)}}},i.R=wu,i.S=dv,i.T=Aa,i.U=Qi,i.V=z0,i.W=Hr,i.X=Qt,i.Y=Jr,i.Z=Y,i.a=Wo,i.a$=function(t){let{x:e,y:n}=t.point,{lng:a,lat:c}=t._center;return r2(e,n,t.worldSize,a,c)},i.a0=nn,i.a1=Pl,i.a2=Wt,i.a3=pt,i.a4=s_,i.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,a]){let c=$a([1,n,a]);return{x:c.x,y:c.y,z:c.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Wt(t.x,e.x,n),y:Wt(t.y,e.y,n),z:Wt(t.z,e.z,n)}}},i.a6=yf,i.a7=G_,i.a8=Tl,i.a9=PC,i.aB=function(t,e){let{x:n,y:a}=t.point,c=r2(n,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return i.ad.multiply(c,c,Lv(js(e)))},i.aD=lm,i.aE=pa,i.aF=g0,i.aG=function(t,e,n,a,c){let m=5*e+2;t.float32[m+0]=n,t.float32[m+1]=a,t.float32[m+2]=c},i.aH=I0,i.aI=Li,i.aJ=qS,i.aK=FC,i.aL=ur,i.aM=Pv,i.aN=uM,i.aO=Mh,i.aP=t2,i.aQ=function(t,e,n,a,c,m,p,b,y){if(y.name==="globe")return t2(t,e,new Mh(n,a,c),!1);let w=Eh({z:n,x:a,y:c},y);return new Pn([(m+w.x/w.scale)*e,e*(w.y/w.scale),p],[(m+w.x2/w.scale)*e,e*(w.y2/w.scale),b])},i.aR=function(t,e,n){let a=0;for(let c=0;c<2;++c)t[c]>0&&(a+=(t[c]-0)*(t[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},i.aS=Qn,i.aT=Dv,i.aU=RC,i.aV=function(t){let e=i.ad.identity(new Float64Array(16));i.ad.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,Ea,0],a=[0,Da,0];return i._.transformMat4(n,n,e),i._.transformMat4(a,a,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!zv(t,new Li(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!zv(t,new Li(t.center.lat,-90))]},i.aW=function(t,e){let{scale:n}=t.tileTransform,a=n*pt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return i.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},i.aX=L0,i.aY=hM,i.aZ=function(t){let e=hM(t,!0);return i.aC.invert([],[e[0],e[1],e[4],e[5]])},i.a_=Av,i.aa=_o,i.ab=Ei,i.ac=function(t,e,n){let a=Math.sqrt(t*t+e*e+n*n),c=a>0?Math.acos(n/a)*Vd:0,m=t!==0||e!==0?Math.atan2(-e,-t)*Vd+90:0;return m<0&&(m+=360),[a,m,c]},i.ae=mm,i.af=os,i.ag=ax,i.ah=function(t,e){let n={};for(let a=0;a<e.length;a++){let c=e[a];c in t&&(n[c]=t[c])}return n},i.ai=qc,i.aj=Ns,i.ak=Vs,i.al=$u,i.am=function(t){vu++,vu>Ip&&(t.getActor().send("enforceCacheSizeLimit",kp),vu=0)},i.an=Lp,i.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,a){let c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){let[m,p]=c.result;return this.scheduler?this.scheduler.add(()=>{a(m,p)},e):a(m,p),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=n((m,p)=>{c.result=[m,p];for(let b of c.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,p)},e):b(m,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(m=>m!==a),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}},i.ap=function(t,e,n){let a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{let m=pl(t.request,(p,b,y,w)=>{p?c(p):b&&c(null,{vectorTile:n?void 0:new Wv(new sm(b)),rawData:b,cacheControl:y,expires:w})});return()=>{m.cancel(),c()}},e)},i.aq=pv,i.ar=class extends Il{constructor(t){super(t),this.current=FA}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},i.as=fv,i.at=pi,i.au=hl,i.aw=Gd,i.ax=yo,i.ay=Dr,i.az=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},i.b=An,i.b$=Xc,i.b0=Ur,i.b1=bv,i.b2=function(t){let e=Math.round((t+45+360)%360/90)%4;return Yg[e]},i.b3=45,i.b4=xv,i.b5=q_,i.b6=Pn,i.b7=$a,i.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},i.b9=bp,i.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},i.bB=rS,i.bD=n2,i.bE=_u,i.bF=gu,i.bG=256,i.bH=function(t,e){let n=[0,0,0],a=Mf(js(e.canonical));return i._.transformMat4(n,n,a),i._.transformMat4(n,n,t),n},i.bI=t=>({u_camera_to_center_distance:new _o(t),u_extrude_scale:new gv(t),u_device_pixel_ratio:new _o(t),u_matrix:new yf(t),u_inv_rot_matrix:new yf(t),u_merc_center:new Tl(t),u_tile_id:new pv(t),u_zoom_transition:new _o(t),u_up_dir:new pv(t),u_emissive_strength:new _o(t)}),i.bJ=t=>({u_matrix:new yf(t),u_pixels_to_tile_units:new gv(t),u_device_pixel_ratio:new _o(t),u_units_to_pixels:new Tl(t),u_dash_image:new G_(t),u_gradient_image:new G_(t),u_image_height:new _o(t),u_texsize:new Tl(t),u_tile_units_to_pixels:new _o(t),u_alpha_discard_threshold:new _o(t),u_trim_offset:new Tl(t),u_trim_fade_range:new Tl(t),u_trim_color:new fv(t),u_emissive_strength:new _o(t)}),i.bK=t=>({u_matrix:new yf(t),u_texsize:new Tl(t),u_pixels_to_tile_units:new gv(t),u_device_pixel_ratio:new _o(t),u_image:new G_(t),u_units_to_pixels:new Tl(t),u_tile_units_to_pixels:new _o(t),u_alpha_discard_threshold:new _o(t),u_trim_offset:new Tl(t)}),i.bL=nv,i.bM=gO,i.bN=Gr,i.bO=RO,i.bP=zS,i.bQ=Jv,i.bR=s2,i.bS=(t,e,n,a,c,m)=>{let p=t.transform,b=p.projection.name==="globe",y;if(m.paint.get("circle-pitch-alignment")==="map")if(b){let M=n2(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;y=Float32Array.from([M,0,0,M])}else y=p.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let w={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ir.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:aP,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(b){w.u_inv_rot_matrix=a,w.u_merc_center=c,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Pl(p.zoom);let M=c[0]*pt,T=c[1]*pt;w.u_up_dir=p.projection.upVector(new Mh(0,0,0),M,T)}return w},i.bT=sS,i.bU=(t,e,n,a,c,m)=>{let p=t.transform;return{u_matrix:aS(t,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:oS(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m}},i.bV=(t,e,n,a,c,m,p)=>{let b=t.transform,y=b.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:aS(t,e,n,a),u_pixels_to_tile_units:y,u_device_pixel_ratio:m,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:lS(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:oS(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},i.bW=yp,i.bX=kf,i.bY=X2,i.bZ=WA,i.b_=h0,i.ba=function(t,e,n){let a=Pl(n.zoom),c=t.style.map._antialias,m=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!c&&!m},i.bb=function(t){let e=t.pixelsPerMeter,n=e/yo(1,t.center.lat),a=i.ad.identity(new Float64Array(16));return i.ad.translate(a,a,[t.point.x,t.point.y,0]),i.ad.scale(a,a,[n,n,e]),Float32Array.from(a)},i.bc=K_,i.bd=function(t){let e=Qn-5;t=pi(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(Ei(t))),3);return Math.round(n*(yv.length-1))},i.be=function(t,e,n,a){let c=e.getNorth(),m=e.getSouth(),p=e.getWest(),b=e.getEast(),y=1<<t.z,w=b-p,M=c-m,T=w/Qu,E=-M/yv[n],P=[0,T,0,E,0,0,c,p,0];if(t.z>0){let R=180/a;i.bC.multiply(P,P,[R/w+1,0,0,0,R/M+1,0,-.5*R/T,.5*R/E,1])}return P[2]=y,P[5]=t.x,P[8]=t.y,P},i.bf=Mf,i.bg=js,i.bh=function(t,e,n){let a=i.ad.identity(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return i.ad.rotateY(a,n.globeMatrix,c),Float32Array.from(a)},i.bi=bc,i.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},i.bk=cM,i.bl=dM,i.bm=lM,i.bn=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<t.length;a++){let c=document.createElement("source");Jg(t[a])||(n.crossOrigin="Anonymous"),c.src=t[a],n.appendChild(c)}return{cancel:()=>{}}},i.bo=T0,i.bp=mu,i.bq=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,a=1<<n,c=Math.floor(t.x),m=Math.floor((t.x-c)*a),p=Math.floor(t.y*a),b=this.findDEMTileFor(new ur(n,c,n,m,p));return!(!b||!b.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||t.y<0||t.y>1)return e;let c=a.getSource().maxzoom,m=1<<c,p=Math.floor(t.x),b=t.x-p,y=new ur(c,p,c,Math.floor(b*m),Math.floor(t.y*m)),w=this.findDEMTileFor(y);if(!w||!w.dem)return e;let M=w.dem,T=1<<w.tileID.canonical.z,E=(b*T-w.tileID.canonical.x)*M.dim,P=(t.y*T-w.tileID.canonical.y)*M.dim,R=Math.floor(E),F=Math.floor(P);return(n?this.exaggeration():1)*Wt(Wt(M.get(R,F),M.get(R,F+1),P-F),Wt(M.get(R+1,F),M.get(R+1,F+1),P-F),E-R)}getAtTileOffset(t,e,n){let a=1<<t.canonical.z;return this.getAtPointOrZero(new Jr(t.wrap+(t.canonical.x+e/pt)/a,(t.canonical.y+n/pt)/a))}getAtTileOffsetFunc(t,e,n,a){return c=>{let m=this.getAtTileOffset(t,c.x,c.y),p=a.upVector(t.canonical,c.x,c.y),b=a.upVectorScale(t.canonical,e,n).metersToTile;return i._.scale(p,p,m*b),p}}getForTilePoints(t,e,n,a){if(this.isUsingMockSource())return!1;let c=rm.create(this,t,a);return!!c&&(e.forEach(m=>{m[2]=this.exaggeration()*c.getElevationAt(m[0],m[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,a=e.tileID,c=1<<t.canonical.z-a.canonical.z,m=t.canonical.x/c-a.canonical.x,p=t.canonical.y/c-a.canonical.y,b=0;for(let y=0;y<t.canonical.z-a.canonical.z&&!n.leaves[b];y++){m*=2,p*=2;let w=2*Math.floor(p)+Math.floor(m);b=n.childOffsets[b]+w,m%=1,p%=1}return{min:this.exaggeration()*n.minimums[b],max:this.exaggeration()*n.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let c of t){let m=this.getMinMaxForTile(c.tileID);m&&(n=Math.min(n,m.min),a=Math.max(a,m.max),e=!0)}return e?{min:n,max:a}:null}},i.br=Cf,i.bs=Q_,i.bt=es,i.bu=wr,i.bv=Dh,i.bw=wx,i.bx=N0,i.by=A0,i.bz=m2,i.c=AM,i.c$=$d,i.c0=450,i.c1=7,i.c2=LR,i.c3=iM,i.c4=256,i.c5=JC,i.c6=Lv,i.c7=$i,i.c8=jc,i.c9=wh,i.cA=function(t){let e=1/0,n=1/0,a=-1/0,c=-1/0;for(let m of t)e=Math.min(e,m.x),n=Math.min(n,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return{min:new xt(e,n),max:new xt(a,c)}},i.cB=$c,i.cC=VC,i.cD=bo,i.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.cF=DS,i.cG=kv,i.cH=E2,i.cI=D2,i.cJ=nx,i.cK=Ex,i.cL=function(t){return t({pluginStatus:it,pluginURL:Ge}),ti.on("pluginStateChange",t),t},i.cM=dm,i.cN=tx,i.cO=Cu,i.cP=Dt,i.cQ=N,i.cR=Mp,i.cS=Cc,i.cT=Ca,i.cU=function(t){let e=t.indexOf(zc);return e>=0?t.slice(0,e):t},i.cV=function(t){return t.indexOf(zc)>=0},i.cW=function(t){let e=t.indexOf(zc);return e>=0?t.slice(e+1):""},i.cX=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},i.cY=function(t,e,n,a){return t.type==="custom"?new BR(t,e):new p3[t.type](t,e,n,a)},i.cZ=ul,i.c_=ti,i.ca=1,i.cb=Uf,i.cc=0,i.cd=sv,i.ce=function(t,e,n,a,c){return pi((t-e)/(n-e)*(c-a)+a,a,c)},i.cf=O_,i.cg=kh,i.ch=class{constructor(t,e,n,a){this.context=t,this.format=a,this.size=n,this.texture=t.gl.createTexture();let[c,m,p]=this.size,{gl:b}=t;b.bindTexture(b.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,w=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(y=b.DEPTH_COMPONENT16,w=b.UNSIGNED_SHORT),this.format===b.R8&&(a=b.RED),this.format===b.R32F&&(w=b.FLOAT,a=b.RED),b.texImage3D(b.TEXTURE_3D,0,y,c,m,p,0,a,w,e.data)}bind(t,e){let{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_3D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},i.ci=bx,i.cj=[1,1,1],i.ck=rm,i.cl=_m,i.cm=Hc,i.cn=Zu,i.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new xt(1/0,1/0),max:new xt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){let n=k2(new xt(0,0),new xt(pt,pt),t),a=[];if(e&&!Gv(n,this._globalClipBounds))return a;for(let c of this._activeRegions){if(c.hiddenByOverlap||!Gv(n,c))continue;let m=HP(c.min,c.max,t);a.push({min:m.min,max:m.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask})}return a}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let a of e.cache.getVisibleCoordinates()){let c=e.cache.getTile(a).buckets[e.layer];c&&c.updateFootprints(a.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){let e=t.getFootprints();if(e.length===0)return;let n=t.getOrder(),a=t.getClipMask();for(let c of e){if(!c.footprint)continue;let m=k2(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:n,clipMask:a})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||l0(e.min,n.min)||l0(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){let n=this._activeRegions[e],a=this._prevRegions[e];t=n.priority!==a.priority||!M2(n,a)||n.order!==a.order||n.clipMask!==a.clipMask,++e}}if(t){++this._updateTime;for(let n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));let e=n=>{let a=this._activeRegions;if(n>=a.length)return n;let c=a[n].priority;for(;n<a.length&&a[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let c=n,m=n;for(;c!==a;){let p=this._activeRegions[c];p.hiddenByOverlap=!1;for(let b=0;b<m;b++){let y=this._activeRegions[b];if(!y.hiddenByOverlap&&p.order===1/0&&Gv(p,y)&&(p.hiddenByOverlap=T2(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++c}n=a,a=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},i.cp=Nc,i.cq=D0,i.cr=_f,i.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new es,a=new wr,c=[],m=t+1+2,p=e[0]+1,b=e[0]+1+(1+e.length),y=(w,M,T)=>{let E=w===m-1?w-2:w===0?w:w-1;return E+=T?24575:0,[E,M]};for(let w=0;w<m;++w)n.emplaceBack(...y(w,0,!0));for(let w=0;w<p;++w)for(let M=0;M<m;++M)n.emplaceBack(...y(M,w,(M===0||M===m-1)&&!0));for(let w=0;w<e.length;++w){let M=e[w];for(let T=0;T<m;++T)n.emplaceBack(...y(T,M,!0))}for(let w=0;w<e.length;++w){let M=a.length,T=e[w]+1+2,E=new wr;for(let F=0;F<T-1;F++){let B=F===T-2,W=B?m*(b-e.length+w-F):m;for(let J=0;J<m-1;J++){let ee=F*m+J;F===0||B||J===0||J===m-2?(E.emplaceBack(ee+1,ee,ee+W),E.emplaceBack(ee+W,ee+W+1,ee+1)):(a.emplaceBack(ee+1,ee,ee+W),a.emplaceBack(ee+W,ee+W+1,ee+1))}}let P=An.simpleSegment(0,M,n.length,a.length-M);for(let F=0;F<E.uint16.length;F+=3)a.emplaceBack(E.uint16[F],E.uint16[F+1],E.uint16[F+2]);let R=An.simpleSegment(0,M,n.length,a.length-M);c.push({withoutSkirts:P,withSkirts:R})}return{vertices:n,indices:a,segments:c}}_createGrid(t){let e=this._fillGridMeshWithLods(Qu,yv);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Cf.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new wr;for(let p=0;p<=Qu;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new wh,a=new wh,c=new wh,m=new wh;this._poleSegments=[];for(let p=0,b=0;p<bv;p++){let y=360/(1<<p);n.emplaceBack(0,-bo,0,.5,0),a.emplaceBack(0,-bo,0,.5,1),c.emplaceBack(0,-bo,0,.5,.5),m.emplaceBack(0,-bo,0,.5,.5);for(let w=0;w<=Qu;w++){let M=w/Qu,T=0,E=Wt(0,y,M),[P,R,F]=Ku(rP,oP,E,bo);n.emplaceBack(P,R,F,M,T),a.emplaceBack(P,R,F,M,1-T);let B=Ei(E);M=.5+.5*Math.sin(B),T=.5+.5*Math.cos(B),c.emplaceBack(P,R,F,M,T),m.emplaceBack(P,R,F,M,1-T)}this._poleSegments.push(An.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,X_,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,X_,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,X_,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(m,X_,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},i.ct=function(t){return Kd.has(t)},i.cu=B2,i.cv=function(t,e,n=0,a=!0){let c=new xt(n,n),m=t.sub(c),p=e.add(c),b=[m,new xt(p.x,m.y),p,new xt(m.x,p.y)];return a&&b.push(m.clone()),b},i.cw=function(t,e){let n=[];for(let a=0;a<t.length;a++){let c=hl(a-1,-1,t.length-1),m=hl(a+1,-1,t.length-1),p=t[a],b=t[m],y=t[c].sub(p).unit(),w=b.sub(p).unit(),M=w.angleWithSep(y.x,y.y),T=y.add(w).unit().mult(-1*e/Math.sin(M/2));n.push(p.add(T))}return n},i.cx=jS,i.cy=GC,i.cz=function(t,e,n=0){return i._.fromValues(((e.x-n)*t.scale-t.x)*pt,(e.y*t.scale-t.y)*pt,zC(e.z,e.y))},i.d=Iu,i.d$=du,i.d0=jd,i.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.d2=pc,i.d3=NC,i.d4=Sh,i.d5=function([t,e,n]){let a=Math.hypot(t,e,n),c=Math.atan2(t,n),m=.5*Math.PI-Math.acos(-e/a);return new Li(Ur(c),Ur(m))},i.d6=Oo,i.d7=Ju,i.d8=I,i.d9=zv,i.dA=function(t){let e=Qg();if(!e)return;let n=e.delete(Xg);t&&n.catch(t).then(()=>t())},i.dB=$f,i.dC=wM,i.dD=function(t){Sx=Ir.resolveURL(t),ym||(ym=new wx(N0(),new gl)),ym.broadcast("setDracoUrl",Sx)},i.dE=CM,i.dF=function(t){bm=Ir.resolveURL(t),ym||(ym=new wx(N0(),new gl)),ym.broadcast("setMeshoptUrl",bm)},i.dG=Vo,i.dH=ne,i.dI=Yc,i.dJ=rs,i.dK=Eh,i.dL=uv,i.dM=cS,i.dN=gS,i.dO=iS,i.dP=gc,i.dQ=PS,i.dR=pm,i.dS=function(t,e,n,a,c,m,p,b,y,w,M){t.createArrays(),t.tilePixelRatio=pt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let T=t.layers[0].layout,E=t.layers[0]._unevaluatedLayout._values,P={};if(t.textSizeData.kind==="composite"){let{minZoom:W,maxZoom:J}=t.textSizeData;P.compositeTextSizes=[E["text-size"].possiblyEvaluate(new Qt(W),b),E["text-size"].possiblyEvaluate(new Qt(J),b)]}if(t.iconSizeData.kind==="composite"){let{minZoom:W,maxZoom:J}=t.iconSizeData;P.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new Qt(W),b),E["icon-size"].possiblyEvaluate(new Qt(J),b)]}P.layoutTextSize=E["text-size"].possiblyEvaluate(new Qt(y+1),b),P.layoutIconSize=E["icon-size"].possiblyEvaluate(new Qt(y+1),b),P.textMaxSize=E["text-size"].possiblyEvaluate(new Qt(18),b);let R=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",F=T.get("text-size"),B=!1;for(let W of t.features)if(W.icon&&W.icon.nameSecondary){B=!0;break}for(let W of t.features){let J=T.get("text-font").evaluate(W,{},b).join(","),ee=F.evaluate(W,{},b),te=P.layoutTextSize.evaluate(W,{},b),pe=(P.layoutIconSize.evaluate(W,{},b),{horizontal:{},vertical:void 0}),he=W.text,ve,Ce=[0,0];if(he){let ze=he.toString(),$e=T.get("text-letter-spacing").evaluate(W,{},b)*Gr,rt=T.get("text-line-height").evaluate(W,{},b)*Gr,We=Be(ze)?$e:0,et=T.get("text-anchor").evaluate(W,{},b),He=T.get("text-variable-anchor");if(!He){let ot=T.get("text-radial-offset").evaluate(W,{},b);Ce=ot?zS(et,[ot*Gr,ix]):T.get("text-offset").evaluate(W,{},b).map(ht=>ht*Gr)}let tt=R?"center":T.get("text-justify").evaluate(W,{},b),lt=T.get("symbol-placement")==="point",nt=lt?T.get("text-max-width").evaluate(W,{},b)*Gr:1/0,Mt=ot=>{t.allowVerticalPlacement&&Le(ze)&&(pe.vertical=Kv(he,e,n,c,J,nt,rt,et,ot,We,Ce,pa.vertical,!0,te,ee))};if(!R&&He){let ot=tt==="auto"?He.map(Vt=>nx(Vt)):[tt],ht=!1;for(let Vt=0;Vt<ot.length;Vt++){let Ft=ot[Vt];if(!pe.horizontal[Ft])if(ht)pe.horizontal[Ft]=pe.horizontal[0];else{let Ot=Kv(he,e,n,c,J,nt,rt,"center",Ft,We,Ce,pa.horizontal,!1,te,ee);Ot&&(pe.horizontal[Ft]=Ot,ht=Ot.positionedLines.length===1)}}Mt("left")}else{if(tt==="auto"&&(tt=nx(et)),lt||T.get("text-writing-mode").indexOf("horizontal")>=0||!Le(ze)){let ot=Kv(he,e,n,c,J,nt,rt,et,tt,We,Ce,pa.horizontal,!1,te,ee);ot&&(pe.horizontal[tt]=ot)}Mt(lt?"left":tt)}}let De=!1;if(W.icon&&W.icon.namePrimary){let ze=a[W.icon.namePrimary];ze&&(ve=HO(c[W.icon.namePrimary],W.icon.nameSecondary?c[W.icon.nameSecondary]:void 0,T.get("icon-offset").evaluate(W,{},b),T.get("icon-anchor").evaluate(W,{},b)),De=ze.sdf,t.sdfIcons===void 0?t.sdfIcons=ze.sdf:t.sdfIcons!==ze.sdf&&Zn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==t.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Ue=NS(pe.horizontal)||pe.vertical;t.iconsInText||(t.iconsInText=!!Ue&&Ue.iconsInText),(Ue||ve)&&XO(t,W,pe,ve,a,P,te,0,Ce,De,p,b,w,M,B)}m&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},i.dT=u0,i.dU=r0,i.dV=Wv,i.dW=sm,i.dX=c0,i.dY=px,i.dZ=a0,i.d_=o0,i.da=o2,i.db=function(t){let e=[0,0,0],n=i.ad.identity(new Float64Array(16));return i.ad.multiply(n,t.pixelMatrix,t.globeMatrix),i._.transformMat4(e,e,n),new xt(e[0],e[1])},i.dc=ke,i.dd=xe,i.de=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(fu==null){let a=n.navigator?n.navigator.userAgent:null;fu=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return fu}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.df=hu,i.dg=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Op,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!N(t))return t;let n=aa(t);return n.params.push(`sdk=js-${_}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!N(t))return t;let n=aa(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!N(t))return t;let n=aa(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,a){if(!N(t))return t;let c=aa(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,a){let c=aa(t);return N(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${e}${n}`,xc(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!N(t))return t;let a=aa(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${xu.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${I.RASTER_URL_PREFIX}${a.path}`:a.authority==="rasterarrays"?a.path=`/${I.RASTERARRAYS_URL_PREFIX}${a.path}`:a.authority==="3dtiles"?a.path=`/${I.TILES3D_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${I.TILE_URL_VERSION}${a.path}`);let c=this._customAccessToken||function(m){for(let p of m){let b=p.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(a.params)||I.ACCESS_TOKEN;return I.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(t,e){let n=aa(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${I.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?a+=`rasterarrays/${n.path.replace(`/${I.RASTERARRAYS_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${I.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(m=>!m.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(t,e){let n=!!e&&N(e),a=[];for(let c of t.tiles||[])O(c)?a.push(this.canonicalizeTileURL(c,n)):a.push(c);return a}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=aa(I.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!I.REQUIRE_ACCESS_TOKEN)return xc(t);if(e=e||I.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),xc(t)}},i.dh=function(t,e){e?Kd.add(t):Kd.delete(t)},i.di=xu,i.dj=Oy,i.dk=ku,i.dl=Rp,i.dm=i_,i.dn=Py,i.dp=function(t){Kd.delete(t)},i.dq=wc,i.dr=Qd,i.ds=fc,i.dt=_,i.du=function(t,e){kp=t,Ip=e},i.dv=function(t,e,n=!1){if(it===gt||it===yt||it===kt)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ge=Ir.resolveURL(t),it=gt,vt=e,oi(),n||Di()},i.dw=vi,i.dx=function(){N0().acquire(Cx)},i.dy=function(){let t=Zf;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Cx),Zf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dz=Yf,i.e=Ir,i.e0=dS,i.e1=Xe,i.e2=pl,i.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==MM){let n=new Uint32Array(t,0,7),[,,a,c,m,p]=n;e=n.byteLength+c+m+p+m,(a!==t.byteLength||e>=t.byteLength)&&Zn("Invalid b3dm header information.")}return EM(t,e)},i.e4=function(t,e){let n=AM(t);for(let a of n){for(let c of a.meshes)d3(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(h3(a.lights,e)))}return n},i.e5=H0,i.e6=xM,i.e7=Ji,i.e8=function(t){qd(),Za&&Za.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-t;a++)e.delete(n[a])})})},i.f=oo,i.g=function(t,e){return $d(Hr(t,{type:"json"}),e)},i.h=Es,i.i=ma,i.j=AS,i.k=ex,i.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>EM(e,0,t))},i.m=class extends z0{},i.n=bl,i.o=Np,i.p=dR,i.q=qu,i.r=f,i.s=o,i.t=z,i.u=Ao,i.v=Er,i.w=Zn,i.x=Z,i.y=U,i.z=Fu}),r(["./shared"],function(i){function _(Se){let G=Se?Se.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function C(Se){if(typeof Se=="number"||typeof Se=="boolean"||typeof Se=="string"||Se==null)return JSON.stringify(Se);if(Array.isArray(Se)){let K="[";for(let ce of Se)K+=`${C(ce)},`;return`${K}]`}let G="{";for(let K of Object.keys(Se).sort())G+=`${K}:${C(Se[K])},`;return`${G}}`}function I(Se){let G="";for(let K of i.cE)G+=`/${C(Se[K])}`;return G}class O{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,K){this._layerConfigs={},this._layers={},this.update(G,[],K)}update(G,K,ce){this._options=ce;for(let ye of G)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=i.cY(ye,this.scope,null,this._options)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(let ye of K)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};let be=function(ye,Ee){let Ne={};for(let je=0;je<ye.length;je++){let mt=Ee&&Ee[ye[je].id]||I(ye[je]);Ee&&(Ee[ye[je].id]=mt);let at=Ne[mt];at||(at=Ne[mt]=[]),at.push(ye[je])}let Ie=[];for(let je in Ne)Ie.push(Ne[je]);return Ie}(i.dG(this._layerConfigs),this.keyCache);for(let ye of be){let Ee=ye.map(Lt=>this._layers[Lt.id]),Ne=Ee[0];if(Ne.visibility==="none")continue;let Ie=Ne.source||"",je=this.familiesBySource[Ie];je||(je=this.familiesBySource[Ie]={});let mt=Ne.sourceLayer||"_geojsonTileLayer",at=je[mt];at||(at=je[mt]=[]),at.push(Ee)}}}let N=1*i.dJ;class q{constructor(G){let K={},ce=[];for(let Ne in G){let Ie=G[Ne],je=K[Ne]={};for(let mt in Ie.glyphs){let at=Ie.glyphs[+mt];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;let Lt=at.metrics.localGlyph?N:1,$t={x:0,y:0,w:at.bitmap.width+2*Lt,h:at.bitmap.height+2*Lt};ce.push($t),je[mt]=$t}}let{w:be,h:ye}=i.j(ce),Ee=new i.dI({width:be||1,height:ye||1});for(let Ne in G){let Ie=G[Ne];for(let je in Ie.glyphs){let mt=Ie.glyphs[+je];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;let at=K[Ne][je],Lt=mt.metrics.localGlyph?N:1;i.dI.copy(mt.bitmap,Ee,{x:0,y:0},{x:at.x+Lt,y:at.y+Lt},mt.bitmap)}}this.image=Ee,this.positions=K}}i.dH(q,"GlyphAtlas");class ie{constructor(G){this.tileID=new i.aL(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=i.dK(G.tileID.canonical,G.projection),this.projection=G.projection,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep}parse(G,K,ce,be,ye){this.status="parsing",this.data=G,this.collisionBoxArray=new i.dL;let Ee=new i.dM(Object.keys(G.layers).sort()),Ne=new i.dN(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];let Ie={},je=new i.dO(256,256),mt={featureIndex:Ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:je,availableImages:ce,brightness:this.brightness},at=K.familiesBySource[this.source];for(let At in at){let Sn=G.layers[At];if(!Sn)continue;let Ki=!1,Pi=!1,Yn=!1;for(let Vr of at[At])Vr[0].type==="symbol"?Ki=!0:Pi=!0,Vr[0].is3D()&&Vr[0].type!=="model"&&(Yn=!0);if(this.extraShadowCaster&&!Yn||this.isSymbolTile===!0&&!Ki||this.isSymbolTile===!1&&!Pi)continue;Sn.version===1&&i.w(`Vector tile source "${this.source}" layer "${At}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Mn=Ee.encode(At),ar=[];for(let Vr=0;Vr<Sn.length;Vr++){let jr=Sn.feature(Vr),ll=Ne.getId(jr,At);ar.push({feature:jr,id:ll,index:Vr,sourceLayerIndex:Mn})}for(let Vr of at[At]){let jr=Vr[0];(!this.extraShadowCaster||jr.is3D()&&jr.type!=="model")&&(this.isSymbolTile!==void 0&&jr.type==="symbol"!==this.isSymbolTile||jr.minzoom&&this.zoom<Math.floor(jr.minzoom)||jr.maxzoom&&this.zoom>=jr.maxzoom||jr.visibility!=="none"&&(de(Vr,this.zoom,mt.brightness,ce),(Ie[jr.id]=jr.createBucket({index:Ne.bucketLayerIDs.length,layers:Vr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(ar,mt,this.tileID.canonical,this.tileTransform),Ne.bucketLayerIDs.push(Vr.map(ll=>ll.id))))}}let Lt,$t,mi,yi;je.trim();let ni={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ti=()=>{if(Lt)return this.status="done",ye(Lt);if(this.extraShadowCaster)this.status="done",ye(null,{buckets:i.dG(Ie).filter(At=>!At.isEmpty()),featureIndex:Ne,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:mt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if($t&&mi&&yi){let At=new q($t),Sn=new i.dQ(mi,yi,this.lut);for(let Ki in Ie){let Pi=Ie[Ki];Pi instanceof i.dR?(de(Pi.layers,this.zoom,mt.brightness,ce),i.dS(Pi,$t,At.positions,mi,Sn.iconPositions,this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Pi.hasPattern&&(Pi instanceof i.dT||Pi instanceof i.dU||Pi instanceof i.b_)&&(de(Pi.layers,this.zoom,mt.brightness,ce),Pi.addFeatures(mt,this.tileID.canonical,Sn.patternPositions,ce,this.tileTransform,this.brightness))}this.status="done",ye(null,{buckets:i.dG(Ie).filter(Ki=>!Ki.isEmpty()),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:At.image,lineAtlas:je,imageAtlas:Sn,brightness:mt.brightness})}};if(!this.extraShadowCaster){let At=i.dP(mt.glyphDependencies,Pi=>Object.keys(Pi).map(Number));Object.keys(At).length?be.send("getGlyphs",{uid:this.uid,stacks:At,scope:this.scope},(Pi,Yn)=>{Lt||(Lt=Pi,$t=Yn,Ti())},void 0,!1,ni):$t={};let Sn=Object.keys(mt.iconDependencies);Sn.length?be.send("getImages",{icons:Sn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Pi,Yn)=>{Lt||(Lt=Pi,mi=Yn,Ti())},void 0,!1,ni):mi={};let Ki=Object.keys(mt.patternDependencies);Ki.length?be.send("getImages",{icons:Ki,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Pi,Yn)=>{Lt||(Lt=Pi,yi=Yn,Ti())},void 0,!1,ni):yi={}}Ti()}}function de(Se,G,K,ce){let be=new i.X(G,{brightness:K});for(let ye of Se)ye.recalculate(be,ce)}class xe extends i.E{constructor(G,K,ce,be,ye,Ee){super(),this.actor=G,this.layerIndex=K,this.availableImages=ce,this.loadVectorData=ye||i.ap,this.loading={},this.loaded={},this.deduped=new i.ao(G.scheduler),this.isSpriteLoaded=be,this.scheduler=G.scheduler,this.brightness=Ee}loadTile(G,K){let ce=G.uid,be=G&&G.request,ye=be&&be.collectResourceTiming,Ee=this.loading[ce]=new ie(G);Ee.abort=this.loadVectorData(G,(Ne,Ie)=>{let je=!this.loading[ce];if(delete this.loading[ce],je||Ne||!Ie)return Ee.status="done",je||(this.loaded[ce]=Ee),K(Ne);let mt=Ie.rawData,at={};Ie.expires&&(at.expires=Ie.expires),Ie.cacheControl&&(at.cacheControl=Ie.cacheControl),Ee.vectorTile=Ie.vectorTile||new i.dV(new i.dW(mt));let Lt=()=>{Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,($t,mi)=>{if($t||!mi)return K($t);let yi={};if(ye){let ni=_(be);ni.length>0&&(yi.resourceTiming=JSON.parse(JSON.stringify(ni)))}K(null,i.W({rawTileData:mt.slice(0)},mi,at,yi))})};this.isSpriteLoaded?Lt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Lt,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):Lt()}),this.loaded=this.loaded||{},this.loaded[ce]=Ee})}reloadTile(G,K){let ce=this.loaded,be=G.uid;if(ce&&ce[be]){let ye=ce[be];ye.showCollisionBoxes=G.showCollisionBoxes,ye.projection=G.projection,ye.brightness=G.brightness,ye.tileTransform=i.dK(G.tileID.canonical,G.projection),ye.extraShadowCaster=G.extraShadowCaster,ye.lut=G.lut;let Ee=(Ne,Ie)=>{let je=ye.reloadCallback;je&&(delete ye.reloadCallback,ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,je)),K(Ne,Ie)};ye.status==="parsing"?ye.reloadCallback=Ee:ye.status==="done"&&(ye.vectorTile?ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,Ee):Ee())}else K(null,void 0)}abortTile(G,K){let ce=G.uid,be=this.loading[ce];be&&(be.abort&&be.abort(),delete this.loading[ce]),K()}removeTile(G,K){let ce=this.loaded,be=G.uid;ce&&ce[be]&&delete ce[be],K()}}class ke{loadTile(G,K){let{uid:ce,encoding:be,rawImageData:ye,padding:Ee}=G,Ne=ImageBitmap&&ye instanceof ImageBitmap?this.getImageData(ye,Ee):ye;K(null,new i.dX(ce,Ne,be,Ee<1))}getImageData(G,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);let ce=this.offscreenCanvasContext.getImageData(-K,-K,G.width+2*K,G.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}class Ae{decodeRasterArray({task:G,buffer:K},ce){i.dY.performDecoding(K,G).then(be=>{ce(null,be)},be=>{ce(be)})}}let Xe=i.dZ.prototype.toGeoJSON,qe=class{constructor(Se){this._feature=Se,this.extent=i.a3,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){let Se=[];for(let G of this._feature.geometry)Se.push([new i.P(G[0],G[1])]);return Se}{let Se=[];for(let G of this._feature.geometry){let K=[];for(let ce of G)K.push(new i.P(ce[0],ce[1]));Se.push(K)}return Se}}toGeoJSON(Se,G,K){return Xe.call(this,Se,G,K)}},ut=class{constructor(Se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.a3,this.length=Se.length,this._features=Se}feature(Se){return new qe(this._features[Se])}},It=64/4096;class wt{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],K){for(let ce of G){let be=ce.id;if(be==null)continue;let ye=this.features.get(be);ye&&this.updateCache(ye,K),ce.geometry?(ye=Ht(ce),this.updateCache(ye,K),this.features.set(be,ye)):this.features.delete(be),this.updateCache(ye,K)}}updateCache(G,K){for(let{canonical:ce,uid:be}of Object.values(K)){let{z:ye,x:Ee,y:Ne}=ce;Et(G,Math.pow(2,ye),Ee,Ne)&&delete K[be]}}getTile(G,K,ce){let be=Math.pow(2,G),ye=[];for(let Ee of this.features.values())Et(Ee,be,K,ce)&&ye.push(ki(Ee,be,K,ce));return{features:ye}}getFeatures(){return[...this.features.values()]}}function Et({minX:Se,minY:G,maxX:K,maxY:ce},be,ye,Ee){return Se<(ye+1+It)/be&&G<(Ee+1+It)/be&&K>(ye-It)/be&&ce>(Ee-It)/be}function Ht(Se){let{id:G,geometry:K,properties:ce}=Se;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:be,coordinates:ye}=K,Ee={id:G,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ne=Ee.geometry;if(be==="Point")Ct(ye,Ne,Ee);else if(be==="MultiPoint")for(let Ie of ye)Ct(Ie,Ne,Ee);else if(be==="LineString")Ee.type=2,Yt(ye,Ne,Ee);else if(be==="MultiLineString")Ee.type=2,zt(ye,Ne,Ee);else if(be==="Polygon")Ee.type=3,zt(ye,Ne,Ee,!0);else{if(be!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ee.type=3;for(let Ie of ye)zt(Ie,Ne,Ee,!0)}return Ee}function Ct([Se,G],K,ce){let be=i.aj(Se),ye=i.ak(G);ye=ye<0?0:ye>1?1:ye,K.push(be,ye),ce.minX=Math.min(ce.minX,be),ce.minY=Math.min(ce.minY,ye),ce.maxX=Math.max(ce.maxX,be),ce.maxY=Math.max(ce.maxY,ye)}function Yt(Se,G,K,ce=!1,be=!1){let ye=[];for(let Ee of Se)Ct(Ee,ye,K);G.push(ye),ce&&function(Ee,Ne){let Ie=0;for(let je=0,mt=Ee.length,at=mt-2;je<mt;at=je,je+=2)Ie+=(Ee[je]-Ee[at])*(Ee[je+1]+Ee[at+1]);if(Ie>0===Ne)for(let je=0,mt=Ee.length;je<mt/2;je+=2){let at=Ee[je],Lt=Ee[je+1];Ee[je]=Ee[mt-2-je],Ee[je+1]=Ee[mt-1-je],Ee[mt-2-je]=at,Ee[mt-1-je]=Lt}}(ye,be)}function zt(Se,G,K,ce=!1){for(let be=0;be<Se.length;be++)Yt(Se[be],G,K,ce,be===0)}function ki(Se,G,K,ce){let{id:be,type:ye,geometry:Ee,tags:Ne}=Se,Ie=[];if(ye===1)Hi(Ee,G,K,ce,Ie);else for(let je of Ee)Ie.push(Hi(je,G,K,ce));return{id:be,type:ye,geometry:Ie,tags:Ne}}function Hi(Se,G,K,ce,be=[]){for(let ye=0;ye<Se.length;ye+=2)be.push(or(Se[ye],Se[ye+1],G,K,ce));return be}function or(Se,G,K,ce,be){return[Math.round(i.a3*(Se*K-ce)),Math.round(i.a3*(G*K-be))]}var wi={exports:{}},cn=i.d$,tn=i.d_.VectorTileFeature,Bn=Nr;function Nr(Se,G){this.options=G||{},this.features=Se,this.length=Se.length}function qn(Se,G){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=G||4096}Nr.prototype.feature=function(Se){return new qn(this.features[Se],this.options.extent)},qn.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var G=0;G<Se.length;G++){for(var K=Se[G],ce=[],be=0;be<K.length;be++)ce.push(new cn(K[be][0],K[be][1]));this.geometry.push(ce)}return this.geometry},qn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,G=1/0,K=-1/0,ce=1/0,be=-1/0,ye=0;ye<Se.length;ye++)for(var Ee=Se[ye],Ne=0;Ne<Ee.length;Ne++){var Ie=Ee[Ne];G=Math.min(G,Ie.x),K=Math.max(K,Ie.x),ce=Math.min(ce,Ie.y),be=Math.max(be,Ie.y)}return[G,ce,K,be]},qn.prototype.toGeoJSON=tn.prototype.toGeoJSON;var Ii=i.e0,na=Bn;function $n(Se){var G=new Ii;return function(K,ce){for(var be in K.layers)ce.writeMessage(3,ba,K.layers[be])}(Se,G),G.finish()}function ba(Se,G){var K;G.writeVarintField(15,Se.version||1),G.writeStringField(1,Se.name||""),G.writeVarintField(5,Se.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<Se.length;K++)ce.feature=Se.feature(K),G.writeMessage(2,Fo,ce);var be=ce.keys;for(K=0;K<be.length;K++)G.writeStringField(3,be[K]);var ye=ce.values;for(K=0;K<ye.length;K++)G.writeMessage(4,iu,ye[K])}function Fo(Se,G){var K=Se.feature;K.id!==void 0&&G.writeVarintField(1,K.id),G.writeMessage(2,ya,Se),G.writeVarintField(3,K.type),G.writeMessage(4,Cn,K)}function ya(Se,G){var K=Se.feature,ce=Se.keys,be=Se.values,ye=Se.keycache,Ee=Se.valuecache;for(var Ne in K.properties){var Ie=K.properties[Ne],je=ye[Ne];if(Ie!==null){je===void 0&&(ce.push(Ne),ye[Ne]=je=ce.length-1),G.writeVarint(je);var mt=typeof Ie;mt!=="string"&&mt!=="boolean"&&mt!=="number"&&(Ie=JSON.stringify(Ie));var at=mt+":"+Ie,Lt=Ee[at];Lt===void 0&&(be.push(Ie),Ee[at]=Lt=be.length-1),G.writeVarint(Lt)}}}function Gt(Se,G){return(G<<3)+(7&Se)}function Kl(Se){return Se<<1^Se>>31}function Cn(Se,G){for(var K=Se.loadGeometry(),ce=Se.type,be=0,ye=0,Ee=K.length,Ne=0;Ne<Ee;Ne++){var Ie=K[Ne],je=1;ce===1&&(je=Ie.length),G.writeVarint(Gt(1,je));for(var mt=ce===3?Ie.length-1:Ie.length,at=0;at<mt;at++){at===1&&ce!==1&&G.writeVarint(Gt(2,mt-1));var Lt=Ie[at].x-be,$t=Ie[at].y-ye;G.writeVarint(Kl(Lt)),G.writeVarint(Kl($t)),be+=Lt,ye+=$t}ce===3&&G.writeVarint(Gt(7,1))}}function iu(Se,G){var K=typeof Se;K==="string"?G.writeStringField(1,Se):K==="boolean"?G.writeBooleanField(7,Se):K==="number"&&(Se%1!=0?G.writeDoubleField(3,Se):Se<0?G.writeSVarintField(6,Se):G.writeVarintField(5,Se))}wi.exports=$n,wi.exports.fromVectorTileJs=$n,wi.exports.fromGeojsonVt=function(Se,G){G=G||{};var K={};for(var ce in Se)K[ce]=new na(Se[ce].features,G),K[ce].name=ce,K[ce].version=G.version,K[ce].extent=G.extent;return $n({layers:K})},wi.exports.GeoJSONWrapper=na;var nu=i.e1(wi.exports);let ru={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},Dd=Math.fround||(Jl=new Float32Array(1),Se=>(Jl[0]=+Se,Jl[0]));var Jl;let ra=3,oa=5,Ad=6;class Xt{constructor(G){this.options=Object.assign(Object.create(ru),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){let{log:K,minZoom:ce,maxZoom:be}=this.options;K&&console.time("total time");let ye=`prepare ${G.length} points`;K&&console.time(ye),this.points=G;let Ee=[];for(let Ie=0;Ie<G.length;Ie++){let je=G[Ie];if(!je.geometry)continue;let[mt,at]=je.geometry.coordinates,Lt=Dd(fo(mt)),$t=Dd(rl(at));Ee.push(Lt,$t,1/0,Ie,-1,1),this.options.reduce&&Ee.push(0)}let Ne=this.trees[be+1]=this._createTree(Ee);K&&console.timeEnd(ye);for(let Ie=be;Ie>=ce;Ie--){let je=+Date.now();Ne=this.trees[Ie]=this._createTree(this._cluster(Ne,Ie)),K&&console.log("z%d: %d clusters in %dms",Ie,Ne.numItems,+Date.now()-je)}return K&&console.timeEnd("total time"),this}getClusters(G,K){let ce=((G[0]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,G[1])),ye=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ee=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ce=-180,ye=180;else if(ce>ye){let at=this.getClusters([ce,be,180,Ee],K),Lt=this.getClusters([-180,be,ye,Ee],K);return at.concat(Lt)}let Ne=this.trees[this._limitZoom(K)],Ie=Ne.range(fo(ce),rl(Ee),fo(ye),rl(be)),je=Ne.data,mt=[];for(let at of Ie){let Lt=this.stride*at;mt.push(je[Lt+oa]>1?Jt(je,Lt,this.clusterProps):this.points[je[Lt+ra]])}return mt}getChildren(G){let K=this._getOriginId(G),ce=this._getOriginZoom(G),be="No cluster with the specified id.",ye=this.trees[ce];if(!ye)throw new Error(be);let Ee=ye.data;if(K*this.stride>=Ee.length)throw new Error(be);let Ne=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Ie=ye.within(Ee[K*this.stride],Ee[K*this.stride+1],Ne),je=[];for(let mt of Ie){let at=mt*this.stride;Ee[at+4]===G&&je.push(Ee[at+oa]>1?Jt(Ee,at,this.clusterProps):this.points[Ee[at+ra]])}if(je.length===0)throw new Error(be);return je}getLeaves(G,K,ce){let be=[];return this._appendLeaves(be,G,K=K||10,ce=ce||0,0),be}getTile(G,K,ce){let be=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:Ee,radius:Ne}=this.options,Ie=Ne/Ee,je=(ce-Ie)/ye,mt=(ce+1+Ie)/ye,at={features:[]};return this._addTileFeatures(be.range((K-Ie)/ye,je,(K+1+Ie)/ye,mt),be.data,K,ce,ye,at),K===0&&this._addTileFeatures(be.range(1-Ie/ye,je,1,mt),be.data,ye,ce,ye,at),K===ye-1&&this._addTileFeatures(be.range(0,je,Ie/ye,mt),be.data,-1,ce,ye,at),at.features.length?at:null}getClusterExpansionZoom(G){let K=this._getOriginZoom(G)-1;for(;K<=this.options.maxZoom;){let ce=this.getChildren(G);if(K++,ce.length!==1)break;G=ce[0].properties.cluster_id}return K}_appendLeaves(G,K,ce,be,ye){let Ee=this.getChildren(K);for(let Ne of Ee){let Ie=Ne.properties;if(Ie&&Ie.cluster?ye+Ie.point_count<=be?ye+=Ie.point_count:ye=this._appendLeaves(G,Ie.cluster_id,ce,be,ye):ye<be?ye++:G.push(Ne),G.length===ce)break}return ye}_createTree(G){let K=new i.cK(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<G.length;ce+=this.stride)K.add(G[ce],G[ce+1]);return K.finish(),K.data=G,K}_addTileFeatures(G,K,ce,be,ye,Ee){for(let Ne of G){let Ie=Ne*this.stride,je=K[Ie+oa]>1,mt,at,Lt;if(je)mt=ec(K,Ie,this.clusterProps),at=K[Ie],Lt=K[Ie+1];else{let yi=this.points[K[Ie+ra]];mt=yi.properties;let[ni,Ti]=yi.geometry.coordinates;at=fo(ni),Lt=rl(Ti)}let $t={type:1,geometry:[[Math.round(this.options.extent*(at*ye-ce)),Math.round(this.options.extent*(Lt*ye-be))]],tags:mt},mi;mi=je||this.options.generateId?K[Ie+ra]:this.points[K[Ie+ra]].id,mi!==void 0&&($t.id=mi),Ee.features.push($t)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,K){let{radius:ce,extent:be,reduce:ye,minPoints:Ee}=this.options,Ne=ce/(be*Math.pow(2,K)),Ie=G.data,je=[],mt=this.stride;for(let at=0;at<Ie.length;at+=mt){if(Ie[at+2]<=K)continue;Ie[at+2]=K;let Lt=Ie[at],$t=Ie[at+1],mi=G.within(Ie[at],Ie[at+1],Ne),yi=Ie[at+oa],ni=yi;for(let Ti of mi){let At=Ti*mt;Ie[At+2]>K&&(ni+=Ie[At+oa])}if(ni>yi&&ni>=Ee){let Ti,At=Lt*yi,Sn=$t*yi,Ki=-1,Pi=(at/mt<<5)+(K+1)+this.points.length;for(let Yn of mi){let Mn=Yn*mt;if(Ie[Mn+2]<=K)continue;Ie[Mn+2]=K;let ar=Ie[Mn+oa];At+=Ie[Mn]*ar,Sn+=Ie[Mn+1]*ar,Ie[Mn+4]=Pi,ye&&(Ti||(Ti=this._map(Ie,at,!0),Ki=this.clusterProps.length,this.clusterProps.push(Ti)),ye(Ti,this._map(Ie,Mn)))}Ie[at+4]=Pi,je.push(At/ni,Sn/ni,1/0,Pi,-1,ni),ye&&je.push(Ki)}else{for(let Ti=0;Ti<mt;Ti++)je.push(Ie[at+Ti]);if(ni>1)for(let Ti of mi){let At=Ti*mt;if(!(Ie[At+2]<=K)){Ie[At+2]=K;for(let Sn=0;Sn<mt;Sn++)je.push(Ie[At+Sn])}}}}return je}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,K,ce){if(G[K+oa]>1){let Ee=this.clusterProps[G[K+Ad]];return ce?Object.assign({},Ee):Ee}let be=this.points[G[K+ra]].properties,ye=this.options.map(be);return ce&&ye===be?Object.assign({},ye):ye}}function Jt(Se,G,K){return{type:"Feature",id:Se[G+ra],properties:ec(Se,G,K),geometry:{type:"Point",coordinates:[(ce=Se[G],360*(ce-.5)),tc(Se[G+1])]}};var ce}function ec(Se,G,K){let ce=Se[G+oa],be=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,ye=Se[G+Ad],Ee=ye===-1?{}:Object.assign({},K[ye]);return Object.assign(Ee,{cluster:!0,cluster_id:Se[G+ra],point_count:ce,point_count_abbreviated:be})}function fo(Se){return Se/360+.5}function rl(Se){let G=Math.sin(Se*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function tc(Se){let G=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function ic(Se,G,K,ce){let be=ce,ye=G+(K-G>>1),Ee,Ne=K-G,Ie=Se[G],je=Se[G+1],mt=Se[K],at=Se[K+1];for(let Lt=G+3;Lt<K;Lt+=3){let $t=Pd(Se[Lt],Se[Lt+1],Ie,je,mt,at);if($t>be)Ee=Lt,be=$t;else if($t===be){let mi=Math.abs(Lt-ye);mi<Ne&&(Ee=Lt,Ne=mi)}}be>ce&&(Ee-G>3&&ic(Se,G,Ee,ce),Se[Ee+2]=be,K-Ee>3&&ic(Se,Ee,K,ce))}function Pd(Se,G,K,ce,be,ye){let Ee=be-K,Ne=ye-ce;if(Ee!==0||Ne!==0){let Ie=((Se-K)*Ee+(G-ce)*Ne)/(Ee*Ee+Ne*Ne);Ie>1?(K=be,ce=ye):Ie>0&&(K+=Ee*Ie,ce+=Ne*Ie)}return Ee=Se-K,Ne=G-ce,Ee*Ee+Ne*Ne}function Ss(Se,G,K,ce){let be={id:Se??null,type:G,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")ol(be,K);else if(G==="Polygon")ol(be,K[0]);else if(G==="MultiLineString")for(let ye of K)ol(be,ye);else if(G==="MultiPolygon")for(let ye of K)ol(be,ye[0]);return be}function ol(Se,G){for(let K=0;K<G.length;K+=3)Se.minX=Math.min(Se.minX,G[K]),Se.minY=Math.min(Se.minY,G[K+1]),Se.maxX=Math.max(Se.maxX,G[K]),Se.maxY=Math.max(Se.maxY,G[K+1])}function nc(Se,G,K,ce){if(!G.geometry)return;let be=G.geometry.coordinates;if(be&&be.length===0)return;let ye=G.geometry.type,Ee=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Ne=[],Ie=G.id;if(K.promoteId?Ie=G.properties[K.promoteId]:K.generateId&&(Ie=ce||0),ye==="Point")Od(be,Ne);else if(ye==="MultiPoint")for(let je of be)Od(je,Ne);else if(ye==="LineString")rc(be,Ne,Ee,!1);else if(ye==="MultiLineString"){if(K.lineMetrics){for(let je of be)Ne=[],rc(je,Ne,Ee,!1),Se.push(Ss(Ie,"LineString",Ne,G.properties));return}oc(be,Ne,Ee,!1)}else if(ye==="Polygon")oc(be,Ne,Ee,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(let je of G.geometry.geometries)nc(Se,{id:Ie,geometry:je,properties:G.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let je of be){let mt=[];oc(je,mt,Ee,!0),Ne.push(mt)}}Se.push(Ss(Ie,ye,Ne,G.properties))}function Od(Se,G){G.push(zo(Se[0]),ou(Se[1]),0)}function rc(Se,G,K,ce){let be,ye,Ee=0;for(let Ie=0;Ie<Se.length;Ie++){let je=zo(Se[Ie][0]),mt=ou(Se[Ie][1]);G.push(je,mt,0),Ie>0&&(Ee+=ce?(be*mt-je*ye)/2:Math.sqrt(Math.pow(je-be,2)+Math.pow(mt-ye,2))),be=je,ye=mt}let Ne=G.length-3;G[2]=1,ic(G,0,Ne,K),G[Ne+2]=1,G.size=Math.abs(Ee),G.start=0,G.end=G.size}function oc(Se,G,K,ce){for(let be=0;be<Se.length;be++){let ye=[];rc(Se[be],ye,K,ce),G.push(ye)}}function zo(Se){return Se/360+.5}function ou(Se){let G=Math.sin(Se*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function ei(Se,G,K,ce,be,ye,Ee,Ne){if(ce/=G,ye>=(K/=G)&&Ee<ce)return Se;if(Ee<K||ye>=ce)return null;let Ie=[];for(let je of Se){let mt=je.geometry,at=je.type,Lt=be===0?je.minX:je.minY,$t=be===0?je.maxX:je.maxY;if(Lt>=K&&$t<ce){Ie.push(je);continue}if($t<K||Lt>=ce)continue;let mi=[];if(at==="Point"||at==="MultiPoint")Rd(mt,mi,K,ce,be);else if(at==="LineString")Nn(mt,mi,K,ce,be,!1,Ne.lineMetrics);else if(at==="MultiLineString")al(mt,mi,K,ce,be,!1);else if(at==="Polygon")al(mt,mi,K,ce,be,!0);else if(at==="MultiPolygon")for(let yi of mt){let ni=[];al(yi,ni,K,ce,be,!0),ni.length&&mi.push(ni)}if(mi.length){if(Ne.lineMetrics&&at==="LineString"){for(let yi of mi)Ie.push(Ss(je.id,at,yi,je.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(mi.length===1?(at="LineString",mi=mi[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=mi.length===3?"Point":"MultiPoint"),Ie.push(Ss(je.id,at,mi,je.tags))}}return Ie.length?Ie:null}function Rd(Se,G,K,ce,be){for(let ye=0;ye<Se.length;ye+=3){let Ee=Se[ye+be];Ee>=K&&Ee<=ce&&va(G,Se[ye],Se[ye+1],Se[ye+2])}}function Nn(Se,G,K,ce,be,ye,Ee){let Ne=ac(Se),Ie=be===0?xa:Ld,je,mt,at=Se.start;for(let ni=0;ni<Se.length-3;ni+=3){let Ti=Se[ni],At=Se[ni+1],Sn=Se[ni+2],Ki=Se[ni+3],Pi=Se[ni+4],Yn=be===0?Ti:At,Mn=be===0?Ki:Pi,ar=!1;Ee&&(je=Math.sqrt(Math.pow(Ti-Ki,2)+Math.pow(At-Pi,2))),Yn<K?Mn>K&&(mt=Ie(Ne,Ti,At,Ki,Pi,K),Ee&&(Ne.start=at+je*mt)):Yn>ce?Mn<ce&&(mt=Ie(Ne,Ti,At,Ki,Pi,ce),Ee&&(Ne.start=at+je*mt)):va(Ne,Ti,At,Sn),Mn<K&&Yn>=K&&(mt=Ie(Ne,Ti,At,Ki,Pi,K),ar=!0),Mn>ce&&Yn<=ce&&(mt=Ie(Ne,Ti,At,Ki,Pi,ce),ar=!0),!ye&&ar&&(Ee&&(Ne.end=at+je*mt),G.push(Ne),Ne=ac(Se)),Ee&&(at+=je)}let Lt=Se.length-3,$t=Se[Lt],mi=Se[Lt+1],yi=be===0?$t:mi;yi>=K&&yi<=ce&&va(Ne,$t,mi,Se[Lt+2]),Lt=Ne.length-3,ye&&Lt>=3&&(Ne[Lt]!==Ne[0]||Ne[Lt+1]!==Ne[1])&&va(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&G.push(Ne)}function ac(Se){let G=[];return G.size=Se.size,G.start=Se.start,G.end=Se.end,G}function al(Se,G,K,ce,be,ye){for(let Ee of Se)Nn(Ee,G,K,ce,be,ye,!1)}function va(Se,G,K,ce){Se.push(G,K,ce)}function xa(Se,G,K,ce,be,ye){let Ee=(ye-G)/(ce-G);return va(Se,ye,K+(be-K)*Ee,1),Ee}function Ld(Se,G,K,ce,be,ye){let Ee=(ye-K)/(be-K);return va(Se,G+(ce-G)*Ee,ye,1),Ee}function Ms(Se,G){let K=[];for(let ce=0;ce<Se.length;ce++){let be=Se[ce],ye=be.type,Ee;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ee=ks(be.geometry,G);else if(ye==="MultiLineString"||ye==="Polygon"){Ee=[];for(let Ne of be.geometry)Ee.push(ks(Ne,G))}else if(ye==="MultiPolygon"){Ee=[];for(let Ne of be.geometry){let Ie=[];for(let je of Ne)Ie.push(ks(je,G));Ee.push(Ie)}}K.push(Ss(be.id,ye,Ee,be.tags))}return K}function ks(Se,G){let K=[];K.size=Se.size,Se.start!==void 0&&(K.start=Se.start,K.end=Se.end);for(let ce=0;ce<Se.length;ce+=3)K.push(Se[ce]+G,Se[ce+1],Se[ce+2]);return K}function sc(Se,G){if(Se.transformed)return Se;let K=1<<Se.z,ce=Se.x,be=Se.y;for(let ye of Se.features){let Ee=ye.geometry,Ne=ye.type;if(ye.geometry=[],Ne===1)for(let Ie=0;Ie<Ee.length;Ie+=2)ye.geometry.push(lc(Ee[Ie],Ee[Ie+1],G,K,ce,be));else for(let Ie=0;Ie<Ee.length;Ie++){let je=[];for(let mt=0;mt<Ee[Ie].length;mt+=2)je.push(lc(Ee[Ie][mt],Ee[Ie][mt+1],G,K,ce,be));ye.geometry.push(je)}}return Se.transformed=!0,Se}function lc(Se,G,K,ce,be,ye){return[Math.round(K*(Se*ce-be)),Math.round(K*(G*ce-ye))]}function au(Se,G,K,ce,be){let ye=G===be.maxZoom?0:be.tolerance/((1<<G)*be.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Se.length,source:null,x:K,y:ce,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ne of Se)cc(Ee,Ne,ye,be);return Ee}function cc(Se,G,K,ce){let be=G.geometry,ye=G.type,Ee=[];if(Se.minX=Math.min(Se.minX,G.minX),Se.minY=Math.min(Se.minY,G.minY),Se.maxX=Math.max(Se.maxX,G.maxX),Se.maxY=Math.max(Se.maxY,G.maxY),ye==="Point"||ye==="MultiPoint")for(let Ne=0;Ne<be.length;Ne+=3)Ee.push(be[Ne],be[Ne+1]),Se.numPoints++,Se.numSimplified++;else if(ye==="LineString")Bo(Ee,be,Se,K,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Ne=0;Ne<be.length;Ne++)Bo(Ee,be[Ne],Se,K,ye==="Polygon",Ne===0);else if(ye==="MultiPolygon")for(let Ne=0;Ne<be.length;Ne++){let Ie=be[Ne];for(let je=0;je<Ie.length;je++)Bo(Ee,Ie[je],Se,K,!0,je===0)}if(Ee.length){let Ne=G.tags||null;if(ye==="LineString"&&ce.lineMetrics){Ne={};for(let je in G.tags)Ne[je]=G.tags[je];Ne.mapbox_clip_start=be.start/be.size,Ne.mapbox_clip_end=be.end/be.size}let Ie={geometry:Ee,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Ne};G.id!==null&&(Ie.id=G.id),Se.features.push(Ie)}}function Bo(Se,G,K,ce,be,ye){let Ee=ce*ce;if(ce>0&&G.size<(be?Ee:ce))return void(K.numPoints+=G.length/3);let Ne=[];for(let Ie=0;Ie<G.length;Ie+=3)(ce===0||G[Ie+2]>Ee)&&(K.numSimplified++,Ne.push(G[Ie],G[Ie+1])),K.numPoints++;be&&function(Ie,je){let mt=0;for(let at=0,Lt=Ie.length,$t=Lt-2;at<Lt;$t=at,at+=2)mt+=(Ie[at]-Ie[$t])*(Ie[at+1]+Ie[$t+1]);if(mt>0===je)for(let at=0,Lt=Ie.length;at<Lt/2;at+=2){let $t=Ie[at],mi=Ie[at+1];Ie[at]=Ie[Lt-2-at],Ie[at+1]=Ie[Lt-1-at],Ie[Lt-2-at]=$t,Ie[Lt-1-at]=mi}}(Ne,ye),Se.push(Ne)}let Is={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class No{constructor(G,K){let ce=(K=this.options=function(ye,Ee){for(let Ne in Ee)ye[Ne]=Ee[Ne];return ye}(Object.create(Is),K)).debug;if(ce&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let be=function(ye,Ee){let Ne=[];if(ye.type==="FeatureCollection")for(let Ie=0;Ie<ye.features.length;Ie++)nc(Ne,ye.features[Ie],Ee,Ie);else nc(Ne,ye.type==="Feature"?ye:{geometry:ye},Ee);return Ne}(G,K);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),be=function(ye,Ee){let Ne=Ee.buffer/Ee.extent,Ie=ye,je=ei(ye,1,-1-Ne,Ne,0,-1,2,Ee),mt=ei(ye,1,1-Ne,2+Ne,0,-1,2,Ee);return(je||mt)&&(Ie=ei(ye,1,-Ne,1+Ne,0,-1,2,Ee)||[],je&&(Ie=Ms(je,1).concat(Ie)),mt&&(Ie=Ie.concat(Ms(mt,-1)))),Ie}(be,K),be.length&&this.splitTile(be,0,0,0),ce&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,K,ce,be,ye,Ee,Ne){let Ie=[G,K,ce,be],je=this.options,mt=je.debug;for(;Ie.length;){be=Ie.pop(),ce=Ie.pop(),K=Ie.pop(),G=Ie.pop();let at=1<<K,Lt=Mr(K,ce,be),$t=this.tiles[Lt];if(!$t&&(mt>1&&console.time("creation"),$t=this.tiles[Lt]=au(G,K,ce,be,je),this.tileCoords.push({z:K,x:ce,y:be}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ce,be,$t.numFeatures,$t.numPoints,$t.numSimplified),console.timeEnd("creation"));let ar=`z${K}`;this.stats[ar]=(this.stats[ar]||0)+1,this.total++}if($t.source=G,ye==null){if(K===je.indexMaxZoom||$t.numPoints<=je.indexMaxPoints)continue}else{if(K===je.maxZoom||K===ye)continue;if(ye!=null){let ar=ye-K;if(ce!==Ee>>ar||be!==Ne>>ar)continue}}if($t.source=null,G.length===0)continue;mt>1&&console.time("clipping");let mi=.5*je.buffer/je.extent,yi=.5-mi,ni=.5+mi,Ti=1+mi,At=null,Sn=null,Ki=null,Pi=null,Yn=ei(G,at,ce-mi,ce+ni,0,$t.minX,$t.maxX,je),Mn=ei(G,at,ce+yi,ce+Ti,0,$t.minX,$t.maxX,je);G=null,Yn&&(At=ei(Yn,at,be-mi,be+ni,1,$t.minY,$t.maxY,je),Sn=ei(Yn,at,be+yi,be+Ti,1,$t.minY,$t.maxY,je),Yn=null),Mn&&(Ki=ei(Mn,at,be-mi,be+ni,1,$t.minY,$t.maxY,je),Pi=ei(Mn,at,be+yi,be+Ti,1,$t.minY,$t.maxY,je),Mn=null),mt>1&&console.timeEnd("clipping"),Ie.push(At||[],K+1,2*ce,2*be),Ie.push(Sn||[],K+1,2*ce,2*be+1),Ie.push(Ki||[],K+1,2*ce+1,2*be),Ie.push(Pi||[],K+1,2*ce+1,2*be+1)}}getTile(G,K,ce){G=+G,K=+K,ce=+ce;let be=this.options,{extent:ye,debug:Ee}=be;if(G<0||G>24)return null;let Ne=1<<G,Ie=Mr(G,K=K+Ne&Ne-1,ce);if(this.tiles[Ie])return sc(this.tiles[Ie],ye);Ee>1&&console.log("drilling down to z%d-%d-%d",G,K,ce);let je,mt=G,at=K,Lt=ce;for(;!je&&mt>0;)mt--,at>>=1,Lt>>=1,je=this.tiles[Mr(mt,at,Lt)];return je&&je.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",mt,at,Lt),console.time("drilling down")),this.splitTile(je.source,mt,at,Lt,G,K,ce),Ee>1&&console.timeEnd("drilling down"),this.tiles[Ie]?sc(this.tiles[Ie],ye):null):null}}function Mr(Se,G,K){return 32*((1<<Se)*K+G)+Se}function su(Se,G){let K=Se.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);let ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return G(null,null);let be=new ut(ce.features),ye=nu(be);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),G(null,{vectorTile:be,rawData:ye.buffer})}class sl extends xe{constructor(G,K,ce,be,ye,Ee){super(G,K,ce,be,su,Ee),ye&&(this.loadGeoJSON=ye),this._dynamicIndex=new wt}loadData(G,K){let ce=G&&G.request,be=ce&&ce.collectResourceTiming;this.loadGeoJSON(G,(ye,Ee)=>{if(ye||!Ee)return K(ye);if(typeof Ee!="object")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){let Ie=i.y(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(je=>`${je.key}: ${je.message}`).join(", "));Ee.features=Ee.features.filter(je=>Ie.value.evaluate({zoom:0},je))}G.dynamic?(Ee.type==="Feature"&&(Ee={type:"FeatureCollection",features:[Ee]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ee.features,this.loaded),G.cluster&&(Ee.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new Xt(function({superclusterOptions:Ie,clusterProperties:je}){if(!je||!Ie)return Ie;let mt={},at={},Lt={accumulated:null,zoom:0},$t={properties:null},mi=Object.keys(je);for(let yi of mi){let[ni,Ti]=je[yi],At=i.y(Ti),Sn=i.y(typeof ni=="string"?[ni,["accumulated"],["get",yi]]:ni);mt[yi]=At.value,at[yi]=Sn.value}return Ie.map=yi=>{$t.properties=yi;let ni={};for(let Ti of mi)ni[Ti]=mt[Ti].evaluate(Lt,$t);return ni},Ie.reduce=(yi,ni)=>{$t.properties=ni;for(let Ti of mi)Lt.accumulated=yi[Ti],yi[Ti]=at[Ti].evaluate(Lt,$t)},Ie}(G)).load(Ee.features):G.dynamic?this._dynamicIndex:function(Ie,je){return new No(Ie,je)}(Ee,G.geojsonVtOptions)}catch(Ie){return K(Ie)}let Ne={};if(be){let Ie=_(ce);Ie&&(Ne.resourceTiming={},Ne.resourceTiming[G.source]=JSON.parse(JSON.stringify(Ie)))}K(null,Ne)}})}reloadTile(G,K){let ce=this.loaded;return ce&&ce[G.uid]?G.partial?K(null,void 0):super.reloadTile(G,K):this.loadTile(G,K)}loadGeoJSON(G,K){if(G.request)i.g(G.request,K);else{if(typeof G.data!="string")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(G.data))}catch{return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ce){K(ce)}}getClusterChildren(G,K){try{K(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ce){K(ce)}}getClusterLeaves(G,K){try{K(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ce){K(ce)}}}class dc{constructor(G,K){this.tileID=new i.aL(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=K}parse(G,K,ce,be){this.status="parsing";let ye=new i.aL(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Ee={},Ne=K.familiesBySource[ce.source],Ie=new i.dN(ye,ce.promoteId);return Ie.bucketLayerIDs=[],Ie.is3DTile=!0,i.e3(G).then(je=>{if(!je)return be(new Error("Could not parse tile"));let mt=i.e4(je,1/i.b5(ce.tileID.canonical)),at=je.json.extensionsUsed&&je.json.extensionsUsed.includes("MAPBOX_mesh_features")||je.json.asset.extras&&je.json.asset.extras.MAPBOX_mesh_features,Lt=je.json.extensionsUsed&&je.json.extensionsUsed.includes("EXT_meshopt_compression"),$t=new i.X(this.zoom,{brightness:this.brightness});for(let mi in Ne)for(let yi of Ne[mi]){let ni=yi[0];Ie.bucketLayerIDs.push(yi.map(At=>At.id)),ni.recalculate($t,[]);let Ti=new i.e5(mt,ye,at,Lt,this.brightness,Ie);at||(Ti.needsUpload=!0),Ee[ni.fqid]=Ti,Ti.evaluate(ni)}this.status="done",be(null,{buckets:Ee,featureIndex:Ie})}).catch(je=>be(new Error(je.message)))}}class Fd{constructor(G,K,ce,be,ye,Ee){this.actor=G,this.layerIndex=K,this.brightness=Ee,this.loading={},this.loaded={}}loadTile(G,K){let ce=G.uid,be=this.loading[ce]=new dc(G,this.brightness);i.e2(G.request,(ye,Ee)=>{let Ne=!this.loading[ce];return delete this.loading[ce],Ne||ye?(be.status="done",Ne||(this.loaded[ce]=be),K(ye)):Ee&&Ee.byteLength!==0?void be.parse(Ee,this.layerIndex,G,(Ie,je)=>{be.status="done",this.loaded=this.loaded||{},this.loaded[ce]=be,Ie||!je?K(Ie):K(null,je)}):(be.status="done",this.loaded[ce]=be,K())})}reloadTile(G,K){let ce=this.loaded,be=G.uid;if(ce&&ce[be]){let ye=ce[be];ye.projection=G.projection,ye.brightness=G.brightness;let Ee=(Ne,Ie)=>{ye.reloadCallback&&(delete ye.reloadCallback,this.loadTile(G,K)),K(Ne,Ie)};ye.status==="parsing"?ye.reloadCallback=Ee:ye.status==="done"&&this.loadTile(G,K)}}abortTile(G,K){let ce=G.uid;this.loading[ce]&&delete this.loading[ce],K()}removeTile(G,K){let ce=this.loaded,be=G.uid;ce&&ce[be]&&delete ce[be],K()}}class hc{constructor(G){this.self=G,this.actor=new i.e6(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.aJ({name:"mercator"}),this.workerSourceTypes={vector:xe,geojson:sl,"batched-model":Fd},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(i.e7.isParsed())throw new Error("RTL text plugin already registered.");i.e7.applyArabicShaping=K.applyArabicShaping,i.e7.processBidirectionalText=K.processBidirectionalText,i.e7.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(G,K,ce){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],delete this.rasterArrayWorkerSource,ce()}checkIfReady(G,K,ce){ce()}setReferrer(G,K){this.referrer=K}spriteLoaded(G,{scope:K,isLoaded:ce}){if(this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),this.isSpriteLoaded[G][K]=ce,this.workerSources[G]&&this.workerSources[G][K])for(let be in this.workerSources[G][K]){let ye=this.workerSources[G][K][be];for(let Ee in ye){let Ne=ye[Ee];Ne instanceof xe&&(Ne.isSpriteLoaded=ce,Ne.fire(new i.f("isSpriteLoaded")))}}}setImages(G,{scope:K,images:ce},be){if(this.availableImages[G]||(this.availableImages[G]={}),this.availableImages[G][K]=ce,this.workerSources[G]&&this.workerSources[G][K]){for(let ye in this.workerSources[G][K]){let Ee=this.workerSources[G][K][ye];for(let Ne in Ee)Ee[Ne].availableImages=ce}be()}else be()}setProjection(G,K){this.projections[G]=i.aJ(K)}setBrightness(G,K,ce){this.brightness=K,ce()}setLayers(G,K,ce){this.getLayerIndex(G,K.scope).replace(K.layers,K.options),ce()}updateLayers(G,K,ce){this.getLayerIndex(G,K.scope).update(K.layers,K.removedIds,K.options),ce()}loadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).loadTile(K,ce)}loadDEMTile(G,K,ce){this.getDEMWorkerSource(G,K.source,K.scope).loadTile(K,ce)}decodeRasterArray(G,K,ce){this.getRasterArrayWorkerSource().decodeRasterArray(K,ce)}reloadTile(G,K,ce){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).reloadTile(K,ce)}abortTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).abortTile(K,ce)}removeTile(G,K,ce){this.getWorkerSource(G,K.type,K.source,K.scope).removeTile(K,ce)}removeSource(G,K,ce){if(!(this.workerSources[G]&&this.workerSources[G][K.scope]&&this.workerSources[G][K.scope][K.type]&&this.workerSources[G][K.scope][K.type][K.source]))return;let be=this.workerSources[G][K.scope][K.type][K.source];delete this.workerSources[G][K.scope][K.type][K.source],be.removeSource!==void 0?be.removeSource(K,ce):ce()}loadWorkerSource(G,K,ce){try{this.self.importScripts(K.url),ce()}catch(be){ce(be.toString())}}syncRTLPluginState(G,K,ce){try{i.e7.setState(K);let be=i.e7.getPluginURL();if(i.e7.isLoaded()&&!i.e7.isParsed()&&be!=null){this.self.importScripts(be);let ye=i.e7.isParsed();ce(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${be}`),ye)}}catch(be){ce(be.toString())}}setDracoUrl(G,K){this.dracoUrl=K}getAvailableImages(G,K){this.availableImages[G]||(this.availableImages[G]={});let ce=this.availableImages[G][K];return ce||(ce=[]),ce}getLayerIndex(G,K){this.layerIndexes[G]||(this.layerIndexes[G]={});let ce=this.layerIndexes[G][K];return ce||(ce=this.layerIndexes[G][K]=new O,ce.scope=K),ce}getWorkerSource(G,K,ce,be){return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][be]||(this.workerSources[G][be]={}),this.workerSources[G][be][K]||(this.workerSources[G][be][K]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),this.workerSources[G][be][K][ce]||(this.workerSources[G][be][K][ce]=new this.workerSourceTypes[K]({send:(ye,Ee,Ne,Ie,je,mt)=>{this.actor.send(ye,Ee,Ne,G,je,mt)},scheduler:this.actor.scheduler},this.getLayerIndex(G,be),this.getAvailableImages(G,be),this.isSpriteLoaded[G][be],void 0,this.brightness)),this.workerSources[G][be][K][ce]}getDEMWorkerSource(G,K,ce){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][ce]||(this.demWorkerSources[G][ce]={}),this.demWorkerSources[G][ce][K]||(this.demWorkerSources[G][ce][K]=new ke),this.demWorkerSources[G][ce][K]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ae),this.rasterArrayWorkerSource}enforceCacheSizeLimit(G,K){i.e8(K)}getWorkerPerformanceMetrics(G,K,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new hc(self)),hc}),r(["./shared"],function(i){function _(f,o){if(Array.isArray(f)){if(!Array.isArray(o)||f.length!==o.length)return!1;for(let h=0;h<f.length;h++)if(!_(f[h],o[h]))return!1;return!0}if(typeof f=="object"&&f!==null&&o!==null){if(typeof o!="object"||Object.keys(f).length!==Object.keys(o).length)return!1;for(let h in f)if(!_(f[h],o[h]))return!1;return!0}return f===o}var C=I;function I(f){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,x=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(x);try{v=new Worker(S),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(S),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===g.width}()?(O[h=o&&o.failIfMajorPerformanceCaveat]===void 0&&(O[h]=function(g){var v,x=function(S){var k=document.createElement("canvas"),D=Object.create(I.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=S,k.getContext("webgl2",D)}(g);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(h)),O[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(f)}var O={};function N(f,o,h){let g=document.createElement(f);return o!=null&&(g.className=o),h&&h.appendChild(g),g}function q(f,o,h){let g=document.createElementNS("http://www.w3.org/2000/svg",f);for(let v of Object.keys(o))g.setAttributeNS(null,v,String(o[v]));return h&&h.appendChild(g),g}I.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ie=typeof document<"u"?document.documentElement&&document.documentElement.style:null,de=ie&&ie.userSelect!==void 0?"userSelect":"WebkitUserSelect",xe;function ke(){ie&&de&&(xe=ie[de],ie[de]="none")}function Ae(){ie&&de&&(ie[de]=xe)}function Xe(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Xe,!0)}function qe(){window.addEventListener("click",Xe,!0),window.setTimeout(()=>{window.removeEventListener("click",Xe,!0)},0)}function ut(f,o){let h=f.getBoundingClientRect();return Et(f,h,o)}function It(f,o){let h=f.getBoundingClientRect(),g=[];for(let v=0;v<o.length;v++)g.push(Et(f,h,o[v]));return g}function wt(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Et(f,o,h){let g=f.offsetWidth===o.width?1:f.offsetWidth/o.width;return new i.P((h.clientX-o.left)*g,(h.clientY-o.top)*g)}class Ht{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,h){this._updatedSourceCaches[o]=h,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){let h=o.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(o.id),this.setDirty()}removeLayer(o){let h=o.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][o.id]=o,this._updatedLayers[h].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){let o={};for(let h in this._updatedLayers)o[h]=o[h]||{},o[h].updatedIds=Array.from(this._updatedLayers[h].values());for(let h in this._removedLayers)o[h]=o[h]||{},o[h].removedIds=Object.keys(this._removedLayers[h]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(o){this._updatedImages.add(o),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let Ct={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yt{constructor(o,h,g,v,x,S){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.instanceCount=S,this.context=o;let k=o.gl;this.buffer=k.createBuffer(),o.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||x||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let g=0;g<this.attributes.length;g++){let v=h.attributes[this.attributes[g].name];v!==void 0&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,h,g){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],S=h.attributes[x.name];S!==void 0&&o.vertexAttribPointer(S,x.components,o[Ct[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(o,h,g){for(let v=0;v<this.attributes.length;v++){let x=h.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(x,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ki extends zt{getDefault(){return i.C.transparent}set(o){let h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Hi extends zt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class or extends zt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class wi extends zt{getDefault(){return[!0,!0,!0,!0]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class cn extends zt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class tn extends zt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Bn extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Nr extends zt{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class qn extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ii extends zt{getDefault(){return[0,1]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class na extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class $n extends zt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ba extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class Fo extends zt{getDefault(){let o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ya extends zt{getDefault(){return i.C.transparent}set(o){let h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Gt extends zt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Kl extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class Cn extends zt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class iu extends zt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let nu=class extends zt{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class ru extends zt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Dd extends zt{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Jl extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class ra extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class oa extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Ad extends zt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Xt extends zt{getDefault(){return null}set(o){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Jt extends zt{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class ec extends zt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class fo extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class rl extends zt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class tc extends zt{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class ic extends tc{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Pd extends tc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ss extends tc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class ol extends Pd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class nc{constructor(o,h,g,v,x){this.context=o,this.width=h,this.height=g;let S=this.framebuffer=o.gl.createFramebuffer();v&&(this.colorAttachment=new ic(o,S)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Pd(o,S):new Ss(o,S))}destroy(){let o=this.context.gl;if(this.colorAttachment){let h=this.colorAttachment.get();h&&o.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let h=this.depthAttachment.get();h&&o.deleteRenderbuffer(h)}else{let h=this.depthAttachment.get();h&&o.deleteTexture(h)}o.deleteFramebuffer(this.framebuffer)}}class Od{constructor(o,h){this.gl=o,this.clearColor=new ki(this),this.clearDepth=new Hi(this),this.clearStencil=new or(this),this.colorMask=new wi(this),this.depthMask=new cn(this),this.stencilMask=new tn(this),this.stencilFunc=new Bn(this),this.stencilOp=new Nr(this),this.stencilTest=new qn(this),this.depthRange=new Ii(this),this.depthTest=new na(this),this.depthFunc=new $n(this),this.blend=new ba(this),this.blendFunc=new Fo(this),this.blendColor=new ya(this),this.blendEquation=new Gt(this),this.cullFace=new Kl(this),this.cullFaceSide=new Cn(this),this.frontFace=new iu(this),this.program=new nu(this),this.activeTexture=new ru(this),this.viewport=new Dd(this),this.bindFramebuffer=new Jl(this),this.bindRenderbuffer=new ra(this),this.bindTexture=new oa(this),this.bindVertexBuffer=new Ad(this),this.bindElementBuffer=new Xt(this),this.bindVertexArrayOES=new Jt(this),this.pixelStoreUnpack=new ec(this),this.pixelStoreUnpackPremultiplyAlpha=new fo(this),this.pixelStoreUnpackFlipY=new rl(this),this.options=h?Zi({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h,g){return new i.I(this,o,h,g)}createVertexBuffer(o,h,g,v,x){return new Yt(this,o,h,g,v,x)}createRenderbuffer(o,h,g){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,o,h,g),this.bindRenderbuffer.set(null),x}createFramebuffer(o,h,g,v){return new nc(this,o,h,g,v)}clear({color:o,depth:h,stencil:g,colorMask:v}){let x=this.gl,S=0;o&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set(v||[!0,!0,!0,!0])),h!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(S)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){_(o.blendFunction,i.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class rc{constructor(o){this._gl=o.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){let o=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,o}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class oc{constructor(o){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,o.registerParameter(this,["Symbols"],"useOcclusionQueries"),o.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),o.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),o.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),o.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class zo{constructor(o,h,g,v){let x={width:g[0],height:g[1],data:null},S=o.gl;this.targetColorTexture=new i.T(o,x,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new i.T(o,x,S.RGBA,{useMipmap:!1}),this.context=o,this.updateParticleTexture(h,v),this.lastInvalidatedAt=0}updateParticleTexture(o,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let g=this.context.gl,v=h.width*h.height;this.particleTexture0=new i.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,h,g.RGBA,{premultiply:!1,useMipmap:!1});let x=new i.S;x.reserve(v);for(let S=0;S<v;S++)x.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(x,i.p.members,!0),this.particleSegment=i.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=i.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class ou extends i.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.numModelsLoading={}}loadModel(o,h){return i.l(this.requestManager.transformRequest(h,i.R.Model).url).then(g=>{if(!g)return;let v=i.c(g),x=new i.M(o,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(g=>{if(g&&g.status===404)return null;this.fire(new i.d(new Error(`Could not load model ${o} from ${h}: ${g.message}`)))})}load(o,h){this.models[h]||(this.models[h]={});let g=Object.keys(o);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+g.length;let v=[];for(let x of g)v.push(this.loadModel(x,o[x]));Promise.allSettled(v).then(x=>{for(let S=0;S<x.length;S++){let{status:k,value:D}=x[S];k==="fulfilled"&&D&&(this.models[h][g[S]]={model:D,numReferences:1})}this.numModelsLoading[h]-=g.length,this.fire(new i.f("data",{dataType:"style"}))}).catch(x=>{this.fire(new i.d(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,h){return!!this.getModel(o,h)}getModel(o,h){return this.models[h]||(this.models[h]={}),this.models[h][o]?this.models[h][o].model:void 0}addModel(o,h,g){this.models[g]||(this.models[g]={}),this.hasModel(o,g)&&this.models[g][o].numReferences++,this.load({[o]:this.requestManager.normalizeModelURL(h)},g)}addModels(o,h){this.models[h]||(this.models[h]={});let g={};for(let v in o)this.models[h][v]={},g[v]=this.requestManager.normalizeModelURL(o[v]);this.load(g,h)}addModelsFromBucket(o,h){this.models[h]||(this.models[h]={});let g={};for(let v of o)this.hasModel(v,h)?this.models[h][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,h)}removeModel(o,h){if(this.models[h]&&this.models[h][o]&&(this.models[h][o].numReferences--,this.models[h][o].numReferences===0)){let g=this.models[h][o].model;delete this.models[h][o],g.destroy()}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,h){this.models[h]||(this.models[h]={});for(let g in this.models[h])this.models[h][g].model&&this.models[h][g].model.upload(o.context)}}function ei(f){let{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}class Rd extends i.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(o){this.images[o]={},this.loaded[o]=!1,this.updatedImages[o]={},this.patterns[o]={},this.callbackDispatchedThisFrame[o]={},this.atlasImage[o]=new i.i({width:1,height:1})}isLoaded(){for(let o in this.loaded)if(!this.loaded[o])return!1;return!0}setLoaded(o,h){if(this.loaded[h]!==o&&(this.loaded[h]=o,o)){for(let{ids:g,callback:v}of this.requestors)this._notify(g,h,v);this.requestors=[]}}hasImage(o,h){return!!this.getImage(o,h)}getImage(o,h){return this.images[h][o]}addImage(o,h,g){this._validate(o,g)&&(this.images[h][o]=g)}_validate(o,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new i.d(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new i.d(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new i.d(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,h){if(!o)return!0;let g=0;for(let v of o){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h,g){g.version=this.images[h][o].version+1,this.images[h][o]=g,this.updatedImages[h][o]=!0}removeImage(o,h){let g=this.images[h][o];delete this.images[h][o],delete this.patterns[h][o],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(o){return Object.keys(this.images[o])}getImages(o,h,g){let v=!0,x=!!this.loaded[h];if(!x)for(let S of o)this.images[h][S]||(v=!1);x||v?this._notify(o,h,g):this.requestors.push({ids:o,scope:h,callback:g})}getUpdatedImages(o){return this.updatedImages[o]}_notify(o,h,g){let v={};for(let x of o){this.images[h][x]||this.fire(new i.f("styleimagemissing",{id:x}));let S=this.images[h][x];S?v[x]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:i.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(o){let{width:h,height:g}=this.atlasImage[o];return{width:h,height:g}}getPattern(o,h,g){let v=this.patterns[h][o],x=this.getImage(o,h);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{let S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},k=new i.k(S,x);this.patterns[h][o]={bin:S,position:k}}return this._updatePatternAtlas(h,g),this.patterns[h][o].position}bind(o,h){let g=o.gl,v=this.atlasTexture[h];v?this.dirty&&(v.update(this.atlasImage[h]),this.dirty=!1):(v=new i.T(o,this.atlasImage[h],g.RGBA),this.atlasTexture[h]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(o,h){let g=[];for(let k in this.patterns[o])g.push(this.patterns[o][k].bin);let{w:v,h:x}=i.j(g),S=this.atlasImage[o];S.resize({width:v||1,height:x||1});for(let k in this.patterns[o]){let{bin:D}=this.patterns[o][k],A=D.x+1,L=D.y+1,z=this.images[o][k].data,U=z.width,H=z.height;i.i.copy(z,S,{x:0,y:0},{x:A,y:L},{width:U,height:H},h),i.i.copy(z,S,{x:0,y:H-1},{x:A,y:L-1},{width:U,height:1},h),i.i.copy(z,S,{x:0,y:0},{x:A,y:L+H},{width:U,height:1},h),i.i.copy(z,S,{x:U-1,y:0},{x:A-1,y:L},{width:1,height:H},h),i.i.copy(z,S,{x:0,y:0},{x:A+U,y:L},{width:1,height:H},h)}this.dirty=!0}beginFrame(){for(let o in this.images)this.callbackDispatchedThisFrame[o]={}}dispatchRenderCallbacks(o,h){for(let g of o){if(this.callbackDispatchedThisFrame[h][g])continue;this.callbackDispatchedThisFrame[h][g]=!0;let v=this.images[h][g];ei(v)&&this.updateImage(g,h,v)}}}function Nn(f){let o=f.key,h=f.value,g=f.valueSpec||{},v=f.objectElementValidators||{},x=f.style,S=f.styleSpec,k=[],D=i.n(h);if(D!=="object")return[new i.V(o,h,`object expected, ${D} found`)];for(let A in h){let L=A.split(".")[0],z;v[L]?z=v[L]:g[L]?z=G:v["*"]?z=v["*"]:g["*"]&&(z=G),z?k=k.concat(z({key:(o&&`${o}.`)+A,value:h[A],valueSpec:g[L]||g["*"],style:x,styleSpec:S,object:h,objectKey:A},h)):k.push(new i.m(o,h[A],`unknown property "${A}"`))}for(let A in g)v[A]||g[A].required&&g[A].default===void 0&&h[A]===void 0&&k.push(new i.V(o,h,`missing required property "${A}"`));return k}function ac(f){let o=f.value,h=f.valueSpec,g=f.style,v=f.styleSpec,x=f.key,S=f.arrayElementValidator||G;if(i.n(o)!=="array")return[new i.V(x,o,`array expected, ${i.n(o)} found`)];if(h.length&&o.length!==h.length)return[new i.V(x,o,`array length ${h.length} expected, length ${o.length} found`)];if(h["min-length"]&&o.length<h["min-length"])return[new i.V(x,o,`array length at least ${h["min-length"]} expected, length ${o.length} found`)];let k={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};v.$version<7&&(k.function=h.function),i.n(h.value)==="object"&&(k=h.value);let D=[];for(let A=0;A<o.length;A++)D=D.concat(S({array:o,arrayIndex:A,value:o[A],valueSpec:k,style:g,styleSpec:v,key:`${x}[${A}]`},!0));return D}function al(f){let o=f.key,h=f.value,g=f.valueSpec,v=i.n(h);if(v==="number"&&h!=h&&(v="NaN"),v!=="number")return[new i.V(o,h,`number expected, ${v} found`)];if("minimum"in g){let x=g.minimum;if(i.n(g.minimum)==="array"&&(x=g.minimum[f.arrayIndex]),h<x)return[new i.V(o,h,`${h} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(i.n(g.maximum)==="array"&&(x=g.maximum[f.arrayIndex]),h>x)return[new i.V(o,h,`${h} is greater than the maximum value ${x}`)]}return[]}function va(f){let o=f.valueSpec,h=i.u(f.value.type),g,v,x,S={},k=h!=="categorical"&&f.value.property===void 0,D=!k,A=i.n(f.value.stops)==="array"&&i.n(f.value.stops[0])==="array"&&i.n(f.value.stops[0][0])==="object",L=Nn({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(H){if(h==="identity")return[new i.V(H.key,H.value,'identity function may not have a "stops" property')];let Y=[],Z=H.value;return Y=Y.concat(ac({key:H.key,value:Z,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:z})),i.n(Z)==="array"&&Z.length===0&&Y.push(new i.V(H.key,Z,"array must have at least one stop")),Y},default:function(H){return G({key:H.key,value:H.value,valueSpec:o,style:H.style,styleSpec:H.styleSpec})}}});return h==="identity"&&k&&L.push(new i.V(f.key,f.value,'missing required property "property"')),h==="identity"||f.value.stops||L.push(new i.V(f.key,f.value,'missing required property "stops"')),h==="exponential"&&f.valueSpec.expression&&!i.s(f.valueSpec)&&L.push(new i.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(D&&!i.q(f.valueSpec)?L.push(new i.V(f.key,f.value,"property functions not supported")):k&&!i.r(f.valueSpec)&&L.push(new i.V(f.key,f.value,"zoom functions not supported"))),h!=="categorical"&&!A||f.value.property!==void 0||L.push(new i.V(f.key,f.value,'"property" property is required')),L;function z(H){let Y=[],Z=H.value,X=H.key;if(i.n(Z)!=="array")return[new i.V(X,Z,`array expected, ${i.n(Z)} found`)];if(Z.length!==2)return[new i.V(X,Z,`array length 2 expected, length ${Z.length} found`)];if(A){if(i.n(Z[0])!=="object")return[new i.V(X,Z,`object expected, ${i.n(Z[0])} found`)];if(Z[0].zoom===void 0)return[new i.V(X,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new i.V(X,Z,"object stop key must have value")];let Q=i.u(Z[0].zoom);if(typeof Q!="number")return[new i.V(X,Z[0].zoom,"stop zoom values must be numbers")];if(x&&x>Q)return[new i.V(X,Z[0].zoom,"stop zoom values must appear in ascending order")];Q!==x&&(x=Q,v=void 0,S={}),Y=Y.concat(Nn({key:`${X}[0]`,value:Z[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:al,value:U}}))}else Y=Y.concat(U({key:`${X}[0]`,value:Z[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},Z));return i.t(i.v(Z[1]))?Y.concat([new i.V(`${X}[1]`,Z[1],"expressions are not allowed in function stops.")]):Y.concat(G({key:`${X}[1]`,value:Z[1],valueSpec:o,style:H.style,styleSpec:H.styleSpec}))}function U(H,Y){let Z=i.n(H.value),X=i.u(H.value),Q=H.value!==null?H.value:Y;if(g){if(Z!==g)return[new i.V(H.key,Q,`${Z} stop domain type must match previous stop domain type ${g}`)]}else g=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new i.V(H.key,Q,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&h!=="categorical"){let re=`number expected, ${Z} found`;return i.q(o)&&h===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(H.key,Q,re)]}return h!=="categorical"||Z!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?h!=="categorical"&&Z==="number"&&typeof X=="number"&&typeof v=="number"&&v!==void 0&&X<v?[new i.V(H.key,Q,"stop domain values must appear in ascending order")]:(v=X,h==="categorical"&&X in S?[new i.V(H.key,Q,"stop domain values must be unique")]:(S[X]=!0,[])):[new i.V(H.key,Q,`integer expected, found ${String(X)}`)]}}function xa(f){let o=(f.expressionContext==="property"?i.x:i.y)(i.v(f.value),f.valueSpec);if(o.result==="error")return o.value.map(g=>new i.V(`${f.key}${g.key}`,f.value,g.message));let h=o.value.expression||o.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!h.outputDefined())return[new i.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!i.z(h))return[new i.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Ld(h,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!i.A(h,["zoom","feature-state"]))return[new i.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!i.B(h))return[new i.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ld(f,o){let h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(let v of o.valueSpec.expression.parameters)h.delete(v);if(h.size===0)return[];let g=[];return f instanceof i.D&&h.has(f.name)?[new i.V(o.key,o.value,`["${f.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(f.eachChild(v=>{g.push(...Ld(v,o))}),g)}function Ms(f){let o=f.key,h=f.value,g=f.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(i.u(h))===-1&&v.push(new i.V(o,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(i.u(h))===-1&&v.push(new i.V(o,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function ks(f){return i.G(i.v(f.value))?xa(i.o({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):sc(f)}function sc(f){let o=f.value,h=f.key;if(i.n(o)!=="array")return[new i.V(h,o,`array expected, ${i.n(o)} found`)];let g=f.styleSpec,v,x=[];if(o.length<1)return[new i.V(h,o,"filter array must have at least 1 element")];switch(x=x.concat(Ms({key:`${h}[0]`,value:o[0],valueSpec:g.filter_operator,style:f.style,styleSpec:f.styleSpec})),i.u(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&i.u(o[1])==="$type"&&x.push(new i.V(h,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&x.push(new i.V(h,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(v=i.n(o[1]),v!=="string"&&x.push(new i.V(`${h}[1]`,o[1],`string expected, ${v} found`)));for(let S=2;S<o.length;S++)v=i.n(o[S]),i.u(o[1])==="$type"?x=x.concat(Ms({key:`${h}[${S}]`,value:o[S],valueSpec:g.geometry_type,style:f.style,styleSpec:f.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new i.V(`${h}[${S}]`,o[S],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let S=1;S<o.length;S++)x=x.concat(sc({key:`${h}[${S}]`,value:o[S],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":v=i.n(o[1]),o.length!==2?x.push(new i.V(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new i.V(`${h}[1]`,o[1],`string expected, ${v} found`))}return x}function lc(f,o){let h=f.key,g=f.style,v=f.layer,x=f.styleSpec,S=f.value,k=f.objectKey,D=x[`${o}_${f.layerType}`];if(!D)return[];let A=k.match(/^(.*)-transition$/);if(o==="paint"&&A&&D[A[1]]&&D[A[1]].transition)return G({key:h,value:S,valueSpec:x.transition,style:g,styleSpec:x});let L=f.valueSpec||D[k];if(!L)return[new i.m(h,S,`unknown property "${k}"`)];let z;if(i.n(S)==="string"&&i.q(L)&&!L.tokens&&(z=/^{([^}]+)}$/.exec(S))){let H=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new i.V(h,S,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${H}.`)]}let U=[];if(f.layerType==="symbol")k!=="text-field"||!g||g.glyphs||g.imports||U.push(new i.V(h,S,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&i.H(i.v(S))&&i.u(S.type)==="identity"&&U.push(new i.V(h,S,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&o==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&i.q(L)&&(i.J(L)||i.r(L))){let H=i.x(i.v(S),L),Y=H.value.expression||H.value._styleExpression.expression;Y&&!i.A(Y,["measure-light"])&&(k==="model-emissive-strength"&&i.B(Y)&&i.z(Y)||U.push(new i.V(h,S,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(G({key:f.key,value:S,valueSpec:L,style:g,styleSpec:x,expressionContext:"property",propertyType:o,propertyKey:k}))}function au(f){return lc(f,"paint")}function cc(f){return lc(f,"layout")}function Bo(f){let o=[],h=f.value,g=f.key,v=f.style,x=f.styleSpec;h.type||h.ref||o.push(new i.V(g,h,'either "type" or "ref" is required'));let S=i.u(h.type),k=i.u(h.ref);if(h.id){let D=i.u(h.id);for(let A=0;A<f.arrayIndex;A++){let L=v.layers[A];i.u(L.id)===D&&o.push(new i.V(g,h.id,`duplicate layer id "${h.id}", previously used at line ${L.id.__line__}`))}}if("ref"in h){let D;["type","source","source-layer","filter","layout"].forEach(A=>{A in h&&o.push(new i.V(g,h[A],`"${A}" is prohibited for ref layers`))}),v.layers.forEach(A=>{i.u(A.id)===k&&(D=A)}),D?D.ref?o.push(new i.V(g,h.ref,"ref cannot reference another ref layer")):S=i.u(D.type):typeof k=="string"&&o.push(new i.V(g,h.ref,`ref layer "${k}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(h.source){let D=v.sources&&v.sources[h.source],A=D&&i.u(D.type);D?A==="vector"&&S==="raster"?o.push(new i.V(g,h.source,`layer "${h.id}" requires a raster source`)):A==="raster"&&S!=="raster"?o.push(new i.V(g,h.source,`layer "${h.id}" requires a vector source`)):A!=="vector"||h["source-layer"]?A==="raster-dem"&&S!=="hillshade"?o.push(new i.V(g,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||A==="geojson"&&D.lineMetrics?S==="raster-particle"&&A!=="raster-array"&&o.push(new i.V(g,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):o.push(new i.V(g,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new i.V(g,h.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new i.V(g,h,`layer "${h.id}" must specify a "source-layer"`)):o.push(new i.V(g,h.source,`source "${h.source}" not found`))}else o.push(new i.V(g,h,'missing required property "source"'));return o=o.concat(Nn({key:g,value:h,valueSpec:x.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>G({key:`${g}.type`,value:h.type,valueSpec:x.layer.type,style:f.style,styleSpec:f.styleSpec,object:h,objectKey:"type"}),filter:D=>ks(i.o({layerType:S},D)),layout:D=>Nn({layer:h,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>cc(i.o({layerType:S},A))}}),paint:D=>Nn({layer:h,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>au(i.o({layerType:S,layer:h},A))}})}})),o}function Is(f){let o=f.value,h=f.key,g=i.n(o);return g!=="string"?[new i.V(h,o,`string expected, ${g} found`)]:[]}let No={promoteId:function({key:f,value:o}){if(i.n(o)==="string")return Is({key:f,value:o});{let h=[];for(let g in o)h.push(...Is({key:`${f}.${g}`,value:o[g]}));return h}}};function Mr(f){let o=f.value,h=f.key,g=f.styleSpec,v=f.style;if(!o.type)return[new i.V(h,o,'"type" is required')];let x=i.u(o.type),S=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(o.url||o.tiles||S.push(new i.m(h,o,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Nn({key:h,value:o,valueSpec:g[`source_${x.replace("-","_")}`],style:f.style,styleSpec:g,objectElementValidators:No})),S;case"geojson":if(S=Nn({key:h,value:o,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:No}),o.cluster)for(let k in o.clusterProperties){let[D,A]=o.clusterProperties[k],L=typeof D=="string"?[D,["accumulated"],["get",k]]:D;S.push(...xa({key:`${h}.${k}.map`,value:A,expressionContext:"cluster-map"})),S.push(...xa({key:`${h}.${k}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return S;case"video":return Nn({key:h,value:o,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return Nn({key:h,value:o,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new i.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ms({key:`${h}.type`,value:o.type,valueSpec:{values:su(g)},style:v,styleSpec:g})}}function su(f){return f.source.reduce((o,h)=>{let g=f[h];return g.type.type==="enum"&&(o=o.concat(Object.keys(g.type.values))),o},[])}function sl(f){let o=f.value,h=f.styleSpec,g=h.light,v=f.style,x=[],S=i.n(o);if(o===void 0)return x;if(S!=="object")return x=x.concat([new i.V("light",o,`object expected, ${S} found`)]),x;for(let k in o){let D=k.match(/^(.*)-transition$/);x=x.concat(D&&g[D[1]]&&g[D[1]].transition?G({key:k,value:o[k],valueSpec:h.transition,style:v,styleSpec:h}):g[k]?G({key:k,value:o[k],valueSpec:g[k],style:v,styleSpec:h}):[new i.V(k,o[k],`unknown property "${k}"`)])}return x}function dc(f){let o=f.value,h=[];if(!o)return h;let g=i.n(o);if(g!=="object")return h=h.concat([new i.V("light-3d",o,`object expected, ${g} found`)]),h;let v=f.styleSpec,x=v["light-3d"],S=f.key,k=f.style,D=f.style.lights;for(let z of["type","id"])if(!(z in o))return h=h.concat([new i.V("light-3d",o,`missing property ${z} on light`)]),h;if(o.type&&D)for(let z=0;z<f.arrayIndex;z++){let U=i.u(o.type),H=D[z];i.u(H.type)===U&&h.push(new i.V(S,o.id,`duplicate light type "${o.type}", previously defined at line ${H.id.__line__}`))}let A=`properties_light_${o.type}`;if(!(A in v))return h=h.concat([new i.V("light-3d",o,`Invalid light type ${o.type}`)]),h;let L=v[A];for(let z in o)if(z==="properties"){let U=o[z],H=i.n(U);if(H!=="object")return h=h.concat([new i.V("properties",U,`object expected, ${H} found`)]),h;for(let Y in U)h=h.concat(L[Y]?G({key:Y,value:U[Y],valueSpec:L[Y],style:k,styleSpec:v}):[new i.m(f.key,U[Y],`unknown property "${Y}"`)])}else{let U=z.match(/^(.*)-transition$/);h=h.concat(U&&x[U[1]]&&x[U[1]].transition?G({key:z,value:o[z],valueSpec:v.transition,style:k,styleSpec:v}):x[z]?G({key:z,value:o[z],valueSpec:x[z],style:k,styleSpec:v}):[new i.m(z,o[z],`unknown property "${z}"`)])}return h}function Fd(f){let o=f.value,h=f.key,g=f.style,v=f.styleSpec,x=v.terrain,S=[],k=i.n(o);if(o===void 0||k==="null")return S;if(k!=="object")return S=S.concat([new i.V("terrain",o,`object expected, ${k} found`)]),S;for(let D in o){let A=D.match(/^(.*)-transition$/);S=S.concat(A&&x[A[1]]&&x[A[1]].transition?G({key:D,value:o[D],valueSpec:v.transition,style:g,styleSpec:v}):x[D]?G({key:D,value:o[D],valueSpec:x[D],style:g,styleSpec:v}):[new i.m(D,o[D],`unknown property "${D}"`)])}if(o.source){let D=g.sources&&g.sources[o.source],A=D&&i.u(D.type);D?A!=="raster-dem"&&S.push(new i.V(h,o.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):S.push(new i.V(h,o.source,`source "${o.source}" not found`))}else S.push(new i.V(h,o,'terrain is missing required property "source"'));return S}function hc(f){let o=f.value,h=f.style,g=f.styleSpec,v=g.fog,x=[],S=i.n(o);if(o===void 0)return x;if(S!=="object")return x=x.concat([new i.V("fog",o,`object expected, ${S} found`)]),x;for(let k in o){let D=k.match(/^(.*)-transition$/);x=x.concat(D&&v[D[1]]&&v[D[1]].transition?G({key:k,value:o[k],valueSpec:g.transition,style:h,styleSpec:g}):v[k]?G({key:k,value:o[k],valueSpec:v[k],style:h,styleSpec:g}):[new i.m(k,o[k],`unknown property "${k}"`)])}return x}let Se={"*":()=>[],array:ac,boolean:function(f){let o=f.value,h=f.key,g=i.n(o);return g!=="boolean"?[new i.V(h,o,`boolean expected, ${g} found`)]:[]},number:al,color:function(f){let o=f.key,h=f.value,g=i.n(h);return g!=="string"?[new i.V(o,h,`color expected, ${g} found`)]:i.F(h)===null?[new i.V(o,h,`color expected, "${h}" found`)]:[]},enum:Ms,filter:ks,function:va,layer:Bo,object:Nn,source:Mr,model:i.K,light:sl,"light-3d":dc,terrain:Fd,fog:hc,string:Is,formatted:function(f){return Is(f).length===0?[]:xa(f)},resolvedImage:function(f){return Is(f).length===0?[]:xa(f)},projection:function(f){let o=f.value,h=f.styleSpec,g=h.projection,v=f.style,x=[],S=i.n(o);if(S==="object")for(let k in o)x=x.concat(G({key:k,value:o[k],valueSpec:g[k],style:v,styleSpec:h}));else S!=="string"&&(x=x.concat([new i.V("projection",o,`object or string expected, ${S} found`)]));return x},import:function(f){let{value:o,styleSpec:h}=f,S=o,{data:g}=S,v=ZM(S,["data"]);Object.defineProperty(v,"__line__",{value:o.__line__,enumerable:!1});let x=Nn(i.o({},f,{value:v,valueSpec:h.import}));return i.u(v.id)===""&&x.push(new i.V(`${f.key}.id`,v,"import id can't be an empty string")),g&&(x=x.concat(ce(g,h,{key:`${f.key}.data`}))),x}};function G(f,o=!1){let h=f.value,g=f.valueSpec,v=f.styleSpec;if(g.expression&&i.H(i.u(h)))return va(f);if(g.expression&&i.t(i.v(h)))return xa(f);if(g.type&&Se[g.type]){let x=Se[g.type](f);return o===!0&&x.length>0&&i.n(f.value)==="array"?xa(f):x}return Nn(i.o({},f,{valueSpec:g.type?v[g.type]:g}))}function K(f){let o=f.value,h=f.key,g=Is(f);return g.length||(o.indexOf("{fontstack}")===-1&&g.push(new i.V(h,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&g.push(new i.V(h,o,'"glyphs" url must include a "{range}" token'))),g}function ce(f,o=i.L,h={}){return G({key:h.key||"",value:f,valueSpec:o.$root,styleSpec:o,style:f,objectElementValidators:{glyphs:K,"*":()=>[]}})}function be(f,o=i.L){return yi(ce(f,o))}let ye=f=>yi(Mr(f)),Ee=f=>yi(sl(f)),Ne=f=>yi(dc(f)),Ie=f=>yi(Fd(f)),je=f=>yi(hc(f)),mt=f=>yi(Bo(f)),at=f=>yi(ks(f)),Lt=f=>yi(au(f)),$t=f=>yi(cc(f)),mi=f=>yi(i.K(f));function yi(f){return f.slice().sort((o,h)=>o.line&&h.line?o.line-h.line:0)}function ni(f,o){let h=!1;if(o&&o.length)for(let g of o)g instanceof i.m?i.w(g.message):(f.fire(new i.d(new Error(g.message))),h=!0);return h}let Ti=new i.N({anchor:new i.O(i.L.light.anchor),position:new i.Q(i.L.light.position),color:new i.O(i.L.light.color),intensity:new i.O(i.L.light.intensity)});class At extends i.E{constructor(o,h="flat"){super(),this._transitionable=new i.U(Ti),this.setLight(o,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h,g={}){this._validate(Ee,o,g)||(this._transitionable.setTransitionOrValue(o),this.id=h)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,g){return(!g||g.validate!==!1)&&ni(this,o.call(be,i.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.L})))}}let Sn=new i.N({source:new i.O(i.L.terrain.source),exaggeration:new i.O(i.L.terrain.exaggeration)}),Ki=class extends i.E{constructor(f,o,h,g){super(),this.scope=h,this._transitionable=new i.U(Sn,h,g),this._transitionable.setTransitionOrValue(f,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(f,o){this._transitionable.setTransitionOrValue(f,o)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new i.X(f)).get("exaggeration")}isZoomDependent(){let f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof i.Z}},Pi=45,Yn=65,Mn=.05;function ar(f,o,h,g){let v=i.$(Pi,Yn,h),[x,S]=Vr(f,g),k=1-Math.min(1,Math.exp((o-x)/(S-x)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*f.alpha}function Vr(f,o){let h=.5/Math.tan(.5*o);return[f.range[0]+h,f.range[1]+h]}function jr(f,o,h,g,v){let x=i._.transformMat4([],[o,h,g],v.mercatorFogMatrix);return ar(f,i._.length(x),v.pitch,v._fov)}function ll(f,o,h,g,v,x,S){let k=[[h,g,0],[v,g,0],[v,x,0],[h,x,0]],D=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let L of k){let z=i._.transformMat4([],L,o),U=i._.length(z);D=Math.min(D,U),A=Math.max(A,U)}return[ar(f,D,S.pitch,S._fov),ar(f,A,S.pitch,S._fov)]}let op=new i.N({range:new i.O(i.L.fog.range),color:new i.O(i.L.fog.color),"high-color":new i.O(i.L.fog["high-color"]),"space-color":new i.O(i.L.fog["space-color"]),"horizon-blend":new i.O(i.L.fog["horizon-blend"]),"star-intensity":new i.O(i.L.fog["star-intensity"]),"vertical-range":new i.O(i.L.fog["vertical-range"])});class Ug extends i.E{constructor(o,h,g,v){super(),this._transitionable=new i.U(op,g,new Map(v)),this.set(o,v),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new i.a0(op),this.scope=g}get state(){let o=this._transform,h=o.projection.name==="globe",g=i.a1(o.zoom),v=this.properties.get("range"),x=[.5,3];return{range:h?[i.a2(x[0],v[0],g),i.a2(x[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,h,g={}){if(this._validate(je,o,g))return;let v=i.W({},o);for(let x of Object.keys(i.L.fog))v[x]===void 0&&(v[x]=i.L.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.$(Pi,Yn,o))*h.a}getOpacityAtLatLng(o,h){return this._transform.projection.supportsFog?function(g,v,x){let S=i.Y.fromLngLat(v),k=x.elevation?x.elevation.getAtPointOrZero(S):0;return jr(g,S.x,S.y,k,x)}(this.state,o,h):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];let h=this._transform.calculateFogTileMatrix(o.toUnwrapped());return ll(this.state,h,0,0,i.a3,i.a3,this._transform)}getOpacityForBounds(o,h,g,v,x){return this._transform.projection.supportsFog?ll(this.state,o,h,g,v,x,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Vr(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;let h=[4,5,6,7];for(let g of h){let v=o.points[g],x;if(v[2]>=0)x=v;else{let S=o.points[g-4];x=i.a4(S,v,S[2]/(S[2]-v[2]))}if(jr(this.state,x[0],x[1],0,this._transform)>=Mn)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,g){return(!g||g.validate!==!1)&&ni(this,o.call(be,i.W({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.L})))}}class zd extends i.E{constructor(o,h,g,v){super(),this.scope=g,this._options=o,this.properties=new i.a0(h),this._transitionable=new i.U(h,g,new Map(v)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,h){this._options=o,this._transitionable.setTransitionOrValue(o.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let ci=new i.N({color:new i.O(i.L.properties_light_ambient.color),intensity:new i.O(i.L.properties_light_ambient.intensity)}),ap=new i.N({direction:new i.a5(i.L.properties_light_directional.direction),color:new i.O(i.L.properties_light_directional.color),intensity:new i.O(i.L.properties_light_directional.intensity),"cast-shadows":new i.O(i.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new i.O(i.L.properties_light_directional["shadow-intensity"])});var Ts=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,sp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,lp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,cp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",dp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,hp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,up=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,mp=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,pp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,fp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Hg=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let uc=[];mc(Ts,uc),mc(lp,uc),mc(sp,uc);let lu={"_prelude_fog.vertex.glsl":hp,"_prelude_terrain.vertex.glsl":dp,"_prelude_shadow.vertex.glsl":fp,"_prelude_fog.fragment.glsl":up,"_prelude_shadow.fragment.glsl":Hg,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":mp,"_prelude_raster_particle.glsl":pp},cu={};Mi("",dp),Mi(up,hp),Mi(Hg,fp),Mi(mp,""),Mi(pp,"");let Wg=Mi(sp,lp),Gg=Ts;var qg={background:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Mi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Mi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Mi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Mi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Mi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Mi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Mi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Mi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Mi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Mi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Mi(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Mi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Mi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Mi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Mi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,cp),skyboxGradient:Mi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,cp),skyboxCapture:Mi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Mi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Mi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Mi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Mi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Mi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function mc(f,o){let h=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=g.split(" ");for(let x of v)o.includes(x)||o.push(x)}}function Mi(f,o){let h=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(A=>{let L=A.split(" ");return L[L.length-1]}),v=[...new Set(v)]);let x={},S=[],k=[];if(f=f.replace(h,(A,L)=>(k.push(L),"")),(o=o.replace(h,(A,L)=>(S.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...uc];mc(f,D),mc(o,D);for(let A of[...S,...k])lu[A]||console.error(`Undefined include: ${A}`),cu[A]||(cu[A]=[],mc(lu[A],cu[A])),D=[...D,...cu[A]];return{fragmentSource:f=f.replace(g,(A,L,z,U,H)=>(x[H]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${z} ${U} ${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${H}
    ${z} ${U} ${H} = u_${H};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${z} ${U} ${H};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(g,(A,L,z,U,H)=>{let Y=U==="float"?"vec2":U,Z=H.match(/color/)?"color":Y;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${H}
in ${z} ${U} a_${H};
#endif
`:x[H]?L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${z} ${Y} a_${H};
out ${z} ${U} ${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${z} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${Z}(a_${H}, u_${H}_t);
#else
    ${z} ${U} ${H} = u_${H};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${z} ${U} a_${H};
    out ${z} ${U} ${H};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${H} = a_${H};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${z} ${Y} a_${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${H}0;
in vec4 a_${H}1;
in vec4 a_${H}2;
in vec4 a_${H}3;
#else
uniform ${z} ${U} u_${H};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${Y} a_${H};
#else
uniform ${z} ${U} u_${H};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${z} ${U} ${H} = a_${H};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${U} ${H} = a_${H};
#else
    ${z} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${U} ${H} = unpack_mix_${Z}(a_${H}, u_${H}_t);
#else
    ${z} ${U} ${H} = u_${H};
#endif
`}),staticAttributes:v,usedDefines:D,vertexIncludes:S,fragmentIncludes:k}}class Iy{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,h,g,v,x,S,k,D){this.context=o;let A=this.boundPaintVertexBuffers.length!==v.length;for(let z=0;!A&&z<v.length;z++)this.boundPaintVertexBuffers[z]!==v[z]&&(A=!0);let L=this.boundDynamicVertexBuffers.length!==k.length;for(let z=0;!L&&z<k.length;z++)this.boundDynamicVertexBuffers[z]!==k[z]&&(L=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||A||L||this.boundIndexBuffer!==x||this.boundVertexOffset!==S)this.freshBind(h,g,v,x,S,k,D);else{o.bindVertexArrayOES.set(this.vao);for(let z of k)z&&(z.bind(),D&&z.instanceCount&&z.setVertexAttribDivisor(o.gl,h,D));x&&x.dynamicDraw&&x.bind()}}freshBind(o,h,g,v,x,S,k){let D=o.numAttributes,A=this.context,L=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=S,h.enableAttributes(L,o),h.bind(),h.setVertexAttribPointers(L,o,x);for(let z of g)z.enableAttributes(L,o),z.bind(),z.setVertexAttribPointers(L,o,x);for(let z of S)z&&(z.enableAttributes(L,o),z.bind(),z.setVertexAttribPointers(L,o,x),k&&z.instanceCount&&z.setVertexAttribDivisor(L,o,k));v&&v.bind(),A.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ty(f,o){let h=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new i.Y(0,g/h).toLngLat().lat,new i.Y(0,(g+1)/h).toLngLat().lat]}function Ey(f,o,h,g,v,x,S){let k=f.context,D=k.gl,A=h.hillshadeFBO;if(!A)return;f.prepareDrawTile();let L=f.isTileAffectedByFog(o),z=f.getOrCreateProgram("hillshade",{overrideFog:L});k.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,A.colorAttachment.get());let U=((X,Q,re,oe)=>{let ae=re.paint.get("hillshade-shadow-color"),ge=re.paint.get("hillshade-highlight-color"),fe=re.paint.get("hillshade-accent-color"),ne=re.paint.get("hillshade-emissive-strength"),se=i.ab(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")se-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){let we=X.style.directionalLight.properties.get("direction"),Re=i.ac(we.x,we.y,we.z);se=i.ab(Re[1])}let le=!X.options.moving;return{u_matrix:oe||X.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),le),u_image:0,u_latrange:Ty(0,Q.tileID),u_light:[re.paint.get("hillshade-exaggeration"),se],u_shadow:ae.toRenderColor(re.lut),u_highlight:ge.toRenderColor(re.lut),u_emissive_strength:ne,u_accent:fe.toRenderColor(re.lut)}})(f,h,g,f.terrain?o.projMatrix:null);f.uploadCommonUniforms(k,z,o.toUnwrapped());let{tileBoundsBuffer:H,tileBoundsIndexBuffer:Y,tileBoundsSegments:Z}=f.getTileBoundsBuffers(h);z.draw(f,D.TRIANGLES,v,x,S,i.af.disabled,U,g.id,H,Y,Z)}function gp(f,o,h){if(!o.needsDEMTextureUpload)return;let g=f.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(h.stride);let x=h.getPixels();o.demTexture?o.demTexture.update(x,{premultiply:!1}):o.demTexture=new i.T(g,x,v.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function wa(f,o,h){let g=f.context,v=g.gl;if(!o.dem)return;let x=o.dem;if(g.activeTexture.set(v.TEXTURE1),gp(f,o,x),!o.demTexture)return;o.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let S=x.dim;g.activeTexture.set(v.TEXTURE0);let k=o.hillshadeFBO;if(!k){let U=new i.T(g,{width:S,height:S,data:null},v.RGBA);U.bind(v.LINEAR,v.CLAMP_TO_EDGE),k=o.hillshadeFBO=g.createFramebuffer(S,S,!0,"renderbuffer"),k.colorAttachment.set(U.texture)}g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,S,S]);let{tileBoundsBuffer:D,tileBoundsIndexBuffer:A,tileBoundsSegments:L}=f.getMercatorTileBoundsBuffers(),z=[];f.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(f,v.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.unblended,i.af.disabled,((U,H)=>{let Y=H.stride,Z=i.ad.create();return i.ad.ortho(Z,0,i.a3,-i.a3,0,0,1),i.ad.translate(Z,Z,[0,-i.a3,0]),{u_matrix:Z,u_image:1,u_dimension:[Y,Y],u_zoom:U.overscaledZ}})(o.tileID,x),h.id,D,A,L),o.needsHillshadePrepare=!1}function _p(f,o,h,g,v){let x=function(S,k){if(S)return v(S);if(k){if(f.url&&k.tiles&&f.tiles&&delete f.tiles,k.variants){if(!Array.isArray(k.variants))return v(new Error("variants must be an array"));for(let A of k.variants){if(A==null||typeof A!="object"||A.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(A.capabilities))return v(new Error("capabilities must be an array"));if(A.capabilities.length===1&&A.capabilities[0]==="meshopt"){k=i.W(k,A);break}}}let D=i.ah(i.W(k,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(D.vectorLayers=k.vector_layers,D.vectorLayerIds=D.vectorLayers.map(A=>A.id)),k.raster_layers&&(D.rasterLayers=k.raster_layers,D.rasterLayerIds=D.rasterLayers.map(A=>A.id)),D.tiles=o.canonicalizeTileset(D,f.url),v(null,D)}};return f.url?i.g(o.transformRequest(o.normalizeSourceURL(f.url,null,h,g),i.R.Source),x):i.e.frame(()=>x(null,f))}class Bd{constructor(o,h,g){this.bounds=i.ai.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){let h=Math.pow(2,o.z),g=Math.floor(i.aj(this.bounds.getWest())*h),v=Math.floor(i.ak(this.bounds.getNorth())*h),x=Math.ceil(i.aj(this.bounds.getEast())*h),S=Math.ceil(i.ak(this.bounds.getSouth())*h);return o.x>=g&&o.x<x&&o.y>=v&&o.y<S}}class Nd extends i.E{constructor(o,h,g,v){super(),this.id=o,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.W({type:"raster"},h),i.W(this,i.ah(h,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"})),this._tileJSONRequest=_p(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new i.d(h)):g&&(i.W(this,g),g.bounds&&(this.tileBounds=new Bd(g.bounds,this.minzoom,this.maxzoom)),i.an(g.tiles),this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))),o&&o(h)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=i.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.W({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){let g=i.e.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=i.h(this.map._requestManager.transformRequest(v,i.R.Tile),(x,S,k,D)=>(delete o.request,o.aborted?(o.state="unloaded",h(null)):x?(o.state="errored",h(x)):S?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:k,expires:D}),o.setTexture(S,this.map.painter),o.state="loaded",i.am(this.dispatcher),void h(null)):h(null)))}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h&&h()}unloadTile(o,h){o.texture&&o.texture instanceof i.T?(o.destroy(!0),o.texture&&o.texture instanceof i.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class du extends i.E{constructor(o,h,g,v){if(super(),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.W(this,i.ah(h,["url","scheme","tileSize","promoteId"])),this._options=i.W({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new i.ao}load(o){this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"}));let h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=_p(this._options,this.map._requestManager,h,g,(v,x)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new i.d(v))):x&&(i.W(this,x),x.bounds&&(this.tileBounds=new Bd(x.bounds,this.minzoom,this.maxzoom)),i.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))),o&&o(v)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=i.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.W({},this._options)}loadTile(o,h){let g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(g,i.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,S={request:v,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",S,k.bind(this));else if(o.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",S,k.bind(this),void 0,!0);else{let D=i.ap.call({deduped:this._deduped},S,(A,L)=>{A||!L?k.call(this,A):(S.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},o.actor&&o.actor.send("loadTile",S,k.bind(this),void 0,!0))},!0);o.request={cancel:D}}function k(D,A){return delete o.request,o.aborted?h(null):D&&D.status!==404?h(D):(A&&A.resourceTiming&&(o.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&o.setExpiryData(A),o.loadVectorData(A,this.map.painter),i.am(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,h){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let cl=f=>({u_matrix:new i.a6(f),u_image0:new i.a7(f),u_skirt_height:new i.aa(f),u_ground_shadow_factor:new i.aq(f)}),xt=(f,o,h)=>({u_matrix:f,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:h}),$g=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:S,u_frustum_tr:k,u_frustum_br:D,u_frustum_bl:A,u_globe_pos:L,u_globe_radius:z,u_viewport:U,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:Y});class Vd{constructor(o=0,h=0,g=0,v=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=g,this.right=v}interpolate(o,h,g){return h.top!=null&&o.top!=null&&(this.top=i.a2(o.top,h.top,g)),h.bottom!=null&&o.bottom!=null&&(this.bottom=i.a2(o.bottom,h.bottom,g)),h.left!=null&&o.left!=null&&(this.left=i.a2(o.left,h.left,g)),h.right!=null&&o.right!=null&&(this.right=i.a2(o.right,h.right,g)),this}getCenter(o,h){let g=i.at((this.left+o-this.right)/2,0,o),v=i.at((this.top+h-this.bottom)/2,0,h);return new i.P(g,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Vd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ei(f,o){let h=i.aw(f,3);i.ad.fromQuat(f,o),i.az(f,3,h)}function Ur(f,o){let h=i.av.identity([]);return i.av.rotateZ(h,h,-o),i.av.rotateX(h,h,-f),h}function Yg(f,o){let h=[f[0],f[1],0],g=[o[0],o[1],0];if(i._.length(h)>=1e-15){let S=i._.normalize([],h);i._.scale(g,S,i._.dot(g,S)),o[0]=g[0],o[1]=g[1]}let v=i._.cross([],o,f);if(i._.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return Ur(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class bp{constructor(o,h){this.position=o,this.orientation=h}get position(){return this._position}set position(o){if(o){let h=o instanceof i.Y?o:new i.Y(o[0],o[1],o[2]);this._renderWorldCopies&&(h.x=i.au(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(o,h){if(this.orientation=null,!this.position)return;let g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(i.Y.fromLngLat(o)):0,x=i.Y.fromLngLat(o,v),S=[x.x-g.x,x.y-g.y,x.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Yg(S,h)}setPitchBearing(o,h){this.orientation=Ur(i.ab(o),i.ab(-h))}}class jd{constructor(o,h){this._transform=i.ad.identity([]),this.orientation=h,this.position=o}get mercatorPosition(){let o=this.position;return new i.Y(o[0],o[1],o[2])}get position(){let o=i.aw(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var h;o&&i.az(this._transform,3,[(h=o)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||i.av.identity([]),o&&Ei(this._transform,this._orientation)}getPitchBearing(){let o=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,h){this._orientation=Ur(o,h),Ei(this._transform,this._orientation)}forward(){let o=i.aw(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){let o=i.aw(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){let o=i.aw(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,h){let g=new Float64Array(16);return i.ad.invert(g,this.getWorldToCamera(o,h)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,h,g){let v=this.position;i._.scale(v,v,-o);let x=new Float64Array(16);return i.ad.fromScaling(x,[g,g,g]),i.ad.translate(x,x,v),x[10]*=h,x}getWorldToCamera(o,h){let g=new Float64Array(16),v=new Float64Array(4),x=this.position;return i.av.conjugate(v,this._orientation),i._.scale(x,x,-o),i.ad.fromQuat(g,v),i.ad.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(o,h,g,v){let x=new Float64Array(16);return i.ad.perspective(x,o,h,g,v),x}getCameraToClipOrthographic(o,h,g,v,x,S){let k=new Float64Array(16);return i.ad.ortho(k,o,h,g,v,x,S),k}getDistanceToElevation(o,h=!1){let g=o===0?0:i.ax(o,h?i.ay(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new jd([...this.position],[...this.orientation])}}let pc={unknown:0,flipRequired:1,flipNotRequired:2},pi=Math.tan(85*Math.PI/180);function dl(f,o,h,g,v,x,S){let k=i.ad.create();if(h)if(x.name==="globe"){let D=i.aB(v,o);i.ad.multiply(k,k,D)}else{let D=i.aC.invert([],S);k[0]=D[0],k[1]=D[1],k[4]=D[2],k[5]=D[3],g||i.ad.rotateZ(k,k,v.angle)}else i.ad.multiply(k,v.labelPlaneMatrix,f);return k}function hl(f,o,h,g,v,x,S){let k=dl(f,o,h,g,v,x,S);return x.name==="globe"&&h||(k[2]=k[6]=k[10]=k[14]=0),k}function fc(f,o,h,g,v,x,S){if(h){if(x.name==="globe"){let k=dl(f,o,h,g,v,x,S);return i.ad.invert(k,k),i.ad.multiply(k,f,k),k}{let k=i.ad.clone(f),D=i.ad.identity([]);return D[0]=S[0],D[1]=S[1],D[4]=S[2],D[5]=S[3],i.ad.multiply(k,k,D),g||i.ad.rotateZ(k,k,-v.angle),k}}return v.glCoordMatrix}function Vo(f,o,h,g){let v=[f,o,h,1];h?i.aA.transformMat4(v,v,g):Ca(v,v,g);let x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function Hr(f,o){return Math.min(.5+f/o*.5,1.5)}function Dy(f,o){let h=f[0]/f[3],g=f[1]/f[3];return h>=-o[0]&&h<=o[0]&&g>=-o[1]&&g<=o[1]}function hu(f,o,h,g,v,x,S,k,D,A){let L=h.transform,z=g?f.textSizeData:f.iconSizeData,U=i.aD(z,h.transform.zoom),H=L.projection.name==="globe",Y=[256/h.width*2+1,256/h.height*2+1],Z=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Z.clear();let X=null;H&&(X=g?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let Q=f.lineVertexArray,re=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,oe=h.transform.width/h.transform.height,ae,ge=!1;for(let fe=0;fe<re.length;fe++){let ne=re.get(fe),{numGlyphs:se,writingMode:le}=ne;if(le!==i.aE.vertical||ge||ae===i.aE.horizontal||(ge=!0),ae=le,(ne.hidden||le===i.aE.vertical)&&!ge){ul(se,Z);continue}ge=!1;let we=new i.P(ne.tileAnchorX,ne.tileAnchorY),{x:Re,y:me,z:Le}=L.projection.projectTilePoint(we.x,we.y,A.canonical);if(D){let[kt,vt,it]=D(we);Re+=kt,me+=vt,Le+=it}let Be=[Re,me,Le,1];if(i.aA.transformMat4(Be,Be,o),!Dy(Be,Y)){ul(se,Z);continue}let Qe=Be[3],Je=Hr(h.transform.getCameraToCenterDistance(L.projection),Qe),Ze=i.aF(z,U,ne),Te=S?Ze/Je:Ze*Je,Ve=Vo(Re,me,Le,v);if(Ve[3]<=0){ul(se,Z);continue}let Ye={},gt=S?null:D,yt=vp(ne,Te,!1,k,o,v,x,f.glyphOffsetArray,Q,Z,X,Ve,we,Ye,oe,gt,L.projection,A,S);ge=yt.useVertical,gt&&yt.needsFlipping&&(Ye={}),(yt.notEnoughRoom||ge||yt.needsFlipping&&vp(ne,Te,!0,k,o,v,x,f.glyphOffsetArray,Q,Z,X,Ve,we,Ye,oe,gt,L.projection,A,S).notEnoughRoom)&&ul(se,Z)}g?(f.text.dynamicLayoutVertexBuffer.updateData(Z),X&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(X)):(f.icon.dynamicLayoutVertexBuffer.updateData(Z),X&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(X))}function uu(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z){let{lineStartIndex:X,glyphStartIndex:Q,segment:re}=k,oe=Q+k.numGlyphs,ae=X+k.lineLength,ge=o.getoffsetX(Q),fe=o.getoffsetX(oe-1),ne=gc(f*ge,h,g,v,x,S,re,X,ae,D,A,L,z,U,!0,H,Y,Z);if(!ne)return null;let se=gc(f*fe,h,g,v,x,S,re,X,ae,D,A,L,z,U,!0,H,Y,Z);return se?{first:ne,last:se}:null}function yp(f,o,h,g){return f===i.aE.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:f===i.aE.vertical?g>0?{needsFlipping:!0}:null:o!==pc.unknown&&function(v,x){return v===0||Math.abs(x/v)>pi}(h,g)?o===pc.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function vp(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q,re){let oe=o/24,ae=f.lineOffsetX*oe,ge=f.lineOffsetY*oe,{lineStartIndex:fe,glyphStartIndex:ne,numGlyphs:se,segment:le,writingMode:we,flipState:Re}=f,me=fe+f.lineLength,Le=Be=>{if(L){let[Te,Ve,Ye]=Be.up,gt=A.length;i.aG(L,gt+0,Te,Ve,Ye),i.aG(L,gt+1,Te,Ve,Ye),i.aG(L,gt+2,Te,Ve,Ye),i.aG(L,gt+3,Te,Ve,Ye)}let[Qe,Je,Ze]=Be.point;i.aH(A,Qe,Je,Ze,Be.angle)};if(se>1){let Be=uu(oe,k,ae,ge,h,z,U,f,D,x,H,Z,!1,X,Q,re);if(!Be)return{notEnoughRoom:!0};if(g&&!h){let[Qe,Je,Ze]=Be.first.point,[Te,Ve,Ye]=Be.last.point;[Qe,Je]=Vo(Qe,Je,Ze,S),[Te,Ve]=Vo(Te,Ve,Ye,S);let gt=yp(we,Re,(Te-Qe)*Y,Ve-Je);if(f.flipState=gt&&gt.needsFlipping?pc.flipRequired:pc.flipNotRequired,gt)return gt}Le(Be.first);for(let Qe=ne+1;Qe<ne+se-1;Qe++){let Je=gc(oe*k.getoffsetX(Qe),ae,ge,h,z,U,le,fe,me,D,x,H,Z,!1,!1,X,Q,re);if(!Je)return A.length-=4*(Qe-ne),{notEnoughRoom:!0};Le(Je)}Le(Be.last)}else{if(g&&!h){let Qe=Vo(U.x,U.y,0,v),Je=fe+le+1,Ze=new i.P(D.getx(Je),D.gety(Je)),Te=Vo(Ze.x,Ze.y,0,v),Ve=Te[3]>0?Te:Ud(U,Ze,Qe,1,v,void 0,X,Q.canonical),Ye=yp(we,Re,(Ve[0]-Qe[0])*Y,Ve[1]-Qe[1]);if(f.flipState=Ye&&Ye.needsFlipping?pc.flipRequired:pc.flipNotRequired,Ye)return Ye}let Be=gc(oe*k.getoffsetX(ne),ae,ge,h,z,U,le,fe,me,D,x,H,Z,!1,!1,X,Q,re);if(!Be)return{notEnoughRoom:!0};Le(Be)}return{}}function mu(f,o,h,g,v){let{x,y:S,z:k}=g.projectTilePoint(f.x,f.y,o);if(!v)return Vo(x,S,k,h);let[D,A,L]=v(f);return Vo(x+D,S+A,k+L,h)}function Ud(f,o,h,g,v,x,S,k){let D=mu(f.sub(o)._unit()._add(f),k,v,S,x);return i._.sub(D,h,D),i._.normalize(D,D),i._.scaleAndAdd(D,h,D,g)}function gc(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q){let re=g?f-o:f+o,oe=re>0?1:-1,ae=0;g&&(oe*=-1,ae=Math.PI),oe<0&&(ae+=Math.PI);let ge=k+S+(oe>0?0:1)|0,fe=v,ne=v,se=0,le=0,we=Math.abs(re),Re=[],me=[],Le=x,Be=Le,Qe=()=>Ud(Be,Le,ne,we-se+1,L,U,Z,X.canonical);for(;se+le<=we;){if(ge+=oe,ge<k||ge>=D)return null;if(ne=fe,Be=Le,Re.push(ne),H&&me.push(Be),Le=new i.P(A.getx(ge),A.gety(ge)),fe=z[ge],!fe){let vt=mu(Le,X.canonical,L,Z,U);fe=vt[3]>0?z[ge]=vt:Qe()}se+=le,le=i._.distance(ne,fe)}Y&&U&&(z[ge]&&(fe=Qe(),le=i._.distance(ne,fe)),z[ge]=fe);let Je=(we-se)/le,Ze=Le.sub(Be)._mult(Je)._add(Be),Te=i._.sub([],fe,ne),Ve=i._.scaleAndAdd([],ne,Te,Je),Ye=[0,0,1],gt=Te[0],yt=Te[1];if(Q&&(Ye=Z.upVector(X.canonical,Ze.x,Ze.y),Ye[0]!==0||Ye[1]!==0||Ye[2]!==1)){let vt=[Ye[2],0,-Ye[0]],it=i._.cross([],Ye,vt);i._.normalize(vt,vt),i._.normalize(it,it),gt=i._.dot(Te,vt),yt=i._.dot(Te,it)}if(h){let vt=i._.cross([],Ye,Te);i._.normalize(vt,vt),i._.scaleAndAdd(Ve,Ve,vt,h*oe)}let kt=ae+Math.atan2(yt,gt);return Re.push(Ve),H&&me.push(Ze),{point:Ve,angle:kt,path:Re,tilePath:me,up:Ye}}function ul(f,o){let h=o.length,g=h+4*f;o.resize(g),o.float32.fill(-1/0,4*h,4*g)}function Ca(f,o,h){let g=o[0],v=o[1];return f[0]=h[0]*g+h[4]*v+h[12],f[1]=h[1]*g+h[5]*v+h[13],f[3]=h[3]*g+h[7]*v+h[15],f}let xp=(f,o,h)=>(1-h)*f+h*o,Zn=f=>f*f*f*f*f;class Sa{constructor(o,h,g,v,x,S,k){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(S),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new i.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Vd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new jd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let o=new Sa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,h=!1){let g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(o||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return i.ah(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=i.aJ(this.projectionOptions);let g=!_(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){let o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.aJ({name:"mercator"});let h=o!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.au(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){let h=-o*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=i.aC.create(),i.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){let h=i.at(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=i.ab(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){let h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){let o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let g=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let o=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop(),v=0,x=0;for(let S=0;S<h.length;S++){let k=new i.P(h[S][0]*this.width,g+h[S][1]*(this.height-g)),D=o.pointCoordinate(k);if(!D)continue;let A=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);v+=D[3]*A,x+=A}return x===0?NaN:v/x}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let o=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(o),x=this._mercatorZfromZoom(this._maxZoom),S=Math.max(v-g,x);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude())),g;g=o.z<this._camera.position[2]?[h.x,h.y,h.z]:[o.x,o.y,o.z];let v=i._.length(i._.sub([],this._camera.position,g));return i.at(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let h=!1;if(o.orientation&&!i.av.exactEquals(o.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(o.orientation)),o.position){let g=[o.position.x,o.position.y,o.position.z];i._.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let o=this._camera.position,h=new bp;return h.position=new i.Y(o[0],o[1],o[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(o){if(!i.av.length(o))return!1;i.av.normalize(o,o);let h=i._.transformQuat([],[0,0,-1],o),g=i._.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;let v=Yg(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(o){let h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;o[2]=i.at(o[2],v/g,v/h),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,g){this._unmodified=!1,this._edgeInsets.interpolate(o,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){let h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){let h=[new i.aK(0,o)];if(this.renderWorldCopies){let g=this.pointCoordinate(new i.P(0,0)),v=this.pointCoordinate(new i.P(this.width,0)),x=this.pointCoordinate(new i.P(this.width,this.height)),S=this.pointCoordinate(new i.P(0,this.height)),k=Math.floor(Math.min(g.x,v.x,x.x,S.x)),D=Math.floor(Math.max(g.x,v.x,x.x,S.x)),A=1;for(let L=k-A;L<=D+A;L++)L!==0&&h.push(new i.aK(L,o))}return h}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(o,h,g){let v=[];if(h[0]===0&&h[1]===0)return v;for(let S of o){let k=S.canonical,D=S.overscaledZ,A=S.wrap,L=1<<k.z,z=k.x+1<L,U=k.x>0,H=k.y+1<L,Y=k.y>0,Z=S.wrap-(U?0:1),X=S.wrap+(z?0:1),Q=U?k.x-1:L-1,re=z?k.x+1:0;h[0]<0?(v.push(new i.aL(D,X,k.z,re,k.y)),h[1]<0&&H&&(v.push(new i.aL(D,A,k.z,k.x,k.y+1)),v.push(new i.aL(D,X,k.z,re,k.y+1))),h[1]>0&&Y&&(v.push(new i.aL(D,A,k.z,k.x,k.y-1)),v.push(new i.aL(D,X,k.z,re,k.y-1)))):h[0]>0?(v.push(new i.aL(D,Z,k.z,Q,k.y)),h[1]<0&&H&&(v.push(new i.aL(D,A,k.z,k.x,k.y+1)),v.push(new i.aL(D,Z,k.z,Q,k.y+1))),h[1]>0&&Y&&(v.push(new i.aL(D,A,k.z,k.x,k.y-1)),v.push(new i.aL(D,Z,k.z,Q,k.y-1)))):h[1]<0&&H?v.push(new i.aL(D,A,k.z,k.x,k.y+1)):Y&&v.push(new i.aL(D,A,k.z,k.x,k.y-1))}if(v.length>1){v.sort((D,A)=>D.overscaledZ-A.overscaledZ||D.wrap-A.wrap||D.canonical.z-A.canonical.z||D.canonical.x-A.canonical.x||D.canonical.y-A.canonical.y);let S=0,k=0;for(;k<v.length;)v[k].equals(v[S])?++k:v[++S]=v[k++];v.length=S+1}let x=[];for(let S of v)v.some(k=>S.isChildOf(k))||x.push(S);return v=x.filter(S=>!o.some(k=>!!(S.overscaledZ<g&&k.isChildOf(S))||S.equals(k)||S.isChildOf(k))),v}coveringTiles(o){let h=this.coveringZoomLevel(o),g=h,v=this.elevation&&this.elevation.exaggeration(),x=v&&!o.isTerrainDEM,S=this.projection.name==="mercator";if(o.minzoom!==void 0&&h<o.minzoom)return[];o.maxzoom!==void 0&&h>o.maxzoom&&(h=o.maxzoom);let k=this.locationCoordinate(this.center),D=this.center.lat,A=1<<h,L=[A*k.x,A*k.y,0],z=this.projection.name==="globe",U=!z,H=i.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,U),Y=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=A*i.ax(1,this.center.lat),X=this._camera.position[2]/i.ax(1,this.center.lat),Q=[A*Y.x,A*Y.y,X*(U?1:Z)],re=z||v,oe=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),ae=this.isLODDisabled(!0)?h:0,ge;if(this._elevation&&o.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){let Te=this._elevation.getMinMaxForVisibleTiles();ge=Te?Te.max:this._centerAltitude}else ge=this._centerAltitude;let fe=o.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?i.aN(this):1,se=Te=>{let Ye=new i.Y(Te.x+25e-6,Te.y,Te.z),gt=new i.Y(Te.x,Te.y+25e-6,Te.z),yt=Te.toLngLat(),kt=Ye.toLngLat(),vt=gt.toLngLat(),it=this.locationCoordinate(yt),Ge=this.locationCoordinate(kt),Dt=this.locationCoordinate(vt),oi=Math.hypot(Ge.x-it.x,Ge.y-it.y),ti=Math.hypot(Dt.x-it.x,Dt.y-it.y);return Math.sqrt(oi*ti)*ne/25e-6},le=Te=>{let Ve=ge,Ye=fe;return{aabb:i.aQ(this,A,0,0,0,Te,Ye,Ve,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:Ve,wrap:Te,fullyVisible:!1}},we=[],Re=[],me=h,Le=o.reparseOverscaled?g:h,Be=Te=>Te*Te,Qe=Be((X-this._centerAltitude)*Z),Je=Te=>{if(!this._elevation||!Te.tileID||!S)return;let Ve=this._elevation.getMinMaxForTile(Te.tileID),Ye=Te.aabb;Ve?(Ye.min[2]=Ve.min,Ye.max[2]=Ve.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Te.shouldSplit=Ze(Te),Te.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},Ze=Te=>{if(Te.zoom<ae)return!0;if(Te.zoom===me)return!1;if(Te.shouldSplit!=null)return Te.shouldSplit;let Ve=Te.aabb.distanceX(Q),Ye=Te.aabb.distanceY(Q),gt=Qe,yt=1;if(z){gt=Be(Te.aabb.distanceZ(Q));let it=Math.pow(2,Te.zoom),Ge=i.ay((Te.y+1)/it),Dt=i.ay(Te.y/it),oi=Math.min(Math.max(D,Ge),Dt),ti=i.b4(oi)/i.b4(D);if(yt=oi===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ti/this._mercatorScaleRatio),this.zoom<=i.b1&&Te.zoom===me-1&&ti>=.9)return!0}else if(x&&(gt=Be(Te.aabb.distanceZ(Q)*Z)),this.projection.isReprojectedInTileSpace&&g<=5){let it=Math.pow(2,Te.zoom),Ge=se(new i.Y((Te.x+.5)/it,(Te.y+.5)/it));yt=Ge>.85?1:Ge}let kt=Ve*Ve+Ye*Ye+gt,vt=Be((1<<me-Te.zoom)*oe*yt*((it,Ge)=>{if(Ge*Be(.707)<it)return 1;let Dt=Math.sqrt(Ge/it);return Dt/(1.4144271570014144+(Math.pow(1.1,Dt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(gt,Qe),kt));return kt<vt};if(this.renderWorldCopies)for(let Te=1;Te<=3;Te++)we.push(le(-Te)),we.push(le(Te));for(we.push(le(0));we.length>0;){let Te=we.pop(),Ve=Te.x,Ye=Te.y,gt=Te.fullyVisible,yt=()=>this.projection.name==="globe"&&(Te.y===0||Te.y===(1<<Te.zoom)-1);if(!gt){let kt=re?Te.aabb.intersects(H):Te.aabb.intersectsFlat(H);if(kt===0&&yt()){let vt=new i.aO(Te.zoom,Ve,Ye);kt=i.aP(this,A,vt,!0).intersects(H)}if(kt===0)continue;gt=kt===2}if(Te.zoom!==me&&Ze(Te))for(let kt=0;kt<4;kt++){let vt=(Ve<<1)+kt%2,it=(Ye<<1)+(kt>>1),Ge={aabb:S?Te.aabb.quadrant(kt):i.aQ(this,A,Te.zoom+1,vt,it,Te.wrap,Te.minZ,Te.maxZ,this.projection),zoom:Te.zoom+1,x:vt,y:it,wrap:Te.wrap,fullyVisible:gt,tileID:void 0,shouldSplit:void 0,minZ:Te.minZ,maxZ:Te.maxZ};x&&!z&&(Ge.tileID=new i.aL(Te.zoom+1===me?Le:Te.zoom+1,Te.wrap,Te.zoom+1,vt,it),Je(Ge)),we.push(Ge)}else{let kt=Te.zoom===me?Le:Te.zoom;if(o.minzoom&&o.minzoom>kt)continue;if(!gt){let Dt=re?Te.aabb.intersectsPrecise(H):Te.aabb.intersectsPreciseFlat(H);if(Dt===0&&yt()){let oi=new i.aO(Te.zoom,Ve,Ye);Dt=i.aP(this,A,oi,!0).intersectsPrecise(H)}if(Dt===0)continue}let vt=L[0]-(.5+Ve+(Te.wrap<<Te.zoom))*(1<<h-Te.zoom),it=L[1]-.5-Ye,Ge=Te.tileID?Te.tileID:new i.aL(kt,Te.wrap,Te.zoom,Ve,Ye);Re.push({tileID:Ge,distanceSq:vt*vt+it*it})}}if(this.fogCullDistSq){let Te=this.fogCullDistSq,Ve=this.horizonLineFromTop();Re=Re.filter(Ye=>{let gt=[0,0,0,1],yt=[i.a3,i.a3,0,1],kt=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());i.aA.transformMat4(gt,gt,kt),i.aA.transformMat4(yt,yt,kt);let vt=i.aA.min([],gt,yt),it=i.aA.max([],gt,yt),Ge=i.aR(vt,it);if(Ge===0)return!0;let Dt=!1,oi=this._elevation;if(oi&&Ge>Te&&Ve!==0){let ti=this.calculateProjMatrix(Ye.tileID.toUnwrapped()),vi;o.isTerrainDEM||(vi=oi.getMinMaxForTile(Ye.tileID)),vi||(vi={min:fe,max:ge});let Di=i.b2(this.rotation),Ji=[Di[0]*i.a3,Di[1]*i.a3,vi.max];i._.transformMat4(Ji,Ji,ti),Dt=(1-Ji[1])*this.height*.5<Ve}return Ge<Te||Dt})}return Re.sort((Te,Ve)=>Te.distanceSq-Ve.distanceSq).map(Te=>Te.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){let h=i.at(o.lat,-i.aS,i.aS),g=this.projection.project(o.lng,h);return new i.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,h){let g,v,x=this.centerPoint;if(this.projection.name==="globe"){let k=this.worldSize;g=(h.x-x.x)/k,v=(h.y-x.y)/k}else{let k=this.pointCoordinate(h),D=this.pointCoordinate(x);g=k.x-D.x,v=k.y-D.y}let S=this.locationCoordinate(o);this.setLocation(new i.Y(S.x-g,S.y-v))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,h){let g=h?i.ax(h,o.lat):void 0,v=this.projection.project(o.lng,o.lat);return new i.Y(v.x,v.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,h){let g=h??this._centerAltitude,v=[o.x,o.y,0,1],x=[o.x,o.y,1,1];i.aA.transformMat4(v,v,this.pixelMatrixInverse),i.aA.transformMat4(x,x,this.pixelMatrixInverse);let S=x[3];i.aA.scale(v,v,1/v[3]),i.aA.scale(x,x,1/S);let k=v[2],D=x[2];return{p0:v,p1:x,t:k===D?0:(g-k)/(D-k)}}screenPointToMercatorRay(o){let h=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return i.aA.transformMat4(h,h,this.pixelMatrixInverse),i.aA.transformMat4(g,g,this.pixelMatrixInverse),i.aA.scale(h,h,1/h[3]),i.aA.scale(g,g,1/g[3]),h[2]=i.ax(h[2],this._center.lat)*this.worldSize,g[2]=i.ax(g[2],this._center.lat)*this.worldSize,i.aA.scale(h,h,1/this.worldSize),i.aA.scale(g,g,1/this.worldSize),new i.aT([h[0],h[1],h[2]],i._.normalize([],i._.sub([],g,h)))}rayIntersectionCoordinate(o){let{p0:h,p1:g,t:v}=o,x=i.ax(h[2],this._center.lat),S=i.ax(g[2],this._center.lat);return new i.Y(i.a2(h[0],g[0],v)/this.worldSize,i.a2(h[1],g[1],v)/this.worldSize,i.a2(x,S,v))}pointCoordinate(o,h=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,h)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let h=this.projection.pointCoordinate3D(this,o.x,o.y);if(h)return new i.Y(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(o.y>v)return this.pointCoordinate(o);let x=.02*v,S=o.clone();for(let k=0;k<10&&v-g>x;k++){S.y=i.a2(g,v,.66);let D=this.projection.pointCoordinate3D(this,S.x,S.y);D?(v=S.y,h=D):g=S.y}return h?new i.Y(h[0],h[1],h[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=i.aU)return!this.isPointAboveHorizon(o);let h=this.pointCoordinate(o);return h.y>=0&&h.y<=1}_coordinatePoint(o,h){let g=h&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,v=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return i.aA.transformMat4(v,v,this.pixelMatrix),v[3]>0?new i.P(v[0]/v[3],v[1]/v[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:o,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new i.P(h,o)),S=this.pointLocation3D(new i.P(v,o)),k=this.pointLocation3D(new i.P(v,g)),D=this.pointLocation3D(new i.P(h,g)),A=Math.min(x.lng,S.lng,k.lng,D.lng),L=Math.max(x.lng,S.lng,k.lng,D.lng),z=Math.min(x.lat,S.lat,k.lat,D.lat),U=Math.max(x.lat,S.lat,k.lat,D.lat),H=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,Z=(X,Q,re,oe,ae)=>{let ge=(X+re)/2,fe=(Q+oe)/2,ne=new i.P(ge,fe),{lng:se,lat:le}=this.pointLocation3D(ne),we=Math.max(0,A-se,z-le,se-L,le-U);A=Math.min(A,se),L=Math.max(L,se),z=Math.min(z,le),U=Math.max(U,le),(ae<Y||we>H)&&(Z(X,Q,ge,fe,ae+1),Z(ge,fe,re,oe,ae+1))};if(Z(h,o,v,o,1),Z(v,o,v,g,1),Z(v,g,h,g,1),Z(h,g,h,o,1),this.projection.name==="globe"){let[X,Q]=i.aV(this);X?(U=90,L=180,A=-180):Q&&(z=-90,L=180,A=-180)}return new i.ai(new i.aI(A,z),new i.aI(L,U))}_getBoundsRectangular(o,h){let{top:g,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,k=new i.P(v,g),D=new i.P(S,g),A=new i.P(S,x),L=new i.P(v,x),z=this.pointCoordinate(k,o),U=this.pointCoordinate(D,o),H=this.pointCoordinate(A,h),Y=this.pointCoordinate(L,h),Z=(X,Q)=>(Q.y-X.y)/(Q.x-X.x);return z.y>1&&U.y>=0?z=new i.Y((1-Y.y)/Z(Y,z)+Y.x,1):z.y<0&&U.y<=1&&(z=new i.Y(-Y.y/Z(Y,z)+Y.x,0)),U.y>1&&z.y>=0?U=new i.Y((1-H.y)/Z(H,U)+H.x,1):U.y<0&&z.y<=1&&(U=new i.Y(-H.y/Z(H,U)+H.x,0)),new i.ai().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){let o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);let h=o.visibleDemTiles.reduce((g,v)=>{if(v.dem){let x=v.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*o.exaggeration(),h.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-i.aS,this.maxLat=i.aS,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aj(this.minLng)*this.tileSize,this.worldMaxX=i.aj(this.maxLng)*this.tileSize,this.worldMinY=i.ak(this.maxLat)*this.tileSize,this.worldMaxY=i.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,h){return this.projection.createTileMatrix(this,h,o)}calculateDistanceTileData(o){let h=o.key,g=this._distanceTileDataCache;if(g[h])return g[h];let v=o.canonical,x=1/this.height,S=this.cameraWorldSize,k=S/this.zoomScale(v.z),D=(v.x+Math.pow(2,v.z)*o.wrap)*k,A=v.y*k,L=this.point;L.x*=S/this.worldSize,L.y*=S/this.worldSize;let z=this.angle,U=Math.sin(-z),H=-Math.cos(-z);return g[h]={bearing:[U,H],center:[(L.x-D)*x,(L.y-A)*x],scale:k/i.a3*x},g[h]}calculateFogTileMatrix(o){let h=o.key,g=this._fogTileMatrixCache;if(g[h])return g[h];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return i.ad.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(o,h=!1,g=!1){let v=o.key,x;if(x=g?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];let S=this.calculatePosMatrix(o,this.worldSize),k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,i.ad.multiply(S,k,S),x[v]=new Float32Array(S),x[v]}calculatePixelsToTileUnitsMatrix(o){let h=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];let v=i.aW(o,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let o=1/this.worldSize,h=i.ad.fromScaling([],[o,o,o]);return i.ad.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let o=this._elevation;this._updateCameraState();let h=i.ax(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),x=i.ax(1,this._center.lat);g[2]/=x,v[2]/=x,i._.normalize(v,v);let S=o.raycast(g,v,o.exaggeration());if(S){let k=i._.scaleAndAdd([],g,v,S),D=new i.Y(k[0],k[1],i.ax(k[2],i.ay(k[1]))),A=(D.z+i._.length([D.x-g[0],D.y-g[1],D.z-g[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;let h=this._elevation,g=i.ax(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),x=h.getAtPointOrZero(new i.Y(...v)),S=this.pixelsPerMeter/this.worldSize*x,k=this._minimumHeightOverTerrain(),D=v[2]-S;if(D<=k)if(D<0||o){let A=this.locationCoordinate(this._center,this._centerAltitude),L=[v[0],v[1],A.z-v[2]],z=i._.length(L);L[2]-=(k-D)/this._pixelsPerMercatorPixel;let U=i._.length(L);if(U===0)return;i._.scale(L,L,z/U*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],A.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){let U=this.center;return U.lat=i.at(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(U.lng=i.at(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}let h=this._unmodified,{x:g,y:v}=this.point,x=0,S=g,k=v,D=this.width/2,A=this.height/2,L=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(v-A<L&&(k=L+A),v+A>z&&(k=z-A),z-L<this.height&&(x=Math.max(x,this.height/(z-L)),k=(z+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let U=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,Y=this.worldSize/2-(U+H)/2;S=(g+Y+this.worldSize)%this.worldSize-Y,S-D<U&&(S=U+D),S+D>H&&(S=H-D),H-U<this.width&&(x=Math.max(x,this.width/(H-U)),S=(H+U)/2)}S===g&&k===v||(this.center=this.unproject(new i.P(S,k))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let o=this.centerOffset,h=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ax(1,this.center.lat)/i.ax(1,i.b3));let v=i.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?g:1,S=this._camera.getWorldToCamera(this.worldSize,x),k,D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-o.x/this.width,D[9]=2*o.y/this.height,this.isOrthographic){let le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),we=le*this.aspect,Re=-we,me=-le;we-=o.x,Re-=o.x,le+=o.y,me+=o.y,k=this._camera.getCameraToClipOrthographic(Re,we,me,le,this._nearZ,this._farZ),((Le,Be,Qe,Je)=>{for(let Ze=0;Ze<16;Ze++)Le[Ze]=xp(Be[Ze],Qe[Ze],Je)})(k,k,D,Zn(this.pitch>=15?1:this.pitch/15))}else k=D;let A=i.ad.mul([],D,S),L=i.ad.mul([],k,S);if(this.projection.isReprojectedInTileSpace){let le=this.locationCoordinate(this.center),we=i.ad.identity([]);i.ad.translate(we,we,[le.x*this.worldSize,le.y*this.worldSize,0]),i.ad.multiply(we,we,i.aY(this)),i.ad.translate(we,we,[-le.x*this.worldSize,-le.y*this.worldSize,0]),i.ad.multiply(L,L,we),i.ad.multiply(A,A,we),this.inverseAdjustmentMatrix=i.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.scale([],L,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=L,this.invProjMatrix=i.ad.invert(new Float64Array(16),this.projMatrix),h){let le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);le[8]=2*-o.x/this.width,le[9]=2*o.y/this.height,this.expandedFarZProjMatrix=i.ad.mul([],le,S)}else this.expandedFarZProjMatrix=this.projMatrix;let z=i.ad.invert([],k);this.frustumCorners=i.a_.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);let U=new Float32Array(16);i.ad.identity(U),i.ad.scale(U,U,[1,-1,1]),i.ad.rotateX(U,U,this._pitch),i.ad.rotateZ(U,U,this.angle);let H=i.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.clone(H);let Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-o.x/this.width,H[9]=2*(o.y+Y)/this.height,this.skyboxMatrix=i.ad.multiply(U,H,U);let Z=this.point,X=Z.x,Q=Z.y,re=this.width%2/2,oe=this.height%2/2,ae=Math.cos(this.angle),ge=Math.sin(this.angle),fe=X-Math.round(X)+ae*re+ge*oe,ne=Q-Math.round(Q)+ae*oe+ge*re,se=new Float64Array(L);if(i.ad.translate(se,se,[fe>.5?fe-1:fe,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=se,L=i.ad.create(),i.ad.scale(L,L,[this.width/2,-this.height/2,1]),i.ad.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=i.ad.create(),i.ad.scale(L,L,[1,-1,1]),i.ad.translate(L,L,[-1,-1,0]),i.ad.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=i.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,A),this._calcFogMatrices(),this._distanceTileDataCache={},L=i.ad.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.a$(this);let le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i._.transformMat4(le,le,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let o=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[o,o,h];i._.scale(x,x,v),i._.scale(g,g,-1),i._.multiply(g,g,x);let S=i.ad.create();i.ad.translate(S,S,g),i.ad.scale(S,S,x),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,h,v)}_computeCameraPosition(o){let h=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-o/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*x,v.y/this.worldSize-g[1]*x,o/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=o[2],x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((h-g)/v,1)),this._camera.position=i._.scaleAndAdd([],this._camera.position,o,x),this._updateStateFromCamera()}_updateStateFromCamera(){let o=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),x=i.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ab(this._maxPitch)),k=Math.max((o[2]-x)/Math.cos(g),S),D=this._zoomFromMercatorZ(k);i._.scaleAndAdd(o,o,h,k),this._pitch=i.at(g,i.ab(this.minPitch),i.ab(this.maxPitch)),this.angle=i.au(v,-Math.PI,Math.PI),this._setZoom(i.at(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.Y(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){let o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let h=0,g=i.aU,v=0,x=1/0;for(;g-h>1e-6&&g>h;){let S=h+.5*(g-h),k=this.tileSize*Math.pow(2,S),D=this.getCameraToCenterDistance(this.projection,S,k),A=this.scaleZoom(D/(o*this.tileSize)),L=Math.abs(S-A);L<x&&(x=L,v=S),S<A?h=S:g=S}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,h){let g=Math.min(o.x,h.x),v=Math.max(o.x,h.x),x=Math.min(o.y,h.y),S=Math.max(o.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let k=[new i.P(g,x),new i.P(v,S),new i.P(g,S),new i.P(v,x)],D=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(let L of k){let z=this.pointRayIntersection(L);if(z.t<0)return!0;let U=this.rayIntersectionCoordinate(z);if(U.x<D||U.y<0||U.x>A||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(o,h){let g=i._.length(i._.sub([],this._camera.position,o)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let o=function([h,g,v],x){let S=[h,g,v,1];i.aA.transformMat4(S,S,x);let k=S[3]=Math.max(S[3],1e-6);return S[0]/=k,S[1]/=k,S[2]/=k,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(o[0],o[1])}{let o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,o))}}getCameraToCenterDistance(o,h=this.zoom,g=this.worldSize){let v=i.aX(o,h,this.width,this.height,1024),x=o.pixelSpaceConversion(this.center.lat,g,v),S=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(S=xp(1,S,Zn(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){let o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.multiply(o,o,this.globeMatrix),o}getFrustum(o){return i.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}let Xr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},$a=(f,o)=>{if(o>0&&f.terrain&&i.w("Cutoff is currently disabled on terrain"),o<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let h=f.transform,g=Math.max(Math.abs(h._zoom-(f.minCutoffZoom-1)),1),v=h.isLODDisabled(!1)?i.$(60,45,h.pitch):i.$(30,15,h.pitch),x=h._farZ-h._nearZ,S=o*h.height,k=((1-(D=v))*h.cameraToCenterDistance+D*(h._farZ+S))*g;var D;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(k-h._nearZ)/x,(k-S-h._nearZ)/x]}}},kr={cascadeCount:2,shadowMapResolution:2048};class wp{constructor(o,h){this.aabb=o,this.lastCascade=h}}class Cp{add(o,h){let g=this.receivers[o.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],h.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],h.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],h.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],h.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],h.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],h.max[2])):this.receivers[o.key]=new wp(h,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,h,g){let v=i.b6.fromPoints(o.points),x=0;for(let S in this.receivers){let k=this.receivers[S];if(!k||!v.intersectsAabb(k.aabb))continue;k.aabb.min=v.closestPoint(k.aabb.min),k.aabb.max=v.closestPoint(k.aabb.max);let D=k.aabb.getCorners();for(let A=0;A<g.length;A++){let L=!0;for(let z of D){let U=[z[0]*h,z[1]*h,z[2]];if(i._.transformMat4(U,U,g[A].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){L=!1;break}}if(k.lastCascade=A,x=Math.max(x,A),L)break}}return x+1}}class pu{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Cp,this._depthMode=new i.ae(o.context.gl.LEQUAL,i.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(kr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(kr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,h){let g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;let v=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((Y,Z)=>{let X=g.style._mergedLayers[Z];return Y+(X.hasShadowPass()&&!X.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let x=g.context,S=kr.shadowMapResolution,k=kr.shadowMapResolution;if(this._cascades.length===0||kr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<kr.cascadeCount;++Y){let Z=g._shadowMapDebug,X=x.gl,Q=x.createFramebuffer(S,k,Z,"texture"),re=new i.T(x,{width:S,height:k,data:null},X.DEPTH_COMPONENT);if(Q.depthAttachment.set(re.texture),Z){let oe=new i.T(x,{width:S,height:k,data:null},X.RGBA);Q.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:Q,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.aM,scale:0})}}this.shadowDirection=Hd(h);let D=0;if(o.elevation){let Y=o.elevation,Z=[1e4,-1e4];Y.visibleDemTiles.filter(X=>X.dem).forEach(X=>{let Q=X.dem.tree;Z[0]=Math.min(Z[0],Q.minimums[0]),Z[1]=Math.max(Z[1],Q.maximums[0])}),Z[0]!==1e4&&(D=(Z[1]-Z[0])*Y.exaggeration())}let A=1.5*o.cameraToCenterDistance,L=3*A,z=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){let Z=this._cascades[Y],X=o.height/50,Q=1;kr.cascadeCount===1?Q=L:Y===0?Q=A:(X=A,Q=L);let[re,oe]=Wd(o,this.shadowDirection,X,Q,kr.shadowMapResolution,D);Z.scale=o.scale,Z.matrix=re,Z.boundingSphereRadius=oe,i.ad.invert(z,Z.matrix),Z.frustum=i.aM.fromInvProjectionMatrix(z,1,0,!0),Z.far=Q}let U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/kr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=kr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Xr.ShadowMap0,this._uniformValues.u_shadowmap_1=Xr.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let H=g.transform.elevation;for(let Y of this._groundShadowTiles){let Z={min:0,max:0};if(H){let X=H.getMinMaxForTile(Y);X&&(Z=X)}this.addShadowReceiver(Y.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,h){if(!this.enabled)return;let g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,kr.shadowMapResolution,kr.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){g.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:i.C.white,depth:1});for(let S of o.order){let k=o._mergedLayers[S];if(!k.hasShadowPass()||k.isHidden(g.transform.zoom))continue;let D=o.getLayerSourceCache(k),A=D?h[D.id]:void 0;(k.type==="model"||A&&A.length)&&g.renderLayer(g,D,k,A)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let o=this.painter,h=o.style,g=o.context,v=h.directionalLight,x=h.ambientLight;if(!v||!x)return;let S=[],k=$a(o,o.longestCutoffRange);k.shouldRenderCutoff&&S.push("RENDER_CUTOFF");let D=Ya(h,v,x),A=new i.ae(g.gl.LEQUAL,i.ae.ReadOnly,o.depthRangeFor3D);for(let L of this._groundShadowTiles){let z=L.toUnwrapped(),U=o.isTileAffectedByFog(L),H=o.getOrCreateProgram("groundShadow",{defines:S,overrideFog:U});this.setupShadows(z,H),o.uploadCommonUniforms(g,H,z,null,k);let Y={u_matrix:o.transform.calculateProjMatrix(z),u_ground_shadow_factor:D};H.draw(o,g.gl.TRIANGLES,A,i.ag.disabled,i.a.multiply,i.af.disabled,Y,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,{},o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?i.a.unblended:i.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){let h=this.painter.transform,g=h.calculatePosMatrix(o,h.worldSize);return i.ad.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(o){return i.ad.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,h,g,v=0){if(!this.enabled)return;let x=this.painter.transform,S=this.painter.context,k=S.gl,D=this._uniformValues,A=new Float64Array(16),L=x.calculatePosMatrix(o,x.worldSize);for(let z=0;z<this._cascades.length;z++)i.ad.multiply(A,this._cascades[z].matrix,L),D[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),S.activeTexture.set(k.TEXTURE0+Xr.ShadowMap0+z),this._cascades[z].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){let z=i.b5(o.canonical),U=2/x.tileSize*i.a3/kr.shadowMapResolution,H=U*this._cascades[0].boundingSphereRadius,Y=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(g==="vector-tile"?1:3)/Math.pow(2,v-o.canonical.z-(1-x.zoom+Math.floor(x.zoom)));D.u_shadow_normal_offset=[z,H*Z,Y*Z],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(S,D)}setupShadowsFromMatrix(o,h,g=!1){if(!this.enabled)return;let v=this.painter.context,x=v.gl,S=this._uniformValues,k=new Float64Array(16);for(let D=0;D<kr.cascadeCount;D++)i.ad.multiply(k,this._cascades[D].matrix,o),S[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),v.activeTexture.set(x.TEXTURE0+Xr.ShadowMap0+D),this._cascades[D].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(S.u_shadow_normal_offset=[1,5,5],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(v,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,h,g,v){if(v[2]>=0)return{};let x=function(D,A,L){let z=L/(1<<D.canonical.z);return new i.b6([D.canonical.x*z+D.wrap*L,D.canonical.y*z+D.wrap*L,0],[(D.canonical.x+1)*z+D.wrap*L,(D.canonical.y+1)*z+D.wrap*L,A])}(o,h,g).getCorners(),S=h/-v[2];v[0]<0?(i._.add(x[0],x[0],[v[0]*S,0,0]),i._.add(x[3],x[3],[v[0]*S,0,0])):v[0]>0&&(i._.add(x[1],x[1],[v[0]*S,0,0]),i._.add(x[2],x[2],[v[0]*S,0,0])),v[1]<0?(i._.add(x[0],x[0],[0,v[1]*S,0]),i._.add(x[1],x[1],[0,v[1]*S,0])):v[1]>0&&(i._.add(x[2],x[2],[0,v[1]*S,0]),i._.add(x[3],x[3],[0,v[1]*S,0]));let k={};return k.vertices=x,k.planes=[_c(x[1],x[0],x[4]),_c(x[2],x[1],x[5]),_c(x[3],x[2],x[6]),_c(x[0],x[3],x[7])],k}addShadowReceiver(o,h,g){this._receivers.add(o,i.b6.fromTileIdAndHeight(o,h,g))}getMaxCascadeForTile(o){let h=this._receivers.get(o);return h&&h.lastCascade?h.lastCascade:0}}function _c(f,o,h){let g=i._.sub([],h,o),v=i._.sub([],f,o),x=i._.cross([],g,v),S=i._.length(x);return S===0?[0,0,1,0]:(i._.scale(x,x,1/S),[x[0],x[1],x[2],-i._.dot(x,o)])}function Hd(f){let o=f.properties.get("direction"),h=i.ac(o.x,o.y,o.z);h[2]=i.at(h[2],0,75);let g=i.b7([h[0],h[1],h[2]]);return i._.fromValues(g.x,g.y,g.z)}function Ya(f,o,h){let g=o.properties.get("color"),v=o.properties.get("intensity"),x=o.properties.get("direction"),S=[x.x,x.y,x.z],k=h.properties.get("color"),D=h.properties.get("intensity"),A=Math.max(i._.dot([0,0,1],S),0),L=[0,0,0];i._.scale(L,k.toRenderColor(f.getLut(o.scope)).toArray01Linear().slice(0,3),D);let z=[0,0,0];return i._.scale(z,g.toRenderColor(f.getLut(h.scope)).toArray01Linear().slice(0,3),A*v),i.b8([L[0]>0?L[0]/(L[0]+z[0]):0,L[1]>0?L[1]/(L[1]+z[1]):0,L[2]>0?L[2]/(L[2]+z[2]):0])}function Wd(f,o,h,g,v,x){let S=f.zoom,k=f.scale,D=f.worldSize,A=1/D,L=f.aspect,z=Math.sqrt(1+L*L)*Math.tan(.5*f.fovX),U=z*z,H=g-h,Y=g+h,Z,X;U>H/Y?(Z=g,X=g*z):(Z=.5*Y*(1+U),X=.5*Math.sqrt(H*H+2*(g*g+h*h)*U+Y*Y*U*U));let Q=f.projection.pixelsPerMeter(f.center.lat,D),re=f._camera.getCameraToWorldMercator(),oe=[0,0,-Z*A];i._.transformMat4(oe,oe,re);let ae=X*A,ge=f._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){let gt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?Q:1),yt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,h,g);yt[8]=2*-f.centerOffset.x/f.width,yt[9]=2*f.centerOffset.y/f.height;let kt=new Float64Array(16);i.ad.mul(kt,yt,gt);let vt=new Float64Array(16);i.ad.invert(vt,kt);let it=i.aM.fromInvProjectionMatrix(vt,D,S,!0);for(let Ge of it.points){let Dt=((fe=Ge)[0]/=k,fe[1]/=k,fe[2]=i.ax(fe[2],f._center.lat),fe);ae=Math.max(ae,i._.len(i._.subtract([],oe,Dt)))}}var fe;ae*=v/(v-1);let ne=Math.acos(o[2]),se=Math.atan2(-o[0],-o[1]),le=new jd;le.position=oe,le.setPitchBearing(ne,se);let we=le.getWorldToCamera(D,Q),Re=ae*D,me=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*Re),Le=le.getCameraToClipOrthographic(-Re,Re,-Re,Re,me,(Re+x*Q)/o[2]),Be=new Float64Array(16);i.ad.multiply(Be,Le,we);let Qe=i._.fromValues(Math.floor(1e6*oe[0])/1e6*D,Math.floor(1e6*oe[1])/1e6*D,0),Je=.5*v,Ze=[0,0,0];i._.transformMat4(Ze,Qe,Be),i._.scale(Ze,Ze,Je);let Te=[Math.floor(Ze[0]),Math.floor(Ze[1]),Math.floor(Ze[2])],Ve=[0,0,0];i._.sub(Ve,Ze,Te),i._.scale(Ve,Ve,-1/Je);let Ye=new Float64Array(16);return i.ad.identity(Ye),i.ad.translate(Ye,Ye,Ve),i.ad.multiply(Be,Ye,Be),[Be,Re]}function fu(f,o){return f!=null&&o!=null&&!(!f.hasData()||!o.hasData())&&f.demTexture!=null&&o.demTexture!=null&&f.tileID.key!==o.tileID.key}let ml=new class{constructor(){this.operations={}}newMorphing(f,o,h,g,v){if(f in this.operations){let x=this.operations[f];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[f]={startTime:g,phase:0,duration:v,from:o,to:h,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let o=this.operations[f];return{from:o.from,to:o.to,phase:o.phase}}update(f){for(let o in this.operations){let h=this.operations[o];for(h.phase=(f-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,f)){delete this.operations[o];break}}}_nextOp(f,o){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=o,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Gd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Sp(f,o,h){if(o===0)return 0;let g=o<1&&h===514?.25/o:1;return 6*Math.pow(1.5,22-f)*Math.max(o,1)*g}function Zg(f,o){let h=1<<f.z;return!o&&(f.x===0||f.x===h-1)||f.y===0||f.y===h-1}let gu=f=>({u_matrix:f});function _u(f,o,h,g,v){if(v>0){let x=i.e.now(),S=(x-f.timeAdded)/v,k=o?(x-o.timeAdded)/v:-1,D=h.getSource(),A=g.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),L=!o||Math.abs(o.tileID.overscaledZ-A)>Math.abs(f.tileID.overscaledZ-A),z=L&&f.refreshedUponExpiration?1:i.at(L?S:1-k,0,1);return f.refreshedUponExpiration&&S>=1&&(f.refreshedUponExpiration=!1),o?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class bc extends Nd{constructor(o,h,g,v){super(o,h,g,v),this.type="raster-array",this.maxzoom=22,this._options=i.W({type:"raster-array"},h)}triggerRepaint(o){let h=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);h&&h.enabled&&g&&h._clearRenderCacheForTile(g.id,o.tileID),this.map.triggerRepaint()}loadTile(o,h){let g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,i.R.Tile);o.requestParams=v,o.actor||(o.actor=this.dispatcher.getActor()),o.request=o.fetchHeader(void 0,(x,S,k,D)=>{if(delete o.request,o.aborted)return o.state="unloaded",h(null);if(x)return x.code===20?void 0:(o.state="errored",h(x));this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:k,expires:D}),o.state="empty",h(null)})}unloadTile(o,h){let g=o.texture;g&&g instanceof i.T?(o.destroy(!0),this.map.painter.saveTileTexture(g)):(o.destroy(),o.flushQueues(),o._isHeaderLoaded=!1,delete o._mrt,delete o.textureDescriptor),o.fbo&&(o.fbo.destroy(),delete o.fbo),delete o.request,delete o.requestParams,delete o.neighboringTiles,o.state="unloaded"}prepareTile(o,h,g){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBand(h,g,(v,x)=>{if(v)return o.state="errored",this.fire(new i.d(v)),void this.triggerRepaint(o);x&&(o.setTexture(x,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;let h=this.rasterLayers.find(({id:x})=>x===o),g=h&&h.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(o,h,g){if(!o)return;let v=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;h instanceof i.bk?x=h.paint.get("raster-array-band"):h instanceof i.bl&&(x=h.paint.get("raster-particle-array-band"));let S=x||this.getInitialBand(v);if(S!=null)if(o.textureDescriptor){if(!o.updateNeeded(v,S)||g)return Object.assign({},o.textureDescriptor,{texture:o.texture})}else this.prepareTile(o,v,S)}}let Ir={vector:du,raster:Nd,"raster-dem":class extends Nd{constructor(f,o,h,g){super(f,o,h,g),this.type="raster-dem",this.maxzoom=22,this._options=i.W({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(f,o){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,x){v&&(f.state="errored",o(v)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",o(null))}f.request=i.h(this.map._requestManager.transformRequest(h,i.R.Tile),(function(v,x,S,k){if(delete f.request,f.aborted)f.state="unloaded",o(null);else if(v)f.state="errored",o(v);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:S,expires:k});let D=ImageBitmap&&x instanceof ImageBitmap&&i.bi(),A=1-(x.width-i.bj(x.width))/2;A<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let L=D?x:i.e.getImageData(x,A),z={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:A};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",z,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){let o=f.canonical,h=Math.pow(2,o.z),g=(o.x-1+h)%h,v=o.x===0?f.wrap-1:f.wrap,x=(o.x+1+h)%h,S=o.x+1===h?f.wrap+1:f.wrap,k={};return k[new i.aL(f.overscaledZ,v,o.z,g,o.y).key]={backfilled:!1},k[new i.aL(f.overscaledZ,S,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(k[new i.aL(f.overscaledZ,v,o.z,g,o.y-1).key]={backfilled:!1},k[new i.aL(f.overscaledZ,f.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},k[new i.aL(f.overscaledZ,S,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<h&&(k[new i.aL(f.overscaledZ,v,o.z,g,o.y+1).key]={backfilled:!1},k[new i.aL(f.overscaledZ,f.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},k[new i.aL(f.overscaledZ,S,o.z,x,o.y+1).key]={backfilled:!1}),k}},"raster-array":bc,geojson:class extends i.E{constructor(f,o,h,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=o.data,this._options=i.W({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let v=i.a3/this.tileSize;this.workerOptions=i.W({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*v,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*v,extent:i.a3,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:i.a3,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*v,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){return this._options.dynamic?typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection")?this.fire(new i.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...f.features):this._data=f,this._updateWorkerData(!0),this):this.fire(new i.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(f,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterChildren(f,o){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterLeaves(f,o,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:o,offset:h},g),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.f("dataloading",{dataType:"source"})),this._loaded=!1;let o=i.W({append:f},this.workerOptions);o.scope=this.scope;let h=this._data;typeof h=="string"?(o.request=this.map._requestManager.transformRequest(i.e.resolveURL(h),i.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new i.d(g));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new i.f("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,o){let h=f.actor?"reloadTile":"loadTile";f.actor=this.actor;let g=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,x={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g?{image:g.image.clone()}:null,scope:this.scope,pixelRatio:i.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};f.request=this.actor.send(h,x,(S,k)=>v&&!k?(f.state="loaded",o(null)):(delete f.request,f.destroy(),f.aborted?o(null):S?o(S):(f.loadVectorData(k,this.map.painter,h==="reloadTile"),o(null))),void 0,h==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,o){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.bm{constructor(f,o,h,g){super(f,o,h,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let o of f.urls)this.urls.push(this.map._requestManager.transformRequest(o,i.R.Source).url);i.bn(this.urls,(o,h)=>{this._loaded=!0,o?this.fire(new i.d(o)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let o=this.video.seekable;f<o.start(0)||f>o.end(0)?this.fire(new i.d(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,o=f.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(f,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.bm,model:class extends i.E{constructor(f,o,h,g){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){let f=[];for(let o in this._options.models){let h=this._options.models[o],g=i.l(this.map._requestManager.transformRequest(h.uri,i.R.Model).url).then(v=>{if(!v)return;let x=i.c(v),S=new i.M(o,h.position,h.orientation,x);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(v=>{this.fire(new i.d(new Error(`Could not load model ${o} from ${h.uri}: ${v.message}`)))});f.push(g)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this.fire(new i.d(new Error(`Could not load models: ${o.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,o){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(f,o,h,g){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=_p(this._options,this.map._requestManager,o,h,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.d(g))):v&&(i.W(this,v),v.bounds&&(this.tileBounds=new Bd(v.bounds,this.minzoom,this.maxzoom)),i.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))),f&&f(g)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,o){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,i.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=o;else{if(f.buckets){let x=Object.values(f.buckets);for(let S of x)S.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",g,v.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(x,S){return f.aborted?o(null):x&&x.status!==404?o(x):(S&&(S.resourceTiming&&(f.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(S),f.buckets=Zi(Zi({},f.buckets),S.buckets),S.featureIndex&&(f.latestFeatureIndex=S.featureIndex)),f.state="loaded",void o(null))}}serialize(){return i.W({},this._options)}},canvas:class extends i.bm{constructor(f,o,h,g){super(f,o,h,g),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new i.d(new i.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.d(new i.V(`sources.${f}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new i.d(new i.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new i.d(new i.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.d(new i.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof i.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends i.E{constructor(f,o,h,g){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bd(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),i.W(this,i.ah(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new i.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:o,y:h,z:g}=f.canonical;return this._implementation.hasTile({x:o,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,o){let{x:h,y:g,z:v}=f.tileID.canonical,x=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:x.signal})).then((function(S){return delete f.request,f.aborted?(f.state="unloaded",o(null)):S===void 0?(f.state="errored",o(null)):S===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",o(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(S)?(this.loadTileData(f,S),f.state="loaded",void o(null)):(f.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(f.state="errored",o(S))}),f.request.cancel=()=>x.abort()}loadTileData(f,o){f.setTexture(o,this._map.painter)}unloadTile(f,o){if(f.texture&&f.texture instanceof i.T?(f.destroy(!0),f.texture&&f.texture instanceof i.T&&this._map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){let{x:h,y:g,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}o&&o()}abortTile(f,o){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){let f=i.al(this.id,this.scope);this._map.style.clearSource(f)}_update(){this.fire(new i.f("data",{dataType:"source",sourceDataType:"content"}))}}},bu=function(f,o,h,g){let v=new Ir[o.type](f,o,h,g);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return i.bp(["load","abort","unload","serialize","prepare"],v),v};class Mp extends i.bv{constructor(o){let h={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new i.bw(i.bx(),null),v=bu("mock-dem",h,g,o.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,h){o.state="loaded",h(null)}}class Xg extends i.bv{constructor(o){let h=bu("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new i.bw(i.bx(),null),o.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,h,g){if(o.freezeTileCoverage)return;this.transform=o;let v=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,S)=>{if(x[S.key]="",!this._tiles[S.key]){let k=new i.by(S,this._source.tileSize*S.overscaleFactor(),o.tileZoom);k.state="loaded",this._tiles[S.key]=k}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(o){let h=this.proxyCachedFBO[o];if(h!==void 0){let g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class kp extends i.aL{constructor(o,h,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class Ip extends i.bq{constructor(o,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[g,v,x]=function(D){let A=new i.bt,L=new i.bu,z=131;A.reserve(17161),L.reserve(33800);let U=i.a3/128,H=i.a3+U/2,Y=H+U;for(let X=-U;X<Y;X+=U)for(let Q=-U;Q<Y;Q+=U){let re=Q<0||Q>H||X<0||X>H?24575:0,oe=i.at(Math.round(Q),0,i.a3),ae=i.at(Math.round(X),0,i.a3);A.emplaceBack(oe+re,ae)}let Z=(X,Q)=>{let re=Q*z+X;L.emplaceBack(re+1,re,re+z),L.emplaceBack(re+z,re+z+1,re+1)};for(let X=1;X<129;X++)for(let Q=1;Q<129;Q++)Z(Q,X);return[0,129].forEach(X=>{for(let Q=0;Q<130;Q++)Z(Q,X),Z(X,Q)}),[A,L,32768]}(),S=o.context;this.gridBuffer=S.createVertexBuffer(g,i.br.members),this.gridIndexBuffer=S.createIndexBuffer(v),this.gridSegments=i.b.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=i.b.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Xg(h.map),this.orthoMatrix=i.ad.create(),i.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.a3,0,i.a3,0,1);let k=S.gl;this._overlapStencilMode=new i.ag({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Mp(h.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,h,g){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);let v=o.terrain.properties,x=o.terrain.drapeRenderMode===0,S=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.e.now();let k=o.terrain&&o.terrain.scope,D=v.get("source"),A=x?this._mockSourceCache:o.getSourceCache(D,k);if(!A)return void i.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=A,this._exaggeration=S?this.calculateExaggeration(h):v.get("exaggeration"),!h.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;let L=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let z=this.getScaledDemTileSize();this.sourceCache.update(h,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(o){let h=this._previousCameraAltitude,g=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=g;let v=h!=null?g-h:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let x=o.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(x);let k=x-this._previousZoom,D=this._previousUpdateTimestamp,A=x;this._evaluationZoom!=null&&(A=this._evaluationZoom,Math.abs(x-A)>.5&&(k=.5*(x-A+k)),k*v<0&&(A+=k)),this._evaluationZoom=A;let L=S.getExaggeration(A),z=L===S.getExaggeration(Math.max(0,A-.1));if(z&&Math.abs(L-this._exaggeration)<.01)return L;let U=Math.min(.1,.00375*(this._updateTimestamp-D));return(z||L<.1||Math.abs(k)<1e-4)&&(U=Math.min(.2,4*U)),i.a2(this._exaggeration,L,U)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(i.Y.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=h.getIds().map(D=>{let A=h.getTileByID(D).tileID;return A.projMatrix=g.calculateProjMatrix(A.toUnwrapped()),A});(function(D,A){let L=A.transform.pointCoordinate(A.transform.getCameraPoint()),z=new i.P(L.x,L.y);D.sort((U,H)=>{if(H.overscaledZ-U.overscaledZ)return H.overscaledZ-U.overscaledZ;let Y=new i.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Z=new i.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),X=z.mult(1<<U.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(Y)-X.distSqr(Z)})})(v,this.painter);let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};let S=this._style._mergedSourceCaches;for(let D in S){let A=S[D];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,o[D],x),A.usedForTerrain))continue;let L=o[D];A.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[h.id]=v.map(D=>new kp(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;let k={};this._visibleDemTiles=[];for(let D of this.proxyCoords){let A=this.terrainTileForTile[D.key];if(!A)continue;let L=A.tileID.key;L in k||(this._visibleDemTiles.push(A),k[L]=L)}}_assignTerrainTiles(o){this._initializing||o.forEach(h=>{if(this.terrainTileForTile[h.key])return;let g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){let o=this.painter.context,h=o.gl;for(let g in this.terrainTileForTile){let v=this.terrainTileForTile[g],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(o.activeTexture.set(h.TEXTURE1),gp(this.painter,v,x))}}_prepareDemTileUniforms(o,h,g,v){if(!h||h.demTexture==null)return!1;let x=o.tileID.canonical,S=Math.pow(2,h.tileID.canonical.z-x.z),k=v||"";return g[`u_dem_tl${k}`]=[x.x*S%1,x.y*S%1],g[`u_dem_scale${k}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let o=this.painter.context,h=o.gl;if(!this._emptyDepthBufferTexture){let g=new i.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.T(o,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0,h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;let x=v.dem.tree.minimums[0];return x>0&&o++,g+x},0);return o?h/o:0}_updateEmptyDEMTexture(){let o=this.painter.context,h=o.gl;o.activeTexture.set(h.TEXTURE2);let g=this._getLoadedAreaMinimum(),[v,x]=(()=>{let k=new i.bz({width:1,height:1},new Float32Array([g]));return[h.R32F,k]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new i.T(o,x,v,{premultiply:!1}),S}setupElevationDraw(o,h,g){let v=this.painter.context,x=v.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};S.u_exaggeration=this.exaggeration();let k=null,D=null,A=1;if(g&&g.morphing&&this._useVertexMorphing){let H=g.morphing.srcDemTile,Y=g.morphing.dstDemTile;A=g.morphing.phase,H&&Y&&(this._prepareDemTileUniforms(o,H,S,"_prev")&&(D=H),this._prepareDemTileUniforms(o,Y,S)&&(k=Y))}let L=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST,z=null;var U;if(this.enabled?D&&k?(z=k.demTexture,v.activeTexture.set(x.TEXTURE4),D.demTexture.bind(L(D),x.CLAMP_TO_EDGE),S.u_dem_lerp=A):(k=this.terrainTileForTile[o.tileID.key],z=this._prepareDemTileUniforms(o,k,S)?k.demTexture:this.emptyDEMTexture):z=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),z&&(S.u_dem_size=(U=z).size[0]===1?1:U.size[0]-2,z.bind(L(k),x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&k){let H=(1<<k.tileID.canonical.z)*i.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=H}if(g&&g.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,S),this.painter.transform.projection.name==="globe"){let H=this.globeUniformValues(this.painter.transform,o.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,H)}}globeUniformValues(o,h,g){let v=o.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,i.a3,0),u_tile_br_up:v.upVector(h,i.a3,i.a3),u_tile_bl_up:v.upVector(h,0,i.a3),u_tile_up_scale:g?i.bs(1):v.upVectorScale(h,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){let h=this.painter,g=this.painter.context;o.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,S,k,D){if(v.transform.projection.name==="globe")(function(A,L,z,U,H){let Y=A.context,Z=Y.gl,X,Q,re=A.transform,oe=i.ba(A,Y,re),ae=(Le,Be)=>{if(Q===Be)return;let Qe=[Gd[Be],"PROJECTION_GLOBE_VIEW"];oe&&Qe.push("CUSTOM_ANTIALIASING");let Je=A.isTileAffectedByFog(Le);X=A.getOrCreateProgram("globeRaster",{defines:Qe,overrideFog:Je}),Q=Be},ge=A.colorModeForRenderPass(),fe=new i.ae(Z.LEQUAL,i.ae.ReadWrite,A.depthRangeFor3D);ml.update(H);let ne=i.bb(re),se=[i.aj(re.center.lng),i.ak(re.center.lat)],le=A.globeSharedBuffers,we=[re.width*i.e.devicePixelRatio,re.height*i.e.devicePixelRatio],Re=Float32Array.from(re.globeMatrix),me={useDenormalizedUpVectorScale:!0};{let Le=A.transform,Be=Sp(Le.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Q=-1;let Qe=Z.TRIANGLES;for(let Je of U){let Ze=z.getTile(Je),Te=i.ag.disabled,Ve=L.prevTerrainTileForTile[Je.key],Ye=L.terrainTileForTile[Je.key];fu(Ve,Ye)&&ml.newMorphing(Je.key,Ve,Ye,H,250),Y.activeTexture.set(Z.TEXTURE0),Ze.texture&&Ze.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let gt=ml.getMorphValuesForProxy(Je.key),yt=gt?1:0;gt&&i.o(me,{morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:i.b9(gt.phase)}});let kt=i.bc(Je.canonical),vt=i.bd(kt.getCenter().lat),it=i.be(Je.canonical,kt,vt,Le.worldSize/Le._pixelsPerMercatorPixel),Ge=i.bf(i.bg(Je.canonical)),Dt=$g(Le.expandedFarZProjMatrix,Re,ne,Ge,i.a1(Le.zoom),se,Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.globeCenterInViewSpace,Le.globeRadius,we,Be,Le._farZ,it);if(ae(Je,yt),X&&(L.setupElevationDraw(Ze,X,me),A.uploadCommonUniforms(Y,X,Je.toUnwrapped()),le)){let[oi,ti,vi]=le.getGridBuffers(vt,Be!==0);X.draw(A,Qe,fe,Te,ge,i.af.backCCW,Dt,"globe_raster",oi,ti,vi)}}}if(le&&(A.renderDefaultNorthPole||A.renderDefaultSouthPole)){let Le=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Le.push("CUSTOM_ANTIALIASING"),X=A.getOrCreateProgram("globeRaster",{defines:Le});for(let Be of U){let{x:Qe,y:Je,z:Ze}=Be.canonical,Te=Je===0,Ve=Je===(1<<Ze)-1,[Ye,gt,yt,kt]=le.getPoleBuffers(Ze,!1);if(kt&&(Te||Ve)){let vt=z.getTile(Be);Y.activeTexture.set(Z.TEXTURE0),vt.texture&&vt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let it=i.bh(Ze,Qe,re),Ge=i.bf(i.bg(Be.canonical)),Dt=(oi,ti)=>oi.draw(A,Z.TRIANGLES,fe,i.ag.disabled,ge,i.af.disabled,$g(re.expandedFarZProjMatrix,it,it,Ge,0,se,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,we,0,re._farZ),"globe_pole_raster",ti,yt,kt);L.setupElevationDraw(vt,X,me),A.uploadCommonUniforms(Y,X,Be.toUnwrapped()),Te&&A.renderDefaultNorthPole&&Dt(X,Ye),Ve&&A.renderDefaultSouthPole&&(it=i.ad.scale(i.ad.create(),it,[1,-1,1]),Dt(X,gt))}}}})(v,x,S,k,D);else{let A=v.context,L=A.gl,z,U,H=v.shadowRenderer,Y=$a(v,v.longestCutoffRange),Z=ge=>{if(U===ge)return;let fe=[];fe.push(Gd[ge]),Y.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),z=v.getOrCreateProgram("terrainRaster",{defines:fe}),U=ge},X=v.colorModeForRenderPass(),Q=new i.ae(L.LEQUAL,i.ae.ReadWrite,v.depthRangeFor3D);ml.update(D);let re=v.transform,oe=Sp(re.zoom,x.exaggeration(),x.sourceCache._source.tileSize),ae=[0,0,0];if(H){let ge=v.style.directionalLight,fe=v.style.ambientLight;ge&&fe&&(ae=Ya(v.style,ge,fe))}{U=-1;let ge=L.TRIANGLES,[fe,ne]=[x.gridIndexBuffer,x.gridSegments];for(let se of k){let le=S.getTile(se),we=i.ag.disabled,Re=x.prevTerrainTileForTile[se.key],me=x.terrainTileForTile[se.key];fu(Re,me)&&ml.newMorphing(se.key,Re,me,D,250),A.activeTexture.set(L.TEXTURE0),le.texture&&le.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);let Le=ml.getMorphValuesForProxy(se.key),Be=Le?1:0,Qe;Le&&(Qe={morphing:{srcDemTile:Le.from,dstDemTile:Le.to,phase:i.b9(Le.phase)}});let Je=xt(se.projMatrix,Zg(se.canonical,re.renderWorldCopies)?oe/10:oe,ae);if(Z(Be),!z)continue;x.setupElevationDraw(le,z,Qe);let Ze=se.toUnwrapped();H&&H.setupShadows(Ze,z),v.uploadCommonUniforms(A,z,Ze,null,Y),z.draw(v,ge,Q,we,X,i.af.backCCW,Je,"terrain_raster",x.gridBuffer,fe,ne)}}}}(h,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;let h=this.painter,g=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],S=this._drapedRenderBatches.shift(),k=h.style.order,D=[],A=0;for(let L of x){let z=v.getTileByID(L.proxyTileKey),U=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][o]:void 0,H=U!==void 0?v.renderCache[U]:this.pool[A++],Y=U!==void 0;if(z.texture=H.tex,Y&&!H.dirty){D.push(z.tileID);continue}let Z;g.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(g.clear({color:i.C.transparent,stencil:0}),H.dirty=!1);for(let X=S.start;X<=S.end;++X){let Q=h.style._mergedLayers[k[X]];if(Q.isHidden(h.transform.zoom))continue;let re=h.style.getLayerSourceCache(Q),oe=re?this.proxyToSource[L.key][re.id]:[L];if(!oe)continue;let ae=oe;g.viewport.set([0,0,H.fb.width,H.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(H,oe,Q,re),Z=re?re.id:null),h.renderLayer(h,re,Q,ae)}if(this._drapedRenderBatches.length===0)for(let X of this._pendingGroundEffectLayers){let Q=h.style._mergedLayers[k[X]];if(Q.isHidden(h.transform.zoom))continue;let re=h.style.getLayerSourceCache(Q),oe=re?this.proxyToSource[L.key][re.id]:[L];if(!oe)continue;let ae=oe;g.viewport.set([0,0,H.fb.width,H.fb.height]),Z!==(re?re.id:null)&&(this._setupStencil(H,oe,Q,re),Z=re?re.id:null),h.renderLayer(h,re,Q,ae)}this.renderedToTile?(H.dirty=!0,D.push(z.tileID)):Y||--A,A===5&&(A=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),S.end+1}postRender(){}isLayerOrderingCorrect(o){let h=o.order.length,g=-1,v=h;for(let x=0;x<h;++x)this._style.isLayerDraped(o._mergedLayers[o.order[x]])?g=Math.max(g,x):v=Math.min(v,x);return v>g}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{o=Math.min(o,h.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,h,g){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let S=x.tileID,k=1<<S.overscaledZ,{x:D,y:A}=S.canonical,L=D/k,z=(D+1)/k,U=A/k,H=(A+1)/k;return{minx:L,miny:U,maxx:z,maxy:H,t:x.dem.tree.raycastRoot(L,U,z,H,o,h,g),tile:x}});v.sort((x,S)=>(x.t!==null?x.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let S=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,o,h,g);if(S!=null)return S}return null}_createFBO(){let o=this.painter.context,h=o.gl,g=this.drapeBufferSize;o.activeTexture.set(h.TEXTURE0);let v=new i.T(o,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);let x=o.createFramebuffer(g[0],g[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new ol(o,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{let h=this._style._mergedLayers[o],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(let g of this._style.getSources())if(g instanceof du){o=!0;break}if(!o)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(x&&!h[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof i.Z){h[x.id]=!0;for(let S of this.proxyCoords){let k=this.proxyToSource[S.key][x.id];if(k)for(let D of k)this._clearRenderCacheForTile(x.id,D)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(let g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof Nd){o=!0;break}if(!o)return;let h={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],x=this._style.getLayerSourceCache(v);if(!x||h[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let S=v.paint.get("raster-fade-duration");for(let k of this.proxyCoords){let D=this.proxyToSource[k.key][x.id];if(D)for(let A of D){let L=_u(x.getTile(A),x.findLoadedParent(A,0),x,this.painter.transform,S);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(x.id,A)}}}}_setupDrapedRenderBatches(){let o=this._style.order,h=o.length;if(h===0)return;let g=[];this._pendingGroundEffectLayers=[];let v,x=0,S=this._style._mergedLayers[o[x]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++x<h;)S=this._style._mergedLayers[o[x]];for(;x<h;++x){let k=this._style._mergedLayers[o[x]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?v===void 0&&(v=x):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(g.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:x-1}),g.length!==0){let k=g[g.length-1];this._pendingGroundEffectLayers.every(D=>D>k.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(o){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let S=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let k=0;k<S.length;++k){let D=Object.values(S[k]);h.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();let g=this.proxyCoords,v=this._tilesDirty;for(let S=g.length-1;S>=0;S--){let k=g[S];if(h.getTileByID(k.key),h.proxyCachedFBO[k.key]!==void 0){let D=o[k.key],A=this.proxyToSource[k.key],L=0;for(let z in A){let U=A[z],H=D[z];if(!H||H.length!==U.length||U.some((Y,Z)=>Y!==H[Z]||v[z]&&v[z].hasOwnProperty(Y.key))){L=-1;break}++L}for(let z in h.proxyCachedFBO[k.key])h.renderCache[h.proxyCachedFBO[k.key][z]].dirty=L<0||L!==Object.values(D).length}}let x=[...this._drapedRenderBatches];x.sort((S,k)=>k.end-k.start-(S.end-S.start));for(let S of x)for(let k of g){if(h.proxyCachedFBO[k.key])continue;let D=h.renderCachePool.pop();D===void 0&&h.renderCache.length<50&&(D=h.renderCache.length,h.renderCache.push(this._createFBO())),D!==void 0&&(h.proxyCachedFBO[k.key]={},h.proxyCachedFBO[k.key][S.start]=D,h.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(o,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,S=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let k;if(g.isTileClipped())k=h.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):i.ag.disabled}_renderTileClippingMasks(o,h){let g=this.painter,v=this.painter.context,x=v.gl;g._tileClippingMaskIDs={},v.setColorMode(i.a.disabled),v.setDepthMode(i.ae.disabled);let S=g.getOrCreateProgram("clippingMask");for(let k of o){let D=g._tileClippingMaskIDs[k.key]=--h;S.draw(g,x.TRIANGLES,i.ae.disabled,new i.ag({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),i.a.disabled,i.af.disabled,gu(k.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){let h=this.painter.transform;if(o.x<0||o.x>h.width||o.y<0||o.y>h.height)return null;let g=[o.x,o.y,1,1];i.aA.transformMat4(g,g,h.pixelMatrixInverse),i.aA.scale(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;let v=h._camera.position,x=i.ax(1,h.center.lat),S=[v[0],v[1],v[2]/x,0],k=i._.subtract([],g.slice(0,3),S);i._.normalize(k,k);let D=this.raycast(S,k,this._exaggeration);return D!==null&&D?(i._.scaleAndAdd(S,S,k,D),S[3]=S[2],S[2]*=x,S):null}drawDepth(){let o=this.painter,h=o.context,g=this.proxySourceCache,v=Math.ceil(o.width),x=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let S=h.gl,k=h.createFramebuffer(v,x,!0,"renderbuffer");h.activeTexture.set(S.TEXTURE0);let D=new i.T(h,{width:v,height:x,data:null},S.RGBA);D.bind(S.NEAREST,S.CLAMP_TO_EDGE),k.colorAttachment.set(D.texture);let A=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,x);k.depthAttachment.set(A),this._depthFBO=k,this._depthTexture=D}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,x]),function(S,k,D,A){if(S.transform.projection.name==="globe")return;let L=S.context,z=L.gl;L.clear({depth:1});let U=S.getOrCreateProgram("terrainDepth"),H=new i.ae(z.LESS,i.ae.ReadWrite,S.depthRangeFor3D);for(let Y of A){let Z=D.getTile(Y),X=xt(Y.projMatrix,0,[0,0,0]);k.setupElevationDraw(Z,U),U.draw(S,z.TRIANGLES,H,i.ag.disabled,i.a.unblended,i.af.backCCW,X,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,h,g){if(o.getSource()instanceof i.bm)return this._setupProxiedCoordsForImageSource(o,h,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};let v=this.proxiedCoords[o.id]=[],x=this.proxyCoords;for(let D=0;D<x.length;D++){let A=x[D],L=this._findTileCoveringTileID(A,o);if(L){let z=this._createProxiedId(A,L,g[A.key]&&g[A.key][o.id]);v.push(z),this.proxyToSource[A.key][o.id]=[z]}}let S=!1,k=new Set;for(let D=0;D<h.length;D++){let A=o.getTile(h[D]);if(!A||!A.hasData())continue;let L=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==A.tileID.canonical.z){let z=this.proxyToSource[L.tileID.key][o.id],U=this._createProxiedId(L.tileID,A,g[L.tileID.key]&&g[L.tileID.key][o.id]);z?z.splice(z.length-1,0,U):this.proxyToSource[L.tileID.key][o.id]=[U];let H=this.proxyToSource[L.tileID.key][o.id];k.has(H)||k.add(H),v.push(U),S=!0}}if(this._sourceTilesOverlap[o.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(let D of k)D.sort((A,L)=>L.overscaledZ-A.overscaledZ)}_setupProxiedCoordsForImageSource(o,h,g){if(!o.getSource().loaded())return;let v=this.proxiedCoords[o.id]=[],x=this.proxyCoords,S=o.getSource(),k=S.tileID;if(!k)return;let D=new i.P(k.x,k.y)._div(1<<k.z),A=S.coordinates.map(i.Y.fromLngLat).reduce((z,U)=>(z.min.x=Math.min(z.min.x,U.x-D.x),z.min.y=Math.min(z.min.y,U.y-D.y),z.max.x=Math.max(z.max.x,U.x-D.x),z.max.y=Math.max(z.max.y,U.y-D.y),z),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(z,U)=>{let H=z.wrap+z.canonical.x/(1<<z.canonical.z),Y=z.canonical.y/(1<<z.canonical.z),Z=i.a3/(1<<z.canonical.z),X=U.wrap+U.canonical.x/(1<<U.canonical.z),Q=U.canonical.y/(1<<U.canonical.z);return H+Z<X+A.min.x||H>X+A.max.x||Y+Z<Q+A.min.y||Y>Q+A.max.y};for(let z=0;z<x.length;z++){let U=x[z];for(let H=0;H<h.length;H++){let Y=o.getTile(h[H]);if(!Y||!Y.hasData()||L(U,Y.tileID))continue;let Z=this._createProxiedId(U,Y,g[U.key]&&g[U.key][o.id]),X=this.proxyToSource[U.key][o.id];X?X.push(Z):this.proxyToSource[U.key][o.id]=[Z],v.push(Z)}}}_createProxiedId(o,h,g){let v=this.orthoMatrix;if(g){let x=g.find(S=>S.key===h.tileID.key);if(x)return x}if(h.tileID.key!==o.key){let x=o.canonical.z-h.tileID.canonical.z,S,k,D;v=i.ad.create();let A=h.tileID.wrap-o.wrap<<o.overscaledZ;x>0?(S=i.a3>>x,k=S*((h.tileID.canonical.x<<x)-o.canonical.x+A),D=S*((h.tileID.canonical.y<<x)-o.canonical.y)):(S=i.a3<<-x,k=i.a3*(h.tileID.canonical.x-(o.canonical.x+A<<-x)),D=i.a3*(h.tileID.canonical.y-(o.canonical.y<<-x))),i.ad.ortho(v,0,S,0,S,0,1),i.ad.translate(v,v,[k,D,0])}return new kp(h.tileID,o.key,v)}_findTileCoveringTileID(o,h){let g=h.getTile(o);if(g&&g.hasData())return g;let v=this._findCoveringTileCache[h.id],x=v[o.key];if(g=x?h.getTileByID(x):null,g&&g.hasData()||x===null)return g;let S=g?g.tileID:o,k=S.overscaledZ,D=h.getSource().minzoom,A=[];if(!x){let z=h.getSource().maxzoom;if(o.canonical.z>=z){let U=o.canonical.z-z;h.getSource().reparseOverscaled?(k=Math.max(o.canonical.z+2,h.transform.tileZoom),S=new i.aL(k,o.wrap,z,o.canonical.x>>U,o.canonical.y>>U)):U!==0&&(k=z,S=new i.aL(k,o.wrap,z,o.canonical.x>>U,o.canonical.y>>U))}S.key!==o.key&&(A.push(S.key),g=h.getTile(S))}let L=z=>{A.forEach(U=>{v[U]=z}),A.length=0};for(k-=1;k>=D&&(!g||!g.hasData());k--){g&&L(g.tileID.key);let z=S.calculateScaledKey(k);if(g=h.getTileByID(z),g&&g.hasData())break;let U=v[z];if(U===null)break;U===void 0?A.push(z):g=h.getTileByID(U)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,h){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[h.key]=!0}}function Za(f,o,h){let g=function(k,D,A){let L=i._.dot(D,k),z=i._.dot(A,[.2126,.7152,.0722]),U=(Y,Z,X)=>(1-X)*Y+X*Z,H=U(1-.3*Math.min(z,1),1,Math.min(L+1,1));return U(.92,1,Math.asin(i.at(D[2],-1,1))/Math.PI+.5)*H}(f,[0,0,1],o),v=[0,0,0];i._.scale(v,h.slice(0,3),g);let x=[0,0,0];i._.scale(x,o.slice(0,3),f[2]);let S=[0,0,0];return i._.add(S,v,x),i.b8(S)}let yu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Qg=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class qd{static cacheKey(o,h,g,v){let x=`${h}${v?v.cacheKey:""}`;for(let S of g)o.usedDefines.includes(S)&&(x+=`/${S}`);return x}constructor(o,h,g,v,x,S){let k=o.gl;this.program=k.createProgram(),this.configuration=v,this.name=h,this.fixedDefines=[...S];let D=v?v.getBinderAttributes():[],A=(g.staticAttributes||[]).concat(D),L=v?v.defines():[];L=L.concat(S.map(X=>`#define ${X}`));let z=`#version 300 es
`,U=z+L.concat("precision mediump float;",Gg,Wg.fragmentSource).join(`
`);for(let X of g.fragmentIncludes)U+=`
${lu[X]}`;U+=`
${g.fragmentSource}`;let H=z+L.concat("precision highp float;",Gg,Wg.vertexSource).join(`
`);for(let X of g.vertexIncludes)H+=`
${lu[X]}`;H+=`
${g.vertexSource}`;let Y=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(Y,U),k.compileShader(Y),k.attachShader(this.program,Y);let Z=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(Z,H),k.compileShader(Z),k.attachShader(this.program,Z),this.attributes={},this.numAttributes=A.length;for(let X=0;X<this.numAttributes;X++)if(A[X]){let Q=A[X].startsWith("a_")?A[X]:`a_${A[X]}`;k.bindAttribLocation(this.program,X,Q),this.attributes[Q]=X}k.linkProgram(this.program),k.deleteShader(Z),k.deleteShader(Y),this.fixedUniforms=x(o),this.binderUniforms=v?v.getUniforms(o):[],S.includes("TERRAIN")&&(this.terrainUniforms=(X=>({u_dem:new i.a7(X),u_dem_prev:new i.a7(X),u_dem_tl:new i.a8(X),u_dem_scale:new i.aa(X),u_dem_tl_prev:new i.a8(X),u_dem_scale_prev:new i.aa(X),u_dem_size:new i.aa(X),u_dem_lerp:new i.aa(X),u_exaggeration:new i.aa(X),u_depth:new i.a7(X),u_depth_size_inv:new i.a8(X),u_meter_to_dem:new i.aa(X),u_label_plane_matrix_inv:new i.a6(X)}))(o)),S.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new i.aq(X),u_tile_tr_up:new i.aq(X),u_tile_br_up:new i.aq(X),u_tile_bl_up:new i.aq(X),u_tile_up_scale:new i.aa(X)}))(o)),S.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new i.a6(X),u_fog_range:new i.a8(X),u_fog_color:new i.as(X),u_fog_horizon_blend:new i.aa(X),u_fog_vertical_limit:new i.a8(X),u_fog_temporal_offset:new i.aa(X),u_frustum_tl:new i.aq(X),u_frustum_tr:new i.aq(X),u_frustum_br:new i.aq(X),u_frustum_bl:new i.aq(X),u_globe_pos:new i.aq(X),u_globe_radius:new i.aa(X),u_globe_transition:new i.aa(X),u_is_globe:new i.a7(X),u_viewport:new i.a8(X)}))(o)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new i.as(X)}))(o)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new i.aq(X),u_lighting_directional_dir:new i.aq(X),u_lighting_directional_color:new i.aq(X),u_ground_radiance:new i.aq(X)}))(o)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new i.a6(X),u_light_matrix_1:new i.a6(X),u_fade_range:new i.a8(X),u_shadow_normal_offset:new i.aq(X),u_shadow_intensity:new i.aa(X),u_shadow_texel_size:new i.aa(X),u_shadow_map_resolution:new i.aa(X),u_shadow_direction:new i.aq(X),u_shadow_bias:new i.aq(X),u_shadowmap_0:new i.a7(X),u_shadowmap_1:new i.a7(X)}))(o))}}setTerrainUniformValues(o,h){if(!this.terrainUniforms)return;let g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(o,h){if(!this.globeUniforms)return;let g=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(o,h){if(!this.fogUniforms)return;let g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setCutoffUniformValues(o,h){if(!this.cutoffUniforms)return;let g=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setLightsUniformValues(o,h){if(!this.lightsUniforms)return;let g=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}}setShadowUniformValues(o,h){if(this.failedToCreate||!this.shadowUniforms)return;let g=this.shadowUniforms;o.program.set(this.program);for(let v in h)g[v].set(this.program,v,h[v])}_drawDebugWireframe(o,h,g,v,x,S,k,D,A,L){let z=o.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;let U=o.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||o._terrain&&o._terrain.renderingToTexture||!yu.includes(this.name))||!(!z.layers3D||!Qg.includes(this.name))))return;let H=U.gl,Y=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,x,U);if(!Y)return;let Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");let X=o.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});U.program.set(X.program);let Q=(ae,ge,fe)=>{if(ge[ae]&&fe[ae])for(let ne in ge[ae])fe[ae][ne]&&fe[ae][ne].set(fe.program,ne,ge[ae][ne].current)};A&&A.setUniforms(X.program,U,X.binderUniforms,k,{zoom:D}),Q("fixedUniforms",this,X),Q("terrainUniforms",this,X),Q("globeUniforms",this,X),Q("fogUniforms",this,X),Q("lightsUniforms",this,X),Q("shadowUniforms",this,X),Y.bind(),U.setColorMode(new i.a([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],i.C.transparent,[!0,!0,!0,!1])),U.setDepthMode(new i.ae(h.func===H.LESS?H.LEQUAL:h.func,i.ae.ReadOnly,h.range)),U.setStencilMode(i.ag.disabled);let re=3*S.primitiveLength*2,oe=3*S.primitiveOffset*2*2;L&&L>1?H.drawElementsInstanced(H.LINES,re,H.UNSIGNED_SHORT,oe,L):H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,oe),x.bind(),U.program.set(this.program),U.setDepthMode(h),U.setStencilMode(g),U.setColorMode(v)}draw(o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X){let Q=o.context,re=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(g),Q.setStencilMode(v),Q.setColorMode(x),Q.setCullFace(S);for(let ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,k[ge]);Y&&Y.setUniforms(this.program,Q,this.binderUniforms,U,{zoom:H});let oe={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[h],ae=X&&X>0?1:void 0;for(let ge of z.get()){let fe=ge.vaos||(ge.vaos={});(fe[D]||(fe[D]=new Iy)).bind(Q,this,A,Y?Y.getPaintVertexBuffers():[],L,ge.vertexOffset,Z||[],ae),X&&X>1?re.drawElementsInstanced(h,ge.primitiveLength*oe,re.UNSIGNED_SHORT,ge.primitiveOffset*oe*2,X):L?re.drawElements(h,ge.primitiveLength*oe,re.UNSIGNED_SHORT,ge.primitiveOffset*oe*2):re.drawArrays(h,ge.vertexOffset,ge.vertexLength),h===re.TRIANGLES&&L&&this._drawDebugWireframe(o,g,v,x,L,ge,U,H,Y,X)}}}function vu(f,o){let h=Math.pow(2,o.tileID.overscaledZ),g=o.tileSize*Math.pow(2,f.transform.tileZoom)/h,v=g*(o.tileID.canonical.x+o.tileID.wrap*h),x=g*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.bB(o,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}let xu=i.ad.create(),yc=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z)=>{let X=o.style.light,Q=X.properties.get("position"),re=[Q.x,Q.y,Q.z],oe=i.bC.create();X.properties.get("anchor")==="viewport"&&(i.bC.fromRotation(oe,-o.transform.angle),i._.transformMat3(re,re,oe));let ae=X.properties.get("color"),ge=o.transform,fe={u_matrix:f,u_lightpos:re,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x,u_flood_light_color:z,u_vertical_scale:U,u_flood_light_intensity:H,u_ground_shadow_factor:Y,u_emissive_strength:Z};return ge.projection.name==="globe"&&(fe.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],fe.u_zoom_transition=D,fe.u_inv_rot_matrix=L,fe.u_merc_center=A,fe.u_up_dir=ge.projection.upVector(new i.aO(0,0,0),A[0]*i.a3,A[1]*i.a3),fe.u_height_lift=k),fe},vc=(f,o,h)=>({u_matrix:f,u_edge_radius:o,u_vertical_scale:h}),Tp=(f,o,h,g,v,x,S,k,D,A,L,z,U,H)=>{let Y=yc(f,o,h,g,v,x,S,D,A,L,z,U,H,1,[0,0,0],0),Z={u_height_factor:-Math.pow(2,S.overscaledZ)/k.tileSize/8};return i.W(Y,vu(o,k),Z)},Ep=(f,o)=>({u_matrix:f,u_emissive_strength:o}),Dp=(f,o,h,g)=>i.W(Ep(f,o),vu(h,g)),Kg=(f,o,h)=>({u_matrix:f,u_world:h,u_emissive_strength:o}),wu=(f,o,h,g,v)=>i.W(Dp(f,o,h,g),{u_world:v}),Ap=(f,o,h,g)=>{let v=i.a3/h.tileSize;return{u_matrix:f,u_camera_to_center_distance:o.getCameraToCenterDistance(g),u_extrude_scale:[o.pixelsToGLUnits[0]/v,o.pixelsToGLUnits[1]/v]}},Cu=(f,o,h=1)=>({u_matrix:f,u_color:o.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),$d=i.ad.create(),pl=(f,o,h,g,v,x,S)=>{let k=f.transform,D=k.projection.name==="globe",A=D?i.bD(k.zoom,o.canonical)*k._pixelsPerMercatorPixel:i.bB(h,1,x),L={u_matrix:o.projMatrix,u_extrude_scale:A,u_intensity:S,u_inv_rot_matrix:$d,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){L.u_inv_rot_matrix=g,L.u_merc_center=v,L.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],L.u_zoom_transition=i.a1(k.zoom);let z=v[0]*i.a3,U=v[1]*i.a3;L.u_up_dir=k.projection.upVector(new i.aO(0,0,0),z,U)}return L};function Jg(f,[o,h,g,v],[x,S]){if(x===S)return[0,0,0,0];let k=255*(f-1)/(f*(S-x));return[o*k,h*k,g*k,v*k]}function Pp(f,o,[h,g]){return h===g?0:.5/f+(o-h)*(f-1)/(f*(g-h))}let Yd=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q,re,oe,ae)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:i.bE(z.paint.get("raster-saturation")),u_contrast_factor:i.bF(z.paint.get("raster-contrast")),u_spin_weights:Zd(z.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:H,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:D,u_colorization_mix:Jg(i.bG,Z,Q),u_colorization_offset:Pp(i.bG,X,Q),u_color_ramp:Y,u_texture_offset:[oe/(re+2*oe),re/(re+2*oe)],u_texture_res:[re+2*oe,re+2*oe],u_emissive_strength:ae});function Zd(f){f*=Math.PI/180;let o=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}let Es=.15,Op=(f,o,h,g,v,x,S,k,D,A,L,z)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:A,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:D}),Rp=(f,o,h,g,v,x,S,k,D,A)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_tile_offset:h,u_velocity:g,u_color_ramp:x,u_velocity_res:v,u_max_speed:S,u_uv_offset:k,u_data_scale:D,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Es,Es]}),Ay=(f,o,h,g,v,x,S,k,D,A)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_velocity:h,u_velocity_res:g,u_max_speed:v,u_speed_factor:x,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:D,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Es,Es]}),aa=i.ad.create(),xc=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q)=>{let re=v.transform,oe={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:re.getCameraToCenterDistance(Z),u_rotate_symbol:+h,u_aspect_ratio:re.width/re.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+D,u_pitch_with_map:+g,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:aa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:aa,u_up_vector:[0,-1,0],u_color_adj_mat:X,u_icon_transition:Q||0};return Z.name==="globe"&&(oe.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],oe.u_zoom_transition=z,oe.u_inv_rot_matrix=H,oe.u_merc_center=U,oe.u_camera_forward=re._camera.forward(),oe.u_ecef_origin=i.bH(re.globeMatrix,L.toUnwrapped()),oe.u_tile_matrix=Float32Array.from(re.globeMatrix),oe.u_up_vector=Y),oe},Su=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X)=>i.W(xc(f,o,h,g,v,x,S,k,D,A,z,U,H,Y,Z,X),{u_gamma_scale:g?v.transform.getCameraToCenterDistance(X)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:i.e.devicePixelRatio,u_is_halo:+L,undefined:void 0}),e_=(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z)=>i.W(Su(f,o,h,g,v,x,S,k,!0,D,!0,L,z,U,H,Y,Z),{u_texsize_icon:A,u_texture_icon:1}),Xd=(f,o,h,g)=>({u_matrix:f,u_emissive_strength:o,u_opacity:h,u_color:g}),t_=(f,o,h,g,v,x,S,k)=>i.W(function(D,A,L,z,U){let{width:H,height:Y}=z.imageManager.getPixelSize(A),Z=Math.pow(2,U.tileID.overscaledZ),X=U.tileSize*Math.pow(2,z.transform.tileZoom)/Z,Q=X*(U.tileID.canonical.x+U.tileID.wrap*Z),re=X*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[H,Y],u_pattern_size:L.displaySize,u_tile_units_to_pixels:1/i.bB(U,1,z.transform.tileZoom),u_pixel_coord_upper:[Q>>16,re>>16],u_pixel_coord_lower:[65535&Q,65535&re]}}(0,x,S,g,k),{u_matrix:f,u_emissive_strength:o,u_opacity:h}),Lp=new Float32Array(i.ad.identity([])),Qd=(f,o,h,g,v,x,S,k,D,A,L,z,U,H=[0,0,0],Y)=>{let Z=v.style.light,X=Z.properties.get("position"),Q=[-X.x,-X.y,X.z],re=i.bC.create();Z.properties.get("anchor")==="viewport"&&(i.bC.fromRotation(re,-v.transform.angle),i._.transformMat3(Q,Q,re));let oe=L.alphaMode==="MASK",ae=Z.properties.get("color").toRenderColor(null),ge=U.paint.get("model-ambient-occlusion-intensity"),fe=U.paint.get("model-color").constantOr(i.C.white).toRenderColor(null),ne=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:o,u_normal_matrix:h,u_node_matrix:g||Lp,u_lightpos:Q,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_camera_pos:H,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+oe,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:D,u_roughnessFactor:A,u_baseColorTexture:Xr.BaseColor,u_metallicRoughnessTexture:Xr.MetallicRoughness,u_normalTexture:Xr.Normal,u_occlusionTexture:Xr.Occlusion,u_emissionTexture:Xr.Emission,u_lutTexture:Xr.LUT,u_color_mix:[fe.r,fe.g,fe.b,ne],u_aoIntensity:ge,u_emissive_strength:z,u_occlusionTextureTransform:Y||[0,0,0,0]}},i_=(f,o=Lp,h=Lp)=>({u_matrix:f,u_instance:o,u_node_matrix:h}),n_=(f,o,h,g,v)=>({u_matrix:Float32Array.from(f),u_anchorPos:o,u_screenSizePx:h,u_occluderSizePx:g,u_color:v}),Py={fillExtrusion:f=>({u_matrix:new i.a6(f),u_lightpos:new i.aq(f),u_lightintensity:new i.aa(f),u_lightcolor:new i.aq(f),u_vertical_gradient:new i.aa(f),u_opacity:new i.aa(f),u_edge_radius:new i.aa(f),u_ao:new i.a8(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_up_dir:new i.aq(f),u_height_lift:new i.aa(f),u_flood_light_color:new i.aq(f),u_vertical_scale:new i.aa(f),u_flood_light_intensity:new i.aa(f),u_ground_shadow_factor:new i.aq(f),u_emissive_strength:new i.aa(f)}),fillExtrusionDepth:f=>({u_matrix:new i.a6(f),u_edge_radius:new i.aa(f),u_vertical_scale:new i.aa(f)}),fillExtrusionPattern:f=>({u_matrix:new i.a6(f),u_lightpos:new i.aq(f),u_lightintensity:new i.aa(f),u_lightcolor:new i.aq(f),u_vertical_gradient:new i.aa(f),u_height_factor:new i.aa(f),u_edge_radius:new i.aa(f),u_ao:new i.a8(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_up_dir:new i.aq(f),u_height_lift:new i.aa(f),u_image:new i.a7(f),u_texsize:new i.a8(f),u_pixel_coord_upper:new i.a8(f),u_pixel_coord_lower:new i.a8(f),u_tile_units_to_pixels:new i.aa(f),u_opacity:new i.aa(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new i.a6(f),u_opacity:new i.aa(f),u_ao_pass:new i.aa(f),u_meter_to_tile:new i.aa(f),u_ao:new i.a8(f),u_flood_light_intensity:new i.aa(f),u_flood_light_color:new i.aq(f),u_attenuation:new i.aa(f),u_edge_radius:new i.aa(f),u_fb:new i.a7(f),u_fb_size:new i.aa(f)}),fill:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f)}),fillPattern:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_image:new i.a7(f),u_texsize:new i.a8(f),u_pixel_coord_upper:new i.a8(f),u_pixel_coord_lower:new i.a8(f),u_tile_units_to_pixels:new i.aa(f)}),fillOutline:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_world:new i.a8(f)}),fillOutlinePattern:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_world:new i.a8(f),u_image:new i.a7(f),u_texsize:new i.a8(f),u_pixel_coord_upper:new i.a8(f),u_pixel_coord_lower:new i.a8(f),u_tile_units_to_pixels:new i.aa(f)}),circle:i.bI,collisionBox:f=>({u_matrix:new i.a6(f),u_camera_to_center_distance:new i.aa(f),u_extrude_scale:new i.a8(f)}),collisionCircle:f=>({u_matrix:new i.a6(f),u_inv_matrix:new i.a6(f),u_camera_to_center_distance:new i.aa(f),u_viewport_size:new i.a8(f)}),debug:f=>({u_color:new i.a9(f),u_matrix:new i.a6(f),u_overlay:new i.a7(f),u_overlay_scale:new i.aa(f)}),clippingMask:f=>({u_matrix:new i.a6(f)}),heatmap:f=>({u_extrude_scale:new i.aa(f),u_intensity:new i.aa(f),u_matrix:new i.a6(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_up_dir:new i.aq(f)}),heatmapTexture:f=>({u_image:new i.a7(f),u_color_ramp:new i.a7(f),u_opacity:new i.aa(f)}),hillshade:f=>({u_matrix:new i.a6(f),u_image:new i.a7(f),u_latrange:new i.a8(f),u_light:new i.a8(f),u_shadow:new i.a9(f),u_highlight:new i.a9(f),u_emissive_strength:new i.aa(f),u_accent:new i.a9(f)}),hillshadePrepare:f=>({u_matrix:new i.a6(f),u_image:new i.a7(f),u_dimension:new i.a8(f),u_zoom:new i.aa(f)}),line:i.bJ,linePattern:i.bK,raster:f=>({u_matrix:new i.a6(f),u_normalize_matrix:new i.a6(f),u_globe_matrix:new i.a6(f),u_merc_matrix:new i.a6(f),u_grid_matrix:new i.ar(f),u_tl_parent:new i.a8(f),u_scale_parent:new i.aa(f),u_fade_t:new i.aa(f),u_opacity:new i.aa(f),u_image0:new i.a7(f),u_image1:new i.a7(f),u_brightness_low:new i.aa(f),u_brightness_high:new i.aa(f),u_saturation_factor:new i.aa(f),u_contrast_factor:new i.aa(f),u_spin_weights:new i.aq(f),u_perspective_transform:new i.a8(f),u_raster_elevation:new i.aa(f),u_zoom_transition:new i.aa(f),u_merc_center:new i.a8(f),u_cutoff_params:new i.as(f),u_colorization_mix:new i.as(f),u_colorization_offset:new i.aa(f),u_color_ramp:new i.a7(f),u_texture_offset:new i.a8(f),u_texture_res:new i.a8(f),u_emissive_strength:new i.aa(f)}),rasterParticle:f=>({u_matrix:new i.a6(f),u_normalize_matrix:new i.a6(f),u_globe_matrix:new i.a6(f),u_merc_matrix:new i.a6(f),u_grid_matrix:new i.ar(f),u_tl_parent:new i.a8(f),u_scale_parent:new i.aa(f),u_fade_t:new i.aa(f),u_opacity:new i.aa(f),u_image0:new i.a7(f),u_image1:new i.a7(f),u_raster_elevation:new i.aa(f),u_zoom_transition:new i.aa(f),u_merc_center:new i.a8(f),u_cutoff_params:new i.as(f)}),rasterParticleTexture:f=>({u_texture:new i.a7(f),u_opacity:new i.aa(f)}),rasterParticleDraw:f=>({u_particle_texture:new i.a7(f),u_particle_texture_side_len:new i.aa(f),u_tile_offset:new i.a8(f),u_velocity:new i.a7(f),u_color_ramp:new i.a7(f),u_velocity_res:new i.a8(f),u_max_speed:new i.aa(f),u_uv_offset:new i.a8(f),u_data_scale:new i.as(f),u_data_offset:new i.aa(f),u_particle_pos_scale:new i.aa(f),u_particle_pos_offset:new i.a8(f)}),rasterParticleUpdate:f=>({u_particle_texture:new i.a7(f),u_particle_texture_side_len:new i.aa(f),u_velocity:new i.a7(f),u_velocity_res:new i.a8(f),u_max_speed:new i.aa(f),u_speed_factor:new i.aa(f),u_reset_rate:new i.aa(f),u_rand_seed:new i.aa(f),u_uv_offset:new i.a8(f),u_data_scale:new i.as(f),u_data_offset:new i.aa(f),u_particle_pos_scale:new i.aa(f),u_particle_pos_offset:new i.a8(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new i.a7(f),u_is_size_feature_constant:new i.a7(f),u_size_t:new i.aa(f),u_size:new i.aa(f),u_camera_to_center_distance:new i.aa(f),u_rotate_symbol:new i.a7(f),u_aspect_ratio:new i.aa(f),u_fade_change:new i.aa(f),u_matrix:new i.a6(f),u_label_plane_matrix:new i.a6(f),u_coord_matrix:new i.a6(f),u_is_text:new i.a7(f),u_pitch_with_map:new i.a7(f),u_texsize:new i.a8(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_camera_forward:new i.aq(f),u_tile_matrix:new i.a6(f),u_up_vector:new i.aq(f),u_ecef_origin:new i.aq(f),u_texture:new i.a7(f),u_icon_transition:new i.aa(f),u_color_adj_mat:new i.a6(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new i.a7(f),u_is_size_feature_constant:new i.a7(f),u_size_t:new i.aa(f),u_size:new i.aa(f),u_camera_to_center_distance:new i.aa(f),u_rotate_symbol:new i.a7(f),u_aspect_ratio:new i.aa(f),u_fade_change:new i.aa(f),u_matrix:new i.a6(f),u_label_plane_matrix:new i.a6(f),u_coord_matrix:new i.a6(f),u_is_text:new i.a7(f),u_pitch_with_map:new i.a7(f),u_texsize:new i.a8(f),u_texture:new i.a7(f),u_gamma_scale:new i.aa(f),u_device_pixel_ratio:new i.aa(f),u_tile_id:new i.aq(f),u_zoom_transition:new i.aa(f),u_inv_rot_matrix:new i.a6(f),u_merc_center:new i.a8(f),u_camera_forward:new i.aq(f),u_tile_matrix:new i.a6(f),u_up_vector:new i.aq(f),u_ecef_origin:new i.aq(f),u_is_halo:new i.a7(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new i.a7(f),u_is_size_feature_constant:new i.a7(f),u_size_t:new i.aa(f),u_size:new i.aa(f),u_camera_to_center_distance:new i.aa(f),u_rotate_symbol:new i.a7(f),u_aspect_ratio:new i.aa(f),u_fade_change:new i.aa(f),u_matrix:new i.a6(f),u_label_plane_matrix:new i.a6(f),u_coord_matrix:new i.a6(f),u_is_text:new i.a7(f),u_pitch_with_map:new i.a7(f),u_texsize:new i.a8(f),u_texsize_icon:new i.a8(f),u_texture:new i.a7(f),u_texture_icon:new i.a7(f),u_gamma_scale:new i.aa(f),u_device_pixel_ratio:new i.aa(f),u_is_halo:new i.a7(f)}),background:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_opacity:new i.aa(f),u_color:new i.a9(f)}),backgroundPattern:f=>({u_matrix:new i.a6(f),u_emissive_strength:new i.aa(f),u_opacity:new i.aa(f),u_image:new i.a7(f),u_pattern_tl:new i.a8(f),u_pattern_br:new i.a8(f),u_texsize:new i.a8(f),u_pattern_size:new i.a8(f),u_pixel_coord_upper:new i.a8(f),u_pixel_coord_lower:new i.a8(f),u_tile_units_to_pixels:new i.aa(f)}),terrainRaster:cl,terrainDepth:cl,skybox:f=>({u_matrix:new i.a6(f),u_sun_direction:new i.aq(f),u_cubemap:new i.a7(f),u_opacity:new i.aa(f),u_temporal_offset:new i.aa(f)}),skyboxGradient:f=>({u_matrix:new i.a6(f),u_color_ramp:new i.a7(f),u_center_direction:new i.aq(f),u_radius:new i.aa(f),u_opacity:new i.aa(f),u_temporal_offset:new i.aa(f)}),skyboxCapture:f=>({u_matrix_3f:new i.ar(f),u_sun_direction:new i.aq(f),u_sun_intensity:new i.aa(f),u_color_tint_r:new i.as(f),u_color_tint_m:new i.as(f),u_luminance:new i.aa(f)}),globeRaster:f=>({u_proj_matrix:new i.a6(f),u_globe_matrix:new i.a6(f),u_normalize_matrix:new i.a6(f),u_merc_matrix:new i.a6(f),u_zoom_transition:new i.aa(f),u_merc_center:new i.a8(f),u_image0:new i.a7(f),u_grid_matrix:new i.ar(f),u_skirt_height:new i.aa(f),u_far_z_cutoff:new i.aa(f),u_frustum_tl:new i.aq(f),u_frustum_tr:new i.aq(f),u_frustum_br:new i.aq(f),u_frustum_bl:new i.aq(f),u_globe_pos:new i.aq(f),u_globe_radius:new i.aa(f),u_viewport:new i.a8(f)}),globeAtmosphere:f=>({u_frustum_tl:new i.aq(f),u_frustum_tr:new i.aq(f),u_frustum_br:new i.aq(f),u_frustum_bl:new i.aq(f),u_horizon:new i.aa(f),u_transition:new i.aa(f),u_fadeout_range:new i.aa(f),u_color:new i.as(f),u_high_color:new i.as(f),u_space_color:new i.as(f),u_temporal_offset:new i.aa(f),u_horizon_angle:new i.aa(f)}),model:f=>({u_matrix:new i.a6(f),u_lighting_matrix:new i.a6(f),u_normal_matrix:new i.a6(f),u_node_matrix:new i.a6(f),u_lightpos:new i.aq(f),u_lightintensity:new i.aa(f),u_lightcolor:new i.aq(f),u_camera_pos:new i.aq(f),u_opacity:new i.aa(f),u_baseColorFactor:new i.as(f),u_emissiveFactor:new i.as(f),u_metallicFactor:new i.aa(f),u_roughnessFactor:new i.aa(f),u_baseTextureIsAlpha:new i.a7(f),u_alphaMask:new i.a7(f),u_alphaCutoff:new i.aa(f),u_baseColorTexture:new i.a7(f),u_metallicRoughnessTexture:new i.a7(f),u_normalTexture:new i.a7(f),u_occlusionTexture:new i.a7(f),u_emissionTexture:new i.a7(f),u_lutTexture:new i.a7(f),u_color_mix:new i.as(f),u_aoIntensity:new i.aa(f),u_emissive_strength:new i.aa(f),u_occlusionTextureTransform:new i.as(f)}),modelDepth:f=>({u_matrix:new i.a6(f),u_instance:new i.a6(f),u_node_matrix:new i.a6(f)}),groundShadow:f=>({u_matrix:new i.a6(f),u_ground_shadow_factor:new i.aq(f)}),stars:f=>({u_matrix:new i.a6(f),u_up:new i.aq(f),u_right:new i.aq(f),u_intensity_multiplier:new i.aa(f)}),occlusion:f=>({u_matrix:new i.a6(f),u_anchorPos:new i.aq(f),u_screenSizePx:new i.a8(f),u_occluderSizePx:new i.a8(f),u_color:new i.as(f)})};function Mu(f,o,h){let g=o.createTileMatrix(f,f.worldSize,h.toUnwrapped());return i.ad.multiply(new Float32Array(16),f.projMatrix,g)}function Oy(f,o,h){if(o.projection.name===h.projection.name)return f.projMatrix;let g=h.clone();return g.setProjection(o.projection),Mu(g,o.getProjection(),f)}function wc(f,o,h){return o.name===h.projection.name?f.projMatrix:Mu(h,o,f)}let ku;function Kd(f,o,h,g,v,x,S){let k=f.context,D=k.gl,A=f.transform,L=f.getOrCreateProgram("collisionBox"),z=[],U=0,H=0;for(let ae=0;ae<g.length;ae++){let ge=g[ae],fe=o.getTile(ge),ne=fe.getBucket(h);if(!ne)continue;let se=Oy(ge,ne,A),le=se;v[0]===0&&v[1]===0||(le=f.translatePosMatrix(se,fe,v,x));let we=S?ne.textCollisionBox:ne.iconCollisionBox,Re=ne.collisionCircleArray;if(Re.length>0){let me=i.ad.create(),Le=le;i.ad.mul(me,ne.placementInvProjMatrix,A.glCoordMatrix),i.ad.mul(me,me,ne.placementViewportMatrix),z.push({circleArray:Re,circleOffset:H,transform:Le,invTransform:me,projection:ne.getProjection()}),U+=Re.length/4,H=U}we&&(f.terrain&&f.terrain.setupElevationDraw(fe,L),L.draw(f,D.LINES,i.ae.disabled,i.ag.disabled,f.colorModeForRenderPass(),i.af.disabled,Ap(le,A,fe,ne.getProjection()),h.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,A.zoom,null,[we.collisionVertexBuffer,we.collisionVertexBufferExt]))}if(!S||!z.length)return;let Y=f.getOrCreateProgram("collisionCircle"),Z=new i.bL;Z.resize(4*U),Z._trim();let X=0;for(let ae of z)for(let ge=0;ge<ae.circleArray.length/4;ge++){let fe=4*ge,ne=ae.circleArray[fe+0],se=ae.circleArray[fe+1],le=ae.circleArray[fe+2],we=ae.circleArray[fe+3];Z.emplace(X++,ne,se,le,we,0),Z.emplace(X++,ne,se,le,we,1),Z.emplace(X++,ne,se,le,we,2),Z.emplace(X++,ne,se,le,we,3)}(!ku||ku.length<2*U)&&(ku=function(ae){let ge=2*ae,fe=new i.bu;fe.resize(ge),fe._trim();for(let ne=0;ne<ge;ne++){let se=6*ne;fe.uint16[se+0]=4*ne+0,fe.uint16[se+1]=4*ne+1,fe.uint16[se+2]=4*ne+2,fe.uint16[se+3]=4*ne+2,fe.uint16[se+4]=4*ne+3,fe.uint16[se+5]=4*ne+0}return fe}(U));let Q=k.createIndexBuffer(ku,!0),re=k.createVertexBuffer(Z,i.bM.members,!0);for(let ae of z){let ge={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(oe=A).getCameraToCenterDistance(ae.projection),u_viewport_size:[oe.width,oe.height]};Y.draw(f,D.TRIANGLES,i.ae.disabled,i.ag.disabled,f.colorModeForRenderPass(),i.af.disabled,ge,h.id,re,Q,i.b.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,A.zoom)}var oe;re.destroy(),Q.destroy()}let fl=i.ad.create();function r_(f){let o=f._camera.getWorldToCamera(f.worldSize,1),h=i.ad.multiply([],o,f.globeMatrix);i.ad.invert(h,h);let g=[0,0,0],v=[0,1,0,0];return i.aA.transformMat4(v,v,h),g[0]=v[0],g[1]=v[1],g[2]=v[2],i._.normalize(g,g),g}function Ry({width:f,height:o,anchor:h,textOffset:g,textScale:v},x){let{horizontalAlign:S,verticalAlign:k}=i.bQ(h),D=-(S-.5)*f,A=-(k-.5)*o,L=i.bP(h,g);return new i.P((D/v+L[0])*x,(A/v+L[1])*x)}function o_(f,o,h,g,v,x,S,k,D,A,L){let z=f.text.placedSymbolArray,U=f.text.dynamicLayoutVertexArray,H=f.icon.dynamicLayoutVertexArray,Y={},Z=f.getProjection(),X=wc(k,Z,x),Q=x.elevation,re=Z.upVectorScale(k.canonical,x.center.lat,x.worldSize).metersToTile;U.clear();for(let oe=0;oe<z.length;oe++){let ae=z.get(oe),{tileAnchorX:ge,tileAnchorY:fe,numGlyphs:ne}=ae,se=ae.hidden||!ae.crossTileID||f.allowVerticalPlacement&&!ae.placedOrientation?null:g[ae.crossTileID];if(se){let le=0,we=0,Re=0;if(Q){let Ye=Q?Q.getAtTileOffset(k,ge,fe):0,[gt,yt,kt]=Z.upVector(k.canonical,ge,fe);le=Ye*gt*re,we=Ye*yt*re,Re=Ye*kt*re}let[me,Le,Be,Qe]=Vo(ae.projectedAnchorX+le,ae.projectedAnchorY+we,ae.projectedAnchorZ+Re,h?X:S),Je=Hr(x.getCameraToCenterDistance(Z),Qe),Ze=v.evaluateSizeForFeature(f.textSizeData,A,ae)*Je/i.bN;h&&(Ze*=f.tilePixelRatio/D);let Te=Ry(se,Ze);h?({x:me,y:Le,z:Be}=Z.projectTilePoint(ge+Te.x,fe+Te.y,k.canonical),[me,Le,Be]=Vo(me+le,Le+we,Be+Re,S)):(o&&Te._rotate(-x.angle),me+=Te.x,Le+=Te.y,Be=0);let Ve=f.allowVerticalPlacement&&ae.placedOrientation===i.aE.vertical?Math.PI/2:0;for(let Ye=0;Ye<ne;Ye++)i.aH(U,me,Le,Be,Ve);L&&ae.associatedIconIndex>=0&&(Y[ae.associatedIconIndex]={x:me,y:Le,z:Be,angle:Ve})}else ul(ne,U)}if(L){H.clear();let oe=f.icon.placedSymbolArray;for(let ae=0;ae<oe.length;ae++){let ge=oe.get(ae),{numGlyphs:fe}=ge,ne=Y[ae];if(ge.hidden||!ne)ul(fe,H);else{let{x:se,y:le,z:we,angle:Re}=ne;for(let me=0;me<fe;me++)i.aH(H,se,le,we,Re)}}f.icon.dynamicLayoutVertexBuffer.updateData(H)}f.text.dynamicLayoutVertexBuffer.updateData(U)}function Fp(f,o,h,g,v,x,S={}){let k=h.paint.get("icon-translate"),D=h.paint.get("text-translate"),A=h.paint.get("icon-translate-anchor"),L=h.paint.get("text-translate-anchor"),z=h.layout.get("icon-rotation-alignment"),U=h.layout.get("text-rotation-alignment"),H=h.layout.get("icon-pitch-alignment"),Y=h.layout.get("text-pitch-alignment"),Z=h.layout.get("icon-keep-upright"),X=h.layout.get("text-keep-upright"),Q=h.paint.get("icon-color-saturation"),re=h.paint.get("icon-color-contrast"),oe=h.paint.get("icon-color-brightness-min"),ae=h.paint.get("icon-color-brightness-max"),ge=h.paint.get("icon-occlusion-opacity").constantOr(0),fe=h.paint.get("text-occlusion-opacity").constantOr(0),ne=f.context,se=ne.gl,le=f.transform,we=z==="map",Re=U==="map",me=H==="map",Le=Y==="map",Be=ge!==1,Qe=fe!==1,Je=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ze=!1,Te=f.depthModeForSublayer(0,i.ae.ReadOnly),Ve=[i.aj(le.center.lng),i.ak(le.center.lat)],Ye=h.layout.get("text-variable-anchor"),gt=le.projection.name==="globe",yt=[],kt=[0,-1,0];for(let vt of g){let it=o.getTile(vt),Ge=it.getBucket(h);if(!Ge||Ge.projection.name==="mercator"&&gt||Ge.fullyClipped)continue;let Dt=Ge.projection.name==="globe",oi=Dt?i.a1(le.zoom):0,ti=wc(vt,Ge.getProjection(),le),vi=le.calculatePixelsToTileUnitsMatrix(it),Di=Ye&&Ge.hasTextData(),Ji=Ge.hasIconTextFit()&&Di&&Ge.hasIconData(),Qt=Ge.getProjection().createInversionMatrix(le,vt.canonical),Gi=()=>{let Ke=we&&h.layout.get("symbol-placement")!=="point",St=[];h.hasInitialOcclusionOpacityProperties&&Be&&f.symbolParams.useOcclusionQueries&&!Dt&&!gt&&St.push("OCCLUSION_QUERIES"),h.hasInitialOcclusionOpacityProperties||St.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");let Dn=Ke||Ji,qi=h.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&me&&St.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(St.push("PROJECTION_GLOBE_VIEW"),Dn&&St.push("PROJECTED_POS_ON_VIEWPORT")),qi>0&&St.push("ICON_TRANSITION"),Ge.icon.zOffsetVertexBuffer&&St.push("Z_OFFSET"),Q===0&&re===0&&oe===0&&ae===1||St.push("COLOR_ADJUSTMENT");let Pe=Ge.icon.programConfigurations.get(h.id),Ao=f.getOrCreateProgram(Ge.sdfIcons?"symbolSDF":"symbolIcon",{config:Pe,defines:St}),Er,Kr=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],_r=Ge.iconSizeData,co=i.aD(_r,le.zoom),ua=me||le.pitch!==0,Po=dl(ti,it.tileID.canonical,me,we,le,Ge.getProjection(),vi),zs=fc(ti,it.tileID.canonical,me,we,le,Ge.getProjection(),vi),Bs=f.translatePosMatrix(zs,it,k,A,!0),Ka=f.translatePosMatrix(ti,it,k,A),Ta=Dn?fl:Po,Ja=we&&!me&&!Ke,Lc=kt;!gt&&!le.mercatorFromTransition||we||(Lc=r_(le));let Fc=Dt?Lc:kt;if(Ge.sdfIcons&&!Ge.iconsInText)Er=Su(_r.kind,co,Ja,me,f,Ka,Ta,Bs,!1,Kr,!0,vt,oi,Ve,Qt,Fc,Ge.getProjection());else{let hr=h.getColorAdjustmentMatrix(Q,re,oe,ae);Er=xc(_r.kind,co,Ja,me,f,Ka,Ta,Bs,!1,Kr,vt,oi,Ve,Qt,Fc,Ge.getProjection(),hr,qi)}let kl=it.imageAtlasTexture?it.imageAtlasTexture:null,zc=h.layout.get("icon-size").constantOr(0)!==1||Ge.iconsNeedLinear,$u=Ge.sdfIcons||f.options.rotating||f.options.zooming||zc||ua?se.LINEAR:se.NEAREST,Yu=Ge.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,ff=f.terrain&&me&&Ke?i.ad.invert(i.ad.create(),Po):fl;if(Ke&&Ge.icon){let hr=le.elevation,gf=hr?hr.getAtTileOffsetFunc(vt,le.center.lat,le.worldSize,Ge.getProjection()):null,Bc=hl(ti,it.tileID.canonical,me,we,le,Ge.getProjection(),vi);hu(Ge,ti,f,!1,Bc,zs,me,Z,gf,vt)}return{program:Ao,buffers:Ge.icon,uniformValues:Er,atlasTexture:kl,atlasTextureIcon:null,atlasInterpolation:$u,atlasInterpolationIcon:null,isSDF:Ge.sdfIcons,hasHalo:Yu,tile:it,labelPlaneMatrixInv:ff}},dn=()=>{let Ke=Re&&h.layout.get("symbol-placement")!=="point",St=[],Dn=Ke||Ye||Ji;h.hasInitialOcclusionOpacityProperties&&Qe&&f.symbolParams.useOcclusionQueries&&!Dt&&!gt&&St.push("OCCLUSION_QUERIES"),h.hasInitialOcclusionOpacityProperties||St.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),f.terrainRenderModeElevated()&&Le&&St.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(St.push("PROJECTION_GLOBE_VIEW"),Dn&&St.push("PROJECTED_POS_ON_VIEWPORT")),Ge.text.zOffsetVertexBuffer&&St.push("Z_OFFSET");let qi=Ge.text.programConfigurations.get(h.id),Pe=f.getOrCreateProgram(Ge.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:qi,defines:St}),Ao,Er=[0,0],Kr=null,_r=Ge.textSizeData;Ge.iconsInText&&(Er=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],Kr=it.imageAtlasTexture?it.imageAtlasTexture:null,Ao=Le||le.pitch!==0||f.options.rotating||f.options.zooming||_r.kind==="composite"||_r.kind==="camera"?se.LINEAR:se.NEAREST);let co=it.glyphAtlasTexture?it.glyphAtlasTexture.size:[0,0],ua=i.aD(_r,le.zoom),Po=dl(ti,it.tileID.canonical,Le,Re,le,Ge.getProjection(),vi),zs=fc(ti,it.tileID.canonical,Le,Re,le,Ge.getProjection(),vi),Bs=f.translatePosMatrix(zs,it,D,L,!0),Ka=f.translatePosMatrix(ti,it,D,L),Ta=Dn?fl:Po,Ja=Re&&!Le&&!Ke,Lc=kt;!gt&&!le.mercatorFromTransition||Re||(Lc=r_(le));let Fc=Dt?Lc:kt,kl;kl=Ge.iconsInText?e_(_r.kind,ua,Ja,Le,f,Ka,Ta,Bs,co,Er,vt,oi,Ve,Qt,Fc,Ge.getProjection()):Su(_r.kind,ua,Ja,Le,f,Ka,Ta,Bs,!0,co,!0,vt,oi,Ve,Qt,Fc,Ge.getProjection());let zc=it.glyphAtlasTexture?it.glyphAtlasTexture:null,$u=se.LINEAR,Yu=h.paint.get("text-halo-width").constantOr(1)!==0,ff=f.terrain&&Le&&Ke?i.ad.invert(i.ad.create(),Po):fl;if(Ke&&Ge.text){let hr=le.elevation,gf=hr?hr.getAtTileOffsetFunc(vt,le.center.lat,le.worldSize,Ge.getProjection()):null,Bc=hl(ti,it.tileID.canonical,Le,Re,le,Ge.getProjection(),vi);hu(Ge,ti,f,!0,Bc,zs,Le,X,gf,vt)}return{program:Pe,buffers:Ge.text,uniformValues:kl,atlasTexture:zc,atlasTextureIcon:Kr,atlasInterpolation:$u,atlasInterpolationIcon:Ao,isSDF:!0,hasHalo:Yu,tile:it,labelPlaneMatrixInv:ff}},Qi=Ge.icon.segments.get().length,Ci=Ge.text.segments.get().length,ii=Qi&&!S.onlyText?Gi():null,gn=Ci&&!S.onlyIcons?dn():null,xn=h.paint.get("icon-opacity").constantOr(1),nn=h.paint.get("text-opacity").constantOr(1);if(Je&&Ge.canOverlap){Ze=!0;let Ke=xn&&!S.onlyText?Ge.icon.segments.get():[],St=nn&&!S.onlyIcons?Ge.text.segments.get():[];for(let Dn of Ke)yt.push({segments:new i.b([Dn]),sortKey:Dn.sortKey,state:ii});for(let Dn of St)yt.push({segments:new i.b([Dn]),sortKey:Dn.sortKey,state:gn})}else S.onlyText||yt.push({segments:xn?Ge.icon.segments:new i.b([]),sortKey:0,state:ii}),S.onlyIcons||yt.push({segments:nn?Ge.text.segments:new i.b([]),sortKey:0,state:gn})}Ze&&yt.sort((vt,it)=>vt.sortKey-it.sortKey);for(let vt of yt){let it=vt.state;if(it)if(f.terrain&&f.terrain.setupElevationDraw(it.tile,it.program,{useDepthForOcclusion:!h.hasInitialOcclusionOpacityProperties&&le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:it.labelPlaneMatrixInv}),ne.activeTexture.set(se.TEXTURE0),it.atlasTexture&&it.atlasTexture.bind(it.atlasInterpolation,se.CLAMP_TO_EDGE,!0),it.atlasTextureIcon&&(ne.activeTexture.set(se.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,se.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,it.program),it.hasHalo){let Ge=it.uniformValues;Ge.u_is_halo=1,Cc(it.buffers,vt.segments,h,f,it.program,Te,v,x,Ge,2),Ge.u_is_halo=0}else{if(it.isSDF){let Ge=it.uniformValues;it.hasHalo&&(Ge.u_is_halo=1,Cc(it.buffers,vt.segments,h,f,it.program,Te,v,x,Ge,1)),Ge.u_is_halo=0}Cc(it.buffers,vt.segments,h,f,it.program,Te,v,x,it.uniformValues,1)}}}function Cc(f,o,h,g,v,x,S,k,D,A){let L=g.context.gl,z=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];f.occlusionQueryOpacityVertexBuffer.length>0&&z.push(f.occlusionQueryOpacityVertexBuffer),v.draw(g,L.TRIANGLES,x,S,k,i.af.disabled,D,h.id,f.layoutVertexBuffer,f.indexBuffer,o,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),z,A)}function zp(f,o,h,g,v,x,S){let k=f.context.gl,D=h.paint.get("fill-pattern"),A=D&&D.constantOr(1),L,z,U,H,Y;S?(z=A&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=k.LINES):(z=A?"fillPattern":"fill",L=k.TRIANGLES);for(let Z of g){let X=o.getTile(Z);if(A&&!X.patternsLoaded())continue;let Q=X.getBucket(h);if(!Q)continue;f.prepareDrawTile();let re=Q.programConfigurations.get(h.id),oe=f.isTileAffectedByFog(Z),ae=f.getOrCreateProgram(z,{config:re,overrideFog:oe});A&&(f.context.activeTexture.set(k.TEXTURE0),X.imageAtlasTexture&&X.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),re.updatePaintBuffers());let ge=D.constantOr(null);if(ge&&X.imageAtlas){let se=X.imageAtlas.patternPositions[ge.toString()];se&&re.setConstantPatternPositions(se)}let fe=f.translatePosMatrix(Z.projMatrix,X,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),ne=h.paint.get("fill-emissive-strength");if(S){H=Q.indexBuffer2,Y=Q.segments2;let se=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];U=z==="fillOutlinePattern"&&A?wu(fe,ne,f,X,se):Kg(fe,ne,se)}else H=Q.indexBuffer,Y=Q.segments,U=A?Dp(fe,ne,f,X):Ep(fe,ne);f.uploadCommonUniforms(f.context,ae,Z.toUnwrapped()),ae.draw(f,L,v,f.stencilModeForClipping(Z),x,i.af.disabled,U,h.id,Q.layoutVertexBuffer,H,Y,h.paint,f.transform.zoom,re,void 0)}}function Sc(f,o,h,g,v,x,S,k){h.resetLayerRenderingStats(f);let D=f.context,A=D.gl,L=f.transform,z=h.paint.get("fill-extrusion-pattern"),U=z.constantOr(1),H=h.paint.get("fill-extrusion-opacity"),Y=f.style.enable3dLights(),Z=h.paint.get(Y&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],Q=h.layout.get("fill-extrusion-edge-radius"),re=Q>0&&!h.paint.get("fill-extrusion-rounded-roof"),oe=re?0:Q,ae=L.projection.name==="globe"?i.bY():0,ge=L.projection.name==="globe",fe=ge?i.a1(L.zoom):0,ne=[i.aj(L.center.lng),i.ak(L.center.lat)],se=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),le=h.paint.get("fill-extrusion-flood-light-intensity"),we=h.paint.get("fill-extrusion-vertical-scale"),Re=$a(f,h.paint.get("fill-extrusion-cutoff-fade-range")),me=h.paint.get("fill-extrusion-emissive-strength"),Le=[],Be;ge&&Le.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&Le.push("FAUX_AO"),re&&Le.push("ZERO_ROOF_RADIUS"),k&&Le.push("HAS_CENTROID"),le>0&&Le.push("FLOOD_LIGHT"),Re.shouldRenderCutoff&&Le.push("RENDER_CUTOFF");let Qe=f.renderPass==="shadow",Je=f.shadowRenderer,Ze=Qe&&!!Je;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Te=[0,0,0];if(Je){let gt=f.style.directionalLight,yt=f.style.ambientLight;gt&&yt&&(Te=Ya(f.style,gt,yt)),Be=Le.concat(["SHADOWS_SINGLE_CASCADE"])}let Ve=Ze?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",Ye=h.getLayerRenderingStats();for(let gt of g){let yt=o.getTile(gt),kt=yt.getBucket(h);if(!kt||kt.projection.name!==L.projection.name)continue;let vt=!1;Je&&(vt=Je.getMaxCascadeForTile(gt.toUnwrapped())===0);let it=f.isTileAffectedByFog(gt),Ge=kt.programConfigurations.get(h.id),Dt=f.getOrCreateProgram(Ve,{config:Ge,defines:vt?Be:Le,overrideFog:it});if(f.terrain&&f.terrain.setupElevationDraw(yt,Dt,{useMeterToDem:!0}),!kt.centroidVertexBuffer){let Qt=Dt.attributes.a_centroid_pos;Qt!==void 0&&A.vertexAttrib2f(Qt,0,0)}!Qe&&Je&&Je.setupShadows(yt.tileID.toUnwrapped(),Dt,"vector-tile",yt.tileID.overscaledZ),U&&(f.context.activeTexture.set(A.TEXTURE0),yt.imageAtlasTexture&&yt.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Ge.updatePaintBuffers());let oi=z.constantOr(null);if(oi&&yt.imageAtlas){let Qt=yt.imageAtlas.patternPositions[oi.toString()];Qt&&Ge.setConstantPatternPositions(Qt)}let ti=h.paint.get("fill-extrusion-vertical-gradient"),vi;if(Qe&&Je){if(Bp(yt.tileID,kt,f))continue;let Qt=Je.calculateShadowPassMatrixFromTile(yt.tileID.toUnwrapped());vi=vc(Qt,oe,we)}else{let Qt=f.translatePosMatrix(gt.expandedProjMatrix,yt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Gi=L.projection.createInversionMatrix(L,gt.canonical);vi=U?Tp(Qt,f,ti,H,X,oe,gt,yt,ae,fe,ne,Gi,se,we):yc(Qt,f,ti,H,X,oe,gt,ae,fe,ne,Gi,se,we,le,Te,me)}f.uploadCommonUniforms(D,Dt,gt.toUnwrapped(),null,Re);let Di=kt.segments;if(L.projection.name==="mercator"&&!Qe&&(Di=kt.getVisibleSegments(yt.tileID,f.terrain,f.transform.getFrustum(0)),!Di.get().length))continue;if(Ye)if(Qe)for(let Qt of Di.get())Ye.numRenderedVerticesInShadowPass+=Qt.primitiveLength;else for(let Qt of Di.get())Ye.numRenderedVerticesInTransparentPass+=Qt.primitiveLength;let Ji=[];(f.terrain||k)&&Ji.push(kt.centroidVertexBuffer),ge&&Ji.push(kt.layoutVertexExtBuffer),Dt.draw(f,D.gl.TRIANGLES,v,x,S,i.af.backCCW,vi,h.id,kt.layoutVertexBuffer,kt.indexBuffer,Di,h.paint,f.transform.zoom,Ge,Ji)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function oo(f,o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q,re){let oe=f.context,ae=oe.gl,ge=f.transform,fe=f.transform.zoom,ne=[],se=$a(f,h.paint.get("fill-extrusion-cutoff-fade-range"));A==="clear"?(ne.push("CLEAR_SUBPASS"),re&&(ne.push("CLEAR_FROM_TEXTURE"),oe.activeTexture.set(ae.TEXTURE0),re.bind(ae.LINEAR,ae.CLAMP_TO_EDGE))):A==="sdf"&&ne.push("SDF_SUBPASS"),X&&ne.push("HAS_CENTROID"),se.shouldRenderCutoff&&ne.push("RENDER_CUTOFF");let le=h.layout.get("fill-extrusion-edge-radius"),we=(Re,me,Le,Be,Qe)=>{let Je=me.programConfigurations.get(h.id),Ze=f.isTileAffectedByFog(Re),Te=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Je,defines:ne,overrideFog:Ze}),Ve=((gt,yt,kt,vt,it,Ge,Dt,oi,ti,vi,Di)=>({u_matrix:yt,u_opacity:kt,u_ao_pass:vt?1:0,u_meter_to_tile:it,u_ao:Ge,u_flood_light_intensity:Dt,u_flood_light_color:oi,u_attenuation:ti,u_edge_radius:vi,u_fb:0,u_fb_size:Di}))(0,Be,L,D,Qe,[z,U*Qe],H,Y,Z,fe>=17?0:le*Qe,re?re.size[0]:0),Ye=[];X&&Ye.push(me.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(oe,Te,Re.toUnwrapped(),null,se),Te.draw(f,oe.gl.TRIANGLES,v,x,S,k,Ve,h.id,me.vertexBuffer,me.indexBuffer,Le,h.paint,fe,Je,Ye)};for(let Re of g){let me=o.getTile(Re),Le=me.getBucket(h);if(!Le||Le.projection.name!==ge.projection.name||!Le.groundEffect||Le.groundEffect&&!Le.groundEffect.hasData())continue;let Be=Le.groundEffect,Qe=1/Le.tileToMeter;{let Je=f.translatePosMatrix(Re.projMatrix,me,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ze=Be.getDefaultSegment();we(Re,Be,Ze,Je,Qe)}if(Q)for(let Je=0;Je<4;Je++){let Ze=i.bZ[Je](Re),Te=o.getTile(Ze);if(!Te)continue;let Ve=Te.getBucket(h);if(!Ve||Ve.projection.name!==ge.projection.name||!Ve.groundEffect||Ve.groundEffect&&!Ve.groundEffect.hasData())continue;let Ye=Ve.groundEffect,gt,yt;Je===0?(gt=[-i.a3,0,0],yt=1):Je===1?(gt=[i.a3,0,0],yt=0):Je===2?(gt=[0,-i.a3,0],yt=3):(gt=[0,i.a3,0],yt=2);let kt=Ye.regionSegments[yt];if(!kt)continue;let vt=new Float32Array(16);i.ad.translate(vt,Re.projMatrix,gt),we(Re,Ye,kt,f.translatePosMatrix(vt,me,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Qe)}}}function Iu(f,o,h,g,v,x,S){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();let k=x?x.findDEMTileFor(h):null;if(!(k&&k.dem||S))return;let D=Q=>new i.P(Math.ceil((Q+i.c0)*i.c1),0),A=Q=>{let re=o.getSource().minzoom,oe=ge=>{let fe=o.getTileByID(ge);if(fe&&fe.hasData())return fe.getBucket(v)},ae=[0,-1,1];for(let ge of ae){if(Q.overscaledZ+ge<re)continue;let fe=oe(Q.calculateScaledKey(Q.overscaledZ+ge));if(fe)return fe}},L=[0,0,0],z=(Q,re)=>(L[0]=Math.min(Q.min.y,re.min.y),L[1]=Math.max(Q.max.y,re.max.y),L[2]=i.a3-re.min.x>Q.max.x?re.min.x-i.a3:Q.max.x,L),U=(Q,re)=>(L[0]=Math.min(Q.min.x,re.min.x),L[1]=Math.max(Q.max.x,re.max.x),L[2]=i.a3-re.min.y>Q.max.y?re.min.y-i.a3:Q.max.y,L),H=[(Q,re)=>z(Q,re),(Q,re)=>z(re,Q),(Q,re)=>U(Q,re),(Q,re)=>U(re,Q)],Y=(Q,re,oe,ae,ge,fe,ne)=>{if(!x)return 0;let se=[[fe?oe:Q,fe?Q:oe,0],[fe?oe:re,fe?re:oe,0]],le=ne<0?i.a3+ne:ne,we=[fe?le:(Q+re)/2,fe?(Q+re)/2:le,0];return oe===0&&ne<0||oe!==0&&ne>0?x.getForTilePoints(ge,[we],!0,ae):se.push(we),x.getForTilePoints(h,se,!0,k),Math.max(se[0][2],se[1][2],we[2])/x.exaggeration()};for(let Q=0;Q<4;Q++){let re=g.borderFeatureIndices[Q];if(re.length===0)continue;let oe=i.bZ[Q](h),ae=A(oe);if(!(ae&&ae instanceof i.b_)||g.borderDoneWithNeighborZ[Q]===ae.canonical.z)continue;ae.centroidVertexArray.length===0&&ae.createCentroidsBuffer();let ge=x?x.findDEMTileFor(oe):null;if(!(ge&&ge.dem||S))continue;let fe=(Q<2?1:5)-Q,ne=ae.borderDoneWithNeighborZ[fe]!==g.canonical.z,se=ae.borderFeatureIndices[fe],le=0;if(g.canonical.z!==ae.canonical.z){for(let we of re)g.showCentroid(g.featuresOnBorder[we]);if(ne)for(let we of se)ae.showCentroid(ae.featuresOnBorder[we]);g.borderDoneWithNeighborZ[Q]=ae.canonical.z,ae.borderDoneWithNeighborZ[fe]=g.canonical.z}for(let we of re){let Re=g.featuresOnBorder[we],me=g.centroidData[Re.centroidDataIndex],Le=Re.borders[Q],Be;for(;le<se.length;){Be=ae.featuresOnBorder[se[le]];let Qe=Be.borders[fe];if(Qe[1]>Le[0]+3||Qe[0]>Le[0]-3)break;ae.showCentroid(Be),le++}if(Be&&le<se.length){let Qe=le,Je=0;for(;!(Be.borders[fe][0]>Le[1]-3)&&(Je++,++le!==se.length);)Be=ae.featuresOnBorder[se[le]];if(Be=ae.featuresOnBorder[se[Qe]],Je>1){let Ve=Be.borders[fe];Math.abs(Le[0]-Ve[0])<3&&Math.abs(Le[1]-Ve[1])<3&&(Je=1,le=Qe+1)}else if(Je===0){g.showCentroid(Re);continue}let Ze=ae.centroidData[Be.centroidDataIndex];S&&Je===1&&(((Z=me).flags|(X=Ze).flags)&i.b$?(Z.flags|=i.b$,X.flags|=i.b$):(Z.flags&=~i.b$,X.flags&=~i.b$));let Te=Re.intersectsCount()>1||Be.intersectsCount()>1;if(Je>1)le=Qe,me.centroidXY=Ze.centroidXY=new i.P(0,0);else if(ge&&ge.dem&&!Te){let Ve=H[Q](me,Ze),Ye=Q%2?i.a3-1:0,gt=Y(Ve[0],Math.min(i.a3-1,Ve[1]),Ye,ge,oe,Q<2,Ve[2]);me.centroidXY=Ze.centroidXY=D(gt)}else Te?me.centroidXY=Ze.centroidXY=new i.P(0,0):(me.centroidXY=g.encodeBorderCentroid(Re),Ze.centroidXY=ae.encodeBorderCentroid(Be));g.writeCentroidToBuffer(me),ae.writeCentroidToBuffer(Ze)}else g.showCentroid(Re)}g.borderDoneWithNeighborZ[Q]=ae.canonical.z,ae.borderDoneWithNeighborZ[fe]=g.canonical.z}var Z,X;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(f)}let gl=[1,0,0],a_=[0,1,0],Tu=[0,0,1];function Bp(f,o,h){let g=h.transform,v=h.shadowRenderer;if(!v)return!0;let x=f.toUnwrapped(),S=g.tileSize*v._cascades[h.currentShadowCascade].scale,k=o.maxHeight;if(g.elevation){let Z=g.elevation.getMinMaxForTile(f);Z&&(k+=Z.max)}let D=[...v.shadowDirection];D[2]=-D[2];let A=v.computeSimplifiedTileShadowVolume(x,k,S,D);if(!A)return!1;let L=[gl,a_,Tu,D,[D[0],0,D[2]],[0,D[1],D[2]]],z=g.projection.name==="globe",U=g.scaleZoom(S),H=i.aM.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,U,!z),Y=v.getCurrentCascadeFrustum();return H.intersectsPrecise(A.vertices,A.planes,L)===0||Y.intersectsPrecise(A.vertices,A.planes,L)===0}function Jd(f){return[f[0]*i.c2,f[1]*i.c2,f[2]*i.c2,0]}function eh(f,o,h,g,v,x,S,k,D){let A=g.getSource(),L=h.globeSharedBuffers;if(!L)return;let z,U,H;if(o&&(z=g.getTile(o)),A instanceof i.bm?(U=A.texture,H=i.bh(0,0,h.transform)):z&&o&&(U=z.texture,H=i.bh(o.canonical.z,o.canonical.x,h.transform)),!U||!H)return;f||(H=i.ad.scale(i.ad.create(),H,[1,-1,1]));let Y=h.context,Z=Y.gl,X=v.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,Q=h.colorModeForDrapableLayerRenderPass(x),re=S.defines;re.push("GLOBE_POLES");let oe=new i.ae(Z.LEQUAL,i.ae.ReadWrite,h.depthRangeFor3D),ae=Float32Array.from(h.transform.expandedFarZProjMatrix),ge=Float32Array.from(i.bf(i.bg(new i.aO(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),Y.activeTexture.set(Z.TEXTURE0),U.bind(X,Z.CLAMP_TO_EDGE),Y.activeTexture.set(Z.TEXTURE1),U.bind(X,Z.CLAMP_TO_EDGE),U.useMipmap&&Y.extTextureFilterAnisotropic&&h.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);let[fe,ne,se,le]=o?L.getPoleBuffers(o.canonical.z,!1):L.getPoleBuffers(0,!0),we=v.paint.get("raster-elevation"),Re;f?(Re=fe,h.renderDefaultNorthPole=we!==0):(Re=ne,h.renderDefaultSouthPole=we!==0);let me=Jd(S.mix),Le=((Qe,Je,Ze,Te,Ve,Ye,gt,yt,kt,vt,it,Ge,Dt)=>Yd(Qe,Je,Ze,new Float32Array(16),new Float32Array(9),[0,0],Te,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ye,[0,0],yt,2,vt,it,Ge,1,0,Dt))(ae,ge,H,i.a1(h.transform.zoom),0,v,0,we,0,me,S.offset,S.range,x),Be=h.getOrCreateProgram("raster",{defines:re});h.uploadCommonUniforms(Y,Be,null),Be.draw(h,Z.TRIANGLES,oe,D,Q,k,Le,v.id,Re,se,le)}function Bi(f){let o=f._nearZ,h=f.projection.farthestPixelDistance(f),g=h-o,v=.2*f.height,x=o+v;return[o,h,(x-v-o)/g,(x-o)/g]}function Ly(f,o,h,g){if(f)return o instanceof bc&&f instanceof i.c3?o.getTextureDescriptor(f,h,!0):{texture:f.texture,mix:Jd(g.mix),offset:g.offset,buffer:0,tileSize:1}}function Wt(f,o,h){if(!f)return null;let g=o.getTextureDescriptor(f,h,!0);if(!g)return null;let{texture:v,mix:x,offset:S,tileSize:k,buffer:D,format:A}=g;if(!v||!A)return null;let L=!1;return A==="uint32"&&(L=!0,x[3]=0,x=Jg(i.c4,x,[0,h.paint.get("raster-particle-max-speed")]),S=Pp(i.c4,S,[0,h.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[D/(k+2*D),k/(k+2*D)],tileSize:k,scalarData:L,scale:x,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[A]]}}function s_(f){let o=f._nearZ,h=f.projection.farthestPixelDistance(f),g=h-o,v=.2*f.height,x=o+v;return[o,h,(x-v-o)/g,(x-o)/g]}let Eu=new i.C(1,0,0,1),Np=new i.C(0,1,0,1),Ma=new i.C(0,0,1,1),Vp=new i.C(1,0,1,1),Mc=new i.C(0,1,1,1);function Tt(f,o,h,g,v,x,S){let k=f.context,D=f.transform,A=k.gl,L=D.projection.name==="globe",z=L?["PROJECTION_GLOBE_VIEW"]:[],U=i.ad.clone(h.projMatrix);if(L&&i.a1(D.zoom)>0){let me=i.c5(h.canonical,D),Le=i.c6(me);U=i.ad.multiply(new Float32Array(16),D.globeMatrix,Le),i.ad.multiply(U,D.projMatrix,U)}let H=i.ad.create();H[12]+=2*v/(i.e.devicePixelRatio*D.width),H[13]+=2*x/(i.e.devicePixelRatio*D.height),i.ad.multiply(U,H,U);let Y=f.getOrCreateProgram("debug",{defines:z}),Z=o.getTileByID(h.key);f.terrain&&f.terrain.setupElevationDraw(Z,Y);let X=i.ae.disabled,Q=i.ag.disabled,re=f.colorModeForRenderPass(),oe="$debug";k.activeTexture.set(A.TEXTURE0),f.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),L?Z._makeGlobeTileDebugBuffers(f.context,D):Z._makeDebugTileBoundsBuffers(f.context,D.projection);let ae=Z._tileDebugBuffer||f.debugBuffer,ge=Z._tileDebugIndexBuffer||f.debugIndexBuffer,fe=Z._tileDebugSegments||f.debugSegments;if(Y.draw(f,A.LINE_STRIP,X,Q,re,i.af.disabled,Cu(U,g),oe,ae,ge,fe,null,null,null,[Z._globeTileDebugBorderBuffer]),S){let me=Z.latestRawTileData,Le=Math.floor((me&&me.byteLength||0)/1024),Be=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Be+=` => ${h.overscaledZ}`),Be+=` ${Z.state}`,Be+=` ${Le}kb`,function(Qe,Je){Qe.initDebugOverlayCanvas();let Ze=Qe.debugOverlayCanvas,Te=Qe.context.gl,Ve=Qe.debugOverlayCanvas.getContext("2d");Ve.clearRect(0,0,Ze.width,Ze.height),Ve.shadowColor="white",Ve.shadowBlur=2,Ve.lineWidth=1.5,Ve.strokeStyle="white",Ve.textBaseline="top",Ve.font="bold 36px Open Sans, sans-serif",Ve.fillText(Je,5,5),Ve.strokeText(Je,5,5),Qe.debugOverlayTexture.update(Ze),Qe.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}(f,Be)}let ne=o.getTile(h).tileSize,se=512/Math.min(ne,512)*(h.overscaledZ/D.zoom)*.5,le=Z._tileDebugTextBuffer||f.debugBuffer,we=Z._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Re=Z._tileDebugTextSegments||f.debugSegments;Y.draw(f,A.TRIANGLES,X,Q,i.a.alphaBlended,i.af.disabled,Cu(U,i.C.transparent,se),oe,le,we,Re,null,null,null,[Z._globeTileDebugTextBuffer])}function Ni(f,o,h,g){ao(f,0,o+h/2,f.transform.width,h,g)}function Vi(f,o,h,g){ao(f,o-h/2,0,h,f.transform.height,g)}function ao(f,o,h,g,v,x){let S=f.context,k=S.gl;k.enable(k.SCISSOR_TEST),k.scissor(o*i.e.devicePixelRatio,h*i.e.devicePixelRatio,g*i.e.devicePixelRatio,v*i.e.devicePixelRatio),S.clear({color:x}),k.disable(k.SCISSOR_TEST)}let kc=i.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ri}=kc;function sa(f,o,h,g){f.emplaceBack(o,h,g)}class Ic{constructor(o){this.vertexArray=new i.c8,this.indices=new i.bu,sa(this.vertexArray,-1,-1,1),sa(this.vertexArray,1,-1,1),sa(this.vertexArray,-1,1,1),sa(this.vertexArray,1,1,1),sa(this.vertexArray,-1,-1,-1),sa(this.vertexArray,1,-1,-1),sa(this.vertexArray,-1,1,-1),sa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Ri),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=i.b.simpleSegment(0,0,36,12)}}function ka(f,o,h,g,v,x){let S=f.context.gl,k=o.paint.get("sky-atmosphere-color"),D=o.paint.get("sky-atmosphere-halo-color"),A=o.paint.get("sky-atmosphere-sun-intensity"),L=((z,U,H,Y,Z)=>({u_matrix_3f:z,u_sun_direction:U,u_sun_intensity:H,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(i.bC.fromMat4(i.bC.create(),g),v,A,k,D);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+x,o.skyboxTexture,0),h.draw(f,S.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.unblended,i.af.frontCW,L,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}let go=i.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xn{constructor(o){let h=new i.c9;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let g=new i.bu;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(h,go.members),this.indexBuffer=o.createIndexBuffer(g),this.segments=i.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Fy=i.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class th{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class jp{constructor(o){this.colorModeAlphaBlendedWriteRGB=new i.a([i.ca,i.cb,i.ca,i.cb],i.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new i.a([i.ca,i.cc,i.ca,i.cc],i.C.transparent,[!1,!1,!1,!0]),this.params=new th,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){let h=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Xn(h);let g=this.params.sizeRange,v=this.params.intensityRange,x=function(L){let z=i.cf(30),U=[];for(let H=0;H<L;++H){let Y=2*Math.PI*z(),Z=Math.acos(1-2*z())-.5*Math.PI;U.push(i._.fromValues(Math.cos(Z)*Math.cos(Y),Math.cos(Z)*Math.sin(Y),Math.sin(Z)))}return U}(this.params.starsCount),S=i.cf(300),k=new i.cd,D=new i.bu,A=0;for(let L=0;L<x.length;++L){let z=i._.scale([],x[L],200),U=Math.max(0,1+.01*g*(1*S()-.5)),H=Math.max(0,1+.01*v*(1*S()-.5));k.emplaceBack(z[0],z[1],z[2],-1,-1,U,H),k.emplaceBack(z[0],z[1],z[2],1,-1,U,H),k.emplaceBack(z[0],z[1],z[2],1,1,U,H),k.emplaceBack(z[0],z[1],z[2],-1,1,U,H),D.emplaceBack(A+0,A+1,A+2),D.emplaceBack(A+0,A+2,A+3),A+=4}this.starsVx=h.createVertexBuffer(k,Fy.members),this.starsIdx=h.createIndexBuffer(D),this.starsSegments=i.b.simpleSegment(0,0,k.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,h){let g=o.context,v=g.gl,x=o.transform,S=new i.ae(v.LEQUAL,i.ae.ReadOnly,[0,1]),k=i.a1(x.zoom),D=o.style.getLut(h.scope),A=h.properties.get("color").toRenderColor(D).toArray01(),L=h.properties.get("high-color").toRenderColor(D).toArray01(),z=h.properties.get("space-color").toRenderColor(D).toArray01PremultipliedAlpha(),U=5e-4,H=i.ce(h.properties.get("horizon-blend"),0,1,U,.25),Y=i.ba(o,g,x)&&H===U?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,Z=o.frameCounter/1e3%1,X=i._.length(x.globeCenterInViewSpace),Q=Math.sqrt(Math.pow(X,2)-Math.pow(Y,2)),re=Math.acos(Q/X),oe=ae=>{let ge=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ae&&ge.push("ALPHA_PASS");let fe=o.getOrCreateProgram("globeAtmosphere",{defines:ge}),ne=((le,we,Re,me,Le,Be,Qe,Je,Ze,Te,Ve,Ye)=>({u_frustum_tl:le,u_frustum_tr:we,u_frustum_br:Re,u_frustum_bl:me,u_horizon:Le,u_transition:Be,u_fadeout_range:Qe,u_color:Je,u_high_color:Ze,u_space_color:Te,u_temporal_offset:Ve,u_horizon_angle:Ye}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,k,H,A,L,z,Z,re);o.uploadCommonUniforms(g,fe);let se=this.atmosphereBuffer;se&&fe.draw(o,v.TRIANGLES,S,i.ag.disabled,ae?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,i.af.backCW,ne,ae?"atmosphere_glow_alpha":"atmosphere_glow",se.vertexBuffer,se.indexBuffer,se.segments)};oe(!1),oe(!0)}drawStars(o,h){let g=i.at(h.properties.get("star-intensity"),0,1);if(g===0)return;let v=o.context,x=v.gl,S=o.transform,k=o.getOrCreateProgram("stars"),D=i.av.identity([]);i.av.rotateX(D,D,-S._pitch),i.av.rotateZ(D,D,-S.angle),i.av.rotateX(D,D,i.ab(S._center.lat)),i.av.rotateY(D,D,-i.ab(S._center.lng));let A=i.ad.fromQuat(new Float32Array(16),D),L=i.ad.multiply([],S.starsProjMatrix,A),z=i.bC.fromMat4([],A),U=i.bC.invert([],z),H=[0,1,0];i._.transformMat3(H,H,U),i._.scale(H,H,this.params.sizeMultiplier);let Y=[1,0,0];i._.transformMat3(Y,Y,U),i._.scale(Y,Y,this.params.sizeMultiplier);let Z=(X=H,Q=Y,re=g,{u_matrix:Float32Array.from(L),u_up:X,u_right:Q,u_intensity_multiplier:re});var X,Q,re;o.uploadCommonUniforms(v,k),this.starsVx&&this.starsIdx&&k.draw(o,x.TRIANGLES,i.ae.disabled,i.ag.disabled,this.colorModeAlphaBlendedWriteRGB,i.af.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Tc(f,o){let h=[...f],g=o.cameraWorldSizeForFog/o.worldSize,v=i.ad.identity([]);return i.ad.scale(v,v,[g,g,1]),i.ad.multiply(h,v,h),i.ad.multiply(h,o.worldToFogMatrix,h),h}function ih(f,o,h,g,v){let x=h.material,S=g.context,{baseColorTexture:k,metallicRoughnessTexture:D}=x.pbrMetallicRoughness,{normalTexture:A,occlusionTexture:L,emissionTexture:z}=x;function U(H,Y,Z){if(H&&(f.push(Y),S.activeTexture.set(S.gl.TEXTURE0+Z),H.gfxTexture)){let{minFilter:X,magFilter:Q,wrapS:re,wrapT:oe}=H.sampler;H.gfxTexture.bindExtraParam(X,Q,re,oe)}}U(k,"HAS_TEXTURE_u_baseColorTexture",Xr.BaseColor),U(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Xr.MetallicRoughness),U(A,"HAS_TEXTURE_u_normalTexture",Xr.Normal),U(L,"HAS_TEXTURE_u_occlusionTexture",Xr.Occlusion),U(z,"HAS_TEXTURE_u_emissionTexture",Xr.Emission),v&&(v.texture||(v.texture=new i.ch(g.context,v.image,[v.image.height,v.image.height,v.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Xr.LUT),v.texture&&v.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(h.texcoordBuffer)),h.colorBuffer&&(f.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(h.colorBuffer)),h.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(h.normalBuffer)),h.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(h.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function _l(f,o,h,g,v,x){let S=h.paint.get("model-opacity"),k=o.context,D=new i.ae(o.context.gl.LEQUAL,i.ae.ReadWrite,o.depthRangeFor3D),A=o.transform,L=f.mesh,z=L.material,U=z.pbrMetallicRoughness,H=o.style.fog,Y;Y=o.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:i.ad.multiply([],g.zScaleMatrix,f.nodeModelMatrix),i.ad.multiply(Y,g.negCameraPosMatrix,Y);let Z=i.ad.invert([],Y);i.ad.transpose(Z,Z);let X=h.paint.get("model-emissive-strength").constantOr(0),Q=Qd(new Float32Array(f.worldViewProjection),new Float32Array(Y),new Float32Array(Z),null,o,S,U.baseColorFactor.toRenderColor(null),z.emissiveFactor,U.metallicFactor,U.roughnessFactor,z,X,h),re={defines:[]},oe=[];ih(re.defines,oe,L,o,h.lut);let ae=o.shadowRenderer;ae&&(ae.useNormalOffset=!1);let ge=null;if(H){let se=Tc(f.nodeModelMatrix,o.transform);if(ge=new Float32Array(se),A.projection.name!=="globe"){let le=L.aabb.min,we=L.aabb.max,[Re,me]=H.getOpacityForBounds(se,le[0],le[1],we[0],we[1]);re.overrideFog=Re>=Mn||me>=Mn}}let fe=$a(o,h.paint.get("model-cutoff-fade-range"));fe.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");let ne=o.getOrCreateProgram("model",re);o.uploadCommonUniforms(k,ne,null,ge,fe),o.renderPass!=="shadow"&&ae&&ae.setupShadowsFromMatrix(f.nodeModelMatrix,ne),ne.draw(o,k.gl.TRIANGLES,D,v,x,L.material.doubleSided?i.af.disabled:i.af.backCCW,Q,h.id,L.vertexBuffer,L.indexBuffer,L.segments,h.paint,o.transform.zoom,void 0,oe)}function Wr(f,o,h,g,v,x,S){let k;k=f.projection.name==="globe"?i.ci(h,f):[...h],i.ad.multiply(k,k,o.matrix);let D=i.ad.multiply([],g,k);if(o.meshes)for(let A of o.meshes){if(A.material.alphaMode!=="BLEND"){S.push({mesh:A,depth:0,modelIndex:v,worldViewProjection:D,nodeModelMatrix:k});continue}let L=i._.transformMat4([],A.centroid,D);L[2]>0&&x.push({mesh:A,depth:L[2],modelIndex:v,worldViewProjection:D,nodeModelMatrix:k})}if(o.children)for(let A of o.children)Wr(f,A,h,g,v,x,S)}function so(f,o,h,g){let v=h.shadowRenderer;if(!v)return;let x=v.getShadowPassDepthMode(),S=v.getShadowPassColorMode(),k=v.calculateShadowPassMatrixFromMatrix(o),D=i_(k);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,x,i.ag.disabled,S,i.af.backCCW,D,g.id,f.vertexBuffer,f.indexBuffer,f.segments,g.paint,h.transform.zoom,void 0,void 0)}function l_(f,o,h){let g=o.updateZoomBasedPaintProperties(),v=function(x,S,k){let D,A,L,z=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&z>0){let U=x.terrain,H=U.findDEMTileFor(k);H&&H.dem?D=i.ck.create(U,k,H):z=0}if(z===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),z===S.validForExaggeration&&(z===0||D&&D._demTile&&D._demTile.tileID===S.validForDEMTile.id&&D._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(let U in S.instancesPerModel){let H=S.instancesPerModel[U];for(let Y=0;Y<H.instancedDataArray.length;++Y){let Z=(D?z*D.getElevationAt(0|H.instancedDataArray.float32[16*Y],0|H.instancedDataArray.float32[16*Y+1],!0,!0):0)+H.instancesEvaluatedElevation[Y];H.instancedDataArray.float32[16*Y+6]=Z,A=A?Math.min(S.terrainElevationMin,Z):Z,L=L?Math.max(S.terrainElevationMax,Z):Z}}return S.terrainElevationMin=A||0,S.terrainElevationMax=L||0,S.validForExaggeration=z,S.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,o,h);(g||v)&&(o.uploaded=!1,o.upload(f.context))}let lo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.b6([0,0,0],[i.a3,i.a3,0])};function sr(f,o){let h=1<<f.canonical.z,g=o.getFreeCameraOptions().position,v=o.elevation,x=f.canonical.x/h,S=(f.canonical.x+1)/h,k=f.canonical.y/h,D=(f.canonical.y+1)/h,A=o._centerAltitude;if(v){let H=v.getMinMaxForTile(f);H&&H.max>A&&(A=H.max)}let L=i.at(g.x,x,S)-g.x,z=i.at(g.y,k,D)-g.y,U=i.ax(A,o.center.lat)-g.z;return o._zoomFromMercatorZ(Math.sqrt(L*L+z*z+U*U))}function jo(f,o,h,g,v,x,S){let k=f.context,D=f.renderPass==="shadow",A=f.shadowRenderer,L=D&&A?A.getShadowPassDepthMode():new i.ae(k.gl.LEQUAL,i.ae.ReadWrite,f.depthRangeFor3D),z=f.isTileAffectedByFog(x);if(h.meshes)for(let U of h.meshes){let H=["MODEL_POSITION_ON_GPU"],Y=[],Z,X,Q;g.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");let re=$a(f,o.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),D&&A)Z=f.getOrCreateProgram("modelDepth",{defines:H}),X=i_(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(h.matrix)),Q=A.getShadowPassColorMode();else{ih(H,Y,U,f,o.lut),Z=f.getOrCreateProgram("model",{defines:H,overrideFog:z});let ae=U.material,ge=ae.pbrMetallicRoughness,fe=o.paint.get("model-opacity"),ne=o.paint.get("model-emissive-strength").constantOr(0);X=Qd(x.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,f,fe,ge.baseColorFactor.toRenderColor(null),ae.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,ae,ne,o,v),A&&(S.shadowUniformsInitialized?Z.setShadowUniformValues(k,A.getShadowUniformValues()):(A.setupShadows(x.toUnwrapped(),Z,"model-tile",x.overscaledZ),S.shadowUniformsInitialized=!0)),Q=re.shouldRenderCutoff||fe<1||ae.alphaMode!=="OPAQUE"?i.a.alphaBlended:i.a.unblended}f.uploadCommonUniforms(k,Z,x.toUnwrapped(),null,re);let oe=U.material.doubleSided?i.af.disabled:i.af.backCCW;if(g.instancedDataArray.length>20)Y.push(g.instancedDataBuffer),Z.draw(f,k.gl.TRIANGLES,L,i.ag.disabled,Q,oe,X,o.id,U.vertexBuffer,U.indexBuffer,U.segments,o.paint,f.transform.zoom,void 0,Y,g.instancedDataArray.length);else{let ae=D?"u_instance":"u_normal_matrix";for(let ge=0;ge<g.instancedDataArray.length;++ge)X[ae]=new Float32Array(g.instancedDataArray.arrayBuffer,64*ge,16),Z.draw(f,k.gl.TRIANGLES,L,i.ag.disabled,Q,oe,X,o.id,U.vertexBuffer,U.indexBuffer,U.segments,o.paint,f.transform.zoom,void 0,Y)}}if(h.children)for(let U of h.children)jo(f,o,U,g,v,x,S)}let Xa=[1,-1,1];function gr(f,o,h,g){if(!h.modelManager)return!0;let v=h.modelManager;if(!h.shadowRenderer)return!0;let x=h.shadowRenderer,S=o.aabb,k=!0,D=f.maxHeight;if(D===0){let L=0;for(let z in f.instancesPerModel){let U=v.getModel(z,g);U?L=Math.max(L,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):k=!1}D=f.maxScale*L*1.41+f.maxVerticalOffset,k&&(f.maxHeight=D)}S.max[2]=D,S.min[2]+=f.terrainElevationMin,S.max[2]+=f.terrainElevationMax,i._.transformMat4(S.min,S.min,o.tileMatrix),i._.transformMat4(S.max,S.max,o.tileMatrix);let A=S.intersects(x.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=A===2),A===0}function Up(f,o){let h=f.uniformValues.u_cutoff_params[0],g=f.uniformValues.u_cutoff_params[1],v=f.uniformValues.u_cutoff_params[2],x=f.uniformValues.u_cutoff_params[3];return g===h||x===v?1:i.at(((o-h)/(g-h)-v)/(x-v),0,1)}function la(f,o,h,g){if(o.pitch<20)return 1;let v=o.getWorldToCameraMatrix(),x=i.ad.multiply([],v,f),S=[...h.min,1],k=i.aA.transformMat4([],S,x),D=k,A=k;S[1]=h.max[1],k=i.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A,S[0]=h.max[0],k=i.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A,S[1]=h.min[1],k=i.aA.transformMat4([],S,x),D=k[1]<D[1]?k:D,A=k[1]>A[1]?k:A;let L=i.at(g[0],0,1),z=100*o.pixelsPerMeter*i.at(g[1],0,1),U=i.at(g[2],0,1),H=i._.lerp([],D,A,L),Y=Math.tan(.5*o.fovX),Z=-H[2]*Y;if(z===0)return H[1]<-Math.abs(Z)?U:1;let X=(-Math.abs(Z)-H[1])/z,Q=(oe,ae,ge)=>(1-ge)*oe+ge*ae,re=i.at(Q(1,U,X),U,1);return Q(1,re,i.at((o.pitch-20)/20,0,1))}class nh{}class rh{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,h,g){{let z=this._storage.get(h.id);if(z)return z.lastUsedFrameIdx=o,z.buf}let v=g.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),S=new ArrayBuffer(x),k=new Int16Array(S);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));let D=new i.cm;for(let z=0;z<x/2;z+=3){let U=k[z],H=k[z+1],Y=k[z+2];D.emplaceBack(U,H),D.emplaceBack(H,Y),D.emplaceBack(Y,U)}let A=g.bindVertexArrayOES.current,L=new nh;return L.buf=new i.I(g,D),L.lastUsedFrameIdx=o,this._storage.set(h.id,L),g.bindVertexArrayOES.set(A),L.buf}update(o){for(let[h,g]of this._storage)o-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(h))}destroy(){for(let[o,h]of this._storage)h.buf.destroy(),this._storage.delete(o)}}let bl=i.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class zy{constructor(o){let h=new i.cn,g=new i.bu;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1),g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),this.segments=i.b.simpleSegment(0,0,h.length,g.length),this.vx=o.createVertexBuffer(h,bl.members),this.idx=o.createIndexBuffer(g)}destroy(){this.vx.destroy(),this.idx.destroy()}}let ca={symbol:function(f,o,h,g,v){if(f.renderPass!=="translucent")return;let x=i.ag.disabled,S=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,L,z,U,H,Y,Z){let X=L.transform,Q=H==="map",re=Y==="map";for(let oe of A){let ae=U.getTile(oe),ge=ae.getBucket(z);if(!ge||!ge.text||!ge.text.segments.get().length)continue;let fe=i.aD(ge.textSizeData,X.zoom),ne=wc(oe,ge.getProjection(),X),se=X.calculatePixelsToTileUnitsMatrix(ae),le=dl(ne,ae.tileID.canonical,re,Q,X,ge.getProjection(),se),we=ge.hasIconTextFit()&&ge.hasIconData();if(fe){let Re=Math.pow(2,X.zoom-ae.tileID.overscaledZ);o_(ge,Q,re,Z,i.bO,X,le,oe,Re,fe,we)}}}(g,f,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v);let k=h.paint.get("icon-opacity").constantOr(1)!==0,D=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||D)?Fp(f,o,h,g,x,S):(k&&Fp(f,o,h,g,x,S,{onlyIcons:!0}),D&&Fp(f,o,h,g,x,S,{onlyText:!0}),function(A,L,z,U){if(!A.symbolParams.useOcclusionQueries)return;let H=A.context.gl,Y=A.transform,Z=z.paint,X=Z.get("icon-occlusion-opacity").constantOr(0),Q=Z.get("text-occlusion-opacity").constantOr(0);if(!z.hasInitialOcclusionOpacityProperties||X===1&&Q===1)return;let re=Y.projection.name==="globe";for(let oe of U){let ae=L.getTile(oe),ge=ae.getBucket(z);if(!ge||ge.projection.name==="mercator"&&re||ge.fullyClipped)continue;if(ge.projection.name==="globe"){i.w(`Occlusion not supported for globe mode. Layer: ${z.type}`);continue}let fe=wc(oe,ge.getProjection(),Y),ne=i.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,A.symbolParams.depthOffset,1),se=i.ad.multiply([],ne,fe),le=A.symbolParams.visualizeOcclusions!=="none"?1:A.symbolParams.occlusionQueryFrameWindow;for(let we=0;we<ge.symbolInstances.length;we++){let Re=ge.symbolInstances.get(we),me=A.style.placement.opacities[Re.crossTileID];if(me&&me.isHidden()||(A.frameCounter+we)%le!=0)continue;let Le=Re.tileAnchorX,Be=Re.tileAnchorY,Qe=Re.zOffset,Je;if(A.symbolParams.visualizeOcclusions==="none"){let gt=ge.queries.get(we);if(gt){if(!gt.isFree()){if(!gt.isResultAvailable())continue;let yt=gt.consumeResult();Re.occlusionState=yt===0?0:1;continue}Je=gt}else Je=new rc(A.context),ge.queries.set(we,Je)}let Ze=A.getOrCreateProgram("occlusion"),Te=A.symbolParams.occluderSize,Ve=n_(se,[Le,Be,Qe],[Y.width,Y.height],[Te,Te],A.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);A.terrain&&A.terrain.setupElevationDraw(ae,Ze,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),A.symbolParams.visualizeOcclusions==="none"&&Je&&Je.begin();let Ye=new i.ae(A.symbolParams.visualizeOcclusions==="zPass"?A.context.gl.ALWAYS:A.context.gl.LEQUAL,i.ae.ReadOnly,A.depthRangeFor3D);Ze.draw(A,H.TRIANGLES,Ye,i.ag.disabled,A.symbolParams.visualizeOcclusions!=="none"?i.a.alphaBlendedNonPremultiplied:i.a.disabled,i.af.disabled,Ve,"occlusion",A.occlusionBuffers.vx,A.occlusionBuffers.idx,A.occlusionBuffers.segments),A.symbolParams.visualizeOcclusions==="none"&&Je&&Je.end()}}}(f,o,h,g)),o.map.showCollisionBoxes&&(Kd(f,o,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Kd(f,o,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,h,g){if(f.renderPass!=="translucent")return;let v=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),S=h.paint.get("circle-stroke-opacity"),k=h.layout.get("circle-sort-key").constantOr(1)!==void 0,D=h.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||S.constantOr(1)===0))return;let A=f.context,L=A.gl,z=f.transform,U=f.depthModeForSublayer(0,i.ae.ReadOnly),H=i.ag.disabled,Y=f.colorModeForDrapableLayerRenderPass(D),Z=z.projection.name==="globe",X=[i.aj(z.center.lng),i.ak(z.center.lat)],Q=[];for(let oe=0;oe<g.length;oe++){let ae=g[oe],ge=o.getTile(ae),fe=ge.getBucket(h);if(!fe||fe.projection.name!==z.projection.name)continue;let ne=fe.programConfigurations.get(h.id),se=i.bR(h),le=f.isTileAffectedByFog(ae);Z&&se.push("PROJECTION_GLOBE_VIEW");let we=f.getOrCreateProgram("circle",{config:ne,defines:se,overrideFog:le}),Re=fe.layoutVertexBuffer,me=fe.globeExtVertexBuffer,Le=fe.indexBuffer,Be=z.projection.createInversionMatrix(z,ae.canonical),Qe={programConfiguration:ne,program:we,layoutVertexBuffer:Re,globeExtVertexBuffer:me,indexBuffer:Le,uniformValues:i.bS(f,ae,ge,Be,X,h),tile:ge};if(k){let Je=fe.segments.get();for(let Ze of Je)Q.push({segments:new i.b([Ze]),sortKey:Ze.sortKey,state:Qe})}else Q.push({segments:fe.segments,sortKey:0,state:Qe})}k&&Q.sort((oe,ae)=>oe.sortKey-ae.sortKey);let re={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(let oe of Q){let{programConfiguration:ae,program:ge,layoutVertexBuffer:fe,globeExtVertexBuffer:ne,indexBuffer:se,uniformValues:le,tile:we}=oe.state,Re=oe.segments;f.terrain&&f.terrain.setupElevationDraw(we,ge,re),f.uploadCommonUniforms(A,ge,we.tileID.toUnwrapped()),ge.draw(f,L.TRIANGLES,U,H,Y,i.af.disabled,le,h.id,fe,se,Re,h.paint,z.zoom,ae,[ne])}},heatmap:function(f,o,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let v=f.context,x=v.gl,S=i.ag.disabled,k=new i.a([x.ONE,x.ONE,x.ONE,x.ONE],i.C.transparent,[!0,!0,!0,!0]);(function(H,Y,Z,X){let Q=H.gl,re=Y.width*X,oe=Y.height*X;H.activeTexture.set(Q.TEXTURE1),H.viewport.set([0,0,re,oe]);let ae=Z.heatmapFbo;if(!ae||ae&&(ae.width!==re||ae.height!==oe)){ae&&ae.destroy();let ge=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,ge),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),ae=Z.heatmapFbo=H.createFramebuffer(re,oe,!0,null),function(fe,ne,se,le,we,Re){let me=fe.gl;me.texImage2D(me.TEXTURE_2D,0,fe.extRenderToTextureHalfFloat?me.RGBA16F:me.RGBA,we,Re,0,me.RGBA,fe.extRenderToTextureHalfFloat?me.HALF_FLOAT:me.UNSIGNED_BYTE,null),le.colorAttachment.set(se)}(H,0,ge,ae,re,oe)}else Q.bindTexture(Q.TEXTURE_2D,ae.colorAttachment.get()),H.bindFramebuffer.set(ae.framebuffer)})(v,f,h,f.transform.projection.name==="globe"?.5:.25),v.clear({color:i.C.transparent});let D=f.transform,A=D.projection.name==="globe",L=A?["PROJECTION_GLOBE_VIEW"]:[],z=A?i.af.frontCCW:i.af.disabled,U=[i.aj(D.center.lng),i.ak(D.center.lat)];for(let H=0;H<g.length;H++){let Y=g[H];if(o.hasRenderableParent(Y))continue;let Z=o.getTile(Y),X=Z.getBucket(h);if(!X||X.projection.name!==D.projection.name)continue;let Q=f.isTileAffectedByFog(Y),re=X.programConfigurations.get(h.id),oe=f.getOrCreateProgram("heatmap",{config:re,defines:L,overrideFog:Q}),{zoom:ae}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Z,oe),f.uploadCommonUniforms(v,oe,Y.toUnwrapped());let ge=D.projection.createInversionMatrix(D,Y.canonical);oe.draw(f,x.TRIANGLES,i.ae.disabled,S,k,z,pl(f,Y,Z,ge,U,ae,h.paint.get("heatmap-intensity")),h.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,h.paint,f.transform.zoom,re,A?[X.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,x){let S=v.context,k=S.gl,D=x.heatmapFbo;if(!D)return;S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,D.colorAttachment.get()),S.activeTexture.set(k.TEXTURE1);let A=x.colorRampTexture;A||(A=x.colorRampTexture=new i.T(S,x.colorRamp,k.RGBA)),A.bind(k.LINEAR,k.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,k.TRIANGLES,i.ae.disabled,i.ag.disabled,v.colorModeForRenderPass(),i.af.disabled,((L,z,U,H)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(f,h))},line:function(f,o,h,g){if(f.renderPass!=="translucent")return;let v=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let S=h.paint.get("line-emissive-strength"),k=h.paint.get("line-occlusion-opacity"),D=f.context,A=D.gl,L=h.layout.get("line-z-offset"),z=!L.isConstant()||!!L.constantOr(0),U=z?new i.ae(f.depthOcclusion?A.GREATER:A.LEQUAL,i.ae.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,i.ae.ReadOnly),H=f.colorModeForDrapableLayerRenderPass(S),Y=f.terrain&&f.terrain.renderingToTexture,Z=Y?1:i.e.devicePixelRatio,X=h.paint.get("line-dasharray"),Q=X.constantOr(1),re=h.layout.get("line-cap"),oe=X.constantOr(null),ae=re.constantOr(null),ge=h.paint.get("line-pattern"),fe=ge.constantOr(1),ne=ge.constantOr(null),se=h.paint.get("line-opacity").constantOr(1),le=!fe&&se!==1||f.depthOcclusion&&k>0&&k<1,we=h.paint.get("line-gradient"),Re=fe?"linePattern":"line",me=i.bT(h),Le;if(Y&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(le=!1),k!==0&&f.depthOcclusion){let Qe=h.paint._values["line-opacity"];Qe&&Qe.value&&Qe.value.kind==="constant"?Le=Qe.value:i.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}if(z&&(f.forceTerrainMode=!0),!z&&k!==0&&f.terrain&&!Y)return void i.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has non-zero line-z-offset.`);let Be=le&&z?f.stencilModeFor3D():i.ag.disabled;for(let Qe of g){let Je=o.getTile(Qe);if(fe&&!Je.patternsLoaded())continue;let Ze=Je.getBucket(h);if(!Ze)continue;f.prepareDrawTile();let Te=Ze.programConfigurations.get(h.id),Ve=f.isTileAffectedByFog(Qe),Ye=f.getOrCreateProgram(Re,{config:Te,defines:z?[...me,"ELEVATED"]:me,overrideFog:Ve});if(ne&&Je.imageAtlas){let Ge=Je.imageAtlas.patternPositions[ne.toString()];Ge&&Te.setConstantPatternPositions(Ge)}if(!fe&&oe&&ae&&Je.lineAtlas){let Ge=Je.lineAtlas.getDash(oe,ae);Ge&&Te.setConstantPatternPositions(Ge)}let[gt,yt]=h.paint.get("line-trim-offset");(ae==="round"||ae==="square")&&gt!==yt&&(gt===0&&(gt-=1),yt===1&&(yt+=1));let kt=Y?Qe.projMatrix:null,vt=fe?i.bU(f,Je,h,kt,Z,[gt,yt]):i.bV(f,Je,h,kt,Ze.lineClipsArray.length,Z,[gt,yt]);if(we){let Ge=Ze.gradients[h.id],Dt=Ge.texture;if(h.gradientVersion!==Ge.version){let oi=256;if(h.stepInterpolant){let ti=o.getSource().maxzoom,vi=Qe.canonical.z===ti?Math.ceil(1<<f.transform.maxZoom-Qe.canonical.z):1;oi=i.at(i.bW(Ze.maxLineLength/i.a3*1024*vi),256,D.maxTextureSize)}Ge.gradient=i.bX({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:oi,image:Ge.gradient||void 0,clips:Ze.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new i.T(D,Ge.gradient,A.RGBA),Ge.version=h.gradientVersion,Dt=Ge.texture}D.activeTexture.set(A.TEXTURE1),Dt.bind(h.stepInterpolant?A.NEAREST:A.LINEAR,A.CLAMP_TO_EDGE)}Q&&(D.activeTexture.set(A.TEXTURE0),Je.lineAtlasTexture&&Je.lineAtlasTexture.bind(A.LINEAR,A.REPEAT),Te.updatePaintBuffers()),fe&&(D.activeTexture.set(A.TEXTURE0),Je.imageAtlasTexture&&Je.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Te.updatePaintBuffers()),z&&f.terrain.setupElevationDraw(Je,Ye),f.uploadCommonUniforms(D,Ye,Qe.toUnwrapped());let it=Ge=>{Le!=null&&(Le.value=se*k),Ye.draw(f,A.TRIANGLES,U,Ge,H,i.af.disabled,vt,h.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,h.paint,f.transform.zoom,Te,[Ze.layoutVertexBuffer2,Ze.patternVertexBuffer,Ze.zOffsetVertexBuffer]),Le!=null&&(Le.value=se)};if(le&&!z){let Ge=f.stencilModeForClipping(Qe).ref;Ge===0&&Y&&D.clear({stencil:0});let Dt={func:A.EQUAL,mask:255};vt.u_alpha_discard_threshold=.8,it(new i.ag(Dt,Ge,255,A.KEEP,A.KEEP,A.INVERT)),vt.u_alpha_discard_threshold=0,it(new i.ag(Dt,Ge,255,A.KEEP,A.KEEP,A.KEEP))}else le&&z&&(vt.u_alpha_discard_threshold=.001),it(z?Be:f.stencilModeForClipping(Qe))}le&&(f.resetStencilClippingMasks(),Y&&D.clear({stencil:0})),k===0||f.depthOcclusion||Y||f.layersWithOcclusionOpacity.push(f.currentLayer),z&&(f.forceTerrainMode=!1)},fill:function(f,o,h,g){let v=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let S=h.paint.get("fill-emissive-strength"),k=f.colorModeForDrapableLayerRenderPass(S),D=h.paint.get("fill-pattern"),A=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&v.constantOr(i.C.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===A){let L=f.depthModeForSublayer(1,f.renderPass==="opaque"?i.ae.ReadWrite:i.ae.ReadOnly);zp(f,o,h,g,L,k,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){let L=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,i.ae.ReadOnly);zp(f,o,h,g,L,k,!0)}},"fill-extrusion":function(f,o,h,g){let v=h.paint.get("fill-extrusion-opacity"),x=f.context,S=x.gl,k=f.terrain,D=k&&k.renderingToTexture;if(v===0)return;let A=f.conflationActive&&f.style.isLayerClipped(h,o.getSource()),L=f.style.order.indexOf(h.fqid);if(A&&function(z,U,H,Y,Z){for(let X of Y){let Q=U.getTile(X).getBucket(H);Q&&(Q.updateReplacement(X,z.replacementSource,Z),Q.uploadCentroid(z.context))}}(f,o,h,g,L),k||A)for(let z of g){let U=o.getTile(z).getBucket(h);U&&Iu(f.context,o,z,U,h,k,A)}if(f.renderPass==="shadow"&&f.shadowRenderer){let z=f.shadowRenderer;if(k&&v<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.Z)return;let U=z.getShadowPassDepthMode(),H=z.getShadowPassColorMode();Sc(f,o,h,g,U,i.ag.disabled,H,A)}else if(f.renderPass==="translucent"){let z=!h.paint.get("fill-extrusion-pattern").constantOr(1),U=h.paint.get("fill-extrusion-color").constantOr(i.C.white);if(!D&&U.a!==0){let H=new i.ae(f.context.gl.LEQUAL,i.ae.ReadWrite,f.depthRangeFor3D);v===1&&z?Sc(f,o,h,g,H,i.ag.disabled,i.a.unblended,A):(Sc(f,o,h,g,H,i.ag.disabled,i.a.disabled,A),Sc(f,o,h,g,H,f.stencilModeFor3D(),f.colorModeForRenderPass(),A),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&z&&(!k&&f.transform.projection.name!=="globe"||D)){let H=h.paint.get("fill-extrusion-opacity"),Y=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=h.paint.get("fill-extrusion-flood-light-intensity"),Q=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(h.lut).toArray01().slice(0,3),re=Y>0&&Z>0,oe=X>0,ae=(fe,ne,se)=>(1-se)*fe+se*ne,ge=fe=>{let ne=f.depthModeForSublayer(1,i.ae.ReadOnly,S.LEQUAL,!0),se=h.paint.get(fe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),le=ae(.1,3,se),we=f._showOverdrawInspector;if(!we){let Re=new i.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),me=new i.a([S.ONE,S.ONE,S.ONE,S.ONE],i.C.transparent,[!1,!1,!1,!0],S.MIN);oo(f,o,h,g,ne,Re,me,i.af.disabled,fe,"sdf",H,Y,Z,X,Q,le,A,!1)}{let Re=we?i.ag.disabled:new i.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),me=we?f.colorModeForRenderPass():new i.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],i.C.transparent,[!0,!0,!0,!0]);oo(f,o,h,g,ne,Re,me,i.af.disabled,fe,"color",H,Y,Z,X,Q,le,A,!1)}};if(D){let fe=(ne,se,le)=>{let we=f.depthModeForSublayer(1,i.ae.ReadOnly,S.LEQUAL,!1),Re=h.paint.get(ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),me=ae(.1,3,Re);{let Le=new i.a([S.ONE,S.ONE,S.ONE,S.ONE],i.C.transparent,[!1,!1,!1,!0]);oo(f,o,h,g,we,i.ag.disabled,Le,i.af.disabled,ne,"clear",H,Y,Z,X,Q,me,A,se)}{let Le=new i.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Be=new i.a([S.ONE,S.ONE,S.ONE,S.ONE],i.C.transparent,[!1,!1,!1,!0],S.MIN);oo(f,o,h,g,we,Le,Be,i.af.disabled,ne,"sdf",H,Y,Z,X,Q,me,A,se)}{let Le=ne?S.ZERO:S.ONE_MINUS_DST_ALPHA,Be=new i.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Qe=new i.a([Le,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],i.C.transparent,[!0,!0,!0,!0]);oo(f,o,h,g,we,Be,Qe,i.af.disabled,ne,"color",H,Y,Z,X,Q,me,A,se)}{let Le=new i.a([S.ONE,S.ONE,S.ONE,ne?S.ZERO:S.ONE],i.C.transparent,[!1,!1,!1,!0],ne?S.FUNC_ADD:S.MAX);oo(f,o,h,g,we,i.ag.disabled,Le,i.af.disabled,ne,"clear",H,Y,Z,X,Q,me,A,se,le)}};if(re||oe){let ne;if(f.prepareDrawTile(),k){let se=k.drapeBufferSize[0],le=k.drapeBufferSize[1];ne=k.framebufferCopyTexture,ne&&(!ne||ne.size[0]===se&&ne.size[1]===le)||(ne&&ne.destroy(),ne=k.framebufferCopyTexture=new i.T(x,new i.i({width:se,height:le}),S.RGBA)),ne.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,se,le,0)}re&&fe(!0,!1,ne),oe&&fe(!1,!0,ne)}}else re&&ge(!0),oe&&ge(!1)}}},hillshade:function(f,o,h,g){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;let v=f.context,x=f.terrain&&f.terrain.renderingToTexture,[S,k]=f.renderPass!=="translucent"||x?[{},g]:f.stencilConfigForOverlap(g);for(let D of k){let A=o.getTile(D);if(A.needsHillshadePrepare&&f.renderPass==="offscreen")wa(f,A,h);else if(f.renderPass==="translucent"){let L=f.depthModeForSublayer(0,i.ae.ReadOnly),z=h.paint.get("hillshade-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(z),H=x&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):S[D.overscaledZ];Ey(f,D,A,h,L,H,U)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,o,h,g,v,x){if(f.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;let S=f.transform.projection.name==="globe",k=h.paint.get("raster-elevation")!==0,D=k&&S;if(f.renderElevatedRasterBackface&&!D)return;let A=f.context,L=A.gl,z=o.getSource(),U=function(fe,ne,se,le){let we=ne.paint.get("raster-color"),Re=fe.type==="raster-array",me=[],Le=ne.paint.get("raster-resampling"),Be=ne.paint.get("raster-color-mix"),Qe=ne.paint.get("raster-color-range"),Je=[Be[0],Be[1],Be[2],0],Ze=Be[3],Te=Le==="nearest"?le.NEAREST:le.LINEAR;if(Re&&(me.push("RASTER_ARRAY"),we||me.push("RASTER_COLOR"),Le==="linear"&&me.push("RASTER_ARRAY_LINEAR"),Te=le.NEAREST,!Qe&&fe.rasterLayers)){let Ve=fe.rasterLayers.find(({id:Ye})=>Ye===ne.sourceLayer);Ve&&Ve.fields&&Ve.fields.range&&(Qe=Ve.fields.range)}if(Qe=Qe||[0,1],we){me.push("RASTER_COLOR"),se.activeTexture.set(le.TEXTURE2),ne.updateColorRamp(Qe);let Ve=ne.colorRampTexture;Ve||(Ve=ne.colorRampTexture=new i.T(se,ne.colorRamp,le.RGBA)),Ve.bind(le.LINEAR,le.CLAMP_TO_EDGE)}return{mix:Je,range:Qe,offset:Ze,defines:me,resampling:Te}}(z,h,A,L);if(z instanceof i.bm&&!g.length&&!S)return;let H=h.paint.get("raster-emissive-strength"),Y=f.colorModeForDrapableLayerRenderPass(H),Z=f.terrain&&f.terrain.renderingToTexture,X=!f.options.moving,Q=h.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(z instanceof i.bm&&!g.length&&(z.onNorthPole||z.onSouthPole)){let fe=k?f.stencilModeFor3D():i.ag.disabled;return void eh(!!z.onNorthPole,null,f,o,h,H,U,i.af.disabled,fe)}if(!g.length)return;let[re,oe]=z instanceof i.bm||Z?[{},g]:f.stencilConfigForOverlap(g),ae=oe[oe.length-1].overscaledZ;D&&U.defines.push("PROJECTION_GLOBE_VIEW"),k&&U.defines.push("RENDER_CUTOFF");let ge=(fe,ne,se)=>{for(let le of fe){let we=le.toUnwrapped(),Re=o.getTile(le);if(Z&&(!Re||!Re.hasData()))continue;A.activeTexture.set(L.TEXTURE0);let me=Ly(Re,z,h,U);if(!me||!me.texture)continue;let{texture:Le,mix:Be,offset:Qe,tileSize:Je,buffer:Ze}=me,Te,Ve;Z?(Te=i.ae.disabled,Ve=le.projMatrix):k?(Te=new i.ae(L.LEQUAL,i.ae.ReadWrite,f.depthRangeFor3D),Ve=S?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(we,X)):(Te=f.depthModeForSublayer(le.overscaledZ-ae,h.paint.get("raster-opacity")===1?i.ae.ReadWrite:i.ae.ReadOnly,L.LESS),Ve=f.transform.calculateProjMatrix(we,X));let Ye=f.terrain&&Z?f.terrain.stencilModeForRTTOverlap(le):re[le.overscaledZ],gt=x?0:h.paint.get("raster-fade-duration");Re.registerFadeDuration(gt);let yt=o.findLoadedParent(le,0),kt=_u(Re,yt,o,f.transform,gt),vt,it;f.terrain&&f.terrain.prepareDrawTile(),A.activeTexture.set(L.TEXTURE0),Le.bind(Q,L.CLAMP_TO_EDGE),A.activeTexture.set(L.TEXTURE1),yt?(yt.texture&&yt.texture.bind(Q,L.CLAMP_TO_EDGE),vt=Math.pow(2,yt.tileID.overscaledZ-Re.tileID.overscaledZ),it=[Re.tileID.canonical.x*vt%1,Re.tileID.canonical.y*vt%1]):Le.bind(Q,L.CLAMP_TO_EDGE),Le.useMipmap&&A.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);let Ge=f.transform,Dt,oi=k?Bi(Ge):[0,0,0,0],ti,vi,Di,Ji,Qt,Gi=0;if(D&&z instanceof i.bm&&z.coordinates.length>3)ti=Float32Array.from(i.bf(i.bg(new i.aO(0,0,0)))),vi=Float32Array.from(Ge.globeMatrix),Di=Float32Array.from(i.bb(Ge)),Ji=[i.aj(Ge.center.lng),i.ak(Ge.center.lat)],Dt=z.elevatedGlobePerspectiveTransform,Qt=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){let ii=i.bc(le.canonical);Gi=i.bd(ii.getCenter().lat),ti=Float32Array.from(i.bf(i.bg(le.canonical))),vi=Float32Array.from(Ge.globeMatrix),Di=Float32Array.from(i.bb(Ge)),Ji=[i.aj(Ge.center.lng),i.ak(Ge.center.lat)],Dt=[0,0],Qt=Float32Array.from(i.be(le.canonical,ii,Gi,Ge.worldSize/Ge._pixelsPerMercatorPixel))}else Dt=z instanceof i.bm?z.perspectiveTransform:[0,0],ti=new Float32Array(16),vi=new Float32Array(9),Di=new Float32Array(16),Ji=[0,0],Qt=new Float32Array(9);let dn=Yd(Ve,ti,vi,Di,Qt,it||[0,0],i.a1(f.transform.zoom),Ji,oi,vt||1,kt,h,Dt,k?h.paint.get("raster-elevation"):0,2,Be,Qe,U.range,Je,Ze,H),Qi=f.isTileAffectedByFog(le),Ci=f.getOrCreateProgram("raster",{defines:U.defines,overrideFog:Qi});if(f.uploadCommonUniforms(A,Ci,we),z instanceof i.bm){let ii=z.elevatedGlobeVertexBuffer,gn=z.elevatedGlobeIndexBuffer;if(Z||!S)z.boundsBuffer&&z.boundsSegments&&Ci.draw(f,L.TRIANGLES,Te,i.ag.disabled,Y,i.af.disabled,dn,h.id,z.boundsBuffer,f.quadTriangleIndexBuffer,z.boundsSegments);else if(ii&&gn){let xn=Ge.zoom<=i.b1?z.elevatedGlobeSegments:z.getSegmentsForLongitude(Ge.center.lng);xn&&Ci.draw(f,L.TRIANGLES,Te,i.ag.disabled,Y,ne,dn,h.id,ii,gn,xn)}}else if(D){Te=new i.ae(L.LEQUAL,i.ae.ReadOnly,f.depthRangeFor3D);let ii=f.globeSharedBuffers;if(ii){let[gn,xn,nn]=ii.getGridBuffers(Gi,!1);Ci.draw(f,L.TRIANGLES,Te,se||Ye,f.colorModeForRenderPass(),ne,dn,h.id,gn,xn,nn)}}else{let{tileBoundsBuffer:ii,tileBoundsIndexBuffer:gn,tileBoundsSegments:xn}=f.getTileBoundsBuffers(Re);Ci.draw(f,L.TRIANGLES,Te,Ye,Y,i.af.disabled,dn,h.id,ii,gn,xn)}}if(!(z instanceof i.bm)&&D)for(let le of fe){let we=le.canonical.y===(1<<le.canonical.z)-1;le.canonical.y===0&&eh(!0,le,f,o,h,H,U,ne,se||i.ag.disabled),we&&eh(!1,le,f,o,h,H,U,ne===i.af.frontCW?i.af.backCW:i.af.frontCW,se||i.ag.disabled)}};D?ge(oe,f.renderElevatedRasterBackface?i.af.backCW:i.af.frontCW,f.stencilModeFor3D()):ge(oe,i.af.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,o,h,g,v,x){f.renderPass==="offscreen"&&function(S,k,D,A){if(!A.length)return;let L=S.context,z=L.gl,U=k.getSource();if(!(U instanceof bc))return;let H=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count"))),Y=D.particlePositionRGBAImage;if(!Y||Y.width!==H){let oe=function(ae){let ge=ae*ae,fe=new Uint8Array(4*ge),ne=function(le){return le|=0,le=Math.imul(2747636419^le,2654435769),le=Math.imul(le^le>>>16,2654435769),((le=Math.imul(le^le>>>16,2654435769))>>>0)/4294967296},se=1/1.3;for(let le=0;le<ge;le++){let we=se*(ne(2*le+0)+Es),Re=se*(ne(2*le+1)+Es),me=255*we%1,Le=255*Re%1,Be=me,Qe=Re-Le/255,Je=Le;fe[4*le+0]=255*(we-me/255),fe[4*le+1]=255*Be,fe[4*le+2]=255*Qe,fe[4*le+3]=255*Je}return fe}(H);Y=D.particlePositionRGBAImage=new i.i({width:H,height:H},oe)}let Z=D.particleFramebuffer;Z?Z.width!==H&&(Z.destroy(),Z=D.particleFramebuffer=L.createFramebuffer(H,H,!0,null)):Z=D.particleFramebuffer=L.createFramebuffer(H,H,!0,null);let X=[];for(let oe of A){let ae=k.getTile(oe);if(!(ae instanceof i.c3))continue;let ge=Wt(ae,U,D);if(!ge)continue;let fe=[ae.tileSize,ae.tileSize],ne=D.tileFramebuffer;ne||(ne=D.tileFramebuffer=L.createFramebuffer(fe[0],fe[1],!0,null));let se=ae.rasterParticleState;se||(se=ae.rasterParticleState=new zo(L,oe,fe,Y));let le=se.update(D.lastInvalidatedAt);se.particleTextureDimension!==H&&se.updateParticleTexture(oe,Y);let we=se.targetColorTexture;se.targetColorTexture=se.backgroundColorTexture,se.backgroundColorTexture=we;let Re=se.particleTexture0;se.particleTexture0=se.particleTexture1,se.particleTexture1=Re,X.push([oe,ge,se,le])}if(X.length===0)return;let Q=i.e.now(),re=D.previousDrawTimestamp?.001*(Q-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=Q,D.hasColorMap()){L.activeTexture.set(z.TEXTURE0+2);let oe=D.colorRampTexture;oe||(oe=D.colorRampTexture=new i.T(L,D.colorRamp,z.RGBA)),oe.bind(z.LINEAR,z.CLAMP_TO_EDGE)}L.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(oe,ae,ge){let fe=oe.context,ne=fe.gl,se=ae.tileFramebuffer;fe.activeTexture.set(ne.TEXTURE0);let le={u_texture:0,u_opacity:1.05*(Re=ae.paint.get("raster-particle-fade-opacity-factor"))/(Re+.05)},we=oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Re;for(let me of ge){let[,,Le,Be]=me;se.colorAttachment.set(Le.targetColorTexture.texture),fe.viewport.set([0,0,se.width,se.height]),fe.clear({color:i.C.transparent}),Be&&(Le.backgroundColorTexture.bind(ne.NEAREST,ne.CLAMP_TO_EDGE),we.draw(oe,ne.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.alphaBlended,i.af.disabled,le,ae.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments))}}(S,D,X),function(oe,ae,ge,fe){let ne=oe.context,se=ne.gl,le=ge.tileFramebuffer,we=oe.transform.projection.name==="globe",Re=ge.paint.get("raster-particle-max-speed");for(let me of fe){let[Le,Be,Qe]=me;ne.activeTexture.set(se.TEXTURE0+0),Be.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE),le.colorAttachment.set(Qe.targetColorTexture.texture);let Je=oe.getOrCreateProgram("rasterParticleDraw",{defines:Be.defines,overrideFog:!1});ne.activeTexture.set(se.TEXTURE0+1);let Ze=Be.scalarData?[]:[0,1,2,3].map(Ye=>i.bZ[Ye](Le));Ze.push(Le);let Te=Le.canonical.x,Ve=Le.canonical.y;for(let Ye of Ze){let gt=ae.getTile(we?Ye.wrapped():Ye);if(!gt)continue;let yt=gt.rasterParticleState;if(!yt)continue;let kt=Ye.canonical.x+(1<<Ye.canonical.z)*(Ye.wrap-Le.wrap),vt=Ye.canonical.y;yt.particleTexture0.bind(se.NEAREST,se.CLAMP_TO_EDGE);let it=Rp(1,yt.particleTexture0.size[0],[kt-Te,vt-Ve],0,Be.texture.size,2,Re,Be.textureOffset,Be.scale,Be.offset);Je.draw(oe,se.POINTS,i.ae.disabled,i.ag.disabled,i.a.alphaBlended,i.af.disabled,it,ge.id,yt.particleIndexBuffer,void 0,yt.particleSegment)}}}(S,k,D,X),L.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(oe,ae,ge,fe){let ne=oe.context,se=ne.gl,le=ae.paint.get("raster-particle-max-speed"),we=fe*ae.paint.get("raster-particle-speed-factor")*.15,Re=function(Le){return Math.pow(Le,6)}(.01+1*ae.paint.get("raster-particle-reset-rate-factor")),me=ae.particleFramebuffer;ne.viewport.set([0,0,me.width,me.height]);for(let Le of ge){let[,Be,Qe]=Le;ne.activeTexture.set(se.TEXTURE0+0),Be.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE),ne.activeTexture.set(se.TEXTURE0+1);let Je=Qe.particleTexture0;Je.bind(se.NEAREST,se.CLAMP_TO_EDGE);let Ze=Ay(1,Je.size[0],0,Be.texture.size,le,we,Re,Be.textureOffset,Be.scale,Be.offset);me.colorAttachment.set(Qe.particleTexture1.texture),ne.clear({color:i.C.transparent}),oe.getOrCreateProgram("rasterParticleUpdate",{defines:Be.defines}).draw(oe,se.TRIANGLES,i.ae.disabled,i.ag.disabled,i.a.unblended,i.af.disabled,Ze,ae.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments)}}(S,D,X,re)}(f,o,h,g),f.renderPass==="translucent"&&(function(S,k,D,A,L){let z=S.context,U=z.gl,H=!S.options.moving,Y=S.transform.projection.name==="globe";if(!A.length)return;let[Z,X]=S.stencilConfigForOverlap(A),Q=[];Y&&Q.push("PROJECTION_GLOBE_VIEW");let re=S.stencilModeFor3D();for(let oe of X){let ae=oe.toUnwrapped(),ge=k.getTile(oe);if(!ge.rasterParticleState)continue;let fe=ge.rasterParticleState,ne=100;ge.registerFadeDuration(ne);let se=k.findLoadedParent(oe,0),le=_u(ge,se,k,S.transform,ne),we,Re;S.terrain&&S.terrain.prepareDrawTile(),z.activeTexture.set(U.TEXTURE0),fe.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),z.activeTexture.set(U.TEXTURE1),se&&se.rasterParticleState?(se.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),we=Math.pow(2,se.tileID.overscaledZ-ge.tileID.overscaledZ),Re=[ge.tileID.canonical.x*we%1,ge.tileID.canonical.y*we%1]):fe.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let me=Y?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(ae,H),Le=S.transform,Be=s_(Le),Qe=i.bc(oe.canonical),Je=i.bd(Qe.getCenter().lat),Ze,Te,Ve,Ye,gt;Y?(Ze=Float32Array.from(i.bf(i.bg(oe.canonical))),Te=Float32Array.from(Le.globeMatrix),Ve=Float32Array.from(i.bb(Le)),Ye=[i.aj(Le.center.lng),i.ak(Le.center.lat)],gt=Float32Array.from(i.be(oe.canonical,Qe,Je,Le.worldSize/Le._pixelsPerMercatorPixel))):(Ze=new Float32Array(16),Te=new Float32Array(9),Ve=new Float32Array(16),Ye=[0,0],gt=new Float32Array(9));let yt=Op(me,Ze,Te,Ve,gt,Re||[0,0],i.a1(S.transform.zoom),Ye,Be,we||1,le,250),kt=S.isTileAffectedByFog(oe),vt=S.getOrCreateProgram("rasterParticle",{defines:Q,overrideFog:kt});if(S.uploadCommonUniforms(z,vt,ae),Y){let it=new i.ae(U.LEQUAL,i.ae.ReadWrite,S.depthRangeFor3D),Ge=0,Dt=S.globeSharedBuffers;if(Dt){let[oi,ti,vi]=Dt.getGridBuffers(Je,Ge!==0);vt.draw(S,U.TRIANGLES,it,re,i.a.alphaBlended,i.af.backCCW,yt,D.id,oi,ti,vi)}}else{let it=S.depthModeForSublayer(0,i.ae.ReadOnly),Ge=Z[oe.overscaledZ],{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:oi,tileBoundsSegments:ti}=S.getTileBoundsBuffers(ge);vt.draw(S,U.TRIANGLES,it,Ge,i.a.alphaBlended,i.af.disabled,yt,D.id,Dt,oi,ti)}}S.resetStencilClippingMasks()}(f,o,h,g),f.style.map.triggerRepaint())},background:function(f,o,h,g){let v=h.paint.get("background-color"),x=h.paint.get("background-opacity"),S=h.paint.get("background-emissive-strength");if(x===0)return;let k=f.context,D=k.gl,A=f.transform,L=A.tileSize,z=h.paint.get("background-pattern"),U;if(z!==void 0&&(z===null||(U=f.imageManager.getPattern(z.toString(),h.scope,f.style.getLut(h.scope)),!U)))return;let H=!z&&v.a===1&&x===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==H)return;let Y=i.ag.disabled,Z=f.depthModeForSublayer(0,H==="opaque"?i.ae.ReadWrite:i.ae.ReadOnly),X=f.colorModeForDrapableLayerRenderPass(S),Q=z?"backgroundPattern":"background",re,oe=g;oe||(re=f.getBackgroundTiles(),oe=Object.values(re).map(ae=>ae.tileID)),z&&(k.activeTexture.set(D.TEXTURE0),f.imageManager.bind(f.context,h.scope));for(let ae of oe){let ge=f.isTileAffectedByFog(ae),fe=f.getOrCreateProgram(Q,{overrideFog:ge}),ne=ae.toUnwrapped(),se=g?ae.projMatrix:f.transform.calculateProjMatrix(ne);f.prepareDrawTile();let le=o?o.getTile(ae):re?re[ae.key]:new i.by(ae,L,A.zoom,f),we=z?t_(se,S,x,f,0,h.scope,U,{tileID:ae,tileSize:L}):Xd(se,S,x,v.toRenderColor(h.lut));f.uploadCommonUniforms(k,fe,ne);let{tileBoundsBuffer:Re,tileBoundsIndexBuffer:me,tileBoundsSegments:Le}=f.getTileBoundsBuffers(le);fe.draw(f,D.TRIANGLES,Z,Y,X,i.af.disabled,we,h.id,Re,me,Le)}},sky:function(f,o,h){let g=f._atmosphere?i.a1(f.transform.zoom):1,v=h.paint.get("sky-opacity")*g;if(v===0)return;let x=f.context,S=h.paint.get("sky-type"),k=new i.ae(x.gl.LEQUAL,i.ae.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?h.needsSkyboxCapture(f)&&(function(A,L,z,U){let H=A.context,Y=H.gl,Z=L.skyboxFbo;if(!Z){Z=L.skyboxFbo=H.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Ic(H),L.skyboxTexture=H.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,L.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let oe=0;oe<6;++oe)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(Z.framebuffer),H.viewport.set([0,0,32,32]);let X=L.getCenter(A,!0),Q=A.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);i.ad.identity(re),i.ad.rotateY(re,re,.5*-Math.PI),ka(A,L,Q,re,X,0),i.ad.identity(re),i.ad.rotateY(re,re,.5*Math.PI),ka(A,L,Q,re,X,1),i.ad.identity(re),i.ad.rotateX(re,re,.5*-Math.PI),ka(A,L,Q,re,X,2),i.ad.identity(re),i.ad.rotateX(re,re,.5*Math.PI),ka(A,L,Q,re,X,3),i.ad.identity(re),ka(A,L,Q,re,X,4),i.ad.identity(re),i.ad.rotateY(re,re,Math.PI),ka(A,L,Q,re,X,5),H.viewport.set([0,0,A.width,A.height])}(f,h),h.markSkyboxValid(f)):f.renderPass==="sky"&&function(A,L,z,U,H){let Y=A.context,Z=Y.gl,X=A.transform,Q=A.getOrCreateProgram("skybox");Y.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,L.skyboxTexture);let re=((oe,ae,ge,fe,ne)=>({u_matrix:oe,u_sun_direction:ae,u_cubemap:0,u_opacity:fe,u_temporal_offset:ne}))(X.skyboxMatrix,L.getCenter(A,!1),0,U,H);A.uploadCommonUniforms(Y,Q),Q.draw(A,Z.TRIANGLES,z,i.ag.disabled,A.colorModeForRenderPass(),i.af.backCW,re,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,h,k,v,D):S==="gradient"&&f.renderPass==="sky"&&function(A,L,z,U,H){let Y=A.context,Z=Y.gl,X=A.transform,Q=A.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Ic(Y)),Y.activeTexture.set(Z.TEXTURE0);let re=L.colorRampTexture;re||(re=L.colorRampTexture=new i.T(Y,L.colorRamp,Z.RGBA)),re.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let oe=((ae,ge,fe,ne,se)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:ge,u_radius:i.ab(fe),u_opacity:ne,u_temporal_offset:se}))(X.skyboxMatrix,L.getCenter(A,!1),L.paint.get("sky-gradient-radius"),U,H);A.uploadCommonUniforms(Y,Q),Q.draw(A,Z.TRIANGLES,z,i.ag.disabled,A.colorModeForRenderPass(),i.af.backCW,oe,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,h,k,v,D)},debug:function(f,o,h,g,v,x){for(let S=0;S<h.length;S++)if(v){let A=new i.C(g.r*.8,g.g*.8,g.b*.8,1);Tt(f,o,h[S],g,-1,-1,x),Tt(f,o,h[S],g,-1,1,x),Tt(f,o,h[S],g,1,1,x),Tt(f,o,h[S],g,1,-1,x),Tt(f,o,h[S],A,0,0,x)}else Tt(f,o,h[S],g,0,0,x)},custom:function(f,o,h,g){let v=f.context,x=h.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&h.isDraped(o)){if(f.renderPass==="offscreen"){let S=x.prerender;if(S){if(f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){let k=f.transform.pointMerc;S.call(x,v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.a1(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else S.call(x,v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){let k=x.renderToTile;if(k){let D=g[0].canonical,A=new i.Y(D.x+g[0].wrap*(1<<D.z),D.y,D.z);v.setDepthMode(i.ae.disabled),v.setStencilMode(i.ag.disabled),v.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),k.call(x,v.gl,A),v.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),v.setStencilMode(i.ag.disabled);let S=x.renderingMode==="3d"?new i.ae(f.context.gl.LEQUAL,i.ae.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,i.ae.ReadOnly);if(v.setDepthMode(S),f.transform.projection.name==="globe"){let k=f.transform.pointMerc;x.render(v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.a1(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else x.render(v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState(),v.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,o,h,g){if(f.renderPass==="opaque")return;let v=h.paint.get("model-opacity");if(v===0)return;let x=h.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!x||f.terrain&&v<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof i.Z))return;let S=f.shadowRenderer,k=h.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,k||(S.enabled=!1));let D=()=>{S&&(S.useNormalOffset=!0,k||(S.enabled=!0))},A=o.getSource();if(f.renderPass==="light-beam"&&A.type!=="batched-model")return;if(A.type==="vector"||A.type==="geojson")return function(Q,re,oe,ae,ge){let fe=Q.transform;if(fe.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${fe.projection.name} projection is not yet implemented`);let ne=fe.getFreeCameraOptions().position;if(!Q.modelManager)return;let se=Q.modelManager;oe.modelManager=se;let le=Q.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let we=oe._unevaluatedLayout._values["model-id"],Re=Zi({},oe.layout.get("model-id").parameters),me=Q.style.order.indexOf(oe.fqid);for(let Le of ae){let Be=re.getTile(Le).getBucket(oe);if(!Be||Be.projection.name!==fe.projection.name)continue;let Qe=Be.getModelUris();Qe&&!Be.modelsRequested&&(se.addModelsFromBucket(Qe,ge),Be.modelsRequested=!0);let Je=sr(Le,fe);Re.zoom=Je;let Ze=we.possiblyEvaluate(Re);if(l_(Q,Be,Le),lo.shadowUniformsInitialized=!1,lo.useSingleShadowCascade=!!le&&le.getMaxCascadeForTile(Le.toUnwrapped())===0,Q.renderPass==="shadow"&&le){if(Q.currentShadowCascade===1&&Be.isInsideFirstShadowMapFrustum)continue;let Ye=fe.calculatePosMatrix(Le.toUnwrapped(),fe.worldSize);if(lo.tileMatrix.set(Ye),lo.shadowTileMatrix=Float32Array.from(le.calculateShadowPassMatrixFromMatrix(Ye)),lo.aabb.min.fill(0),lo.aabb.max[0]=lo.aabb.max[1]=i.a3,lo.aabb.max[2]=0,gr(Be,lo,Q,oe.scope))continue}let Te=1<<Le.canonical.z,Ve=[((ne.x-Le.wrap)*Te-Le.canonical.x)*i.a3,(ne.y*Te-Le.canonical.y)*i.a3,ne.z*Te*i.a3];Q.conflationActive&&Object.keys(Be.instancesPerModel).length>0&&Q.style.isLayerClipped(oe,re.getSource())&&Be.updateReplacement(Le,Q.replacementSource,me)&&(Be.uploaded=!1,Be.upload(Q.context));for(let Ye in Be.instancesPerModel){let gt=Be.instancesPerModel[Ye];gt.features.length>0&&(Ye=Ze.evaluate(gt.features[0].feature,{}));let yt=se.getModel(Ye,ge);if(yt&&yt.uploaded)for(let kt of yt.nodes)jo(Q,oe,kt,gt,Ve,Le,lo)}}}(f,o,h,g,A.type==="vector"?h.scope:""),void D();if(!A.loaded())return;if(A.type==="batched-model")return function(Q,re,oe,ae){oe.resetLayerRenderingStats(Q);let ge=Q.context,fe=Q.transform,ne=Q.style.fog,se=Q.shadowRenderer;if(fe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${fe.projection.name} projection is not yet implemented`);let le=Q.transform.getFreeCameraOptions().position,we=i._.scale([],[le.x,le.y,le.z],Q.transform.worldSize);i._.negate(we,we);let Re=i.ad.identity([]),me=i.cg(fe.center.lat,fe.zoom),Le=i.ad.fromScaling([],[1,1,1/me]);i.ad.translate(Re,Re,we);let Be=oe.paint.get("model-opacity"),Qe=new i.ae(ge.gl.LEQUAL,i.ae.ReadWrite,Q.depthRangeFor3D),Je=new i.ae(ge.gl.LEQUAL,i.ae.ReadOnly,Q.depthRangeFor3D),Ze=new i.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Te=Q.renderPass==="shadow",Ve=Te&&se?se.getCurrentCascadeFrustum():fe.getFrustum(fe.scaleZoom(fe.worldSize)),Ye=oe.paint.get("model-front-cutoff"),gt=Ye[2]<1,yt=$a(Q,oe.paint.get("model-cutoff-fade-range")),kt=oe.getLayerRenderingStats();(function(vt,it,Ge,Dt){let oi=vt.terrain?vt.terrain.exaggeration():0,ti=vt.transform.zoom;for(let vi of Dt){let Di=it.getTile(vi).getBucket(Ge);Di&&(vt.conflationActive&&Di.updateReplacement(vi,vt.replacementSource),Di.evaluateScale(vt,Ge),vt.terrain&&oi>0&&Di.elevationUpdate(vt.terrain,oi,vi,Ge.source),Di.needsReEvaluation(vt,ti,Ge)&&Di.evaluate(Ge))}})(Q,re,oe,ae),function(){let vt,it,Ge;gt?(vt=ae.length-1,it=-1,Ge=-1):(vt=0,it=ae.length,Ge=1);for(let Dt=vt;Dt!==it;Dt+=Ge){let oi=ae[Dt],ti=re.getTile(oi).getBucket(oe);if(!ti||!ti.uploaded)continue;let vi=!1;se&&(vi=se.getMaxCascadeForTile(oi.toUnwrapped())===0);let Di=fe.calculatePosMatrix(oi.toUnwrapped(),fe.worldSize),Ji=ti.modelTraits,Qt=[];for(let Gi of ti.getNodesInfo()){if(Gi.hiddenByReplacement||!Gi.node.meshes)continue;let dn=Gi.node,Qi=0;Q.terrain&&dn.elevation&&(Qi=dn.elevation*Q.terrain.exaggeration());let Ci=Gi.evaluatedScale;if(Ci[0]<=1&&Ci[1]<=1&&Ci[2]<=1&&(()=>{let Pe=Gi.aabb;return Ze.min=[...Pe.min],Ze.max=[...Pe.max],Ze.min[2]+=Qi,Ze.max[2]+=Qi,i._.transformMat4(Ze.min,Ze.min,Di),i._.transformMat4(Ze.max,Ze.max,Di),Ze})().intersects(Ve)===0)continue;let ii=[...Di],gn=dn.anchor?dn.anchor[0]:0,xn=dn.anchor?dn.anchor[1]:0;i.ad.translate(ii,ii,[gn*(Ci[0]-1),xn*(Ci[1]-1),Qi]),i._.exactEquals(Ci,i.cj)||i.ad.scale(ii,ii,Ci);let nn=i.ad.multiply([],ii,dn.matrix),Ke=i.ad.multiply([],fe.expandedFarZProjMatrix,nn),St=i.ad.multiply([],fe.expandedFarZProjMatrix,ii),Dn=i.aA.transformMat4([],[gn,xn,Qi,1],Ke)[2];dn.hidden=!1;let qi=Be;Te||(gt&&(qi*=la(ii,fe,Gi.aabb,Ye)),qi*=Up(yt,Dn)),qi!==0?Qt.push({nodeInfo:Gi,depth:Dn,opacity:qi,wvpForNode:Ke,wvpForTile:St,nodeModelMatrix:nn,tileModelMatrix:ii}):dn.hidden=!0}Te||Qt.sort((Gi,dn)=>!gt||Gi.opacity===1&&dn.opacity===1?Gi.depth<dn.depth?-1:1:Gi.opacity===1?-1:dn.opacity===1?1:Gi.depth>dn.depth?-1:1);for(let Gi of Qt){let dn=Gi.nodeInfo,Qi=dn.node,Ci=i.ad.multiply([],Le,Gi.tileModelMatrix);i.ad.multiply(Ci,Re,Ci);let ii=i.ad.invert([],Ci);i.ad.transpose(ii,ii),i.ad.scale(ii,ii,Xa),Ci=i.ad.multiply(Ci,Ci,Qi.matrix);let gn=Q.renderPass==="light-beam",xn=Ji&i.cl.HasMapboxMeshFeatures,nn=xn?0:dn.evaluatedRMEA[0][2];for(let Ke=0;Ke<Qi.meshes.length;++Ke){let St=Qi.meshes[Ke],Dn=Ke===Qi.lightMeshIndex,qi=Gi.wvpForNode;if(Dn){if(!gn&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}qi=Gi.wvpForTile}else if(gn)continue;let Pe={defines:[]},Ao=[];if(ih(Pe.defines,Ao,St,Q,oe.lut),xn||Pe.defines.push("DIFFUSE_SHADED"),vi&&Pe.defines.push("SHADOWS_SINGLE_CASCADE"),kt&&(Te?kt.numRenderedVerticesInShadowPass+=St.vertexArray.length:kt.numRenderedVerticesInTransparentPass+=St.vertexArray.length),Te){so(St,Gi.nodeModelMatrix,Q,oe);continue}let Er=null;if(ne){let zs=Tc(Gi.nodeModelMatrix,Q.transform);if(Er=new Float32Array(zs),fe.projection.name!=="globe"){let Bs=St.aabb.min,Ka=St.aabb.max,[Ta,Ja]=ne.getOpacityForBounds(zs,Bs[0],Bs[1],Ka[0],Ka[1]);Pe.overrideFog=Ta>=Mn||Ja>=Mn}}let Kr=St.material,_r;Kr.occlusionTexture&&Kr.occlusionTexture.offsetScale&&(_r=Kr.occlusionTexture.offsetScale,Pe.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Te&&se&&(se.useNormalOffset=!!St.normalBuffer);let co=Q.getOrCreateProgram("model",Pe);!Te&&se&&se.setupShadowsFromMatrix(Gi.tileModelMatrix,co,se.useNormalOffset),Q.uploadCommonUniforms(ge,co,null,Er);let ua=Kr.pbrMetallicRoughness;ua.metallicFactor=.9,ua.roughnessFactor=.5;let Po=Qd(new Float32Array(qi),new Float32Array(Ci),new Float32Array(ii),new Float32Array(Qi.matrix),Q,Gi.opacity,ua.baseColorFactor.toRenderColor(null),Kr.emissiveFactor,ua.metallicFactor,ua.roughnessFactor,Kr,nn,oe,[0,0,0],_r);!Dn&&(dn.hasTranslucentParts||Gi.opacity<1)&&co.draw(Q,ge.gl.TRIANGLES,Qe,i.ag.disabled,i.a.disabled,i.af.backCCW,Po,oe.id,St.vertexBuffer,St.indexBuffer,St.segments,oe.paint,Q.transform.zoom,void 0,Ao),co.draw(Q,ge.gl.TRIANGLES,Dn?Je:Qe,i.ag.disabled,Dn||Gi.opacity<1||dn.hasTranslucentParts?i.a.alphaBlended:i.a.unblended,i.af.backCCW,Po,oe.id,St.vertexBuffer,St.indexBuffer,St.segments,oe.paint,Q.transform.zoom,void 0,Ao)}}}}()}(f,o,h,g),void D();let L=A.getModels(),z=[],U=f.transform.getFreeCameraOptions().position,H=i._.scale([],[U.x,U.y,U.z],f.transform.worldSize);i._.negate(H,H);let Y=[],Z=[],X=0;for(let Q of L){let re=h.paint.get("model-rotation").constantOr(null),oe=h.paint.get("model-scale").constantOr(null),ae=h.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(f,re,oe,ae,!0,!0,!1);let ge=i.ad.identity([]),fe=i.cg(Q.position.lat,f.transform.zoom),ne=i.ad.fromScaling([],[1,1,1/fe]);i.ad.translate(ge,ge,H),z.push({zScaleMatrix:ne,negCameraPosMatrix:ge});for(let se of Q.nodes)Wr(f.transform,se,Q.matrix,f.transform.expandedFarZProjMatrix,X,Y,Z);X++}if(Y.sort((Q,re)=>re.depth-Q.depth),f.renderPass!=="shadow"){if(v===1)for(let Q of Z)_l(Q,f,h,z[Q.modelIndex],i.ag.disabled,f.colorModeForRenderPass());else{for(let Q of Z)_l(Q,f,h,z[Q.modelIndex],i.ag.disabled,i.a.disabled);for(let Q of Z)_l(Q,f,h,z[Q.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(let Q of Y)_l(Q,f,h,z[Q.modelIndex],i.ag.disabled,f.colorModeForRenderPass());D()}else{for(let Q of Z)so(Q.mesh,Q.nodeModelMatrix,f,h);for(let Q of Y)so(Q.mesh,Q.nodeModelMatrix,f,h);D()}}},c_={model:function(f,o,h){let g=o.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,g.type==="vector"?f.scope:""));if(g.type==="batched-model")return;let v=g.getModels();for(let x of v)x.upload(h.context)},raster:function(f,o,h){let g=o.getSource();if(!(g instanceof bc&&g.loaded()))return;let v=f.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=f.paint.get("raster-array-band")||g.getInitialBand(v);if(x==null)return;let S=o.getIds().map(k=>o.getTileByID(k));for(let k of S)k.updateNeeded(v,x)&&g.prepareTile(k,v,x)},"raster-particle":function(f,o,h){let g=o.getSource();if(!(g instanceof bc&&g.loaded()))return;let v=f.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;let x=f.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(x==null)return;let S=o.getIds().map(k=>o.getTileByID(k));for(let k of S)k.updateNeeded(v,x)&&g.prepareTile(k,v,x)}};class d_{constructor(o,h,g,v){this.context=new Od(o,h),this.occlusionBuffers=new zy(this.context),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=i.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let S of x)this._debugParams.enabledLayers[S]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let S of x)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.symbolParams=new oc(v),this.setup(),this.numSublayers=i.bv.maxUnderzooming+i.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new pu(this),this._wireframeDebugCache=new rh,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(o,h){let g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ip(this,o));let v=this._terrain;this.transform.elevation=g?v:null,v.update(o,this.transform,h),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(o){let h=o.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);let x=g+.78*(v-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Ip(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,h){if(this.width=o*i.e.devicePixelRatio,this.height=h*i.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style.order)this.style._mergedLayers[g].resize()}setup(){let o=this.context,h=new i.bt;h.emplaceBack(0,0),h.emplaceBack(i.a3,0),h.emplaceBack(0,i.a3),h.emplaceBack(i.a3,i.a3),this.tileExtentBuffer=o.createVertexBuffer(h,i.br.members),this.tileExtentSegments=i.b.simpleSegment(0,0,4,2);let g=new i.bt;g.emplaceBack(0,0),g.emplaceBack(i.a3,0),g.emplaceBack(0,i.a3),g.emplaceBack(i.a3,i.a3),this.debugBuffer=o.createVertexBuffer(g,i.br.members),this.debugSegments=i.b.simpleSegment(0,0,4,5);let v=new i.bt;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,i.br.members),this.viewportSegments=i.b.simpleSegment(0,0,4,2);let x=new i.cp;x.emplaceBack(0,0,0,0),x.emplaceBack(i.a3,0,i.a3,0),x.emplaceBack(0,i.a3,0,i.a3),x.emplaceBack(i.a3,i.a3,i.a3,i.a3),this.mercatorBoundsBuffer=o.createVertexBuffer(x,i.cq.members),this.mercatorBoundsSegments=i.b.simpleSegment(0,0,4,2);let S=new i.bu;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(S);let k=new i.cr;for(let A of[0,1,3,2,0])k.emplaceBack(A);this.debugIndexBuffer=o.createIndexBuffer(k),this.emptyTexture=new i.T(o,new i.i({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=i.ad.create();let D=this.context.gl;this.stencilClearMode=new i.ag({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,i.ae.disabled,this.stencilClearMode,i.a.disabled,i.af.disabled,gu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,h,g){if(!h||this.currentStencilSource===h.id||!o.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(let D of g)if(this._tileClippingMaskIDs[D.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=h.id;let v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(i.a.disabled),v.setDepthMode(i.ae.disabled);let S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let k of g){let D=h.getTile(k),A=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:z,tileBoundsSegments:U}=this.getTileBoundsBuffers(D);S.draw(this,x.TRIANGLES,i.ae.disabled,new i.ag({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),i.a.disabled,i.af.disabled,gu(k.projMatrix),"$clipping",L,z,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,h=this.context.gl;return new i.ag({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);let h=this.context.gl;return new i.ag({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){let h=this.context.gl,g=o.sort((S,k)=>k.overscaledZ-S.overscaledZ),v=g[g.length-1].overscaledZ,x=g[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let S={};for(let k=0;k<x;k++)S[k+v]=new i.ag({func:h.GEQUAL,mask:255},k+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[S,g]}return[{[v]:i.ag.disabled},g]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new i.a([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new i.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?i.a.unblended:i.a.alphaBlended}colorModeForDrapableLayerRenderPass(o){let h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new i.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new i.C(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,h,g,v=!1){if(this.depthOcclusion)return new i.ae(this.context.gl.GREATER,i.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return i.ae.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new i.ae(g||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,h)=>o+h/this._fpsHistory.length,0))}render(o,h){let g=i.e.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=h;let v=this.style._mergedLayers,x=this.style.order.filter(se=>{let le=v[se];return!(le.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[le.type]}),S=x.map(se=>v[se]),k=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(i.e.now()),this.imageManager.beginFrame();let D=0,A=!1;for(let se in k){let le=k[se];le.used&&(le.prepare(this.context),le.getSource().usedInConflation&&++D)}let L=!1;for(let se of S)se.isHidden(this.transform.zoom)||(se.type==="clip"&&(L=!0),this.prepareLayer(se));let z={},U={},H={},Y={},Z={};for(let se in k){let le=k[se];z[se]=le.getVisibleCoordinates(),U[se]=z[se].slice().reverse(),H[se]=le.getVisibleCoordinates(!0).reverse(),Y[se]=le.getShadowCasterCoordinates(),Z[se]=le.sortCoordinatesByDistance(z[se])}let X=se=>{let le=this.style.getLayerSourceCache(se);return le&&le.used?le.getSource():null};if(D||L){let se=[],le=[],we=0;for(let Re of S)this.isSourceForClippingOrConflation(Re,X(Re))&&(se.push(Re),le.push(we)),we++;if(se&&(L||se.length>1)){let Re=[];for(let me=0;me<se.length;me++){let Le=se[me],Be=le[me],Qe=this.style.getLayerSourceCache(Le);if(!Qe||!Qe.used||!Qe.getSource().usedInConflation&&Le.type!=="clip")continue;let Je=1/0,Ze=i.cu.None;if(Le.type==="clip"){Je=Be;for(let Te of Le.layout.get("clip-layer-types"))Ze|=Te==="model"?i.cu.Model:Te==="symbol"?i.cu.Symbol:i.cu.FillExtrusion}Re.push({layer:Le.fqid,cache:Qe,order:Je,clipMask:Ze})}this.replacementSource.setSources(Re),A=!0}}A||this.replacementSource.clear(),this.conflationActive=A,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let se=0;se<S.length;se++){let le=S[se],we=le.cutoffRange();if(this.longestCutoffRange=Math.max(we,this.longestCutoffRange),we>0){let Re=X(le);Re&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom)),le.minzoom&&(this.minCutoffZoom=Math.max(le.minzoom,this.minCutoffZoom))}le.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=se),this._lastOcclusionLayer=se)}let Q=this.style&&this.style.fog;Q?(this._fogVisible=Q.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Q.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(H),this.opaquePassCutoff=0);let re=this._shadowRenderer;if(re){re.updateShadowParameters(this.transform,this.style.directionalLight);for(let se in k)for(let le of z[se]){let we={min:0,max:0};this.terrain&&(we=this.terrain.getMinMaxForTile(le)||we),re.addShadowReceiver(le.toUnwrapped(),we.min,we.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new jp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!i.ct(this.context.gl))return;this.renderPass="offscreen";for(let se of S){let le=o.getLayerSourceCache(se);if(!se.hasOffscreenPass()||se.isHidden(this.transform.zoom))continue;let we=le?U[le.id]:void 0;(se.type==="custom"||se.type==="raster"||se.type==="raster-particle"||se.isSky()||we&&we.length)&&this.renderLayer(this,le,se,we)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];let oe=this.terrain;oe&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&oe.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Y)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ge=(()=>{if(h.showOverdrawInspector)return i.C.black;let se=this.style.fog;if(se&&this.transform.projection.supportsFog){let le=this.style.getLut(se.scope);if(!ae){let we=se.properties.get("color").toRenderColor(le).toArray01();return new i.C(...we)}if(ae){let we=se.properties.get("space-color").toRenderColor(le).toArray01();return new i.C(...we)}}return i.C.transparent})();if(this.context.clear({color:ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let se=S[this.currentLayer],le=o.getLayerSourceCache(se);if(se.isSky())continue;let we=le?(se.is3D()?Z:U)[le.id]:void 0;this._renderTileClippingMasks(se,le,we),this.renderLayer(this,le,se,we)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let se=S[this.currentLayer],le=o.getLayerSourceCache(se);se.isSky()&&this.renderLayer(this,le,se,le?U[le.id]:void 0)}function fe(se,le){let we;return le&&(we=(se.type==="symbol"?H:se.is3D()?Z:U)[le.id]),we}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){let se=S[this.currentLayer];if(se.type==="raster"){let le=o.getLayerSourceCache(se);this.renderLayer(this,le,se,fe(se,le))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ne=0;for(re&&(ne=re.getShadowCastingLayerCount());this.currentLayer<x.length;){let se=S[this.currentLayer],le=o.getLayerSourceCache(se);if(se.isSky())++this.currentLayer;else if(oe&&this.style.isLayerDraped(se)){if(se.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=oe.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(se.is3D()||this.terrain||this._renderTileClippingMasks(se,le,le?z[le.id]:void 0),this.renderLayer(this,le,se,fe(se,le)),!oe&&re&&ne>0&&se.hasShadowPass()&&--ne==0&&(re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let we=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=we;this.currentLayer++){let Re=S[this.currentLayer];if(!Re.hasLightBeamPass())continue;let me=o.getLayerSourceCache(Re);this.renderLayer(this,me,Re,me?U[me.id]:void 0)}this.currentLayer=we,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let we=this.currentLayer;this.depthOcclusion=!0;for(let Re of this.layersWithOcclusionOpacity){this.currentLayer=Re;let me=S[this.currentLayer],Le=o.getLayerSourceCache(me),Be=Le?U[Le.id]:void 0;me.is3D()||this.terrain||this._renderTileClippingMasks(me,Le,Le?z[Le.id]:void 0),this.renderLayer(this,Le,me,Be)}this.depthOcclusion=!1,this.currentLayer=we,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let se=null;S.forEach(le=>{let we=o.getLayerSourceCache(le);we&&!le.isHidden(this.transform.zoom)&&we.getVisibleCoordinates().length&&(!se||se.getSource().maxzoom<we.getSource().maxzoom)&&(se=we)}),se&&this.options.showTileBoundaries&&ca.debug(this,se,se.getVisibleCoordinates(),i.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ca.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(se){let le=se.transform.padding;Ni(se,se.transform.height-(le.top||0),3,Eu),Ni(se,le.bottom||0,3,Np),Vi(se,le.left||0,3,Ma),Vi(se,se.transform.width-(le.right||0),3,Vp);let we=se.transform.centerPoint;(function(Re,me,Le,Be){ao(Re,me-1,Le-10,2,20,Be),ao(Re,me-10,Le-1,20,2,Be)})(se,we.x,se.transform.height-we.y,Mc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),A||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);let{unsupportedLayers:h}=this.transform.projection,g=!h||!h.includes(o.type);if(c_[o.type]&&(g||this.terrain&&o.type==="custom")){let v=this.style.getLayerSourceCache(o);c_[o.type](o,v,this)}this.gpuTimingEnd()}renderLayer(o,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)&&(!o.terrain||g.type!=="custom")||g.type==="clip"||ca[g.type](o,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,g=this.context.gl,v=this.gpuTimers[o.id];v||(v=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(h.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let o=this.context.extTimerQuery,h=this.context.gl,g=h.createQuery();this.deferredRenderGpuTimeQueries.push(g),h.beginQuery(o.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){let o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){let h={};for(let g in o){let v=o[g],x=this.context.extTimerQuery,S=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),h[g]=S}return h}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,g=this.context.gl,v=0;for(let x of o)v+=h.getQueryParameter(x,g.QUERY_RESULT)/1e6,h.deleteQueryEXT(x);return v}translatePosMatrix(o,h,g,v,x){if(!g[0]&&!g[1])return o;let S=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(S){let A=Math.sin(S),L=Math.cos(S);g=[g[0]*L-g[1]*A,g[0]*A+g[1]*L]}let k=[x?g[0]:i.bB(h,g[0],this.transform.zoom),x?g[1]:i.bB(h,g[1],this.transform.zoom),0],D=new Float32Array(16);return i.ad.translate(D,o,k),D}saveTileTexture(o){let h=o.size[0],g=this._tileTextures[h];g?g.push(o):this._tileTextures[h]=[o]}getTileTexture(o){let h=this._tileTextures[o];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,h,g){let v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,x=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||h!==void 0&&!h||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(o,h){this.cache=this.cache||{};let g=h&&h.defines||[],v=h&&h.config,x=this.currentGlobalDefines(o,h&&h.overrideFog,h&&h.overrideRtt).concat(g),S=qd.cacheKey(qg[o],o,x,v);return this.cache[S]||(this.cache[S]=new qd(this.context,o,qg[o],v,Py[o],x)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,h){if(this.style.enable3dLights()){let g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){let x=((S,k,D)=>{let A=S.properties.get("direction"),L=S.properties.get("color").toRenderColor(D.getLut(S.scope)).toArray01(),z=S.properties.get("intensity"),U=k.properties.get("color").toRenderColor(D.getLut(k.scope)).toArray01(),H=k.properties.get("intensity"),Y=[A.x,A.y,A.z],Z=i.bA(U,H),X=i.bA(L,z);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:Y,u_lighting_directional_color:X,u_ground_radiance:Za(Y,X,Z)}})(g,v,this.style);h.setLightsUniformValues(o,x)}}}uploadCommonUniforms(o,h,g,v,x){if(this.uploadCommonLightUniforms(o,h),this.terrain&&this.terrain.renderingToTexture)return;let S=this.style.fog;if(S){let k=S.getOpacity(this.transform.pitch),D=((A,L,z,U,H,Y,Z,X,Q,re,oe,ae)=>{let ge=A.transform,fe=L.properties.get("color").toRenderColor(A.style.getLut(L.scope)).toArray01();fe[3]=U;let ne=A.frameCounter/1e3%1,[se,le]=L.properties.get("vertical-range");return{u_fog_matrix:z?ge.calculateFogTileMatrix(z):ae||A.identityMat,u_fog_range:L.getFovAdjustedRange(ge._fov),u_fog_color:fe,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(se,le),le],u_fog_temporal_offset:ne,u_frustum_tl:H,u_frustum_tr:Y,u_frustum_br:Z,u_frustum_bl:X,u_globe_pos:Q,u_globe_radius:re,u_viewport:oe,u_globe_transition:i.a1(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,S,g,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.e.devicePixelRatio,this.transform.height*i.e.devicePixelRatio],v);h.setFogUniformValues(o,D)}x&&h.setCutoffUniformValues(o,x.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){let o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){let o=this.context.gl,h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let o=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(let v of g)h[v.key]=o[v.key]||new i.by(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,h){return!(!o.is3D()||o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||o.sourceLayer!=="building")&&o.type!=="clip"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[o.key];return h||(this._cachedTileFogOpacities[o.key]=h=this.style.fog.getOpacityForTile(o)),h[0]>=Mn||h[1]>=Mn}}class Qr{constructor(o,h,g,v){this.screenBounds=o,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(o,h){let g,v;if(o instanceof i.P||typeof o[0]=="number"){let x=i.P.convert(o);g=[x],v=h.isPointAboveHorizon(x)}else{let x=i.P.convert(o[0]),S=i.P.convert(o[1]);g=[x,S],v=i.cv(x,S).every(k=>h.isPointAboveHorizon(k))}return new Qr(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return i.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.cv(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),i.cw(v,o)}bufferedCameraGeometryGlobe(o){let h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.cv(h,g,o),x=this.cameraPoint.clone();switch(3*((x.y>h.y)+(x.y>g.y))+((x.x>h.x)+(x.x>g.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(o,h,g,v=0){let x=o.queryPadding/h._pixelsPerMercatorPixel+1,S=g?this._bufferedCameraMercator(x,h):this._bufferedScreenMercator(x,h),k=o.tileID.wrap+(S.unwrapped?v:0),D=S.polygon.map(X=>i.cx(o.tileTransform,X,k));if(!i.cy(D,0,0,i.a3,i.a3))return;k=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let A=this.screenGeometryMercator.polygon.map(X=>i.cz(o.tileTransform,X,k)),L=A.map(X=>new i.P(X[0],X[1])),z=h.getFreeCameraOptions().position||new i.Y(0,0,0),U=i.cz(o.tileTransform,z,k),H=A.map(X=>{let Q=i._.sub(X,X,U);return i._.normalize(Q,Q),new i.aT(U,Q)}),Y=i.bB(o,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:H,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(Z=i.cA(D),Z.min.x=i.at(Z.min.x,0,i.a3),Z.min.y=i.at(Z.min.y,0,i.a3),Z.max.x=i.at(Z.max.x,0,i.a3),Z.max.y=i.at(Z.max.y,0,i.a3),Z),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:Y};var Z}_bufferedScreenMercator(o,h){let g=Wp(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),h):{polygon:this.bufferedScreenGeometry(o).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(o,h){let g=Wp(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),h):{polygon:this.bufferedCameraGeometry(o).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(o,h){let g=function(x,S){let k=i.ad.multiply([],S.pixelMatrix,S.globeMatrix),D=[0,-i.cD,0,1],A=[0,i.cD,0,1],L=[0,0,0,1];i.aA.transformMat4(D,D,k),i.aA.transformMat4(A,A,k),i.aA.transformMat4(L,L,k);let z=new i.P(D[0]/D[3],D[1]/D[3]),U=new i.P(A[0]/A[3],A[1]/A[3]),H=i.cB(x,z)&&D[3]<L[3],Y=i.cB(x,U)&&A[3]<L[3];if(!H&&!Y)return null;let Z=function(ne,se,le){for(let we=1;we<ne.length;we++){let Re=Ds(se.pointCoordinate3D(ne[we-1]).x),me=Ds(se.pointCoordinate3D(ne[we]).x);if(le<0){if(Re<me)return{idx:we,t:-Re/(me-1-Re)}}else if(me<Re)return{idx:we,t:(1-Re)/(me+1-Re)}}return null}(x,S,H?-1:1);if(!Z)return null;let{idx:X,t:Q}=Z,re=X>1?Hp(x.slice(0,X),S):[],oe=X<x.length?Hp(x.slice(X),S):[];re=re.map(ne=>new i.P(Ds(ne.x),ne.y)),oe=oe.map(ne=>new i.P(Ds(ne.x),ne.y));let ae=[...re];ae.length===0&&ae.push(oe[oe.length-1]);let ge=i.a2(ae[ae.length-1].y,(oe.length===0?re[0]:oe[0]).y,Q),fe;return fe=H?[new i.P(0,ge),new i.P(0,0),new i.P(1,0),new i.P(1,ge)]:[new i.P(1,ge),new i.P(1,1),new i.P(0,1),new i.P(0,ge)],ae.push(...fe),oe.length===0?ae.push(re[0]):ae.push(...oe),{polygon:ae.map(ne=>new i.Y(ne.x,ne.y)),unwrapped:!1}}(o,h);if(g)return g;let v=function(x,S){let k=!1,D=-1/0,A=0;for(let z=0;z<x.length-1;z++)x[z].x>D&&(D=x[z].x,A=z);for(let z=0;z<x.length-1;z++){let U=(A+z)%(x.length-1),H=x[U],Y=x[U+1];Math.abs(H.x-Y.x)>.5&&(H.x<Y.x?(H.x+=1,U===0&&(x[x.length-1].x+=1)):(Y.x+=1,U+1===x.length-1&&(x[0].x+=1)),k=!0)}let L=i.aj(S.center.lng);return k&&L<Math.abs(L-1)&&x.forEach(z=>{z.x-=1}),{polygon:x,unwrapped:k}}(Hp(o,h).map(x=>new i.P(Ds(x.x),x.y)),h);return{polygon:v.polygon.map(x=>new i.Y(x.x,x.y)),unwrapped:v.unwrapped}}}function Hp(f,o){return i.cC(f,h=>{let g=o.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function Ds(f){return f<0?1+f%1:f%1}function Wp(f){return 100*f|0}function By(f,o){let h=i.ad.identity([]);return i.ad.scale(h,h,[.5*f.width,.5*-f.height,1]),i.ad.translate(h,h,[1,-1,0]),i.ad.multiply(h,h,f.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(h)}function Ny(f,o,h,g,v,x,S,k=!1){let D=f.tilesIn(g,S,k);D.sort(Ec);let A=[];for(let z of D)A.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(o,h,f._state,z,v,x,By(f.transform,z.tile.tileID),k)});let L=function(z){let U={},H={};for(let Y of z){let Z=Y.queryResults,X=Y.wrappedTileID,Q=H[X]=H[X]||{};for(let re in Z){let oe=Z[re],ae=Q[re]=Q[re]||{},ge=U[re]=U[re]||[];for(let fe of oe)ae[fe.featureIndex]||(ae[fe.featureIndex]=!0,ge.push(fe))}}return U}(A);for(let z in L)L[z].forEach(U=>{let H=U.feature,Y=H.layer;Y&&Y.type!=="background"&&Y.type!=="sky"&&Y.type!=="slot"&&(H.source=Y.source,Y["source-layer"]&&(H.sourceLayer=Y["source-layer"]),H.state=H.id!==void 0?f.getFeatureState(Y["source-layer"],H.id):{})});return L}function oh(f,o){let h=f.getRenderableIds().map(x=>f.getTileByID(x)),g=[],v={};for(let x=0;x<h.length;x++){let S=h[x],k=S.tileID.canonical.key;v[k]||(v[k]=!0,S.querySourceFeatures(g,o))}return g}function Ec(f,o){let h=f.tileID,g=o.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}class Vy{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let o=!1,h=!1;for(let g in this.style._mergedLayers){let v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:o,visibilityChanged:h});else if(v.type==="model"){let x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:o,visibilityChanged:h})}}}onNewFrame(o){this.layersGotHidden=!1;for(let h of this.layers){let g=h.layer,v=!1;g.type==="fill-extrusion"?v=!g.isHidden(o)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(o)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&h.visible,h.visible=v}}updateZOffset(o,h){this.currentBuildingBuckets=[];for(let v of this.layers){let x=v.layer,S=this.style.getLayerSourceCache(x),k=1;x.type==="fill-extrusion"&&(k=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let D=S?S.getTile(h):null;if(!D&&S&&h.canonical.z>S.getSource().minzoom){let A=h.scaledTo(Math.min(S.getSource().maxzoom,h.overscaledZ-1));for(;A.overscaledZ>=S.getSource().minzoom&&(D=S.getTile(A),!D&&A.overscaledZ!==0);)A=A.scaledTo(A.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(x):null,tileID:D?D.tileID:h,verticalScale:k})}o.hasAnyZOffset=!1;let g=!1;for(let v=0;v<o.symbolInstances.length;v++){let x=o.symbolInstances.get(v),S=x.zOffset,k=this._getHeightAtTileOffset(h,x.tileAnchorX,x.tileAnchorY);x.zOffset=k!==Number.NEGATIVE_INFINITY?k:S,g||S===x.zOffset||(g=!0),o.hasAnyZOffset||x.zOffset===0||(o.hasAnyZOffset=!0)}g&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,h,g,v){let x=h,S=g;if(o.canonical.z!==v.canonical.z){let k=v.canonical,D=1/(1<<o.canonical.z-k.z);x=(h+o.canonical.x*i.a3)*D-k.x*i.a3|0,S=(g+o.canonical.y*i.a3)*D-k.y*i.a3|0}return{tileX:x,tileY:S}}_getHeightAtTileOffset(o,h,g){let v,x;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;let{bucket:k,tileID:D,verticalScale:A}=this.currentBuildingBuckets[S];if(!k)continue;let{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(o,h,g,D),U=k.getHeightAtTileCoord(L,z);U&&U.height!==void 0&&(U.hidden?v=U.height:x=Math.max(U.height*A,x||0))}if(x!==void 0)return x;for(let S=0;S<this.layers.length;++S){let k=this.layers[S];if(k.layer.type!=="model"||!k.visible)continue;let{bucket:D,tileID:A}=this.currentBuildingBuckets[S];if(!D)continue;let{tileX:L,tileY:z}=this._mapCoordToOverlappingTile(o,h,g,A),U=D.getHeightAtTileCoord(L,z);if(U&&!U.hidden)return U.height===void 0&&v!==void 0?Math.min(U.maxHeight,v)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Dc(f,o){let h={};for(let g in f)g!=="ref"&&(h[g]=f[g]);return i.cE.forEach(g=>{g in o&&(h[g]=o[g])}),h}function Gp(f){f=f.slice();let o=Object.create(null);for(let h=0;h<f.length;h++)o[f[h].id]=f[h];for(let h=0;h<f.length;h++)"ref"in f[h]&&(f[h]=Dc(f[h],o[f[h].ref]));return f}let Oi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Qa(f,o,h){h.push({command:Oi.addSource,args:[f,o[f]]})}function h_(f,o,h){o.push({command:Oi.removeSource,args:[f]}),h[f]=!0}function jy(f,o,h,g){h_(f,h,g),Qa(f,o,h)}function Uy(f,o,h){let g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!_(f[h][g],o[h][g]))return!1;for(g in o[h])if(o[h].hasOwnProperty(g)&&g!=="data"&&!_(f[h][g],o[h][g]))return!1;return!0}function ah(f,o,h,g,v,x){let S;for(S in o=o||{},f=f||{})f.hasOwnProperty(S)&&(_(f[S],o[S])||h.push({command:x,args:[g,S,o[S],v]}));for(S in o)o.hasOwnProperty(S)&&!f.hasOwnProperty(S)&&(_(f[S],o[S])||h.push({command:x,args:[g,S,o[S],v]}))}function Du(f){return f.id}function Ac(f,o){return f[o.id]=o,f}class u_{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=i.at(o,0,1);let h=1,g=this._distances[h],v=o*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];let x=h-1,S=this._distances[x],k=g-S,D=k>0?(v-S)/k:0;return this.points[x].mult(1-D).add(this.points[h].mult(D))}}class qp{constructor(o,h,g){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(h/g);for(let S=0;S<this.xCellCount*this.yCellCount;S++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,g,v,x){this._forEachCell(h,g,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(o,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(o,h,g,v,x,S){this.boxCells[x].push(S)}_insertCircleCell(o,h,g,v,x,S){this.circleCells[x].push(S)}_query(o,h,g,v,x,S){if(g<0||o>this.width||v<0||h>this.height)return!x&&[];let k=[];if(o<=0&&h<=0&&this.width<=g&&this.height<=v){if(x)return!0;for(let D=0;D<this.boxKeys.length;D++)k.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){let A=this.circles[3*D],L=this.circles[3*D+1],z=this.circles[3*D+2];k.push({key:this.circleKeys[D],x1:A-z,y1:L-z,x2:A+z,y2:L+z})}return S?k.filter(S):k}return this._forEachCell(o,h,g,v,this._queryCell,k,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?k.length>0:k}_queryCircle(o,h,g,v,x){let S=o-g,k=o+g,D=h-g,A=h+g;if(k<0||S>this.width||A<0||D>this.height)return!v&&[];let L=[];return this._forEachCell(S,D,k,A,this._queryCellCircle,L,{hitTest:v,circle:{x:o,y:h,radius:g},seenUids:{box:{},circle:{}}},x),v?L.length>0:L}query(o,h,g,v,x){return this._query(o,h,g,v,!1,x)}hitTest(o,h,g,v,x){return this._query(o,h,g,v,!0,x)}hitTestCircle(o,h,g,v){return this._queryCircle(o,h,g,!0,v)}_queryCell(o,h,g,v,x,S,k,D){let A=k.seenUids,L=this.boxCells[x];if(L!==null){let U=this.bboxes;for(let H of L)if(!A.box[H]){A.box[H]=!0;let Y=4*H;if(o<=U[Y+2]&&h<=U[Y+3]&&g>=U[Y+0]&&v>=U[Y+1]&&(!D||D(this.boxKeys[H]))){if(k.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[H],x1:U[Y],y1:U[Y+1],x2:U[Y+2],y2:U[Y+3]})}}}let z=this.circleCells[x];if(z!==null){let U=this.circles;for(let H of z)if(!A.circle[H]){A.circle[H]=!0;let Y=3*H;if(this._circleAndRectCollide(U[Y],U[Y+1],U[Y+2],o,h,g,v)&&(!D||D(this.circleKeys[H]))){if(k.hitTest)return S.push(!0),!0;{let Z=U[Y],X=U[Y+1],Q=U[Y+2];S.push({key:this.circleKeys[H],x1:Z-Q,y1:X-Q,x2:Z+Q,y2:X+Q})}}}}}_queryCellCircle(o,h,g,v,x,S,k,D){let A=k.circle,L=k.seenUids,z=this.boxCells[x];if(z!==null){let H=this.bboxes;for(let Y of z)if(!L.box[Y]){L.box[Y]=!0;let Z=4*Y;if(this._circleAndRectCollide(A.x,A.y,A.radius,H[Z+0],H[Z+1],H[Z+2],H[Z+3])&&(!D||D(this.boxKeys[Y])))return S.push(!0),!0}}let U=this.circleCells[x];if(U!==null){let H=this.circles;for(let Y of U)if(!L.circle[Y]){L.circle[Y]=!0;let Z=3*Y;if(this._circlesCollide(H[Z],H[Z+1],H[Z+2],A.x,A.y,A.radius)&&(!D||D(this.circleKeys[Y])))return S.push(!0),!0}}}_forEachCell(o,h,g,v,x,S,k,D){let A=this._convertToXCellCoord(o),L=this._convertToYCellCoord(h),z=this._convertToXCellCoord(g),U=this._convertToYCellCoord(v);for(let H=A;H<=z;H++)for(let Y=L;Y<=U;Y++)if(x.call(this,o,h,g,v,this.xCellCount*Y+H,S,k,D))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,g,v,x,S){let k=v-o,D=x-h,A=g+S;return A*A>k*k+D*D}_circleAndRectCollide(o,h,g,v,x,S,k){let D=(S-v)/2,A=Math.abs(o-(v+D));if(A>D+g)return!1;let L=(k-x)/2,z=Math.abs(h-(x+L));if(z>L+g)return!1;if(A<=D||z<=L)return!0;let U=A-D,H=z-L;return U*U+H*H<=g*g}}let da=100;class m_{constructor(o,h,g=new qp(o.width+200,o.height+200,25),v=new qp(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+da,this.screenBottomBoundary=o.height+da,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=h}placeCollisionBox(o,h,g,v,x,S,k,D){let A=g.projectedAnchorX,L=g.projectedAnchorY,z=g.projectedAnchorZ,U=g.elevation,H=g.tileID,Y=o.getProjection();if(U&&H){let[fe,ne,se]=Y.upVector(H.canonical,g.tileAnchorX,g.tileAnchorY),le=Y.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=fe*U*le,L+=ne*U*le,z+=se*U*le}let Z=this.projectAndGetPerspectiveRatio(k,A,L,z,g.tileID,Y.name==="globe"||!!U||this.transform.pitch>0,Y),X=S*Z.perspectiveRatio,Q=(g.x1*h+v.x-g.padding)*X+Z.point.x,re=(g.y1*h+v.y-g.padding)*X+Z.point.y,oe=(g.x2*h+v.x+g.padding)*X+Z.point.x,ae=(g.y2*h+v.y+g.padding)*X+Z.point.y,ge=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(Q,re,oe,ae)||!x&&this.grid.hitTest(Q,re,oe,ae,D)||ge?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[Q,re,oe,ae],offscreen:this.isOffscreen(Q,re,oe,ae),occluded:!1}}placeCollisionCircles(o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z){let X=[],Q=this.transform.elevation,re=o.getProjection(),oe=Q?Q.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,re):null,ae=new i.P(g.tileAnchorX,g.tileAnchorY),{x:ge,y:fe,z:ne}=re.projectTilePoint(ae.x,ae.y,Z.canonical);if(oe){let[Ze,Te,Ve]=oe(ae);ge+=Ze,fe+=Te,ne+=Ve}let se=re.name==="globe",le=this.projectAndGetPerspectiveRatio(k,ge,fe,ne,Z,se||!!Q||this.transform.pitch>0,re),{perspectiveRatio:we}=le,Re=(z?S/we:S*we)/i.bN,me=Vo(ge,fe,ne,D),Le=le.signedDistanceFromCamera>0?uu(Re,x,g.lineOffsetX*Re,g.lineOffsetY*Re,!1,me,ae,g,v,D,{},Q&&!z?oe:null,z&&!!Q,re,Z,z):null,Be=!1,Qe=!1,Je=!0;if(Le&&!le.occluded){let Ze=.5*H*we+Y,Te=new i.P(-100,-100),Ve=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Ye=new u_,{first:gt,last:yt}=Le,kt=gt.path.length,vt=[];for(let Dt=kt-1;Dt>=1;Dt--)vt.push(gt.path[Dt]);for(let Dt=1;Dt<yt.path.length;Dt++)vt.push(yt.path[Dt]);let it=2.5*Ze;A&&(vt=vt.map(([Dt,oi,ti],vi)=>(oe&&!se&&(ti=oe(vi<kt-1?gt.tilePath[kt-1-vi]:yt.tilePath[vi-kt+2])[2]),Vo(Dt,oi,ti,A))),vt.some(Dt=>Dt[3]<=0)&&(vt=[]));let Ge=[];if(vt.length>0){let Dt=1/0,oi=-1/0,ti=1/0,vi=-1/0;for(let Di of vt)Dt=Math.min(Dt,Di[0]),ti=Math.min(ti,Di[1]),oi=Math.max(oi,Di[0]),vi=Math.max(vi,Di[1]);oi>=Te.x&&Dt<=Ve.x&&vi>=Te.y&&ti<=Ve.y&&(Ge=[vt.map(Di=>new i.P(Di[0],Di[1]))],(Dt<Te.x||oi>Ve.x||ti<Te.y||vi>Ve.y)&&(Ge=i.cF(Ge,Te.x,Te.y,Ve.x,Ve.y)))}for(let Dt of Ge){Ye.reset(Dt,.25*Ze);let oi=0;oi=Ye.length<=.5*Ze?1:Math.ceil(Ye.paddedLength/it)+1;for(let ti=0;ti<oi;ti++){let vi=ti/Math.max(oi-1,1),Di=Ye.lerp(vi),Ji=Di.x+da,Qt=Di.y+da;X.push(Ji,Qt,Ze,0);let Gi=Ji-Ze,dn=Qt-Ze,Qi=Ji+Ze,Ci=Qt+Ze;if(Je=Je&&this.isOffscreen(Gi,dn,Qi,Ci),Qe=Qe||this.isInsideGrid(Gi,dn,Qi,Ci),!h&&this.grid.hitTestCircle(Ji,Qt,Ze,U)&&(Be=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!L&&Be||!Qe?[]:X,offscreen:Je,collisionDetected:Be,occluded:le.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],g=1/0,v=1/0,x=-1/0,S=-1/0;for(let L of o){let z=new i.P(L.x+da,L.y+da);g=Math.min(g,z.x),v=Math.min(v,z.y),x=Math.max(x,z.x),S=Math.max(S,z.y),h.push(z)}let k=this.grid.query(g,v,x,S).concat(this.ignoredGrid.query(g,v,x,S)),D={},A={};for(let L of k){let z=L.key;if(D[z.bucketInstanceId]===void 0&&(D[z.bucketInstanceId]={}),D[z.bucketInstanceId][z.featureIndex])continue;let U=[new i.P(L.x1,L.y1),new i.P(L.x2,L.y1),new i.P(L.x2,L.y2),new i.P(L.x1,L.y2)];i.cG(h,U)&&(D[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(o,h,g,v,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:x},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,g,v,x){let S=h?this.ignoredGrid:this.grid,k={bucketInstanceId:g,featureIndex:v,collisionGroupID:x};for(let D=0;D<o.length;D+=4)S.insertCircle(k,o[D],o[D+1],o[D+2])}projectAndGetPerspectiveRatio(o,h,g,v,x,S,k){let D=[h,g,v,1],A=!1;v||this.transform.pitch>0?(i.aA.transformMat4(D,D,o),this.fogState&&x&&k.name!=="globe"&&(A=function(U,H,Y,Z,X,Q){let re=Q.calculateFogTileMatrix(X),oe=[H,Y,Z];return i._.transformMat4(oe,oe,re),ar(U,i._.length(oe),Q.pitch,Q._fov)}(this.fogState,h,g,v,x.toUnwrapped(),this.transform)>.9)):Ca(D,D,o);let L=D[3];return{point:new i.P((D[0]/L+1)/2*this.transform.width+da,(-D[1]/L+1)/2*this.transform.height+da),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/L*.5,1.5),signedDistanceFromCamera:L,occluded:S&&D[2]>L||A}}isOffscreen(o,h,g,v){return g<da||o>=this.screenRightBoundary||v<da||h>this.screenBottomBoundary}isInsideGrid(o,h,g,v){return g>=0&&o<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let o=i.ad.identity([]);return i.ad.translate(o,o,[-100,-100,0]),o}}class As{constructor(o,h,g,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Ps{constructor(o,h,g,v,x,S=!1){this.text=new As(o?o.text:null,h,g,x),this.icon=new As(o?o.icon:null,h,v,x),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Au{constructor(o,h,g,v=!1){this.text=o,this.icon=h,this.skipFade=g,this.clipped=v}}class p_{constructor(){this.invProjMatrix=i.ad.create(),this.viewportMatrix=i.ad.create(),this.circles=[]}}class sh{constructor(o,h,g,v,x){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=x}}class lh{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[o]}}function $p(f,o,h,g,v){let{horizontalAlign:x,verticalAlign:S}=i.bQ(f),k=-(x-.5)*o,D=-(S-.5)*h,A=i.bP(f,g);return new i.P(k+A[0]*v,D+A[1]*v)}function ch(f,o,h,g,v){let x=new i.P(f,o);return h&&x._rotate(g?v:-v),x}class Uo{constructor(o,h,g,v,x,S){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new m_(this.transform,x),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new lh(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,g,v){let x=g.getBucket(h),S=g.latestFeatureIndex;if(!x||!S||h.fqid!==x.layerIds[0])return;let k=x.layers[0].layout,D=g.collisionBoxArray,A=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/i.a3,z=g.tileID.toUnwrapped();this.transform.setProjection(x.projection);let U=(H=g.tileID,Y=x.getProjection(),Z=this.transform,Y.name===this.projection?Z.calculateProjMatrix(H.toUnwrapped()):Mu(Z,Y,H));var H,Y,Z;let X=k.get("text-pitch-alignment")==="map",Q=k.get("text-rotation-alignment")==="map";h.compileFilter();let re=h.dynamicFilter(),oe=h.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(g),ge=hl(U,g.tileID.canonical,X,Q,this.transform,x.getProjection(),ae),fe=null;if(X){let le=fc(U,g.tileID.canonical,X,Q,this.transform,x.getProjection(),ae);fe=i.ad.multiply([],this.transform.labelPlaneMatrix,le)}let ne=null;re&&g.latestFeatureIndex&&(ne={unwrappedTileID:z,dynamicFilter:re,dynamicFilterNeedsFeature:oe,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new sh(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,g.tileID);let se={bucket:x,layout:k,posMatrix:U,textLabelPlaneMatrix:ge,labelToScreenMatrix:fe,clippingData:ne,scale:A,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:i.aD(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.aD(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let le of x.sortKeyRanges){let{sortKey:we,symbolInstanceStart:Re,symbolInstanceEnd:me}=le;o.push({sortKey:we,symbolInstanceStart:Re,symbolInstanceEnd:me,parameters:se})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:se})}attemptAnchorPlacement(o,h,g,v,x,S,k,D,A,L,z,U,H,Y,Z,X,Q,re){let{textOffset0:oe,textOffset1:ae,crossTileID:ge}=U,fe=[oe,ae],ne=$p(o,g,v,fe,x),se=this.collisionIndex.placeCollisionBox(Y,x,h,ch(ne.x,ne.y,S,k,this.transform.angle),z,D,A,L.predicate);if(X){let le=Y.getSymbolInstanceIconSize(re,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,le,X,ch(ne.x,ne.y,S,k,this.transform.angle),z,D,A,L.predicate).box.length===0)return}if(se.box.length>0){let le;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(le=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:fe,width:g,height:v,anchor:o,textScale:x,prevAnchor:le},this.markUsedJustification(Y,o,U,Z),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,Z,U),this.placedOrientations[ge]=Z),{shift:ne,placedGlyphBoxes:se}}}placeLayerBucketPart(o,h,g,v){let{bucket:x,layout:S,posMatrix:k,textLabelPlaneMatrix:D,labelToScreenMatrix:A,clippingData:L,textPixelRatio:z,holdingForFade:U,collisionBoxArray:H,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:Z,collisionGroup:X}=o.parameters,Q=S.get("text-optional"),re=S.get("icon-optional"),oe=S.get("text-allow-overlap"),ae=S.get("icon-allow-overlap"),ge=S.get("text-rotation-alignment")==="map",fe=S.get("text-pitch-alignment")==="map",ne=S.get("symbol-z-order")==="viewport-y",se=S.get("symbol-z-elevate");this.transform.setProjection(x.projection);let le=oe&&(ae||!x.hasIconData()||re),we=ae&&(oe||!x.hasTextData()||Q);!x.collisionArrays&&H&&x.deserializeCollisionBoxes(H),g&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,H);let Re=(me,Le,Be)=>{let{crossTileID:Qe,numVerticalGlyphVertices:Je}=me;if(L){let Qi={zoom:this.transform.zoom,pitch:this.transform.pitch},Ci=null;if(L.dynamicFilterNeedsFeature){let ii=this.retainedQueryData[x.bucketInstanceId];Ci=L.featureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:ii.bucketIndex,sourceLayerIndex:ii.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Qi,Ci,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new i.P(me.tileAnchorX,me.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Qe]=new Au(!1,!1,!1,!0),void h.add(Qe)}if(h.has(Qe))return;if(U)return void(this.placements[Qe]=new Au(!1,!1,!1));let Ze=!1,Te=!1,Ve=!0,Ye=!1,gt=!1,yt=null,kt={box:null,offscreen:null,occluded:null},vt={box:null,offscreen:null,occluded:null},it=null,Ge=null,Dt=null,oi=0,ti=0,vi=0;Be.textFeatureIndex?oi=Be.textFeatureIndex:me.useRuntimeCollisionCircles&&(oi=me.featureIndex),Be.verticalTextFeatureIndex&&(ti=Be.verticalTextFeatureIndex);let Di=Qi=>{Qi.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let Ci=this.transform.elevation;Qi.elevation=me.zOffset+(Ci?Ci.getAtTileOffset(Qi.tileID,Qi.tileAnchorX,Qi.tileAnchorY):0)},Ji=Be.textBox;if(Ji){Di(Ji);let Qi=ii=>{let gn=i.aE.horizontal;if(x.allowVerticalPlacement&&!ii&&this.prevPlacement){let xn=this.prevPlacement.placedOrientations[Qe];xn&&(this.placedOrientations[Qe]=xn,gn=xn,this.markUsedOrientation(x,gn,me))}return gn},Ci=(ii,gn)=>{if(x.allowVerticalPlacement&&Je>0&&Be.verticalTextBox){for(let xn of x.writingModes)if(xn===i.aE.vertical?(kt=gn(),vt=kt):kt=ii(),kt&&kt.box&&kt.box.length)break}else kt=ii()};if(S.get("text-variable-anchor")){let ii=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Qe]){let nn=this.prevPlacement.variableOffsets[Qe];ii.indexOf(nn.anchor)>0&&(ii=ii.filter(Ke=>Ke!==nn.anchor),ii.unshift(nn.anchor))}let gn=(nn,Ke,St)=>{let Dn=x.getSymbolInstanceTextSize(Y,me,this.transform.zoom,Le),qi=(nn.x2-nn.x1)*Dn+2*nn.padding,Pe=(nn.y2-nn.y1)*Dn+2*nn.padding,Ao=me.hasIconTextFit&&!ae?Ke:null;Ao&&Di(Ao);let Er={box:[],offscreen:!1,occluded:!1},Kr=oe?2*ii.length:ii.length;for(let _r=0;_r<Kr;++_r){let co=this.attemptAnchorPlacement(ii[_r%ii.length],nn,qi,Pe,Dn,ge,fe,z,k,X,_r>=ii.length,me,Le,x,St,Ao,Y,Z);if(co&&(Er=co.placedGlyphBoxes,Er&&Er.box&&Er.box.length)){Ze=!0,yt=co.shift;break}}return Er};Ci(()=>gn(Ji,Be.iconBox,i.aE.horizontal),()=>{let nn=Be.verticalTextBox;return nn&&Di(nn),x.allowVerticalPlacement&&!(kt&&kt.box&&kt.box.length)&&Je>0&&nn?gn(nn,Be.verticalIconBox,i.aE.vertical):{box:null,offscreen:null,occluded:null}}),kt&&(Ze=kt.box,Ve=kt.offscreen,Ye=kt.occluded);let xn=Qi(!(!kt||!kt.box));if(!Ze&&this.prevPlacement){let nn=this.prevPlacement.variableOffsets[Qe];nn&&(this.variableOffsets[Qe]=nn,this.markUsedJustification(x,nn.anchor,me,xn))}}else{let ii=(gn,xn)=>{let nn=x.getSymbolInstanceTextSize(Y,me,this.transform.zoom,Le),Ke=this.collisionIndex.placeCollisionBox(x,nn,gn,new i.P(0,0),oe,z,k,X.predicate);return Ke&&Ke.box&&Ke.box.length&&(this.markUsedOrientation(x,xn,me),this.placedOrientations[Qe]=xn),Ke};Ci(()=>ii(Ji,i.aE.horizontal),()=>{let gn=Be.verticalTextBox;return x.allowVerticalPlacement&&Je>0&&gn?(Di(gn),ii(gn,i.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Qi(!!(kt&&kt.box&&kt.box.length))}}if(it=kt,Ze=it&&it.box&&it.box.length>0,Ve=it&&it.offscreen,Ye=it&&it.occluded,me.useRuntimeCollisionCircles){let Qi=x.text.placedSymbolArray.get(me.centerJustifiedTextSymbolIndex>=0?me.centerJustifiedTextSymbolIndex:me.verticalPlacedTextSymbolIndex),Ci=i.aF(x.textSizeData,Y,Qi),ii=S.get("text-padding");Ge=this.collisionIndex.placeCollisionCircles(x,oe,Qi,x.lineVertexArray,x.glyphOffsetArray,Ci,k,D,A,g,fe,X.predicate,me.collisionCircleDiameter*Ci/i.bN,ii,this.retainedQueryData[x.bucketInstanceId].tileID),Ze=oe||Ge.circles.length>0&&!Ge.collisionDetected,Ve=Ve&&Ge.offscreen,Ye=Ge.occluded}if(Be.iconFeatureIndex&&(vi=Be.iconFeatureIndex),Be.iconBox){let Qi=Ci=>{Di(Ci);let ii=me.hasIconTextFit&&yt?ch(yt.x,yt.y,ge,fe,this.transform.angle):new i.P(0,0),gn=x.getSymbolInstanceIconSize(Z,this.transform.zoom,me.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,gn,Ci,ii,ae,z,k,X.predicate)};vt&&vt.box&&vt.box.length&&Be.verticalIconBox?(Dt=Qi(Be.verticalIconBox),Te=Dt.box.length>0):(Dt=Qi(Be.iconBox),Te=Dt.box.length>0),Ve=Ve&&Dt.offscreen,gt=Dt.occluded}let Qt=Q||me.numHorizontalGlyphVertices===0&&Je===0,Gi=re||me.numIconVertices===0;if(Qt||Gi?Gi?Qt||(Te=Te&&Ze):Ze=Te&&Ze:Te=Ze=Te&&Ze,Ze&&it&&it.box&&this.collisionIndex.insertCollisionBox(it.box,S.get("text-ignore-placement"),x.bucketInstanceId,vt&&vt.box&&ti?ti:oi,X.ID),Te&&Dt&&this.collisionIndex.insertCollisionBox(Dt.box,S.get("icon-ignore-placement"),x.bucketInstanceId,vi,X.ID),Ge&&(Ze&&this.collisionIndex.insertCollisionCircles(Ge.circles,S.get("text-ignore-placement"),x.bucketInstanceId,oi,X.ID),g)){let Qi=x.bucketInstanceId,Ci=this.collisionCircleArrays[Qi];Ci===void 0&&(Ci=this.collisionCircleArrays[Qi]=new p_);for(let ii=0;ii<Ge.circles.length;ii+=4)Ci.circles.push(Ge.circles[ii+0]),Ci.circles.push(Ge.circles[ii+1]),Ci.circles.push(Ge.circles[ii+2]),Ci.circles.push(Ge.collisionDetected?1:0)}let dn=x.projection.name!=="globe";le=le&&(dn||!Ye),we=we&&(dn||!gt),this.placements[Qe]=new Au(Ze||le,Te||we,Ve||x.justReloaded),h.add(Qe)};if(se&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),ne){let me=x.getSortedSymbolIndexes(this.transform.angle);for(let Le=me.length-1;Le>=0;--Le){let Be=me[Le];Re(x.symbolInstances.get(Be),Be,x.collisionArrays[Be])}x.hasAnyZOffset&&i.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let me=x.getSortedIndexesByZOffset();for(let Le=0;Le<me.length;++Le){let Be=me[Le];Re(x.symbolInstances.get(Be),Be,x.collisionArrays[Be])}}else for(let me=o.symbolInstanceStart;me<o.symbolInstanceEnd;me++)Re(x.symbolInstances.get(me),me,x.collisionArrays[me]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){let me=this.collisionCircleArrays[x.bucketInstanceId];i.ad.invert(me.invProjMatrix,k),me.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(o,h,g,v){let{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:D,crossTileID:A}=g,L=i.cJ(h),z=v===i.aE.vertical?D:L==="left"?x:L==="center"?S:L==="right"?k:-1;x>=0&&(o.text.placedSymbolArray.get(x).crossTileID=z>=0&&x!==z?0:A),S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=z>=0&&S!==z?0:A),k>=0&&(o.text.placedSymbolArray.get(k).crossTileID=z>=0&&k!==z?0:A),D>=0&&(o.text.placedSymbolArray.get(D).crossTileID=z>=0&&D!==z?0:A)}markUsedOrientation(o,h,g){let v=h===i.aE.horizontal||h===i.aE.horizontalOnly?h:0,x=h===i.aE.vertical?h:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:A}=g,L=o.text.placedSymbolArray;S>=0&&(L.get(S).placedOrientation=v),k>=0&&(L.get(k).placedOrientation=v),D>=0&&(L.get(D).placedOrientation=v),A>=0&&(L.get(A).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let v=h?h.symbolFadeChange(o):1,x=h?h.opacities:{},S=h?h.variableOffsets:{},k=h?h.placedOrientations:{};for(let D in this.placements){let A=this.placements[D],L=x[D];L?(this.opacities[D]=new Ps(L,v,A.text,A.icon,null,A.clipped),g=g||A.text!==L.text.placed||A.icon!==L.icon.placed):(this.opacities[D]=new Ps(null,v,A.text,A.icon,A.skipFade,A.clipped),g=g||A.text||A.icon)}for(let D in x){let A=x[D];if(!this.opacities[D]){let L=new Ps(A,v,!1,!1);L.isHidden()||(this.opacities[D]=L,g=g||A.text.placed||A.icon.placed)}}for(let D in S)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=S[D]);for(let D in k)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=k[D]);g?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h,g,v){let x=new Set;for(let S of h){let k=S.getBucket(o);k&&S.latestFeatureIndex&&o.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,x,S.collisionBoxArray,g,v,S.tileID),k.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(k,S.tileID),k.updateZOffset()))}}updateBucketOpacities(o,h,g,v,x,S){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let k=o.layers[0].layout,D=!!o.layers[0].dynamicFilter(),A=new Ps(null,0,!1,!1,!0),L=k.get("text-allow-overlap"),z=k.get("icon-allow-overlap"),U=k.get("text-variable-anchor"),H=k.get("text-rotation-alignment")==="map",Y=k.get("text-pitch-alignment")==="map",Z=new Ps(null,0,L&&(z||!o.hasIconData()||k.get("icon-optional")),z&&(L||!o.hasTextData()||k.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);let X=(re,oe,ae)=>{for(let ge=0;ge<oe/4;ge++)re.opacityVertexArray.emplaceBack(ae)},Q=0;x&&o.updateReplacement(S,x);for(let re=0;re<o.symbolInstances.length;re++){let oe=o.symbolInstances.get(re),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:ge,crossTileID:fe,numIconVertices:ne,tileAnchorX:se,tileAnchorY:le}=oe,we=h.has(fe),Re=this.opacities[fe];we?Re=A:Re||(Re=Z,this.opacities[fe]=Re),h.add(fe);let me=ae>0||ge>0,Le=ne>0,Be=this.placedOrientations[fe],Qe=Be===i.aE.vertical,Je=Be===i.aE.horizontal||Be===i.aE.horizontalOnly;!me&&!Le||Re.isHidden()||Q++;let Ze=!1;if((me||Le)&&x)for(let Te of o.activeReplacements){if(Te.order<v||Te.order===1/0||!(Te.clipMask&i.cu.Symbol)||Te.min.x>se||se>Te.max.x||Te.min.y>le||le>Te.max.y)continue;let Ve=i.cH(se,le,S.canonical,Te.footprintTileId.canonical);if(Ze=i.cI(Ve,Te),Ze)break}if(me){let Te=Ze?Os:Ia(Re.text);X(o.text,ae,Qe?Os:Te),X(o.text,ge,Je?Os:Te);let Ve=Re.text.isHidden(),{leftJustifiedTextSymbolIndex:Ye,centerJustifiedTextSymbolIndex:gt,rightJustifiedTextSymbolIndex:yt,verticalPlacedTextSymbolIndex:kt}=oe,vt=o.text.placedSymbolArray,it=Ve||Qe?1:0;Ye>=0&&(vt.get(Ye).hidden=it),gt>=0&&(vt.get(gt).hidden=it),yt>=0&&(vt.get(yt).hidden=it),kt>=0&&(vt.get(kt).hidden=Ve||Je?1:0);let Ge=this.variableOffsets[fe];Ge&&this.markUsedJustification(o,Ge.anchor,oe,Be);let Dt=this.placedOrientations[fe];Dt&&(this.markUsedJustification(o,"left",oe,Dt),this.markUsedOrientation(o,Dt,oe))}if(Le){let Te=Ze?Os:Ia(Re.icon),{placedIconSymbolIndex:Ve,verticalPlacedIconSymbolIndex:Ye}=oe,gt=o.icon.placedSymbolArray,yt=Re.icon.isHidden()?1:0;Ve>=0&&(X(o.icon,ne,Qe?Os:Te),gt.get(Ve).hidden=yt),Ye>=0&&(X(o.icon,oe.numVerticalIconVertices,Je?Os:Te),gt.get(Ye).hidden=yt)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let Te=o.collisionArrays[re];if(Te){let Ve=new i.P(0,0),Ye=!0;if(Te.textBox||Te.verticalTextBox){if(U){let yt=this.variableOffsets[fe];yt?(Ve=$p(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textScale),H&&Ve._rotate(Y?this.transform.angle:-this.transform.angle)):Ye=!1}D&&(Ye=!Re.clipped),Te.textBox&&dh(o.textCollisionBox.collisionVertexArray,Re.text.placed,!Ye||Qe,Ve.x,Ve.y),Te.verticalTextBox&&dh(o.textCollisionBox.collisionVertexArray,Re.text.placed,!Ye||Je,Ve.x,Ve.y)}let gt=Ye&&!!(!Je&&Te.verticalIconBox);Te.iconBox&&dh(o.iconCollisionBox.collisionVertexArray,Re.icon.placed,gt,oe.hasIconTextFit?Ve.x:0,oe.hasIconTextFit?Ve.y:0),Te.verticalIconBox&&dh(o.iconCollisionBox.collisionVertexArray,Re.icon.placed,!gt,oe.hasIconTextFit?Ve.x:0,oe.hasIconTextFit?Ve.y:0)}}}if(o.fullyClipped=Q===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){let re=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=re.invProjMatrix,o.placementViewportMatrix=re.viewportMatrix,o.collisionCircleArray=re.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){let g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function dh(f,o,h,g,v){f.emplaceBack(o?1:0,h?1:0,g||0,v||0),f.emplaceBack(o?1:0,h?1:0,g||0,v||0),f.emplaceBack(o?1:0,h?1:0,g||0,v||0),f.emplaceBack(o?1:0,h?1:0,g||0,v||0)}let Yp=Math.pow(2,25),pt=Math.pow(2,24),f_=Math.pow(2,17),Zp=Math.pow(2,16),Xp=Math.pow(2,9),g_=Math.pow(2,8),Pu=Math.pow(2,1);function Ia(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let o=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Yp+o*pt+h*f_+o*Zp+h*Xp+o*g_+h*Pu+o}let Os=0;class yl{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,h,g,v,x){let S=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(S,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((k,D)=>k.sortKey-D.sortKey));this._currentPartIndex<S.length;){let k=S[this._currentPartIndex];if(h.placeLayerBucketPart(k,this._seenCrossTileIDs,g,k.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Ou{constructor(o,h,g,v,x,S,k,D,A){this.placement=new Uo(o,x,S,k,D,A),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,h,g,v){let x=i.e.now(),S=()=>{let k=i.e.now()-x;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){let k=h[o[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=D)&&(!k.maxzoom||k.maxzoom>D)){let A=k,L=A.layout.get("symbol-z-elevate"),z=this._inProgressLayer=this._inProgressLayer||new yl(A),U=i.al(k.source,k.scope);if(z.continuePlacement(L?v[U]:g[U],this.placement,this._showCollisionBoxes,k,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let Rs=512/i.a3/2;class Hy{constructor(o,h,g){this.tileID=o,this.bucketInstanceId=g,this.index=new i.cK(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=o.canonical.x*i.a3,x=o.canonical.y*i.a3;for(let S=0;S<h.length;S++){let{key:k,crossTileID:D,tileAnchorX:A,tileAnchorY:L}=h.get(S),z=Math.floor((v+A)*Rs),U=Math.floor((x+L)*Rs);this.index.add(z,U),this.keys.push(k),this.crossTileIDs.push(D)}this.index.finish()}findMatches(o,h,g){let v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),x=Rs/Math.pow(2,h.canonical.z-this.tileID.canonical.z),S=h.canonical.x*i.a3,k=h.canonical.y*i.a3;for(let D=0;D<o.length;D++){let A=o.get(D);if(A.crossTileID)continue;let{key:L,tileAnchorX:z,tileAnchorY:U}=A,H=Math.floor((S+z)*x),Y=Math.floor((k+U)*x),Z=this.index.range(H-v,Y-v,H+v,Y+v);for(let X of Z){let Q=this.crossTileIDs[X];if(this.keys[X]===L&&!g.has(Q)){g.add(Q),A.crossTileID=Q;break}}}}}class Wy{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let h=Math.round((o-this.lng)/360);if(h!==0)for(let g in this.indexes){let v=this.indexes[g],x={};for(let S in v){let k=v[S];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+h),x[k.tileID.key]=k}this.indexes[g]=x}this.lng=o}addBucket(o,h,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);let v=this.usedCrossTileIDs[o.overscaledZ];for(let x in this.indexes){let S=this.indexes[x];if(Number(x)>o.overscaledZ)for(let k in S){let D=S[k];D.tileID.isChildOf(o)&&D.findMatches(h.symbolInstances,o,v)}else{let k=S[o.scaledTo(Number(x)).key];k&&k.findMatches(h.symbolInstances,o,v)}}for(let x=0;x<h.symbolInstances.length;x++){let S=h.symbolInstances.get(x);S.crossTileID||(S.crossTileID=g.generate(),v.add(S.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Hy(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(let g of h.crossTileIDs)this.usedCrossTileIDs[o].delete(g)}removeStaleBuckets(o){let h=!1;for(let g in this.indexes){let v=this.indexes[g];for(let x in v)o[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[x]),delete v[x],h=!0)}return h}}class Gy{constructor(){this.layerIndexes={},this.crossTileIDs=new Wy,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,g,v){let x=this.layerIndexes[o.fqid];x===void 0&&(x=this.layerIndexes[o.fqid]=new Qp);let S=!1,k={};v.name!=="globe"&&x.handleWrapJump(g);for(let D of h){let A=D.getBucket(o);A&&o.fqid===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(D.tileID,A,this.crossTileIDs)&&(S=!0),k[A.bucketInstanceId]=!0)}return x.removeStaleBuckets(k)&&(S=!0),S}pruneUnusedLayers(o){let h={};o.forEach(g=>{h[g]=!0});for(let g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}let __=new i.N({data:new i.O(i.L.colorTheme.data)}),Ls=(f,o)=>ni(f,o&&o.filter(h=>h.identifier!=="source.canvas")),Kp=i.ah(Oi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),qy=i.ah(Oi,["setCenter","setZoom","setBearing","setPitch"]),b_={version:8,layers:[],sources:{}},y_={duration:300,delay:0};class ha extends i.E{constructor(o,h={}){super(),this.map=o,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=i.W({},y_),this._buildingIndex=new Vy(this),this.crossTileSymbolIndex=new Gy,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new Ht,this.dispatcher=h.dispatcher?h.dispatcher:new i.bw(i.bx(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Rd,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new i.cM(o._requestManager,h.localFontFamily?i.cN.all:h.localIdeographFontFamily?i.cN.ideographs:i.cN.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new ou(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",i.cO());let g=this;this._rtlTextPluginCallback=ha.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,S)=>{if(i.cP(x),S&&S.every(k=>k))for(let k in g._sourceCaches){let D=g._sourceCaches[k],A=D.getSource().type;A!=="vector"&&A!=="geojson"||D.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(let S in this._layers){let k=this._layers[S];k.source===x.id&&this._validateLayer(k)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(i.cQ(o))return o;let h=i.cR(o);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${i.cS(JSON.stringify(o))}`}_diffStyle(o,h,g){this.globalId=this._getGlobalId(o);let v=(x,S)=>{try{S(null,this.setState(x,g))}catch(k){S(k,!1)}};if(typeof o=="string"){let x=this.map._requestManager.normalizeStyleURL(o),S=this.map._requestManager.transformRequest(x,i.R.Style);i.g(S,(k,D)=>{k?this.fire(new i.d(k)):D&&v(D,h)})}else typeof o=="object"&&v(o,h)}loadURL(o,h={}){this.fire(new i.f("dataloading",{dataType:"style"}));let g=typeof h.validate=="boolean"?h.validate:!i.cQ(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,h.accessToken),this.resolvedImports.add(o);let v=this.importsCache.get(o);if(v)return this._load(v,g);let x=this.map._requestManager.transformRequest(o,i.R.Style);this._request=i.g(x,(S,k)=>{if(this._request=null,S)this.fire(new i.d(S));else if(k)return this.importsCache.set(o,k),this._load(k,g)})}loadJSON(o,h={}){this.fire(new i.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=i.e.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new i.f("dataloading",{dataType:"style"})),this._load(b_,!1)}_loadImports(o,h,g){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let v=[];for(let x of o){let S=this._createFragmentStyle(x),k=new Promise(L=>{S.once("style.import.load",L),S.once("error",L)}).then(()=>this.mergeAll());if(v.push(k),this.resolvedImports.has(x.url)){S.loadEmpty();continue}let D=x.data||this.importsCache.get(x.url);D?(S.loadJSON(D,{validate:h}),this._isInternalStyle(D)&&(S.globalId=null)):x.url?S.loadURL(x.url,{validate:h}):S.loadEmpty();let A={style:S,id:x.id,config:x.config};if(g){let L=this.fragments.findIndex(({id:z})=>z===g);this.fragments=this.fragments.slice(0,L).concat(A).concat(this.fragments.slice(L))}else this.fragments.push(A)}return Promise.allSettled(v)}getImportGlobalIds(o=this,h=new Set){for(let g of o.fragments)g.style.globalId&&h.add(g.style.globalId),this.getImportGlobalIds(g.style,h);return[...h.values()]}_createFragmentStyle(o){let h=this.scope?i.al(o.id,this.scope):o.id,g,v=this._initialConfig&&this._initialConfig[h];(o.config||v)&&(g=i.W({},o.config,v));let x=new ha(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,h){let g=o.schema;if(this._isInternalStyle(o)){let S=i.W({},b_,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(S,h)}if(this.updateConfig(this._config,g),h&&Ls(this,be(o)))return;this._loaded=!0,this.stylesheet=i.cT(o);let v=()=>{for(let A in o.sources)this.addSource(A,o.sources[A],{validate:!1,isInitialLoad:!0});o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(o.glyphs,this.scope);let S=Gp(this.stylesheet.layers);if(this._order=S.map(A=>A.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let A=this.stylesheet.lights[0];this.light=new At(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new At(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let A of S){let L=i.cY(A,this.scope,this._styleColorTheme.lut,this.options);L.isConfigDependent&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L,this._serializedLayers[L.id]=L.serialize();let z=this.getOwnLayerSourceCache(L),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&L.canCastShadows()&&U&&(z.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.f("data",{dataType:"style"}));let D=this.isRootStyle();o.imports?this._loadImports(o.imports,h).then(()=>{this._reloadImports(),this.fire(new i.f(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.f(D?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){let S=this._evaluateColorThemeData(x);this._loadColorTheme(S).then(()=>{v()}).catch(k=>{i.w(`Couldn't load color theme from the stylesheet: ${k}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,h,g,v,x,S,k,D,A={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(L=>{if(L.stylesheet){if(L.light!=null&&(o=L.light),L.stylesheet.lights)for(let z of L.stylesheet.lights)z.type==="ambient"&&L.ambientLight!=null&&(h=L.ambientLight),z.type==="directional"&&L.directionalLight!=null&&(g=L.directionalLight);v=this._prioritizeTerrain(v,L.terrain,L.stylesheet.terrain),L.stylesheet.fog&&L.fog!=null&&(x=L.fog),L.stylesheet.camera!=null&&(D=L.stylesheet.camera),L.stylesheet.projection!=null&&(S=L.stylesheet.projection),L.stylesheet.transition!=null&&(k=L.stylesheet.transition),A[L.scope]=L._styleColorTheme}}),this.light=o,this.ambientLight=h,this.directionalLight=g,this.fog=x,this._styleColorThemeForScope=A,v===null?delete this.terrain:this.terrain=v,this.camera=D||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=i.W({},y_,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){let h=g=>{for(let v of g.fragments)h(v.style);o(g)};h(this)}_prioritizeTerrain(o,h,g){let v=o&&o.drapeRenderMode===0;return g===null?h&&h.drapeRenderMode===0?h:v?o:null:h!=null&&(!o||v||h&&h.drapeRenderMode===1)?h:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{o=this._prioritizeTerrain(o,h.terrain,h.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(o=h.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){let o={},h={},g={};this.forEachFragmentStyle(v=>{for(let x in v._sourceCaches){let S=i.al(x,v.scope);o[S]=v._sourceCaches[x]}for(let x in v._otherSourceCaches){let S=i.al(x,v.scope);h[S]=v._otherSourceCaches[x]}for(let x in v._symbolSourceCaches){let S=i.al(x,v.scope);g[S]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=g}mergeLayers(){let o={},h=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(let k of S._order){let D=S._layers[k];if(D.type==="slot"){let A=i.cU(k);if(o[A])continue;o[A]=[]}D.slot&&o[D.slot]?o[D.slot].push(D):h.push(D)}}),this._mergedOrder=[],this._clipLayerIndices=[];let v=0,x=(S=[])=>{for(let k of S)if(k.type==="slot"){let D=i.cU(k.id);o[D]&&x(o[D]),this._mergedSlots.push(D)}else{let D=i.al(k.id,k.scope);this._mergedOrder.push(D),g[D]=k,k.is3D()&&(this._has3DLayers=!0),k.type==="circle"&&(this._hasCircleLayers=!0),k.type==="symbol"&&(this._hasSymbolLayers=!0),k.type==="clip"&&this._clipLayerIndices.push(v),v++}};x(h),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=i.W({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(h,g,v){let x=i.W({},g);for(let k of Object.keys(i.L.colorTheme))x[k]===void 0&&(x[k]=i.L.colorTheme[k].default);let S=new i.U(__,h,new Map(v));return S.setTransitionOrValue(x,v),S.untransitioned().possiblyEvaluate(new i.X(0))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){return this._styleColorTheme.lutLoading=!0,new Promise((h,g)=>{let v="data:image/png;base64,";if(o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();o.startsWith(v)||(o=v+o);let x="mapbox-reserved-lut",S=new Image;S.src=o,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},S.onload=()=>{this._styleColorTheme.lutLoading=!1;let{width:k,height:D,data:A}=i.e.getImageData(S);if(D>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==D*D)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new i.i({width:k,height:D},A),pixelRatio:1,sdf:!1,version:0});let L=this.imageManager.getImage(x,this.scope);L?(this._styleColorTheme.lut={image:L.data,data:o},h()):g(new Error("Missing LUT image."))}})}getLut(o){let h=this._styleColorThemeForScope[o];return h?h.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(h,g,v){let x,S,k,D=i.e.devicePixelRatio>1?"@2x":"",A=i.g(g.transformRequest(g.normalizeSpriteURL(h,D,".json"),i.R.SpriteJSON),(U,H)=>{A=null,k||(k=U,x=H,z())}),L=i.h(g.transformRequest(g.normalizeSpriteURL(h,D,".png"),i.R.SpriteImage),(U,H)=>{L=null,k||(k=U,S=H,z())});function z(){if(k)v(k);else if(x&&S){let U=i.e.getImageData(S),H={};for(let Y in x){let{width:Z,height:X,x:Q,y:re,sdf:oe,pixelRatio:ae,stretchX:ge,stretchY:fe,content:ne}=x[Y],se=new i.i({width:Z,height:X});i.i.copy(U,se,{x:Q,y:re},{x:0,y:0},{width:Z,height:X},null),H[Y]={data:se,pixelRatio:ae,sdf:oe,stretchX:ge,stretchY:fe,content:ne}}v(null,H)}}return{cancel(){A&&(A.cancel(),A=null),L&&(L.cancel(),L=null)}}}(o,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new i.d(h));else if(g)for(let v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.f("data",{dataType:"style"}))})}_validateLayer(o){let h=this.getOwnSource(o.source);if(!h)return;let g=o.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new i.d(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,h)=>{let g=this.fragments[h];return g&&g.style&&(o.data=g.style.serialize()),o})}_serializeSources(){let o={};for(let h in this._sourceCaches){let g=this._sourceCaches[h].getSource();o[g.id]||(o[g.id]=g.serialize())}return o}_serializeLayers(o){let h=[];for(let g of o){let v=this._layers[g];v&&v.type!=="custom"&&h.push(v.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(let o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){let h=this.getOwnLayer(o);if(h)return h;this.fire(new i.d(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){let h=this.getOwnSource(o);if(h)return h;this.fire(new i.d(new Error(`The source '${o}' does not exist in the map's style.`)))}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);let h=this.calculateLightsBrightness();o.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));let g=this._changes.isDirty(),v=!1;if(this._changes.isDirty()){let S=this._changes.getLayerUpdatesByScope();for(let k in S){let{updatedIds:D,removedIds:A}=S[k];(D||A)&&(this._updateWorkerLayers(k,D,A),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._changes.reset()}let x={};for(let S in this._mergedSourceCaches){let k=this._mergedSourceCaches[S];x[S]=k.used,k.used=!1,k.tileCoverLift=0}for(let S of this._mergedOrder){let k=this._mergedLayers[S];if(k.recalculate(o,this._availableImages),!k.isHidden(o.zoom)){let D=this.getLayerSourceCache(k);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,k.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let D=k.minzoom||0;D<(k.maxzoom||25.5);D++){let A=this.map.painter;if(A){let L=k.getProgramIds();if(!L)continue;for(let z of L){let U=k.getDefaultProgramParams(z,o.zoom,this._styleColorTheme.lut);U&&(A.style=this,this.fog&&(A._fogVisible=!0,U.overrideFog=!0,A.getOrCreateProgram(z,U)),A._fogVisible=!1,U.overrideFog=!1,A.getOrCreateProgram(z,U),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(U.overrideRtt=!0,A.getOrCreateProgram(z,U)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(let S in x){let k=this._mergedSourceCaches[S];x[S]!==k.used&&k.getSource().fire(new i.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new i.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){let o=this._changes.getUpdatedImages();if(o.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changes.resetUpdatedImages()}}_updateWorkerLayers(o,h,g){let v=this.getFragmentStyle(o);v&&this.dispatcher.broadcast("updateLayers",{layers:h?v._serializeLayers(h):[],scope:o,removedIds:g||[],options:v.options})}setState(o,h){if(this._checkLoaded(),Ls(this,be(o)))return!1;(o=i.cT(o)).layers=Gp(o.layers);let g=function(S,k){if(!S)return[{command:Oi.setStyle,args:[k]}];let D=[];try{if(!_(S.version,k.version))return[{command:Oi.setStyle,args:[k]}];if(_(S.center,k.center)||D.push({command:Oi.setCenter,args:[k.center]}),_(S.zoom,k.zoom)||D.push({command:Oi.setZoom,args:[k.zoom]}),_(S.bearing,k.bearing)||D.push({command:Oi.setBearing,args:[k.bearing]}),_(S.pitch,k.pitch)||D.push({command:Oi.setPitch,args:[k.pitch]}),_(S.sprite,k.sprite)||D.push({command:Oi.setSprite,args:[k.sprite]}),_(S.glyphs,k.glyphs)||D.push({command:Oi.setGlyphs,args:[k.glyphs]}),_(S.imports,k.imports)||function(H=[],Y=[],Z){Y=Y||[];let X=(H=H||[]).map(Du),Q=Y.map(Du),re=H.reduce(Ac,{}),oe=Y.reduce(Ac,{}),ae=X.slice(),ge,fe,ne,se;for(ge=0,fe=0;ge<X.length;ge++)ne=X[ge],oe.hasOwnProperty(ne)?fe++:(Z.push({command:Oi.removeImport,args:[ne]}),ae.splice(ae.indexOf(ne,fe),1));for(ge=0,fe=0;ge<Q.length;ge++)ne=Q[Q.length-1-ge],ae[ae.length-1-ge]!==ne&&(re.hasOwnProperty(ne)?(Z.push({command:Oi.removeImport,args:[ne]}),ae.splice(ae.lastIndexOf(ne,ae.length-fe),1)):fe++,se=ae[ae.length-ge],Z.push({command:Oi.addImport,args:[oe[ne],se]}),ae.splice(ae.length-ge,0,ne));for(let le of Y){let we=re[le.id];we&&!_(we,le)&&Z.push({command:Oi.updateImport,args:[le.id,le]})}}(S.imports,k.imports,D),_(S.transition,k.transition)||D.push({command:Oi.setTransition,args:[k.transition]}),_(S.light,k.light)||D.push({command:Oi.setLight,args:[k.light]}),_(S.fog,k.fog)||D.push({command:Oi.setFog,args:[k.fog]}),_(S.projection,k.projection)||D.push({command:Oi.setProjection,args:[k.projection]}),_(S.lights,k.lights)||D.push({command:Oi.setLights,args:[k.lights]}),_(S.camera,k.camera)||D.push({command:Oi.setCamera,args:[k.camera]}),!_(S["color-theme"],k["color-theme"]))return[{command:Oi.setStyle,args:[k]}];let A={},L=[];(function(H,Y,Z,X){let Q;for(Q in Y=Y||{},H=H||{})H.hasOwnProperty(Q)&&(Y.hasOwnProperty(Q)||h_(Q,Z,X));for(Q in Y){if(!Y.hasOwnProperty(Q))continue;let re=Y[Q];H.hasOwnProperty(Q)?_(H[Q],re)||(H[Q].type==="geojson"&&re.type==="geojson"&&Uy(H,Y,Q)?Z.push({command:Oi.setGeoJSONSourceData,args:[Q,re.data]}):jy(Q,Y,Z,X)):Qa(Q,Y,Z)}})(S.sources,k.sources,L,A);let z=[];S.layers&&S.layers.forEach(H=>{H.source&&A[H.source]?D.push({command:Oi.removeLayer,args:[H.id]}):z.push(H)});let U=S.terrain;U&&A[U.source]&&(D.push({command:Oi.setTerrain,args:[void 0]}),U=void 0),D=D.concat(L),_(U,k.terrain)||D.push({command:Oi.setTerrain,args:[k.terrain]}),function(H,Y,Z){Y=Y||[];let X=(H=H||[]).map(Du),Q=Y.map(Du),re=H.reduce(Ac,{}),oe=Y.reduce(Ac,{}),ae=X.slice(),ge=Object.create(null),fe,ne,se,le,we,Re,me;for(fe=0,ne=0;fe<X.length;fe++)se=X[fe],oe.hasOwnProperty(se)?ne++:(Z.push({command:Oi.removeLayer,args:[se]}),ae.splice(ae.indexOf(se,ne),1));for(fe=0,ne=0;fe<Q.length;fe++)se=Q[Q.length-1-fe],ae[ae.length-1-fe]!==se&&(re.hasOwnProperty(se)?(Z.push({command:Oi.removeLayer,args:[se]}),ae.splice(ae.lastIndexOf(se,ae.length-ne),1)):ne++,Re=ae[ae.length-fe],Z.push({command:Oi.addLayer,args:[oe[se],Re]}),ae.splice(ae.length-fe,0,se),ge[se]=!0);for(fe=0;fe<Q.length;fe++)if(se=Q[fe],le=re[se],we=oe[se],!ge[se]&&!_(le,we))if(_(le.source,we.source)&&_(le["source-layer"],we["source-layer"])&&_(le.type,we.type)){for(me in ah(le.layout,we.layout,Z,se,null,Oi.setLayoutProperty),ah(le.paint,we.paint,Z,se,null,Oi.setPaintProperty),_(le.slot,we.slot)||Z.push({command:Oi.setSlot,args:[se,we.slot]}),_(le.filter,we.filter)||Z.push({command:Oi.setFilter,args:[se,we.filter]}),_(le.minzoom,we.minzoom)&&_(le.maxzoom,we.maxzoom)||Z.push({command:Oi.setLayerZoomRange,args:[se,we.minzoom,we.maxzoom]}),le)le.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?ah(le[me],we[me],Z,se,me.slice(6),Oi.setPaintProperty):_(le[me],we[me])||Z.push({command:Oi.setLayerProperty,args:[se,me,we[me]]}));for(me in we)we.hasOwnProperty(me)&&!le.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?ah(le[me],we[me],Z,se,me.slice(6),Oi.setPaintProperty):_(le[me],we[me])||Z.push({command:Oi.setLayerProperty,args:[se,me,we[me]]}))}else Z.push({command:Oi.removeLayer,args:[se]}),Re=ae[ae.lastIndexOf(se)+1],Z.push({command:Oi.addLayer,args:[we,Re]})}(z,k.layers,D)}catch(A){console.warn("Unable to compute style diff:",A),D=[{command:Oi.setStyle,args:[k]}]}return D}(this.serialize(),o).filter(S=>!(S.command in qy));if(g.length===0)return!1;let v=g.filter(S=>!(S.command in Kp));if(v.length>0)throw new Error(`Unimplemented: ${v.map(S=>S.command).join(", ")}.`);let x=[];return g.forEach(S=>{x.push(this[S.command].apply(this,S.args))}),h&&Promise.all(x).then(h),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(o,h){return this.getImage(o)?this.fire(new i.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,this.scope,h),this._afterImageUpdated(o),this)}updateImage(o,h){this.imageManager.updateImage(o,this.scope,h)}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._afterImageUpdated(o),this):this.fire(new i.d(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(o),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new i.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(o,h,g={}){return this._checkLoaded(),this._validate(mi,`models.${o}`,h,null,g)||(this.modelManager.addModel(o,h,this.scope),this._changes.setDirty()),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this):this.fire(new i.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,h,g={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(ye,`sources.${o}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let v=bu(o,h,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let x=S=>{let k=(S?"symbol:":"other:")+v.id,D=i.al(k,this.scope),A=this._sourceCaches[k]=new i.bv(D,v,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=A,A.onAdd(this.map)};x(!1),h.type!=="vector"&&h.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();let h=this.getOwnSource(o);if(!h)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===o)return this.fire(new i.d(new Error(`Source "${o}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new i.d(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));let g=this.getOwnSourceCaches(o);for(let v of g){let x=i.cU(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new i.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,h){this._checkLoaded(),this.getOwnSource(o).setData(h),this._changes.setDirty()}getOwnSource(o){let h=this.getOwnSourceCache(o);return h&&h.getSource()}getOwnSources(){let o=[];for(let h in this._otherSourceCaches){let g=this.getOwnSourceCache(h);g&&o.push(g.getSource())}return o}areTilesLoaded(){let o=this._mergedSourceCaches;for(let h in o){let g=o[h]._tiles;for(let v in g){let x=g[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;let h=this._getTransitionParameters();for(let v of o){if(this._validate(Ne,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(v),x.updateTransitions(h)}else this.ambientLight=new zd(v,ci,this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(v),x.updateTransitions(h)}else this.directionalLight=new zd(v,ap,this.scope,this.options)}}let g=new i.X(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let o=this.directionalLight,h=this.ambientLight;if(!o||!h)return;let g=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),v=o.properties.get("color").toRenderColor(null).toArray01(),x=o.properties.get("intensity"),S=o.properties.get("direction"),k=1-i.ac(S.x,S.y,S.z)[2]/90,D=g(v)*x*k,A=h.properties.get("color").toRenderColor(null).toArray01(),L=h.properties.get("intensity");return(D+g(A)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(!o)return this;if(i.cV(o)){let h=i.cW(o),g=this.fragments.find(({id:x})=>x===h);if(!g)throw new Error(`Style import not found: ${o}`);let v=i.cU(o);return g.style.getFragmentStyle(v)}{let h=this.fragments.find(({id:g})=>g===o);if(!h)throw new Error(`Style import not found: ${o}`);return h.style}}getConfigProperty(o,h){let g=this.getFragmentStyle(o);if(!g)return null;let v=i.al(h,g.scope),x=g.options.get(v),S=x?x.value||x.default:null;return S?S.serialize():null}setConfigProperty(o,h,g){let v=this.getFragmentStyle(o);if(!v)return;let x=v.stylesheet.schema;if(!x||!x[h])return;let S=i.y(g);if(S.result!=="success")return void Ls(this,S.value);let k=S.value.expression,D=i.al(h,v.scope),A=v.options.get(D);if(!A)return;let L,{minValue:z,maxValue:U,stepValue:H,type:Y,values:Z}=x[h],X=i.y(x[h].default);X.result==="success"&&(L=X.value.expression),L?(this.options.set(D,Ra(Zi({},A),{value:k,default:L,minValue:z,maxValue:U,stepValue:H,type:Y,values:Z})),this.updateConfigDependencies()):this.fire(new i.d(new Error(`No schema defined for the config option "${h}" in the "${o}" fragment.`)))}getConfig(o){let h=this.getFragmentStyle(o);if(!h)return null;let g=h.stylesheet.schema;if(!g)return null;let v={};for(let x in g){let S=i.al(x,h.scope),k=h.options.get(S),D=k?k.value||k.default:null;v[x]=D?D.serialize():null}return v}setConfig(o,h){let g=this.getFragmentStyle(o);g&&(g.updateConfig(h,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){let h=this.getFragmentStyle(o);return h?h.stylesheet.schema:null}setSchema(o,h){let g=this.getFragmentStyle(o);g&&(g.stylesheet.schema=h,g.updateConfig(g._config,h),this.updateConfigDependencies())}updateConfig(o,h){if(this._config=o,o||h)if(h)for(let g in h){let v,x,S=i.y(h[g].default);if(S.result==="success"&&(v=S.value.expression),o&&o[g]!==void 0){let U=i.y(o[g]);U.result==="success"&&(x=U.value.expression)}let{minValue:k,maxValue:D,stepValue:A,type:L,values:z}=h[g];if(v){let U=i.al(g,this.scope);this.options.set(U,{default:v,value:x,minValue:k,maxValue:D,stepValue:A,type:L,values:z})}else this.fire(new i.d(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new i.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let o of this._configDependentLayers){let h=this.getLayer(o);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(o=>{if(o._styleColorTheme.colorTheme){let h=o._evaluateColorThemeData(o._styleColorTheme.colorTheme);(!o._styleColorTheme.lut||o._styleColorTheme.lut&&h!==o._styleColorTheme.lut.data)&&o.setColorTheme(o._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(o,h,g={}){this._checkLoaded();let v=o.id;if(this._layers[v])return void this.fire(new i.d(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(o.type==="custom"){if(Ls(this,i.cX(o)))return;x=i.cY(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(v,o.source),o=i.cT(o),o=i.W(o,{source:v})),this._validate(mt,`layers.${v}`,o,{arrayIndex:-1},g))return;x=i.cY(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize()}x.isConfigDependent&&this._configDependentLayers.add(x.fqid);let S=this._order.length;if(h){let L=this._order.indexOf(h);if(L===-1)return void this.fire(new i.d(new Error(`Layer with id "${h}" does not exist on this map.`)));x.slot===this._layers[h].slot?S=L:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let k=this.getOwnLayerSourceCache(x),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&x.canCastShadows()&&D&&(k.castsShadows=!0);let A=this._changes.getRemovedLayer(x);if(A&&x.source&&k&&x.type!=="custom"){this._changes.discardLayerRemoval(x);let L=i.al(x.source,x.scope);A.type!==x.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),k.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(o,h){this._checkLoaded();let g=this._checkLayer(o);if(!g||o===h)return;let v=this._order.indexOf(o);this._order.splice(v,1);let x=this._order.length;if(h){let S=this._order.indexOf(h);if(S===-1)return void this.fire(new i.d(new Error(`Layer with id "${h}" does not exist on this map.`)));g.slot===this._layers[h].slot?x=S:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();let h=this._checkLayer(o);if(!h)return;h.setEventedParent(null);let g=this._order.indexOf(o);this._order.splice(g,1),delete this._layers[o],delete this._serializedLayers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);let v=this.getOwnLayerSourceCache(h);if(v&&v.castsShadows){let x=!1;for(let S in this._layers)if(this._layers[S].source===h.source&&this._layers[S].canCastShadows()){x=!0;break}v.castsShadows=x}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(let h in this._layers)if(this._layers[h].type===o)return!0;return!1}setLayerZoomRange(o,h,g){this._checkLoaded();let v=this._checkLayer(o);v&&(v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,h){this._checkLoaded();let g=this._checkLayer(o);g&&g.slot!==h&&(g.slot=h,this._updateLayer(g))}setFilter(o,h,g={}){this._checkLoaded();let v=this._checkLayer(o);if(v&&!_(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(at,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=i.cT(h),this._updateLayer(v)))}getFilter(o){let h=this._checkLayer(o);if(h)return i.cT(h.filter)}setLayoutProperty(o,h,g,v={}){this._checkLoaded();let x=this._checkLayer(o);if(x&&!_(x.getLayoutProperty(h),g)){if(g!=null&&(!v||v.validate!==!1)&&Ls(x,$t.call(be,{key:`layers.${o}.layout.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:i.L,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(h,g),x.isConfigDependent&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(o,h){let g=this._checkLayer(o);if(g)return g.getLayoutProperty(h)}setPaintProperty(o,h,g,v={}){this._checkLoaded();let x=this._checkLayer(o);if(!x||_(x.getPaintProperty(h),g)||g!=null&&(!v||v.validate!==!1)&&Ls(x,Lt.call(be,{key:`layers.${o}.paint.${h}`,layerType:x.type,objectKey:h,value:g,styleSpec:i.L})))return;let S=x.setPaintProperty(h,g);x.isConfigDependent&&this._configDependentLayers.add(x.fqid),S&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(o,h){let g=this._checkLayer(o);if(g)return g.getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();let g=o.source,v=o.sourceLayer,x=this._checkSource(g);if(!x)return;let S=x.type;if(S==="geojson"&&v)return void this.fire(new i.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!v)return void this.fire(new i.d(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new i.d(new Error("The feature id parameter must be provided.")));let k=this.getOwnSourceCaches(g);for(let D of k)D.setFeatureState(v,o.id,h)}removeFeatureState(o,h){this._checkLoaded();let g=o.source,v=this._checkSource(g);if(!v)return;let x=v.type,S=x==="vector"?o.sourceLayer:void 0;if(x==="vector"&&!S)return void this.fire(new i.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new i.d(new Error("A feature id is required to remove its specific state property.")));let k=this.getOwnSourceCaches(g);for(let D of k)D.removeFeatureState(S,o.id,h)}getFeatureState(o){this._checkLoaded();let h=o.source,g=o.sourceLayer,v=this._checkSource(h);if(v){if(v.type!=="vector"||g)return o.id===void 0&&this.fire(new i.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,o.id);this.fire(new i.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=i.W({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return i.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();let o=this.getTerrain(),h=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return i.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(o){this._changes.updateLayer(o);let h=this.getLayerSourceCache(o),g=i.al(o.source,o.scope),v=this._changes.getUpdatedSourceCaches();o.source&&!v[g]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),h.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){let h=k=>this._mergedLayers[k].type==="fill-extrusion"||this._mergedLayers[k].type==="model",g=this.order,v={},x=[];for(let k=g.length-1;k>=0;k--){let D=g[k];if(h(D)){v[D]=k;for(let A of o){let L=A[D];if(L)for(let z of L)x.push(z)}}}x.sort((k,D)=>D.intersectionZ-k.intersectionZ);let S=[];for(let k=g.length-1;k>=0;k--){let D=g[k];if(h(D))for(let A=x.length-1;A>=0;A--){let L=x[A].feature;if(L.layer&&v[L.layer.id]<k)break;S.push(L),x.pop()}else for(let A of o){let L=A[D];if(L)for(let z of L)S.push(z.feature)}}return S}queryRenderedFeatures(o,h,g){h&&h.filter&&this._validate(at,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;let v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new i.d(new Error("parameters.layers must be an Array."))),[];for(let A of h.layers){let L=this._mergedLayers[A];if(!L)return this.fire(new i.d(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];v[L.source]=!0}}let x=[],S=h.serializedLayers||{},k=h&&h.layers?h.layers.some(A=>{let L=this.getLayer(A);return L&&L.is3D()}):this.has3DLayers(),D=Qr.createFromScreenPoints(o,g);for(let A in this._mergedSourceCaches){let L=this._mergedSourceCaches[A].getSource();if(!L||L.scope!==h.scope)continue;let z=this._mergedSourceCaches[A].getSource().id;h.layers&&!v[z]||x.push(Ny(this._mergedSourceCaches[A],this._mergedLayers,S,D,h,g,k,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,L,z,U,H,Y,Z){let X={},Q=Y.queryRenderedSymbols(U),re=[];for(let oe of Object.keys(Q).map(Number))re.push(Z[oe]);re.sort(Ec);for(let oe of re){let ae=oe.featureIndex.lookupSymbolFeatures(Q[oe.bucketInstanceId],L,oe.bucketIndex,oe.sourceLayerIndex,H.filter,H.layers,H.availableImages,A);for(let ge in ae){let fe=X[ge]=X[ge]||[],ne=ae[ge];ne.sort((se,le)=>{let we=oe.featureSortOrder;if(we){let Re=we.indexOf(se.featureIndex);return we.indexOf(le.featureIndex)-Re}return le.featureIndex-se.featureIndex});for(let se of ne)fe.push(se)}}for(let oe in X)X[oe].forEach(ae=>{let ge=ae.feature,fe=z(A[oe]);if(!fe)return;let ne=fe.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=ne});return X}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),D.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,h){h&&h.filter&&this._validate(at,"querySourceFeatures.filter",h.filter,null,h);let g=this.getOwnSourceCaches(o),v=[];for(let x of g)v=v.concat(oh(x,h));return v}addSourceType(o,h,g){return ha.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(ha.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,h,g={}){this._checkLoaded();let v=this.light.getLight(),x=!1;for(let k in o)if(!_(o[k],v[k])){x=!0;break}if(!x)return;let S=this._getTransitionParameters();this.light.setLight(o,h,g),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,h=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()&&h!==0||delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=o,v=o.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){let k="terrain-dem-src";this.addSource(k,g.source),g=i.cT(g),g=i.W(g,{source:k})}let x=i.W({},g),S={};if(this.terrain&&v){x.source=this.terrain.get().source;let k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(S.style=k.serialize())}if(this._validate(Ie,"terrain",x,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h),this.fire(new i.f("data",{dataType:"style"}))}else{let x=this.terrain,S=x.get();for(let k of Object.keys(i.L.terrain))!g.hasOwnProperty(k)&&i.L.terrain[k].default&&(g[k]=i.L.terrain[k].default);for(let k in o)if(!_(o[k],S[k])){x.set(o,this.options),this.stylesheet.terrain=o;let D=this._getTransitionParameters({duration:0});x.updateTransitions(D),this.fire(new i.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){let h=this.fog=new Ug(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog;if(!_(h.get(),o)){h.set(o,this.options),this.stylesheet.fog=h.get();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createFog(o);this._markersNeedUpdate=!0}setColorTheme(o){this._checkLoaded();let h=()=>{for(let v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(let v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=o,!o)return this._styleColorTheme.lut=null,void h();let g=this._evaluateColorThemeData(o);this._loadColorTheme(g).then(()=>{h()}).catch(v=>{i.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(o){return{now:i.e.now(),transition:i.W(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;let o=[],h=[];for(let g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?o.push(g):h.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...h)}_createTerrain(o,h){let g=this.terrain=new Ki(o,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(let o in this._layers){let h=this._layers[o];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let o in this._layers){let h=this._layers[o];h.type==="symbol"&&this._updateLayer(h)}}_validate(o,h,g,v,x={}){if(x&&x.validate===!1)return!1;let S=i.W({},this.serialize());return Ls(this,o.call(be,i.W({key:h,style:S,value:g,styleSpec:i.L},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(o){let h=this.getSourceCaches(o);for(let g of h)g.clearTiles()}clearSources(){for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){let h=this.getSourceCaches(o);for(let g of h)g.resume(),g.reload()}reloadSources(){for(let o of this.getSources())o.reload&&o.reload()}updateSources(o){let h;this.directionalLight&&(h=Hd(this.directionalLight));for(let g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(o,void 0,void 0,h)}_generateCollisionBoxes(){for(let o in this._sourceCaches){let h=this._sourceCaches[o];h.resume(),h.reload()}}_updatePlacement(o,h,g,v,x,S,k=!1){let D=!1,A=!1,L={},z={};for(let H of this._mergedOrder){let Y=this._mergedLayers[H];if(Y.type!=="symbol")continue;let Z=i.al(Y.source,Y.scope),X=L[Z];if(!X){let re=this.getLayerSourceCache(Y);if(!re)continue;let oe=re.getRenderableIds(!0).map(ae=>re.getTileByID(ae));z[Z]=oe.slice(),X=L[Z]=oe.sort((ae,ge)=>ge.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(ge.tileID)?-1:1))}let Q=this.crossTileSymbolIndex.addLayer(Y,X,h.center.lng,h.projection);D=D||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new i.f("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.e.now(),h.zoom))&&(this.pauseablePlacement=new Ou(h,this._mergedOrder,k,g,v,x,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.e.now()),A=!0),D&&this.pauseablePlacement.placement.setStale()),A||D){this._buildingIndex.onNewFrame(h.zoom);for(let H=0;H<this._mergedOrder.length;H++){let Y=this._mergedLayers[this._mergedOrder[H]];if(Y.type!=="symbol")continue;let Z=this.isLayerClipped(Y)&&this._clipLayerIndices.some(X=>H<X);this.placement.updateLayerOpacities(Y,L[i.al(Y.source,Y.scope)],H,Z?S:null)}}let U=!1;for(let H of this._mergedOrder){let Y=this._mergedLayers[H];if(Y.type!=="symbol")continue;let Z=L[i.al(Y.source,Y.scope)];for(let X of Z){let Q=X.getBucket(Y);Q&&X.latestFeatureIndex&&Y.fqid===Q.layerIds[0]&&(U=Q.updateOcclusionOpacities(o.context,o.symbolParams,o._dt)||U)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.e.now())||U,occlusionQueryBasedOpacityChanged:U}}_releaseSymbolFadeTiles(){for(let o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,h){this._checkLoaded();let g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:x})=>x===o.id)!==-1)return void this.fire(new i.d(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!h)return g.push(o),this._loadImports([o],!0);let v=g.findIndex(({id:x})=>x===h);return v===-1&&this.fire(new i.d(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(o).concat(g.slice(v)),this._loadImports([o],!0,h)}updateImport(o,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(o);return v===-1?this:typeof h=="string"?(this.setImportUrl(o,h),this):(h.url&&h.url!==g[v].url&&this.setImportUrl(o,h.url),_(h.config,g[v].config)||this.setImportConfig(o,h.config),_(h.data,g[v].data)||this.setImportData(o,h.data),this)}moveImport(o,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(o);if(v===-1)return this;let x=this.getImportIndex(h);if(x===-1)return this;let S=g[v],k=this.fragments[v];return g=g.filter(({id:D})=>D!==o),this.fragments=this.fragments.filter(({id:D})=>D!==o),this.stylesheet.imports=g.slice(0,x).concat(S).concat(g.slice(x)),this.fragments=this.fragments.slice(0,x).concat(k).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(o,h){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(o);if(v===-1)return this;g[v].url=h;let x=this.fragments[v];return x.style=this._createFragmentStyle(g[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(h),this}setImportData(o,h){this._checkLoaded();let g=this.getImportIndex(o),v=this.stylesheet.imports||[];return g===-1?this:h?(this.fragments[g].style.setState(h),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(o,v[g].url))}setImportConfig(o,h){this._checkLoaded();let g=this.getImportIndex(o),v=this.stylesheet.imports||[];if(g===-1)return this;h?v[g].config=h:delete v[g].config;let x=this.fragments[g],S=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=h,x.style.updateConfig(h,S),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(o);g!==-1&&(h.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(o){let h=(this.stylesheet.imports||[]).findIndex(g=>g.id===o);return h===-1&&this.fire(new i.d(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),h}getLayer(o){return this._mergedLayers[o]}getSources(){let o=[];for(let h in this._mergedOtherSourceCaches){let g=this._mergedOtherSourceCaches[h];g&&o.push(g.getSource())}return o}getSource(o,h){let g=this.getSourceCache(o,h);return g&&g.getSource()}getLayerSource(o){let h=this.getLayerSourceCache(o);return h&&h.getSource()}getSourceCache(o,h){let g=i.al(o,h);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(o){let h=i.al(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);let h=[];return this._mergedOtherSourceCaches[o]&&h.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&h.push(this._mergedSymbolSourceCaches[o]),h}updateSourceCaches(){let o=this._changes.getUpdatedSourceCaches();for(let h in o){let g=o[h];g==="reload"?this.reloadSource(h):g==="clear"&&this.clearSource(h)}}updateLayers(o){let h=this._changes.getUpdatedPaintProperties();for(let g of h){let v=this.getLayer(g);v&&v.updateTransitions(o)}}getImages(o,h,g){this.imageManager.getImages(h.icons,h.scope,g),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(o,h,g){this.glyphManager.getGlyphs(h.stacks,h.scope,g)}getResource(o,h,g){return i.c$(h,g)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){let h=[];return this._otherSourceCaches[o]&&h.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&h.push(this._symbolSourceCaches[o]),h}_isSourceCacheLoaded(o){let h=this.getOwnSourceCaches(o);return h.length===0?(this.fire(new i.d(new Error(`There is no source with ID '${o}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,h){if(this._clipLayerIndices.length===0&&o.type!=="fill-extrusion")return!1;let g=o.type==="fill-extrusion"&&o.sourceLayer==="building",v=0;if(o.is3D()){if(g||h&&h.type==="batched-model")return!0;o.type==="model"&&(v=i.cu.Model)}else o.type==="symbol"&&(v=i.cu.Symbol);for(let x of this._clipLayerIndices){let S=this._mergedLayers[this._mergedOrder[x]];if(!S)continue;let k=[];for(let D of S.layout.get("clip-layer-types"))k.push(D==="model"?i.cu.Model:D==="symbol"?i.cu.Symbol:i.cu.FillExtrusion);for(let D of k)if(v&D)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Jp(f,o){let h=!1,g=null,v=()=>{g=null,h&&(f(),g=setTimeout(v,o),h=!1)};return()=>(h=!0,g||v(),g)}ha.getSourceType=function(f){return Ir[f]},ha.setSourceType=function(f,o){Ir[f]=o},ha.registerForPluginStateChange=i.cL;class $y{constructor(o){this._hashName=o&&encodeURIComponent(o),i.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Jp(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let o=this._map;if(!o)return"";let h=hh(o);if(this._hashName){let g=this._hashName,v=!1,x=location.hash.slice(1).split("&").map(S=>{let k=S.split("=")[0];return k===g?(v=!0,`${k}=${h}`):S}).filter(S=>S);return v||x.push(`${g}=${h}`),`#${x.join("&")}`}return`#${h}`}_getCurrentHash(){let o=location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){let o=this._map;if(!o)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){let g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(h[3]||0):o.getBearing();return o.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function hh(f,o){let h=f.getCenter(),g=Math.round(100*f.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),S=Math.round(h.lng*x)/x,k=Math.round(h.lat*x)/x,D=f.getBearing(),A=f.getPitch(),L=o?`/${S}/${k}/${g}`:`${g}/${k}/${S}`;return(D||A)&&(L+="/"+Math.round(10*D)/10),A&&(L+=`/${Math.round(A)}`),L}let Ru={linearity:.3,easing:i.d0(0,0,.3,1)},v_=i.W({deceleration:2500,maxSpeed:1400},Ru),ef=i.W({deceleration:20,maxSpeed:1400},Ru),Lu=i.W({deceleration:1e3,maxSpeed:360},Ru),tf=i.W({deceleration:1e3,maxSpeed:90},Ru);class vl{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.e.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,h=i.e.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let h={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);let g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){let x=uh(h.pan.mag(),g,i.W({},v_,o||{}));v.offset=h.pan.mult(x.amount/h.pan.mag()),v.center=this._map.transform.center,Pc(v,x)}if(h.zoom){let x=uh(h.zoom,g,ef);v.zoom=this._map.transform.zoom+x.amount,Pc(v,x)}if(h.bearing){let x=uh(h.bearing,g,Lu);v.bearing=this._map.transform.bearing+i.at(x.amount,-179,179),Pc(v,x)}if(h.pitch){let x=uh(h.pitch,g,tf);v.pitch=this._map.transform.pitch+x.amount,Pc(v,x)}if(v.zoom||v.bearing){let x=h.pinchAround===void 0?h.around:h.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Pc(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function uh(f,o,h){let{maxSpeed:g,linearity:v,deceleration:x}=h,S=i.at(f*v/(o/1e3),-g,g),k=Math.abs(S)/(x*v);return{easing:h.easing,duration:1e3*k,amount:S*(k/2)}}class Tr extends i.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g,v={}){let x=ut(h.getCanvasContainer(),g),S=h.unproject(x);super(o,i.W({point:x,lngLat:S,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class Fs extends i.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g){let v=o==="touchend"?g.changedTouches:g.touches,x=It(h.getCanvasContainer(),v),S=x.map(D=>h.unproject(D)),k=x.reduce((D,A,L,z)=>D.add(A.div(z.length)),new i.P(0,0));super(o,{points:x,point:k,lngLats:S,lngLat:h.unproject(k),originalEvent:g}),this._defaultPrevented=!1}}class Fu extends i.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class nf{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Fu(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new Tr(o.type,this._map,o))}mouseup(o){this._map.fire(new Tr(o.type,this._map,o))}preclick(o){let h=i.W({},o);h.type="preclick",this._map.fire(new Tr(h.type,this._map,h))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Tr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Tr(o.type,this._map,o))}mouseover(o){this._map.fire(new Tr(o.type,this._map,o))}mouseout(o){this._map.fire(new Tr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Fs(o.type,this._map,o))}touchmove(o){this._map.fire(new Fs(o.type,this._map,o))}touchend(o){this._map.fire(new Fs(o.type,this._map,o))}touchcancel(o){this._map.fire(new Fs(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mh{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Tr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Tr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zu{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(ke(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;let g=h,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=N("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));let S=Math.min(v.x,g.x),k=Math.max(v.x,g.x),D=Math.min(v.y,g.y),A=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${D}px)`,this._box.style.width=k-S+"px",this._box.style.height=A-D+"px")})}mouseupWindow(o,h){if(!this._active)return;let g=this._startPos,v=h;if(g&&o.button===0){if(this.reset(),qe(),g.x!==v.x||g.y!==v.y)return this._map.fire(new i.f("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new i.f(o,{originalEvent:h}))}}function ph(f,o){let h={};for(let g=0;g<f.length;g++)h[f[g].identifier]=o[g];return h}class x_{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){let x=new i.P(0,0);for(let S of v)x._add(S);return x.div(v.length)}(h),this.touches=ph(g,h)))}touchmove(o,h,g){if(this.aborted||!this.centroid)return;let v=ph(g,h);for(let x in this.touches){let S=v[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(o,h,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class fh{constructor(o){this.singleTap=new x_(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,h,g){this.singleTap.touchstart(o,h,g)}touchmove(o,h,g){this.singleTap.touchmove(o,h,g)}touchend(o,h,g){let v=this.singleTap.touchend(o,h,g);if(v){let x=o.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(v)<30;if(x&&S||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Bu{constructor(){this._zoomIn=new fh({numTouches:1,numTaps:2}),this._zoomOut=new fh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,g){this._zoomIn.touchstart(o,h,g),this._zoomOut.touchstart(o,h,g)}touchmove(o,h,g){this._zoomIn.touchmove(o,h,g),this._zoomOut.touchmove(o,h,g)}touchend(o,h,g){let v=this._zoomIn.touchend(o,h,g),x=this._zoomOut.touchend(o,h,g);return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(v)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let gh={0:1,2:2};class Nu{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;let g=wt(o);this._correctButton(o,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(o,h){let g=this._lastPoint;if(g){if(o.preventDefault(),this._eventButton!=null&&function(v,x){let S=gh[x];return v.buttons===void 0||(v.buttons&S)!==S}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(o){this._lastPoint&&wt(o)===this._eventButton&&(this._moved&&qe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class w_ extends Nu{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class rf extends Nu{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){let g=.8*(h.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class xl extends Nu{_correctButton(o,h){return h===0&&o.ctrlKey||h===2}_move(o,h){let g=-.5*(h.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class C_{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),i.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(o,h,g){return this._calculateTransform(o,h,g)}touchmove(o,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!i.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,h,g)}}touchend(o,h,g){this._calculateTransform(o,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,g){g.length>0&&(this._active=!0);let v=ph(g,h),x=new i.P(0,0),S=new i.P(0,0),k=0;for(let A in v){let L=v[A],z=this._touches[A];z&&(x._add(L),S._add(L.sub(z)),k++,v[A]=L)}if(this._touches=v,k<this._minTouches||!S.mag())return;let D=S.div(k);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(k),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class of{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,h,g){return{}}touchstart(o,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,g){let v=this._firstTwoTouches;if(!v)return;o.preventDefault();let[x,S]=v,k=Vu(g,h,x),D=Vu(g,h,S);if(!k||!D)return;let A=this._aroundCenter?null:k.add(D).div(2);return this._move([k,D],A,o)}touchend(o,h,g){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,S=Vu(g,h,v),k=Vu(g,h,x);S&&k||(this._active&&qe(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vu(f,o,h){for(let g=0;g<f.length;g++)if(f[g].identifier===h)return o[g]}function S_(f,o){return Math.log(f/o)/Math.LN2}class af extends of{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){let g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(S_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:S_(this._distance,g),pinchAround:h}}}function ju(f,o){return 180*f.angleWith(o)/Math.PI}class sf extends of{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){let g=this._vector;if(this._vector=o[0].sub(o[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ju(this._vector,g),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;let v=ju(o,g);return Math.abs(v)<h}}function _h(f){return Math.abs(f.y)>Math.abs(f.x)}class M_ extends of{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,_h(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,g){let v=this._lastPoints;if(!v)return;let x=o[0].sub(v[0]),S=o[1].sub(v[1]);return this._map._cooperativeGestures&&!i.d1()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(x,S,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5})}gestureBeginsVertically(o,h,g){if(this._valid!==void 0)return this._valid;let v=o.mag()>=2,x=h.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;let S=o.y>0==h.y>0;return _h(o)&&_h(h)&&S}}let k_={panStep:100,bearingStep:15,pitchStep:10};class Yy{constructor(){let o=k_;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,g=0,v=0,x=0,S=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),S=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:k=>{let D=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:bh,zoom:h?Math.round(D)+h*(o.shiftKey?2:1):D,bearing:k.getBearing()+g*this._bearingStep,pitch:k.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-S*this._panStep],center:k.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bh(f){return f*(2-f)}let Oc=4.000244140625,I_=1/450;class Do{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=I_,i.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||i.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,g=i.e.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%Oc==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=ut(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let h=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){let A=this._type==="wheel"&&Math.abs(this._delta)>Oc?this._wheelZoomRate:this._defaultZoomRate,L=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&L!==0&&(L=1/L);let z=h(),U=Math.pow(2,z),H=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(H*L))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,x=this._easing,S,k=!1;if(this._type==="wheel"&&v&&x){let A=Math.min((i.e.now()-this._lastWheelEventTime)/200,1),L=x(A);S=i.a2(v,g,L),A<1?this._frameId||(this._frameId=!0):k=!0}else S=g,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=S-h();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=i.d2;if(this._prevEase){let g=this._prevEase,v=(i.e.now()-g.start)/g.duration,x=g.easing(v+.01)-g.easing(v),S=.27/Math.sqrt(x*x+1e-4)*.01,k=Math.sqrt(.0729-S*S);h=i.d0(S,k,.25,1)}return this._prevEase={start:i.e.now(),duration:o,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class lf{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Uu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,h){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hu{constructor(){this._tap=new fh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,h,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,h,g))}touchmove(o,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;let v=h[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,h,g)}touchend(o,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(o,h,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cf{constructor(o,h,g){this._el=o,this._mousePan=h,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class df{constructor(o,h,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wu{constructor(o,h,g,v){this._el=o,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Rc=f=>f.zoom||f.drag||f.pitch||f.rotate;class hf extends i.f{}class Gu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,h){let g=i._.sub([],h,o);this.radius=i._.length(g[2]<0?i._.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){i._.div(o,o,this.constants),i._.normalize(o,o),i._.mul(o,o,this.constants);let h=i._.scale([],o,this.radius);if(h[2]>0){let g=i._.scale([],[0,0,1],i._.dot(h,[0,0,1])),v=i._.scale([],i._.normalize([],[h[0],h[1],0]),this.radius),x=i._.add([],h,i._.scale([],i._.sub([],i._.add([],v,g),h),2));h[0]=x[0],h[1]=x[1]}return h}}function yh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class T_{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vl(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Gu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),i.bp(["handleEvent","handleWindowEvent"],this);let g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,x,S]of this._listeners){let k=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,k,S)}}destroy(){for(let[o,h,g]of this._listeners){let v=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(h,v,g)}}_addDefaultHandlers(o){let h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new nf(h,o));let v=h.boxZoom=new zu(h,o);this._add("boxZoom",v);let x=new Bu,S=new Uu;h.doubleClickZoom=new lf(S,x),this._add("tapZoom",x),this._add("clickZoom",S);let k=new Hu;this._add("tapDragZoom",k);let D=h.touchPitch=new M_(h);this._add("touchPitch",D);let A=new rf(o),L=new xl(o);h.dragRotate=new df(o,A,L),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);let z=new w_(o),U=new C_(h,o);h.dragPan=new cf(g,z,U),this._add("mousePan",z),this._add("touchPan",U,["touchZoom","touchRotate"]);let H=new sf,Y=new af;h.touchZoomRotate=new Wu(g,Y,H,k),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new mh(h));let Z=h.scrollZoom=new Do(h,this);this._add("scrollZoom",Z,["mousePan"]);let X=h.keyboard=new Yy;this._add("keyboard",X);for(let Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[Q]&&h[Q].enable(o[Q])}_add(o,h,g){this._handlers.push({handlerName:o,handler:h,allowed:g}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Rc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,h,g){for(let v in o)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){let h=[];for(let g of o)this._el.contains(g.target)&&h.push(g);return h}handleEvent(o,h){this._updatingCamera=!0;let g=o.type==="renderFrame",v=g?void 0:o,x={needsRenderFrame:!1},S={},k={},D=o.touches?this._getMapTouches(o.touches):void 0,A=D?It(this._el,D):g?void 0:ut(this._el,o);for(let{handlerName:U,handler:H,allowed:Y}of this._handlers){if(!H.isEnabled())continue;let Z;this._blockedByActive(k,Y,U)?H.reset():H[h||o.type]&&(Z=H[h||o.type](o,A,D),this.mergeHandlerResult(x,S,Z,U,v),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||H.isActive())&&(k[U]=H)}let L={};for(let U in this._previousActiveHandlers)k[U]||(L[U]=v);this._previousActiveHandlers=k,(Object.keys(L).length||yh(x))&&(this._changes.push([x,S,L]),this._triggerRenderFrame()),(Object.keys(k).length||yh(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:z}=x;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(o,h,g,v,x){if(!g)return;i.W(o,g);let S={handlerName:v,originalEvent:g.originalEvent||x};g.zoomDelta!==void 0&&(h.zoom=S),g.panDelta!==void 0&&(h.drag=S),g.pitchDelta!==void 0&&(h.pitch=S),g.bearingDelta!==void 0&&(h.rotate=S)}_applyChanges(){let o={},h={},g={};for(let[v,x,S]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new i.P(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(o.around=v.around),v.aroundCoord!==void 0&&(o.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),i.W(h,x),i.W(g,S);this._updateMapTransform(o,h,g),this._changes=[]}_updateMapTransform(o,h,g){let v=this._map,x=v.transform,S=re=>[re.x,re.y,re.z];if((re=>{let oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!yh(o)){let re=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),re!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!yh(o))return void this._fireEvents(h,g,!0);let{panDelta:k,zoomDelta:D,bearingDelta:A,pitchDelta:L,around:z,aroundCoord:U,pinchAround:H}=o;x._isCameraConstrained&&(D>0&&(D=0),x._isCameraConstrained=!1),H!==void 0&&(z=H),(D||(re=>h[re]&&!this._eventsInProgress[re])("drag"))&&z&&(this._dragOrigin=S(x.pointCoordinate3D(z)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),z=z||v.transform.centerPoint,A&&(x.bearing+=A),L&&(x.pitch+=L),x._updateCameraState();let Y=[0,0,0];if(k)if(x.projection.name==="mercator"){let re=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z).dir),oe=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z.sub(k)).dir);Y[0]=oe[0]-re[0],Y[1]=oe[1]-re[1]}else{let re=x.pointCoordinate(z);if(x.projection.name==="globe"){k=k.rotate(-x.angle);let oe=x._pixelsPerMercatorPixel/x.worldSize;Y[0]=-k.x*i.d3(i.ay(re.y))*oe,Y[1]=-k.y*i.d3(x.center.lat)*oe}else{let oe=x.pointCoordinate(z.sub(k));re&&oe&&(Y[0]=oe.x-re.x,Y[1]=oe.y-re.y)}}let Z=x.zoom,X=[0,0,0];if(D){let re=S(U||x.pointCoordinate3D(z)),oe={dir:i._.normalize([],i._.sub([],re,x._camera.position))};if(oe.dir[2]<0){let ae=x.zoomDeltaToMovement(re,D);i._.scale(X,oe.dir,ae)}}let Q=i._.add(Y,Y,X);x._translateCameraConstrained(Q),D&&Math.abs(x.zoom-Z)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,g,!0)}_fireEvents(o,h,g){let v=Rc(this._eventsInProgress),x=Rc(o),S={};for(let L in o){let{originalEvent:z}=o[L];this._eventsInProgress[L]||(S[`${L}start`]=z),this._eventsInProgress[L]=o[L]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let L in S)this._fireEvent(L,S[L]);x&&this._fireEvent("move",x.originalEvent);for(let L in o){let{originalEvent:z}=o[L];this._fireEvent(L,z)}let k={},D;for(let L in this._eventsInProgress){let{handlerName:z,originalEvent:U}=this._eventsInProgress[L];this._handlersById[z].isActive()||(delete this._eventsInProgress[L],D=h[z]||U,k[`${L}end`]=D)}for(let L in k)this._fireEvent(L,k[L]);let A=Rc(this._eventsInProgress);if(g&&(v||x)&&!A){this._updatingCamera=!0;let L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;L?(z(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:D})):(this._map.fire(new i.f("moveend",{originalEvent:D})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new i.f(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new hf("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let wl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Zy extends i.E{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,i.bp(["_renderFrameCallback"],this)}getCenter(){return new i.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,g){return o=i.P.convert(o).mult(-1),this.panTo(this.transform.center,i.W({offset:o},h),g)}panTo(o,h,g){return this.easeTo(i.W({center:o},h),g)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,g){return this.easeTo(i.W({zoom:o},h),g)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,g){return this.easeTo(i.W({bearing:o},h),g)}resetNorth(o,h){return this.rotateTo(0,i.W({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(i.W({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=i.ai.convert(o);let g=h&&h.bearing||0,v=h&&h.pitch||0,x=o.getNorthWest(),S=o.getSouthEast();return this._cameraForBounds(this.transform,x,S,g,v,h)}_extendPadding(o){let h={top:0,right:0,bottom:0,left:0};return o==null?i.W({},h,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:i.W({},h,o)}_extendCameraOptions(o){return(o=i.W({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,h){let g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>o.aspect?g/(2*Math.tan(.5*o.fovX)*o.aspect):v/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,h,g,v,x,S){let k=o.clone(),D=this._extendCameraOptions(S);k.bearing=v,k.pitch=x;let A=i.aI.convert(h),L=i.aI.convert(g),z=.5*(A.lat+L.lat),U=.5*(A.lng+L.lng),H=i.d4(z,U),Y=i._.normalize([],H),Z=i._.normalize([],i._.cross([],Y,[0,1,0])),X=i._.cross([],Z,Y),Q=[Z[0],Z[1],Z[2],0,X[0],X[1],X[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],re=[H,i.d4(A.lat,A.lng),i.d4(L.lat,A.lng),i.d4(L.lat,L.lng),i.d4(A.lat,L.lng),i.d4(z,A.lng),i.d4(z,L.lng),i.d4(A.lat,U),i.d4(L.lat,U)],oe=i.b6.fromPoints(re.map(Ye=>[i._.dot(Z,Ye),i._.dot(X,Ye),i._.dot(Y,Ye)])),ae=i._.transformMat4([],oe.center,Q);i._.squaredLength(ae)===0&&i._.set(ae,0,0,1),i._.normalize(ae,ae),i._.scale(ae,ae,i.cD),k.center=i.d5(ae);let ge=k.getWorldToCameraMatrix(),fe=i.ad.invert(new Float64Array(16),ge);oe=i.b6.applyTransform(oe,i.ad.multiply([],ge,Q));let ne=this._extendAABB(oe,k,D,v);if(!ne)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=ne,i._.transformMat4(ae,ae,ge);let se=.5*(oe.max[2]-oe.min[2]),le=this._minimumAABBFrustumDistance(k,oe),we=i._.scale([],[0,0,1],se),Re=i._.add(we,ae,we),me=le+(k.pitch===0?0:i._.distance(ae,Re)),Le=k.globeCenterInViewSpace,Be=i._.sub([],ae,[Le[0],Le[1],Le[2]]);i._.normalize(Be,Be),i._.scale(Be,Be,me);let Qe=i._.add([],ae,Be);i._.transformMat4(Qe,Qe,fe);let Je=i.d7/i.cD,Ze=i._.length(Qe),Te=i.ax(Math.max(Ze*Je-i.d7,Number.EPSILON),0),Ve=Math.min(k.zoomFromMercatorZAdjusted(Te),D.maxZoom);return Ve>.5*(i.b1+i.aU)?(k.setProjection({name:"mercator"}),k.zoom=Ve,this._cameraForBounds(k,h,g,v,x,S)):{center:k.center,zoom:Ve,bearing:v,pitch:x}}_extendAABB(o,h,g,v){let x=.5*((g.padding.left||0)+(g.padding.right||0)),S=.5*((g.padding.top||0)+(g.padding.bottom||0)),k=S,D=x,A=x,L=S,z=h.width-(D+A),U=h.height-(k+L),H=i._.sub([],o.max,o.min),Y=Math.min(z/H[0],U/H[1]),Z=Math.min(h.scaleZoom(h.scale*Y),g.maxZoom);if(isNaN(Z))return null;let X=h.scale/h.zoomScale(Z),Q=new i.b6([o.min[0]-D*X,o.min[1]-L*X,o.min[2]],[o.max[0]+A*X,o.max[1]+k*X,o.max[2]]),re=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new i.P(g.offset.x,g.offset.y):i.P.convert(g.offset)).rotate(-i.ab(v));return Q.center[0]-=re.x*X,Q.center[1]+=re.y*X,Q}queryTerrainElevation(o,h){let g=this.transform.elevation;return g?(h=i.W({},{exaggerated:!0},h),g.getAtPoint(i.Y.fromLngLat(o),null,h.exaggerated)):null}_cameraForBounds(o,h,g,v,x,S){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,h,g,v,x,S);let k=o.clone(),D=this._extendCameraOptions(S);k.bearing=v,k.pitch=x;let A=i.aI.convert(h),L=i.aI.convert(g),z=new i.aI(A.lng,L.lat),U=new i.aI(L.lng,A.lat),H=k.project(A),Y=k.project(L),Z=this.queryTerrainElevation(A),X=this.queryTerrainElevation(L),Q=this.queryTerrainElevation(z),re=this.queryTerrainElevation(U),oe=[[H.x,H.y,Math.min(Z||0,X||0,Q||0,re||0)],[Y.x,Y.y,Math.max(Z||0,X||0,Q||0,re||0)]],ae=i.b6.fromPoints(oe),ge=k.getWorldToCameraMatrix(),fe=i.ad.invert(new Float64Array(16),ge);ae=i.b6.applyTransform(ae,ge);let ne=this._extendAABB(ae,k,D,v);if(!ne)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=ne;let se=.5*i._.sub([],ae.max,ae.min)[2],le=this._minimumAABBFrustumDistance(k,ae),we=[0,0,1,0];i.aA.transformMat4(we,we,ge),i.aA.normalize(we,we);let Re=i._.scale([],we,le+se),me=i._.add([],ae.center,Re);i._.transformMat4(ae.center,ae.center,fe),i._.transformMat4(me,me,fe);let Le=[ae.center[0],ae.center[1],me[2]*k.pixelsPerMeter];i._.scale(Le,Le,1/k.worldSize);let Be=i.d6(Le[0]),Qe=i.ay(Le[1]),Je=Math.min(k._zoomFromMercatorZ(Le[2]),D.maxZoom),Ze=new i.aI(Be,Qe);return k.mercatorFromTransition&&Je<.5*(i.b1+i.aU)?(k.setProjection({name:"globe"}),k.zoom=Je,this._cameraForBounds(k,h,g,v,x,S)):{center:Ze,zoom:Je,bearing:v,pitch:x}}fitBounds(o,h,g){let v=this.cameraForBounds(o,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(o,h,g,v,x){let S=i.P.convert(o),k=i.P.convert(h),D=new i.P(Math.min(S.x,k.x),Math.min(S.y,k.y)),A=new i.P(Math.max(S.x,k.x),Math.max(S.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,k))return this;let L=this.transform.pointLocation3D(D),z=this.transform.pointLocation3D(A),U=this.transform.pointLocation3D(new i.P(D.x,A.y)),H=this.transform.pointLocation3D(new i.P(A.x,D.y)),Y=[Math.min(L.lng,z.lng,U.lng,H.lng),Math.min(L.lat,z.lat,U.lat,H.lat)],Z=[Math.max(L.lng,z.lng,U.lng,H.lng),Math.max(L.lat,z.lat,U.lat,H.lat)],X=v&&v.pitch?v.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,Y,Z,g,X,v);return this._fitInternal(Q,v,x)}_fitInternal(o,h,g){return o?(h=i.W(o,h)).linear?this.easeTo(h,g):this.flyTo(h,g):this}jumpTo(o,h){this.stop();let g=o.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,S=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(v=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=i.aI.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(x=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(S=!0,g.pitch=+o.pitch),o.padding==null||g.isPaddingEqual(o.padding)||(g.padding=o.padding),o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new i.f("movestart",h)).fire(new i.f("move",h)),v&&this.fire(new i.f("zoomstart",h)).fire(new i.f("zoom",h)).fire(new i.f("zoomend",h)),x&&this.fire(new i.f("rotatestart",h)).fire(new i.f("rotate",h)).fire(new i.f("rotateend",h)),S&&this.fire(new i.f("pitchstart",h)).fire(new i.f("pitch",h)).fire(new i.f("pitchend",h)),this.fire(new i.f("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(wl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,h){let g=this.transform;if(!g.projection.supportsFreeCamera)return i.w(wl),this;this.stop();let v=g.zoom,x=g.pitch,S=g.bearing;g.setFreeCameraOptions(o);let k=v!==g.zoom,D=x!==g.pitch,A=S!==g.bearing;return this.fire(new i.f("movestart",h)).fire(new i.f("move",h)),k&&this.fire(new i.f("zoomstart",h)).fire(new i.f("zoom",h)).fire(new i.f("zoomend",h)),A&&this.fire(new i.f("rotatestart",h)).fire(new i.f("rotate",h)).fire(new i.f("rotateend",h)),D&&this.fire(new i.f("pitchstart",h)).fire(new i.f("pitch",h)).fire(new i.f("pitchend",h)),this.fire(new i.f("moveend",h)),this}easeTo(o,h){this._stop(!1,o.easeId),((o=i.W({offset:[0,0],duration:500,easing:i.d2},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);let g=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in o?+o.zoom:v,A="bearing"in o?this._normalizeBearing(o.bearing,x):x,L="pitch"in o?+o.pitch:S,z=this._extendPadding(o.padding),U=i.P.convert(o.offset),H,Y,Z;if(g.projection.name==="globe"){let le=i.Y.fromLngLat(g.center),we=U.rotate(-g.angle);le.x+=we.x/g.worldSize,le.y+=we.y/g.worldSize;let Re=le.toLngLat(),me=i.aI.convert(o.center||Re);this._normalizeCenter(me),H=g.centerPoint.add(we),Y=new i.P(le.x,le.y).mult(g.worldSize),Z=new i.P(i.aj(me.lng),i.ak(me.lat)).mult(g.worldSize).sub(Y)}else{H=g.centerPoint.add(U);let le=g.pointLocation(H),we=i.aI.convert(o.center||le);this._normalizeCenter(we),Y=g.project(le),Z=g.project(we).sub(Y)}let X=g.zoomScale(D-v),Q,re;o.around&&(Q=i.aI.convert(o.around),re=g.locationPoint(Q));let oe=this._zooming||D!==v,ae=this._rotating||x!==A,ge=this._pitching||L!==S,fe=!g.isPaddingEqual(z),ne=le=>we=>{if(oe&&(le.zoom=i.a2(v,D,we)),ae&&(le.bearing=i.a2(x,A,we)),ge&&(le.pitch=i.a2(S,L,we)),fe&&(le.interpolatePadding(k,z,we),H=le.centerPoint.add(U)),Q)le.setLocationAtPoint(Q,re);else{let Re=le.zoomScale(le.zoom-v),me=D>v?Math.min(2,X):Math.max(.5,X),Le=Math.pow(me,1-we),Be=le.unproject(Y.add(Z.mult(we*Le)).mult(Re));le.setLocationAtPoint(le.renderWorldCopies?Be.wrap():Be,H)}return o.preloadOnly||this._fireMoveEvents(h),le};if(o.preloadOnly){let le=this._emulate(ne,o.duration,g);return this._preloadTiles(le),this}let se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ae,this._pitching=ge,this._padding=fe,this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,se),this._ease(ne(g),le=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(h,le)},o),this}_prepareEase(o,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||g.moving||this.fire(new i.f("movestart",o)),this._zooming&&!g.zooming&&this.fire(new i.f("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new i.f("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new i.f("pitchstart",o))}_fireMoveEvents(o){this.fire(new i.f("move",o)),this._zooming&&this.fire(new i.f("zoom",o)),this._rotating&&this.fire(new i.f("rotate",o)),this._pitching&&this.fire(new i.f("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let g=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new i.f("zoomend",o)),v&&this.fire(new i.f("rotateend",o)),x&&this.fire(new i.f("pitchend",o)),this.fire(new i.f("moveend",o))}flyTo(o,h){if(this._prefersReducedMotion(o)){let Ve=i.ah(o,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ve,h)}this.stop(),o=i.W({offset:[0,0],speed:1.2,curve:1.42,easing:i.d2},o);let g=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),k=this.getPadding(),D="zoom"in o?i.at(+o.zoom,g.minZoom,g.maxZoom):v,A="bearing"in o?this._normalizeBearing(o.bearing,x):x,L="pitch"in o?+o.pitch:S,z=this._extendPadding(o.padding),U=g.zoomScale(D-v),H=i.P.convert(o.offset),Y=g.centerPoint.add(H),Z=g.pointLocation(Y),X=i.aI.convert(o.center||Z);this._normalizeCenter(X);let Q=g.project(Z),re=g.project(X).sub(Q),oe=o.curve,ae=Math.max(g.width,g.height),ge=ae/U,fe=re.mag();if("minZoom"in o){let Ve=i.at(Math.min(o.minZoom,v,D),g.minZoom,g.maxZoom),Ye=ae/g.zoomScale(Ve-v);oe=Math.sqrt(Ye/fe*2)}let ne=oe*oe;function se(Ve){let Ye=(ge*ge-ae*ae+(Ve?-1:1)*ne*ne*fe*fe)/(2*(Ve?ge:ae)*ne*fe);return Math.log(Math.sqrt(Ye*Ye+1)-Ye)}function le(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function we(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}let Re=se(0),me=function(Ve){return we(Re)/we(Re+oe*Ve)},Le=function(Ve){return ae*((we(Re)*(le(Ye=Re+oe*Ve)/we(Ye))-le(Re))/ne)/fe;var Ye},Be=(se(1)-Re)/oe;if(Math.abs(fe)<1e-6||!isFinite(Be)){if(Math.abs(ae-ge)<1e-6)return this.easeTo(o,h);let Ve=ge<ae?-1:1;Be=Math.abs(Math.log(ge/ae))/oe,Le=function(){return 0},me=function(Ye){return Math.exp(Ve*oe*Ye)}}o.duration="duration"in o?+o.duration:1e3*Be/("screenSpeed"in o?+o.screenSpeed/oe:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);let Qe=x!==A,Je=L!==S,Ze=!g.isPaddingEqual(z),Te=Ve=>Ye=>{let gt=Ye*Be,yt=1/me(gt);Ve.zoom=Ye===1?D:v+Ve.scaleZoom(yt),Qe&&(Ve.bearing=i.a2(x,A,Ye)),Je&&(Ve.pitch=i.a2(S,L,Ye)),Ze&&(Ve.interpolatePadding(k,z,Ye),Y=Ve.centerPoint.add(H));let kt=Ye===1?X:Ve.unproject(Q.add(re.mult(Le(gt))).mult(yt));return Ve.setLocationAtPoint(Ve.renderWorldCopies?kt.wrap():kt,Y),Ve._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(h),Ve};if(o.preloadOnly){let Ve=this._emulate(Te,o.duration,g);return this._preloadTiles(Ve),this}return this._zooming=!0,this._rotating=Qe,this._pitching=Je,this._padding=Ze,this._prepareEase(h,!1),this._ease(Te(g),()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!o){let g=this.handlers;g&&g.stop(!1)}return this}_ease(o,h,g){g.animate===!1||g.duration===0?(o(1),h()):(this._easeStart=i.e.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let o=Math.min((i.e.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=i.au(o,-180,180);let g=Math.abs(o-h);return Math.abs(o-360-h)<g&&(o-=360),Math.abs(o+360-h)<g&&(o+=360),o}_normalizeCenter(o){let h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;let g=o.lng-h.center.lng;o.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&i.e.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,h,g){let v=Math.ceil(15*h/1e3),x=[],S=o(g.clone());for(let k=0;k<=v;k++){let D=S(k/v);x.push(D.clone())}return x}_preloadTiles(o,h){}}class E_{constructor(o={}){this.options=o,i.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){let h=this.options&&this.options.compact;return this._map=o,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=N("button","mapboxgl-ctrl-attrib-button",this._container),N("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,h){let g=this._map._getUIString(`AttributionControl.${h}`);o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.d8.ACCESS_TOKEN}];if(o){let g=h.reduce((v,x,S)=>(x.value&&(v+=`${x.key}=${x.value}${S<h.length-1?"&":""}`),v),"?");o.href=`${i.d8.FEEDBACK_URL}/${g}#${hh(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let h=this._map.style._mergedSourceCaches;for(let v in h){let x=h[v];if(x.used){let S=x.getSource();S.attribution&&o.indexOf(S.attribution)<0&&o.push(S.attribution)}}o.sort((v,x)=>v.length-x.length),o=o.filter((v,x)=>{for(let S=x+1;S<o.length;S++)if(o[S].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));let g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class D_{constructor(){i.bp(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=N("div","mapboxgl-ctrl");let h=N("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(let h in o){let g=o[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){let o=this._container.children;if(o.length){let h=o[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class A_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){let h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(let v of g)if(v.id===o)return void(v.cancelled=!0)}run(o=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let g of h)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function P_(f,o,h){if(f=new i.aI(f.lng,f.lat),o){let g=new i.aI(f.lng-360,f.lat),v=new i.aI(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-h.center.lng)/360),S=h.locationPoint(f).distSqr(o),k=o.x<0||o.y<0||o.x>h.width||o.y>h.height;h.locationPoint(g).distSqr(o)<S&&(k||Math.abs(g.lng-h.center.lng)<x)?f=g:h.locationPoint(v).distSqr(o)<S&&(k||Math.abs(v.lng-h.center.lng)<x)&&(f=v)}for(;Math.abs(f.lng-h.center.lng)>180;){let g=h.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}let uf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class vh extends i.E{constructor(o,h){if(super(),(o instanceof HTMLElement||h)&&(o=i.W({element:o},h)),i.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=i.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=N("div");let x=41,S=27,k=q("svg",{display:"block",height:x*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${x}`},this._element),D=q("radialGradient",{id:"shadowGradient"},q("defs",{},k));q("stop",{offset:"10%","stop-opacity":.4},D),q("stop",{offset:"100%","stop-opacity":.05},D),q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=i.P.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let g=this._element.classList;for(let x in uf)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=o&&o.className?o.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){let o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=i.aI.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){let h=o.code,g=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(o){let h=o.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let o=this._map,h=this._pos;if(!o||!h)return!1;let g=o.unproject(h),v=o.getFreeCameraOptions();if(!v.position)return!1;let x=v.position.toLngLat();return x.distanceTo(g)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){let o=this._map;if(!o)return;let h=this._pos;if(!h||h.x<0||h.x>o.transform.width||h.y<0||h.y>o.transform.height)return void this._clearFadeTimer();let g=o.unproject(h),v;o._showingGlobe()&&i.d9(o.transform,this._lngLat)?v=0:(v=1-o._queryFogOpacity(g),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let o=this._pos;if(!o||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${uf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let o=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!o||g!=="map")return"";if(!h._showingGlobe()){let D=h.getPitch();return D?`rotateX(${D}deg)`:""}let v=i.b0(i.da(h.transform,this._lngLat)),x=o.sub(i.db(h.transform)),S=Math.abs(x.x)+Math.abs(x.y);if(S===0)return"";let k=v/S;return`rotateX(${-x.y*k}deg) rotateY(${x.x*k}deg)`}_calculateZTransform(){let o=this._pos,h=this._map;if(!h||!o)return"";let g=0,v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){let x=h.project(new i.aI(this._lngLat.lng,this._lngLat.lat+.001)),S=h.project(new i.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);g=i.b0(Math.atan2(S.y,S.x))-90}else g=-h.getBearing();else if(v==="horizon"){let x=i.$(4,6,h.getZoom()),S=i.db(h.transform);S.y+=x*h.transform.height;let k=o.sub(S),D=i.b0(Math.atan2(k.y,k.x));g=(D>90?D-270:D+90)*(1-x)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=P_(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=i.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){let h=this._map;if(!h)return;let g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){let x=this._clickTolerance||h._clickTolerance;if(o.point.dist(g)<x)return;this._isDragging=!0}this._pos=o.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.f("dragstart"))),this.fire(new i.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.f("dragend")),this._state="inactive"}_addDragHandler(o){let h=this._map,g=this._pos;h&&g&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(g),this._pointerdownPos=o.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;let h=this._map;return h&&(o?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let mf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},O_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cl(f=new i.P(0,0),o="bottom"){if(typeof f=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(o){case"top":return new i.P(0,f);case"top-left":return new i.P(h,h);case"top-right":return new i.P(-h,h);case"bottom":return new i.P(0,-f);case"bottom-left":return new i.P(h,-h);case"bottom-right":return new i.P(-h,-h);case"left":return new i.P(f,0);case"right":return new i.P(-f,0)}return new i.P(0,0)}return f instanceof i.P||Array.isArray(f)?i.P.convert(f):i.P.convert(f[o]||[0,0])}class R_{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;let h=i.b9((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,h,g){this._start=this.getValue(h),this._end=o,this._startTime=h,this._endTime=h+g}}let L_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class F_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let pf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Sl={showCompass:!0,showZoom:!0,visualizePitch:!1};class z_{constructor(o,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new rf({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new xl({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),i.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),ke()}move(o,h){let g=this.map,v=this.mouseRotate.mousemoveWindow(o,h),x=v&&v.bearingDelta;if(x&&g.setBearing(g.getBearing()+x),this.mousePitch){let S=this.mousePitch.mousemoveWindow(o,h),k=S&&S.pitchDelta;k&&g.setPitch(g.getPitch()+k)}}off(){let o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(i.W({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ut(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ut(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=It(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=It(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Ml={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},B_={maxWidth:100,unit:"metric"},qu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:i.dt,supported:C,setRTLTextPlugin:i.dv,getRTLTextPluginStatus:i.dw,Map:class extends Zy{constructor(f){i.dc.mark(i.dd.create);let o=f;if((f=i.W({},pf,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&i.de(window)&&(f.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Sa(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new A_,this._domRenderTaskQueue=new A_,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.df(),this._locale=i.W({},L_,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new R_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new i.dg(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Zi({},f.contextCreateOptions):{},typeof f.container=="string"){let h=document.getElementById(f.container);if(!h)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=h}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),i.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new F_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new T_(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||i.d8.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new $y(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});let h=f.bounds;h&&(this.resize(),this.fitBounds(h,i.W({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new E_({customAttribution:f.customAttribution})),this._logoControl=new D_,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new i.f(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new i.f(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(f,o){if(o===void 0&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new i.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=f.onAdd(this);this._controls.push(f);let g=this._controlPositions[o];return o.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new i.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let o=!this._moving;return o&&this.fire(new i.f("movestart",f)).fire(new i.f("move",f)),this.fire(new i.f("resize",f)),o&&this.fire(new i.f("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(i.ai.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new i.f("zoomstart")).fire(new i.f("zoom")).fire(new i.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new i.f("zoomstart")).fire(new i.f("zoom")).fire(new i.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new i.f("pitchstart")).fire(new i.f("pitch")).fire(new i.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new i.f("pitchstart")).fire(new i.f("pitch")).fire(new i.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(o=>o==="auto"?navigator.language:o):f}setLanguage(f){let o=this._parseLanguage(f);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(let h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,o=f.projection.name,h;o==="globe"&&f.zoom>=i.aU?(f.setMercatorFromTransition(),h=!0):o==="mercator"&&f.zoom<i.aU&&(f.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,o){return this._updateProjection(f||o||{name:"mercator"})}_updateProjection(f){let o;return o=f.name==="globe"&&this.transform.zoom>=i.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(i.aI.convert(f))}unproject(f){return this.transform.pointLocation3D(i.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,o,h){if(f==="mouseenter"||f==="mouseover"){let g=!1,v=S=>{let k=o.filter(A=>this.getLayer(A)),D=k.length?this.queryRenderedFeatures(S.point,{layers:k}):[];D.length?g||(g=!0,h.call(this,new Tr(f,this,S.originalEvent,{features:D}))):g=!1},x=()=>{g=!1};return{layers:new Set(o),listener:h,delegates:{mousemove:v,mouseout:x}}}if(f==="mouseleave"||f==="mouseout"){let g=!1,v=S=>{let k=o.filter(D=>this.getLayer(D));(k.length?this.queryRenderedFeatures(S.point,{layers:k}):[]).length?g=!0:g&&(g=!1,h.call(this,new Tr(f,this,S.originalEvent)))},x=S=>{g&&(g=!1,h.call(this,new Tr(f,this,S.originalEvent)))};return{layers:new Set(o),listener:h,delegates:{mousemove:v,mouseout:x}}}{let g=v=>{let x=o.filter(k=>this.getLayer(k)),S=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];S.length&&(v.features=S,h.call(this,v),delete v.features)};return{layers:new Set(o),listener:h,delegates:{[f]:g}}}}on(f,o,h){if(typeof o=="function"||h===void 0)return super.on(f,o);if(Array.isArray(o)||(o=[o]),o){for(let v of o)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(f,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(let v in g.delegates)this.on(v,g.delegates[v]);return this}once(f,o,h){if(typeof o=="function"||h===void 0)return super.once(f,o);if(Array.isArray(o)||(o=[o]),o){for(let v of o)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(f,o,h);for(let v in g.delegates)this.once(v,g.delegates[v]);return this}off(f,o,h){if(typeof o=="function"||h===void 0)return super.off(f,o);let g=new Set(Array.isArray(o)?o:[o]);for(let S of g)if(!this._isValidId(S))return this;let v=(S,k)=>{if(S.size!==k.size)return!1;for(let D of S)if(!k.has(D))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[f]:void 0;return x&&(S=>{for(let k=0;k<S.length;k++){let D=S[k];if(D.listener===h&&v(D.layers,g)){for(let A in D.delegates)this.off(A,D.delegates[A]);return S.splice(k,1),this}}})(x),this}queryRenderedFeatures(f,o){if(!this.style)return[];if(o!==void 0||f===void 0||f instanceof i.P||Array.isArray(f)||(o=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(o=o||{}).layers&&Array.isArray(o.layers)){for(let h of o.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(f,o,this.transform)}querySourceFeatures(f,o){return this._isValidId(f)?this.style.querySourceFeatures(f,o):[]}isPointOnSurface(f){let{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&i.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(f))}setStyle(f,o){return o=i.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&f&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(f,(h,g)=>{h?(i.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(f,o)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(f,o))}_getUIString(f){let o=this._locale[f];if(o==null)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){let h=i.W({},o);o&&o.config&&(h.initialConfig=o.config,delete h.config),this.style=new ha(this,h).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ha(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new i.d(new Error("IDs can't be empty."))),!1):!i.cV(f)||(this.fire(new i.d(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,o){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,o,h){this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,h)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,o,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:x,content:S}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){let{width:k,height:D,data:A}=i.e.getImageData(o);this.style.addImage(f,{data:new i.i({width:k,height:D},A),pixelRatio:h,stretchX:v,stretchY:x,content:S,sdf:g,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new i.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:k,height:D}=o,A=o;this.style.addImage(f,{data:new i.i({width:k,height:D},new Uint8Array(A.data)),pixelRatio:h,stretchX:v,stretchY:x,content:S,sdf:g,version:0,userImage:A}),A.onAdd&&A.onAdd(this,f)}}updateImage(f,o){this._lazyInitEmptyStyle();let h=this.style.getImage(f);if(!h)return void this.fire(new i.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?i.e.getImageData(o):o,{width:v,height:x,data:S}=g;if(v===void 0||x===void 0)return void this.fire(new i.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||x!==h.data.height)return void this.fire(new i.d(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));let k=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);h.data.replace(S,k),this.style.updateImage(f,h)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new i.d(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,o){i.h(this._requestManager.transformRequest(f,i.R.Image),(h,g)=>{o(h,g instanceof HTMLImageElement?i.e.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(f,o){this._lazyInitEmptyStyle(),this.style.addModel(f,o)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new i.d(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,o){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)):this}getSlot(f){let o=this.getLayer(f);return o&&o.slot||null}setSlot(f,o){return this.style.setSlot(f,o),this.style.mergeLayers(),this._update(!0)}addImport(f,o){return this.style.addImport(f,o),this}updateImport(f,o){return typeof o!="string"&&o.id!==f?(this.removeImport(f),this.addImport(o)):(this.style.updateImport(f,o),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,o){return this.style.moveImport(f,o),this._update(!0)}moveLayer(f,o){return this._isValidId(f)?(this.style.moveLayer(f,o),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){return this._isValidId(f)?this.style.getOwnLayer(f):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,o,h){return this._isValidId(f)?(this.style.setLayerZoomRange(f,o,h),this._update(!0)):this}setFilter(f,o,h={}){return this._isValidId(f)?(this.style.setFilter(f,o,h),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,o,h,g={}){return this._isValidId(f)?(this.style.setPaintProperty(f,o,h,g),this._update(!0)):this}getPaintProperty(f,o){return this._isValidId(f)?this.style.getPaintProperty(f,o):null}setLayoutProperty(f,o,h,g={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,o,h,g),this._update(!0)):this}getLayoutProperty(f,o){return this._isValidId(f)?this.style.getLayoutProperty(f,o):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,o){return this.style.setSchema(f,o),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,o){return this.style.setConfig(f,o),this._update(!0)}getConfigProperty(f,o){return this.style.getConfigProperty(f,o)}setConfigProperty(f,o,h){return this.style.setConfigProperty(f,o,h),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){let o=f[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aI.convert(f),this.transform):0}setFeatureState(f,o){return this._isValidId(f.source)?(this.style.setFeatureState(f,o),this._update()):this}removeFeatureState(f,o){return this._isValidId(f.source)?(this.style.removeFeatureState(f,o),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300,h,g,v,x=this._container;for(;x&&(!g||!v);){let S=window.getComputedStyle(x).transform;S&&S!=="none"&&(h=S.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),x=x.parentElement}this._containerWidth=g?Math.abs(f/g):f,this._containerHeight=v?Math.abs(o/v):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=N("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let o=this._canvasContainer=N("div","mapboxgl-canvas-container",f);this._canvas=N("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=N("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=N("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,o){let h=i.e.devicePixelRatio||1;this._canvas.width=h*Math.ceil(f),this._canvas.height=h*Math.ceil(o),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let o=this._markers.indexOf(f);o!==-1&&this._markers.splice(o,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){let o=this._popups.indexOf(f);o!==-1&&this._popups.splice(o,1)}_setupPainter(){let f=i.W({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",f);o?(i.dh(o,!0),this.painter=new d_(o,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.di.testSupport(o)):this.fire(new i.d(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.f("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new i.f("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let o;this.fire(new i.f("renderstart")),++this._frameId;let h=this.painter.context.extTimerQuery,g=i.e.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=v.createQuery(),v.beginQuery(h.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let A=this.transform.zoom,L=this.transform.pitch,z=i.e.now(),U=new i.X(A,{now:z,fadeDuration:x,pitch:L,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(g);let k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(k&&(this._placementDirty=k.needsRerender,this._occlusionOpacityChanged=k.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,i.dc.mark(i.dd.load),this.fire(new i.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){let A=i.e.now()-g;v.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{let L=v.getQueryParameter(o,v.QUERY_RESULT)/1e6;v.deleteQuery(o),this.fire(new i.f("gpu-timing-frame",{cpuTime:A,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){let A=this.painter.collectGpuTimers();setTimeout(()=>{let L=this.painter.queryGpuTimers(A);this.fire(new i.f("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){let A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let L=this.painter.queryGpuTimeDeferredRender(A);this.fire(new i.f("gpu-timing-deferred-render",{gpuTime:L}))},50)}let D=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||S;if((this._sourcesDirty||this._styleDirty||S||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),D||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{let A=!this.isMoving()&&this.loaded();if(A&&(S=this._updateAverageElevation(g,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new i.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let L=this._calculateSpeedIndex();this.fire(new i.f("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!D&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,i.dc.mark(i.dd.fullLoad),this._performanceMetricsCollection&&i.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(let o of this._markers)f&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(let o of this._popups)!f||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(f,o=!1){let h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);let g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(o||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let v=this.transform.averageElevation,x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;let S=Math.abs(v-x);if(S>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,f,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(f)&&h(this._averageElevation.getValue(f))}_authenticate(){i.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===i.dl||f.status===401)){let o=this.painter.context.gl;i.dh(o,!1),this._logoControl instanceof D_&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&i.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());let h=this.painter.context.gl,g=h.createFramebuffer();function v(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);let S=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,S),S}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(f),o.canvasCopies.map(v),o.timeStamps)}_canvasPixelComparison(f,o,h){let g=h[1]-h[0],v=f.length/4;for(let x=0;x<o.length;x++){let S=o[x],k=0;for(let D=0;D<S.length;D+=4)S[D]===f[D]&&S[D+1]===f[D+1]&&S[D+2]===f[D+2]&&S[D+3]===f[D+3]&&(k+=1);g+=(h[x+2]-h[x+1])*(1-k/v)}return g}remove(){this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.dp(this.painter.context.gl),i.dq.remove(),i.dr.remove(),this._removed=!0,this.fire(new i.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=i.e.frame(o=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(o)}))}_preloadTiles(f){let o=this.style?this.style.getSourceCaches():[];return i.ds(o,(h,g)=>h._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,o){i.du(f,o)}_occlusionCriteriaSatisfied(){let f=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&f&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return i.dt}},NavigationControl:class{constructor(f){this.options=i.W({},Sl,f),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(i.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),N("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),N("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:o}):h.resetNorth({},{originalEvent:o}))}),this._compassIcon=N("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let o=f.getZoom(),h=o===f.getMaxZoom(),g=o===f.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new z_(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,o){let h=N("button",f,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(f,o){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${o}`);f.setAttribute("aria-label",h),f.firstElementChild&&f.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends i.E{constructor(f){super();let o=navigator.geolocation;this.options=i.W({geolocation:o},Ml,f),i.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Jp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){let o=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,f(h)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>o(h.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(f){let o=this._map.getMaxBounds(),h=f.coords;return!!o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new i.f("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.f("geolocate",f)),this._finish()}}_updateCamera(f){let o=new i.aI(f.coords.longitude,f.coords.latitude),h=f.coords.accuracy,g=this._map.getBearing(),v=i.W({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),v,{geolocateSource:!0})}_updateMarker(f){if(f){let o=new i.aI(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,o=i.ax(1,f._center.lat)*f.worldSize,h=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.f("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=N("button","mapboxgl-ctrl-geolocate",this._container),N("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N("div","mapboxgl-user-location"),this._dotElement.appendChild(N("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(N("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new vh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=N("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.f("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:E_,ScaleControl:class{constructor(f){this.options=i.W({},B_,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,o=this._map,h=o._containerHeight/2,g=o._containerWidth/2-f/2,v=o.unproject([g,h]),x=o.unproject([g+f,h]),S=v.distanceTo(x);if(this.options.unit==="imperial"){let k=3.2808*S;k>5280?this._setScale(f,k/5280,"mile"):this._setScale(f,k,"foot")}else this.options.unit==="nautical"?this._setScale(f,S/1852,"nautical-mile"):S>=1e3?this._setScale(f,S/1e3,"kilometer"):this._setScale(f,S,"meter")}_setScale(f,o,h){this._map._requestDomTask(()=>{let g=function(x){let S=Math.pow(10,`${Math.floor(x)}`.length-1),k=x/S;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(D){let A=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*A)/A}(k),S*k}(o),v=g/o;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${qu[h]}`,this._container.style.width=f*v+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=N("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:i.w("Full screen control 'container' must be a DOM element.")),i.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=N("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=N("button","mapboxgl-ctrl-fullscreen",this._controlContainer);N("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(f){super(),this.options=i.W(Object.create(mf),f),i.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new i.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new i.f("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=i.aI.convert(f),this._pos=null,this._trackPointer=!1,this._update();let o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let o=document.createDocumentFragment(),h=document.createElement("body"),g;for(h.innerHTML=f;g=h.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=N("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(f),this.options.closeButton){let h=this._closeButton=N("button","mapboxgl-popup-close-button",o);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let o;return this._classList.delete(f)?o=!1:(this._classList.add(f),o=!0),this._updateClassList(),o}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let o=this._map,h=this._container,g=this._pos;if(!o||!h||!g)return"bottom";let v=h.offsetWidth,x=h.offsetHeight,S=g.x<v/2,k=g.x>o.transform.width-v/2;if(g.y+f<x)return S?"top-left":k?"top-right":"top";if(g.y>o.transform.height-x){if(S)return"bottom-left";if(k)return"bottom-right"}return S?"left":k?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),f.className=o.join(" ")}_update(f){let o=this._map,h=this._content;if(!o||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=N("div","mapboxgl-popup",o.getContainer()),this._tip=N("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=P_(this._lngLat,this._pos,o.transform)),!this._trackPointer||f){let v=this._pos=this._trackPointer&&f?f:o.project(this._lngLat),x=Cl(this.options.offset),S=this._anchor=this._getAnchor(x.y),k=Cl(this.options.offset,S),D=v.add(k).round();o._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${uf[S]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&o._showingGlobe()){let v=i.d9(o.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(O_);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:vh,Style:ha,LngLat:i.aI,LngLatBounds:i.ai,Point:i.P,MercatorCoordinate:i.Y,FreeCameraOptions:bp,Evented:i.E,config:i.d8,prewarm:i.dx,clearPrewarmedResources:i.dy,get accessToken(){return i.d8.ACCESS_TOKEN},set accessToken(f){i.d8.ACCESS_TOKEN=f},get baseApiUrl(){return i.d8.API_URL},set baseApiUrl(f){i.d8.API_URL=f},get workerCount(){return i.dz.workerCount},set workerCount(f){i.dz.workerCount=f},get maxParallelImageRequests(){return i.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){i.d8.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){i.dA(f)},get workerUrl(){return i.dB.workerUrl},set workerUrl(f){i.dB.workerUrl=f},get workerClass(){return i.dB.workerClass},set workerClass(f){i.dB.workerClass=f},get workerParams(){return i.dB.workerParams},set workerParams(f){i.dB.workerParams=f},get dracoUrl(){return i.dC()},set dracoUrl(f){i.dD(f)},get meshoptUrl(){return i.dE()},set meshoptUrl(f){i.dF(f)},setNow:i.e.setNow,restoreNow:i.e.restoreNow}});var l=u;return l})});var _3=(()=>{let s=class s extends lb{constructor(r,l,i){super(r,l,i,wn(X0,{optional:!0}))}ngOnDestroy(){this.flush()}};s.\u0275fac=function(l){return new(l||s)(st(un),st(rg),st(sb))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})();function b3(){return new Lk}function y3(d,s,u){return new zk(d,s,u)}var Hk=[{provide:sb,useFactory:b3},{provide:lb,useClass:_3},{provide:Q0,useFactory:y3,deps:[rb,lb,Fi]}],Uk=[{provide:rg,useFactory:()=>new Fk},{provide:to,useValue:"BrowserAnimations"},...Hk],v3=[{provide:rg,useClass:Rk},{provide:to,useValue:"NoopAnimations"},...Hk],Wk=(()=>{let s=class s{static withConfig(r){return{ngModule:s,providers:r.disableAnimations?v3:Uk}}};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:Uk,imports:[ob]});let d=s;return d})();var i1;try{i1=typeof Intl<"u"&&Intl.v8BreakIterator}catch{i1=!1}var Wn=(()=>{let s=class s{constructor(r){this._platformId=r,this.isBrowser=this._platformId?wk(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||i1)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};s.\u0275fac=function(l){return new(l||s)(st(ld))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var og;function x3(){if(og==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>og=!0}))}finally{og=og||!1}return og}function $s(d){return x3()?d:!!d.capture}var Vh;function Gk(){if(Vh==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Vh=!1,Vh;if("scrollBehavior"in document.documentElement.style)Vh=!0;else{let d=Element.prototype.scrollTo;d?Vh=!/\{\s*\[native code\]\s*\}/.test(d.toString()):Vh=!1}}return Vh}var t1;function w3(){if(t1==null){let d=typeof document<"u"?document.head:null;t1=!!(d&&(d.createShadowRoot||d.attachShadow))}return t1}function qk(d){if(w3()){let s=d.getRootNode?d.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&s instanceof ShadowRoot)return s}return null}function jh(){let d=typeof document<"u"&&document?document.activeElement:null;for(;d&&d.shadowRoot;){let s=d.shadowRoot.activeElement;if(s===d)break;d=s}return d}function ys(d){return d.composedPath?d.composedPath()[0]:d.target}function ag(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Tm(d,...s){return s.length?s.some(u=>d[u]):d.altKey||d.shiftKey||d.ctrlKey||d.metaKey}function sg(d,s=0){return C3(d)?Number(d):s}function C3(d){return!isNaN(parseFloat(d))&&!isNaN(Number(d))}function Em(d){return Array.isArray(d)?d:[d]}function Cr(d){return d==null?"":typeof d=="string"?d:`${d}px`}function Nl(d){return d instanceof sn?d.nativeElement:d}var S3=(()=>{let s=class s{create(r){return typeof MutationObserver>"u"?null:new MutationObserver(r)}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var pb=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[S3]});let d=s;return d})();var $k=new Set,Uh,M3=(()=>{let s=class s{constructor(r,l){this._platform=r,this._nonce=l,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):I3}matchMedia(r){return(this._platform.WEBKIT||this._platform.BLINK)&&k3(r,this._nonce),this._matchMedia(r)}};s.\u0275fac=function(l){return new(l||s)(st(Wn),st(ck,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function k3(d,s){if(!$k.has(d))try{Uh||(Uh=document.createElement("style"),s&&Uh.setAttribute("nonce",s),Uh.setAttribute("type","text/css"),document.head.appendChild(Uh)),Uh.sheet&&(Uh.sheet.insertRule(`@media ${d} {body{ }}`,0),$k.add(d))}catch(u){console.error(u)}}function I3(d){return{matches:d==="all"||d==="",media:d,addListener:()=>{},removeListener:()=>{}}}var Zk=(()=>{let s=class s{constructor(r,l){this._mediaMatcher=r,this._zone=l,this._queries=new Map,this._destroySubject=new En}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(r){return Yk(Em(r)).some(i=>this._registerQuery(i).mql.matches)}observe(r){let i=Yk(Em(r)).map(C=>this._registerQuery(C).observable),_=tk(i);return _=W0(_.pipe(La(1)),_.pipe($0(1),Nx(0))),_.pipe(xm(C=>{let I={matches:!1,breakpoints:{}};return C.forEach(({matches:O,query:N})=>{I.matches=I.matches||O,I.breakpoints[N]=O}),I}))}_registerQuery(r){if(this._queries.has(r))return this._queries.get(r);let l=this._mediaMatcher.matchMedia(r),_={observable:new ho(C=>{let I=O=>this._zone.run(()=>C.next(O));return l.addListener(I),()=>{l.removeListener(I)}}).pipe(us(l),xm(({matches:C})=>({query:r,matches:C})),Bh(this._destroySubject)),mql:l};return this._queries.set(r,_),_}};s.\u0275fac=function(l){return new(l||s)(st(M3),st(Fi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function Yk(d){return d.map(s=>s.split(",")).reduce((s,u)=>s.concat(u)).map(s=>s.trim())}var lg=(()=>{let s=class s{constructor(r){this._platform=r}isDisabled(r){return r.hasAttribute("disabled")}isVisible(r){return E3(r)&&getComputedStyle(r).visibility==="visible"}isTabbable(r){if(!this._platform.isBrowser)return!1;let l=T3(z3(r));if(l&&(Xk(l)===-1||!this.isVisible(l)))return!1;let i=r.nodeName.toLowerCase(),_=Xk(r);return r.hasAttribute("contenteditable")?_!==-1:i==="iframe"||i==="object"||this._platform.WEBKIT&&this._platform.IOS&&!L3(r)?!1:i==="audio"?r.hasAttribute("controls")?_!==-1:!1:i==="video"?_===-1?!1:_!==null?!0:this._platform.FIREFOX||r.hasAttribute("controls"):r.tabIndex>=0}isFocusable(r,l){return F3(r)&&!this.isDisabled(r)&&(l?.ignoreVisibility||this.isVisible(r))}};s.\u0275fac=function(l){return new(l||s)(st(Wn))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function T3(d){try{return d.frameElement}catch{return null}}function E3(d){return!!(d.offsetWidth||d.offsetHeight||typeof d.getClientRects=="function"&&d.getClientRects().length)}function D3(d){let s=d.nodeName.toLowerCase();return s==="input"||s==="select"||s==="button"||s==="textarea"}function A3(d){return O3(d)&&d.type=="hidden"}function P3(d){return R3(d)&&d.hasAttribute("href")}function O3(d){return d.nodeName.toLowerCase()=="input"}function R3(d){return d.nodeName.toLowerCase()=="a"}function Jk(d){if(!d.hasAttribute("tabindex")||d.tabIndex===void 0)return!1;let s=d.getAttribute("tabindex");return!!(s&&!isNaN(parseInt(s,10)))}function Xk(d){if(!Jk(d))return null;let s=parseInt(d.getAttribute("tabindex")||"",10);return isNaN(s)?-1:s}function L3(d){let s=d.nodeName.toLowerCase(),u=s==="input"&&d.type;return u==="text"||u==="password"||s==="select"||s==="textarea"}function F3(d){return A3(d)?!1:D3(d)||P3(d)||d.hasAttribute("contenteditable")||Jk(d)}function z3(d){return d.ownerDocument&&d.ownerDocument.defaultView||window}var r1=class{get enabled(){return this._enabled}set enabled(s){this._enabled=s,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(s,this._startAnchor),this._toggleAnchorTabIndex(s,this._endAnchor))}constructor(s,u,r,l,i=!1){this._element=s,this._checker=u,this._ngZone=r,this._document=l,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,i||this.attachAnchors()}destroy(){let s=this._startAnchor,u=this._endAnchor;s&&(s.removeEventListener("focus",this.startAnchorListener),s.remove()),u&&(u.removeEventListener("focus",this.endAnchorListener),u.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(s){return new Promise(u=>{this._executeOnStable(()=>u(this.focusInitialElement(s)))})}focusFirstTabbableElementWhenReady(s){return new Promise(u=>{this._executeOnStable(()=>u(this.focusFirstTabbableElement(s)))})}focusLastTabbableElementWhenReady(s){return new Promise(u=>{this._executeOnStable(()=>u(this.focusLastTabbableElement(s)))})}_getRegionBoundary(s){let u=this._element.querySelectorAll(`[cdk-focus-region-${s}], [cdkFocusRegion${s}], [cdk-focus-${s}]`);return s=="start"?u.length?u[0]:this._getFirstTabbableElement(this._element):u.length?u[u.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(s){let u=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(u){if(!this._checker.isFocusable(u)){let r=this._getFirstTabbableElement(u);return r?.focus(s),!!r}return u.focus(s),!0}return this.focusFirstTabbableElement(s)}focusFirstTabbableElement(s){let u=this._getRegionBoundary("start");return u&&u.focus(s),!!u}focusLastTabbableElement(s){let u=this._getRegionBoundary("end");return u&&u.focus(s),!!u}hasAttached(){return this._hasAttached}_getFirstTabbableElement(s){if(this._checker.isFocusable(s)&&this._checker.isTabbable(s))return s;let u=s.children;for(let r=0;r<u.length;r++){let l=u[r].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(u[r]):null;if(l)return l}return null}_getLastTabbableElement(s){if(this._checker.isFocusable(s)&&this._checker.isTabbable(s))return s;let u=s.children;for(let r=u.length-1;r>=0;r--){let l=u[r].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(u[r]):null;if(l)return l}return null}_createAnchor(){let s=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,s),s.classList.add("cdk-visually-hidden"),s.classList.add("cdk-focus-trap-anchor"),s.setAttribute("aria-hidden","true"),s}_toggleAnchorTabIndex(s,u){s?u.setAttribute("tabindex","0"):u.removeAttribute("tabindex")}toggleAnchors(s){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(s,this._startAnchor),this._toggleAnchorTabIndex(s,this._endAnchor))}_executeOnStable(s){this._ngZone.isStable?s():this._ngZone.onStable.pipe(La(1)).subscribe(s)}},cg=(()=>{let s=class s{constructor(r,l,i){this._checker=r,this._ngZone=l,this._document=i}create(r,l=!1){return new r1(r,this._checker,this._ngZone,this._document,l)}};s.\u0275fac=function(l){return new(l||s)(st(lg),st(Fi),st(un))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),eI=(()=>{let s=class s{get enabled(){return this.focusTrap?.enabled||!1}set enabled(r){this.focusTrap&&(this.focusTrap.enabled=r)}constructor(r,l,i){this._elementRef=r,this._focusTrapFactory=l,this._previouslyFocusedElement=null,wn(Wn).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(r){let l=r.autoCapture;l&&!l.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=jh(),this.focusTrap?.focusInitialElementWhenReady()}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(cg),_e(un))},s.\u0275dir=Kn({type:s,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[Xi.HasDecoratorInputTransform,"cdkTrapFocus","enabled",io],autoCapture:[Xi.HasDecoratorInputTransform,"cdkTrapFocusAutoCapture","autoCapture",io]},exportAs:["cdkTrapFocus"],standalone:!0,features:[wo,xo]});let d=s;return d})();function o1(d){return d.buttons===0||d.detail===0}function a1(d){let s=d.touches&&d.touches[0]||d.changedTouches&&d.changedTouches[0];return!!s&&s.identifier===-1&&(s.radiusX==null||s.radiusX===1)&&(s.radiusY==null||s.radiusY===1)}var B3=new pn("cdk-input-modality-detector-options"),N3={ignoreKeys:[18,17,224,91,16]},tI=650,Dm=$s({passive:!0,capture:!0}),V3=(()=>{let s=class s{get mostRecentModality(){return this._modality.value}constructor(r,l,i,_){this._platform=r,this._mostRecentTarget=null,this._modality=new Jf(null),this._lastTouchMs=0,this._onKeydown=C=>{this._options?.ignoreKeys?.some(I=>I===C.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=ys(C))},this._onMousedown=C=>{Date.now()-this._lastTouchMs<tI||(this._modality.next(o1(C)?"keyboard":"mouse"),this._mostRecentTarget=ys(C))},this._onTouchstart=C=>{if(a1(C)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=ys(C)},this._options=Zi(Zi({},N3),_),this.modalityDetected=this._modality.pipe($0(1)),this.modalityChanged=this.modalityDetected.pipe(Vx()),r.isBrowser&&l.runOutsideAngular(()=>{i.addEventListener("keydown",this._onKeydown,Dm),i.addEventListener("mousedown",this._onMousedown,Dm),i.addEventListener("touchstart",this._onTouchstart,Dm)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Dm),document.removeEventListener("mousedown",this._onMousedown,Dm),document.removeEventListener("touchstart",this._onTouchstart,Dm))}};s.\u0275fac=function(l){return new(l||s)(st(Wn),st(Fi),st(un),st(B3,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var gb=function(d){return d[d.IMMEDIATE=0]="IMMEDIATE",d[d.EVENTUAL=1]="EVENTUAL",d}(gb||{}),j3=new pn("cdk-focus-monitor-default-options"),fb=$s({passive:!0,capture:!0}),Vl=(()=>{let s=class s{constructor(r,l,i,_,C){this._ngZone=r,this._platform=l,this._inputModalityDetector=i,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new En,this._rootNodeFocusAndBlurListener=I=>{let O=ys(I);for(let N=O;N;N=N.parentElement)I.type==="focus"?this._onFocus(I,N):this._onBlur(I,N)},this._document=_,this._detectionMode=C?.detectionMode||gb.IMMEDIATE}monitor(r,l=!1){let i=Nl(r);if(!this._platform.isBrowser||i.nodeType!==1)return br();let _=qk(i)||this._getDocument(),C=this._elementInfo.get(i);if(C)return l&&(C.checkChildren=!0),C.subject;let I={checkChildren:l,subject:new En,rootNode:_};return this._elementInfo.set(i,I),this._registerGlobalListeners(I),I.subject}stopMonitoring(r){let l=Nl(r),i=this._elementInfo.get(l);i&&(i.subject.complete(),this._setClasses(l),this._elementInfo.delete(l),this._removeGlobalListeners(i))}focusVia(r,l,i){let _=Nl(r),C=this._getDocument().activeElement;_===C?this._getClosestElementsInfo(_).forEach(([I,O])=>this._originChanged(I,l,O)):(this._setOrigin(l),typeof _.focus=="function"&&_.focus(i))}ngOnDestroy(){this._elementInfo.forEach((r,l)=>this.stopMonitoring(l))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(r){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(r)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:r&&this._isLastInteractionFromInputLabel(r)?"mouse":"program"}_shouldBeAttributedToTouch(r){return this._detectionMode===gb.EVENTUAL||!!r?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(r,l){r.classList.toggle("cdk-focused",!!l),r.classList.toggle("cdk-touch-focused",l==="touch"),r.classList.toggle("cdk-keyboard-focused",l==="keyboard"),r.classList.toggle("cdk-mouse-focused",l==="mouse"),r.classList.toggle("cdk-program-focused",l==="program")}_setOrigin(r,l=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=r,this._originFromTouchInteraction=r==="touch"&&l,this._detectionMode===gb.IMMEDIATE){clearTimeout(this._originTimeoutId);let i=this._originFromTouchInteraction?tI:1;this._originTimeoutId=setTimeout(()=>this._origin=null,i)}})}_onFocus(r,l){let i=this._elementInfo.get(l),_=ys(r);!i||!i.checkChildren&&l!==_||this._originChanged(l,this._getFocusOrigin(_),i)}_onBlur(r,l){let i=this._elementInfo.get(l);!i||i.checkChildren&&r.relatedTarget instanceof Node&&l.contains(r.relatedTarget)||(this._setClasses(l),this._emitOrigin(i,null))}_emitOrigin(r,l){r.subject.observers.length&&this._ngZone.run(()=>r.subject.next(l))}_registerGlobalListeners(r){if(!this._platform.isBrowser)return;let l=r.rootNode,i=this._rootNodeFocusListenerCount.get(l)||0;i||this._ngZone.runOutsideAngular(()=>{l.addEventListener("focus",this._rootNodeFocusAndBlurListener,fb),l.addEventListener("blur",this._rootNodeFocusAndBlurListener,fb)}),this._rootNodeFocusListenerCount.set(l,i+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Bh(this._stopInputModalityDetector)).subscribe(_=>{this._setOrigin(_,!0)}))}_removeGlobalListeners(r){let l=r.rootNode;if(this._rootNodeFocusListenerCount.has(l)){let i=this._rootNodeFocusListenerCount.get(l);i>1?this._rootNodeFocusListenerCount.set(l,i-1):(l.removeEventListener("focus",this._rootNodeFocusAndBlurListener,fb),l.removeEventListener("blur",this._rootNodeFocusAndBlurListener,fb),this._rootNodeFocusListenerCount.delete(l))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(r,l,i){this._setClasses(r,l),this._emitOrigin(i,l),this._lastFocusOrigin=l}_getClosestElementsInfo(r){let l=[];return this._elementInfo.forEach((i,_)=>{(_===r||i.checkChildren&&_.contains(r))&&l.push([_,i])}),l}_isLastInteractionFromInputLabel(r){let{_mostRecentTarget:l,mostRecentModality:i}=this._inputModalityDetector;if(i!=="mouse"||!l||l===r||r.nodeName!=="INPUT"&&r.nodeName!=="TEXTAREA"||r.disabled)return!1;let _=r.labels;if(_){for(let C=0;C<_.length;C++)if(_[C].contains(l))return!0}return!1}};s.\u0275fac=function(l){return new(l||s)(st(Fi),st(Wn),st(V3),st(un,8),st(j3,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),iI=(()=>{let s=class s{constructor(r,l){this._elementRef=r,this._focusMonitor=l,this._focusOrigin=null,this.cdkFocusChange=new an}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){let r=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(r,r.nodeType===1&&r.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(l=>{this._focusOrigin=l,this.cdkFocusChange.emit(l)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(Vl))},s.\u0275dir=Kn({type:s,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"],standalone:!0});let d=s;return d})(),Hh=function(d){return d[d.NONE=0]="NONE",d[d.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",d[d.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",d}(Hh||{}),Qk="cdk-high-contrast-black-on-white",Kk="cdk-high-contrast-white-on-black",n1="cdk-high-contrast-active",s1=(()=>{let s=class s{constructor(r,l){this._platform=r,this._document=l,this._breakpointSubscription=wn(Zk).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Hh.NONE;let r=this._document.createElement("div");r.style.backgroundColor="rgb(1,2,3)",r.style.position="absolute",this._document.body.appendChild(r);let l=this._document.defaultView||window,i=l&&l.getComputedStyle?l.getComputedStyle(r):null,_=(i&&i.backgroundColor||"").replace(/ /g,"");switch(r.remove(),_){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Hh.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Hh.BLACK_ON_WHITE}return Hh.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let r=this._document.body.classList;r.remove(n1,Qk,Kk),this._hasCheckedHighContrastMode=!0;let l=this.getHighContrastMode();l===Hh.BLACK_ON_WHITE?r.add(n1,Qk):l===Hh.WHITE_ON_BLACK&&r.add(n1,Kk)}}};s.\u0275fac=function(l){return new(l||s)(st(Wn),st(un))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),_b=(()=>{let s=class s{constructor(r){r._applyBodyHighContrastModeCssClasses()}};s.\u0275fac=function(l){return new(l||s)(st(s1))},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[pb]});let d=s;return d})();var U3=new pn("cdk-dir-doc",{providedIn:"root",factory:H3});function H3(){return wn(un)}var W3=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function G3(d){let s=d?.toLowerCase()||"";return s==="auto"&&typeof navigator<"u"&&navigator?.language?W3.test(navigator.language)?"rtl":"ltr":s==="rtl"?"rtl":"ltr"}var jl=(()=>{let s=class s{constructor(r){if(this.value="ltr",this.change=new an,r){let l=r.body?r.body.dir:null,i=r.documentElement?r.documentElement.dir:null;this.value=G3(l||i||"ltr")}}ngOnDestroy(){this.change.complete()}};s.\u0275fac=function(l){return new(l||s)(st(U3,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var pd=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({});let d=s;return d})();var q3=["mat-internal-form-field",""],$3=["*"];function Y3(){return!0}var Z3=new pn("mat-sanity-checks",{providedIn:"root",factory:Y3}),zn=(()=>{let s=class s{constructor(r,l,i){this._sanityChecks=l,this._document=i,this._hasDoneGlobalChecks=!1,r._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(r){return ag()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[r]}};s.\u0275fac=function(l){return new(l||s)(st(s1),st(Z3,8),st(un))},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[pd,pd]});let d=s;return d})();var rI=new pn("MAT_DATE_LOCALE",{providedIn:"root",factory:X3});function X3(){return wn(bk)}var Xo=class{constructor(){this._localeChanges=new En,this.localeChanges=this._localeChanges}getValidDateOrNull(s){return this.isDateInstance(s)&&this.isValid(s)?s:null}deserialize(s){return s==null||this.isDateInstance(s)&&this.isValid(s)?s:this.invalid()}setLocale(s){this.locale=s,this._localeChanges.next()}compareDate(s,u){return this.getYear(s)-this.getYear(u)||this.getMonth(s)-this.getMonth(u)||this.getDate(s)-this.getDate(u)}sameDate(s,u){if(s&&u){let r=this.isValid(s),l=this.isValid(u);return r&&l?!this.compareDate(s,u):r==l}return s==u}clampDate(s,u,r){return u&&this.compareDate(s,u)<0?u:r&&this.compareDate(s,r)>0?r:s}},Am=new pn("mat-date-formats"),Q3=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function l1(d,s){let u=Array(d);for(let r=0;r<d;r++)u[r]=s(r);return u}var K3=(()=>{let s=class s extends Xo{constructor(r){super(),this.useUtcForDisplay=!1,this._matDateLocale=wn(rI,{optional:!0}),r!==void 0&&(this._matDateLocale=r),super.setLocale(this._matDateLocale)}getYear(r){return r.getFullYear()}getMonth(r){return r.getMonth()}getDate(r){return r.getDate()}getDayOfWeek(r){return r.getDay()}getMonthNames(r){let l=new Intl.DateTimeFormat(this.locale,{month:r,timeZone:"utc"});return l1(12,i=>this._format(l,new Date(2017,i,1)))}getDateNames(){let r=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return l1(31,l=>this._format(r,new Date(2017,0,l+1)))}getDayOfWeekNames(r){let l=new Intl.DateTimeFormat(this.locale,{weekday:r,timeZone:"utc"});return l1(7,i=>this._format(l,new Date(2017,0,i+1)))}getYearName(r){let l=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(l,r)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(r){return this.getDate(this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+1,0))}clone(r){return new Date(r.getTime())}createDate(r,l,i){let _=this._createDateWithOverflow(r,l,i);return _.getMonth()!=l,_}today(){return new Date}parse(r,l){return typeof r=="number"?new Date(r):r?new Date(Date.parse(r)):null}format(r,l){if(!this.isValid(r))throw Error("NativeDateAdapter: Cannot format invalid date.");let i=new Intl.DateTimeFormat(this.locale,Ra(Zi({},l),{timeZone:"utc"}));return this._format(i,r)}addCalendarYears(r,l){return this.addCalendarMonths(r,l*12)}addCalendarMonths(r,l){let i=this._createDateWithOverflow(this.getYear(r),this.getMonth(r)+l,this.getDate(r));return this.getMonth(i)!=((this.getMonth(r)+l)%12+12)%12&&(i=this._createDateWithOverflow(this.getYear(i),this.getMonth(i),0)),i}addCalendarDays(r,l){return this._createDateWithOverflow(this.getYear(r),this.getMonth(r),this.getDate(r)+l)}toIso8601(r){return[r.getUTCFullYear(),this._2digit(r.getUTCMonth()+1),this._2digit(r.getUTCDate())].join("-")}deserialize(r){if(typeof r=="string"){if(!r)return null;if(Q3.test(r)){let l=new Date(r);if(this.isValid(l))return l}}return super.deserialize(r)}isDateInstance(r){return r instanceof Date}isValid(r){return!isNaN(r.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(r,l,i){let _=new Date;return _.setFullYear(r,l,i),_.setHours(0,0,0,0),_}_2digit(r){return("00"+r).slice(-2)}_format(r,l){let i=new Date;return i.setUTCFullYear(l.getFullYear(),l.getMonth(),l.getDate()),i.setUTCHours(l.getHours(),l.getMinutes(),l.getSeconds(),l.getMilliseconds()),r.format(i)}};s.\u0275fac=function(l){return new(l||s)(st(rI,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})(),J3={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};var mI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[eL()]});let d=s;return d})();function eL(d=J3){return[{provide:Xo,useClass:K3},{provide:Am,useValue:d}]}var Va=function(d){return d[d.FADING_IN=0]="FADING_IN",d[d.VISIBLE=1]="VISIBLE",d[d.FADING_OUT=2]="FADING_OUT",d[d.HIDDEN=3]="HIDDEN",d}(Va||{}),h1=class{constructor(s,u,r,l=!1){this._renderer=s,this.element=u,this.config=r,this._animationForciblyDisabledThroughCss=l,this.state=Va.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},oI=$s({passive:!0,capture:!0}),u1=class{constructor(){this._events=new Map,this._delegateEventHandler=s=>{let u=ys(s);u&&this._events.get(s.type)?.forEach((r,l)=>{(l===u||l.contains(u))&&r.forEach(i=>i.handleEvent(s))})}}addHandler(s,u,r,l){let i=this._events.get(u);if(i){let _=i.get(r);_?_.add(l):i.set(r,new Set([l]))}else this._events.set(u,new Map([[r,new Set([l])]])),s.runOutsideAngular(()=>{document.addEventListener(u,this._delegateEventHandler,oI)})}removeHandler(s,u,r){let l=this._events.get(s);if(!l)return;let i=l.get(u);i&&(i.delete(r),i.size===0&&l.delete(u),l.size===0&&(this._events.delete(s),document.removeEventListener(s,this._delegateEventHandler,oI)))}},aI={enterDuration:225,exitDuration:150},tL=800,sI=$s({passive:!0,capture:!0}),lI=["mousedown","touchstart"],cI=["mouseup","mouseleave","touchend","touchcancel"],dg=class dg{constructor(s,u,r,l){this._target=s,this._ngZone=u,this._platform=l,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,l.isBrowser&&(this._containerElement=Nl(r))}fadeInRipple(s,u,r={}){let l=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),i=Zi(Zi({},aI),r.animation);r.centered&&(s=l.left+l.width/2,u=l.top+l.height/2);let _=r.radius||iL(s,u,l),C=s-l.left,I=u-l.top,O=i.enterDuration,N=document.createElement("div");N.classList.add("mat-ripple-element"),N.style.left=`${C-_}px`,N.style.top=`${I-_}px`,N.style.height=`${_*2}px`,N.style.width=`${_*2}px`,r.color!=null&&(N.style.backgroundColor=r.color),N.style.transitionDuration=`${O}ms`,this._containerElement.appendChild(N);let q=window.getComputedStyle(N),ie=q.transitionProperty,de=q.transitionDuration,xe=ie==="none"||de==="0s"||de==="0s, 0s"||l.width===0&&l.height===0,ke=new h1(this,N,r,xe);N.style.transform="scale3d(1, 1, 1)",ke.state=Va.FADING_IN,r.persistent||(this._mostRecentTransientRipple=ke);let Ae=null;return!xe&&(O||i.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Xe=()=>this._finishRippleTransition(ke),qe=()=>this._destroyRipple(ke);N.addEventListener("transitionend",Xe),N.addEventListener("transitioncancel",qe),Ae={onTransitionEnd:Xe,onTransitionCancel:qe}}),this._activeRipples.set(ke,Ae),(xe||!O)&&this._finishRippleTransition(ke),ke}fadeOutRipple(s){if(s.state===Va.FADING_OUT||s.state===Va.HIDDEN)return;let u=s.element,r=Zi(Zi({},aI),s.config.animation);u.style.transitionDuration=`${r.exitDuration}ms`,u.style.opacity="0",s.state=Va.FADING_OUT,(s._animationForciblyDisabledThroughCss||!r.exitDuration)&&this._finishRippleTransition(s)}fadeOutAll(){this._getActiveRipples().forEach(s=>s.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(s=>{s.config.persistent||s.fadeOut()})}setupTriggerEvents(s){let u=Nl(s);!this._platform.isBrowser||!u||u===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=u,lI.forEach(r=>{dg._eventManager.addHandler(this._ngZone,r,u,this)}))}handleEvent(s){s.type==="mousedown"?this._onMousedown(s):s.type==="touchstart"?this._onTouchStart(s):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{cI.forEach(u=>{this._triggerElement.addEventListener(u,this,sI)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(s){s.state===Va.FADING_IN?this._startFadeOutTransition(s):s.state===Va.FADING_OUT&&this._destroyRipple(s)}_startFadeOutTransition(s){let u=s===this._mostRecentTransientRipple,{persistent:r}=s.config;s.state=Va.VISIBLE,!r&&(!u||!this._isPointerDown)&&s.fadeOut()}_destroyRipple(s){let u=this._activeRipples.get(s)??null;this._activeRipples.delete(s),this._activeRipples.size||(this._containerRect=null),s===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),s.state=Va.HIDDEN,u!==null&&(s.element.removeEventListener("transitionend",u.onTransitionEnd),s.element.removeEventListener("transitioncancel",u.onTransitionCancel)),s.element.remove()}_onMousedown(s){let u=o1(s),r=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+tL;!this._target.rippleDisabled&&!u&&!r&&(this._isPointerDown=!0,this.fadeInRipple(s.clientX,s.clientY,this._target.rippleConfig))}_onTouchStart(s){if(!this._target.rippleDisabled&&!a1(s)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let u=s.changedTouches;if(u)for(let r=0;r<u.length;r++)this.fadeInRipple(u[r].clientX,u[r].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(s=>{let u=s.state===Va.VISIBLE||s.config.terminateOnPointerUp&&s.state===Va.FADING_IN;!s.config.persistent&&u&&s.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let s=this._triggerElement;s&&(lI.forEach(u=>dg._eventManager.removeHandler(u,s,this)),this._pointerUpEventsRegistered&&(cI.forEach(u=>s.removeEventListener(u,this,sI)),this._pointerUpEventsRegistered=!1))}};dg._eventManager=new u1;var m1=dg;function iL(d,s,u){let r=Math.max(Math.abs(d-u.left),Math.abs(d-u.right)),l=Math.max(Math.abs(s-u.top),Math.abs(s-u.bottom));return Math.sqrt(r*r+l*l)}var p1=new pn("mat-ripple-global-options"),vb=(()=>{let s=class s{get disabled(){return this._disabled}set disabled(r){r&&this.fadeOutAllNonPersistent(),this._disabled=r,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(r){this._trigger=r,this._setupTriggerEventsIfEnabled()}constructor(r,l,i,_,C){this._elementRef=r,this._animationMode=C,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=_||{},this._rippleRenderer=new m1(this,l,r,i)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Zi(Zi(Zi({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(r,l=0,i){return typeof r=="number"?this._rippleRenderer.fadeInRipple(r,l,Zi(Zi({},this.rippleConfig),i)):this._rippleRenderer.fadeInRipple(0,0,Zi(Zi({},this.rippleConfig),r))}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(Fi),_e(Wn),_e(p1,8),_e(to,8))},s.\u0275dir=Kn({type:s,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(l,i){l&2&&Si("mat-ripple-unbounded",i.unbounded)},inputs:{color:[Xi.None,"matRippleColor","color"],unbounded:[Xi.None,"matRippleUnbounded","unbounded"],centered:[Xi.None,"matRippleCentered","centered"],radius:[Xi.None,"matRippleRadius","radius"],animation:[Xi.None,"matRippleAnimation","animation"],disabled:[Xi.None,"matRippleDisabled","disabled"],trigger:[Xi.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let d=s;return d})(),pI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[zn,zn]});let d=s;return d})();var dI={capture:!0},hI=["focus","click","mouseenter","touchstart"],c1="mat-ripple-loader-uninitialized",d1="mat-ripple-loader-class-name",uI="mat-ripple-loader-centered",yb="mat-ripple-loader-disabled",fI=(()=>{let s=class s{constructor(){this._document=wn(un,{optional:!0}),this._animationMode=wn(to,{optional:!0}),this._globalRippleOptions=wn(p1,{optional:!0}),this._platform=wn(Wn),this._ngZone=wn(Fi),this._hosts=new Map,this._onInteraction=r=>{if(!(r.target instanceof HTMLElement))return;let i=r.target.closest(`[${c1}]`);i&&this._createRipple(i)},this._ngZone.runOutsideAngular(()=>{for(let r of hI)this._document?.addEventListener(r,this._onInteraction,dI)})}ngOnDestroy(){let r=this._hosts.keys();for(let l of r)this.destroyRipple(l);for(let l of hI)this._document?.removeEventListener(l,this._onInteraction,dI)}configureRipple(r,l){r.setAttribute(c1,""),(l.className||!r.hasAttribute(d1))&&r.setAttribute(d1,l.className||""),l.centered&&r.setAttribute(uI,""),l.disabled&&r.setAttribute(yb,"")}getRipple(r){return this._hosts.get(r)||this._createRipple(r)}setDisabled(r,l){let i=this._hosts.get(r);if(i){i.disabled=l;return}l?r.setAttribute(yb,""):r.removeAttribute(yb)}_createRipple(r){if(!this._document)return;let l=this._hosts.get(r);if(l)return l;r.querySelector(".mat-ripple")?.remove();let i=this._document.createElement("span");i.classList.add("mat-ripple",r.getAttribute(d1)),r.append(i);let _=new vb(new sn(i),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return _._isInitialized=!0,_.trigger=r,_.centered=r.hasAttribute(uI),_.disabled=r.hasAttribute(yb),this.attachRipple(r,_),_}attachRipple(r,l){r.removeAttribute(c1),this._hosts.set(r,l)}destroyRipple(r){let l=this._hosts.get(r);l&&(l.ngOnDestroy(),this._hosts.delete(r))}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),gI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=ft({type:s,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(l,i){l&2&&Si("mdc-form-field--align-end",i.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[jn],attrs:q3,ngContentSelectors:$3,decls:1,vars:0,template:function(l,i){l&1&&($o(),Co(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0});let d=s;return d})();var _I=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[zn]});let d=s;return d})();var bI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({});let d=s;return d})();var f1=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[zn,qs,pb,zn]});let d=s;return d})();var yI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[zn,f1,f1,bI,zn]});let d=s;return d})();var vI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[zn,qs,zn]});let d=s;return d})();var xI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[qs,zn]});let d=s;return d})();var hg=class{attach(s){return this._attachedHost=s,s.attach(this)}detach(){let s=this._attachedHost;s!=null&&(this._attachedHost=null,s.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(s){this._attachedHost=s}},fd=class extends hg{constructor(s,u,r,l,i){super(),this.component=s,this.viewContainerRef=u,this.injector=r,this.componentFactoryResolver=l,this.projectableNodes=i}},Wh=class extends hg{constructor(s,u,r,l){super(),this.templateRef=s,this.viewContainerRef=u,this.context=r,this.injector=l}get origin(){return this.templateRef.elementRef}attach(s,u=this.context){return this.context=u,super.attach(s)}detach(){return this.context=void 0,super.detach()}},g1=class extends hg{constructor(s){super(),this.element=s instanceof sn?s.nativeElement:s}},Pm=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(s){if(s instanceof fd)return this._attachedPortal=s,this.attachComponentPortal(s);if(s instanceof Wh)return this._attachedPortal=s,this.attachTemplatePortal(s);if(this.attachDomPortal&&s instanceof g1)return this._attachedPortal=s,this.attachDomPortal(s)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(s){this._disposeFn=s}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var xb=class extends Pm{constructor(s,u,r,l,i){super(),this.outletElement=s,this._componentFactoryResolver=u,this._appRef=r,this._defaultInjector=l,this.attachDomPortal=_=>{this._document;let C=_.element;C.parentNode;let I=this._document.createComment("dom-portal");C.parentNode.insertBefore(I,C),this.outletElement.appendChild(C),this._attachedPortal=_,super.setDisposeFn(()=>{I.parentNode&&I.parentNode.replaceChild(C,I)})},this._document=i}attachComponentPortal(s){let r=(s.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(s.component),l;return s.viewContainerRef?(l=s.viewContainerRef.createComponent(r,s.viewContainerRef.length,s.injector||s.viewContainerRef.injector,s.projectableNodes||void 0),this.setDisposeFn(()=>l.destroy())):(l=r.create(s.injector||this._defaultInjector||Fa.NULL),this._appRef.attachView(l.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(l.hostView),l.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(l)),this._attachedPortal=s,l}attachTemplatePortal(s){let u=s.viewContainerRef,r=u.createEmbeddedView(s.templateRef,s.context,{injector:s.injector});return r.rootNodes.forEach(l=>this.outletElement.appendChild(l)),r.detectChanges(),this.setDisposeFn(()=>{let l=u.indexOf(r);l!==-1&&u.remove(l)}),this._attachedPortal=s,r}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(s){return s.hostView.rootNodes[0]}};var gd=(()=>{let s=class s extends Pm{constructor(r,l,i){super(),this._componentFactoryResolver=r,this._viewContainerRef=l,this._isInitialized=!1,this.attached=new an,this.attachDomPortal=_=>{this._document;let C=_.element;C.parentNode;let I=this._document.createComment("dom-portal");_.setAttachedHost(this),C.parentNode.insertBefore(I,C),this._getRootNode().appendChild(C),this._attachedPortal=_,super.setDisposeFn(()=>{I.parentNode&&I.parentNode.replaceChild(C,I)})},this._document=i}get portal(){return this._attachedPortal}set portal(r){this.hasAttached()&&!r&&!this._isInitialized||(this.hasAttached()&&super.detach(),r&&super.attach(r),this._attachedPortal=r||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(r){r.setAttachedHost(this);let l=r.viewContainerRef!=null?r.viewContainerRef:this._viewContainerRef,_=(r.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(r.component),C=l.createComponent(_,l.length,r.injector||l.injector,r.projectableNodes||void 0);return l!==this._viewContainerRef&&this._getRootNode().appendChild(C.hostView.rootNodes[0]),super.setDisposeFn(()=>C.destroy()),this._attachedPortal=r,this._attachedRef=C,this.attached.emit(C),C}attachTemplatePortal(r){r.setAttachedHost(this);let l=this._viewContainerRef.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=r,this._attachedRef=l,this.attached.emit(l),l}_getRootNode(){let r=this._viewContainerRef.element.nativeElement;return r.nodeType===r.ELEMENT_NODE?r:r.parentNode}};s.\u0275fac=function(l){return new(l||s)(_e(eg),_e(Mm),_e(un))},s.\u0275dir=Kn({type:s,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[Xi.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[Ro]});let d=s;return d})();var Ul=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({});let d=s;return d})();var oL=20,wI=(()=>{let s=class s{constructor(r,l,i){this._ngZone=r,this._platform=l,this._scrolled=new En,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=i}register(r){this.scrollContainers.has(r)||this.scrollContainers.set(r,r.elementScrolled().subscribe(()=>this._scrolled.next(r)))}deregister(r){let l=this.scrollContainers.get(r);l&&(l.unsubscribe(),this.scrollContainers.delete(r))}scrolled(r=oL){return this._platform.isBrowser?new ho(l=>{this._globalSubscription||this._addGlobalListener();let i=r>0?this._scrolled.pipe(Bx(r)).subscribe(l):this._scrolled.subscribe(l);return this._scrolledCount++,()=>{i.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):br()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((r,l)=>this.deregister(l)),this._scrolled.complete()}ancestorScrolled(r,l){let i=this.getAncestorScrollContainers(r);return this.scrolled(l).pipe(ga(_=>!_||i.indexOf(_)>-1))}getAncestorScrollContainers(r){let l=[];return this.scrollContainers.forEach((i,_)=>{this._scrollableContainsElement(_,r)&&l.push(_)}),l}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(r,l){let i=Nl(l),_=r.getElementRef().nativeElement;do if(i==_)return!0;while(i=i.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let r=this._getWindow();return nk(r.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};s.\u0275fac=function(l){return new(l||s)(st(Fi),st(Wn),st(un,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var aL=20,_1=(()=>{let s=class s{constructor(r,l,i){this._platform=r,this._change=new En,this._changeListener=_=>{this._change.next(_)},this._document=i,l.runOutsideAngular(()=>{if(r.isBrowser){let _=this._getWindow();_.addEventListener("resize",this._changeListener),_.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let r=this._getWindow();r.removeEventListener("resize",this._changeListener),r.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let r={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),r}getViewportRect(){let r=this.getViewportScrollPosition(),{width:l,height:i}=this.getViewportSize();return{top:r.top,left:r.left,bottom:r.top+i,right:r.left+l,height:i,width:l}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let r=this._document,l=this._getWindow(),i=r.documentElement,_=i.getBoundingClientRect(),C=-_.top||r.body.scrollTop||l.scrollY||i.scrollTop||0,I=-_.left||r.body.scrollLeft||l.scrollX||i.scrollLeft||0;return{top:C,left:I}}change(r=aL){return r>0?this._change.pipe(Bx(r)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let r=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:r.innerWidth,height:r.innerHeight}:{width:0,height:0}}};s.\u0275fac=function(l){return new(l||s)(st(Wn),st(Fi),st(un,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var wb=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({});let d=s;return d})(),b1=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[pd,wb,pd,wb]});let d=s;return d})();var CI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[zn,zn]});let d=s;return d})();var lL=["switch"],cL=["*"];function dL(d,s){d&1&&(V(0,"div",10),sd(),V(1,"svg",12),Me(2,"path",13),j(),V(3,"svg",14),Me(4,"path",15),j()())}var hL=new pn("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),uL={provide:Mk,useExisting:Y0(()=>Sb),multi:!0},Cb=class{constructor(s,u){this.source=s,this.checked=u}},mL=0,Sb=(()=>{let s=class s{_createChangeEvent(r){return new Cb(this,r)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(r){this._checked=r,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(r,l,i,_,C,I){this._elementRef=r,this._focusMonitor=l,this._changeDetectorRef=i,this.defaults=C,this._onChange=O=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new an,this.toggleChange=new an,this.tabIndex=parseInt(_)||0,this.color=C.color||"accent",this._noopAnimations=I==="NoopAnimations",this.id=this._uniqueId=`mat-mdc-slide-toggle-${++mL}`,this.hideIcon=C.hideIcon??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(r=>{r==="keyboard"||r==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):r||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(r){r.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(r){this.checked=!!r}registerOnChange(r){this._onChange=r}registerOnTouched(r){this._onTouched=r}validate(r){return this.required&&r.value!==!0?{required:!0}:null}registerOnValidatorChange(r){this._validatorOnChange=r}setDisabledState(r){this.disabled=r,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new Cb(this,this.checked)))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(Vl),_e(uo),Cm("tabindex"),_e(hL),_e(to,8))},s.\u0275cmp=ft({type:s,selectors:[["mat-slide-toggle"]],viewQuery:function(l,i){if(l&1&&bi(lL,5),l&2){let _;fi(_=gi())&&(i._switchElement=_.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(l,i){l&2&&(Bl("id",i.id),bn("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),ps(i.color?"mat-"+i.color:""),Si("mat-mdc-slide-toggle-focused",i._focused)("mat-mdc-slide-toggle-checked",i.checked)("_mat-animation-noopable",i._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[Xi.None,"aria-label","ariaLabel"],ariaLabelledby:[Xi.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Xi.None,"aria-describedby","ariaDescribedby"],required:[Xi.HasDecoratorInputTransform,"required","required",io],color:"color",disabled:[Xi.HasDecoratorInputTransform,"disabled","disabled",io],disableRipple:[Xi.HasDecoratorInputTransform,"disableRipple","disableRipple",io],tabIndex:[Xi.HasDecoratorInputTransform,"tabIndex","tabIndex",r=>r==null?0:Xx(r)],checked:[Xi.HasDecoratorInputTransform,"checked","checked",io],hideIcon:[Xi.HasDecoratorInputTransform,"hideIcon","hideIcon",io]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[_s([uL,{provide:kk,useExisting:s,multi:!0}]),wo,xo,jn],ngContentSelectors:cL,decls:13,vars:24,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(l,i){if(l&1){let _=Kt();$o(),V(0,"div",1)(1,"button",2,0),Oe("click",function(){return _t(_),bt(i._handleClick())}),Me(3,"div",3),V(4,"div",4)(5,"div",5)(6,"div",6),Me(7,"div",7),j(),V(8,"div",8),Me(9,"div",9),j(),Bt(10,dL,5,0,"div",10),j()()(),V(11,"label",11),Oe("click",function(I){return _t(_),bt(I.stopPropagation())}),Co(12),j()()}if(l&2){let _=fs(2);Fe("labelPosition",i.labelPosition),ue(),Si("mdc-switch--selected",i.checked)("mdc-switch--unselected",!i.checked)("mdc-switch--checked",i.checked)("mdc-switch--disabled",i.disabled),Fe("tabIndex",i.disabled?-1:i.tabIndex)("disabled",i.disabled),bn("id",i.buttonId)("name",i.name)("aria-label",i.ariaLabel)("aria-labelledby",i._getAriaLabelledBy())("aria-describedby",i.ariaDescribedby)("aria-required",i.required||null)("aria-checked",i.checked),ue(8),Fe("matRippleTrigger",_)("matRippleDisabled",i.disableRipple||i.disabled)("matRippleCentered",!0),ue(),Vn(10,i.hideIcon?-1:10),ue(),Fe("for",i.buttonId),bn("id",i._labelId)}},dependencies:[vb,gI],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}.mdc-switch{width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mdc-switch__handle{transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle:active .mdc-switch:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--selected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--unselected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch__track::after,.mdc-switch__track::before{border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color)}.mdc-switch--selected .mdc-switch__track::after,.mdc-switch--selected .mdc-switch__track::before{border-width:var(--mat-switch-selected-track-outline-width)}.mdc-switch--disabled .mdc-switch__track::after,.mdc-switch--disabled .mdc-switch__track::before{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}'],encapsulation:2,changeDetection:0});let d=s;return d})();var SI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[Sb,zn,zn]});let d=s;return d})();var MI=Gk(),y1=class{constructor(s,u){this._viewportRuler=s,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=u}attach(){}enable(){if(this._canBeEnabled()){let s=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=s.style.left||"",this._previousHTMLStyles.top=s.style.top||"",s.style.left=Cr(-this._previousScrollPosition.left),s.style.top=Cr(-this._previousScrollPosition.top),s.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let s=this._document.documentElement,u=this._document.body,r=s.style,l=u.style,i=r.scrollBehavior||"",_=l.scrollBehavior||"";this._isEnabled=!1,r.left=this._previousHTMLStyles.left,r.top=this._previousHTMLStyles.top,s.classList.remove("cdk-global-scrollblock"),MI&&(r.scrollBehavior=l.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),MI&&(r.scrollBehavior=i,l.scrollBehavior=_)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let u=this._document.body,r=this._viewportRuler.getViewportSize();return u.scrollHeight>r.height||u.scrollWidth>r.width}};var v1=class{constructor(s,u,r,l){this._scrollDispatcher=s,this._ngZone=u,this._viewportRuler=r,this._config=l,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(s){this._overlayRef,this._overlayRef=s}enable(){if(this._scrollSubscription)return;let s=this._scrollDispatcher.scrolled(0).pipe(ga(u=>!u||!this._overlayRef.overlayElement.contains(u.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=s.subscribe(()=>{let u=this._viewportRuler.getViewportScrollPosition().top;Math.abs(u-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=s.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},Mb=class{enable(){}disable(){}attach(){}};function x1(d,s){return s.some(u=>{let r=d.bottom<u.top,l=d.top>u.bottom,i=d.right<u.left,_=d.left>u.right;return r||l||i||_})}function kI(d,s){return s.some(u=>{let r=d.top<u.top,l=d.bottom>u.bottom,i=d.left<u.left,_=d.right>u.right;return r||l||i||_})}var w1=class{constructor(s,u,r,l){this._scrollDispatcher=s,this._viewportRuler=u,this._ngZone=r,this._config=l,this._scrollSubscription=null}attach(s){this._overlayRef,this._overlayRef=s}enable(){if(!this._scrollSubscription){let s=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(s).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let u=this._overlayRef.overlayElement.getBoundingClientRect(),{width:r,height:l}=this._viewportRuler.getViewportSize();x1(u,[{width:r,height:l,bottom:l,right:r,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},fL=(()=>{let s=class s{constructor(r,l,i,_){this._scrollDispatcher=r,this._viewportRuler=l,this._ngZone=i,this.noop=()=>new Mb,this.close=C=>new v1(this._scrollDispatcher,this._ngZone,this._viewportRuler,C),this.block=()=>new y1(this._viewportRuler,this._document),this.reposition=C=>new w1(this._scrollDispatcher,this._viewportRuler,this._ngZone,C),this._document=_}};s.\u0275fac=function(l){return new(l||s)(st(wI),st(_1),st(Fi),st(un))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Om=class{constructor(s){if(this.scrollStrategy=new Mb,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,s){let u=Object.keys(s);for(let r of u)s[r]!==void 0&&(this[r]=s[r])}}};var C1=class{constructor(s,u){this.connectionPair=s,this.scrollableViewProperties=u}};var AI=(()=>{let s=class s{constructor(r){this._attachedOverlays=[],this._document=r}ngOnDestroy(){this.detach()}add(r){this.remove(r),this._attachedOverlays.push(r)}remove(r){let l=this._attachedOverlays.indexOf(r);l>-1&&this._attachedOverlays.splice(l,1),this._attachedOverlays.length===0&&this.detach()}};s.\u0275fac=function(l){return new(l||s)(st(un))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),gL=(()=>{let s=class s extends AI{constructor(r,l){super(r),this._ngZone=l,this._keydownListener=i=>{let _=this._attachedOverlays;for(let C=_.length-1;C>-1;C--)if(_[C]._keydownEvents.observers.length>0){let I=_[C]._keydownEvents;this._ngZone?this._ngZone.run(()=>I.next(i)):I.next(i);break}}}add(r){super.add(r),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};s.\u0275fac=function(l){return new(l||s)(st(un),st(Fi,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),_L=(()=>{let s=class s extends AI{constructor(r,l,i){super(r),this._platform=l,this._ngZone=i,this._cursorStyleIsSet=!1,this._pointerDownListener=_=>{this._pointerDownEventTarget=ys(_)},this._clickListener=_=>{let C=ys(_),I=_.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:C;this._pointerDownEventTarget=null;let O=this._attachedOverlays.slice();for(let N=O.length-1;N>-1;N--){let q=O[N];if(q._outsidePointerEvents.observers.length<1||!q.hasAttached())continue;if(q.overlayElement.contains(C)||q.overlayElement.contains(I))break;let ie=q._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>ie.next(_)):ie.next(_)}}}add(r){if(super.add(r),!this._isAttached){let l=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(l)):this._addEventListeners(l),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=l.style.cursor,l.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let r=this._document.body;r.removeEventListener("pointerdown",this._pointerDownListener,!0),r.removeEventListener("click",this._clickListener,!0),r.removeEventListener("auxclick",this._clickListener,!0),r.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(r.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(r){r.addEventListener("pointerdown",this._pointerDownListener,!0),r.addEventListener("click",this._clickListener,!0),r.addEventListener("auxclick",this._clickListener,!0),r.addEventListener("contextmenu",this._clickListener,!0)}};s.\u0275fac=function(l){return new(l||s)(st(un),st(Wn),st(Fi,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Rm=(()=>{let s=class s{constructor(r,l){this._platform=l,this._document=r}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let r="cdk-overlay-container";if(this._platform.isBrowser||ag()){let i=this._document.querySelectorAll(`.${r}[platform="server"], .${r}[platform="test"]`);for(let _=0;_<i.length;_++)i[_].remove()}let l=this._document.createElement("div");l.classList.add(r),ag()?l.setAttribute("platform","test"):this._platform.isBrowser||l.setAttribute("platform","server"),this._document.body.appendChild(l),this._containerElement=l}};s.\u0275fac=function(l){return new(l||s)(st(un),st(Wn))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Hl=class{constructor(s,u,r,l,i,_,C,I,O,N=!1){this._portalOutlet=s,this._host=u,this._pane=r,this._config=l,this._ngZone=i,this._keyboardDispatcher=_,this._document=C,this._location=I,this._outsideClickDispatcher=O,this._animationsDisabled=N,this._backdropElement=null,this._backdropClick=new En,this._attachments=new En,this._detachments=new En,this._locationChanges=hs.EMPTY,this._backdropClickHandler=q=>this._backdropClick.next(q),this._backdropTransitionendHandler=q=>{this._disposeBackdrop(q.target)},this._keydownEvents=new En,this._outsidePointerEvents=new En,l.scrollStrategy&&(this._scrollStrategy=l.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=l.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(s){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let u=this._portalOutlet.attach(s);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(La(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof u?.onDestroy=="function"&&u.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),u}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let s=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),s}dispose(){let s=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,s&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(s){s!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=s,this.hasAttached()&&(s.attach(this),this.updatePosition()))}updateSize(s){this._config=Zi(Zi({},this._config),s),this._updateElementSize()}setDirection(s){this._config=Ra(Zi({},this._config),{direction:s}),this._updateElementDirection()}addPanelClass(s){this._pane&&this._toggleClasses(this._pane,s,!0)}removePanelClass(s){this._pane&&this._toggleClasses(this._pane,s,!1)}getDirection(){let s=this._config.direction;return s?typeof s=="string"?s:s.value:"ltr"}updateScrollStrategy(s){s!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=s,this.hasAttached()&&(s.attach(this),s.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let s=this._pane.style;s.width=Cr(this._config.width),s.height=Cr(this._config.height),s.minWidth=Cr(this._config.minWidth),s.minHeight=Cr(this._config.minHeight),s.maxWidth=Cr(this._config.maxWidth),s.maxHeight=Cr(this._config.maxHeight)}_togglePointerEvents(s){this._pane.style.pointerEvents=s?"":"none"}_attachBackdrop(){let s="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(s)})}):this._backdropElement.classList.add(s)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let s=this._backdropElement;if(s){if(this._animationsDisabled){this._disposeBackdrop(s);return}s.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{s.addEventListener("transitionend",this._backdropTransitionendHandler)}),s.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(s)},500))}}_toggleClasses(s,u,r){let l=Em(u||[]).filter(i=>!!i);l.length&&(r?s.classList.add(...l):s.classList.remove(...l))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let s=this._ngZone.onStable.pipe(Bh(zh(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),s.unsubscribe())})})}_disposeScrollStrategy(){let s=this._scrollStrategy;s&&(s.disable(),s.detach&&s.detach())}_disposeBackdrop(s){s&&(s.removeEventListener("click",this._backdropClickHandler),s.removeEventListener("transitionend",this._backdropTransitionendHandler),s.remove(),this._backdropElement===s&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},II="cdk-overlay-connected-position-bounding-box",bL=/([A-Za-z%]+)$/,kb=class{get positions(){return this._preferredPositions}constructor(s,u,r,l,i){this._viewportRuler=u,this._document=r,this._platform=l,this._overlayContainer=i,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new En,this._resizeSubscription=hs.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(s)}attach(s){this._overlayRef&&this._overlayRef,this._validatePositions(),s.hostElement.classList.add(II),this._overlayRef=s,this._boundingBox=s.hostElement,this._pane=s.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let s=this._originRect,u=this._overlayRect,r=this._viewportRect,l=this._containerRect,i=[],_;for(let C of this._preferredPositions){let I=this._getOriginPoint(s,l,C),O=this._getOverlayPoint(I,u,C),N=this._getOverlayFit(O,u,r,C);if(N.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(C,I);return}if(this._canFitWithFlexibleDimensions(N,O,r)){i.push({position:C,origin:I,overlayRect:u,boundingBoxRect:this._calculateBoundingBoxRect(I,C)});continue}(!_||_.overlayFit.visibleArea<N.visibleArea)&&(_={overlayFit:N,overlayPoint:O,originPoint:I,position:C,overlayRect:u})}if(i.length){let C=null,I=-1;for(let O of i){let N=O.boundingBoxRect.width*O.boundingBoxRect.height*(O.position.weight||1);N>I&&(I=N,C=O)}this._isPushed=!1,this._applyPosition(C.position,C.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(_.position,_.originPoint);return}this._applyPosition(_.position,_.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Gh(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(II),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let s=this._lastPosition;if(s){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let u=this._getOriginPoint(this._originRect,this._containerRect,s);this._applyPosition(s,u)}else this.apply()}withScrollableContainers(s){return this._scrollables=s,this}withPositions(s){return this._preferredPositions=s,s.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(s){return this._viewportMargin=s,this}withFlexibleDimensions(s=!0){return this._hasFlexibleDimensions=s,this}withGrowAfterOpen(s=!0){return this._growAfterOpen=s,this}withPush(s=!0){return this._canPush=s,this}withLockedPosition(s=!0){return this._positionLocked=s,this}setOrigin(s){return this._origin=s,this}withDefaultOffsetX(s){return this._offsetX=s,this}withDefaultOffsetY(s){return this._offsetY=s,this}withTransformOriginOn(s){return this._transformOriginSelector=s,this}_getOriginPoint(s,u,r){let l;if(r.originX=="center")l=s.left+s.width/2;else{let _=this._isRtl()?s.right:s.left,C=this._isRtl()?s.left:s.right;l=r.originX=="start"?_:C}u.left<0&&(l-=u.left);let i;return r.originY=="center"?i=s.top+s.height/2:i=r.originY=="top"?s.top:s.bottom,u.top<0&&(i-=u.top),{x:l,y:i}}_getOverlayPoint(s,u,r){let l;r.overlayX=="center"?l=-u.width/2:r.overlayX==="start"?l=this._isRtl()?-u.width:0:l=this._isRtl()?0:-u.width;let i;return r.overlayY=="center"?i=-u.height/2:i=r.overlayY=="top"?0:-u.height,{x:s.x+l,y:s.y+i}}_getOverlayFit(s,u,r,l){let i=EI(u),{x:_,y:C}=s,I=this._getOffset(l,"x"),O=this._getOffset(l,"y");I&&(_+=I),O&&(C+=O);let N=0-_,q=_+i.width-r.width,ie=0-C,de=C+i.height-r.height,xe=this._subtractOverflows(i.width,N,q),ke=this._subtractOverflows(i.height,ie,de),Ae=xe*ke;return{visibleArea:Ae,isCompletelyWithinViewport:i.width*i.height===Ae,fitsInViewportVertically:ke===i.height,fitsInViewportHorizontally:xe==i.width}}_canFitWithFlexibleDimensions(s,u,r){if(this._hasFlexibleDimensions){let l=r.bottom-u.y,i=r.right-u.x,_=TI(this._overlayRef.getConfig().minHeight),C=TI(this._overlayRef.getConfig().minWidth),I=s.fitsInViewportVertically||_!=null&&_<=l,O=s.fitsInViewportHorizontally||C!=null&&C<=i;return I&&O}return!1}_pushOverlayOnScreen(s,u,r){if(this._previousPushAmount&&this._positionLocked)return{x:s.x+this._previousPushAmount.x,y:s.y+this._previousPushAmount.y};let l=EI(u),i=this._viewportRect,_=Math.max(s.x+l.width-i.width,0),C=Math.max(s.y+l.height-i.height,0),I=Math.max(i.top-r.top-s.y,0),O=Math.max(i.left-r.left-s.x,0),N=0,q=0;return l.width<=i.width?N=O||-_:N=s.x<this._viewportMargin?i.left-r.left-s.x:0,l.height<=i.height?q=I||-C:q=s.y<this._viewportMargin?i.top-r.top-s.y:0,this._previousPushAmount={x:N,y:q},{x:s.x+N,y:s.y+q}}_applyPosition(s,u){if(this._setTransformOrigin(s),this._setOverlayElementStyles(u,s),this._setBoundingBoxStyles(u,s),s.panelClass&&this._addPanelClasses(s.panelClass),this._positionChanges.observers.length){let r=this._getScrollVisibility();if(s!==this._lastPosition||!this._lastScrollVisibility||!yL(this._lastScrollVisibility,r)){let l=new C1(s,r);this._positionChanges.next(l)}this._lastScrollVisibility=r}this._lastPosition=s,this._isInitialRender=!1}_setTransformOrigin(s){if(!this._transformOriginSelector)return;let u=this._boundingBox.querySelectorAll(this._transformOriginSelector),r,l=s.overlayY;s.overlayX==="center"?r="center":this._isRtl()?r=s.overlayX==="start"?"right":"left":r=s.overlayX==="start"?"left":"right";for(let i=0;i<u.length;i++)u[i].style.transformOrigin=`${r} ${l}`}_calculateBoundingBoxRect(s,u){let r=this._viewportRect,l=this._isRtl(),i,_,C;if(u.overlayY==="top")_=s.y,i=r.height-_+this._viewportMargin;else if(u.overlayY==="bottom")C=r.height-s.y+this._viewportMargin*2,i=r.height-C+this._viewportMargin;else{let de=Math.min(r.bottom-s.y+r.top,s.y),xe=this._lastBoundingBoxSize.height;i=de*2,_=s.y-de,i>xe&&!this._isInitialRender&&!this._growAfterOpen&&(_=s.y-xe/2)}let I=u.overlayX==="start"&&!l||u.overlayX==="end"&&l,O=u.overlayX==="end"&&!l||u.overlayX==="start"&&l,N,q,ie;if(O)ie=r.width-s.x+this._viewportMargin*2,N=s.x-this._viewportMargin;else if(I)q=s.x,N=r.right-s.x;else{let de=Math.min(r.right-s.x+r.left,s.x),xe=this._lastBoundingBoxSize.width;N=de*2,q=s.x-de,N>xe&&!this._isInitialRender&&!this._growAfterOpen&&(q=s.x-xe/2)}return{top:_,left:q,bottom:C,right:ie,width:N,height:i}}_setBoundingBoxStyles(s,u){let r=this._calculateBoundingBoxRect(s,u);!this._isInitialRender&&!this._growAfterOpen&&(r.height=Math.min(r.height,this._lastBoundingBoxSize.height),r.width=Math.min(r.width,this._lastBoundingBoxSize.width));let l={};if(this._hasExactPosition())l.top=l.left="0",l.bottom=l.right=l.maxHeight=l.maxWidth="",l.width=l.height="100%";else{let i=this._overlayRef.getConfig().maxHeight,_=this._overlayRef.getConfig().maxWidth;l.height=Cr(r.height),l.top=Cr(r.top),l.bottom=Cr(r.bottom),l.width=Cr(r.width),l.left=Cr(r.left),l.right=Cr(r.right),u.overlayX==="center"?l.alignItems="center":l.alignItems=u.overlayX==="end"?"flex-end":"flex-start",u.overlayY==="center"?l.justifyContent="center":l.justifyContent=u.overlayY==="bottom"?"flex-end":"flex-start",i&&(l.maxHeight=Cr(i)),_&&(l.maxWidth=Cr(_))}this._lastBoundingBoxSize=r,Gh(this._boundingBox.style,l)}_resetBoundingBoxStyles(){Gh(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Gh(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(s,u){let r={},l=this._hasExactPosition(),i=this._hasFlexibleDimensions,_=this._overlayRef.getConfig();if(l){let N=this._viewportRuler.getViewportScrollPosition();Gh(r,this._getExactOverlayY(u,s,N)),Gh(r,this._getExactOverlayX(u,s,N))}else r.position="static";let C="",I=this._getOffset(u,"x"),O=this._getOffset(u,"y");I&&(C+=`translateX(${I}px) `),O&&(C+=`translateY(${O}px)`),r.transform=C.trim(),_.maxHeight&&(l?r.maxHeight=Cr(_.maxHeight):i&&(r.maxHeight="")),_.maxWidth&&(l?r.maxWidth=Cr(_.maxWidth):i&&(r.maxWidth="")),Gh(this._pane.style,r)}_getExactOverlayY(s,u,r){let l={top:"",bottom:""},i=this._getOverlayPoint(u,this._overlayRect,s);if(this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,r)),s.overlayY==="bottom"){let _=this._document.documentElement.clientHeight;l.bottom=`${_-(i.y+this._overlayRect.height)}px`}else l.top=Cr(i.y);return l}_getExactOverlayX(s,u,r){let l={left:"",right:""},i=this._getOverlayPoint(u,this._overlayRect,s);this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,r));let _;if(this._isRtl()?_=s.overlayX==="end"?"left":"right":_=s.overlayX==="end"?"right":"left",_==="right"){let C=this._document.documentElement.clientWidth;l.right=`${C-(i.x+this._overlayRect.width)}px`}else l.left=Cr(i.x);return l}_getScrollVisibility(){let s=this._getOriginRect(),u=this._pane.getBoundingClientRect(),r=this._scrollables.map(l=>l.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:kI(s,r),isOriginOutsideView:x1(s,r),isOverlayClipped:kI(u,r),isOverlayOutsideView:x1(u,r)}}_subtractOverflows(s,...u){return u.reduce((r,l)=>r-Math.max(l,0),s)}_getNarrowedViewportRect(){let s=this._document.documentElement.clientWidth,u=this._document.documentElement.clientHeight,r=this._viewportRuler.getViewportScrollPosition();return{top:r.top+this._viewportMargin,left:r.left+this._viewportMargin,right:r.left+s-this._viewportMargin,bottom:r.top+u-this._viewportMargin,width:s-2*this._viewportMargin,height:u-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(s,u){return u==="x"?s.offsetX==null?this._offsetX:s.offsetX:s.offsetY==null?this._offsetY:s.offsetY}_validatePositions(){}_addPanelClasses(s){this._pane&&Em(s).forEach(u=>{u!==""&&this._appliedPanelClasses.indexOf(u)===-1&&(this._appliedPanelClasses.push(u),this._pane.classList.add(u))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(s=>{this._pane.classList.remove(s)}),this._appliedPanelClasses=[])}_getOriginRect(){let s=this._origin;if(s instanceof sn)return s.nativeElement.getBoundingClientRect();if(s instanceof Element)return s.getBoundingClientRect();let u=s.width||0,r=s.height||0;return{top:s.y,bottom:s.y+r,left:s.x,right:s.x+u,height:r,width:u}}};function Gh(d,s){for(let u in s)s.hasOwnProperty(u)&&(d[u]=s[u]);return d}function TI(d){if(typeof d!="number"&&d!=null){let[s,u]=d.split(bL);return!u||u==="px"?parseFloat(s):null}return d||null}function EI(d){return{top:Math.floor(d.top),right:Math.floor(d.right),bottom:Math.floor(d.bottom),left:Math.floor(d.left),width:Math.floor(d.width),height:Math.floor(d.height)}}function yL(d,s){return d===s?!0:d.isOriginClipped===s.isOriginClipped&&d.isOriginOutsideView===s.isOriginOutsideView&&d.isOverlayClipped===s.isOverlayClipped&&d.isOverlayOutsideView===s.isOverlayOutsideView}var DI="cdk-global-overlay-wrapper",S1=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(s){let u=s.getConfig();this._overlayRef=s,this._width&&!u.width&&s.updateSize({width:this._width}),this._height&&!u.height&&s.updateSize({height:this._height}),s.hostElement.classList.add(DI),this._isDisposed=!1}top(s=""){return this._bottomOffset="",this._topOffset=s,this._alignItems="flex-start",this}left(s=""){return this._xOffset=s,this._xPosition="left",this}bottom(s=""){return this._topOffset="",this._bottomOffset=s,this._alignItems="flex-end",this}right(s=""){return this._xOffset=s,this._xPosition="right",this}start(s=""){return this._xOffset=s,this._xPosition="start",this}end(s=""){return this._xOffset=s,this._xPosition="end",this}width(s=""){return this._overlayRef?this._overlayRef.updateSize({width:s}):this._width=s,this}height(s=""){return this._overlayRef?this._overlayRef.updateSize({height:s}):this._height=s,this}centerHorizontally(s=""){return this.left(s),this._xPosition="center",this}centerVertically(s=""){return this.top(s),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let s=this._overlayRef.overlayElement.style,u=this._overlayRef.hostElement.style,r=this._overlayRef.getConfig(),{width:l,height:i,maxWidth:_,maxHeight:C}=r,I=(l==="100%"||l==="100vw")&&(!_||_==="100%"||_==="100vw"),O=(i==="100%"||i==="100vh")&&(!C||C==="100%"||C==="100vh"),N=this._xPosition,q=this._xOffset,ie=this._overlayRef.getConfig().direction==="rtl",de="",xe="",ke="";I?ke="flex-start":N==="center"?(ke="center",ie?xe=q:de=q):ie?N==="left"||N==="end"?(ke="flex-end",de=q):(N==="right"||N==="start")&&(ke="flex-start",xe=q):N==="left"||N==="start"?(ke="flex-start",de=q):(N==="right"||N==="end")&&(ke="flex-end",xe=q),s.position=this._cssPosition,s.marginLeft=I?"0":de,s.marginTop=O?"0":this._topOffset,s.marginBottom=this._bottomOffset,s.marginRight=I?"0":xe,u.justifyContent=ke,u.alignItems=O?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let s=this._overlayRef.overlayElement.style,u=this._overlayRef.hostElement,r=u.style;u.classList.remove(DI),r.justifyContent=r.alignItems=s.marginTop=s.marginBottom=s.marginLeft=s.marginRight=s.position="",this._overlayRef=null,this._isDisposed=!0}},vL=(()=>{let s=class s{constructor(r,l,i,_){this._viewportRuler=r,this._document=l,this._platform=i,this._overlayContainer=_}global(){return new S1}flexibleConnectedTo(r){return new kb(r,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};s.\u0275fac=function(l){return new(l||s)(st(_1),st(un),st(Wn),st(Rm))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),xL=0,Qo=(()=>{let s=class s{constructor(r,l,i,_,C,I,O,N,q,ie,de,xe){this.scrollStrategies=r,this._overlayContainer=l,this._componentFactoryResolver=i,this._positionBuilder=_,this._keyboardDispatcher=C,this._injector=I,this._ngZone=O,this._document=N,this._directionality=q,this._location=ie,this._outsideClickDispatcher=de,this._animationsModuleType=xe}create(r){let l=this._createHostElement(),i=this._createPaneElement(l),_=this._createPortalOutlet(i),C=new Om(r);return C.direction=C.direction||this._directionality.value,new Hl(_,l,i,C,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(r){let l=this._document.createElement("div");return l.id=`cdk-overlay-${xL++}`,l.classList.add("cdk-overlay-pane"),r.appendChild(l),l}_createHostElement(){let r=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(r),r}_createPortalOutlet(r){return this._appRef||(this._appRef=this._injector.get(_k)),new xb(r,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};s.\u0275fac=function(l){return new(l||s)(st(fL),st(Rm),st(eg),st(vL),st(gL),st(Fa),st(Fi),st(un),st(jl),st(_i),st(_L),st(to,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var wL=new pn("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let d=wn(Qo);return()=>d.scrollStrategies.reposition()}});function CL(d){return()=>d.scrollStrategies.reposition()}var SL={provide:wL,deps:[Qo],useFactory:CL},Lm=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[Qo,SL],imports:[pd,Ul,b1,b1]});let d=s;return d})();var ML=["mat-button",""],kL=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],IL=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var TL=".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}";var EL=["mat-icon-button",""],DL=["*"];var AL=new pn("MAT_BUTTON_CONFIG");var PL=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],OI=(()=>{let s=class s{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(r){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,r)}get disableRipple(){return this._disableRipple}set disableRipple(r){this._disableRipple=r,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(r){this._disabled=r,this._updateRippleDisabled()}constructor(r,l,i,_){this._elementRef=r,this._platform=l,this._ngZone=i,this._animationMode=_,this._focusMonitor=wn(Vl),this._rippleLoader=wn(fI),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let C=wn(AL,{optional:!0}),I=r.nativeElement,O=I.classList;this.disabledInteractive=C?.disabledInteractive??!1,this._rippleLoader?.configureRipple(I,{className:"mat-mdc-button-ripple"});for(let{attribute:N,mdcClasses:q}of PL)I.hasAttribute(N)&&O.add(...q)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(r="program",l){r?this._focusMonitor.focusVia(this._elementRef.nativeElement,r,l):this._elementRef.nativeElement.focus(l)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};s.\u0275fac=function(l){Sm()},s.\u0275dir=Kn({type:s,inputs:{color:"color",disableRipple:[Xi.HasDecoratorInputTransform,"disableRipple","disableRipple",io],disabled:[Xi.HasDecoratorInputTransform,"disabled","disabled",io],ariaDisabled:[Xi.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",io],disabledInteractive:[Xi.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",io]},features:[wo]});let d=s;return d})();var M1=(()=>{let s=class s extends OI{constructor(r,l,i,_){super(r,l,i,_)}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(Wn),_e(Fi),_e(to,8))},s.\u0275cmp=ft({type:s,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(l,i){l&2&&(bn("disabled",i._getDisabledAttribute())("aria-disabled",i._getAriaDisabled()),ps(i.color?"mat-"+i.color:""),Si("mat-mdc-button-disabled",i.disabled)("mat-mdc-button-disabled-interactive",i.disabledInteractive)("_mat-animation-noopable",i._animationMode==="NoopAnimations")("mat-unthemed",!i.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Ro,jn],attrs:ML,ngContentSelectors:IL,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(l,i){l&1&&($o(kL),Me(0,"span",0),Co(1),V(2,"span",1),Co(3,1),j(),Co(4,2),Me(5,"span",2)(6,"span",3)),l&2&&Si("mdc-button__ripple",!i._isFab)("mdc-fab__ripple",i._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let d=s;return d})();var k1=(()=>{let s=class s extends OI{constructor(r,l,i,_){super(r,l,i,_),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(Wn),_e(Fi),_e(to,8))},s.\u0275cmp=ft({type:s,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(l,i){l&2&&(bn("disabled",i._getDisabledAttribute())("aria-disabled",i._getAriaDisabled()),ps(i.color?"mat-"+i.color:""),Si("mat-mdc-button-disabled",i.disabled)("mat-mdc-button-disabled-interactive",i.disabledInteractive)("_mat-animation-noopable",i._animationMode==="NoopAnimations")("mat-unthemed",!i.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Ro,jn],attrs:EL,ngContentSelectors:DL,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(l,i){l&1&&($o(),Me(0,"span",0),Co(1),Me(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{color:var(--mdc-icon-button-icon-color)}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 48px);height:var(--mdc-icon-button-state-layer-size, 48px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 48px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size);-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color)}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color)}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color)}.mat-mdc-icon-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity)}.mat-mdc-icon-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity)}.mat-mdc-icon-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity)}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',TL],encapsulation:2,changeDetection:0});let d=s;return d})();var RI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[zn,pI,zn]});let d=s;return d})();var OL=["mat-calendar-body",""];function RL(d,s){if(d&1&&(V(0,"tr",0)(1,"td",3),$(2),j()()),d&2){let u=dt();ue(),za("padding-top",u._cellPadding)("padding-bottom",u._cellPadding),bn("colspan",u.numCols),ue(),zi(" ",u.label," ")}}function LL(d,s){if(d&1&&(V(0,"td",3),$(1),j()),d&2){let u=dt(2);za("padding-top",u._cellPadding)("padding-bottom",u._cellPadding),bn("colspan",u._firstRowOffset),ue(),zi(" ",u._firstRowOffset>=u.labelMinRequiredCells?u.label:""," ")}}function FL(d,s){if(d&1){let u=Kt();V(0,"td",6)(1,"button",7),Oe("click",function(l){let i=_t(u).$implicit,_=dt(2);return bt(_._cellClicked(i,l))})("focus",function(l){let i=_t(u).$implicit,_=dt(2);return bt(_._emitActiveDateChange(i,l))}),V(2,"span",8),$(3),j(),Me(4,"span",9),j()()}if(d&2){let u=s.$implicit,r=s.$index,l=dt().$index,i=dt();za("width",i._cellWidth)("padding-top",i._cellPadding)("padding-bottom",i._cellPadding),bn("data-mat-row",l)("data-mat-col",r),ue(),Si("mat-calendar-body-disabled",!u.enabled)("mat-calendar-body-active",i._isActiveCell(l,r))("mat-calendar-body-range-start",i._isRangeStart(u.compareValue))("mat-calendar-body-range-end",i._isRangeEnd(u.compareValue))("mat-calendar-body-in-range",i._isInRange(u.compareValue))("mat-calendar-body-comparison-bridge-start",i._isComparisonBridgeStart(u.compareValue,l,r))("mat-calendar-body-comparison-bridge-end",i._isComparisonBridgeEnd(u.compareValue,l,r))("mat-calendar-body-comparison-start",i._isComparisonStart(u.compareValue))("mat-calendar-body-comparison-end",i._isComparisonEnd(u.compareValue))("mat-calendar-body-in-comparison-range",i._isInComparisonRange(u.compareValue))("mat-calendar-body-preview-start",i._isPreviewStart(u.compareValue))("mat-calendar-body-preview-end",i._isPreviewEnd(u.compareValue))("mat-calendar-body-in-preview",i._isInPreview(u.compareValue)),Fe("ngClass",u.cssClasses)("tabindex",i._isActiveCell(l,r)?0:-1),bn("aria-label",u.ariaLabel)("aria-disabled",!u.enabled||null)("aria-pressed",i._isSelected(u.compareValue))("aria-current",i.todayValue===u.compareValue?"date":null)("aria-describedby",i._getDescribedby(u.compareValue)),ue(),Si("mat-calendar-body-selected",i._isSelected(u.compareValue))("mat-calendar-body-comparison-identical",i._isComparisonIdentical(u.compareValue))("mat-calendar-body-today",i.todayValue===u.compareValue),ue(),zi(" ",u.displayValue," ")}}function zL(d,s){if(d&1&&(V(0,"tr",1),Bt(1,LL,2,6,"td",4),Or(2,FL,5,48,"td",5,tg),j()),d&2){let u=s.$implicit,r=s.$index,l=dt();ue(),Vn(1,r===0&&l._firstRowOffset?1:-1),ue(),Rr(u)}}function BL(d,s){if(d&1&&(V(0,"th",2)(1,"span",6),$(2),j(),V(3,"span",3),$(4),j()()),d&2){let u=s.$implicit;ue(2),Rt(u.long),ue(2),Rt(u.narrow)}}var NL=["*"];function VL(d,s){}function jL(d,s){if(d&1){let u=Kt();V(0,"mat-month-view",2),Yr("activeDateChange",function(l){_t(u);let i=dt();return $r(i.activeDate,l)||(i.activeDate=l),bt(l)}),Oe("_userSelection",function(l){_t(u);let i=dt();return bt(i._dateSelected(l))})("dragStarted",function(l){_t(u);let i=dt();return bt(i._dragStarted(l))})("dragEnded",function(l){_t(u);let i=dt();return bt(i._dragEnded(l))}),j()}if(d&2){let u=dt();qr("activeDate",u.activeDate),Fe("selected",u.selected)("dateFilter",u.dateFilter)("maxDate",u.maxDate)("minDate",u.minDate)("dateClass",u.dateClass)("comparisonStart",u.comparisonStart)("comparisonEnd",u.comparisonEnd)("startDateAccessibleName",u.startDateAccessibleName)("endDateAccessibleName",u.endDateAccessibleName)("activeDrag",u._activeDrag)}}function UL(d,s){if(d&1){let u=Kt();V(0,"mat-year-view",3),Yr("activeDateChange",function(l){_t(u);let i=dt();return $r(i.activeDate,l)||(i.activeDate=l),bt(l)}),Oe("monthSelected",function(l){_t(u);let i=dt();return bt(i._monthSelectedInYearView(l))})("selectedChange",function(l){_t(u);let i=dt();return bt(i._goToDateInView(l,"month"))}),j()}if(d&2){let u=dt();qr("activeDate",u.activeDate),Fe("selected",u.selected)("dateFilter",u.dateFilter)("maxDate",u.maxDate)("minDate",u.minDate)("dateClass",u.dateClass)}}function HL(d,s){if(d&1){let u=Kt();V(0,"mat-multi-year-view",4),Yr("activeDateChange",function(l){_t(u);let i=dt();return $r(i.activeDate,l)||(i.activeDate=l),bt(l)}),Oe("yearSelected",function(l){_t(u);let i=dt();return bt(i._yearSelectedInMultiYearView(l))})("selectedChange",function(l){_t(u);let i=dt();return bt(i._goToDateInView(l,"year"))}),j()}if(d&2){let u=dt();qr("activeDate",u.activeDate),Fe("selected",u.selected)("dateFilter",u.dateFilter)("maxDate",u.maxDate)("minDate",u.minDate)("dateClass",u.dateClass)}}function WL(d,s){}var GL=["button"],qL=[[["","matDatepickerToggleIcon",""]]],$L=["[matDatepickerToggleIcon]"];function YL(d,s){d&1&&(sd(),V(0,"svg",2),Me(1,"path",3),j())}var fg=(()=>{let s=class s{constructor(){this.changes=new En,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(r,l){return`${r} \u2013 ${l}`}formatYearRangeLabel(r,l){return`${r} to ${l}`}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),mg=class{constructor(s,u,r,l,i={},_=s,C){this.value=s,this.displayValue=u,this.ariaLabel=r,this.enabled=l,this.cssClasses=i,this.compareValue=_,this.rawValue=C}},ZL=1,LI=$s({passive:!1,capture:!0}),_d=$s({passive:!0,capture:!0}),Ib=$s({passive:!0}),Bm=(()=>{let s=class s{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(r,l){this._elementRef=r,this._ngZone=l,this._platform=wn(Wn),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new an,this.previewChange=new an,this.activeDateChange=new an,this.dragStarted=new an,this.dragEnded=new an,this._didDragSinceMouseDown=!1,this._enterHandler=i=>{if(this._skipNextFocus&&i.type==="focus"){this._skipNextFocus=!1;return}if(i.target&&this.isRange){let _=this._getCellFromElement(i.target);_&&this._ngZone.run(()=>this.previewChange.emit({value:_.enabled?_:null,event:i}))}},this._touchmoveHandler=i=>{if(!this.isRange)return;let _=FI(i),C=_?this._getCellFromElement(_):null;_!==i.target&&(this._didDragSinceMouseDown=!0),T1(i.target)&&i.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:C?.enabled?C:null,event:i}))},this._leaveHandler=i=>{this.previewEnd!==null&&this.isRange&&(i.type!=="blur"&&(this._didDragSinceMouseDown=!0),i.target&&this._getCellFromElement(i.target)&&!(i.relatedTarget&&this._getCellFromElement(i.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:i})))},this._mousedownHandler=i=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let _=i.target&&this._getCellFromElement(i.target);!_||!this._isInRange(_.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:_.rawValue,event:i})})},this._mouseupHandler=i=>{if(!this.isRange)return;let _=T1(i.target);if(!_){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:i})});return}_.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let C=this._getCellFromElement(_);this.dragEnded.emit({value:C?.rawValue??null,event:i})})},this._touchendHandler=i=>{let _=FI(i);_&&this._mouseupHandler({target:_})},this._id=`mat-calendar-body-${ZL++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,l.runOutsideAngular(()=>{let i=r.nativeElement;i.addEventListener("touchmove",this._touchmoveHandler,LI),i.addEventListener("mouseenter",this._enterHandler,_d),i.addEventListener("focus",this._enterHandler,_d),i.addEventListener("mouseleave",this._leaveHandler,_d),i.addEventListener("blur",this._leaveHandler,_d),i.addEventListener("mousedown",this._mousedownHandler,Ib),i.addEventListener("touchstart",this._mousedownHandler,Ib),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(r,l){this._didDragSinceMouseDown||r.enabled&&this.selectedValueChange.emit({value:r.value,event:l})}_emitActiveDateChange(r,l){r.enabled&&this.activeDateChange.emit({value:r.value,event:l})}_isSelected(r){return this.startValue===r||this.endValue===r}ngOnChanges(r){let l=r.numCols,{rows:i,numCols:_}=this;(r.rows||l)&&(this._firstRowOffset=i&&i.length&&i[0].length?_-i[0].length:0),(r.cellAspectRatio||l||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/_}%`),(l||!this._cellWidth)&&(this._cellWidth=`${100/_}%`)}ngOnDestroy(){let r=this._elementRef.nativeElement;r.removeEventListener("touchmove",this._touchmoveHandler,LI),r.removeEventListener("mouseenter",this._enterHandler,_d),r.removeEventListener("focus",this._enterHandler,_d),r.removeEventListener("mouseleave",this._leaveHandler,_d),r.removeEventListener("blur",this._leaveHandler,_d),r.removeEventListener("mousedown",this._mousedownHandler,Ib),r.removeEventListener("touchstart",this._mousedownHandler,Ib),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(r,l){let i=r*this.numCols+l;return r&&(i-=this._firstRowOffset),i==this.activeCell}_focusActiveCell(r=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(La(1)).subscribe(()=>{setTimeout(()=>{let l=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");l&&(r||(this._skipNextFocus=!0),l.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(r){return E1(r,this.startValue,this.endValue)}_isRangeEnd(r){return D1(r,this.startValue,this.endValue)}_isInRange(r){return A1(r,this.startValue,this.endValue,this.isRange)}_isComparisonStart(r){return E1(r,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(r,l,i){if(!this._isComparisonStart(r)||this._isRangeStart(r)||!this._isInRange(r))return!1;let _=this.rows[l][i-1];if(!_){let C=this.rows[l-1];_=C&&C[C.length-1]}return _&&!this._isRangeEnd(_.compareValue)}_isComparisonBridgeEnd(r,l,i){if(!this._isComparisonEnd(r)||this._isRangeEnd(r)||!this._isInRange(r))return!1;let _=this.rows[l][i+1];if(!_){let C=this.rows[l+1];_=C&&C[0]}return _&&!this._isRangeStart(_.compareValue)}_isComparisonEnd(r){return D1(r,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(r){return A1(r,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(r){return this.comparisonStart===this.comparisonEnd&&r===this.comparisonStart}_isPreviewStart(r){return E1(r,this.previewStart,this.previewEnd)}_isPreviewEnd(r){return D1(r,this.previewStart,this.previewEnd)}_isInPreview(r){return A1(r,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(r){return this.isRange?this.startValue===r&&this.endValue===r?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===r?this._startDateLabelId:this.endValue===r?this._endDateLabelId:null:null}_getCellFromElement(r){let l=T1(r);if(l){let i=l.getAttribute("data-mat-row"),_=l.getAttribute("data-mat-col");if(i&&_)return this.rows[parseInt(i)][parseInt(_)]}return null}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(Fi))},s.\u0275cmp=ft({type:s,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[xo,jn],attrs:OL,decls:7,vars:5,consts:[["aria-hidden","true"],["role","row"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],[1,"mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"click","focus","ngClass","tabindex"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(l,i){l&1&&(Bt(0,RL,3,6,"tr",0),Or(1,zL,4,1,"tr",1,tg),V(3,"label",2),$(4),j(),V(5,"label",2),$(6),j()),l&2&&(Vn(0,i._firstRowOffset<i.labelMinRequiredCells?0:-1),ue(),Rr(i.rows),ue(2),Fe("id",i._startDateLabelId),ue(),zi(" ",i.startDateAccessibleName,`
`),ue(),Fe("id",i._endDateLabelId),ue(),zi(" ",i.endDateAccessibleName,`
`))},dependencies:[So],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let d=s;return d})();function I1(d){return d?.nodeName==="TD"}function T1(d){let s;return I1(d)?s=d:I1(d.parentNode)?s=d.parentNode:I1(d.parentNode?.parentNode)&&(s=d.parentNode.parentNode),s?.getAttribute("data-mat-row")!=null?s:null}function E1(d,s,u){return u!==null&&s!==u&&d<u&&d===s}function D1(d,s,u){return s!==null&&s!==u&&d>=s&&d===u}function A1(d,s,u,r){return r&&s!==null&&u!==null&&s!==u&&d>=s&&d<=u}function FI(d){let s=d.changedTouches[0];return document.elementFromPoint(s.clientX,s.clientY)}var ja=class{constructor(s,u){this.start=s,this.end=u}},Tb=(()=>{let s=class s{constructor(r,l){this.selection=r,this._adapter=l,this._selectionChanged=new En,this.selectionChanged=this._selectionChanged,this.selection=r}updateSelection(r,l){let i=this.selection;this.selection=r,this._selectionChanged.next({selection:r,source:l,oldValue:i})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(r){return this._adapter.isDateInstance(r)&&this._adapter.isValid(r)}};s.\u0275fac=function(l){Sm()},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})(),XL=(()=>{let s=class s extends Tb{constructor(r){super(null,r)}add(r){super.updateSelection(r,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let r=new s(this._adapter);return r.updateSelection(this.selection,this),r}};s.\u0275fac=function(l){return new(l||s)(st(Xo))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})();function QL(d,s){return d||new XL(s)}var KL={provide:Tb,deps:[[new Z0,new sk,Tb],Xo],useFactory:QL};var jI=new pn("MAT_DATE_RANGE_SELECTION_STRATEGY");var P1=7,zI=(()=>{let s=class s{get activeDate(){return this._activeDate}set activeDate(r){let l=this._activeDate,i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),this._hasSameMonthAndYear(l,this._activeDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof ja?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,l,i,_,C){this._changeDetectorRef=r,this._dateFormats=l,this._dateAdapter=i,this._dir=_,this._rangeStrategy=C,this._rerenderSubscription=hs.EMPTY,this.activeDrag=null,this.selectedChange=new an,this._userSelection=new an,this.dragStarted=new an,this.dragEnded=new an,this.activeDateChange=new an,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(us(null)).subscribe(()=>this._init())}ngOnChanges(r){let l=r.comparisonStart||r.comparisonEnd;l&&!l.firstChange&&this._setRanges(this.selected),r.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(r){let l=r.value,i=this._getDateFromDayOfMonth(l),_,C;this._selected instanceof ja?(_=this._getDateInCurrentMonth(this._selected.start),C=this._getDateInCurrentMonth(this._selected.end)):_=C=this._getDateInCurrentMonth(this._selected),(_!==l||C!==l)&&this.selectedChange.emit(i),this._userSelection.emit({value:i,event:r.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(r){let l=r.value,i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(l),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(r){let l=this._activeDate,i=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,i?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,i?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=r.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&r.preventDefault();return;case 27:this._previewEnd!=null&&!Tm(r)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:r}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:r})),r.preventDefault(),r.stopPropagation());return;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(P1+this._dateAdapter.getDayOfWeek(r)-this._dateAdapter.getFirstDayOfWeek())%P1,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(r){this._matCalendarBody._focusActiveCell(r)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:r,value:l}){if(this._rangeStrategy){let i=l?l.rawValue:null,_=this._rangeStrategy.createPreview(i,this.selected,r);if(this._previewStart=this._getCellCompareValue(_.start),this._previewEnd=this._getCellCompareValue(_.end),this.activeDrag&&i){let C=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,i,r);C&&(this._previewStart=this._getCellCompareValue(C.start),this._previewEnd=this._getCellCompareValue(C.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(r){if(this.activeDrag)if(r.value){let l=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,r.value,r.event);this.dragEnded.emit({value:l??null,event:r.event})}else this.dragEnded.emit({value:null,event:r.event})}_getDateFromDayOfMonth(r){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r)}_initWeekdays(){let r=this._dateAdapter.getFirstDayOfWeek(),l=this._dateAdapter.getDayOfWeekNames("narrow"),_=this._dateAdapter.getDayOfWeekNames("long").map((C,I)=>({long:C,narrow:l[I]}));this._weekdays=_.slice(r).concat(_.slice(0,r))}_createWeekCells(){let r=this._dateAdapter.getNumDaysInMonth(this.activeDate),l=this._dateAdapter.getDateNames();this._weeks=[[]];for(let i=0,_=this._firstWeekOffset;i<r;i++,_++){_==P1&&(this._weeks.push([]),_=0);let C=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),i+1),I=this._shouldEnableDate(C),O=this._dateAdapter.format(C,this._dateFormats.display.dateA11yLabel),N=this.dateClass?this.dateClass(C,"month"):void 0;this._weeks[this._weeks.length-1].push(new mg(i+1,l[i],O,I,N,this._getCellCompareValue(C),C))}}_shouldEnableDate(r){return!!r&&(!this.minDate||this._dateAdapter.compareDate(r,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(r,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(r))}_getDateInCurrentMonth(r){return r&&this._hasSameMonthAndYear(r,this.activeDate)?this._dateAdapter.getDate(r):null}_hasSameMonthAndYear(r,l){return!!(r&&l&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(l)&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(l))}_getCellCompareValue(r){if(r){let l=this._dateAdapter.getYear(r),i=this._dateAdapter.getMonth(r),_=this._dateAdapter.getDate(r);return new Date(l,i,_).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(r){r instanceof ja?(this._rangeStart=this._getCellCompareValue(r.start),this._rangeEnd=this._getCellCompareValue(r.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(r),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(r){return!this.dateFilter||this.dateFilter(r)}_clearPreview(){this._previewStart=this._previewEnd=null}};s.\u0275fac=function(l){return new(l||s)(_e(uo),_e(Am,8),_e(Xo,8),_e(jl,8),_e(jI,8))},s.\u0275cmp=ft({type:s,selectors:[["mat-month-view"]],viewQuery:function(l,i){if(l&1&&bi(Bm,5),l&2){let _;fi(_=gi())&&(i._matCalendarBody=_.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[xo,jn],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown","label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName"],[1,"cdk-visually-hidden"]],template:function(l,i){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Or(3,BL,5,2,"th",2,tg),j(),V(5,"tr",3),Me(6,"th",4),j()(),V(7,"tbody",5),Oe("selectedValueChange",function(C){return i._dateSelected(C)})("activeDateChange",function(C){return i._updateActiveDate(C)})("previewChange",function(C){return i._previewChanged(C)})("dragStarted",function(C){return i.dragStarted.emit(C)})("dragEnded",function(C){return i._dragEnded(C)})("keyup",function(C){return i._handleCalendarBodyKeyup(C)})("keydown",function(C){return i._handleCalendarBodyKeydown(C)}),j()()),l&2&&(ue(3),Rr(i._weekdays),ue(4),Fe("label",i._monthLabel)("rows",i._weeks)("todayValue",i._todayDate)("startValue",i._rangeStart)("endValue",i._rangeEnd)("comparisonStart",i._comparisonRangeStart)("comparisonEnd",i._comparisonRangeEnd)("previewStart",i._previewStart)("previewEnd",i._previewEnd)("isRange",i._isRange)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1)("startDateAccessibleName",i.startDateAccessibleName)("endDateAccessibleName",i.endDateAccessibleName))},dependencies:[Bm],encapsulation:2,changeDetection:0});let d=s;return d})(),_a=24,O1=4,BI=(()=>{let s=class s{get activeDate(){return this._activeDate}set activeDate(r){let l=this._activeDate,i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),UI(this._dateAdapter,l,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(r){r instanceof ja?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedYear(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,l,i){this._changeDetectorRef=r,this._dateAdapter=l,this._dir=i,this._rerenderSubscription=hs.EMPTY,this.selectedChange=new an,this.yearSelected=new an,this.activeDateChange=new an,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(us(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let l=this._dateAdapter.getYear(this._activeDate)-ug(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let i=0,_=[];i<_a;i++)_.push(l+i),_.length==O1&&(this._years.push(_.map(C=>this._createCellForYear(C))),_=[]);this._changeDetectorRef.markForCheck()}_yearSelected(r){let l=r.value,i=this._dateAdapter.createDate(l,0,1),_=this._getDateFromYear(l);this.yearSelected.emit(i),this.selectedChange.emit(_)}_updateActiveDate(r){let l=r.value,i=this._activeDate;this.activeDate=this._getDateFromYear(l),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let l=this._activeDate,i=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,i?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,i?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-O1);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,O1);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-ug(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,_a-ug(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-_a*10:-_a);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?_a*10:_a);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_getActiveCell(){return ug(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(r){let l=this._dateAdapter.getMonth(this.activeDate),i=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(r,l,1));return this._dateAdapter.createDate(r,l,Math.min(this._dateAdapter.getDate(this.activeDate),i))}_createCellForYear(r){let l=this._dateAdapter.createDate(r,0,1),i=this._dateAdapter.getYearName(l),_=this.dateClass?this.dateClass(l,"multi-year"):void 0;return new mg(r,i,i,this._shouldEnableYear(r),_)}_shouldEnableYear(r){if(r==null||this.maxDate&&r>this._dateAdapter.getYear(this.maxDate)||this.minDate&&r<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let l=this._dateAdapter.createDate(r,0,1);for(let i=l;this._dateAdapter.getYear(i)==r;i=this._dateAdapter.addCalendarDays(i,1))if(this.dateFilter(i))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(r){if(this._selectedYear=null,r instanceof ja){let l=r.start||r.end;l&&(this._selectedYear=this._dateAdapter.getYear(l))}else r&&(this._selectedYear=this._dateAdapter.getYear(r))}};s.\u0275fac=function(l){return new(l||s)(_e(uo),_e(Xo,8),_e(jl,8))},s.\u0275cmp=ft({type:s,selectors:[["mat-multi-year-view"]],viewQuery:function(l,i){if(l&1&&bi(Bm,5),l&2){let _;fi(_=gi())&&(i._matCalendarBody=_.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[jn],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell"]],template:function(l,i){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Me(3,"th",2),j()(),V(4,"tbody",3),Oe("selectedValueChange",function(C){return i._yearSelected(C)})("activeDateChange",function(C){return i._updateActiveDate(C)})("keyup",function(C){return i._handleCalendarBodyKeyup(C)})("keydown",function(C){return i._handleCalendarBodyKeydown(C)}),j()()),l&2&&(ue(4),Fe("rows",i._years)("todayValue",i._todayYear)("startValue",i._selectedYear)("endValue",i._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",i._getActiveCell()))},dependencies:[Bm],encapsulation:2,changeDetection:0});let d=s;return d})();function UI(d,s,u,r,l){let i=d.getYear(s),_=d.getYear(u),C=HI(d,r,l);return Math.floor((i-C)/_a)===Math.floor((_-C)/_a)}function ug(d,s,u,r){let l=d.getYear(s);return JL(l-HI(d,u,r),_a)}function HI(d,s,u){let r=0;return u?r=d.getYear(u)-_a+1:s&&(r=d.getYear(s)),r}function JL(d,s){return(d%s+s)%s}var NI=(()=>{let s=class s{get activeDate(){return this._activeDate}set activeDate(r){let l=this._activeDate,i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),this._dateAdapter.getYear(l)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(r){r instanceof ja?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r)),this._setSelectedMonth(r)}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}constructor(r,l,i,_){this._changeDetectorRef=r,this._dateFormats=l,this._dateAdapter=i,this._dir=_,this._rerenderSubscription=hs.EMPTY,this.selectedChange=new an,this.monthSelected=new an,this.activeDateChange=new an,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(us(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(r){let l=r.value,i=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),l,1);this.monthSelected.emit(i);let _=this._getDateFromMonth(l);this.selectedChange.emit(_)}_updateActiveDate(r){let l=r.value,i=this._activeDate;this.activeDate=this._getDateFromMonth(l),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(r){let l=this._activeDate,i=this._isRtl();switch(r.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,i?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,i?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(l,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),r.preventDefault()}_handleCalendarBodyKeyup(r){(r.keyCode===32||r.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:r}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let r=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(l=>l.map(i=>this._createCellForMonth(i,r[i]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(r){return r&&this._dateAdapter.getYear(r)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(r):null}_getDateFromMonth(r){let l=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),i=this._dateAdapter.getNumDaysInMonth(l);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,Math.min(this._dateAdapter.getDate(this.activeDate),i))}_createCellForMonth(r,l){let i=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),r,1),_=this._dateAdapter.format(i,this._dateFormats.display.monthYearA11yLabel),C=this.dateClass?this.dateClass(i,"year"):void 0;return new mg(r,l.toLocaleUpperCase(),_,this._shouldEnableMonth(r),C)}_shouldEnableMonth(r){let l=this._dateAdapter.getYear(this.activeDate);if(r==null||this._isYearAndMonthAfterMaxDate(l,r)||this._isYearAndMonthBeforeMinDate(l,r))return!1;if(!this.dateFilter)return!0;let i=this._dateAdapter.createDate(l,r,1);for(let _=i;this._dateAdapter.getMonth(_)==r;_=this._dateAdapter.addCalendarDays(_,1))if(this.dateFilter(_))return!0;return!1}_isYearAndMonthAfterMaxDate(r,l){if(this.maxDate){let i=this._dateAdapter.getYear(this.maxDate),_=this._dateAdapter.getMonth(this.maxDate);return r>i||r===i&&l>_}return!1}_isYearAndMonthBeforeMinDate(r,l){if(this.minDate){let i=this._dateAdapter.getYear(this.minDate),_=this._dateAdapter.getMonth(this.minDate);return r<i||r===i&&l<_}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(r){r instanceof ja?this._selectedMonth=this._getMonthInCurrentYear(r.start)||this._getMonthInCurrentYear(r.end):this._selectedMonth=this._getMonthInCurrentYear(r)}};s.\u0275fac=function(l){return new(l||s)(_e(uo),_e(Am,8),_e(Xo,8),_e(jl,8))},s.\u0275cmp=ft({type:s,selectors:[["mat-year-view"]],viewQuery:function(l,i){if(l&1&&bi(Bm,5),l&2){let _;fi(_=gi())&&(i._matCalendarBody=_.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[jn],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell"]],template:function(l,i){l&1&&(V(0,"table",0)(1,"thead",1)(2,"tr"),Me(3,"th",2),j()(),V(4,"tbody",3),Oe("selectedValueChange",function(C){return i._monthSelected(C)})("activeDateChange",function(C){return i._updateActiveDate(C)})("keyup",function(C){return i._handleCalendarBodyKeyup(C)})("keydown",function(C){return i._handleCalendarBodyKeydown(C)}),j()()),l&2&&(ue(4),Fe("label",i._yearLabel)("rows",i._months)("todayValue",i._todayMonth)("startValue",i._selectedMonth)("endValue",i._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",i._dateAdapter.getMonth(i.activeDate)))},dependencies:[Bm],encapsulation:2,changeDetection:0});let d=s;return d})(),eF=1,WI=(()=>{let s=class s{constructor(r,l,i,_,C){this._intl=r,this.calendar=l,this._dateAdapter=i,this._dateFormats=_,this._id=`mat-calendar-header-${eF++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>C.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-_a)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:_a)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(r,l){return this.calendar.currentView=="month"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(l)&&this._dateAdapter.getMonth(r)==this._dateAdapter.getMonth(l):this.calendar.currentView=="year"?this._dateAdapter.getYear(r)==this._dateAdapter.getYear(l):UI(this._dateAdapter,r,l,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let l=this._dateAdapter.getYear(this.calendar.activeDate)-ug(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),i=l+_a-1,_=this._dateAdapter.getYearName(this._dateAdapter.createDate(l,0,1)),C=this._dateAdapter.getYearName(this._dateAdapter.createDate(i,0,1));return[_,C]}};s.\u0275fac=function(l){return new(l||s)(_e(fg),_e(Y0(()=>R1)),_e(Xo,8),_e(Am,8),_e(uo))},s.\u0275cmp=ft({type:s,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[jn],ngContentSelectors:NL,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],[1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"click","disabled"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"click","disabled"]],template:function(l,i){l&1&&($o(),V(0,"div",0)(1,"div",1)(2,"label",2),$(3),j(),V(4,"button",3),Oe("click",function(){return i.currentPeriodClicked()}),V(5,"span",4),$(6),j(),sd(),V(7,"svg",5),Me(8,"polygon",6),j()(),Wx(),Me(9,"div",7),Co(10),V(11,"button",8),Oe("click",function(){return i.previousClicked()}),j(),V(12,"button",9),Oe("click",function(){return i.nextClicked()}),j()()()),l&2&&(ue(2),Fe("id",i._periodButtonLabelId),ue(),Rt(i.periodButtonDescription),ue(),bn("aria-label",i.periodButtonLabel)("aria-describedby",i._periodButtonLabelId),ue(2),Rt(i.periodButtonText),ue(),Si("mat-calendar-invert",i.calendar.currentView!=="month"),ue(4),Fe("disabled",!i.previousEnabled()),bn("aria-label",i.prevButtonLabel),ue(),Fe("disabled",!i.nextEnabled()),bn("aria-label",i.nextButtonLabel))},dependencies:[M1,k1],encapsulation:2,changeDetection:0});let d=s;return d})(),R1=(()=>{let s=class s{get startAt(){return this._startAt}set startAt(r){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get selected(){return this._selected}set selected(r){r instanceof ja?this._selected=r:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get minDate(){return this._minDate}set minDate(r){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get maxDate(){return this._maxDate}set maxDate(r){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(r))}get activeDate(){return this._clampedActiveDate}set activeDate(r){this._clampedActiveDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(r){let l=this._currentView!==r?r:null;this._currentView=r,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),l&&this.viewChanged.emit(l)}constructor(r,l,i,_){this._dateAdapter=l,this._dateFormats=i,this._changeDetectorRef=_,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new an,this.yearSelected=new an,this.monthSelected=new an,this.viewChanged=new an(!0),this._userSelection=new an,this._userDragDrop=new an,this._activeDrag=null,this.stateChanges=new En,this._intlChanges=r.changes.subscribe(()=>{_.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new fd(this.headerComponent||WI),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(r){let l=r.minDate&&!this._dateAdapter.sameDate(r.minDate.previousValue,r.minDate.currentValue)?r.minDate:void 0,i=r.maxDate&&!this._dateAdapter.sameDate(r.maxDate.previousValue,r.maxDate.currentValue)?r.maxDate:void 0,_=l||i||r.dateFilter;if(_&&!_.firstChange){let C=this._getCurrentViewComponent();C&&(this._changeDetectorRef.detectChanges(),C._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(r){let l=r.value;(this.selected instanceof ja||l&&!this._dateAdapter.sameDate(l,this.selected))&&this.selectedChange.emit(l),this._userSelection.emit(r)}_yearSelectedInMultiYearView(r){this.yearSelected.emit(r)}_monthSelectedInYearView(r){this.monthSelected.emit(r)}_goToDateInView(r,l){this.activeDate=r,this.currentView=l}_dragStarted(r){this._activeDrag=r}_dragEnded(r){this._activeDrag&&(r.value&&this._userDragDrop.emit(r),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};s.\u0275fac=function(l){return new(l||s)(_e(fg),_e(Xo,8),_e(Am,8),_e(uo))},s.\u0275cmp=ft({type:s,selectors:[["mat-calendar"]],viewQuery:function(l,i){if(l&1&&(bi(zI,5),bi(NI,5),bi(BI,5)),l&2){let _;fi(_=gi())&&(i.monthView=_.first),fi(_=gi())&&(i.yearView=_.first),fi(_=gi())&&(i.multiYearView=_.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[_s([KL]),xo,jn],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDateChange","_userSelection","dragStarted","dragEnded","activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag"],[3,"activeDateChange","monthSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"],[3,"activeDateChange","yearSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"]],template:function(l,i){if(l&1&&(Bt(0,VL,0,0,"ng-template",0),V(1,"div",1),Bt(2,jL,1,11)(3,UL,1,6)(4,HL,1,6),j()),l&2){let _;Fe("cdkPortalOutlet",i._calendarHeaderPortal),ue(2),Vn(2,(_=i.currentView)==="month"?2:_==="year"?3:_==="multi-year"?4:-1)}},dependencies:[gd,iI,zI,NI,BI],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let d=s;return d})(),VI={transformPanel:Qx("transformPanel",[ng("void => enter-dropdown",ig("120ms cubic-bezier(0, 0, 0.2, 1)",Jx([ud({opacity:0,transform:"scale(1, 0.8)"}),ud({opacity:1,transform:"scale(1, 1)"})]))),ng("void => enter-dialog",ig("150ms cubic-bezier(0, 0, 0.2, 1)",Jx([ud({opacity:0,transform:"scale(0.7)"}),ud({transform:"none",opacity:1})]))),ng("* => void",ig("100ms linear",ud({opacity:0})))]),fadeInCalendar:Qx("fadeInCalendar",[Kx("void",ud({opacity:0})),Kx("enter",ud({opacity:1})),ng("void => *",ig("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};var tF=new pn("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let d=wn(Qo);return()=>d.scrollStrategies.reposition()}});function iF(d){return()=>d.scrollStrategies.reposition()}var nF={provide:tF,deps:[Qo],useFactory:iF},rF=(()=>{let s=class s{constructor(r,l,i,_,C,I){this._elementRef=r,this._changeDetectorRef=l,this._globalModel=i,this._dateAdapter=_,this._rangeSelectionStrategy=C,this._subscriptions=new hs,this._animationDone=new En,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=I.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(r){let l=this._model.selection,i=r.value,_=l instanceof ja;if(_&&this._rangeSelectionStrategy){let C=this._rangeSelectionStrategy.selectionFinished(i,l,r.event);this._model.updateSelection(C,this)}else i&&(_||!this._dateAdapter.sameDate(i,l))&&this._model.add(i);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(r){this._model.updateSelection(r.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(r){this._isAnimating=r.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(r,l){this._model=r?this._globalModel.clone():this._globalModel,this._actionsPortal=r,l&&this._changeDetectorRef.detectChanges()}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(uo),_e(Tb),_e(Xo),_e(jI,8),_e(fg))},s.\u0275cmp=ft({type:s,selectors:[["mat-datepicker-content"]],viewQuery:function(l,i){if(l&1&&bi(R1,5),l&2){let _;fi(_=gi())&&(i._calendar=_.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(l,i){l&1&&uk("@transformPanel.start",function(C){return i._handleAnimationEvent(C)})("@transformPanel.done",function(C){return i._handleAnimationEvent(C)}),l&2&&(hk("@transformPanel",i._animationState),ps(i.color?"mat-"+i.color:""),Si("mat-datepicker-content-touch",i.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[jn],decls:5,vars:27,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop","id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"focus","blur","click","color"]],template:function(l,i){if(l&1&&(V(0,"div",0)(1,"mat-calendar",1),Oe("yearSelected",function(C){return i.datepicker._selectYear(C)})("monthSelected",function(C){return i.datepicker._selectMonth(C)})("viewChanged",function(C){return i.datepicker._viewChanged(C)})("_userSelection",function(C){return i._handleUserSelection(C)})("_userDragDrop",function(C){return i._handleUserDragDrop(C)}),j(),Bt(2,WL,0,0,"ng-template",2),V(3,"button",3),Oe("focus",function(){return i._closeButtonFocused=!0})("blur",function(){return i._closeButtonFocused=!1})("click",function(){return i.datepicker.close()}),$(4),j()()),l&2){let _;Si("mat-datepicker-content-container-with-custom-header",i.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",i._actionsPortal),bn("aria-modal",!0)("aria-labelledby",(_=i._dialogLabelId)!==null&&_!==void 0?_:void 0),ue(),ps(i.datepicker.panelClass),Fe("id",i.datepicker.id)("startAt",i.datepicker.startAt)("startView",i.datepicker.startView)("minDate",i.datepicker._getMinDate())("maxDate",i.datepicker._getMaxDate())("dateFilter",i.datepicker._getDateFilter())("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i._getSelected())("dateClass",i.datepicker.dateClass)("comparisonStart",i.comparisonStart)("comparisonEnd",i.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",i.startDateAccessibleName)("endDateAccessibleName",i.endDateAccessibleName),ue(),Fe("cdkPortalOutlet",i._actionsPortal),ue(),Si("cdk-visually-hidden",!i._closeButtonFocused),Fe("color",i.color||"primary"),ue(),Rt(i._closeButtonText)}},dependencies:[eI,R1,gd,M1],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[VI.transformPanel,VI.fadeInCalendar]},changeDetection:0});let d=s;return d})();var oF=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275dir=Kn({type:s,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let d=s;return d})(),aF=(()=>{let s=class s{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(r){this._disabled=r}constructor(r,l,i){this._intl=r,this._changeDetectorRef=l,this._stateChanges=hs.EMPTY;let _=Number(i);this.tabIndex=_||_===0?_:null}ngOnChanges(r){r.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(r){this.datepicker&&!this.disabled&&(this.datepicker.open(),r.stopPropagation())}_watchStateChanges(){let r=this.datepicker?this.datepicker.stateChanges:br(),l=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:br(),i=this.datepicker?zh(this.datepicker.openedStream,this.datepicker.closedStream):br();this._stateChanges.unsubscribe(),this._stateChanges=zh(this._intl.changes,r,l,i).subscribe(()=>this._changeDetectorRef.markForCheck())}};s.\u0275fac=function(l){return new(l||s)(_e(fg),_e(uo),Cm("tabindex"))},s.\u0275cmp=ft({type:s,selectors:[["mat-datepicker-toggle"]],contentQueries:function(l,i,_){if(l&1&&K0(_,oF,5),l&2){let C;fi(C=gi())&&(i._customIcon=C.first)}},viewQuery:function(l,i){if(l&1&&bi(GL,5),l&2){let _;fi(_=gi())&&(i._button=_.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(l,i){l&1&&Oe("click",function(C){return i._open(C)}),l&2&&(bn("tabindex",null)("data-mat-calendar",i.datepicker?i.datepicker.id:null),Si("mat-datepicker-toggle-active",i.datepicker&&i.datepicker.opened)("mat-accent",i.datepicker&&i.datepicker.color==="accent")("mat-warn",i.datepicker&&i.datepicker.color==="warn"))},inputs:{datepicker:[Xi.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[Xi.None,"aria-label","ariaLabel"],disabled:[Xi.HasDecoratorInputTransform,"disabled","disabled",io],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[wo,xo,jn],ngContentSelectors:$L,decls:4,vars:6,consts:[["button",""],["mat-icon-button","","type","button",3,"disabled","disableRipple"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(l,i){l&1&&($o(qL),V(0,"button",1,0),Bt(2,YL,2,0,":svg:svg",2),Co(3),j()),l&2&&(Fe("disabled",i.disabled)("disableRipple",i.disableRipple),bn("aria-haspopup",i.datepicker?"dialog":null)("aria-label",i.ariaLabel||i._intl.openCalendarLabel)("tabindex",i.disabled?-1:i.tabIndex),ue(2),Vn(2,i._customIcon?-1:2))},dependencies:[k1],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let d=s;return d})();var GI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[fg,nF],imports:[qs,RI,Lm,_b,Ul,zn,rF,aF,WI,wb]});let d=s;return d})();function sF(d,s){}var qh=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var W1=(()=>{let s=class s extends Pm{constructor(r,l,i,_,C,I,O,N){super(),this._elementRef=r,this._focusTrapFactory=l,this._config=_,this._interactivityChecker=C,this._ngZone=I,this._overlayRef=O,this._focusMonitor=N,this._platform=wn(Wn),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=wn(uo),this.attachDomPortal=q=>{this._portalOutlet.hasAttached();let ie=this._portalOutlet.attachDomPortal(q);return this._contentAttached(),ie},this._document=i,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(r){this._ariaLabelledByQueue.push(r),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(r){let l=this._ariaLabelledByQueue.indexOf(r);l>-1&&(this._ariaLabelledByQueue.splice(l,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(r){this._portalOutlet.hasAttached();let l=this._portalOutlet.attachComponentPortal(r);return this._contentAttached(),l}attachTemplatePortal(r){this._portalOutlet.hasAttached();let l=this._portalOutlet.attachTemplatePortal(r);return this._contentAttached(),l}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(r,l){this._interactivityChecker.isFocusable(r)||(r.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let i=()=>{r.removeEventListener("blur",i),r.removeEventListener("mousedown",i),r.removeAttribute("tabindex")};r.addEventListener("blur",i),r.addEventListener("mousedown",i)})),r.focus(l)}_focusByCssSelector(r,l){let i=this._elementRef.nativeElement.querySelector(r);i&&this._forceFocus(i,l)}_trapFocus(){let r=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||r.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(l=>{l||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let r=this._config.restoreFocus,l=null;if(typeof r=="string"?l=this._document.querySelector(r):typeof r=="boolean"?l=r?this._elementFocusedBeforeDialogWasOpened:null:r&&(l=r),this._config.restoreFocus&&l&&typeof l.focus=="function"){let i=jh(),_=this._elementRef.nativeElement;(!i||i===this._document.body||i===_||_.contains(i))&&(this._focusMonitor?(this._focusMonitor.focusVia(l,this._closeInteractionType),this._closeInteractionType=null):l.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let r=this._elementRef.nativeElement,l=jh();return r===l||r.contains(l)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=jh()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(cg),_e(un,8),_e(qh),_e(lg),_e(Fi),_e(Hl),_e(Vl))},s.\u0275cmp=ft({type:s,selectors:[["cdk-dialog-container"]],viewQuery:function(l,i){if(l&1&&bi(gd,7),l&2){let _;fi(_=gi())&&(i._portalOutlet=_.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(l,i){l&2&&bn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledByQueue[0])("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},standalone:!0,features:[Ro,jn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(l,i){l&1&&Bt(0,sF,0,0,"ng-template",0)},dependencies:[gd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let d=s;return d})(),gg=class{constructor(s,u){this.overlayRef=s,this.config=u,this.closed=new En,this.disableClose=u.disableClose,this.backdropClick=s.backdropClick(),this.keydownEvents=s.keydownEvents(),this.outsidePointerEvents=s.outsidePointerEvents(),this.id=u.id,this.keydownEvents.subscribe(r=>{r.keyCode===27&&!this.disableClose&&!Tm(r)&&(r.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=s.detachments().subscribe(()=>{u.closeOnOverlayDetachments!==!1&&this.close()})}close(s,u){if(this.containerInstance){let r=this.closed;this.containerInstance._closeInteractionType=u?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),r.next(s),r.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(s="",u=""){return this.overlayRef.updateSize({width:s,height:u}),this}addPanelClass(s){return this.overlayRef.addPanelClass(s),this}removePanelClass(s){return this.overlayRef.removePanelClass(s),this}},lF=new pn("DialogScrollStrategy",{providedIn:"root",factory:()=>{let d=wn(Qo);return()=>d.scrollStrategies.block()}}),cF=new pn("DialogData"),dF=new pn("DefaultDialogConfig");var hF=0,G1=(()=>{let s=class s{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(r,l,i,_,C,I){this._overlay=r,this._injector=l,this._defaultOptions=i,this._parentDialog=_,this._overlayContainer=C,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new En,this._afterOpenedAtThisLevel=new En,this._ariaHiddenElements=new Map,this.afterAllClosed=G0(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(us(void 0))),this._scrollStrategy=I}open(r,l){let i=this._defaultOptions||new qh;l=Zi(Zi({},i),l),l.id=l.id||`cdk-dialog-${hF++}`,l.id&&this.getDialogById(l.id);let _=this._getOverlayConfig(l),C=this._overlay.create(_),I=new gg(C,l),O=this._attachContainer(C,I,l);return I.containerInstance=O,this._attachDialogContent(r,I,O,l),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(I),I.closed.subscribe(()=>this._removeOpenDialog(I,!0)),this.afterOpened.next(I),I}closeAll(){H1(this.openDialogs,r=>r.close())}getDialogById(r){return this.openDialogs.find(l=>l.id===r)}ngOnDestroy(){H1(this._openDialogsAtThisLevel,r=>{r.config.closeOnDestroy===!1&&this._removeOpenDialog(r,!1)}),H1(this._openDialogsAtThisLevel,r=>r.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(r){let l=new Om({positionStrategy:r.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:r.scrollStrategy||this._scrollStrategy(),panelClass:r.panelClass,hasBackdrop:r.hasBackdrop,direction:r.direction,minWidth:r.minWidth,minHeight:r.minHeight,maxWidth:r.maxWidth,maxHeight:r.maxHeight,width:r.width,height:r.height,disposeOnNavigation:r.closeOnNavigation});return r.backdropClass&&(l.backdropClass=r.backdropClass),l}_attachContainer(r,l,i){let _=i.injector||i.viewContainerRef?.injector,C=[{provide:qh,useValue:i},{provide:gg,useValue:l},{provide:Hl,useValue:r}],I;i.container?typeof i.container=="function"?I=i.container:(I=i.container.type,C.push(...i.container.providers(i))):I=W1;let O=new fd(I,i.viewContainerRef,Fa.create({parent:_||this._injector,providers:C}),i.componentFactoryResolver);return r.attach(O).instance}_attachDialogContent(r,l,i,_){if(r instanceof Nh){let C=this._createInjector(_,l,i,void 0),I={$implicit:_.data,dialogRef:l};_.templateContext&&(I=Zi(Zi({},I),typeof _.templateContext=="function"?_.templateContext():_.templateContext)),i.attachTemplatePortal(new Wh(r,null,I,C))}else{let C=this._createInjector(_,l,i,this._injector),I=i.attachComponentPortal(new fd(r,_.viewContainerRef,C,_.componentFactoryResolver));l.componentRef=I,l.componentInstance=I.instance}}_createInjector(r,l,i,_){let C=r.injector||r.viewContainerRef?.injector,I=[{provide:cF,useValue:r.data},{provide:gg,useValue:l}];return r.providers&&(typeof r.providers=="function"?I.push(...r.providers(l,r,i)):I.push(...r.providers)),r.direction&&(!C||!C.get(jl,null,{optional:!0}))&&I.push({provide:jl,useValue:{value:r.direction,change:br()}}),Fa.create({parent:C||_,providers:I})}_removeOpenDialog(r,l){let i=this.openDialogs.indexOf(r);i>-1&&(this.openDialogs.splice(i,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((_,C)=>{_?C.setAttribute("aria-hidden",_):C.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),l&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let r=this._overlayContainer.getContainerElement();if(r.parentElement){let l=r.parentElement.children;for(let i=l.length-1;i>-1;i--){let _=l[i];_!==r&&_.nodeName!=="SCRIPT"&&_.nodeName!=="STYLE"&&!_.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(_,_.getAttribute("aria-hidden")),_.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}};s.\u0275fac=function(l){return new(l||s)(st(Qo),st(Fa),st(dF,8),st(s,12),st(Rm),st(lF))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function H1(d,s){let u=d.length;for(;u--;)s(d[u])}var qI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[G1],imports:[Lm,Ul,_b,Ul]});let d=s;return d})();function uF(d,s){}var _g=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},q1="mdc-dialog--open",$I="mdc-dialog--opening",YI="mdc-dialog--closing",mF=150,pF=75,fF=(()=>{let s=class s extends W1{constructor(r,l,i,_,C,I,O,N,q){super(r,l,i,_,C,I,O,q),this._animationMode=N,this._animationStateChanged=new an,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?XI(this._config.enterAnimationDuration)??mF:0,this._exitAnimationDuration=this._animationsEnabled?XI(this._config.exitAnimationDuration)??pF:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(ZI,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add($I,q1)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(q1),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(q1),this._animationsEnabled?(this._hostElement.style.setProperty(ZI,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(YI)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(r){this._actionSectionCount+=r,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove($I,YI)}_waitForAnimationToComplete(r,l){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(l,r)}_requestAnimationFrame(r){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(r):r()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(r){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:r})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(r){let l=super.attachComponentPortal(r);return l.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),l}};s.\u0275fac=function(l){return new(l||s)(_e(sn),_e(cg),_e(un,8),_e(_g),_e(lg),_e(Fi),_e(Hl),_e(to,8),_e(Vl))},s.\u0275cmp=ft({type:s,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(l,i){l&2&&(Bl("id",i._config.id),bn("aria-modal",i._config.ariaModal)("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledByQueue[0])("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Si("_mat-animation-noopable",!i._animationsEnabled)("mat-mdc-dialog-container-with-actions",i._actionSectionCount>0))},standalone:!0,features:[Ro,jn],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Bt(2,uF,0,0,"ng-template",2),j()())},dependencies:[gd],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let d=s;return d})(),ZI="--mat-dialog-transition-duration";function XI(d){return d==null?null:typeof d=="number"?d:d.endsWith("ms")?sg(d.substring(0,d.length-2)):d.endsWith("s")?sg(d.substring(0,d.length-1))*1e3:d==="0"?0:null}var Eb=function(d){return d[d.OPEN=0]="OPEN",d[d.CLOSING=1]="CLOSING",d[d.CLOSED=2]="CLOSED",d}(Eb||{}),Nm=class{constructor(s,u,r){this._ref=s,this._containerInstance=r,this._afterOpened=new En,this._beforeClosed=new En,this._state=Eb.OPEN,this.disableClose=u.disableClose,this.id=s.id,s.addPanelClass("mat-mdc-dialog-panel"),r._animationStateChanged.pipe(ga(l=>l.state==="opened"),La(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),r._animationStateChanged.pipe(ga(l=>l.state==="closed"),La(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),s.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),zh(this.backdropClick(),this.keydownEvents().pipe(ga(l=>l.keyCode===27&&!this.disableClose&&!Tm(l)))).subscribe(l=>{this.disableClose||(l.preventDefault(),gF(this,l.type==="keydown"?"keyboard":"mouse"))})}close(s){this._result=s,this._containerInstance._animationStateChanged.pipe(ga(u=>u.state==="closing"),La(1)).subscribe(u=>{this._beforeClosed.next(s),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),u.totalTime+100)}),this._state=Eb.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(s){let u=this._ref.config.positionStrategy;return s&&(s.left||s.right)?s.left?u.left(s.left):u.right(s.right):u.centerHorizontally(),s&&(s.top||s.bottom)?s.top?u.top(s.top):u.bottom(s.bottom):u.centerVertically(),this._ref.updatePosition(),this}updateSize(s="",u=""){return this._ref.updateSize(s,u),this}addPanelClass(s){return this._ref.addPanelClass(s),this}removePanelClass(s){return this._ref.removePanelClass(s),this}getState(){return this._state}_finishDialogClose(){this._state=Eb.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function gF(d,s,u){return d._closeInteractionType=s,d.close(u)}var $1=new pn("MatMdcDialogData"),_F=new pn("mat-mdc-dialog-default-options"),bF=new pn("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let d=wn(Qo);return()=>d.scrollStrategies.block()}});var yF=0,Vm=(()=>{let s=class s{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let r=this._parentDialog;return r?r._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(r,l,i,_,C,I,O,N){this._overlay=r,this._defaultOptions=_,this._scrollStrategy=C,this._parentDialog=I,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new En,this._afterOpenedAtThisLevel=new En,this.dialogConfigClass=_g,this.afterAllClosed=G0(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(us(void 0))),this._dialog=l.get(G1),this._dialogRefConstructor=Nm,this._dialogContainerType=fF,this._dialogDataToken=$1}open(r,l){let i;l=Zi(Zi({},this._defaultOptions||new _g),l),l.id=l.id||`mat-mdc-dialog-${yF++}`,l.scrollStrategy=l.scrollStrategy||this._scrollStrategy();let _=this._dialog.open(r,Ra(Zi({},l),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:l},{provide:qh,useValue:l}]},templateContext:()=>({dialogRef:i}),providers:(C,I,O)=>(i=new this._dialogRefConstructor(C,l,O),i.updatePosition(l?.position),[{provide:this._dialogContainerType,useValue:O},{provide:this._dialogDataToken,useValue:I.data},{provide:this._dialogRefConstructor,useValue:i}])}));return i.componentRef=_.componentRef,i.componentInstance=_.componentInstance,this.openDialogs.push(i),this.afterOpened.next(i),i.afterClosed().subscribe(()=>{let C=this.openDialogs.indexOf(i);C>-1&&(this.openDialogs.splice(C,1),this.openDialogs.length||this._getAfterAllClosed().next())}),i}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(r){return this.openDialogs.find(l=>l.id===r)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(r){let l=r.length;for(;l--;)r[l].close()}};s.\u0275fac=function(l){return new(l||s)(st(Qo),st(Fa),st(_i,8),st(_F,8),st(bF),st(s,12),st(Rm),st(to,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),vF=0;var QI=(()=>{let s=class s{constructor(r,l,i){this._dialogRef=r,this._elementRef=l,this._dialog=i}ngOnInit(){this._dialogRef||(this._dialogRef=xF(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}};s.\u0275fac=function(l){return new(l||s)(_e(Nm,8),_e(sn),_e(Vm))},s.\u0275dir=Kn({type:s,standalone:!0});let d=s;return d})(),KI=(()=>{let s=class s extends QI{constructor(){super(...arguments),this.id=`mat-mdc-dialog-title-${vF++}`}_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}};s.\u0275fac=(()=>{let r;return function(i){return(r||(r=wm(s)))(i||s)}})(),s.\u0275dir=Kn({type:s,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(l,i){l&2&&Bl("id",i.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],standalone:!0,features:[Ro]});let d=s;return d})(),JI=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275dir=Kn({type:s,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],standalone:!0});let d=s;return d})(),eT=(()=>{let s=class s extends QI{_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}};s.\u0275fac=(()=>{let r;return function(i){return(r||(r=wm(s)))(i||s)}})(),s.\u0275dir=Kn({type:s,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(l,i){l&2&&Si("mat-mdc-dialog-actions-align-start",i.align==="start")("mat-mdc-dialog-actions-align-center",i.align==="center")("mat-mdc-dialog-actions-align-end",i.align==="end")},inputs:{align:"align"},standalone:!0,features:[Ro]});let d=s;return d})();function xF(d,s){let u=d.nativeElement.parentElement;for(;u&&!u.classList.contains("mat-mdc-dialog-container");)u=u.parentElement;return u?s.find(r=>r.id===u.id):null}var tT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[Vm],imports:[qI,Lm,Ul,zn,zn]});let d=s;return d})();var iT=(()=>{let s=class s{constructor(r){this.router=r,setTimeout(()=>{this.router.navigate(["started"])},4e3)}};s.\u0275fac=function(l){return new(l||s)(_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-landing-page"]],decls:3,vars:0,consts:[["gifElement",""],[1,"container"],["src","assets/new/ti.gif","alt","Loading...",1,"gif-loader"]],template:function(l,i){l&1&&(V(0,"div",1),Me(1,"img",2,0),j())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}"]});let d=s;return d})();function wF(d,s){if(d&1){let u=Kt();V(0,"div",7)(1,"div",8),$(2),j(),Me(3,"br")(4,"br"),V(5,"div")(6,"label",9),Oe("click",function(){let l=_t(u).$implicit,i=dt();return bt(i.selectOnlyOne(l))}),Me(7,"input",10),j()()()}if(d&2){let u=s.$implicit;ue(2),Rt(u.languages),ue(4),Si("checked",u.isChecked),ue(),Fe("checked",u.isChecked)}}var nT=(()=>{let s=class s{constructor(r){this.router=r,this.Language=[{languages:"English",isChecked:!1},{languages:"\u0939\u093F\u0902\u0926\u0940",isChecked:!1},{languages:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41",isChecked:!1},{languages:"\u0C95\u0CA8\u0CCD\u0CA8\u0CA1",isChecked:!1},{languages:"\u0627\u0631\u062F\u0648",isChecked:!1}]}toggleCheckbox(r){r.isChecked?r.isChecked=!1:r.isChecked=!0}selectOnlyOne(r){this.Language.forEach(l=>{l.isChecked=!1}),r.isChecked=!0,console.log(r.languages)}submit(){this.router.navigate(["log-in"])}};s.\u0275fac=function(l){return new(l||s)(_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-language"]],decls:14,vars:1,consts:[[1,"container"],[1,"sub-container"],[1,"select-language"],["src","assets\\logo\\language logo.png"],["class","Language-div",4,"ngFor","ngForOf"],[1,"btn"],[3,"click"],[1,"Language-div"],[1,"language-text"],[1,"custom-checkbox",3,"click"],["type","checkbox",3,"checked"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),$(4,"Select Language"),j(),Me(5,"img",3),j(),Me(6,"br")(7,"br"),Bt(8,wF,8,4,"div",4),Me(9,"br")(10,"br"),V(11,"div",5)(12,"button",6),Oe("click",function(){return i.submit()}),$(13,"Continue"),j()()()()),l&2&&(ue(8),Fe("ngForOf",i.Language))},dependencies:[yr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:90%;position:relative;top:10%;left:5%}.select-language[_ngcontent-%COMP%]{display:flex;justify-content:space-between}span[_ngcontent-%COMP%]{font-size:1.4rem;font-family:inter;font-weight:500}.Language-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.language-text[_ngcontent-%COMP%]{font-size:1.3rem;font-family:inter;font-weight:500}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:#d16611}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:90%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}']});let d=s;return d})();var yn="https://appsvc-apibackend-dev.azurewebsites.net/v1.0/";var rT=(()=>{let s=class s{constructor(r){this.http=r,this.apiUrl=yn,this.api=this.apiUrl+"providers/provider-auth/signup"}setLog(r){console.log(r);let l={phone:r};console.log(l),this.http.post(this.api,l).subscribe(i=>{console.log(i)},i=>{console.log(i)})}setDefult(){this.api="",this.apiUrl=""}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Db=(()=>{let s=class s{constructor(r,l){this.dialogRef=r,this.data=l,this.content="",this.content=l.content,setTimeout(()=>{this.onNoClick()},3e3)}onNoClick(){this.dialogRef.close()}};s.\u0275fac=function(l){return new(l||s)(_e(Nm),_e($1))},s.\u0275cmp=ft({type:s,selectors:[["app-demo"]],inputs:{content:"content"},decls:3,vars:1,consts:[[1,"mat-dialog-container","bottom-dialog-container"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"p"),$(2),j()()),l&2&&(ue(2),Rt(i.content))},styles:[".mat-dialog-container[_ngcontent-%COMP%]{position:fixed;bottom:2rem;left:5%;width:90%;height:auto;border-radius:16px;color:#fff;background-color:#0d0c0cad;padding:8px;display:flex;align-items:center;justify-content:center}"]});let d=s;return d})();var Lr=(()=>{let s=class s{constructor(r){this.dialog=r}openDialog(r){let l={content:r};this.dialog.open(Db,{width:"100%",height:"auto",panelClass:"bottom-dialog-container",data:l})}};s.\u0275fac=function(l){return new(l||s)(st(Vm))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Jn=(()=>{let s=class s{constructor(r,l,i){this.http=r,this.router=l,this.dialogService=i,this.apiUrl=yn,this.userDetails=[],this.workDetails=[],this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.name="",this.experience=0,this.selectedSubCategories=[],this.userFromServer=[]}setLogInApi(){this.api=this.apiUrl+"providers/provider-auth/login",console.log(this.api)}setSignUpApi(){this.api=this.apiUrl+"providers/provider-auth/signup",console.log(this.api)}setLog(r){console.log(r),console.log(this.api);let l={phone:r};console.log(l),this.http.post(this.api,l).subscribe(i=>{console.log(i),this.responseOtp=i,this.userNumber=r,this.router.navigate(["verify"])},i=>{console.log(i),console.log(i.error),console.log(i.error.message),i.error.message==="User does not exist. Please sign up first."?(alert("Account was not found. Please signUp first."),this.router.navigate(["selectAccount"])):alert("something went wrong.Please retry again")})}showOtp(){alert(this.responseOtp.otp)}resendOtp(){console.log(this.userNumber),console.log(this.api);let r={phone:this.userNumber};console.log(r),this.http.post(this.api,r).subscribe(l=>{console.log(l)},l=>{console.log(l)})}verifyOtp(r){let l={otp:r,phone:this.userNumber},i=this.apiUrl+"providers/provider-auth/verify-otp";return this.http.post(i,l)}setUserInLocalStroage(r){localStorage.setItem("providerId",r)}setUser(r){this.userDetails.push({number:this.userNumber}),console.log(this.userDetails),localStorage.setItem("providerId",r),this.userId=localStorage.getItem("providerId")}getUserId(){let r=localStorage.getItem("providerId");return console.log(r),br(r)}removeUser(){localStorage.removeItem("providerId")}setWork(r,l){this.workName=r,this.workId=l}setSubCat(r){console.log(r),this.selectedSubCategories.push(r),console.log(this.selectedSubCategories)}setAge(r){console.log(r),this.age=r,console.log(this.age)}setExperiance(r){console.log(r),this.experience=r}setWorkDetails(){console.log(this.selectedSubCategories);let r=[{categoryId:this.workId,experience:this.experience,subcategoryId:this.selectedSubCategories}];this.workDetails.push(r),console.log(this.workDetails.flat())}getSubCategory(){let r=this.apiUrl+`core/sub-categories/category/${this.categoryId}`;return this.http.get(r)}sendWorkDetails(){let r=this.apiUrl+"providers/provider-work",l=this.workDetails.flat(),_={providerId:localStorage.getItem("providerId"),works:l};return console.log(_),this.http.post(r,_)}UserDetails(r){let l=[];r.forEach((_,C)=>{l.push(C=_)}),console.log(l),console.log(r);let i=this.apiUrl+"providers/provider-details";this.http.post(i,r).subscribe(_=>{console.log("Success",_),this.userFromServer=_,this.router.navigate(["aadharVerify"])},_=>{console.error("Error",_),_.error instanceof ErrorEvent?alert("A network error occurred. Please try again later."):alert("An error occurred. Please try again later."),console.error(`Backend returned code ${_.status}, body was: `,_.error)})}formatingResponse(r){console.log(r.work),console.log(r.work);let i=JSON.parse(r.work).flat();this.userFromServer.work=i,console.log(this.userFromServer)}updateUserWork(r,l){console.log(r);let i=localStorage.getItem("providerId");console.log(l);let _={providerId:i,works:r};console.log("work in service",_);let C=this.apiUrl+"providers/provider-work";this.http.post(C,_).subscribe(I=>{console.log(I),this.dialogService.openDialog("Service has been updated"),this.router.navigate(["home"])},I=>{console.log(I)})}getPhoneNumber(){let r=localStorage.getItem("providerId"),l=this.apiUrl+`providers/provider-auth/${r}`;return this.http.get(l).subscribe(i=>{this.userNumber=i.phone,console.log(this.userNumber)},i=>{console.log(i)}),this.userNumber}setDefult(){this.userDetails=[],this.workDetails=[],this.userNumber=null,this.userId="",this.alreadyHasAccount=!1,this.isAccountVerify=!0,this.api="",this.responseOtp="",this.name="",this.pincode="",this.radius=void 0,this.workName="",this.workId="",this.age="",this.gender="",this.experience=0,this.selectedSubCategories=[],this.categoryId="",this.userFromServer=[]}};s.\u0275fac=function(l){return new(l||s)(st(Wi),st(Nt),st(Lr))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Ha=d=>({"full-screen":d}),SF=(d,s)=>({"border-radius":d,"background-color":s}),MF=(d,s,u,r)=>({"border-top-color":d,"border-right-color":s,"border-bottom-color":u,"border-left-color":r}),rr=d=>({"background-color":d}),kF=d=>({color:d});function IF(d,s){if(d&1&&Me(0,"div",14),d&2){let u=dt(2);Fe("ngClass",li(2,Ha,u.config.fullScreenBackdrop===!0))("ngStyle",fk(4,MF,u.config.secondaryColour,u.config.secondaryColour,u.config.secondaryColour,u.config.primaryColour))}}function TF(d,s){if(d&1&&(V(0,"div",15),Me(1,"div",16)(2,"div",17)(3,"div",18)(4,"div",19)(5,"div",20)(6,"div",21)(7,"div",22)(8,"div",23)(9,"div",24),j()),d&2){let u=dt(2);Fe("ngClass",li(10,Ha,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",li(12,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(14,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(16,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(18,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(20,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(22,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(24,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(26,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(28,rr,u.config.primaryColour))}}function EF(d,s){if(d&1&&Me(0,"div",25),d&2){let u=dt(2);Fe("ngStyle",li(2,rr,u.config.primaryColour))("ngClass",li(4,Ha,u.config.fullScreenBackdrop===!0))}}function DF(d,s){if(d&1&&(V(0,"div",26),Me(1,"div",27)(2,"div",28)(3,"div",29)(4,"div",30)(5,"div",31),j()),d&2){let u=dt(2);Fe("ngClass",li(6,Ha,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",li(8,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(10,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(12,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(14,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(16,rr,u.config.primaryColour))}}function AF(d,s){if(d&1&&(V(0,"div",32),Me(1,"div",33)(2,"div",34),j()),d&2){let u=dt(2);Fe("ngClass",li(3,Ha,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",li(5,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(7,rr,u.config.secondaryColour))}}function PF(d,s){if(d&1&&(V(0,"div",35),Me(1,"div",36)(2,"div",37),j()),d&2){let u=dt(2);Fe("ngClass",li(3,Ha,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",li(5,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(7,rr,u.config.secondaryColour))}}function OF(d,s){if(d&1&&Me(0,"div",38),d&2){let u=dt(2);Fe("ngClass",li(2,Ha,u.config.fullScreenBackdrop===!0))("ngStyle",li(4,rr,u.config.primaryColour))}}function RF(d,s){if(d&1&&(V(0,"div",39),Me(1,"div",40)(2,"div",41),j()),d&2){let u=dt(2);Fe("ngClass",li(3,Ha,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",li(5,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(7,rr,u.config.secondaryColour))}}function LF(d,s){if(d&1&&Me(0,"div",42),d&2){let u=dt(2);Fe("ngClass",li(2,Ha,u.config.fullScreenBackdrop===!0))("ngStyle",li(4,kF,u.config.primaryColour))}}function FF(d,s){if(d&1&&Me(0,"div",43),d&2){let u=dt(2);Fe("ngClass",li(1,Ha,u.config.fullScreenBackdrop===!0))}}function zF(d,s){if(d&1&&(V(0,"div",44),Me(1,"div",45)(2,"div",46)(3,"div",47),j()),d&2){let u=dt(2);Fe("ngClass",li(4,Ha,u.config.fullScreenBackdrop===!0)),ue(),Fe("ngStyle",li(6,rr,u.config.primaryColour)),ue(),Fe("ngStyle",li(8,rr,u.config.secondaryColour)),ue(),Fe("ngStyle",li(10,rr,u.config.tertiaryColour))}}function BF(d,s){d&1&&qx(0)}function NF(d,s){if(d&1&&(cd(0),Bt(1,BF,1,0,"ng-container",48),dd()),d&2){let u=dt(2);ue(),Fe("ngTemplateOutlet",u.template)}}function VF(d,s){if(d&1&&(V(0,"div"),Me(1,"div",1),V(2,"div",2),Bt(3,IF,1,9,"div",3)(4,TF,10,30,"div",4)(5,EF,1,6,"div",5)(6,DF,6,18,"div",6)(7,AF,3,9,"div",7)(8,PF,3,9,"div",8)(9,OF,1,6,"div",9)(10,RF,3,9,"div",10)(11,LF,1,6,"div",11)(12,FF,1,3,"div",12)(13,zF,4,12,"div",13)(14,NF,2,1,"ng-container",0),j()()),d&2){let u=dt();ue(),Fe("ngClass",li(14,Ha,u.config.fullScreenBackdrop===!0))("ngStyle",$x(16,SF,u.config.backdropBorderRadius,u.config.backdropBackgroundColour)),ue(),Fe("ngSwitch",u.config.animationType),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.circle),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.cubeGrid),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.rotatingPlane),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.rectangleBounce),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.wanderingCubes),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.doubleBounce),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.pulse),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.chasingDots),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.circleSwish),ue(),Fe("ngSwitchCase",u.ngxLoadingAnimationTypes.none),ue(2),Fe("ngIf",u.template)}}var Ab=class{constructor(s={}){this.backdropBorderRadius=s.backdropBorderRadius,this.backdropBackgroundColour=s.backdropBackgroundColour,this.fullScreenBackdrop=s.fullScreenBackdrop,this.animationType=s.animationType,this.primaryColour=s.primaryColour,this.secondaryColour=s.secondaryColour,this.tertiaryColour=s.tertiaryColour}},oT={chasingDots:"chasing-dots",circle:"sk-circle",circleSwish:"circleSwish",cubeGrid:"sk-cube-grid",doubleBounce:"double-bounce",none:"none",pulse:"pulse",rectangleBounce:"rectangle-bounce",rotatingPlane:"rotating-plane",threeBounce:"three-bounce",wanderingCubes:"wandering-cubes"},jF=(()=>{let s=class s{constructor(r){this.config=r,this.loadingConfig=this.config||new Ab}};s.\u0275fac=function(l){return new(l||s)(st("loadingConfig",8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Pb=(()=>{let s=class s{constructor(r){this.LoadingService=r,this.show=!1,this.config=new Ab,this.defaultConfig={animationType:oT.threeBounce,backdropBackgroundColour:"rgba(0, 0, 0, 0.3)",backdropBorderRadius:"0px",fullScreenBackdrop:!1,primaryColour:"#ffffff",secondaryColour:"#ffffff",tertiaryColour:"#ffffff"},this.ngxLoadingAnimationTypes=oT}ngOnInit(){this.setupConfig()}setupConfig(){for(let r in this.defaultConfig)this.config[r]==null&&(this.config[r]=this.LoadingService.loadingConfig[r]!=null?this.LoadingService.loadingConfig[r]:this.defaultConfig[r])}};s.\u0275fac=function(l){return new(l||s)(_e(jF))},s.\u0275cmp=ft({type:s,selectors:[["ngx-loading"]],inputs:{show:"show",config:"config",template:"template"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"backdrop",3,"ngClass","ngStyle"],[3,"ngSwitch"],["class","spinner-circle",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","sk-cube-grid",3,"ngClass",4,"ngSwitchCase"],["class","spinner-sk-rotateplane",3,"ngStyle","ngClass",4,"ngSwitchCase"],["class","spinner-rectangle-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-wandering-cubes",3,"ngClass",4,"ngSwitchCase"],["class","spinner-double-bounce",3,"ngClass",4,"ngSwitchCase"],["class","spinner-pulse",3,"ngClass","ngStyle",4,"ngSwitchCase"],["class","spinner-chasing-dots",3,"ngClass",4,"ngSwitchCase"],["class","spinner-circle-swish",3,"ngClass","ngStyle",4,"ngSwitchCase"],[3,"ngClass",4,"ngSwitchCase"],["class","spinner-three-bounce",3,"ngClass",4,"ngSwitchDefault"],[1,"spinner-circle",3,"ngClass","ngStyle"],[1,"sk-cube-grid",3,"ngClass"],[1,"sk-cube","sk-cube1",3,"ngStyle"],[1,"sk-cube","sk-cube2",3,"ngStyle"],[1,"sk-cube","sk-cube3",3,"ngStyle"],[1,"sk-cube","sk-cube4",3,"ngStyle"],[1,"sk-cube","sk-cube5",3,"ngStyle"],[1,"sk-cube","sk-cube6",3,"ngStyle"],[1,"sk-cube","sk-cube7",3,"ngStyle"],[1,"sk-cube","sk-cube8",3,"ngStyle"],[1,"sk-cube","sk-cube9",3,"ngStyle"],[1,"spinner-sk-rotateplane",3,"ngStyle","ngClass"],[1,"spinner-rectangle-bounce",3,"ngClass"],[1,"rect1",3,"ngStyle"],[1,"rect2",3,"ngStyle"],[1,"rect3",3,"ngStyle"],[1,"rect4",3,"ngStyle"],[1,"rect5",3,"ngStyle"],[1,"spinner-wandering-cubes",3,"ngClass"],[1,"cube1",3,"ngStyle"],[1,"cube2",3,"ngStyle"],[1,"spinner-double-bounce",3,"ngClass"],[1,"double-bounce1",3,"ngStyle"],[1,"double-bounce2",3,"ngStyle"],[1,"spinner-pulse",3,"ngClass","ngStyle"],[1,"spinner-chasing-dots",3,"ngClass"],[1,"dot1",3,"ngStyle"],[1,"dot2",3,"ngStyle"],[1,"spinner-circle-swish",3,"ngClass","ngStyle"],[3,"ngClass"],[1,"spinner-three-bounce",3,"ngClass"],[1,"bounce1",3,"ngStyle"],[1,"bounce2",3,"ngStyle"],[1,"bounce3",3,"ngStyle"],[4,"ngTemplateOutlet"]],template:function(l,i){l&1&&Bt(0,VF,15,19,"div",0),l&2&&Fe("ngIf",i.show)},dependencies:[So,cr,nb,ib,yk,vk,xk],styles:['.backdrop[_ngcontent-%COMP%]{z-index:1999;position:absolute;inset:0;background-color:#0000004d}.spinner-circle[_ngcontent-%COMP%], .spinner-circle[_ngcontent-%COMP%]:after{border-radius:50%;width:10em;height:10em}.spinner-circle[_ngcontent-%COMP%]{font-size:6px;border-top:1.1em solid rgba(255,255,255,.2);border-right:1.1em solid rgba(255,255,255,.2);border-bottom:1.1em solid rgba(255,255,255,.2);border-left:1.1em solid #ffffff;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load8 1.1s infinite linear;animation:_ngcontent-%COMP%_load8 1.1s infinite linear}@-webkit-keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load8{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.spinner-circle-swish[_ngcontent-%COMP%]{font-size:60px;overflow:hidden;width:1em;height:1em;border-radius:50%;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:_ngcontent-%COMP%_load6 1.7s infinite ease;animation:_ngcontent-%COMP%_load6 1.7s infinite ease}@-webkit-keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(0deg)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(0)}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}to{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em;transform:rotate(360deg)}}.sk-cube-grid[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube[_ngcontent-%COMP%]{width:33%;height:33%;background-color:#333;float:left;-webkit-animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubeGridScaleDelay 1.3s infinite ease-in-out}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube1[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube2[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube3[_ngcontent-%COMP%]{-webkit-animation-delay:.4s;animation-delay:.4s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube4[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube5[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube6[_ngcontent-%COMP%]{-webkit-animation-delay:.3s;animation-delay:.3s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube7[_ngcontent-%COMP%]{-webkit-animation-delay:0s;animation-delay:0s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube8[_ngcontent-%COMP%]{-webkit-animation-delay:.1s;animation-delay:.1s}.sk-cube-grid[_ngcontent-%COMP%]   .sk-cube9[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}@keyframes _ngcontent-%COMP%_sk-cubeGridScaleDelay{0%,70%,to{-webkit-transform:scale3D(1,1,1);transform:scaleZ(1)}35%{-webkit-transform:scale3D(0,0,1);transform:scale3D(0,0,1)}}.spinner-double-bounce[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.double-bounce1[_ngcontent-%COMP%], .double-bounce2[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;background-color:#333;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.double-bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-pulse[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#333;position:absolute;inset:0;margin:auto;z-index:2000;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-scaleout 1s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0)}to{-webkit-transform:scale(1);opacity:0}}@keyframes _ngcontent-%COMP%_sk-scaleout{0%{-webkit-transform:scale(0);transform:scale(0)}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.spinner-three-bounce[_ngcontent-%COMP%]{width:70px;text-align:center;position:absolute;inset:0;height:20px;margin:auto;z-index:2000}.spinner-three-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#fff;border-radius:100%;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-bouncedelay 1.4s infinite ease-in-out both}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce1[_ngcontent-%COMP%]{-webkit-animation-delay:-.32s;animation-delay:-.32s}.spinner-three-bounce[_ngcontent-%COMP%]   .bounce2[_ngcontent-%COMP%]{-webkit-animation-delay:-.16s;animation-delay:-.16s}@-webkit-keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-sk-rotateplane[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000;-webkit-animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-rotateplane 1.2s infinite ease-in-out}@-webkit-keyframes _ngcontent-%COMP%_sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}to{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes _ngcontent-%COMP%_sk-rotateplane{0%{transform:perspective(120px) rotateX(0) rotateY(0);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}.spinner-rectangle-bounce[_ngcontent-%COMP%]{width:50px;height:40px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.spinner-rectangle-bounce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:#fff;height:100%;width:6px;display:inline-block;-webkit-animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-stretchdelay 1.2s infinite ease-in-out}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect2[_ngcontent-%COMP%]{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect3[_ngcontent-%COMP%]{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect4[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}.spinner-rectangle-bounce[_ngcontent-%COMP%]   .rect5[_ngcontent-%COMP%]{-webkit-animation-delay:-.8s;animation-delay:-.8s}@-webkit-keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{-webkit-transform:scaleY(.4)}20%{-webkit-transform:scaleY(1)}}@keyframes _ngcontent-%COMP%_sk-stretchdelay{0%,40%,to{transform:scaleY(.4);-webkit-transform:scaleY(.4)}20%{transform:scaleY(1);-webkit-transform:scaleY(1)}}.spinner-wandering-cubes[_ngcontent-%COMP%]{width:60px;height:58px;font-size:10px;text-align:center;position:absolute;inset:0;margin:auto;z-index:2000}.cube1[_ngcontent-%COMP%], .cube2[_ngcontent-%COMP%]{background-color:#fff;width:15px;height:15px;position:absolute;top:0;left:0;-webkit-animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-cubemove 1.8s infinite ease-in-out}.cube2[_ngcontent-%COMP%]{-webkit-animation-delay:-.9s;animation-delay:-.9s}@-webkit-keyframes _ngcontent-%COMP%_sk-cubemove{25%{-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{-webkit-transform:rotate(-360deg)}}@keyframes _ngcontent-%COMP%_sk-cubemove{25%{transform:translate(42px) rotate(-90deg) scale(.5);-webkit-transform:translateX(42px) rotate(-90deg) scale(.5)}50%{transform:translate(42px) translateY(42px) rotate(-179deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-179deg)}50.1%{transform:translate(42px) translateY(42px) rotate(-180deg);-webkit-transform:translateX(42px) translateY(42px) rotate(-180deg)}75%{transform:translate(0) translateY(42px) rotate(-270deg) scale(.5);-webkit-transform:translateX(0px) translateY(42px) rotate(-270deg) scale(.5)}to{transform:rotate(-360deg);-webkit-transform:rotate(-360deg)}}.sk-circle[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;left:0;top:0}.sk-circle[_ngcontent-%COMP%]   .sk-child[_ngcontent-%COMP%]:before{content:"";display:block;margin:0 auto;width:15%;height:15%;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both;animation:_ngcontent-%COMP%_sk-circleBounceDelay 1.2s infinite ease-in-out both}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]{-webkit-transform:rotate(30deg);-ms-transform:rotate(30deg);transform:rotate(30deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]{-webkit-transform:rotate(60deg);-ms-transform:rotate(60deg);transform:rotate(60deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]{-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]{-webkit-transform:rotate(120deg);-ms-transform:rotate(120deg);transform:rotate(120deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]{-webkit-transform:rotate(150deg);-ms-transform:rotate(150deg);transform:rotate(150deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]{-webkit-transform:rotate(210deg);-ms-transform:rotate(210deg);transform:rotate(210deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]{-webkit-transform:rotate(240deg);-ms-transform:rotate(240deg);transform:rotate(240deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]{-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]{-webkit-transform:rotate(300deg);-ms-transform:rotate(300deg);transform:rotate(300deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]{-webkit-transform:rotate(330deg);-ms-transform:rotate(330deg);transform:rotate(330deg)}.sk-circle[_ngcontent-%COMP%]   .sk-circle2[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle3[_ngcontent-%COMP%]:before{-webkit-animation-delay:-1s;animation-delay:-1s}.sk-circle[_ngcontent-%COMP%]   .sk-circle4[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.9s;animation-delay:-.9s}.sk-circle[_ngcontent-%COMP%]   .sk-circle5[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.8s;animation-delay:-.8s}.sk-circle[_ngcontent-%COMP%]   .sk-circle6[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.7s;animation-delay:-.7s}.sk-circle[_ngcontent-%COMP%]   .sk-circle7[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.6s;animation-delay:-.6s}.sk-circle[_ngcontent-%COMP%]   .sk-circle8[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.5s;animation-delay:-.5s}.sk-circle[_ngcontent-%COMP%]   .sk-circle9[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.4s;animation-delay:-.4s}.sk-circle[_ngcontent-%COMP%]   .sk-circle10[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.3s;animation-delay:-.3s}.sk-circle[_ngcontent-%COMP%]   .sk-circle11[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.2s;animation-delay:-.2s}.sk-circle[_ngcontent-%COMP%]   .sk-circle12[_ngcontent-%COMP%]:before{-webkit-animation-delay:-.1s;animation-delay:-.1s}@-webkit-keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-circleBounceDelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}.spinner-chasing-dots[_ngcontent-%COMP%]{width:40px;height:40px;position:absolute;inset:0;margin:auto;z-index:2000;text-align:center;-webkit-animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear;animation:_ngcontent-%COMP%_sk-rotate 2s infinite linear}.dot1[_ngcontent-%COMP%], .dot2[_ngcontent-%COMP%]{width:60%;height:60%;display:inline-block;position:absolute;top:0;background-color:#333;border-radius:100%;-webkit-animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out;animation:_ngcontent-%COMP%_sk-bounce 2s infinite ease-in-out}.dot2[_ngcontent-%COMP%]{top:auto;bottom:0;-webkit-animation-delay:-1s;animation-delay:-1s}@-webkit-keyframes _ngcontent-%COMP%_sk-rotate{to{-webkit-transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_sk-rotate{to{transform:rotate(360deg);-webkit-transform:rotate(360deg)}}@-webkit-keyframes _ngcontent-%COMP%_sk-bounce{0%,to{-webkit-transform:scale(0)}50%{-webkit-transform:scale(1)}}@keyframes _ngcontent-%COMP%_sk-bounce{0%,to{transform:scale(0);-webkit-transform:scale(0)}50%{transform:scale(1);-webkit-transform:scale(1)}}.full-screen[_ngcontent-%COMP%]{position:fixed;position:-ms-page}']});let d=s;return d})(),aT=(()=>{let s=class s{static forRoot(r){return{ngModule:s,providers:[{provide:"loadingConfig",useValue:r}]}}};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[qs]});let d=s;return d})();var UF=d=>({disabled:d}),HF=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function WF(d,s){d&1&&(V(0,"div",16)(1,"p",17),$(2,"***Please enter a valid 10-digit phone number."),j()())}function GF(d,s){if(d&1&&Me(0,"ngx-loading",15),d&2){let u=dt();Fe("show",u.loading)("config",eb(2,HF))}}var lT=(()=>{let s=class s{constructor(r,l,i,_,C){this.router=r,this.fb=l,this.auth=i,this.http=_,this.logInService=C,this.loading=!1,this.showError=!1,this.myForm=this.fb.group({phoneNumber:[null,[ro.required,ro.pattern("^[0-9]{10}$")]]})}validate(){this.myForm.value.phoneNumber.length===10?this.showError=!1:this.showError=!0}login(){this.loading=!0,this.logInService.setLog(this.myForm.value.phoneNumber),this.loading=!1}};s.\u0275fac=function(l){return new(l||s)(_e(Nt),_e(Zo),_e(rT),_e(Wi),_e(Jn))},s.\u0275cmp=ft({type:s,selectors:[["app-log-in"]],decls:29,vars:7,consts:[[1,"container"],[1,"sub-container"],[1,"banner-div"],[1,"banner"],[3,"submit","input","formGroup"],[1,"phone-div"],[1,"num"],[1,"line"],["type","tel","formControlName","phoneNumber",1,"input-box"],["class","error",4,"ngIf"],[1,"update-div"],["type","checkbox"],["src","assets\\logo\\wts up .png"],[1,"btn"],[3,"disabled","ngClass"],[3,"show","config"],[1,"error"],[1,"error-message",2,"color","red"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span"),$(5,"Earn more"),j(),Me(6,"br"),V(7,"p"),$(8,"fill your dreams"),j()()(),V(9,"form",4),Oe("submit",function(){return i.login()})("input",function(){return i.validate()}),V(10,"div",5)(11,"div")(12,"span",6),$(13,"+91"),j(),Me(14,"span",7)(15,"input",8),j()(),Bt(16,WF,3,0,"div",9),V(17,"div",10),Me(18,"input",11),V(19,"span"),$(20,"Get update on \xA0"),Me(21,"img",12),$(22," whatsapp"),j()(),Me(23,"br")(24,"br"),V(25,"div",13)(26,"button",14),$(27,"Get OTP"),j()()()()(),Bt(28,GF,1,3,"ngx-loading",15)),l&2&&(ue(9),Fe("formGroup",i.myForm),ue(7),Fe("ngIf",i.showError),ue(10),Fe("disabled",!i.myForm.valid)("ngClass",li(5,UF,!i.myForm.valid)),ue(2),Vn(28,i.loading?28:-1))},dependencies:[So,cr,ko,no,dr,Mo,Yo,Na,Pb],styles:['.container[_ngcontent-%COMP%]{width:99vw;max-width:450px;height:100vh;display:flex;flex-direction:column;align-items:center}.sub-container[_ngcontent-%COMP%]{width:100%;position:relative;top:3%;display:grid;grid-gap:1.2rem;align-items:center}.banner-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}.banner[_ngcontent-%COMP%]{width:90%;max-width:450px;height:26rem;background-image:url("./media/Rectangle 25-RGNGM5F3.png");background-size:cover;background-repeat:no-repeat;background-position:center;display:flex;flex-direction:column;justify-content:center;text-align:center}.banner[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:42px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.banner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:26px;font-family:Inter,sans-serif;font-weight:600;color:#fff}.phone-div[_ngcontent-%COMP%]{width:90%;align-items:start;border-radius:.5rem;height:3.5rem;border:1px solid rgba(0,0,0,1);position:relative;left:5%}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:flex;position:relative;top:30%;left:5%;font-size:1.3rem}.phone-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:26px;height:17px}.num[_ngcontent-%COMP%]{font-size:1.4rem}.line[_ngcontent-%COMP%]{margin-top:-.2rem;font-size:2.2rem}.input-box[_ngcontent-%COMP%]{float:left;margin-top:-.4rem;width:70%;height:2rem;outline:0;border-width:0 0 0;font-size:1.5rem}input[type=checkbox][_ngcontent-%COMP%]{accent-color:#D16611}.update-div[_ngcontent-%COMP%]{width:80%;height:1.6rem;margin-left:5%;margin-top:.4rem;align-items:center;display:flex}.update-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;background-color:#d70d09}.update-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.1rem;font-family:inter;font-weight:400;line-height:1.4rem}.btn[_ngcontent-%COMP%]{width:90%;align-items:center;margin-left:5%}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.disabled[_ngcontent-%COMP%]{background-color:#838180}.error[_ngcontent-%COMP%]{width:90%;margin-left:5%}']});let d=s;return d})();var Fr=(()=>{let s=class s{constructor(r,l,i){this.http=r,this.router=l,this.dialogService=i,this.providerRating=0,this.apiUrl=yn,this.userId=localStorage.getItem("provider"),this.isVerify=!1,this.checkingDetails=!1,this.items=[],this.selectedJob=[],this.userName="",this.workDetails=[],this.getServices()}setCheckingDetails(r){this.checkingDetails=r}getcheckingDetails(){return this.checkingDetails}selectedJobDetails(r){console.log(r),this.selectedJob=r}getSelectedJob(){return console.log(this.selectedJob),this.selectedJob}getUserDetails(r){let l=this.apiUrl+`providers/provider-details/${r}`;return new ho(i=>{this.http.get(l).subscribe(_=>{console.log(_),console.log("response",_),this.isVerify=_.isVerified,this.userDetails=_,this.formatingResponse(this.userDetails),i.next(!1),i.complete()},_=>{console.log(_),_.error.message=="No items found for this user"?(console.log("not found"),i.next(!0)):(i.error(_),this.checkingDetails||(this.dialogService.openDialog("Please add the details"),this.checkingDetails=!0,this.router.navigate(["aboutUser"]))),i.complete()})})}getRating(){let r=localStorage.getItem("providerId");if(this.providerRating>0)return br(this.providerRating);{let l=`${this.apiUrl}users/user-feedback/provider/${r}`;return new ho(i=>{this.http.get(l).subscribe({next:_=>{console.log(_),i.next(this.providerRating)},error:_=>{console.log(_)}})})}}formatingResponse(r){try{typeof r.work=="string"&&(this.workDetails=r.work);let i=r.work;this.workDetails=i,console.log(this.workDetails)}catch(l){console.error("Error processing response.work",l)}}flattenArray(r){return r.reduce((l,i)=>Array.isArray(i)?l.concat(this.flattenArray(i)):l.concat(i),[])}getServices(){let r=this.apiUrl+"core/categories";this.http.get(r).subscribe(l=>{console.log(l),this.formattingServices(l)},l=>{console.log(l)})}formattingServices(r){r.forEach(l=>{this.items.push({id:l._id,names:l.name,checked:!1,image:l.imageKey})})}getAvailability(){let r=this.apiUrl+`providers/provider-date/${localStorage.getItem("providerId")}`;return this.http.get(r)}setDefault(){this.items=[],this.selectedJob=[],this.userDetails="",this.userName=""}};s.\u0275fac=function(l){return new(l||s)(st(Wi),st(Nt),st(Lr))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var qF=["input1"],$F=["input2"],YF=["input3"],ZF=["input4"];function XF(d,s){if(d&1){let u=Kt();V(0,"u",16),Oe("click",function(){_t(u);let l=dt();return bt(l.resend())}),$(1,"Resend"),j()}}function QF(d,s){if(d&1&&(V(0,"div",17)(1,"p"),$(2),j()()),d&2){let u=dt();ue(2),gs("",u.minutes," : ",u.seconds,"")}}var cT=(()=>{let s=class s{constructor(r,l,i,_,C,I,O){this.form=r,this.logInService=l,this.jobDetailsService=i,this.loginServices=_,this.router=C,this.dialogeService=I,this.http=O,this.apiUrl=yn,this.userNumber=0,this.resendToggling="resend",this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}ngOnInit(){this.userNumber=this.logInService.userNumber,this.logInService.showOtp()}onInput(r,l){if(r.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}onKeyDown(r,l){console.log("called",r,l);let i=r.target;if(console.log("input :",i.value),console.log(l==1),r.key==="Backspace"&&!i.value&&l>1){let _=l-1;if(console.log("previous input",`#input${l-1}`),_)switch(_){case 3:this.input3.nativeElement.focus();break;case 2:this.input2.nativeElement.focus();break;case 1:this.input1.nativeElement.focus();break;default:console.log("something went wrong")}}}login(){return Rn(this,null,function*(){let r=this.otp.value,l=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log("OTP:",this.otp.value),console.log(l),this.logInService.verifyOtp(l).subscribe(i=>Rn(this,null,function*(){console.log("log in done",i),console.log(i.providerId),yield this.logInService.setUser(i.providerId),this.storeUserData(),yield this.chekingUser()}),i=>{console.log("error",i),alert(i.error.message)})})}storeUserData(){}resend(){this.logInService.resendOtp(),this.resendToggling="countdown",this.startCountdown()}startCountdown(){let r=120;this.updateDisplay(r),this.countdownInterval=setInterval(()=>{r-=1,r<=0?(this.stopCountdown(),this.resendToggling="resend"):this.updateDisplay(r)},1e3)}stopCountdown(){clearInterval(this.countdownInterval)}ngOnDestroy(){this.stopCountdown()}updateDisplay(r){this.minutes=Math.floor(r/60),this.seconds=r%60}chekingUser(){return Rn(this,null,function*(){let r=localStorage.getItem("providerId"),l=`${this.apiUrl}providers/provider-details/${r}`;this.http.get(l).subscribe(i=>{console.log("response",i),console.log(i.providerName),this.logInService.alreadyHasAccount=!0,this.navTo()},i=>{console.log(i),this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"])})})}navTo(){this.logInService.alreadyHasAccount?this.router.navigate(["home"]):(this.dialogeService.openDialog("Please add your Details"),this.router.navigate(["aboutUser"]))}};s.\u0275fac=function(l){return new(l||s)(_e(Zo),_e(Jn),_e(Fr),_e(Jn),_e(Nt),_e(Lr),_e(Wi))},s.\u0275cmp=ft({type:s,selectors:[["app-verify"]],viewQuery:function(l,i){if(l&1&&(bi(qF,5),bi($F,5),bi(YF,5),bi(ZF,5)),l&2){let _;fi(_=gi())&&(i.input1=_.first),fi(_=gi())&&(i.input2=_.first),fi(_=gi())&&(i.input3=_.first),fi(_=gi())&&(i.input4=_.first)}},decls:27,vars:3,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"info-text"],[3,"ngSubmit","formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputTwo",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputThree",3,"input","keydown"],["type","text","maxlength","1","formControlName","inputFour",3,"input","keydown"],[1,"resend-div"],["type","submit",1,"login-btn",3,"click"],[1,"resend",3,"click"],[1,"resend"]],template:function(l,i){if(l&1){let _=Kt();V(0,"div",4)(1,"div",5)(2,"span",6),$(3,"Enter OTP "),j(),Me(4,"br"),V(5,"span",7),$(6,"Please enter the code we just send to"),j(),V(7,"p",7),$(8),j(),Me(9,"br"),V(10,"form",8),Oe("ngSubmit",function(){return _t(_),bt(i.login())}),V(11,"div",9)(12,"input",10,0),Oe("input",function(I){return _t(_),bt(i.onInput(I,1))})("keydown",function(I){return _t(_),bt(i.onKeyDown(I,1))}),j(),V(14,"input",11,1),Oe("input",function(I){return _t(_),bt(i.onInput(I,2))})("keydown",function(I){return _t(_),bt(i.onKeyDown(I,2))}),j(),V(16,"input",12,2),Oe("input",function(I){return _t(_),bt(i.onInput(I,3))})("keydown",function(I){return _t(_),bt(i.onKeyDown(I,3))}),j(),V(18,"input",13,3),Oe("input",function(I){return _t(_),bt(i.onInput(I,4))})("keydown",function(I){return _t(_),bt(i.onKeyDown(I,4))}),j()(),V(20,"div",14)(21,"span"),$(22,"Didn\u2019t receive OTP? "),Bt(23,XF,2,0)(24,QF,3,2),j()(),V(25,"button",15),Oe("click",function(){return _t(_),bt(i.login())}),$(26,"Verify"),j()()()()}if(l&2){let _;ue(8),zi("+91 ",i.userNumber,""),ue(2),Fe("formGroup",i.otp),ue(13),Vn(23,(_=i.resendToggling)==="resend"?23:_==="countdown"?24:-1)}},dependencies:[ko,no,dr,Mo,km,Yo,Na],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;text-align:center;align-items:center}.sub-container[_ngcontent-%COMP%]{position:relative;top:10%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:2.1rem}.info-text[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.3rem;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:2.5rem;font-weight:300;align-items:center}.resend-div[_ngcontent-%COMP%]{margin-top:3rem;width:90%;height:4rem;display:grid;align-items:center;row-gap:0}.resend-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer;font-size:1.1rem;font-family:Roboto,sans-serif;font-weight:400;color:#000}.resend[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}@media screen and (min-width: 600px){.container[_ngcontent-%COMP%]{align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:30%;border:1px solid black;position:relative;left:35%}}"]});let d=s;return d})();var vr=(()=>{let s=class s{constructor(r){this.http=r,this.workResponse=[],this.api=yn}getUserDetails(r){let l=this.api+`providers/provider-details/${r}`;return this.providerDetails?br(this.providerDetails):new ho(i=>{this.http.get(l).subscribe(_=>{console.log(_),this.providerDetails=_,i.next(this.providerDetails),i.complete()},_=>{console.log(_),i.error(_)})})}selectWork(r){return r}getWork(r){let l=this.api+`providers/provider-work/${r}`;return console.log(l),this.http.get(l)}deleteWork(r,l){let i=`${this.api}/providers/provider-work/delete-subcategory`,_={providerId:localStorage.getItem("providerId"),workId:r,subcategoryId:l};return this.http.post(i,_)}getFinancialDetails(){let r=this.api+`providers/provider-finance/${localStorage.getItem("providerId")}`;return this.http.get(r)}getPackages(){let r=`${this.api}admin/admin-provider-package`;return this.http.get(r)}getCertificated(r){let l=this.api+`providers/provider-certificate/${r}`;return this.http.get(l)}setDefult(){this.workResponseId="",this.workResponse=[],this.currentLocation="",this.currentCordinates="",this.userRegistered="",this.api=""}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Zs=(()=>{let s=class s{constructor(r){this.http=r,this.apiUrl=yn,this.mapStatus=!1,this.currentLocation$=new Jf(null),this.onlineStatus=!1,this.directionsService=new google.maps.DirectionsService,this.directionsRenderer=new google.maps.DirectionsRenderer}setonlineStatus(r,l){this.onlineStatus=r,localStorage.setItem("onlineStatus",r.toString()),localStorage.setItem("onlineText",l)}getonlineStatus(){let r=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");return{status:r==="true",text:l||"Go"}}getCoordinates(){return navigator.geolocation.getCurrentPosition(r=>{let l={lat:r.coords.latitude,lng:r.coords.longitude};this.currentLocation$.next(l)},r=>{console.log(r)}),this.currentLocation$.asObservable()}sendCordinates(r){let l=this.apiUrl+"providers/provider-cordinates",i=localStorage.getItem("providerId");console.log(r);let _={providerId:i,longitude:r.location.lng,latitude:r.location.lat};return console.log(_),this.http.post(l,_)}getCoordinatesFromPlaceName(r){let l=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(r)}&key=AIzaSyCJQHv3pYfnPd6F3ju1DXZ7jm46PJbncuk`;return this.http.get(l)}getPlaceNameFromCoordinates(r,l){let i=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${r},${l}&key=AIzaSyCJQHv3pYfnPd6F3ju1DXZ7jm46PJbncuk`;return this.http.get(i)}addDestinationMarker(r){new google.maps.Marker({position:{lat:r[1],lng:r[0]},map:this.map,title:"Destination"})}initializeMap(r,l){this.map=new google.maps.Map(l,{center:{lat:r.lat,lng:r.lng},zoom:15})}addProviderMarker(r){this.providerMarker=new google.maps.Marker({position:r,map:this.map,title:"Provider Location"})}addUserMarker(r){new google.maps.Marker({position:r,map:this.map,title:"User Location",icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}),this.directionsRenderer.setMap(this.map)}updateProviderMarker(r){this.providerMarker&&this.providerMarker.setPosition(r)}showDirections(r,l){if(!r||!l){console.error("Invalid origin or destination for directions.");return}let i={origin:new google.maps.LatLng(r.lat,r.lng),destination:new google.maps.LatLng(l.lat,l.lng),travelMode:google.maps.TravelMode.DRIVING};this.directionsService.route(i,(_,C)=>{C==="OK"?this.directionsRenderer.setDirections(_):console.error("Error fetching directions:",C)})}trackProviderLocation(){let r=new Jf(null);return navigator.geolocation.watchPosition(l=>{let i={lat:l.coords.latitude,lng:l.coords.longitude};r.next(i)},l=>{console.log("Tracking error:",l)}),r.asObservable()}calculateDistance(r,l,i,_){let C=de=>de*Math.PI/180,O=C(i-r),N=C(_-l),q=Math.sin(O/2)*Math.sin(O/2)+Math.cos(C(r))*Math.cos(C(i))*Math.sin(N/2)*Math.sin(N/2);return 6371e3*(2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q)))}setDefult(){}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function KF(d,s){if(d&1){let u=Kt();V(0,"div",5)(1,"label",8),$(2,"what work do you do?"),j(),Me(3,"br"),V(4,"input",33),Oe("click",function(){_t(u);let l=dt();return bt(l.navTo())}),j(),Me(5,"i",34),j()}if(d&2){let u=dt();ue(4),Fe("ngModel",u.selectedWork)}}function JF(d,s){d&1&&Me(0,"img",35)}function ez(d,s){if(d&1&&Me(0,"img",36),d&2){let u=dt();Fe("src",u.imagePreview,Hn)}}var dT=(()=>{let s=class s{constructor(r,l,i,_,C,I){this.fb=r,this.router=l,this.location=i,this.loginService=_,this.userDetailsService=C,this.googleMapService=I,this.selectedFile=null,this.imagePreview=null,this.workAdded=!0,this.aboutProvider=this.fb.group({userId:localStorage.getItem("providerId"),providerName:["",ro.required],work:["",ro.required],pincode:["",ro.required],phone:[this.loginService.userNumber,ro.required],age:[this.loginService.age,ro.required],gender:["",ro.required],houseNo:"",landmark:"",address:["",ro.required],city:"",state:"",image:[""]});let O=this.loginService.workDetails.flat();this.aboutProvider.controls.work.setValue(O),console.log(O),console.log("inform",this.aboutProvider.value.work),this.selectedWork=this.loginService.workDetails.flatMap(N=>N.flatMap(q=>q.nameOfService)).join(", ")}ngOnInit(){this.getNumber(),this.getWork()}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r),r.works.length>0&&(this.workAdded=!1)},error:r=>{console.log(r)}})}getNumber(){return Rn(this,null,function*(){let r=this.loginService.getPhoneNumber();console.log(r),this.userNumber=yield this.loginService.userNumber,console.log(this.userNumber)})}flattenWorkDetails(r){return r.flatMap(l=>l.flatMap(i=>i.nameOfService))}onFileSelected(r){let l=r.target;if(l.files&&l.files.length>0){this.selectedFile=l.files[0];let i=new FileReader;i.onload=()=>{this.imagePreview=i.result},i.readAsDataURL(this.selectedFile)}}navTo(){this.router.navigate(["selectWork"])}getCoordinates(){let r=`${this.aboutProvider.value.houseNo} ${this.aboutProvider.value.landmark} ${this.aboutProvider.value.address} ${this.aboutProvider.value.city} ${this.aboutProvider.value.state} ${this.aboutProvider.value.pincode}`;console.log(r),this.googleMapService.getCoordinatesFromPlaceName(r).subscribe({next:l=>{console.log(l),this.googleMapService.sendCordinates(l.results[0].geometry).subscribe({next:i=>{console.log(i),alert("coordinates are updated")},error:i=>{console.log(i)}})},error:l=>{console.log(l)}})}submit(){this.getCoordinates();let r=new FormData;r.append("providerName",this.aboutProvider.value.providerName),r.append("age",this.aboutProvider.value.age),r.append("pincode",this.aboutProvider.value.pincode),r.append("providerId",this.aboutProvider.value.userId),r.append("gender",this.aboutProvider.value.gender),r.append("address",this.aboutProvider.value.address),r.append("phone",this.loginService.userNumber),r.append("houseNo",this.aboutProvider.value.houseNo),r.append("landMark",this.aboutProvider.value.landmark),r.append("city",this.aboutProvider.value.city),r.append("state",this.aboutProvider.value.state),this.selectedFile&&r.append("image",this.selectedFile,this.selectedFile.name),r.forEach((l,i)=>{console.log(`${i}: ${l}`)}),this.loginService.UserDetails(r)}navToBack(){console.log("back"),this.location.back()}};s.\u0275fac=function(l){return new(l||s)(_e(Zo),_e(Nt),_e(_i),_e(Jn),_e(vr),_e(Zs))},s.\u0275cmp=ft({type:s,selectors:[["app-about-user"]],decls:67,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[3,"formGroup"],[1,"form-div"],[2,"position","relative"],["for","name"],["type","text","placeholder","Name","formControlName","providerName","id","names","required",""],["for","work"],["for","name","formControlName","gender"],["value","","disabled","","selected",""],["value","Male"],["value","Female"],["value","Others"],["for","houseNo"],["type","text","formControlName","houseNo","required","","placeholder","Address"],["for","landmark"],["type","text","formControlName","landmark","required","","placeholder","Address"],["for","address"],["type","text","formControlName","address","required","","placeholder","Address"],["for","city"],["type","text","formControlName","city","required","","placeholder","Address"],["for","state"],["type","text","formControlName","state","required","","placeholder","Address"],["for","pincode"],["type","text","formControlName","pincode","required","","placeholder","Address"],["for","file",1,"image-label"],[1,"file-input-container"],["for","file-input",1,"file-label"],["src","assets/documents/Group.png","alt","Upload image","class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],["type","file","id","file-input","formControlName","image","required","",1,"file-input",3,"change"],["type","submit",1,"login-btn",3,"click"],["formControlName","work","id","providerType","required","","placeholder","please select the Work ",3,"click","ngModel"],[1,"fa","fa-angle-down",2,"font-size","36px","position","absolute","right","10px","top","75%","transform","translateY(-50%)","pointer-events","none"],["src","assets/documents/Group.png","alt","Upload image",1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Tell us about yourself"),j(),Me(4,"br"),V(5,"form",3)(6,"div",4),Bt(7,KF,6,1,"div",5),V(8,"div")(9,"label",6),$(10,"what's your Name"),j(),Me(11,"br")(12,"input",7),j(),V(13,"div")(14,"label",8),$(15,"Select your Gender"),j(),Me(16,"br"),V(17,"select",9)(18,"option",10),$(19,"Select"),j(),V(20,"option",11),$(21,"Male"),j(),V(22,"option",12),$(23,"Female"),j(),V(24,"option",13),$(25,"Others"),j()(),Me(26,"br"),j(),V(27,"div")(28,"label",14),$(29," H no "),j(),Me(30,"br")(31,"input",15),j(),V(32,"div")(33,"label",16),$(34," Landmark "),j(),Me(35,"br")(36,"input",17),j(),V(37,"div")(38,"label",18),$(39," Address "),j(),Me(40,"br")(41,"input",19),j(),V(42,"div")(43,"label",20),$(44," City"),j(),Me(45,"br")(46,"input",21),j(),V(47,"div")(48,"label",22),$(49," State "),j(),Me(50,"br")(51,"input",23),j(),V(52,"div")(53,"label",24),$(54," Pincode "),j(),Me(55,"br")(56,"input",25),j(),V(57,"label",26),$(58," Upload image "),j(),V(59,"div",27)(60,"label",28),Bt(61,JF,1,0,"img",29)(62,ez,1,1,"img",30),j(),V(63,"input",31),Oe("change",function(C){return i.onFileSelected(C)}),j()(),V(64,"button",32),Oe("click",function(){return i.submit()}),$(65,"Continue"),j()()()()(),Me(66,"br")),l&2&&(ue(5),Fe("formGroup",i.aboutProvider),ue(2),Vn(7,i.workAdded?7:-1),ue(54),Fe("ngIf",!i.selectedFile),ue(),Fe("ngIf",i.selectedFile))},dependencies:[cr,ko,Ek,Dk,no,Tk,dr,Mo,Ak,Yo,Na],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;top:10%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.form-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-gap:1rem}.form-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter;line-height:19px}#providerType[_ngcontent-%COMP%]   option[value=""][disabled][_ngcontent-%COMP%]{display:none}.file-input-container[_ngcontent-%COMP%]{position:relative;width:200px;height:200px;border:.25px solid #ccc;display:flex;align-items:center;justify-content:center;border-radius:.5rem}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.placeholder-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.image-label[_ngcontent-%COMP%]{float:left;text-align:left}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:100%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-bottom:3rem}']});let d=s;return d})();var hT=(()=>{let s=class s{constructor(r){this.router=r,this.currentUrl=this.router.url,this.router.events.pipe(ga(l=>l instanceof cb),jx()).subscribe(l=>{this.previousUrl=l[0].url,this.currentUrl=l[1].url})}getPreviousUrl(){return this.previousUrl}};s.\u0275fac=function(l){return new(l||s)(st(Nt))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();function iz(d,s){if(d&1){let u=Kt();V(0,"div",8)(1,"div",10),Oe("click",function(){let l=_t(u).$implicit,i=dt();return bt(i.selectedCat(l))}),Me(2,"img",11),$(3),j(),V(4,"div")(5,"input",12),Yr("ngModelChange",function(l){let i=_t(u).$implicit;return $r(i.checked,l)||(i.checked=l),bt(l)}),Oe("change",function(l){let i=_t(u).$implicit,_=dt();return bt(_.onChange(l,i))}),j()()()}if(d&2){let u=s.$implicit;ue(2),Fe("src",u.image,Hn),ue(),zi(" ",u.names,""),ue(2),qr("ngModel",u.checked)}}function nz(d,s){if(d&1){let u=Kt();V(0,"div",8)(1,"div",13),$(2),j(),V(3,"div")(4,"input",12),Yr("ngModelChange",function(l){let i=_t(u).$implicit;return $r(i.checked,l)||(i.checked=l),bt(l)}),Oe("change",function(l){let i=_t(u).$implicit,_=dt();return bt(_.onChange(l,i))}),j()()()}if(d&2){let u=s.$implicit;ue(2),Rt(u.names),ue(2),qr("ngModel",u.checked)}}var uT=(()=>{let s=class s{ngOnInit(){this.previousUrl=this.routeTrackingService.getPreviousUrl(),this.getWork(),console.log(this.items)}constructor(r,l,i,_,C,I){this.router=r,this.logInservice=l,this.jobDetails=i,this.routeTrackingService=_,this.userDetailsService=C,this.dialogeService=I,this.searchQuery="",this.workSeleceted=[],this.items=this.jobDetails.items,this.workForSending=[]}onInputChange(r){console.log(this.searchQuery);let l=this.jobDetails.items.filter(i=>i.names.toLowerCase().includes(this.searchQuery.toLowerCase()));console.log(l),this.items=l}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}onChange(r,l){let i=r.target;if(i&&i.checked){let C=this.items.indexOf(l);this.jobDetails.items[C].checked=!0,console.log("Item checked:",this.items.indexOf(l)),console.log("Item checked:",l.names),console.log("categoryId",l.id),this.logInservice.categoryId=l.id,this.logInservice.setWork(l.names,l.id),this.router.navigate(["subServices"])}}selectedCat(r){console.log("clciked");let l=this.items.indexOf(r);this.jobDetails.items[l].checked=!0,console.log("Item checked:",this.items.indexOf(r)),console.log("Item checked:",r.names),console.log("categoryId",r.id),this.logInservice.categoryId=r.id,this.logInservice.setWork(r.names,r.id),this.router.navigate(["subServices"])}autoCheckServices(){this.workSeleceted.forEach(r=>{let l=this.items.find(i=>i.names===r.categoryId.name);console.log(l),l&&l&&(l.checked=!0)})}send(){let r=this.items.filter(l=>l.checked===!0);if(console.log(r),this.jobDetails.userDetails&&this.jobDetails.userDetails.providerName!=null){let l=this.logInservice.workDetails.flat();this.UpdatingUserWork(l)}else r.length<1?alert("please select any one service"):this.logInservice.sendWorkDetails().subscribe(l=>{console.log(l),this.dialogeService.openDialog("Service has been added"),this.router.navigate(["aboutUser"])},l=>{console.log(l)})}UpdatingUserWork(r){console.log(r);let l=this.userDetailsService.workResponseId;console.log("work before",this.userDetailsService.workResponse),console.log("id before",l),this.workForSending.push(this.userDetailsService.workResponse),this.workForSending.push(r),console.log(this.workForSending.flat()),this.logInservice.updateUserWork(this.workForSending.flat(),l)}};s.\u0275fac=function(l){return new(l||s)(_e(Nt),_e(Jn),_e(Fr),_e(hT),_e(vr),_e(Lr))},s.\u0275cmp=ft({type:s,selectors:[["app-select-work"]],decls:22,vars:2,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"search-container"],["type","text","placeholder","Search for Service",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"material-symbols-outlined",3,"hidden"],[1,"serivce"],[1,"tittle2"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names",3,"click"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"],[1,"names"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"what work do you do?"),j(),Me(4,"br"),V(5,"div",3)(6,"input",4),Yr("ngModelChange",function(C){return $r(i.searchQuery,C)||(i.searchQuery=C),C}),Oe("input",function(C){return i.onInputChange(C)}),j(),V(7,"span",5),$(8,"search"),j()(),V(9,"div",6)(10,"span",7),$(11,"Popular categories"),j(),Me(12,"br"),Or(13,iz,6,3,"div",8,Lo),V(15,"span",7),$(16,"All categories"),j(),Me(17,"br"),Or(18,nz,5,2,"div",8,Lo),j()(),V(20,"button",9),Oe("click",function(){return i.send()}),$(21,"Continue"),j()()),l&2&&(ue(6),qr("ngModel",i.searchQuery),ue(),Fe("hidden",i.searchQuery),ue(6),Rr(i.items),ue(5),Rr(i.items))},dependencies:[no,hd,dr,Ba],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-container[_ngcontent-%COMP%]{position:relative}.search-container[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{padding-right:30px;width:70%;height:2.5rem;border-radius:.8rem;font-size:1.5rem}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.search-container[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{position:absolute;top:50%;left:7%;transform:translateY(-50%);cursor:pointer;pointer-events:none;font-size:32px;margin:0}.tittle2[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px;display:flex;align-items:start}.serivce[_ngcontent-%COMP%]{height:70vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.7rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=s;return d})();var mT=(()=>{let s=class s{constructor(r,l){this.router=r,this.loginService=l,this.selectedExperiance="",this.selectedAge="",this.workSelected=this.loginService.workName,this.selectedCheckbox=null}sendResponse(){console.log(this.selectedAge,this.selectedExperiance)}expSelected(r){this.selectedExperiance===r?this.selectedExperiance=null:this.selectedExperiance=r,console.log(this.selectedExperiance),this.selectedExperiance==="yes"?this.router.navigate(["workExperiance"]):(this.loginService.setExperiance("0"),this.loginService.setWorkDetails(),this.router.navigate(["selectWork"]))}onCheckboxChange(r){this.selectedAge===r?this.selectedAge=null:this.selectedAge=r,console.log("Selected Checkbox:",this.selectedAge),this.loginService.setAge(this.selectedAge)}};s.\u0275fac=function(l){return new(l||s)(_e(Nt),_e(Jn))},s.\u0275cmp=ft({type:s,selectors:[["app-about-work"]],decls:44,vars:6,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],[2,"padding","0.5rem"],[1,"select-div"],[1,"conditions"],["type","checkbox"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Tell us about your work!"),j(),Me(4,"br")(5,"br"),V(6,"div",3)(7,"pre"),$(8,"What is your age?"),j(),Me(9,"hr"),V(10,"div")(11,"span"),$(12,"16 - 18"),j(),V(13,"input",4),Oe("change",function(){return i.onCheckboxChange("16-18")}),j()(),Me(14,"hr"),V(15,"div")(16,"span"),$(17,"18 - 40"),j(),V(18,"input",4),Oe("change",function(){return i.onCheckboxChange("18-40")}),j()(),Me(19,"hr"),V(20,"div")(21,"span"),$(22,"More than 40"),j(),V(23,"input",4),Oe("change",function(){return i.onCheckboxChange("more than 40")}),j()()(),V(24,"div",3)(25,"p",5),$(26),j(),Me(27,"hr"),V(28,"div",6)(29,"span"),$(30,"Yes"),j(),V(31,"input",4),Oe("change",function(){return i.expSelected("yes")}),j()(),Me(32,"hr"),V(33,"div")(34,"span"),$(35,"No"),j(),V(36,"input",4),Oe("change",function(){return i.expSelected("no")}),j()()(),V(37,"div",7),Me(38,"input",8),$(39," \xA0 Agree with Terms & conditions"),j(),Me(40,"br")(41,"br"),V(42,"button",9),Oe("click",function(){return i.sendResponse()}),$(43,"Continue"),j()()()),l&2&&(ue(13),Fe("checked",i.selectedAge==="16-18"),ue(5),Fe("checked",i.selectedAge==="18-40"),ue(5),Fe("checked",i.selectedAge==="more than 40"),ue(3),zi("Do you have any experience in ",i.workSelected," services?"),ue(5),Fe("checked",i.selectedExperiance==="yes"),ue(5),Fe("checked",i.selectedExperiance==="no"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}.conditions[_ngcontent-%COMP%]{width:max-content;font-size:1.2rem;font-family:inter,sans-serif;font-weight:400;line-height:1.4rem;float:left;display:flex;justify-content:space-around}.conditions[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}.sub-div1[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem}"]});let d=s;return d})();var pT=(()=>{let s=class s{constructor(r,l){this.logInservice=r,this.router=l,this.experiance=""}onCheckboxChange(r){this.experiance===r?this.experiance=null:this.experiance=r,console.log("Selected Checkbox:",this.experiance)}sendResponse(){this.logInservice.setExperiance(this.experiance),this.logInservice.setWorkDetails(),this.router.navigate(["selectWork"])}};s.\u0275fac=function(l){return new(l||s)(_e(Jn),_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-work-experiance"]],decls:30,vars:4,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["type","checkbox",3,"change","checked"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Tell us about your work!"),j(),Me(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"span"),$(9,"0-1 Years"),j(),V(10,"input",4),Oe("change",function(){return i.onCheckboxChange("0-1")}),j()(),Me(11,"hr"),V(12,"div")(13,"span"),$(14,"2-4 Years"),j(),V(15,"input",4),Oe("change",function(){return i.onCheckboxChange("2-4")}),j()(),Me(16,"hr"),V(17,"div")(18,"span"),$(19,"3-5 Years"),j(),V(20,"input",4),Oe("change",function(){return i.onCheckboxChange("3-5")}),j()(),Me(21,"hr"),V(22,"div")(23,"span"),$(24,"More than 5 Years"),j(),V(25,"input",4),Oe("change",function(){return i.onCheckboxChange("more than 5")}),j()()()(),Me(26,"br")(27,"br"),V(28,"button",5),Oe("click",function(){return i.sendResponse()}),$(29,"Continue"),j()()),l&2&&(ue(10),Fe("checked",i.experiance==="0-1"),ue(5),Fe("checked",i.experiance==="2-4"),ue(5),Fe("checked",i.experiance==="3-5"),ue(5),Fe("checked",i.experiance==="moreThan5"))},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content;border:1px solid black;margin-bottom:5%;border-radius:1rem}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5%;display:flex;justify-content:space-between}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:95%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611}"]});let d=s;return d})();var fT=(()=>{let s=class s{constructor(r){this.router=r}verify(){console.log("inside"),this.router.navigate(["pancard"])}};s.\u0275fac=function(l){return new(l||s)(_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-aadhar-verification"]],decls:24,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],["for","name"],["type","number","placeholder","name","id","names","required",""],["type","number","placeholder","OTP","id","names","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Lets Get the Documentation Done....!!"),j(),Me(4,"br")(5,"br"),V(6,"div",3)(7,"div")(8,"label",4),$(9,"Adhar Number"),j(),Me(10,"br")(11,"input",5),j(),Me(12,"br"),V(13,"button"),$(14,"Verify"),j(),V(15,"div")(16,"label",4),$(17,"OTP"),j(),Me(18,"br")(19,"input",6),j()(),V(20,"button",7),Oe("click",function(){return i.verify()}),$(21,"Verify"),j()(),Me(22,"br")(23,"br"),j())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:grid;text-align:left}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;height:3rem;border:1px solid black;border-radius:.8rem;font-size:1rem}input[_ngcontent-%COMP%]::placeholder{padding-left:.5rem}label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:400;font-family:inter,sans-serif;line-height:19px}.sub-div1[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:1.4rem;background-color:#d16611;color:#fff;font-size:.8rem;font-family:inter;float:right;border:none;border-radius:.4rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}"]});let d=s;return d})();var gT=(()=>{let s=class s{constructor(r){this.router=r}skip(){this.router.navigate(["bankDetails"])}submit(){this.router.navigate(["bankDetails"])}};s.\u0275fac=function(l){return new(l||s)(_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-pancard"]],decls:21,vars:0,consts:[[1,"container"],[1,"skip-btn",3,"click"],[1,"sub-container"],[1,"tittle"],[1,"tittle1"],[1,"pan"],["src","assets\\documents\\pancard.png"],[1,"input"],["type","number","placeholder","PAN Number","id","Enter GST Number","required",""],["type","number","placeholder","Enter GST Number","id","Enter GST Number","required",""],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"button",1),Oe("click",function(){return i.skip()}),$(2,"skip"),j(),V(3,"div",2)(4,"div")(5,"span",3),$(6,"PAN Number"),j(),Me(7,"br")(8,"br"),V(9,"span",4),$(10,"Please Input your PAN number"),j(),Me(11,"br")(12,"br"),j(),V(13,"div",5),Me(14,"img",6),j(),V(15,"div",7),Me(16,"input",8)(17,"br")(18,"input",9),j(),V(19,"button",10),Oe("click",function(){return i.submit()}),$(20,"Submit"),j()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:0%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.6rem;font-weight:600;line-height:24px}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1rem;font-weight:400;line-height:19px}.pan[_ngcontent-%COMP%]{width:19rem;height:11.5rem}.pan[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.input[_ngcontent-%COMP%]{width:100%;height:7rem}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-top:1rem;width:98%;height:2rem;border-radius:.9rem;font-size:1rem;text-align:center}.input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{text-align:center;font-size:1rem;font-weight:600;color:#000}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:89%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:80%;left:5%}']});let d=s;return d})();var _T=(()=>{let s=class s{constructor(r,l,i){this.fb=r,this.router=l,this.http=i,this.apiUrl=yn,this.bankDetails=this.fb.group({accountName:["",ro.required],accountNumber:["",ro.required],PANNumber:["",ro.required],bankName:["",ro.required],IFSC:["",ro.required],branch:["",ro.required],aadhaarNumber:532268448050})}submit(){let r=`${this.apiUrl}providers/provider-finance`,l=new FormData;l.append("accountName",this.bankDetails.value.accountName),l.append("providerId",localStorage.getItem("providerId")||""),l.append("aadhaarNumber",this.bankDetails.value.aadhaarNumber),l.append("accountNumber",this.bankDetails.value.accountNumber),l.append("pan",this.bankDetails.value.PANNumber),l.append("bankName",this.bankDetails.value.bankName),l.append("ifscCode",this.bankDetails.value.IFSC),l.append("branch",this.bankDetails.value.branch),this.http.post(r,l).subscribe(i=>{console.log(i),this.router.navigate(["induction"])},i=>{console.log(i),i.error.error==='E11000 duplicate key error collection: test.finances index: pan_1 dup key: { pan: "cggpc1173E" }'&&alert("Pancard is already registered")})}skip(){this.router.navigate(["induction"])}};s.\u0275fac=function(l){return new(l||s)(_e(Zo),_e(Nt),_e(Wi))},s.\u0275cmp=ft({type:s,selectors:[["app-bank-details"]],decls:50,vars:1,consts:[[1,"skip-btn",3,"click"],[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"sub-div1"],[1,"form-main",3,"formGroup"],[1,"form-div-section"],["for","accountName"],["type","text","id","accountName","formControlName","accountName"],["for","accountNumber"],["type","number","id","accountNumber","formControlName","accountNumber"],["for","PANNumber"],["type","text","id","PANNumber","formControlName","PANNumber"],["for","bankName"],["type","text","id","bankName","formControlName","bankName"],["for","IFSC"],["type","text","id","IFSC","formControlName","IFSC"],["for","branch"],["type","text","id","branch","formControlName","branch"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"button",0),Oe("click",function(){return i.skip()}),$(1,"skip"),j(),V(2,"div",1)(3,"div",2)(4,"span",3),$(5,"Banking details"),j(),Me(6,"br")(7,"br"),V(8,"div",4)(9,"form",5)(10,"div",6)(11,"fieldset")(12,"legend",7),$(13," Account Name \xA0"),j(),Me(14,"input",8)(15,"br"),j()(),V(16,"div",6)(17,"fieldset")(18,"legend",9),$(19," Account Number \xA0"),j(),Me(20,"input",10)(21,"br"),j()(),V(22,"div",6)(23,"fieldset")(24,"legend",11),$(25," PAN Number \xA0"),j(),Me(26,"input",12)(27,"br"),j()(),V(28,"div",6)(29,"fieldset")(30,"legend",13),$(31," Bank name \xA0"),j(),Me(32,"input",14)(33,"br"),j()(),V(34,"div",6)(35,"fieldset")(36,"legend",15),$(37," IFSC \xA0"),j(),Me(38,"input",16)(39,"br"),j()(),V(40,"div",6)(41,"fieldset")(42,"legend",17),$(43," Branch \xA0"),j(),Me(44,"input",18)(45,"br"),j()()()(),V(46,"button",19),Oe("click",function(){return i.submit()}),$(47,"Submit"),j()(),Me(48,"br")(49,"br"),j()),l&2&&(ue(9),Fe("formGroup",i.bankDetails))},dependencies:[ko,no,ab,dr,Mo,Yo,Na],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;justify-content:center;align-items:center;text-align:center}.skip-btn[_ngcontent-%COMP%]{width:max-content;height:max-content;float:right;margin:1rem;margin-bottom:0;background-color:transparent;border:none;font-family:"Inter" sans-serif;color:#00000080;font-size:16px;font-weight:400;line-height:16.94px;text-align:left}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:0%;left:0%;display:grid;grid-template-rows:max-content max-content;align-items:start;text-align:left}.tittle[_ngcontent-%COMP%]{float:left;font-family:Inter,sans-serif;font-size:1.6rem;font-weight:500;line-height:24px}.sub-div1[_ngcontent-%COMP%]{width:100%;height:max-content}.form-main[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;flex-direction:column;gap:.9rem}fieldset[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.5rem}fieldset[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{font-size:.9rem;font-family:Inter,sans-serif;font-weight:400;line-height:1rem;flex-shrink:0;margin-right:10px;color:#030b33b3}input[_ngcontent-%COMP%]{flex-grow:1;outline:0;border-width:0 0 0 0;border-color:#000;font-size:1.1rem;padding:5px 0}.login-btn[_ngcontent-%COMP%]{height:3rem;width:90%;font-size:1.3rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:3rem;border:none;background-color:#d16611;position:fixed;top:90%;left:5%}.mat-mdc-text-field-wrapper.mdc-text-field.mdc-text-field--filled[_ngcontent-%COMP%]{background-color:transparent;height:5rem}']});let d=s;return d})();var jm=(()=>{let s=class s{constructor(r){this.http=r,this.apiUrl=yn,this.apiForVideo=this.apiUrl+"admin"}getingVideos(){return this.http.get(`${this.apiForVideo}/training`)}gettingInductionVeideos(){return this.http.get(`${this.apiForVideo}/induction`)}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Ko=(()=>{let s=class s{constructor(r){this.http=r,this.apiUrl=yn,this.userId=localStorage.getItem("providerId"),this.userCredit=0}payWithRazorpay(r,l,i){let _={key:"rzp_test_b8XfUOQ4u8dlSq",amount:r*100,currency:i,name:"Coolie no.1",description:"Test Transaction",image:"assets/location/logo-v3 3.png",handler:I=>{console.log(I),this.addingCredit(r)},prefill:{name:"Customer Name",email:"customer@example.com",contact:"9999999999"},notes:{address:"Razorpay Corporate Office"},theme:{color:"#3399cc"},modal:{ondismiss:function(){console.log("Checkout form closed")},escape:!1,backdropclose:!1,handleback:!0}};new Razorpay(_).open()}addingCredit(r){let l=this.apiUrl+"providers/provider-credits/recharge",i={providerId:this.userId,amount:r};return this.http.post(l,i).subscribe(_=>{console.log(_),this.getNow()},_=>{console.log(_)})}getCredits(){let r=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get(r)}getNow(){this.getCredits().subscribe(r=>{console.log(r),this.userCredit=r.credits},r=>{console.log(r)})}getCreditHistory(){let r=this.apiUrl+`providers/provider-credits/${this.userId}`;return this.http.get}setDefault(){this.userId="",this.userCredit=0}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var xs=XM(K1());var Um=(()=>{let s=class s{setonlineStatus(r,l){this.onlineStatus=r,localStorage.setItem("onlineStatus",r.toString()),localStorage.setItem("onlineText",l)}getonlineStatus(){let r=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");return{status:r==="true",text:l||"Go"}}constructor(r,l){this.platformId=r,this.http=l,this.apiUrl=yn,this.destinationInput="",this.currentLocation=[0,0],this.directionsLayerId="directions",this.userCordinates=[0,0],this.onlineStatus=!1,xs.default.accessToken="pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ"}ngOnInit(){this.initializeMap()}ngOnDestroy(){this.watchId&&navigator.geolocation.clearWatch(this.watchId)}initializeMap(){navigator.geolocation.getCurrentPosition(r=>{this.currentLocation=[r.coords.longitude,r.coords.latitude],console.log(this.currentLocation,"currect location"),this.map=new xs.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:this.currentLocation,zoom:12}),this.map.addControl(new xs.default.NavigationControl),this.userMarker=new xs.default.Marker({color:"blue"}).setLngLat(this.currentLocation).setPopup(new xs.default.Popup().setText("You are here")).addTo(this.map),this.watchId=navigator.geolocation.watchPosition(l=>{let i=[l.coords.longitude,l.coords.latitude];this.currentLocation=i,this.userMarker&&this.userMarker.setLngLat(i),this.userCordinates[0]!=0&&this.addDestinationMarker(this.userCordinates)},l=>{console.error("Error watching position:",l)})})}navigateToPlace(){if(!this.destinationInput){console.error("Please enter the destination address or coordinates.");return}if(/^(-?\d+(\.\d+)?),\s*(-?\d+(\.\d+)?)$/.test(this.destinationInput)){let[l,i]=this.destinationInput.split(",").map(_=>parseFloat(_.trim()));this.addDestinationMarker([l,i])}else fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(this.destinationInput)}.json?access_token=${xs.default.accessToken}`).then(l=>{if(!l.ok)throw new Error("Network response was not ok");return l.json()}).then(l=>{if(l.features.length===0)throw new Error("No results found");let i=l.features[0].geometry.coordinates;this.addDestinationMarker(i)}).catch(l=>{console.error("Error fetching destination coordinates:",l),alert("Error: Could not find the location. Please check your input.")})}addDestinationMarker(r){console.log(r),this.destinationMarker&&this.destinationMarker.remove(),this.destinationMarker=new xs.default.Marker({color:"red"}).setLngLat(r).setPopup(new xs.default.Popup().setText(this.destinationInput)).addTo(this.map),this.map.flyTo({center:r,zoom:12}),this.getDirections(r)}getDirections(r){let l=`https://api.mapbox.com/directions/v5/mapbox/driving/${this.currentLocation[0]},${this.currentLocation[1]};${r[0]},${r[1]}?alternatives=true&geometries=geojson&steps=true&access_token=${xs.default.accessToken}`;fetch(l).then(i=>{if(!i.ok)throw new Error("NoRoute");return i.json()}).then(i=>{if(console.log("Directions data:",i),i.routes.length===0)throw new Error("No routes found");this.map.getSource(this.directionsLayerId)&&(this.map.removeLayer(this.directionsLayerId),this.map.removeSource(this.directionsLayerId)),this.map.addSource(this.directionsLayerId,{type:"geojson",data:{type:"Feature",properties:{},geometry:i.routes[0].geometry}}),this.map.addLayer({id:this.directionsLayerId,type:"line",source:this.directionsLayerId,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"red","line-width":5}});let _=new xs.default.LngLatBounds;i.routes[0].geometry.coordinates.forEach(C=>{_.extend(C)}),this.map.fitBounds(_,{padding:50})}).catch(i=>{console.error("Error fetching directions:",i),alert("Error: Could not find a route.")})}getCurrentLocation(){return new ho(r=>{navigator.geolocation.getCurrentPosition(l=>{let i=[l.coords.longitude,l.coords.latitude];console.log("current location inside getcurrent location",i),alert(i),this.getPlaceNameFromCoordinates(i),r.next(i),r.complete()},l=>{r.error(l)})})}getPlaceNameFromCoordinates(r){let i=`https://api.mapbox.com/geocoding/v5/mapbox.places/${r[0]},${r[1]}.json?access_token=pk.eyJ1IjoiY29vbGllbm8xLWFkbWluIiwiYSI6ImNsdWZjZGR1ZzBtZHcybnJvaHBiYTd2NzMifQ.TQ6FrqUIUUWv7J7n75A3tQ`;return new ho(_=>{fetch(i).then(C=>{if(!C.ok)throw console.error("Network response was not ok:",C.status,C.statusText),new Error(`Network response was not ok: ${C.status} ${C.statusText}`);return C.json()}).then(C=>{if(C.features.length===0)throw console.error("No results found:",C),new Error("No results found");let I=C.features[0].place_name;_.next(I),_.complete()}).catch(C=>{console.error("Error fetching place name:",C),_.error(C)})})}sendCordinates(r){let l=this.apiUrl+"providers/provider-cordinates",_={providerId:localStorage.getItem("providerId"),longitude:r[0],latitude:r[1]};return console.log(_),this.http.post(l,_)}};s.\u0275fac=function(l){return new(l||s)(st(ld),st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var zr=(()=>{let s=class s{constructor(r){this.http=r,this.oredrDetails=[],this.apiUrl=yn}getOrder(r){let l=this.apiUrl+`users/order/category/${r}`;return this.http.get(l)}getOrderDetails(r){return this.http.get("")}accept(r,l,i){let _={orderId:r,price:l,userId:i,providerId:localStorage.getItem("providerId")};console.log(_);let C=this.apiUrl+"users/order-history/accept-order";return this.http.post(C,_)}verifyOtp(){let r=this.apiUrl+"users/order-history/verify-start-order",l={orderId:this.orderIds};return this.http.post(r,l)}verifyStartOrder(r){let l=`${this.apiUrl}users/order-history/verify-start-order`;return this.http.post(l,r)}cancelOrder(){let r=this.apiUrl+"users/order-history/cancel-order",l={orderHistoryId:this.orderIds,providerId:localStorage.getItem("providerId"),reason:"nothing"};return console.log(l),this.http.post(r,l)}sendingImageBeforeWork(r){let l=`${this.apiUrl}users/order-history/before-work-upload-image`;return this.http.post(l,r)}completeOrder(r,l){let i=this.apiUrl+"users/order-history/order-completed-generateotp",_={orderHistoryId:r,providerId:localStorage.getItem("providerId"),userId:l};return console.log(_),this.http.post(i,_)}verifyAfterComplete(r,l){let i=this.apiUrl+"users/order-history/order-completed-verify",_={orderHistoryId:l,otp:r};return console.log(_),this.http.post(i,_)}orderHistory(){let r=localStorage.getItem("providerId"),l=this.apiUrl+"users/order-history";return this.http.get(l)}setDefult(){this.orderIds="",this.oredrDetails=[],this.userFullAddress=""}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var Ob=d=>({active:d}),Qs=(()=>{let s=class s{constructor(r){this.router=r,this.activeIcon="home"}ngOnInit(){this.router.events.subscribe(r=>{r instanceof cb&&this.setActiveIcon(r.urlAfterRedirects)}),this.setActiveIcon(this.router.url)}changeColor(r,l){this.activeIcon=r,this.router.navigate([l])}setActiveIcon(r){r.includes("home")?this.activeIcon="home":r.includes("ongoing")?this.activeIcon="Services":r.includes("earnings")?this.activeIcon="Activity":r.includes("target")&&(this.activeIcon="Account")}};s.\u0275fac=function(l){return new(l||s)(_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-fotter"]],decls:25,vars:12,consts:[[1,"fottersss"],[1,"sub-fotterss",3,"click","ngClass"],[1,"material-symbols-outlined"],[1,"names"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Oe("click",function(){return i.changeColor("home","home")}),V(2,"i",2),$(3,"home"),j(),$(4," \xA0 "),V(5,"span",3),$(6,"Home"),j()(),V(7,"div",1),Oe("click",function(){return i.changeColor("Services","ongoing")}),V(8,"i",2),$(9,"work_history"),j(),$(10,"\xA0 "),V(11,"span",3),$(12,"Ongoing"),j()(),V(13,"div",1),Oe("click",function(){return i.changeColor("Activity","earnings")}),V(14,"i",2),$(15,"payments"),j(),$(16,"\xA0 "),V(17,"span",3),$(18,"Earnings"),j()(),V(19,"div",1),Oe("click",function(){return i.changeColor("Account","target")}),V(20,"i",2),$(21,"ads_click"),j(),$(22,"\xA0 "),V(23,"span",3),$(24,"Target"),j()()()),l&2&&(ue(),Fe("ngClass",li(4,Ob,i.activeIcon==="home")),ue(6),Fe("ngClass",li(6,Ob,i.activeIcon==="Services")),ue(6),Fe("ngClass",li(8,Ob,i.activeIcon==="Activity")),ue(6),Fe("ngClass",li(10,Ob,i.activeIcon==="Account")))},dependencies:[So],styles:[".fottersss[_ngcontent-%COMP%]{border:0;width:100%;display:flex;justify-content:space-around;position:fixed;bottom:0;text-align:center;padding-top:.5rem;padding-bottom:.5rem;background-color:#fff}.sub-fotterss[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{font-size:2rem;color:#00000080}.names[_ngcontent-%COMP%]{display:none}.active[_ngcontent-%COMP%]{background-color:#d16611;border-radius:25px;padding:.5rem 1rem}.active[_ngcontent-%COMP%]   .material-symbols-outlined[_ngcontent-%COMP%]{color:#fff}.active[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{display:block;color:#fff}"]});let d=s;return d})();var rz=["footer"],oz=()=>({backdropBorderRadius:"3px",backdropBackgroundColour:"rgba(0, 0, 0, 0.5)"});function az(d,s){if(d&1&&(V(0,"div")(1,"div",25),Me(2,"img",26),j()()),d&2){let u=s.$implicit;ue(2),Fe("src",u.src,Hn)}}function sz(d,s){if(d&1&&(V(0,"div")(1,"span"),$(2),j(),V(3,"span"),Me(4,"i",30),$(5),j()()),d&2){let u=s.$implicit;ue(2),J0("",u.day,", ",u.month," ",u.date,""),ue(3),zi(" ",u.isWorking,"")}}function lz(d,s){if(d&1){let u=Kt();V(0,"div",27),Bt(1,sz,6,4,"div",11),V(2,"div",28),Oe("click",function(){_t(u);let l=dt();return bt(l.navToCal())}),V(3,"pre",29),$(4,"calendar_today"),j()()()}if(d&2){let u=dt();ue(),Fe("ngForOf",u.nextWorking)}}function cz(d,s){d&1&&(V(0,"span"),$(1,"No more jobs today"),j())}function dz(d,s){if(d&1&&(V(0,"span"),$(1),j()),d&2){let u=dt();ue(),zi("",u.noOfPendingOrders," more jobs today")}}function hz(d,s){if(d&1&&(V(0,"div")(1,"div",32)(2,"video",33),Me(3,"source",34),j()()()),d&2){let u=s.$implicit,r=dt(2);ue(3),Fe("src","https://"+r.bucketName+".s3."+r.region+".amazonaws.com/"+u.videoKey,Hn)}}function uz(d,s){if(d&1&&(V(0,"div",31),Bt(1,hz,4,1,"div",11),j()),d&2){let u=dt();ue(),Fe("ngForOf",u.data)}}function mz(d,s){if(d&1&&Me(0,"ngx-loading",24),d&2){let u=dt();Fe("show",u.loading)("config",eb(2,oz))}}var yT=(()=>{let s=class s{ngOnInit(){let r=localStorage.getItem("onlineStatus"),l=localStorage.getItem("onlineText");r!==null&&(this.online=r==="true"),l!==null&&(this.onlineText=l),this.isAccountVerify=this.logInService.isAccountVerify,this.trainingService.getingVideos().subscribe(i=>{console.log(i),this.data=i},i=>{console.log(i)})}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}navToCredit(){this.router.navigate(["credits"])}navToNotification(){this.router.navigate(["notification"])}navToCal(){this.router.navigate(["calender"])}constructor(r,l,i,_,C,I,O,N,q,ie,de){this.router=r,this.http=l,this.trainingService=i,this.logInService=_,this.userDetailsService=C,this.jobDetailsService=I,this.razorpayService=O,this.mapboxService=N,this.orderService=q,this.dialogService=ie,this.googleMapService=de,this.isDrawerOpen=!1,this.data=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.nextWorking=[],this.loading=!1,this.ads=[{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/demo/ad.png"},{src:"assets/documents/pancard.png"}],this.dates=[],this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.credits=0,this.online=!1,this.onlineText="Go",this.noOfPendingOrders=0,console.log(this.nextWorking.length),this.getProviderDetails(),this.workingDates(),this.getAvalibility(),this.getWork(),this.getCredit(),this.getPendingOrders()}getProviderDetails(){return Rn(this,null,function*(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),setTimeout(()=>{this.navToAboutUser()},2e3)})}navToAboutUser(){let r;this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe(l=>{console.log(l),r=l,r&&!this.jobDetailsService.getcheckingDetails()&&(console.log("inside",this.jobDetailsService.getcheckingDetails()),this.dialogService.openDialog("Please add the details"),this.jobDetailsService.setCheckingDetails(!0),this.router.navigate(["aboutUser"]))}),console.log(r)}workingDates(){this.nextWorking=this.dates.splice(0,2),console.log(this.nextWorking)}getAvalibility(){this.jobDetailsService.getAvailability().subscribe(r=>{console.log(r),this.formattingAvailbility(r)},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),console.log(r[0]._id),this.userDetailsService.workResponse=r[0].works,this.userDetailsService.workResponseId=r[0]._id},r=>{console.log(r)})}formattingAvailbility(r){let l=new Date;for(let i=0;i<r.length;i++){let C=r[i].date.split("T")[0],I=new Date(C),O=this.dayNames[I.getDay()],N=this.monthNames[I.getMonth()],q=I.getFullYear(),ie=I.getDate();(I>=l||I.toDateString()===l.toDateString())&&(this.dates.some(xe=>xe.date===ie&&xe.day===O&&xe.month===N&&xe.year===q)||(this.dates.push({date:ie,day:O,month:N,year:q,isWorking:"working"}),this.dates.sort((xe,ke)=>{let Ae=this.monthNames.indexOf(xe.month),Xe=this.monthNames.indexOf(ke.month);if(Ae===-1||Xe===-1)return 0;let qe=new Date(xe.year,Ae,xe.date),ut=new Date(ke.year,Xe,ke.date);return qe.getTime()-ut.getTime()})))}this.workingDates()}getCredit(){this.razorpayService.getCredits().subscribe(r=>{console.log(r),this.razorpayService.userCredit=r.creditBalance,this.credits=r.credits},r=>{console.log(r)})}onlineStatus(){try{this.loading=!0;let r=this.jobDetailsService.isVerify;console.log(r),this.online=!this.online,this.onlineText=this.online?"Off":"Go",this.googleMapService.onlineStatus=this.online,this.googleMapService.setonlineStatus(this.online,this.onlineText),localStorage.setItem("onlineStatus",this.online.toString()),localStorage.setItem("onlineText",this.onlineText),this.online&&this.googleMapService.getCoordinates().subscribe(l=>{console.log("Current Location:",l),this.sendCordinates(l),this.getname(l),alert(l?.lat),this.loading=!1},l=>{console.error("Error getting current location:",l),alert(l.error.message),this.loading=!1})}catch(r){console.error("Error in onlineStatus method:",r)}console.log(this.online)}getname(r){this.mapboxService.getPlaceNameFromCoordinates(r).subscribe(l=>{console.log("Place Name:",l),this.userDetailsService.currentCordinates=r,this.userDetailsService.currentLocation=l,this.mapboxService.placeName=l},l=>{console.error("Error getting place name:",l)})}sendCordinates(r){this.googleMapService.sendCordinates(r).subscribe({next:l=>{console.log(l),alert(l.message)},error:l=>{console.log(l),alert(l.errors.message)}})}sendTokens(){let r="",l={};this.http.post(r,l).subscribe(i=>{console.log(i)},i=>{console.log(i)})}getPendingOrders(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r);let i=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-"),_="InProgress",C=r.filter(I=>{let O=I.orderId.items[0].scheduledDate;return I.status.toLowerCase().includes(_.toLowerCase())&&O===i});console.log("filtered",C),this.noOfPendingOrders=C.length},error:r=>{console.log(r)}})}};s.\u0275fac=function(l){return new(l||s)(_e(Nt),_e(Wi),_e(jm),_e(Jn),_e(vr),_e(Fr),_e(Ko),_e(Um),_e(zr),_e(Lr),_e(Zs))},s.\u0275cmp=ft({type:s,selectors:[["app-home"]],viewQuery:function(l,i){if(l&1&&bi(rz,5),l&2){let _;fi(_=gi())&&(i.footer=_.first)}},decls:59,vars:9,consts:[[1,"container"],[1,"header"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets/logo/credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"ads-div"],[1,"wrapperrr"],[4,"ngFor","ngForOf"],[1,"sub-divs"],["class","availability-div",4,"ngIf"],[1,"new-jobs"],[1,"text-div"],[1,"icon-div"],[1,"more-jobs"],[1,"text-div1"],[1,"pending-task-div"],[1,"quick-links"],["routerLinkActive","help",1,"helps",3,"routerLink"],["id","video-div",4,"ngIf"],[2,"height","5rem"],[3,"show","config"],[1,"slidesss"],[3,"src"],[1,"availability-div"],[3,"click"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"fa","fa-circle",2,"font-size","10px"],["id","video-div"],["id","video-slidess"],["controls","","id","videoss"],["type","video/mp4",3,"src"]],template:function(l,i){l&1&&(V(0,"div",0),Me(1,"br"),V(2,"div",1)(3,"div",2),Oe("click",function(){return i.toggleDrawer()}),$(4,"\u2630"),j(),V(5,"div",3)(6,"div",4),Oe("click",function(){return i.navToCredit()}),Me(7,"img",5),V(8,"pre"),$(9),j()(),V(10,"div",6),Oe("click",function(){return i.navToNotification()}),V(11,"span",7),$(12,"notifications"),j()()()(),Me(13,"br"),V(14,"div",8)(15,"div",9)(16,"div",10),Bt(17,az,3,1,"div",11),j()(),V(18,"div",12),Bt(19,lz,5,1,"div",13),V(20,"div")(21,"div",14)(22,"div",15)(23,"span"),$(24,"No new jobs"),j(),V(25,"span"),$(26,"5 jobs missed recently"),j()(),V(27,"div",16)(28,"span",7),$(29,"arrow_forward_ios"),j()()(),Me(30,"br"),V(31,"div",17)(32,"div",18),Bt(33,cz,2,0,"span")(34,dz,2,1),j(),V(35,"div",16)(36,"span",7),$(37,"arrow_forward_ios"),j()()()(),V(38,"div",19)(39,"span"),$(40,"Pending Tasks"),j(),Me(41,"br")(42,"br"),V(43,"p"),$(44," 80 subscription jobs . 4days left to buy job pack now "),j(),V(45,"p"),$(46," Only 50 credits left.Recharge credits to get new jobs "),j()(),V(47,"div",20)(48,"div")(49,"span"),$(50,"Quick links"),j()(),V(51,"div",21)(52,"span"),$(53,"Help?"),j()()(),Bt(54,uz,2,1,"div",22),j()()(),Me(55,"div",23)(56,"router-outlet")(57,"app-fotter"),Bt(58,mz,1,3,"ngx-loading",24)),l&2&&(Si("overlap",i.isDrawerOpen),ue(9),Rt(i.credits),ue(8),Fe("ngForOf",i.ads),ue(2),Fe("ngIf",i.nextWorking.length!=0),ue(14),Vn(33,i.noOfPendingOrders===0?33:34),ue(18),Fe("routerLink","/help"),ue(3),Fe("ngIf",i.isAccountVerify),ue(4),Vn(58,i.loading?58:-1))},dependencies:[yr,cr,db,hb,ub,Pb,Qs],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;transition:padding-left .3s ease;margin-top:0}#drawer[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000;color:red;padding:20px;box-sizing:border-box;transition:transform .3s ease;transform:translate(-100%);z-index:2}#drawer.open[_ngcontent-%COMP%]{transform:translate(0);overlay:auto}.header[_ngcontent-%COMP%]{margin-top:0rem;width:90%;display:flex;justify-content:space-between}#menu-button[_ngcontent-%COMP%]{cursor:pointer;z-index:2;color:#d16611;font-size:24px}.list-menu[_ngcontent-%COMP%]{list-style-type:none;font-size:1rem;font-weight:400;font-family:Roboto Condensed}.bell-credit[_ngcontent-%COMP%]{width:max-content;height:2.5rem;display:flex;justify-content:space-between;gap:.5rem;border-radius:.2rem}.package[_ngcontent-%COMP%]{width:max-content;padding:0 .5rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]{width:5rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%], .package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center;border-radius:.4rem}.sub-container[_ngcontent-%COMP%]{width:95%;height:90vh;overflow-y:auto;scroll-snap-type:y;scroll-behavior:smooth;scrollbar-width:none}.sub-divs[_ngcontent-%COMP%]{margin-top:1rem;display:grid;row-gap:1.4rem}.ads-div[_ngcontent-%COMP%]{display:flex;height:7rem;width:100%}.wrapperrr[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}.slidesss[_ngcontent-%COMP%]{width:100%;height:100%}.slidesss[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:auto;object-fit:cover}.availability-div[_ngcontent-%COMP%]{width:98%;height:max-content;display:flex;column-gap:4%;row-gap:0;align-items:center;margin-left:.5rem;justify-content:space-between}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:22px;text-align:left}.availability-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22px;text-align:left}.new-jobs[_ngcontent-%COMP%]{width:100%;height:5rem;background-color:#d70d09;border-radius:1.3rem;color:#f5f5f5;display:flex;justify-content:space-between;align-items:center}.text-div[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;row-gap:0rem;text-align:left;align-items:center;padding-left:2rem}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(1), .pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .quick-links[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .text-div1[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-size:1.4rem;font-weight:500}.text-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-of-type(2){font-family:Inter,sans-serif;font-size:.95rem;font-weight:400}.icon-div[_ngcontent-%COMP%]{width:30%;display:flex;justify-content:center;align-items:center}.more-jobs[_ngcontent-%COMP%]{width:100%;height:4rem;background-color:#d70d09;border-radius:1.3rem;color:#fff;display:flex;align-items:center;justify-content:space-between}.text-div1[_ngcontent-%COMP%]{width:max-content;height:4rem;display:grid;justify-content:center;align-items:center;padding-left:2rem}.pending-task-div[_ngcontent-%COMP%]{text-align:left}.pending-task-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:15px;font-weight:400;line-height:16.94px;letter-spacing:.05em;text-align:left}.quick-links[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.helps[_ngcontent-%COMP%]{width:6rem;height:3rem;background-color:#20193f;color:#fff;display:flex;justify-content:center;align-items:center;border-radius:1.8rem}#video-div[_ngcontent-%COMP%]{width:100%;height:10rem;display:flex;grid-gap:.5rem;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}video[_ngcontent-%COMP%]{width:100vw;height:10rem;object-fit:cover;cursor:pointer}.online[_ngcontent-%COMP%]{background-color:#d16611;width:6rem;height:6rem;border-radius:50%;position:fixed;bottom:70px;left:40%;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:500;color:#fff;overflow:hidden}.online[_ngcontent-%COMP%]:before{content:"";position:absolute;width:50%;height:50%;border:.2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_wave 1.9s ease-out infinite;pointer-events:none}@keyframes _ngcontent-%COMP%_wave{50%{transform:scale(1);width:50%;height:50%}60%{transform:scale(1.5);width:60%;height:60%}70%{transform:scale(2);width:70%;height:70%}to{transform:scale(2.5);width:100%;height:100%}}']});let d=s;return d})();var pz=d=>({active:d});function fz(d,s){if(d&1){let u=Kt();V(0,"button",14),Oe("click",function(){let l=_t(u).$implicit,i=dt();return bt(i.setActiveButton(l))}),$(1),j()}if(d&2){let u=s.$implicit,r=dt();Fe("ngClass",li(2,pz,r.activeButton===u)),ue(),zi(" ",u," ")}}function gz(d,s){if(d&1&&(V(0,"div",15)(1,"span",16)(2,"span",17),$(3),j(),V(4,"span",18),$(5),j()(),V(6,"span",18),$(7),j()(),Me(8,"div",19)),d&2){let u=s.$implicit;ue(3),Rt(u.date),ue(2),Rt(u.details),ue(2),Rt(u.amount)}}var vT=(()=>{let s=class s{navBack(){this.location.back()}navToAddCredit(){this.router.navigate(["addCredit"])}constructor(r,l,i){this.location=r,this.router=l,this.razorpayServie=i,this.buttons=["All","Recharge","Expenses","Penalties"],this.activeButton="All",this.history=[],this.filteredCreditHistory=[],this.credits=this.razorpayServie.userCredit,console.log(this.razorpayServie.userCredit),this.getCredit()}setActiveButton(r){this.activeButton=r,this.filter(this.activeButton)}getCredit(){this.razorpayServie.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits,this.history=r.transactions,this.filteredCreditHistory=this.history},error:r=>{console.log(r)}})}filter(r){let l=this.history,i;r!="All"?(i=l.filter(_=>_.type.toLowerCase().includes(r.toLowerCase())),this.filteredCreditHistory=i):this.filteredCreditHistory=l,console.log(this.filteredCreditHistory)}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(Nt),_e(Ko))},s.\u0275cmp=ft({type:s,selectors:[["app-credit"]],decls:24,vars:2,consts:[[1,"container"],[1,"header"],[1,"arrow_back",3,"click"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"logo"],["src","assets\\documents\\credit bg.png"],[1,"credit"],[1,"credit-details"],[3,"click"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content"],[1,"content-div"],[3,"click","ngClass"],[1,"sub-content-div"],[1,"span-div"],[1,"highlight"],[1,"normal-text"],[1,"line"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2),Oe("click",function(){return i.navBack()}),V(3,"span",3),$(4,"arrow_back"),j()(),V(5,"div",4),Me(6,"img",5),j()(),V(7,"div",6)(8,"div",7)(9,"span"),$(10,"Credit balance :"),j(),$(11,"\xA0 "),V(12,"span"),$(13),j()(),V(14,"div")(15,"button",8),Oe("click",function(){return i.navToAddCredit()}),$(16,"Add+"),j()()(),V(17,"div",9)(18,"div",10),Bt(19,fz,2,4,"button",11),j(),V(20,"div",12)(21,"div",13),Or(22,gz,9,3,null,null,Lo),j()()()()),l&2&&(ue(13),Rt(i.credits),ue(6),Fe("ngForOf",i.buttons),ue(3),Rr(i.filteredCreditHistory))},dependencies:[So,yr],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh;align-items:center;text-align:center;display:grid;grid-template-rows:max-content max-content auto;row-gap:2rem;gap:2rem;grid-gap:2rem}.header[_ngcontent-%COMP%]{border:1px solid black;width:90%;height:10rem;display:flex;position:relative;left:5%;top:10%;border-radius:.8rem}.arrow_back[_ngcontent-%COMP%]{width:10%;position:relative;top:8%;left:2%}.logo[_ngcontent-%COMP%]{width:90%;display:flex;justify-content:center;align-items:center}.credit[_ngcontent-%COMP%]{width:90%;height:max-content;display:flex;justify-content:space-between;position:relative;left:5%}.credit-details[_ngcontent-%COMP%]{float:left;text-align:left}.credit-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter" sans-serif;font-weight:500;line-height:1.2rem}.credit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:4rem;height:2rem;background-color:#5ba36b;color:#fff;border:none;border-radius:.6rem}.sub-container[_ngcontent-%COMP%]{width:90%;height:70vh;position:relative;left:5%}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:2px solid #f40905}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content[_ngcontent-%COMP%]{width:100%;margin-top:.8rem}.content-div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-content-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.span-div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.highlight[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:16.94px;text-align:left}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px;text-align:left}.line[_ngcontent-%COMP%]{margin-top:.5rem;border:none;border-bottom:.25px solid black}']});let d=s;return d})();function _z(d,s){d&1&&(V(0,"span"),$(1,"Name"),j())}function bz(d,s){if(d&1&&(V(0,"span"),$(1),j()),d&2){let u=dt();ue(),Rt(u.userName)}}function yz(d,s){if(d&1){let u=Kt();Me(0,"br"),V(1,"div",12),Oe("click",function(){let l=_t(u).$implicit,i=dt();return bt(i.navTo(l.name))}),V(2,"div",12),Oe("click",function(){let l=_t(u).$implicit,i=dt();return bt(i.navTo(l.name))}),V(3,"span",11),$(4),j(),$(5," \xA0 \xA0 "),V(6,"span"),$(7),j()(),V(8,"span",11),$(9,"arrow_forward_ios"),j()(),Me(10,"hr")}if(d&2){let u=s.$implicit;ue(4),Rt(u.icon),ue(3),Rt(u.name)}}var xT=(()=>{let s=class s{constructor(r,l,i,_,C,I,O,N){this.location=r,this.router=l,this.loginService=i,this.jobDetailsService=_,this.ordersService=C,this.razorpayService=I,this.userDetals=O,this.dialougeService=N,this.userName="",this.userImage="",this.whatsAppStaus="on",this.options=[{icon:"calendar_today",name:"Calendar"},{icon:"work",name:"Job History"},{icon:"poker_chip",name:"Credits"},{icon:"tv_gen",name:"Tranning"},{icon:"featured_seasonal_and_gifts",name:"Invite a friend"},{icon:"question_mark",name:"Help Center"},{icon:"emoji_events",name:"Certificate & documents"}]}ngOnInit(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")),this.getUsername(),this.getProviderRating()}getProviderRating(){this.jobDetailsService.getRating().subscribe({next:r=>{console.log(r)},error:r=>{console.log(r)}})}getUsername(){this.jobDetailsService.getUserDetails(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r)},complete:()=>{this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image,console.log(this.jobDetailsService.userDetails),console.log(this.userName),this.apiSubscription?.unsubscribe()}})}navTo(r){switch(console.log(r),r){case"Calendar":this.router.navigate(["calender"]);break;case"Job History":this.router.navigate(["jobHistory"]);break;case"Credits":console.log("inside"),this.router.navigate(["credits"]);break;case"Tranning":this.router.navigate(["training"]);break;case"Invite a friend":this.router.navigate(["referAndEarn"]);break;case"Help Center":this.router.navigate(["help"]);break;case"Certificate & documents":this.router.navigate(["awards"]);break;case"packages":this.router.navigate(["packages"]);break;default:console.log("No matching case found")}}navToFinancial(){this.router.navigate(["financialDetails"])}navBack(){this.location.back()}navToVisiting(){let r=localStorage.getItem("providerId");this.userDetals.getUserDetails(r).subscribe({next:l=>{console.log(l),this.router.navigate(["visitingCard"])},error:l=>{console.log(l),this.dialougeService.openDialog("Provider details are missing"),this.router.navigate(["aboutUser"])}})}logOut(){this.jobDetailsService.setDefault(),this.loginService.setDefult(),this.ordersService.setDefult(),this.razorpayService.setDefault(),this.userDetals.setDefult(),this.loginService.removeUser(),this.router.navigate(["selectAccount"]),localStorage.clear()}statusChange(){this.whatsAppStaus==="on"?this.whatsAppStaus="off":(this.whatsAppStaus="off")&&(this.whatsAppStaus="on")}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(Nt),_e(Jn),_e(Fr),_e(zr),_e(Ko),_e(vr),_e(Lr))},s.\u0275cmp=ft({type:s,selectors:[["app-menu"]],decls:66,vars:4,consts:[[1,"material-symbols-outlined",3,"click"],[1,"container"],[1,"sub-container"],[1,"profile"],[1,"image"],[1,"profile-img",3,"src"],[1,"details"],[1,"details-div"],[1,"package",3,"click"],["src","assets/packages/silver coin 1.png",1,"package-img"],[1,"rating"],[1,"material-symbols-outlined"],[3,"click"],[1,"category"],[1,"updates"],[1,"finacial",3,"click"],[1,"iconss"],[1,"finacial"],[1,"fa","fa-whatsapp"],["routerLinkActive","language",1,"finacial",3,"routerLink"],[1,"btn",3,"click"]],template:function(l,i){l&1&&(Me(0,"br")(1,"br"),$(2,"\xA0\xA0 \xA0"),V(3,"span",0),Oe("click",function(){return i.navBack()}),$(4,"arrow_back"),j(),Me(5,"br")(6,"br"),V(7,"div",1)(8,"div",2)(9,"div",3)(10,"div",4),Me(11,"img",5),j(),V(12,"div",6)(13,"div",7),Bt(14,_z,2,0,"span")(15,bz,2,1),V(16,"span",8),Oe("click",function(){return i.navTo("packages")}),Me(17,"img",9),$(18,"\xA0 "),V(19,"pre"),$(20,"Silver"),j()()(),V(21,"div",10)(22,"span",11),$(23,"star"),j(),$(24," 4.89"),j(),V(25,"button",12),Oe("click",function(){return i.navToVisiting()}),$(26,"View more"),j()()(),Me(27,"br"),V(28,"div",13),Or(29,yz,11,2,null,null,Lo),j(),Me(31,"br"),V(32,"div",14)(33,"div",15),Oe("click",function(){return i.navToFinancial()}),V(34,"div",16)(35,"span",11),$(36,"currency_rupee"),j()(),V(37,"div")(38,"span"),$(39,"Financial details"),j(),Me(40,"br"),$(41," GST,PAN and bank information "),j()(),V(42,"div",17)(43,"div",16),Me(44,"span",18),j(),V(45,"div")(46,"span"),$(47,"Send whatsApp updates"),j(),Me(48,"br"),V(49,"span",12),Oe("click",function(){return i.statusChange()}),$(50),j()()(),V(51,"div",19)(52,"div",16)(53,"span",11),$(54,"g_translate"),j()(),V(55,"div")(56,"span"),$(57,"Change language"),j(),Me(58,"br"),$(59," English "),j()()(),Me(60,"br"),V(61,"div",20),Oe("click",function(){return i.logOut()}),V(62,"button")(63,"span",11),$(64,"power_settings_new"),j(),$(65,"\xA0 Logout"),j()()()()),l&2&&(ue(11),Fe("src",i.userImage?i.userImage:"assets/logo/profile.png",Hn),ue(3),Vn(14,i.userName===""?14:15),ue(15),Rr(i.options),ue(21),Rt(i.whatsAppStaus),ue(),Fe("routerLink","/language"))},dependencies:[hb,ub],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%}.profile[_ngcontent-%COMP%]{width:100%;height:9rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile-img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;display:flex;flex-direction:column;text-align:left;gap:.5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.5rem;font-family:"Inter" sans-serif;font-weight:500}.details-div[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}.details[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;width:max-content;border-bottom:2px solid black;display:flex;align-items:center}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:max-content;align-items:center}.category[_ngcontent-%COMP%]{width:100%}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.category[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .finacial[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.updates[_ngcontent-%COMP%]{border:.25px solid black;width:100%;height:11.5rem;border-radius:.5rem;display:flex;flex-direction:column;align-items:center;justify-content:center}.finacial[_ngcontent-%COMP%]{display:flex;width:100%;height:3.2rem}.iconss[_ngcontent-%COMP%]{width:20%;display:flex;justify-content:center;align-items:center;text-align:center}.iconss[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:18px;border:none;background-color:transparent;display:flex;align-items:center}.btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;color:red}']});let d=s;return d})();function vz(d,s){d&1&&(V(0,"span"),$(1,"Name"),j())}function xz(d,s){if(d&1&&(V(0,"span"),$(1),j()),d&2){let u=dt();ue(),Rt(u.userName)}}function wz(d,s){if(d&1&&$(0),d&2){let u=dt().$implicit;zi(" ",u.categoryId.name," ")}}function Cz(d,s){if(d&1&&(V(0,"span"),Bt(1,wz,1,1),j()),d&2){let u=s.index;ue(),Vn(1,u<2?1:-1)}}function Sz(d,s){if(d&1&&Bt(0,Cz,2,1,"span",19),d&2){let u=dt();Fe("ngForOf",u.workSeleceted)}}var wT=(()=>{let s=class s{constructor(r,l,i,_,C){this.router=r,this.location=l,this.jobDetailsService=i,this.logInService=_,this.userService=C,this.userImage="",this.userName="",this.userId=localStorage.getItem("providerId"),this.workSeleceted=this.jobDetailsService?.userDetails?.work,this.certificateImages=[{images:"assets/demo/awards.png"},{images:"assets/demo/certificate2.png"}]}ngOnInit(){this.signingDetails(),this.getWork(),this.getCertificates()}signingDetails(){this.phoneNumber=this.jobDetailsService.userDetails?.phone,this.userName=this.jobDetailsService.userDetails?.providerName,this.userImage=this.jobDetailsService.userDetails?.image}getWork(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works},r=>{console.log(r)})}getCertificates(){let r=localStorage.getItem("providerId");this.userService.getCertificated(r).subscribe({next:l=>{console.log(l);let i=[];for(let _=0;_<l.length;_++){let C=l[_];i.push({images:C.image})}this.certificateImages=i},error:l=>{console.log(l)},complete:()=>{this.apiSubscription?.unsubscribe()}})}navTo(){this.router.navigate(["manageServices"])}navToBack(){this.location.back()}navToVerification(){this.logInService.isAccountVerify?this.router.navigate(["identityVerification"]):this.router.navigate(["aadharVerify"])}navToCertificates(){this.router.navigate(["awards"])}};s.\u0275fac=function(l){return new(l||s)(_e(Nt),_e(_i),_e(Fr),_e(Jn),_e(vr))},s.\u0275cmp=ft({type:s,selectors:[["app-visiting-card"]],decls:67,vars:7,consts:[[1,"container"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"sub-container"],[1,"profile"],[1,"image"],["alt","User Image",3,"src"],[1,"details"],[1,"rating"],[1,"category"],[1,"ids"],[1,"tittle"],[1,"ids",3,"click"],[3,"click"],[1,"tittle2"],[1,"material-symbols-outlined"],[1,"awards-div"],[1,"awards"],[3,"src"],[2,"height","3rem"],[4,"ngFor","ngForOf"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"span",1),Oe("click",function(){return i.navToBack()}),$(2,"arrow_back"),j(),Me(3,"br"),V(4,"div",2)(5,"div",3)(6,"div",4),Me(7,"img",5),j(),V(8,"div",6),Bt(9,vz,2,0,"span")(10,xz,2,1),V(11,"div",7),$(12," \u2605 4.89 "),j(),Bt(13,Sz,1,1,"span"),j()(),V(14,"div",8)(15,"div")(16,"div",9)(17,"span",10),$(18,"My Id"),j(),V(19,"span",10),$(20),j()(),Me(21,"hr"),j(),V(22,"div")(23,"div",11),Oe("click",function(){return i.navTo()}),V(24,"span",10),$(25,"Manage Service"),j(),V(26,"span",10),$(27,"+"),j()(),Me(28,"hr"),j(),V(29,"div")(30,"div",9)(31,"div",12),Oe("click",function(){return i.navToVerification()}),V(32,"span",10),$(33,"Identity verification"),j(),Me(34,"br"),V(35,"span",13),$(36,"Identity Proof and Personal details"),j()(),V(37,"span",14),$(38,"arrow_forward_ios"),j()()()(),V(39,"div",15)(40,"span"),$(41,"Award and certificate "),j(),V(42,"div",16)(43,"div"),Me(44,"img",17),j(),V(45,"div"),Me(46,"img",17),j()(),V(47,"span",12),Oe("click",function(){return i.navToCertificates()}),$(48,"View More"),j()(),V(49,"div",15)(50,"span"),$(51,"Contact Details"),j(),V(52,"div"),Me(53,"hr"),j(),V(54,"div")(55,"pre"),$(56,"Phone"),j(),V(57,"span"),$(58),j()(),V(59,"div")(60,"pre"),$(61,"Email"),j(),V(62,"span"),$(63,"abcdgmail.com"),j()()()()(),Me(64,"br")(65,"br")(66,"div",18)),l&2&&(ue(7),Fe("src",i.userImage?i.userImage:"assets/logo/profile.png",Hn),ue(2),Vn(9,i.userName===""?9:10),ue(4),Vn(13,i.workSeleceted?13:-1),ue(7),Rt(i.userId),ue(24),Fe("src",i.certificateImages[0].images,Hn),ue(2),Fe("src",i.certificateImages[0].images,Hn),ue(12),Rt(i.phoneNumber))},dependencies:[yr],styles:['.container[_ngcontent-%COMP%]{width:100%;margin-bottom:3rem}.material-symbols-outlined[_ngcontent-%COMP%]{margin:1rem}.sub-container[_ngcontent-%COMP%]{width:90%;position:relative;left:5%;display:grid;row-gap:2rem}.profile[_ngcontent-%COMP%]{width:100%;height:8rem;display:flex;align-items:center;justify-content:space-evenly;border:.25px solid black;border-radius:.5rem}.image[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem}.profile[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%}.details[_ngcontent-%COMP%]{width:70%;height:5rem}.details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:500}.rating[_ngcontent-%COMP%]{display:flex;width:max-content;height:1.3rem;align-items:center;text-align:left}.category[_ngcontent-%COMP%]{width:100%;padding:.5rem;display:flex;flex-direction:column;gap:.8rem}.work-names[_ngcontent-%COMP%]{border:1px solid red;width:100%;display:flex;flex-direction:row}.ids[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;justify-content:space-between;margin-top:.5rem;margin-bottom:.5rem}.tittle[_ngcontent-%COMP%], .awards-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter"sans-serif;font-weight:500}.tittle2[_ngcontent-%COMP%], pre[_ngcontent-%COMP%]{font-size:1rem;font-family:"Inter"sans-serif;font-weight:400}.awards-div[_ngcontent-%COMP%]{display:grid;row-gap:1rem;border:.25px solid black;border-radius:.5rem;padding:1rem}.awards[_ngcontent-%COMP%]{width:100%;border:1px solid black;display:flex;justify-content:space-between}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:48%;height:141px}.awards[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}hr[_ngcontent-%COMP%]{color:#000}']});let d=s;return d})();var CT=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r){this.location=r}};s.\u0275fac=function(l){return new(l||s)(_e(_i))},s.\u0275cmp=ft({type:s,selectors:[["app-refer-and-earn"]],decls:54,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"refer-div"],[1,"refer"],[1,"tittle1"],["src","assets\\documents\\invite.png"],[1,"dot"],[1,"line"],[1,"links"],["src","assets\\logo\\whatsup.png"],[1,"material-symbols-outlined"],[1,"how"],[1,"steps-div"],[1,"steps"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return i.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Refer and Earn"),j()(),V(7,"div",4)(8,"div",5)(9,"div",6)(10,"div")(11,"span",7),$(12,"Refer and get FREE services "),j(),V(13,"p"),$(14,"Invite your to our company off.You win \u20B9 500 once they take services.They get instant \u20B9 500 "),j()(),V(15,"div"),Me(16,"img",8),j()(),V(17,"div",9),Me(18,"div",10),V(19,"span"),$(20,"Refer via"),j(),Me(21,"div",10),j(),V(22,"div",11)(23,"div"),Me(24,"img",12)(25,"br"),V(26,"span"),$(27,"Whatsapp"),j()(),V(28,"div")(29,"span",13),$(30,"link"),j(),Me(31,"br"),V(32,"span"),$(33,"Link"),j()()()(),V(34,"div",14)(35,"span",7),$(36,"How it works?"),j(),Me(37,"br"),V(38,"div",15)(39,"div",16)(40,"div"),$(41,"1"),j(),V(42,"span"),$(43,"Invite your friends & get rewarded"),j()(),V(44,"div",16)(45,"div"),$(46,"2"),j(),V(47,"span"),$(48,"They get free service on first order"),j()(),V(49,"div",16)(50,"div"),$(51,"3"),j(),V(52,"span"),$(53,"You get reward once their service is completed"),j()()()()()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-rows:auto auto auto;row-gap:30px;align-items:center;text-align:center;justify-content:center}.tittle[_ngcontent-%COMP%]{float:left;font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.refer-div[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.5rem}.refer[_ngcontent-%COMP%]{padding:1rem;width:90%;height:max-content;display:flex;border-radius:.4rem}.refer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:92px;height:92px}.dot[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto max-content auto}.dot[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1rem;font-weight:500;line-height:14.52px}.line[_ngcontent-%COMP%]{margin-top:8px;border:none;border-top:1.2px dashed rgb(91,90,90)}.links[_ngcontent-%COMP%]{display:flex;justify-content:space-around;padding:1rem}.tittle1[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:500;line-height:24px}.how[_ngcontent-%COMP%]{width:90%;height:max-content;padding:1rem;border:.25px solid black;border-radius:.5rem;display:grid;text-align:left}.how[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.steps-div[_ngcontent-%COMP%]{display:grid;row-gap:1.5rem}.steps[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#49a010;color:#fff;align-items:center}.steps[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:80%}']});let d=s;return d})();function Mz(d,s){d&1&&(V(0,"div",13)(1,"span"),$(2,"+"),j(),V(3,"span"),$(4,"Add Photo"),j()())}function kz(d,s){if(d&1&&Me(0,"img",14),d&2){let u=dt();Fe("src",u.imagePreview,Hn)}}function Iz(d,s){d&1&&(V(0,"div",13)(1,"span"),$(2,"+"),j(),V(3,"span"),$(4,"Add Documents"),j()())}function Tz(d,s){if(d&1&&Me(0,"img",14),d&2){let u=dt();Fe("src",u.documentPreview,Hn)}}function Ez(d,s){if(d&1&&(V(0,"div",12),Me(1,"img",15),j()),d&2){let u=s.$implicit;ue(),Fe("src",u.image,Hn)}}var ST=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r,l,i,_){this.location=r,this.http=l,this.fb=i,this.userDetalsService=_,this.apiUrl=yn,this.items=[],this.bucketName="coolie1-dev",this.region="ap-south-1",this.userId=localStorage.getItem("providerId"),this.selectedFile=null,this.selectedDocument=null,this.base64Image=null,this.imagePreview=null,this.documentPreview=null,this.getCertificates(),this.imageForm=this.fb.group({image:"",user:this.userId,isverified:!1}),console.log(this.items)}onFileSelected(r){let l=r.target;if(l.files&&l.files.length>0){this.selectedFile=l.files[0],this.imagePreview=l.files[0];let i=l.files[0],_=new FileReader;_.onload=()=>{this.imagePreview=_.result},_.readAsDataURL(this.selectedFile),console.log("image",this.imagePreview),this.imageForm.value.image=i}this.sending()}onDocumentSelected(r){let l=r.target;if(l.files&&l.files.length>0){this.selectedDocument=l.files[0],this.imagePreview=l.files[0];let i=l.files[0],_=new FileReader;_.onload=()=>{this.imagePreview=_.result},_.readAsDataURL(this.selectedDocument),console.log("image",this.imagePreview),this.imageForm.value.image=i}this.sending()}sending(){console.log("sending doc");let r=new FormData;r.append("image",this.imageForm.value.image),r.append("isVerified",this.imageForm.value.isverified),r.append("providerId",this.imageForm.value.user);let l=this.apiUrl+"providers/provider-certificate";this.http.post(l,r).subscribe({next:i=>{console.log(i),this.getCertificates()},error:i=>{console.log(i)}})}getCertificates(){this.userDetalsService.getCertificated(this.userId).subscribe({next:r=>{console.log(r),this.items=r,console.log(this.items[0].image)},error:r=>{console.log(r)},complete:()=>{this.apiSubscription?.unsubscribe()}})}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(Wi),_e(Zo),_e(vr))},s.\u0275cmp=ft({type:s,selectors:[["app-awards"]],decls:22,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"addPhoto"],["for","file-input",1,"file-label"],["class","placeholder-image",4,"ngIf"],["alt","Selected image","class","preview-image",3,"src",4,"ngIf"],[3,"formGroup"],["type","file","id","file-input","required","",1,"file-input",3,"change"],["type","file","id","document-inputs","required","",1,"file-input",3,"change"],[1,"awards"],[1,"placeholder-image"],["alt","Selected image",1,"preview-image",3,"src"],["alt","Image from AWS S3",3,"src"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return i.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0\xA0 "),V(5,"span",3),$(6,"Certificate and Documents"),j()(),V(7,"div",4)(8,"div",5)(9,"label",6),Bt(10,Mz,5,0,"div",7)(11,kz,1,1,"img",8),j(),V(12,"form",9)(13,"input",10),Oe("change",function(C){return i.onFileSelected(C)}),j()()(),V(14,"div",5)(15,"label",6),Bt(16,Iz,5,0,"div",7)(17,Tz,1,1,"img",8),j(),V(18,"form",9)(19,"input",11),Oe("change",function(C){return i.onDocumentSelected(C)}),j()()(),Or(20,Ez,2,1,"div",12,Lo),j()()),l&2&&(ue(10),Fe("ngIf",!i.selectedFile),ue(),Fe("ngIf",i.selectedFile),ue(),Fe("formGroup",i.imageForm),ue(4),Fe("ngIf",!i.selectedDocument),ue(),Fe("ngIf",i.selectedDocument),ue(),Fe("formGroup",i.imageForm),ue(2),Rr(i.items))},dependencies:[cr,ko,Mo,Yo],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:max-content;position:relative;top:5%;left:5%;display:grid;grid-template-columns:auto auto;row-gap:30px;column-gap:30px;align-items:center;text-align:center;justify-content:space-around}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.2rem;font-weight:400;line-height:24px}.addPhoto[_ngcontent-%COMP%]{width:8.5rem;height:8rem;display:grid;align-items:center;border:1px dashed black}span[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"Inter" sans-serif;font-weight:600;line-height:19px}.awards[_ngcontent-%COMP%]{width:8.5rem;height:8rem}.awards[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.file-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:60%;cursor:pointer;position:relative}.file-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.placeholder-image[_ngcontent-%COMP%]{display:grid;row-gap:1rem}.preview-image[_ngcontent-%COMP%]{width:10rem;height:8rem}']});let d=s;return d})();var Dz=["path"],Az=Math.PI/180,Pz=(()=>{let s=class s{constructor(r){this.supportsSvg=!!(r&&r.createElementNS&&r.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),this.base=r&&r.head.querySelector("base"),this.hasPerf=typeof window<"u"&&window.performance&&window.performance.now&&typeof window.performance.now()=="number"}resolveColor(r){if(this.base&&this.base.href){let l=r.indexOf("#");if(l>-1&&r.indexOf("url")>-1)return r.slice(0,l)+location.href+r.slice(l)}return r}getTimestamp(){return this.hasPerf?window.performance.now():Date.now()}getArc(r,l,i,_,C=!1){let I=Math.max(0,Math.min(r||0,l)),O=C?180:359.9999,N=l===0?O:I/l*O,q=this._polarToCartesian(_,i,N),ie=this._polarToCartesian(_,i,0),de=N<=180?0:1;return`M ${q} A ${i} ${i} 0 ${de} 0 ${ie}`}_polarToCartesian(r,l,i){let _=(i-90)*Az,C=r+l*Math.cos(_),I=r+l*Math.sin(_);return C+" "+I}};s.\u0275fac=function(l){return new(l||s)(st(un,8))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),MT={radius:125,animation:"easeOutCubic",animationDelay:void 0,duration:500,stroke:15,color:"#45CCCE",background:"#EAEAEA",responsive:!1,clockwise:!0,semicircle:!1,rounded:!1},kT=new pn("ROUND_PROGRESS_DEFAULTS",{providedIn:"root",factory:()=>MT}),Oz={provide:kT,useValue:MT},Rz=(()=>{let s=class s{linearEase(r,l,i,_){return i*r/_+l}easeInQuad(r,l,i,_){return i*(r/=_)*r+l}easeOutQuad(r,l,i,_){return-i*(r/=_)*(r-2)+l}easeInOutQuad(r,l,i,_){return(r/=_/2)<1?i/2*r*r+l:-i/2*(--r*(r-2)-1)+l}easeInCubic(r,l,i,_){return i*(r/=_)*r*r+l}easeOutCubic(r,l,i,_){return i*((r=r/_-1)*r*r+1)+l}easeInOutCubic(r,l,i,_){return(r/=_/2)<1?i/2*r*r*r+l:i/2*((r-=2)*r*r+2)+l}easeInQuart(r,l,i,_){return i*(r/=_)*r*r*r+l}easeOutQuart(r,l,i,_){return-i*((r=r/_-1)*r*r*r-1)+l}easeInOutQuart(r,l,i,_){return(r/=_/2)<1?i/2*r*r*r*r+l:-i/2*((r-=2)*r*r*r-2)+l}easeInQuint(r,l,i,_){return i*(r/=_)*r*r*r*r+l}easeOutQuint(r,l,i,_){return i*((r=r/_-1)*r*r*r*r+1)+l}easeInOutQuint(r,l,i,_){return(r/=_/2)<1?i/2*r*r*r*r*r+l:i/2*((r-=2)*r*r*r*r+2)+l}easeInSine(r,l,i,_){return-i*Math.cos(r/_*(Math.PI/2))+i+l}easeOutSine(r,l,i,_){return i*Math.sin(r/_*(Math.PI/2))+l}easeInOutSine(r,l,i,_){return-i/2*(Math.cos(Math.PI*r/_)-1)+l}easeInExpo(r,l,i,_){return r===0?l:i*Math.pow(2,10*(r/_-1))+l}easeOutExpo(r,l,i,_){return r===_?l+i:i*(-Math.pow(2,-10*r/_)+1)+l}easeInOutExpo(r,l,i,_){return r===0?l:r===_?l+i:(r/=_/2)<1?i/2*Math.pow(2,10*(r-1))+l:i/2*(-Math.pow(2,-10*--r)+2)+l}easeInCirc(r,l,i,_){return-i*(Math.sqrt(1-(r/=_)*r)-1)+l}easeOutCirc(r,l,i,_){return i*Math.sqrt(1-(r=r/_-1)*r)+l}easeInOutCirc(r,l,i,_){return(r/=_/2)<1?-i/2*(Math.sqrt(1-r*r)-1)+l:i/2*(Math.sqrt(1-(r-=2)*r)+1)+l}easeInElastic(r,l,i,_){let C=_*.3,I=1.70158,O=i;return r===0?l:(r/=_)===1?l+i:(O<Math.abs(i)?(O=i,I=C/4):I=C/(2*Math.PI)*Math.asin(i/O),-(O*Math.pow(2,10*r--)*Math.sin((r*_-I)*(2*Math.PI)/C))+l)}easeOutElastic(r,l,i,_){let C=_*.3,I=1.70158,O=i;return r===0?l:(r/=_)===1?l+i:(O<Math.abs(i)?(O=i,I=C/4):I=C/(2*Math.PI)*Math.asin(i/O),O*Math.pow(2,-10*r)*Math.sin((r*_-I)*(2*Math.PI)/C)+i+l)}easeInOutElastic(r,l,i,_){let C=_*.44999999999999996,I=1.70158,O=i;return r===0?l:(r/=_/2)===2?l+i:(O<Math.abs(i)?(O=i,I=C/4):I=C/(2*Math.PI)*Math.asin(i/O),r<1?-.5*(O*Math.pow(2,10*(r-=1))*Math.sin((r*_-I)*(2*Math.PI)/C))+l:O*Math.pow(2,-10*(r-=1))*Math.sin((r*_-I)*(2*Math.PI)/C)*.5+i+l)}easeInBack(r,l,i,_,C=1.70158){return i*(r/=_)*r*((C+1)*r-C)+l}easeOutBack(r,l,i,_,C=1.70158){return i*((r=r/_-1)*r*((C+1)*r+C)+1)+l}easeInOutBack(r,l,i,_,C=1.70158){return(r/=_/2)<1?i/2*(r*r*(((C*=1.525)+1)*r-C))+l:i/2*((r-=2)*r*(((C*=1.525)+1)*r+C)+2)+l}easeInBounce(r,l,i,_){return i-this.easeOutBounce(_-r,0,i,_)+l}easeOutBounce(r,l,i,_){return(r/=_)<1/2.75?i*(7.5625*r*r)+l:r<2/2.75?i*(7.5625*(r-=1.5/2.75)*r+.75)+l:r<2.5/2.75?i*(7.5625*(r-=2.25/2.75)*r+.9375)+l:i*(7.5625*(r-=2.625/2.75)*r+.984375)+l}easeInOutBounce(r,l,i,_){return r<_/2?this.easeInBounce(r*2,0,i,_)*.5+l:this.easeOutBounce(r*2-_,0,i,_)*.5+i*.5+l}};s.\u0275fac=function(l){return new(l||s)},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})(),Lb=(()=>{let s=class s{constructor(r,l,i,_){this.service=r,this.easing=l,this.defaults=i,this.ngZone=_,this.currentLinecap="",this.current=0,this.max=0,this.radius=this.defaults.radius,this.animation=this.defaults.animation,this.animationDelay=this.defaults.animationDelay,this.duration=this.defaults.duration,this.stroke=this.defaults.stroke,this.color=this.defaults.color,this.background=this.defaults.background,this.responsive=this.defaults.responsive,this.clockwise=this.defaults.clockwise,this.semicircle=this.defaults.semicircle,this.rounded=this.defaults.rounded,this.onRender=new an,this.lastAnimationId=0}_animateChange(r,l){typeof r!="number"&&(r=0),l=this._clamp(l),r=this._clamp(r);let i=this,_=l-r,C=i.duration;i.ngZone.runOutsideAngular(()=>{let I=()=>{let O=i.service.getTimestamp(),N=++i.lastAnimationId;requestAnimationFrame(function q(){let ie=Math.min(i.service.getTimestamp()-O,C),de=i.easing[i.animation],xe=de(ie,r,_,C);i._updatePath(xe),i.onRender.observers.length>0&&i.onRender.emit(xe),N===i.lastAnimationId&&ie<C&&requestAnimationFrame(q)})};this.animationDelay>0?setTimeout(I,this.animationDelay):I()})}_updatePath(r){if(this.path){let l=this.service.getArc(r,this.max,this.radius-this.stroke/2,this.radius,this.semicircle),i=this.path.nativeElement,_=this.rounded&&r>0?"round":"";_!==this.currentLinecap&&(this.currentLinecap=_,i.style.strokeLinecap=_),i.setAttribute("d",l)}}_clamp(r){return Math.max(0,Math.min(r||0,this.max))}getPathTransform(){let r=this._getDiameter();return this.semicircle?this.clockwise?`translate(0, ${r}) rotate(-90)`:`translate(${r+","+r}) rotate(90) scale(-1, 1)`:this.clockwise?null:`scale(-1, 1) translate(-${r} 0)`}resolveColor(r){return this.service.resolveColor(r)}ngOnChanges(r){r.current?this._animateChange(r.current.previousValue,r.current.currentValue):this._updatePath(this.current)}_getDiameter(){return this.radius*2}_getElementHeight(){return this.responsive?null:(this.semicircle?this.radius:this._getDiameter())+"px"}_getViewBox(){let r=this._getDiameter();return`0 0 ${r} ${this.semicircle?this.radius:r}`}_getPaddingBottom(){return this.responsive?this.semicircle?"50%":"100%":null}};s.\u0275fac=function(l){return new(l||s)(_e(Pz),_e(Rz),_e(kT),_e(Fi))},s.\u0275cmp=ft({type:s,selectors:[["round-progress"]],viewQuery:function(l,i){if(l&1&&bi(Dz,5),l&2){let _;fi(_=gi())&&(i.path=_.first)}},hostAttrs:["role","progressbar"],hostVars:11,hostBindings:function(l,i){l&2&&(bn("aria-valuemin",0)("aria-valuemax",i.max)("aria-valuenow",i.current),za("width",i.responsive?"":i._getDiameter()+"px")("height",i._getElementHeight())("padding-bottom",i._getPaddingBottom()),Si("responsive",i.responsive))},inputs:{current:"current",max:"max",radius:"radius",animation:"animation",animationDelay:"animationDelay",duration:"duration",stroke:"stroke",color:"color",background:"background",responsive:"responsive",clockwise:"clockwise",semicircle:"semicircle",rounded:"rounded"},outputs:{onRender:"onRender"},standalone:!0,features:[xo,jn],decls:4,vars:13,consts:[["path",""],["xmlns","http://www.w3.org/2000/svg"],["fill","none"]],template:function(l,i){l&1&&(sd(),V(0,"svg",1),Me(1,"circle",2)(2,"path",2,0),j()),l&2&&(bn("viewBox",i._getViewBox()),ue(),za("stroke",i.resolveColor(i.background))("stroke-width",i.stroke),bn("cx",i.radius)("cy",i.radius)("r",i.radius-i.stroke/2),ue(),za("stroke-width",i.stroke)("stroke",i.resolveColor(i.color)),bn("transform",i.getPathTransform()))},styles:["[_nghost-%COMP%]{display:block;position:relative;overflow:hidden}.responsive[_nghost-%COMP%]{width:100%;padding-bottom:100%}.responsive[_nghost-%COMP%] > svg[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0}"],changeDetection:0});let d=s;return d})(),IT=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({providers:[Oz]});let d=s;return d})();var ET=d=>({color:d}),DT=(()=>{let s=class s{constructor(r,l,i){this.http=r,this.router=l,this.razorpayService=i,this.apiUrl=yn,this.enteredValue=0,this.maxValue=5,this.minTarget=0,this.min=80,this.divColor="black",this.creditBalance=50,this.isDrawerOpen=!1,this.current=0,this.max=5,this.radius=150,this.semicircle=!0,this.color="black",this.background="#eaeaea",this.cancelRate=0,this.workingHours=0,this.credits=0,this.colorChange(),this.getTarget(),this.getCredits()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}colorChange(){this.minTarget<this.min&&(this.divColor="red")}calculateProgress(r,l){let i=r+5;return l===0?0:i/l*100}toggleDrawer(){this.isDrawerOpen=!this.isDrawerOpen,this.router.navigate(["menu"])}increment(r=1){this.current+=r}getOverlayStyle(){let r=this.semicircle,l=(r?"":"translateY(-50%) ")+"translateX(-50%)";return{top:r?"auto":"50%",bottom:r?"5%":"auto",left:"50%",transform:l,"font-size":this.radius/3.5+"px"}}getTarget(){let r=localStorage.getItem("providerId"),l=`${this.apiUrl}providers/service-provider-targets/${r}`;this.http.get(l).subscribe(i=>{console.log(i),this.current=i.specialRating,this.minTarget=i.responseRate,this.cancelRate=i.cancellationRate,this.workingHours=i.totalWorkingHours},i=>{console.log(i)})}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"buyNow":this.router.navigate(["addCredit"])}}};s.\u0275fac=function(l){return new(l||s)(_e(Wi),_e(Nt),_e(Ko))},s.\u0275cmp=ft({type:s,selectors:[["app-target"]],decls:70,vars:21,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"container-target"],[1,"progress-wrapper"],[1,"current",3,"ngStyle"],[3,"current","max","color","background","radius","semicircle","rounded","stroke"],[1,"progress-content"],[1,"fa","fa-star"],[1,"section-div"],[1,"section"],[1,"info"],[1,"sub-info"],[1,"material-symbols-outlined",3,"ngStyle"],[2,"font-size","1.4rem",3,"ngStyle"],[1,"material-symbols-outlined",2,"color","red","font-size","28px"],[1,"credit-balance-div"],[3,"click"],[2,"height","10rem"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Oe("click",function(){return i.toggleDrawer()}),$(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Oe("click",function(){return i.navTo("credit")}),Me(5,"img",4),V(6,"pre"),$(7),j()(),V(8,"div",5),Oe("click",function(){return i.navTo("notification")}),V(9,"span",6),$(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),$(15),j(),Me(16,"round-progress",11),V(17,"div",12),Me(18,"br"),V(19,"div"),Me(20,"span",13),V(21,"span"),$(22,"Min : 4.7"),j()()()()(),V(23,"div",14)(24,"div",15)(25,"span",6),$(26,"schedule"),j(),Me(27,"br")(28,"br"),V(29,"span",16),$(30),j(),Me(31,"br"),V(32,"span",17),$(33,"Weekend hours"),j()(),V(34,"div",15)(35,"span",18),$(36,"draft"),j(),$(37," \xA0"),V(38,"span",19),$(39,"Min:80%"),j(),Me(40,"br")(41,"br"),V(42,"span",16),$(43),j(),Me(44,"br"),V(45,"span",17),$(46,"Response rate"),j()(),V(47,"div",15)(48,"span",20),$(49,"privacy_tip"),j(),Me(50,"br")(51,"br"),V(52,"span",16),$(53),j(),Me(54,"br"),V(55,"span",17),$(56,"Cancellation"),j()()(),Me(57,"br"),V(58,"div",21)(59,"span",17),$(60),j(),Me(61,"br")(62,"br"),V(63,"div")(64,"button",22),Oe("click",function(){return i.navTo("buyNow")}),$(65,"Buy now"),j(),V(66,"button"),$(67,"See details"),j()()()()(),Me(68,"div",23)(69,"app-fotter")),l&2&&(ue(7),Rt(i.credits),ue(7),Fe("ngStyle",i.getOverlayStyle()),ue(),zi("",i.current,"%"),ue(),Fe("current",i.current)("max",i.max)("color",i.color)("background",i.background)("radius",i.radius)("semicircle",i.semicircle)("rounded",!0)("stroke",20),ue(14),zi("",i.workingHours," HRS"),ue(5),Fe("ngStyle",li(17,ET,i.divColor)),ue(3),Fe("ngStyle",li(19,ET,i.divColor)),ue(5),zi("",i.minTarget,"%"),ue(10),Rt(i.cancelRate),ue(7),zi("Credit Balance ",i.credits,""))},dependencies:[ib,Lb,Qs],styles:['.left-half-spinner-container[_ngcontent-%COMP%]{position:relative;width:100px;height:100px;overflow:hidden;transform:rotate(90deg)}.left-half-spinner-container[_ngcontent-%COMP%]   .mat-progress-spinner[_ngcontent-%COMP%]{width:100px;height:100px}.left-half-spinner-container[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;right:0;width:50%;height:100%;background:#fff;z-index:1}.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%;margin-bottom:5rem}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#000;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:9rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:6rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border:1px solid black;width:2.3rem;border-radius:.4rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.section-div[_ngcontent-%COMP%]{display:grid;grid-template-columns:45% 45%;column-gap:2%;width:100%;height:max-content;justify-content:space-around}.section[_ngcontent-%COMP%]{border:.25px solid black;border-radius:.4rem;height:7rem;margin-top:2rem;padding:2rem 1rem 1rem;text-align:left}.info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:600;line-height:19.36px}.sub-info[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px}.credit-balance-div[_ngcontent-%COMP%]{width:88%;height:5.5rem;border:.25px solid black;text-align:left;padding:1rem;padding-left:6%;border-radius:.8rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:max-content;height:2rem;display:flex;align-items:center;justify-content:center;font-family:"Inter" sans-serif;font-size:14px;font-weight:500;line-height:16.94px;border-radius:.5rem}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#3cc04b;color:#fff;border:none}.credit-balance-div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:transparent;border:.25 solid black}.credit-balance-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:grid;grid-template-columns:auto auto;column-gap:1rem}cf[_ngcontent-%COMP%]:before, .cf[_ngcontent-%COMP%]:after{content:" ";display:table}.cf[_ngcontent-%COMP%]:after{clear:both}.progress-wrapper[_ngcontent-%COMP%]{position:relative;margin:20px auto;font-size:40px}.current[_ngcontent-%COMP%]{position:absolute;color:#bbb;font-weight:100;line-height:1}round-progress[_ngcontent-%COMP%]{margin:auto}.container-target[_ngcontent-%COMP%]{width:80%;max-width:650px;margin:40px auto 80px;text-align:center;padding:40px;background:#fff;border:solid 1px #ccc;border-radius:4px}button[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background:#45ccce;color:#fff;font-size:16px;border:none;cursor:pointer;border-radius:4px;text-align:center;margin:0 5px 5px 0}button[_ngcontent-%COMP%]:nth-child(2){color:#000;border:.25px solid black;border-radius:4px;display:inline-block;text-align:center}form[_ngcontent-%COMP%]{text-align:left;max-width:350px;margin:30px auto}form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:15px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{float:right;padding:5px;width:150px}input[type=checkbox][_ngcontent-%COMP%]{width:auto}input[type=color][_ngcontent-%COMP%]{height:30px}.back[_ngcontent-%COMP%]{position:fixed;top:5px;right:5px}.progress-container[_ngcontent-%COMP%]   round-progress[_ngcontent-%COMP%]{position:relative;z-index:1}.progress-content[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%,-50%);text-align:center;font-size:1.1rem;font-weight:400;line-height:1.2;z-index:2}.progress-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;top:.5rem;display:flex;flex-direction:column}@media (max-width: 650px){.back[_ngcontent-%COMP%]{position:static;display:block;text-align:center}h2[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{margin-bottom:20px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;margin-top:5px;float:none}.container-target[_ngcontent-%COMP%]{margin:0 auto 50px;padding:25px}}']});let d=s;return d})();function xg(d){return d+.5|0}var bd=(d,s,u)=>Math.max(Math.min(d,u),s);function yg(d){return bd(xg(d*2.55),0,255)}function yd(d){return bd(xg(d*255),0,255)}function Gl(d){return bd(xg(d/2.55)/100,0,1)}function AT(d){return bd(xg(d*100),0,100)}var Ga={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},tw=[..."0123456789ABCDEF"],Lz=d=>tw[d&15],Fz=d=>tw[(d&240)>>4]+tw[d&15],Fb=d=>(d&240)>>4===(d&15),zz=d=>Fb(d.r)&&Fb(d.g)&&Fb(d.b)&&Fb(d.a);function Bz(d){var s=d.length,u;return d[0]==="#"&&(s===4||s===5?u={r:255&Ga[d[1]]*17,g:255&Ga[d[2]]*17,b:255&Ga[d[3]]*17,a:s===5?Ga[d[4]]*17:255}:(s===7||s===9)&&(u={r:Ga[d[1]]<<4|Ga[d[2]],g:Ga[d[3]]<<4|Ga[d[4]],b:Ga[d[5]]<<4|Ga[d[6]],a:s===9?Ga[d[7]]<<4|Ga[d[8]]:255})),u}var Nz=(d,s)=>d<255?s(d):"";function Vz(d){var s=zz(d)?Lz:Fz;return d?"#"+s(d.r)+s(d.g)+s(d.b)+Nz(d.a,s):void 0}var jz=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function LT(d,s,u){let r=s*Math.min(u,1-u),l=(i,_=(i+d/30)%12)=>u-r*Math.max(Math.min(_-3,9-_,1),-1);return[l(0),l(8),l(4)]}function Uz(d,s,u){let r=(l,i=(l+d/60)%6)=>u-u*s*Math.max(Math.min(i,4-i,1),0);return[r(5),r(3),r(1)]}function Hz(d,s,u){let r=LT(d,1,.5),l;for(s+u>1&&(l=1/(s+u),s*=l,u*=l),l=0;l<3;l++)r[l]*=1-s-u,r[l]+=s;return r}function Wz(d,s,u,r,l){return d===l?(s-u)/r+(s<u?6:0):s===l?(u-d)/r+2:(d-s)/r+4}function iw(d){let u=d.r/255,r=d.g/255,l=d.b/255,i=Math.max(u,r,l),_=Math.min(u,r,l),C=(i+_)/2,I,O,N;return i!==_&&(N=i-_,O=C>.5?N/(2-i-_):N/(i+_),I=Wz(u,r,l,N,i),I=I*60+.5),[I|0,O||0,C]}function nw(d,s,u,r){return(Array.isArray(s)?d(s[0],s[1],s[2]):d(s,u,r)).map(yd)}function rw(d,s,u){return nw(LT,d,s,u)}function Gz(d,s,u){return nw(Hz,d,s,u)}function qz(d,s,u){return nw(Uz,d,s,u)}function FT(d){return(d%360+360)%360}function $z(d){let s=jz.exec(d),u=255,r;if(!s)return;s[5]!==r&&(u=s[6]?yg(+s[5]):yd(+s[5]));let l=FT(+s[2]),i=+s[3]/100,_=+s[4]/100;return s[1]==="hwb"?r=Gz(l,i,_):s[1]==="hsv"?r=qz(l,i,_):r=rw(l,i,_),{r:r[0],g:r[1],b:r[2],a:u}}function Yz(d,s){var u=iw(d);u[0]=FT(u[0]+s),u=rw(u),d.r=u[0],d.g=u[1],d.b=u[2]}function Zz(d){if(!d)return;let s=iw(d),u=s[0],r=AT(s[1]),l=AT(s[2]);return d.a<255?`hsla(${u}, ${r}%, ${l}%, ${Gl(d.a)})`:`hsl(${u}, ${r}%, ${l}%)`}var PT={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},OT={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Xz(){let d={},s=Object.keys(OT),u=Object.keys(PT),r,l,i,_,C;for(r=0;r<s.length;r++){for(_=C=s[r],l=0;l<u.length;l++)i=u[l],C=C.replace(i,PT[i]);i=parseInt(OT[_],16),d[C]=[i>>16&255,i>>8&255,i&255]}return d}var zb;function Qz(d){zb||(zb=Xz(),zb.transparent=[0,0,0,0]);let s=zb[d.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:s.length===4?s[3]:255}}var Kz=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Jz(d){let s=Kz.exec(d),u=255,r,l,i;if(s){if(s[7]!==r){let _=+s[7];u=s[8]?yg(_):bd(_*255,0,255)}return r=+s[1],l=+s[3],i=+s[5],r=255&(s[2]?yg(r):bd(r,0,255)),l=255&(s[4]?yg(l):bd(l,0,255)),i=255&(s[6]?yg(i):bd(i,0,255)),{r,g:l,b:i,a:u}}}function e5(d){return d&&(d.a<255?`rgba(${d.r}, ${d.g}, ${d.b}, ${Gl(d.a)})`:`rgb(${d.r}, ${d.g}, ${d.b})`)}var ew=d=>d<=.0031308?d*12.92:Math.pow(d,1/2.4)*1.055-.055,Hm=d=>d<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4);function t5(d,s,u){let r=Hm(Gl(d.r)),l=Hm(Gl(d.g)),i=Hm(Gl(d.b));return{r:yd(ew(r+u*(Hm(Gl(s.r))-r))),g:yd(ew(l+u*(Hm(Gl(s.g))-l))),b:yd(ew(i+u*(Hm(Gl(s.b))-i))),a:d.a+u*(s.a-d.a)}}function Bb(d,s,u){if(d){let r=iw(d);r[s]=Math.max(0,Math.min(r[s]+r[s]*u,s===0?360:1)),r=rw(r),d.r=r[0],d.g=r[1],d.b=r[2]}}function zT(d,s){return d&&Object.assign(s||{},d)}function RT(d){var s={r:0,g:0,b:0,a:255};return Array.isArray(d)?d.length>=3&&(s={r:d[0],g:d[1],b:d[2],a:255},d.length>3&&(s.a=yd(d[3]))):(s=zT(d,{r:0,g:0,b:0,a:1}),s.a=yd(s.a)),s}function i5(d){return d.charAt(0)==="r"?Jz(d):$z(d)}var vg=class d{constructor(s){if(s instanceof d)return s;let u=typeof s,r;u==="object"?r=RT(s):u==="string"&&(r=Bz(s)||Qz(s)||i5(s)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var s=zT(this._rgb);return s&&(s.a=Gl(s.a)),s}set rgb(s){this._rgb=RT(s)}rgbString(){return this._valid?e5(this._rgb):void 0}hexString(){return this._valid?Vz(this._rgb):void 0}hslString(){return this._valid?Zz(this._rgb):void 0}mix(s,u){if(s){let r=this.rgb,l=s.rgb,i,_=u===i?.5:u,C=2*_-1,I=r.a-l.a,O=((C*I===-1?C:(C+I)/(1+C*I))+1)/2;i=1-O,r.r=255&O*r.r+i*l.r+.5,r.g=255&O*r.g+i*l.g+.5,r.b=255&O*r.b+i*l.b+.5,r.a=_*r.a+(1-_)*l.a,this.rgb=r}return this}interpolate(s,u){return s&&(this._rgb=t5(this._rgb,s._rgb,u)),this}clone(){return new d(this.rgb)}alpha(s){return this._rgb.a=yd(s),this}clearer(s){let u=this._rgb;return u.a*=1-s,this}greyscale(){let s=this._rgb,u=xg(s.r*.3+s.g*.59+s.b*.11);return s.r=s.g=s.b=u,this}opaquer(s){let u=this._rgb;return u.a*=1+s,this}negate(){let s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return Bb(this._rgb,2,s),this}darken(s){return Bb(this._rgb,2,-s),this}saturate(s){return Bb(this._rgb,1,s),this}desaturate(s){return Bb(this._rgb,1,-s),this}rotate(s){return Yz(this._rgb,s),this}};function el(){}var YT=(()=>{let d=0;return()=>d++})();function vn(d){return d===null||typeof d>"u"}function er(d){if(Array.isArray&&Array.isArray(d))return!0;let s=Object.prototype.toString.call(d);return s.slice(0,7)==="[object"&&s.slice(-6)==="Array]"}function ln(d){return d!==null&&Object.prototype.toString.call(d)==="[object Object]"}function pr(d){return(typeof d=="number"||d instanceof Number)&&isFinite(+d)}function ea(d,s){return pr(d)?d:s}function Yi(d,s){return typeof d>"u"?s:d}var ZT=(d,s)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100:+d/s,lw=(d,s)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100*s:+d;function Gn(d,s,u){if(d&&typeof d.call=="function")return d.apply(u,s)}function Ln(d,s,u,r){let l,i,_;if(er(d))if(i=d.length,r)for(l=i-1;l>=0;l--)s.call(u,d[l],l);else for(l=0;l<i;l++)s.call(u,d[l],l);else if(ln(d))for(_=Object.keys(d),i=_.length,l=0;l<i;l++)s.call(u,d[_[l]],_[l])}function Sg(d,s){let u,r,l,i;if(!d||!s||d.length!==s.length)return!1;for(u=0,r=d.length;u<r;++u)if(l=d[u],i=s[u],l.datasetIndex!==i.datasetIndex||l.index!==i.index)return!1;return!0}function Ub(d){if(er(d))return d.map(Ub);if(ln(d)){let s=Object.create(null),u=Object.keys(d),r=u.length,l=0;for(;l<r;++l)s[u[l]]=Ub(d[u[l]]);return s}return d}function XT(d){return["__proto__","prototype","constructor"].indexOf(d)===-1}function n5(d,s,u,r){if(!XT(d))return;let l=s[d],i=u[d];ln(l)&&ln(i)?Gm(l,i,r):s[d]=Ub(i)}function Gm(d,s,u){let r=er(s)?s:[s],l=r.length;if(!ln(d))return d;u=u||{};let i=u.merger||n5,_;for(let C=0;C<l;++C){if(_=r[C],!ln(_))continue;let I=Object.keys(_);for(let O=0,N=I.length;O<N;++O)i(I[O],d,_,u)}return d}function $m(d,s){return Gm(d,s,{merger:r5})}function r5(d,s,u){if(!XT(d))return;let r=s[d],l=u[d];ln(r)&&ln(l)?$m(r,l):Object.prototype.hasOwnProperty.call(s,d)||(s[d]=Ub(l))}var BT={"":d=>d,x:d=>d.x,y:d=>d.y};function o5(d){let s=d.split("."),u=[],r="";for(let l of s)r+=l,r.endsWith("\\")?r=r.slice(0,-1)+".":(u.push(r),r="");return u}function a5(d){let s=o5(d);return u=>{for(let r of s){if(r==="")break;u=u&&u[r]}return u}}function Yl(d,s){return(BT[s]||(BT[s]=a5(s)))(d)}function qb(d){return d.charAt(0).toUpperCase()+d.slice(1)}var Ym=d=>typeof d<"u",ql=d=>typeof d=="function",cw=(d,s)=>{if(d.size!==s.size)return!1;for(let u of d)if(!s.has(u))return!1;return!0};function QT(d){return d.type==="mouseup"||d.type==="click"||d.type==="contextmenu"}var tr=Math.PI,ir=2*tr,s5=ir+tr,Hb=Number.POSITIVE_INFINITY,l5=tr/180,xr=tr/2,Yh=tr/4,NT=tr*2/3,$l=Math.log10,ws=Math.sign;function Zm(d,s,u){return Math.abs(d-s)<u}function dw(d){let s=Math.round(d);d=Zm(d,s,d/1e3)?s:d;let u=Math.pow(10,Math.floor($l(d))),r=d/u;return(r<=1?1:r<=2?2:r<=5?5:10)*u}function KT(d){let s=[],u=Math.sqrt(d),r;for(r=1;r<u;r++)d%r===0&&(s.push(r),s.push(d/r));return u===(u|0)&&s.push(u),s.sort((l,i)=>l-i).pop(),s}function Qh(d){return!isNaN(parseFloat(d))&&isFinite(d)}function JT(d,s){let u=Math.round(d);return u-s<=d&&u+s>=d}function hw(d,s,u){let r,l,i;for(r=0,l=d.length;r<l;r++)i=d[r][u],isNaN(i)||(s.min=Math.min(s.min,i),s.max=Math.max(s.max,i))}function qa(d){return d*(tr/180)}function $b(d){return d*(180/tr)}function uw(d){if(!pr(d))return;let s=1,u=0;for(;Math.round(d*s)/s!==d;)s*=10,u++;return u}function mw(d,s){let u=s.x-d.x,r=s.y-d.y,l=Math.sqrt(u*u+r*r),i=Math.atan2(r,u);return i<-.5*tr&&(i+=ir),{angle:i,distance:l}}function Wb(d,s){return Math.sqrt(Math.pow(s.x-d.x,2)+Math.pow(s.y-d.y,2))}function c5(d,s){return(d-s+s5)%ir-tr}function Jo(d){return(d%ir+ir)%ir}function Xm(d,s,u,r){let l=Jo(d),i=Jo(s),_=Jo(u),C=Jo(i-l),I=Jo(_-l),O=Jo(l-i),N=Jo(l-_);return l===i||l===_||r&&i===_||C>I&&O<N}function Zr(d,s,u){return Math.max(s,Math.min(u,d))}function eE(d){return Zr(d,-32768,32767)}function tl(d,s,u,r=1e-6){return d>=Math.min(s,u)-r&&d<=Math.max(s,u)+r}function Yb(d,s,u){u=u||(_=>d[_]<s);let r=d.length-1,l=0,i;for(;r-l>1;)i=l+r>>1,u(i)?l=i:r=i;return{lo:l,hi:r}}var Ks=(d,s,u,r)=>Yb(d,u,r?l=>{let i=d[l][s];return i<u||i===u&&d[l+1][s]===u}:l=>d[l][s]<u),tE=(d,s,u)=>Yb(d,u,r=>d[r][s]>=u);function iE(d,s,u){let r=0,l=d.length;for(;r<l&&d[r]<s;)r++;for(;l>r&&d[l-1]>u;)l--;return r>0||l<d.length?d.slice(r,l):d}var nE=["push","pop","shift","splice","unshift"];function rE(d,s){if(d._chartjs){d._chartjs.listeners.push(s);return}Object.defineProperty(d,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),nE.forEach(u=>{let r="_onData"+qb(u),l=d[u];Object.defineProperty(d,u,{configurable:!0,enumerable:!1,value(...i){let _=l.apply(this,i);return d._chartjs.listeners.forEach(C=>{typeof C[r]=="function"&&C[r](...i)}),_}})})}function pw(d,s){let u=d._chartjs;if(!u)return;let r=u.listeners,l=r.indexOf(s);l!==-1&&r.splice(l,1),!(r.length>0)&&(nE.forEach(i=>{delete d[i]}),delete d._chartjs)}function fw(d){let s=new Set(d);return s.size===d.length?d:Array.from(s)}var gw=function(){return typeof window>"u"?function(d){return d()}:window.requestAnimationFrame}();function _w(d,s){let u=[],r=!1;return function(...l){u=l,r||(r=!0,gw.call(window,()=>{r=!1,d.apply(s,u)}))}}function oE(d,s){let u;return function(...r){return s?(clearTimeout(u),u=setTimeout(d,s,r)):d.apply(this,r),s}}var Zb=d=>d==="start"?"left":d==="end"?"right":"center",mo=(d,s,u)=>d==="start"?s:d==="end"?u:(s+u)/2,aE=(d,s,u,r)=>d===(r?"left":"right")?u:d==="center"?(s+u)/2:s;function bw(d,s,u){let r=s.length,l=0,i=r;if(d._sorted){let{iScale:_,_parsed:C}=d,I=_.axis,{min:O,max:N,minDefined:q,maxDefined:ie}=_.getUserBounds();q&&(l=Zr(Math.min(Ks(C,I,O).lo,u?r:Ks(s,I,_.getPixelForValue(O)).lo),0,r-1)),ie?i=Zr(Math.max(Ks(C,_.axis,N,!0).hi+1,u?0:Ks(s,I,_.getPixelForValue(N),!0).hi+1),l,r)-l:i=r-l}return{start:l,count:i}}function yw(d){let{xScale:s,yScale:u,_scaleRanges:r}=d,l={xmin:s.min,xmax:s.max,ymin:u.min,ymax:u.max};if(!r)return d._scaleRanges=l,!0;let i=r.xmin!==s.min||r.xmax!==s.max||r.ymin!==u.min||r.ymax!==u.max;return Object.assign(r,l),i}var Nb=d=>d===0||d===1,VT=(d,s,u)=>-(Math.pow(2,10*(d-=1))*Math.sin((d-s)*ir/u)),jT=(d,s,u)=>Math.pow(2,-10*d)*Math.sin((d-s)*ir/u)+1,Wm={linear:d=>d,easeInQuad:d=>d*d,easeOutQuad:d=>-d*(d-2),easeInOutQuad:d=>(d/=.5)<1?.5*d*d:-.5*(--d*(d-2)-1),easeInCubic:d=>d*d*d,easeOutCubic:d=>(d-=1)*d*d+1,easeInOutCubic:d=>(d/=.5)<1?.5*d*d*d:.5*((d-=2)*d*d+2),easeInQuart:d=>d*d*d*d,easeOutQuart:d=>-((d-=1)*d*d*d-1),easeInOutQuart:d=>(d/=.5)<1?.5*d*d*d*d:-.5*((d-=2)*d*d*d-2),easeInQuint:d=>d*d*d*d*d,easeOutQuint:d=>(d-=1)*d*d*d*d+1,easeInOutQuint:d=>(d/=.5)<1?.5*d*d*d*d*d:.5*((d-=2)*d*d*d*d+2),easeInSine:d=>-Math.cos(d*xr)+1,easeOutSine:d=>Math.sin(d*xr),easeInOutSine:d=>-.5*(Math.cos(tr*d)-1),easeInExpo:d=>d===0?0:Math.pow(2,10*(d-1)),easeOutExpo:d=>d===1?1:-Math.pow(2,-10*d)+1,easeInOutExpo:d=>Nb(d)?d:d<.5?.5*Math.pow(2,10*(d*2-1)):.5*(-Math.pow(2,-10*(d*2-1))+2),easeInCirc:d=>d>=1?d:-(Math.sqrt(1-d*d)-1),easeOutCirc:d=>Math.sqrt(1-(d-=1)*d),easeInOutCirc:d=>(d/=.5)<1?-.5*(Math.sqrt(1-d*d)-1):.5*(Math.sqrt(1-(d-=2)*d)+1),easeInElastic:d=>Nb(d)?d:VT(d,.075,.3),easeOutElastic:d=>Nb(d)?d:jT(d,.075,.3),easeInOutElastic(d){return Nb(d)?d:d<.5?.5*VT(d*2,.1125,.45):.5+.5*jT(d*2-1,.1125,.45)},easeInBack(d){return d*d*((1.70158+1)*d-1.70158)},easeOutBack(d){return(d-=1)*d*((1.70158+1)*d+1.70158)+1},easeInOutBack(d){let s=1.70158;return(d/=.5)<1?.5*(d*d*(((s*=1.525)+1)*d-s)):.5*((d-=2)*d*(((s*=1.525)+1)*d+s)+2)},easeInBounce:d=>1-Wm.easeOutBounce(1-d),easeOutBounce(d){return d<1/2.75?7.5625*d*d:d<2/2.75?7.5625*(d-=1.5/2.75)*d+.75:d<2.5/2.75?7.5625*(d-=2.25/2.75)*d+.9375:7.5625*(d-=2.625/2.75)*d+.984375},easeInOutBounce:d=>d<.5?Wm.easeInBounce(d*2)*.5:Wm.easeOutBounce(d*2-1)*.5+.5};function vw(d){if(d&&typeof d=="object"){let s=d.toString();return s==="[object CanvasPattern]"||s==="[object CanvasGradient]"}return!1}function xw(d){return vw(d)?d:new vg(d)}function ow(d){return vw(d)?d:new vg(d).saturate(.5).darken(.1).hexString()}var d5=["x","y","borderWidth","radius","tension"],h5=["color","borderColor","backgroundColor"];function u5(d){d.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),d.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:s=>s!=="onProgress"&&s!=="onComplete"&&s!=="fn"}),d.set("animations",{colors:{type:"color",properties:h5},numbers:{type:"number",properties:d5}}),d.describe("animations",{_fallback:"animation"}),d.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:s=>s|0}}}})}function m5(d){d.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var UT=new Map;function p5(d,s){s=s||{};let u=d+JSON.stringify(s),r=UT.get(u);return r||(r=new Intl.NumberFormat(d,s),UT.set(u,r)),r}function Qm(d,s,u){return p5(s,u).format(d)}var sE={values(d){return er(d)?d:""+d},numeric(d,s,u){if(d===0)return"0";let r=this.chart.options.locale,l,i=d;if(u.length>1){let O=Math.max(Math.abs(u[0].value),Math.abs(u[u.length-1].value));(O<1e-4||O>1e15)&&(l="scientific"),i=f5(d,u)}let _=$l(Math.abs(i)),C=isNaN(_)?1:Math.max(Math.min(-1*Math.floor(_),20),0),I={notation:l,minimumFractionDigits:C,maximumFractionDigits:C};return Object.assign(I,this.options.ticks.format),Qm(d,r,I)},logarithmic(d,s,u){if(d===0)return"0";let r=u[s].significand||d/Math.pow(10,Math.floor($l(d)));return[1,2,3,5,10,15].includes(r)||s>.8*u.length?sE.numeric.call(this,d,s,u):""}};function f5(d,s){let u=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(u)>=1&&d!==Math.floor(d)&&(u=d-Math.floor(d)),u}var Mg={formatters:sE};function g5(d){d.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(s,u)=>u.lineWidth,tickColor:(s,u)=>u.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Mg.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),d.route("scale.ticks","color","","color"),d.route("scale.grid","color","","borderColor"),d.route("scale.border","color","","borderColor"),d.route("scale.title","color","","color"),d.describe("scale",{_fallback:!1,_scriptable:s=>!s.startsWith("before")&&!s.startsWith("after")&&s!=="callback"&&s!=="parser",_indexable:s=>s!=="borderDash"&&s!=="tickBorderDash"&&s!=="dash"}),d.describe("scales",{_fallback:"scale"}),d.describe("scale.ticks",{_scriptable:s=>s!=="backdropPadding"&&s!=="callback",_indexable:s=>s!=="backdropPadding"})}var xd=Object.create(null),Xb=Object.create(null);function wg(d,s){if(!s)return d;let u=s.split(".");for(let r=0,l=u.length;r<l;++r){let i=u[r];d=d[i]||(d[i]=Object.create(null))}return d}function aw(d,s,u){return typeof s=="string"?Gm(wg(d,s),u):Gm(wg(d,""),s)}var sw=class{constructor(s,u){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,l)=>ow(l.backgroundColor),this.hoverBorderColor=(r,l)=>ow(l.borderColor),this.hoverColor=(r,l)=>ow(l.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s),this.apply(u)}set(s,u){return aw(this,s,u)}get(s){return wg(this,s)}describe(s,u){return aw(Xb,s,u)}override(s,u){return aw(xd,s,u)}route(s,u,r,l){let i=wg(this,s),_=wg(this,r),C="_"+u;Object.defineProperties(i,{[C]:{value:i[u],writable:!0},[u]:{enumerable:!0,get(){let I=this[C],O=_[l];return ln(I)?Object.assign({},O,I):Yi(I,O)},set(I){this[C]=I}}})}apply(s){s.forEach(u=>u(this))}},fr=new sw({_scriptable:d=>!d.startsWith("on"),_indexable:d=>d!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[u5,m5,g5]);function _5(d){return!d||vn(d.size)||vn(d.family)?null:(d.style?d.style+" ":"")+(d.weight?d.weight+" ":"")+d.size+"px "+d.family}function Cg(d,s,u,r,l){let i=s[l];return i||(i=s[l]=d.measureText(l).width,u.push(l)),i>r&&(r=i),r}function lE(d,s,u,r){r=r||{};let l=r.data=r.data||{},i=r.garbageCollect=r.garbageCollect||[];r.font!==s&&(l=r.data={},i=r.garbageCollect=[],r.font=s),d.save(),d.font=s;let _=0,C=u.length,I,O,N,q,ie;for(I=0;I<C;I++)if(q=u[I],q!=null&&!er(q))_=Cg(d,l,i,_,q);else if(er(q))for(O=0,N=q.length;O<N;O++)ie=q[O],ie!=null&&!er(ie)&&(_=Cg(d,l,i,_,ie));d.restore();let de=i.length/2;if(de>u.length){for(I=0;I<de;I++)delete l[i[I]];i.splice(0,de)}return _}function wd(d,s,u){let r=d.currentDevicePixelRatio,l=u!==0?Math.max(u/2,.5):0;return Math.round((s-l)*r)/r+l}function ww(d,s){!s&&!d||(s=s||d.getContext("2d"),s.save(),s.resetTransform(),s.clearRect(0,0,d.width,d.height),s.restore())}function Qb(d,s,u,r){Cw(d,s,u,r,null)}function Cw(d,s,u,r,l){let i,_,C,I,O,N,q,ie,de=s.pointStyle,xe=s.rotation,ke=s.radius,Ae=(xe||0)*l5;if(de&&typeof de=="object"&&(i=de.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){d.save(),d.translate(u,r),d.rotate(Ae),d.drawImage(de,-de.width/2,-de.height/2,de.width,de.height),d.restore();return}if(!(isNaN(ke)||ke<=0)){switch(d.beginPath(),de){default:l?d.ellipse(u,r,l/2,ke,0,0,ir):d.arc(u,r,ke,0,ir),d.closePath();break;case"triangle":N=l?l/2:ke,d.moveTo(u+Math.sin(Ae)*N,r-Math.cos(Ae)*ke),Ae+=NT,d.lineTo(u+Math.sin(Ae)*N,r-Math.cos(Ae)*ke),Ae+=NT,d.lineTo(u+Math.sin(Ae)*N,r-Math.cos(Ae)*ke),d.closePath();break;case"rectRounded":O=ke*.516,I=ke-O,_=Math.cos(Ae+Yh)*I,q=Math.cos(Ae+Yh)*(l?l/2-O:I),C=Math.sin(Ae+Yh)*I,ie=Math.sin(Ae+Yh)*(l?l/2-O:I),d.arc(u-q,r-C,O,Ae-tr,Ae-xr),d.arc(u+ie,r-_,O,Ae-xr,Ae),d.arc(u+q,r+C,O,Ae,Ae+xr),d.arc(u-ie,r+_,O,Ae+xr,Ae+tr),d.closePath();break;case"rect":if(!xe){I=Math.SQRT1_2*ke,N=l?l/2:I,d.rect(u-N,r-I,2*N,2*I);break}Ae+=Yh;case"rectRot":q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,r-C),d.lineTo(u+ie,r-_),d.lineTo(u+q,r+C),d.lineTo(u-ie,r+_),d.closePath();break;case"crossRot":Ae+=Yh;case"cross":q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,r-C),d.lineTo(u+q,r+C),d.moveTo(u+ie,r-_),d.lineTo(u-ie,r+_);break;case"star":q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,r-C),d.lineTo(u+q,r+C),d.moveTo(u+ie,r-_),d.lineTo(u-ie,r+_),Ae+=Yh,q=Math.cos(Ae)*(l?l/2:ke),_=Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,ie=Math.sin(Ae)*(l?l/2:ke),d.moveTo(u-q,r-C),d.lineTo(u+q,r+C),d.moveTo(u+ie,r-_),d.lineTo(u-ie,r+_);break;case"line":_=l?l/2:Math.cos(Ae)*ke,C=Math.sin(Ae)*ke,d.moveTo(u-_,r-C),d.lineTo(u+_,r+C);break;case"dash":d.moveTo(u,r),d.lineTo(u+Math.cos(Ae)*(l?l/2:ke),r+Math.sin(Ae)*ke);break;case!1:d.closePath();break}d.fill(),s.borderWidth>0&&d.stroke()}}function Js(d,s,u){return u=u||.5,!s||d&&d.x>s.left-u&&d.x<s.right+u&&d.y>s.top-u&&d.y<s.bottom+u}function kg(d,s){d.save(),d.beginPath(),d.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),d.clip()}function Ig(d){d.restore()}function cE(d,s,u,r,l){if(!s)return d.lineTo(u.x,u.y);if(l==="middle"){let i=(s.x+u.x)/2;d.lineTo(i,s.y),d.lineTo(i,u.y)}else l==="after"!=!!r?d.lineTo(s.x,u.y):d.lineTo(u.x,s.y);d.lineTo(u.x,u.y)}function dE(d,s,u,r){if(!s)return d.lineTo(u.x,u.y);d.bezierCurveTo(r?s.cp1x:s.cp2x,r?s.cp1y:s.cp2y,r?u.cp2x:u.cp1x,r?u.cp2y:u.cp1y,u.x,u.y)}function b5(d,s){s.translation&&d.translate(s.translation[0],s.translation[1]),vn(s.rotation)||d.rotate(s.rotation),s.color&&(d.fillStyle=s.color),s.textAlign&&(d.textAlign=s.textAlign),s.textBaseline&&(d.textBaseline=s.textBaseline)}function y5(d,s,u,r,l){if(l.strikethrough||l.underline){let i=d.measureText(r),_=s-i.actualBoundingBoxLeft,C=s+i.actualBoundingBoxRight,I=u-i.actualBoundingBoxAscent,O=u+i.actualBoundingBoxDescent,N=l.strikethrough?(I+O)/2:O;d.strokeStyle=d.fillStyle,d.beginPath(),d.lineWidth=l.decorationWidth||2,d.moveTo(_,N),d.lineTo(C,N),d.stroke()}}function v5(d,s){let u=d.fillStyle;d.fillStyle=s.color,d.fillRect(s.left,s.top,s.width,s.height),d.fillStyle=u}function Cd(d,s,u,r,l,i={}){let _=er(s)?s:[s],C=i.strokeWidth>0&&i.strokeColor!=="",I,O;for(d.save(),d.font=l.string,b5(d,i),I=0;I<_.length;++I)O=_[I],i.backdrop&&v5(d,i.backdrop),C&&(i.strokeColor&&(d.strokeStyle=i.strokeColor),vn(i.strokeWidth)||(d.lineWidth=i.strokeWidth),d.strokeText(O,u,r,i.maxWidth)),d.fillText(O,u,r,i.maxWidth),y5(d,u,r,O,i),r+=Number(l.lineHeight);d.restore()}function Km(d,s){let{x:u,y:r,w:l,h:i,radius:_}=s;d.arc(u+_.topLeft,r+_.topLeft,_.topLeft,1.5*tr,tr,!0),d.lineTo(u,r+i-_.bottomLeft),d.arc(u+_.bottomLeft,r+i-_.bottomLeft,_.bottomLeft,tr,xr,!0),d.lineTo(u+l-_.bottomRight,r+i),d.arc(u+l-_.bottomRight,r+i-_.bottomRight,_.bottomRight,xr,0,!0),d.lineTo(u+l,r+_.topRight),d.arc(u+l-_.topRight,r+_.topRight,_.topRight,0,-xr,!0),d.lineTo(u+_.topLeft,r)}var x5=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,w5=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function C5(d,s){let u=(""+d).match(x5);if(!u||u[1]==="normal")return s*1.2;switch(d=+u[2],u[3]){case"px":return d;case"%":d/=100;break}return s*d}var S5=d=>+d||0;function Kb(d,s){let u={},r=ln(s),l=r?Object.keys(s):s,i=ln(d)?r?_=>Yi(d[_],d[s[_]]):_=>d[_]:()=>d;for(let _ of l)u[_]=S5(i(_));return u}function Sw(d){return Kb(d,{top:"y",right:"x",bottom:"y",left:"x"})}function Sd(d){return Kb(d,["topLeft","topRight","bottomLeft","bottomRight"])}function po(d){let s=Sw(d);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function Br(d,s){d=d||{},s=s||fr.font;let u=Yi(d.size,s.size);typeof u=="string"&&(u=parseInt(u,10));let r=Yi(d.style,s.style);r&&!(""+r).match(w5)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);let l={family:Yi(d.family,s.family),lineHeight:C5(Yi(d.lineHeight,s.lineHeight),u),size:u,style:r,weight:Yi(d.weight,s.weight),string:""};return l.string=_5(l),l}function Jm(d,s,u,r){let l=!0,i,_,C;for(i=0,_=d.length;i<_;++i)if(C=d[i],C!==void 0&&(s!==void 0&&typeof C=="function"&&(C=C(s),l=!1),u!==void 0&&er(C)&&(C=C[u%C.length],l=!1),C!==void 0))return r&&!l&&(r.cacheable=!1),C}function hE(d,s,u){let{min:r,max:l}=d,i=lw(s,(l-r)/2),_=(C,I)=>u&&C===0?0:C+I;return{min:_(r,-Math.abs(i)),max:_(l,i)}}function Zl(d,s){return Object.assign(Object.create(d),s)}function Jb(d,s=[""],u,r,l=()=>d[0]){let i=u||d;typeof r>"u"&&(r=pE("_fallback",d));let _={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:d,_rootScopes:i,_fallback:r,_getTarget:l,override:C=>Jb([C,...d],s,i,r)};return new Proxy(_,{deleteProperty(C,I){return delete C[I],delete C._keys,delete d[0][I],!0},get(C,I){return uE(C,I,()=>P5(I,s,d,C))},getOwnPropertyDescriptor(C,I){return Reflect.getOwnPropertyDescriptor(C._scopes[0],I)},getPrototypeOf(){return Reflect.getPrototypeOf(d[0])},has(C,I){return WT(C).includes(I)},ownKeys(C){return WT(C)},set(C,I,O){let N=C._storage||(C._storage=l());return C[I]=N[I]=O,delete C._keys,!0}})}function Xh(d,s,u,r){let l={_cacheable:!1,_proxy:d,_context:s,_subProxy:u,_stack:new Set,_descriptors:Mw(d,r),setContext:i=>Xh(d,i,u,r),override:i=>Xh(d.override(i),s,u,r)};return new Proxy(l,{deleteProperty(i,_){return delete i[_],delete d[_],!0},get(i,_,C){return uE(i,_,()=>k5(i,_,C))},getOwnPropertyDescriptor(i,_){return i._descriptors.allKeys?Reflect.has(d,_)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(d,_)},getPrototypeOf(){return Reflect.getPrototypeOf(d)},has(i,_){return Reflect.has(d,_)},ownKeys(){return Reflect.ownKeys(d)},set(i,_,C){return d[_]=C,delete i[_],!0}})}function Mw(d,s={scriptable:!0,indexable:!0}){let{_scriptable:u=s.scriptable,_indexable:r=s.indexable,_allKeys:l=s.allKeys}=d;return{allKeys:l,scriptable:u,indexable:r,isScriptable:ql(u)?u:()=>u,isIndexable:ql(r)?r:()=>r}}var M5=(d,s)=>d?d+qb(s):s,kw=(d,s)=>ln(s)&&d!=="adapters"&&(Object.getPrototypeOf(s)===null||s.constructor===Object);function uE(d,s,u){if(Object.prototype.hasOwnProperty.call(d,s)||s==="constructor")return d[s];let r=u();return d[s]=r,r}function k5(d,s,u){let{_proxy:r,_context:l,_subProxy:i,_descriptors:_}=d,C=r[s];return ql(C)&&_.isScriptable(s)&&(C=I5(s,C,d,u)),er(C)&&C.length&&(C=T5(s,C,d,_.isIndexable)),kw(s,C)&&(C=Xh(C,l,i&&i[s],_)),C}function I5(d,s,u,r){let{_proxy:l,_context:i,_subProxy:_,_stack:C}=u;if(C.has(d))throw new Error("Recursion detected: "+Array.from(C).join("->")+"->"+d);C.add(d);let I=s(i,_||r);return C.delete(d),kw(d,I)&&(I=Iw(l._scopes,l,d,I)),I}function T5(d,s,u,r){let{_proxy:l,_context:i,_subProxy:_,_descriptors:C}=u;if(typeof i.index<"u"&&r(d))return s[i.index%s.length];if(ln(s[0])){let I=s,O=l._scopes.filter(N=>N!==I);s=[];for(let N of I){let q=Iw(O,l,d,N);s.push(Xh(q,i,_&&_[d],C))}}return s}function mE(d,s,u){return ql(d)?d(s,u):d}var E5=(d,s)=>d===!0?s:typeof d=="string"?Yl(s,d):void 0;function D5(d,s,u,r,l){for(let i of s){let _=E5(u,i);if(_){d.add(_);let C=mE(_._fallback,u,l);if(typeof C<"u"&&C!==u&&C!==r)return C}else if(_===!1&&typeof r<"u"&&u!==r)return null}return!1}function Iw(d,s,u,r){let l=s._rootScopes,i=mE(s._fallback,u,r),_=[...d,...l],C=new Set;C.add(r);let I=HT(C,_,u,i||u,r);return I===null||typeof i<"u"&&i!==u&&(I=HT(C,_,i,I,r),I===null)?!1:Jb(Array.from(C),[""],l,i,()=>A5(s,u,r))}function HT(d,s,u,r,l){for(;u;)u=D5(d,s,u,r,l);return u}function A5(d,s,u){let r=d._getTarget();s in r||(r[s]={});let l=r[s];return er(l)&&ln(u)?u:l||{}}function P5(d,s,u,r){let l;for(let i of s)if(l=pE(M5(i,d),u),typeof l<"u")return kw(d,l)?Iw(u,r,d,l):l}function pE(d,s){for(let u of s){if(!u)continue;let r=u[d];if(typeof r<"u")return r}}function WT(d){let s=d._keys;return s||(s=d._keys=O5(d._scopes)),s}function O5(d){let s=new Set;for(let u of d)for(let r of Object.keys(u).filter(l=>!l.startsWith("_")))s.add(r);return Array.from(s)}function Tw(d,s,u,r){let{iScale:l}=d,{key:i="r"}=this._parsing,_=new Array(r),C,I,O,N;for(C=0,I=r;C<I;++C)O=C+u,N=s[O],_[C]={r:l.parse(Yl(N,i),O)};return _}var R5=Number.EPSILON||1e-14,qm=(d,s)=>s<d.length&&!d[s].skip&&d[s],fE=d=>d==="x"?"y":"x";function L5(d,s,u,r){let l=d.skip?s:d,i=s,_=u.skip?s:u,C=Wb(i,l),I=Wb(_,i),O=C/(C+I),N=I/(C+I);O=isNaN(O)?0:O,N=isNaN(N)?0:N;let q=r*O,ie=r*N;return{previous:{x:i.x-q*(_.x-l.x),y:i.y-q*(_.y-l.y)},next:{x:i.x+ie*(_.x-l.x),y:i.y+ie*(_.y-l.y)}}}function F5(d,s,u){let r=d.length,l,i,_,C,I,O=qm(d,0);for(let N=0;N<r-1;++N)if(I=O,O=qm(d,N+1),!(!I||!O)){if(Zm(s[N],0,R5)){u[N]=u[N+1]=0;continue}l=u[N]/s[N],i=u[N+1]/s[N],C=Math.pow(l,2)+Math.pow(i,2),!(C<=9)&&(_=3/Math.sqrt(C),u[N]=l*_*s[N],u[N+1]=i*_*s[N])}}function z5(d,s,u="x"){let r=fE(u),l=d.length,i,_,C,I=qm(d,0);for(let O=0;O<l;++O){if(_=C,C=I,I=qm(d,O+1),!C)continue;let N=C[u],q=C[r];_&&(i=(N-_[u])/3,C[`cp1${u}`]=N-i,C[`cp1${r}`]=q-i*s[O]),I&&(i=(I[u]-N)/3,C[`cp2${u}`]=N+i,C[`cp2${r}`]=q+i*s[O])}}function B5(d,s="x"){let u=fE(s),r=d.length,l=Array(r).fill(0),i=Array(r),_,C,I,O=qm(d,0);for(_=0;_<r;++_)if(C=I,I=O,O=qm(d,_+1),!!I){if(O){let N=O[s]-I[s];l[_]=N!==0?(O[u]-I[u])/N:0}i[_]=C?O?ws(l[_-1])!==ws(l[_])?0:(l[_-1]+l[_])/2:l[_-1]:l[_]}F5(d,l,i),z5(d,i,s)}function Vb(d,s,u){return Math.max(Math.min(d,u),s)}function N5(d,s){let u,r,l,i,_,C=Js(d[0],s);for(u=0,r=d.length;u<r;++u)_=i,i=C,C=u<r-1&&Js(d[u+1],s),i&&(l=d[u],_&&(l.cp1x=Vb(l.cp1x,s.left,s.right),l.cp1y=Vb(l.cp1y,s.top,s.bottom)),C&&(l.cp2x=Vb(l.cp2x,s.left,s.right),l.cp2y=Vb(l.cp2y,s.top,s.bottom)))}function gE(d,s,u,r,l){let i,_,C,I;if(s.spanGaps&&(d=d.filter(O=>!O.skip)),s.cubicInterpolationMode==="monotone")B5(d,l);else{let O=r?d[d.length-1]:d[0];for(i=0,_=d.length;i<_;++i)C=d[i],I=L5(O,C,d[Math.min(i+1,_-(r?0:1))%_],s.tension),C.cp1x=I.previous.x,C.cp1y=I.previous.y,C.cp2x=I.next.x,C.cp2y=I.next.y,O=C}s.capBezierPoints&&N5(d,u)}function ey(){return typeof window<"u"&&typeof document<"u"}function ty(d){let s=d.parentNode;return s&&s.toString()==="[object ShadowRoot]"&&(s=s.host),s}function Gb(d,s,u){let r;return typeof d=="string"?(r=parseInt(d,10),d.indexOf("%")!==-1&&(r=r/100*s.parentNode[u])):r=d,r}var iy=d=>d.ownerDocument.defaultView.getComputedStyle(d,null);function V5(d,s){return iy(d).getPropertyValue(s)}var j5=["top","right","bottom","left"];function Zh(d,s,u){let r={};u=u?"-"+u:"";for(let l=0;l<4;l++){let i=j5[l];r[i]=parseFloat(d[s+"-"+i+u])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}var U5=(d,s,u)=>(d>0||s>0)&&(!u||!u.shadowRoot);function H5(d,s){let u=d.touches,r=u&&u.length?u[0]:d,{offsetX:l,offsetY:i}=r,_=!1,C,I;if(U5(l,i,d.target))C=l,I=i;else{let O=s.getBoundingClientRect();C=r.clientX-O.left,I=r.clientY-O.top,_=!0}return{x:C,y:I,box:_}}function Md(d,s){if("native"in d)return d;let{canvas:u,currentDevicePixelRatio:r}=s,l=iy(u),i=l.boxSizing==="border-box",_=Zh(l,"padding"),C=Zh(l,"border","width"),{x:I,y:O,box:N}=H5(d,u),q=_.left+(N&&C.left),ie=_.top+(N&&C.top),{width:de,height:xe}=s;return i&&(de-=_.width+C.width,xe-=_.height+C.height),{x:Math.round((I-q)/de*u.width/r),y:Math.round((O-ie)/xe*u.height/r)}}function W5(d,s,u){let r,l;if(s===void 0||u===void 0){let i=d&&ty(d);if(!i)s=d.clientWidth,u=d.clientHeight;else{let _=i.getBoundingClientRect(),C=iy(i),I=Zh(C,"border","width"),O=Zh(C,"padding");s=_.width-O.width-I.width,u=_.height-O.height-I.height,r=Gb(C.maxWidth,i,"clientWidth"),l=Gb(C.maxHeight,i,"clientHeight")}}return{width:s,height:u,maxWidth:r||Hb,maxHeight:l||Hb}}var jb=d=>Math.round(d*10)/10;function _E(d,s,u,r){let l=iy(d),i=Zh(l,"margin"),_=Gb(l.maxWidth,d,"clientWidth")||Hb,C=Gb(l.maxHeight,d,"clientHeight")||Hb,I=W5(d,s,u),{width:O,height:N}=I;if(l.boxSizing==="content-box"){let ie=Zh(l,"border","width"),de=Zh(l,"padding");O-=de.width+ie.width,N-=de.height+ie.height}return O=Math.max(0,O-i.width),N=Math.max(0,r?O/r:N-i.height),O=jb(Math.min(O,_,I.maxWidth)),N=jb(Math.min(N,C,I.maxHeight)),O&&!N&&(N=jb(O/2)),(s!==void 0||u!==void 0)&&r&&I.height&&N>I.height&&(N=I.height,O=jb(Math.floor(N*r))),{width:O,height:N}}function Ew(d,s,u){let r=s||1,l=Math.floor(d.height*r),i=Math.floor(d.width*r);d.height=Math.floor(d.height),d.width=Math.floor(d.width);let _=d.canvas;return _.style&&(u||!_.style.height&&!_.style.width)&&(_.style.height=`${d.height}px`,_.style.width=`${d.width}px`),d.currentDevicePixelRatio!==r||_.height!==l||_.width!==i?(d.currentDevicePixelRatio=r,_.height=l,_.width=i,d.ctx.setTransform(r,0,0,r,0,0),!0):!1}var bE=function(){let d=!1;try{let s={get passive(){return d=!0,!1}};ey()&&(window.addEventListener("test",null,s),window.removeEventListener("test",null,s))}catch{}return d}();function Dw(d,s){let u=V5(d,s),r=u&&u.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function vd(d,s,u,r){return{x:d.x+u*(s.x-d.x),y:d.y+u*(s.y-d.y)}}function yE(d,s,u,r){return{x:d.x+u*(s.x-d.x),y:r==="middle"?u<.5?d.y:s.y:r==="after"?u<1?d.y:s.y:u>0?s.y:d.y}}function vE(d,s,u,r){let l={x:d.cp2x,y:d.cp2y},i={x:s.cp1x,y:s.cp1y},_=vd(d,l,u),C=vd(l,i,u),I=vd(i,s,u),O=vd(_,C,u),N=vd(C,I,u);return vd(O,N,u)}var G5=function(d,s){return{x(u){return d+d+s-u},setWidth(u){s=u},textAlign(u){return u==="center"?u:u==="right"?"left":"right"},xPlus(u,r){return u-r},leftForLtr(u,r){return u-r}}},q5=function(){return{x(d){return d},setWidth(d){},textAlign(d){return d},xPlus(d,s){return d+s},leftForLtr(d,s){return d}}};function Kh(d,s,u){return d?G5(s,u):q5()}function Aw(d,s){let u,r;(s==="ltr"||s==="rtl")&&(u=d.canvas.style,r=[u.getPropertyValue("direction"),u.getPropertyPriority("direction")],u.setProperty("direction",s,"important"),d.prevTextDirection=r)}function Pw(d,s){s!==void 0&&(delete d.prevTextDirection,d.canvas.style.setProperty("direction",s[0],s[1]))}function xE(d){return d==="angle"?{between:Xm,compare:c5,normalize:Jo}:{between:tl,compare:(s,u)=>s-u,normalize:s=>s}}function GT({start:d,end:s,count:u,loop:r,style:l}){return{start:d%u,end:s%u,loop:r&&(s-d+1)%u===0,style:l}}function $5(d,s,u){let{property:r,start:l,end:i}=u,{between:_,normalize:C}=xE(r),I=s.length,{start:O,end:N,loop:q}=d,ie,de;if(q){for(O+=I,N+=I,ie=0,de=I;ie<de&&_(C(s[O%I][r]),l,i);++ie)O--,N--;O%=I,N%=I}return N<O&&(N+=I),{start:O,end:N,loop:q,style:d.style}}function Ow(d,s,u){if(!u)return[d];let{property:r,start:l,end:i}=u,_=s.length,{compare:C,between:I,normalize:O}=xE(r),{start:N,end:q,loop:ie,style:de}=$5(d,s,u),xe=[],ke=!1,Ae=null,Xe,qe,ut,It=()=>I(l,ut,Xe)&&C(l,ut)!==0,wt=()=>C(i,Xe)===0||I(i,ut,Xe),Et=()=>ke||It(),Ht=()=>!ke||wt();for(let Ct=N,Yt=N;Ct<=q;++Ct)qe=s[Ct%_],!qe.skip&&(Xe=O(qe[r]),Xe!==ut&&(ke=I(Xe,l,i),Ae===null&&Et()&&(Ae=C(Xe,l)===0?Ct:Yt),Ae!==null&&Ht()&&(xe.push(GT({start:Ae,end:Ct,loop:ie,count:_,style:de})),Ae=null),Yt=Ct,ut=Xe));return Ae!==null&&xe.push(GT({start:Ae,end:q,loop:ie,count:_,style:de})),xe}function Rw(d,s){let u=[],r=d.segments;for(let l=0;l<r.length;l++){let i=Ow(r[l],d.points,s);i.length&&u.push(...i)}return u}function Y5(d,s,u,r){let l=0,i=s-1;if(u&&!r)for(;l<s&&!d[l].skip;)l++;for(;l<s&&d[l].skip;)l++;for(l%=s,u&&(i+=l);i>l&&d[i%s].skip;)i--;return i%=s,{start:l,end:i}}function Z5(d,s,u,r){let l=d.length,i=[],_=s,C=d[s],I;for(I=s+1;I<=u;++I){let O=d[I%l];O.skip||O.stop?C.skip||(r=!1,i.push({start:s%l,end:(I-1)%l,loop:r}),s=_=O.stop?I:null):(_=I,C.skip&&(s=I)),C=O}return _!==null&&i.push({start:s%l,end:_%l,loop:r}),i}function wE(d,s){let u=d.points,r=d.options.spanGaps,l=u.length;if(!l)return[];let i=!!d._loop,{start:_,end:C}=Y5(u,l,i,r);if(r===!0)return qT(d,[{start:_,end:C,loop:i}],u,s);let I=C<_?C+l:C,O=!!d._fullLoop&&_===0&&C===l-1;return qT(d,Z5(u,_,I,O),u,s)}function qT(d,s,u,r){return!r||!r.setContext||!u?s:X5(d,s,u,r)}function X5(d,s,u,r){let l=d._chart.getContext(),i=$T(d.options),{_datasetIndex:_,options:{spanGaps:C}}=d,I=u.length,O=[],N=i,q=s[0].start,ie=q;function de(xe,ke,Ae,Xe){let qe=C?-1:1;if(xe!==ke){for(xe+=I;u[xe%I].skip;)xe-=qe;for(;u[ke%I].skip;)ke+=qe;xe%I!==ke%I&&(O.push({start:xe%I,end:ke%I,loop:Ae,style:Xe}),N=Xe,q=ke%I)}}for(let xe of s){q=C?q:xe.start;let ke=u[q%I],Ae;for(ie=q+1;ie<=xe.end;ie++){let Xe=u[ie%I];Ae=$T(r.setContext(Zl(l,{type:"segment",p0:ke,p1:Xe,p0DataIndex:(ie-1)%I,p1DataIndex:ie%I,datasetIndex:_}))),Q5(Ae,N)&&de(q,ie-1,xe.loop,N),ke=Xe,N=Ae}q<ie-1&&de(q,ie-1,xe.loop,N)}return O}function $T(d){return{backgroundColor:d.backgroundColor,borderCapStyle:d.borderCapStyle,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderJoinStyle:d.borderJoinStyle,borderWidth:d.borderWidth,borderColor:d.borderColor}}function Q5(d,s){if(!s)return!1;let u=[],r=function(l,i){return vw(i)?(u.includes(i)||u.push(i),u.indexOf(i)):i};return JSON.stringify(d,r)!==JSON.stringify(s,r)}var Ww=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,u,r,l){let i=u.listeners[l],_=u.duration;i.forEach(C=>C({chart:s,initial:u.initial,numSteps:_,currentStep:Math.min(r-u.start,_)}))}_refresh(){this._request||(this._running=!0,this._request=gw.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let u=0;this._charts.forEach((r,l)=>{if(!r.running||!r.items.length)return;let i=r.items,_=i.length-1,C=!1,I;for(;_>=0;--_)I=i[_],I._active?(I._total>r.duration&&(r.duration=I._total),I.tick(s),C=!0):(i[_]=i[i.length-1],i.pop());C&&(l.draw(),this._notify(l,r,s,"progress")),i.length||(r.running=!1,this._notify(l,r,s,"complete"),r.initial=!1),u+=i.length}),this._lastDate=s,u===0&&(this._running=!1)}_getAnims(s){let u=this._charts,r=u.get(s);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},u.set(s,r)),r}listen(s,u,r){this._getAnims(s).listeners[u].push(r)}add(s,u){!u||!u.length||this._getAnims(s).items.push(...u)}has(s){return this._getAnims(s).items.length>0}start(s){let u=this._charts.get(s);u&&(u.running=!0,u.start=Date.now(),u.duration=u.items.reduce((r,l)=>Math.max(r,l._duration),0),this._refresh())}running(s){if(!this._running)return!1;let u=this._charts.get(s);return!(!u||!u.running||!u.items.length)}stop(s){let u=this._charts.get(s);if(!u||!u.items.length)return;let r=u.items,l=r.length-1;for(;l>=0;--l)r[l].cancel();u.items=[],this._notify(s,u,Date.now(),"complete")}remove(s){return this._charts.delete(s)}},Xl=new Ww,CE="transparent",K5={boolean(d,s,u){return u>.5?s:d},color(d,s,u){let r=xw(d||CE),l=r.valid&&xw(s||CE);return l&&l.valid?l.mix(r,u).hexString():s},number(d,s,u){return d+(s-d)*u}},Gw=class{constructor(s,u,r,l){let i=u[r];l=Jm([s.to,l,i,s.from]);let _=Jm([s.from,i,l]);this._active=!0,this._fn=s.fn||K5[s.type||typeof _],this._easing=Wm[s.easing]||Wm.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=u,this._prop=r,this._from=_,this._to=l,this._promises=void 0}active(){return this._active}update(s,u,r){if(this._active){this._notify(!1);let l=this._target[this._prop],i=r-this._start,_=this._duration-i;this._start=r,this._duration=Math.floor(Math.max(_,s.duration)),this._total+=i,this._loop=!!s.loop,this._to=Jm([s.to,u,l,s.from]),this._from=Jm([s.from,l,u])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){let u=s-this._start,r=this._duration,l=this._prop,i=this._from,_=this._loop,C=this._to,I;if(this._active=i!==C&&(_||u<r),!this._active){this._target[l]=C,this._notify(!0);return}if(u<0){this._target[l]=i;return}I=u/r%2,I=_&&I>1?2-I:I,I=this._easing(Math.min(1,Math.max(0,I))),this._target[l]=this._fn(i,C,I)}wait(){let s=this._promises||(this._promises=[]);return new Promise((u,r)=>{s.push({res:u,rej:r})})}_notify(s){let u=s?"res":"rej",r=this._promises||[];for(let l=0;l<r.length;l++)r[l][u]()}},uy=class{constructor(s,u){this._chart=s,this._properties=new Map,this.configure(u)}configure(s){if(!ln(s))return;let u=Object.keys(fr.animation),r=this._properties;Object.getOwnPropertyNames(s).forEach(l=>{let i=s[l];if(!ln(i))return;let _={};for(let C of u)_[C]=i[C];(er(i.properties)&&i.properties||[l]).forEach(C=>{(C===l||!r.has(C))&&r.set(C,_)})})}_animateOptions(s,u){let r=u.options,l=e4(s,r);if(!l)return[];let i=this._createAnimations(l,r);return r.$shared&&J5(s.options.$animations,r).then(()=>{s.options=r},()=>{}),i}_createAnimations(s,u){let r=this._properties,l=[],i=s.$animations||(s.$animations={}),_=Object.keys(u),C=Date.now(),I;for(I=_.length-1;I>=0;--I){let O=_[I];if(O.charAt(0)==="$")continue;if(O==="options"){l.push(...this._animateOptions(s,u));continue}let N=u[O],q=i[O],ie=r.get(O);if(q)if(ie&&q.active()){q.update(ie,N,C);continue}else q.cancel();if(!ie||!ie.duration){s[O]=N;continue}i[O]=q=new Gw(ie,s,O,N),l.push(q)}return l}update(s,u){if(this._properties.size===0){Object.assign(s,u);return}let r=this._createAnimations(s,u);if(r.length)return Xl.add(this._chart,r),!0}};function J5(d,s){let u=[],r=Object.keys(s);for(let l=0;l<r.length;l++){let i=d[r[l]];i&&i.active()&&u.push(i.wait())}return Promise.all(u)}function e4(d,s){if(!s)return;let u=d.options;if(!u){d.options=s;return}return u.$shared&&(d.options=u=Object.assign({},u,{$shared:!1,$animations:{}})),u}function SE(d,s){let u=d&&d.options||{},r=u.reverse,l=u.min===void 0?s:0,i=u.max===void 0?s:0;return{start:r?i:l,end:r?l:i}}function t4(d,s,u){if(u===!1)return!1;let r=SE(d,u),l=SE(s,u);return{top:l.end,right:r.end,bottom:l.start,left:r.start}}function i4(d){let s,u,r,l;return ln(d)?(s=d.top,u=d.right,r=d.bottom,l=d.left):s=u=r=l=d,{top:s,right:u,bottom:r,left:l,disabled:d===!1}}function SD(d,s){let u=[],r=d._getSortedDatasetMetas(s),l,i;for(l=0,i=r.length;l<i;++l)u.push(r[l].index);return u}function ME(d,s,u,r={}){let l=d.keys,i=r.mode==="single",_,C,I,O;if(s!==null){for(_=0,C=l.length;_<C;++_){if(I=+l[_],I===u){if(r.all)continue;break}O=d.values[I],pr(O)&&(i||s===0||ws(s)===ws(O))&&(s+=O)}return s}}function n4(d,s){let{iScale:u,vScale:r}=s,l=u.axis==="x"?"x":"y",i=r.axis==="x"?"x":"y",_=Object.keys(d),C=new Array(_.length),I,O,N;for(I=0,O=_.length;I<O;++I)N=_[I],C[I]={[l]:N,[i]:d[N]};return C}function kE(d,s){let u=d&&d.options.stacked;return u||u===void 0&&s.stack!==void 0}function r4(d,s,u){return`${d.id}.${s.id}.${u.stack||u.type}`}function o4(d){let{min:s,max:u,minDefined:r,maxDefined:l}=d.getUserBounds();return{min:r?s:Number.NEGATIVE_INFINITY,max:l?u:Number.POSITIVE_INFINITY}}function a4(d,s,u){let r=d[s]||(d[s]={});return r[u]||(r[u]={})}function IE(d,s,u,r){for(let l of s.getMatchingVisibleMetas(r).reverse()){let i=d[l.index];if(u&&i>0||!u&&i<0)return l.index}return null}function TE(d,s){let{chart:u,_cachedMeta:r}=d,l=u._stacks||(u._stacks={}),{iScale:i,vScale:_,index:C}=r,I=i.axis,O=_.axis,N=r4(i,_,r),q=s.length,ie;for(let de=0;de<q;++de){let xe=s[de],{[I]:ke,[O]:Ae}=xe,Xe=xe._stacks||(xe._stacks={});ie=Xe[O]=a4(l,N,ke),ie[C]=Ae,ie._top=IE(ie,_,!0,r.type),ie._bottom=IE(ie,_,!1,r.type);let qe=ie._visualValues||(ie._visualValues={});qe[C]=Ae}}function Lw(d,s){let u=d.scales;return Object.keys(u).filter(r=>u[r].axis===s).shift()}function s4(d,s){return Zl(d,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}function l4(d,s,u){return Zl(d,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:u,index:s,mode:"default",type:"data"})}function Tg(d,s){let u=d.controller.index,r=d.vScale&&d.vScale.axis;if(r){s=s||d._parsed;for(let l of s){let i=l._stacks;if(!i||i[r]===void 0||i[r][u]===void 0)return;delete i[r][u],i[r]._visualValues!==void 0&&i[r]._visualValues[u]!==void 0&&delete i[r]._visualValues[u]}}}var Fw=d=>d==="reset"||d==="none",EE=(d,s)=>s?d:Object.assign({},d),c4=(d,s,u)=>d&&!s.hidden&&s._stacked&&{keys:SD(u,!0),values:null},Id=(()=>{class d{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(u,r){this.chart=u,this._ctx=u.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let u=this._cachedMeta;this.configure(),this.linkScales(),u._stacked=kE(u.vScale,u),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(u){this.index!==u&&Tg(this._cachedMeta),this.index=u}linkScales(){let u=this.chart,r=this._cachedMeta,l=this.getDataset(),i=(ie,de,xe,ke)=>ie==="x"?de:ie==="r"?ke:xe,_=r.xAxisID=Yi(l.xAxisID,Lw(u,"x")),C=r.yAxisID=Yi(l.yAxisID,Lw(u,"y")),I=r.rAxisID=Yi(l.rAxisID,Lw(u,"r")),O=r.indexAxis,N=r.iAxisID=i(O,_,C,I),q=r.vAxisID=i(O,C,_,I);r.xScale=this.getScaleForId(_),r.yScale=this.getScaleForId(C),r.rScale=this.getScaleForId(I),r.iScale=this.getScaleForId(N),r.vScale=this.getScaleForId(q)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(u){return this.chart.scales[u]}_getOtherScale(u){let r=this._cachedMeta;return u===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){let u=this._cachedMeta;this._data&&pw(this._data,this),u._stacked&&Tg(u)}_dataCheck(){let u=this.getDataset(),r=u.data||(u.data=[]),l=this._data;if(ln(r)){let i=this._cachedMeta;this._data=n4(r,i)}else if(l!==r){if(l){pw(l,this);let i=this._cachedMeta;Tg(i),i._parsed=[]}r&&Object.isExtensible(r)&&rE(r,this),this._syncList=[],this._data=r}}addElements(){let u=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(u.dataset=new this.datasetElementType)}buildOrUpdateElements(u){let r=this._cachedMeta,l=this.getDataset(),i=!1;this._dataCheck();let _=r._stacked;r._stacked=kE(r.vScale,r),r.stack!==l.stack&&(i=!0,Tg(r),r.stack=l.stack),this._resyncElements(u),(i||_!==r._stacked)&&TE(this,r._parsed)}configure(){let u=this.chart.config,r=u.datasetScopeKeys(this._type),l=u.getOptionScopes(this.getDataset(),r,!0);this.options=u.createResolver(l,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(u,r){let{_cachedMeta:l,_data:i}=this,{iScale:_,_stacked:C}=l,I=_.axis,O=u===0&&r===i.length?!0:l._sorted,N=u>0&&l._parsed[u-1],q,ie,de;if(this._parsing===!1)l._parsed=i,l._sorted=!0,de=i;else{er(i[u])?de=this.parseArrayData(l,i,u,r):ln(i[u])?de=this.parseObjectData(l,i,u,r):de=this.parsePrimitiveData(l,i,u,r);let xe=()=>ie[I]===null||N&&ie[I]<N[I];for(q=0;q<r;++q)l._parsed[q+u]=ie=de[q],O&&(xe()&&(O=!1),N=ie);l._sorted=O}C&&TE(this,de)}parsePrimitiveData(u,r,l,i){let{iScale:_,vScale:C}=u,I=_.axis,O=C.axis,N=_.getLabels(),q=_===C,ie=new Array(i),de,xe,ke;for(de=0,xe=i;de<xe;++de)ke=de+l,ie[de]={[I]:q||_.parse(N[ke],ke),[O]:C.parse(r[ke],ke)};return ie}parseArrayData(u,r,l,i){let{xScale:_,yScale:C}=u,I=new Array(i),O,N,q,ie;for(O=0,N=i;O<N;++O)q=O+l,ie=r[q],I[O]={x:_.parse(ie[0],q),y:C.parse(ie[1],q)};return I}parseObjectData(u,r,l,i){let{xScale:_,yScale:C}=u,{xAxisKey:I="x",yAxisKey:O="y"}=this._parsing,N=new Array(i),q,ie,de,xe;for(q=0,ie=i;q<ie;++q)de=q+l,xe=r[de],N[q]={x:_.parse(Yl(xe,I),de),y:C.parse(Yl(xe,O),de)};return N}getParsed(u){return this._cachedMeta._parsed[u]}getDataElement(u){return this._cachedMeta.data[u]}applyStack(u,r,l){let i=this.chart,_=this._cachedMeta,C=r[u.axis],I={keys:SD(i,!0),values:r._stacks[u.axis]._visualValues};return ME(I,C,_.index,{mode:l})}updateRangeFromParsed(u,r,l,i){let _=l[r.axis],C=_===null?NaN:_,I=i&&l._stacks[r.axis];i&&I&&(i.values=I,C=ME(i,_,this._cachedMeta.index)),u.min=Math.min(u.min,C),u.max=Math.max(u.max,C)}getMinMax(u,r){let l=this._cachedMeta,i=l._parsed,_=l._sorted&&u===l.iScale,C=i.length,I=this._getOtherScale(u),O=c4(r,l,this.chart),N={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:q,max:ie}=o4(I),de,xe;function ke(){xe=i[de];let Ae=xe[I.axis];return!pr(xe[u.axis])||q>Ae||ie<Ae}for(de=0;de<C&&!(!ke()&&(this.updateRangeFromParsed(N,u,xe,O),_));++de);if(_){for(de=C-1;de>=0;--de)if(!ke()){this.updateRangeFromParsed(N,u,xe,O);break}}return N}getAllParsedValues(u){let r=this._cachedMeta._parsed,l=[],i,_,C;for(i=0,_=r.length;i<_;++i)C=r[i][u.axis],pr(C)&&l.push(C);return l}getMaxOverflow(){return!1}getLabelAndValue(u){let r=this._cachedMeta,l=r.iScale,i=r.vScale,_=this.getParsed(u);return{label:l?""+l.getLabelForValue(_[l.axis]):"",value:i?""+i.getLabelForValue(_[i.axis]):""}}_update(u){let r=this._cachedMeta;this.update(u||"default"),r._clip=i4(Yi(this.options.clip,t4(r.xScale,r.yScale,this.getMaxOverflow())))}update(u){}draw(){let u=this._ctx,r=this.chart,l=this._cachedMeta,i=l.data||[],_=r.chartArea,C=[],I=this._drawStart||0,O=this._drawCount||i.length-I,N=this.options.drawActiveElementsOnTop,q;for(l.dataset&&l.dataset.draw(u,_,I,O),q=I;q<I+O;++q){let ie=i[q];ie.hidden||(ie.active&&N?C.push(ie):ie.draw(u,_))}for(q=0;q<C.length;++q)C[q].draw(u,_)}getStyle(u,r){let l=r?"active":"default";return u===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(l):this.resolveDataElementOptions(u||0,l)}getContext(u,r,l){let i=this.getDataset(),_;if(u>=0&&u<this._cachedMeta.data.length){let C=this._cachedMeta.data[u];_=C.$context||(C.$context=l4(this.getContext(),u,C)),_.parsed=this.getParsed(u),_.raw=i.data[u],_.index=_.dataIndex=u}else _=this.$context||(this.$context=s4(this.chart.getContext(),this.index)),_.dataset=i,_.index=_.datasetIndex=this.index;return _.active=!!r,_.mode=l,_}resolveDatasetElementOptions(u){return this._resolveElementOptions(this.datasetElementType.id,u)}resolveDataElementOptions(u,r){return this._resolveElementOptions(this.dataElementType.id,r,u)}_resolveElementOptions(u,r="default",l){let i=r==="active",_=this._cachedDataOpts,C=u+"-"+r,I=_[C],O=this.enableOptionSharing&&Ym(l);if(I)return EE(I,O);let N=this.chart.config,q=N.datasetElementScopeKeys(this._type,u),ie=i?[`${u}Hover`,"hover",u,""]:[u,""],de=N.getOptionScopes(this.getDataset(),q),xe=Object.keys(fr.elements[u]),ke=()=>this.getContext(l,i,r),Ae=N.resolveNamedOptions(de,xe,ke,ie);return Ae.$shared&&(Ae.$shared=O,_[C]=Object.freeze(EE(Ae,O))),Ae}_resolveAnimations(u,r,l){let i=this.chart,_=this._cachedDataOpts,C=`animation-${r}`,I=_[C];if(I)return I;let O;if(i.options.animation!==!1){let q=this.chart.config,ie=q.datasetAnimationScopeKeys(this._type,r),de=q.getOptionScopes(this.getDataset(),ie);O=q.createResolver(de,this.getContext(u,l,r))}let N=new uy(i,O&&O.animations);return O&&O._cacheable&&(_[C]=Object.freeze(N)),N}getSharedOptions(u){if(u.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},u))}includeOptions(u,r){return!r||Fw(u)||this.chart._animationsDisabled}_getSharedOptions(u,r){let l=this.resolveDataElementOptions(u,r),i=this._sharedOptions,_=this.getSharedOptions(l),C=this.includeOptions(r,_)||_!==i;return this.updateSharedOptions(_,r,l),{sharedOptions:_,includeOptions:C}}updateElement(u,r,l,i){Fw(i)?Object.assign(u,l):this._resolveAnimations(r,i).update(u,l)}updateSharedOptions(u,r,l){u&&!Fw(r)&&this._resolveAnimations(void 0,r).update(u,l)}_setStyle(u,r,l,i){u.active=i;let _=this.getStyle(r,i);this._resolveAnimations(r,l,i).update(u,{options:!i&&this.getSharedOptions(_)||_})}removeHoverStyle(u,r,l){this._setStyle(u,l,"active",!1)}setHoverStyle(u,r,l){this._setStyle(u,l,"active",!0)}_removeDatasetHoverStyle(){let u=this._cachedMeta.dataset;u&&this._setStyle(u,void 0,"active",!1)}_setDatasetHoverStyle(){let u=this._cachedMeta.dataset;u&&this._setStyle(u,void 0,"active",!0)}_resyncElements(u){let r=this._data,l=this._cachedMeta.data;for(let[I,O,N]of this._syncList)this[I](O,N);this._syncList=[];let i=l.length,_=r.length,C=Math.min(_,i);C&&this.parse(0,C),_>i?this._insertElements(i,_-i,u):_<i&&this._removeElements(_,i-_)}_insertElements(u,r,l=!0){let i=this._cachedMeta,_=i.data,C=u+r,I,O=N=>{for(N.length+=r,I=N.length-1;I>=C;I--)N[I]=N[I-r]};for(O(_),I=u;I<C;++I)_[I]=new this.dataElementType;this._parsing&&O(i._parsed),this.parse(u,r),l&&this.updateElements(_,u,r,"reset")}updateElements(u,r,l,i){}_removeElements(u,r){let l=this._cachedMeta;if(this._parsing){let i=l._parsed.splice(u,r);l._stacked&&Tg(l,i)}l.data.splice(u,r)}_sync(u){if(this._parsing)this._syncList.push(u);else{let[r,l,i]=u;this[r](l,i)}this.chart._dataChanges.push([this.index,...u])}_onDataPush(){let u=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-u,u])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(u,r){r&&this._sync(["_removeElements",u,r]);let l=arguments.length-2;l&&this._sync(["_insertElements",u,l])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return d})();function d4(d,s){if(!d._cache.$bar){let u=d.getMatchingVisibleMetas(s),r=[];for(let l=0,i=u.length;l<i;l++)r=r.concat(u[l].controller.getAllParsedValues(d));d._cache.$bar=fw(r.sort((l,i)=>l-i))}return d._cache.$bar}function h4(d){let s=d.iScale,u=d4(s,d.type),r=s._length,l,i,_,C,I=()=>{_===32767||_===-32768||(Ym(C)&&(r=Math.min(r,Math.abs(_-C)||r)),C=_)};for(l=0,i=u.length;l<i;++l)_=s.getPixelForValue(u[l]),I();for(C=void 0,l=0,i=s.ticks.length;l<i;++l)_=s.getPixelForTick(l),I();return r}function u4(d,s,u,r){let l=u.barThickness,i,_;return vn(l)?(i=s.min*u.categoryPercentage,_=u.barPercentage):(i=l*r,_=1),{chunk:i/r,ratio:_,start:s.pixels[d]-i/2}}function m4(d,s,u,r){let l=s.pixels,i=l[d],_=d>0?l[d-1]:null,C=d<l.length-1?l[d+1]:null,I=u.categoryPercentage;_===null&&(_=i-(C===null?s.end-s.start:C-i)),C===null&&(C=i+i-_);let O=i-(i-Math.min(_,C))/2*I;return{chunk:Math.abs(C-_)/2*I/r,ratio:u.barPercentage,start:O}}function p4(d,s,u,r){let l=u.parse(d[0],r),i=u.parse(d[1],r),_=Math.min(l,i),C=Math.max(l,i),I=_,O=C;Math.abs(_)>Math.abs(C)&&(I=C,O=_),s[u.axis]=O,s._custom={barStart:I,barEnd:O,start:l,end:i,min:_,max:C}}function MD(d,s,u,r){return er(d)?p4(d,s,u,r):s[u.axis]=u.parse(d,r),s}function DE(d,s,u,r){let l=d.iScale,i=d.vScale,_=l.getLabels(),C=l===i,I=[],O,N,q,ie;for(O=u,N=u+r;O<N;++O)ie=s[O],q={},q[l.axis]=C||l.parse(_[O],O),I.push(MD(ie,q,i,O));return I}function zw(d){return d&&d.barStart!==void 0&&d.barEnd!==void 0}function f4(d,s,u){return d!==0?ws(d):(s.isHorizontal()?1:-1)*(s.min>=u?1:-1)}function g4(d){let s,u,r,l,i;return d.horizontal?(s=d.base>d.x,u="left",r="right"):(s=d.base<d.y,u="bottom",r="top"),s?(l="end",i="start"):(l="start",i="end"),{start:u,end:r,reverse:s,top:l,bottom:i}}function _4(d,s,u,r){let l=s.borderSkipped,i={};if(!l){d.borderSkipped=i;return}if(l===!0){d.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:_,end:C,reverse:I,top:O,bottom:N}=g4(d);l==="middle"&&u&&(d.enableBorderRadius=!0,(u._top||0)===r?l=O:(u._bottom||0)===r?l=N:(i[AE(N,_,C,I)]=!0,l=O)),i[AE(l,_,C,I)]=!0,d.borderSkipped=i}function AE(d,s,u,r){return r?(d=b4(d,s,u),d=PE(d,u,s)):d=PE(d,s,u),d}function b4(d,s,u){return d===s?u:d===u?s:d}function PE(d,s,u){return d==="start"?s:d==="end"?u:d}function y4(d,{inflateAmount:s},u){d.inflateAmount=s==="auto"?u===1?.33:0:s}var v4=(()=>{class d extends Id{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(u,r,l,i){return DE(u,r,l,i)}parseArrayData(u,r,l,i){return DE(u,r,l,i)}parseObjectData(u,r,l,i){let{iScale:_,vScale:C}=u,{xAxisKey:I="x",yAxisKey:O="y"}=this._parsing,N=_.axis==="x"?I:O,q=C.axis==="x"?I:O,ie=[],de,xe,ke,Ae;for(de=l,xe=l+i;de<xe;++de)Ae=r[de],ke={},ke[_.axis]=_.parse(Yl(Ae,N),de),ie.push(MD(Yl(Ae,q),ke,C,de));return ie}updateRangeFromParsed(u,r,l,i){super.updateRangeFromParsed(u,r,l,i);let _=l._custom;_&&r===this._cachedMeta.vScale&&(u.min=Math.min(u.min,_.min),u.max=Math.max(u.max,_.max))}getMaxOverflow(){return 0}getLabelAndValue(u){let r=this._cachedMeta,{iScale:l,vScale:i}=r,_=this.getParsed(u),C=_._custom,I=zw(C)?"["+C.start+", "+C.end+"]":""+i.getLabelForValue(_[i.axis]);return{label:""+l.getLabelForValue(_[l.axis]),value:I}}initialize(){this.enableOptionSharing=!0,super.initialize();let u=this._cachedMeta;u.stack=this.getDataset().stack}update(u){let r=this._cachedMeta;this.updateElements(r.data,0,r.data.length,u)}updateElements(u,r,l,i){let _=i==="reset",{index:C,_cachedMeta:{vScale:I}}=this,O=I.getBasePixel(),N=I.isHorizontal(),q=this._getRuler(),{sharedOptions:ie,includeOptions:de}=this._getSharedOptions(r,i);for(let xe=r;xe<r+l;xe++){let ke=this.getParsed(xe),Ae=_||vn(ke[I.axis])?{base:O,head:O}:this._calculateBarValuePixels(xe),Xe=this._calculateBarIndexPixels(xe,q),qe=(ke._stacks||{})[I.axis],ut={horizontal:N,base:Ae.base,enableBorderRadius:!qe||zw(ke._custom)||C===qe._top||C===qe._bottom,x:N?Ae.head:Xe.center,y:N?Xe.center:Ae.head,height:N?Xe.size:Math.abs(Ae.size),width:N?Math.abs(Ae.size):Xe.size};de&&(ut.options=ie||this.resolveDataElementOptions(xe,u[xe].active?"active":i));let It=ut.options||u[xe].options;_4(ut,It,qe,C),y4(ut,It,q.ratio),this.updateElement(u[xe],xe,ut,i)}}_getStacks(u,r){let{iScale:l}=this._cachedMeta,i=l.getMatchingVisibleMetas(this._type).filter(O=>O.controller.options.grouped),_=l.options.stacked,C=[],I=O=>{let N=O.controller.getParsed(r),q=N&&N[O.vScale.axis];if(vn(q)||isNaN(q))return!0};for(let O of i)if(!(r!==void 0&&I(O))&&((_===!1||C.indexOf(O.stack)===-1||_===void 0&&O.stack===void 0)&&C.push(O.stack),O.index===u))break;return C.length||C.push(void 0),C}_getStackCount(u){return this._getStacks(void 0,u).length}_getStackIndex(u,r,l){let i=this._getStacks(u,l),_=r!==void 0?i.indexOf(r):-1;return _===-1?i.length-1:_}_getRuler(){let u=this.options,r=this._cachedMeta,l=r.iScale,i=[],_,C;for(_=0,C=r.data.length;_<C;++_)i.push(l.getPixelForValue(this.getParsed(_)[l.axis],_));let I=u.barThickness;return{min:I||h4(r),pixels:i,start:l._startPixel,end:l._endPixel,stackCount:this._getStackCount(),scale:l,grouped:u.grouped,ratio:I?1:u.categoryPercentage*u.barPercentage}}_calculateBarValuePixels(u){let{_cachedMeta:{vScale:r,_stacked:l,index:i},options:{base:_,minBarLength:C}}=this,I=_||0,O=this.getParsed(u),N=O._custom,q=zw(N),ie=O[r.axis],de=0,xe=l?this.applyStack(r,O,l):ie,ke,Ae;xe!==ie&&(de=xe-ie,xe=ie),q&&(ie=N.barStart,xe=N.barEnd-N.barStart,ie!==0&&ws(ie)!==ws(N.barEnd)&&(de=0),de+=ie);let Xe=!vn(_)&&!q?_:de,qe=r.getPixelForValue(Xe);if(this.chart.getDataVisibility(u)?ke=r.getPixelForValue(de+xe):ke=qe,Ae=ke-qe,Math.abs(Ae)<C){Ae=f4(Ae,r,I)*C,ie===I&&(qe-=Ae/2);let ut=r.getPixelForDecimal(0),It=r.getPixelForDecimal(1),wt=Math.min(ut,It),Et=Math.max(ut,It);qe=Math.max(Math.min(qe,Et),wt),ke=qe+Ae,l&&!q&&(O._stacks[r.axis]._visualValues[i]=r.getValueForPixel(ke)-r.getValueForPixel(qe))}if(qe===r.getPixelForValue(I)){let ut=ws(Ae)*r.getLineWidthForValue(I)/2;qe+=ut,Ae-=ut}return{size:Ae,base:qe,head:ke,center:ke+Ae/2}}_calculateBarIndexPixels(u,r){let l=r.scale,i=this.options,_=i.skipNull,C=Yi(i.maxBarThickness,1/0),I,O;if(r.grouped){let N=_?this._getStackCount(u):r.stackCount,q=i.barThickness==="flex"?m4(u,r,i,N):u4(u,r,i,N),ie=this._getStackIndex(this.index,this._cachedMeta.stack,_?u:void 0);I=q.start+q.chunk*ie+q.chunk/2,O=Math.min(C,q.chunk*q.ratio)}else I=l.getPixelForValue(this.getParsed(u)[l.axis],u),O=Math.min(C,r.min*r.ratio);return{base:I-O/2,head:I+O/2,center:I,size:O}}draw(){let u=this._cachedMeta,r=u.vScale,l=u.data,i=l.length,_=0;for(;_<i;++_)this.getParsed(_)[r.axis]!==null&&!l[_].hidden&&l[_].draw(this._ctx)}}return d})(),x4=(()=>{class d extends Id{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(u,r,l,i){let _=super.parsePrimitiveData(u,r,l,i);for(let C=0;C<_.length;C++)_[C]._custom=this.resolveDataElementOptions(C+l).radius;return _}parseArrayData(u,r,l,i){let _=super.parseArrayData(u,r,l,i);for(let C=0;C<_.length;C++){let I=r[l+C];_[C]._custom=Yi(I[2],this.resolveDataElementOptions(C+l).radius)}return _}parseObjectData(u,r,l,i){let _=super.parseObjectData(u,r,l,i);for(let C=0;C<_.length;C++){let I=r[l+C];_[C]._custom=Yi(I&&I.r&&+I.r,this.resolveDataElementOptions(C+l).radius)}return _}getMaxOverflow(){let u=this._cachedMeta.data,r=0;for(let l=u.length-1;l>=0;--l)r=Math.max(r,u[l].size(this.resolveDataElementOptions(l))/2);return r>0&&r}getLabelAndValue(u){let r=this._cachedMeta,l=this.chart.data.labels||[],{xScale:i,yScale:_}=r,C=this.getParsed(u),I=i.getLabelForValue(C.x),O=_.getLabelForValue(C.y),N=C._custom;return{label:l[u]||"",value:"("+I+", "+O+(N?", "+N:"")+")"}}update(u){let r=this._cachedMeta.data;this.updateElements(r,0,r.length,u)}updateElements(u,r,l,i){let _=i==="reset",{iScale:C,vScale:I}=this._cachedMeta,{sharedOptions:O,includeOptions:N}=this._getSharedOptions(r,i),q=C.axis,ie=I.axis;for(let de=r;de<r+l;de++){let xe=u[de],ke=!_&&this.getParsed(de),Ae={},Xe=Ae[q]=_?C.getPixelForDecimal(.5):C.getPixelForValue(ke[q]),qe=Ae[ie]=_?I.getBasePixel():I.getPixelForValue(ke[ie]);Ae.skip=isNaN(Xe)||isNaN(qe),N&&(Ae.options=O||this.resolveDataElementOptions(de,xe.active?"active":i),_&&(Ae.options.radius=0)),this.updateElement(xe,de,Ae,i)}}resolveDataElementOptions(u,r){let l=this.getParsed(u),i=super.resolveDataElementOptions(u,r);i.$shared&&(i=Object.assign({},i,{$shared:!1}));let _=i.radius;return r!=="active"&&(i.radius=0),i.radius+=Yi(l&&l._custom,_),i}}return d})();function w4(d,s,u){let r=1,l=1,i=0,_=0;if(s<ir){let C=d,I=C+s,O=Math.cos(C),N=Math.sin(C),q=Math.cos(I),ie=Math.sin(I),de=(ut,It,wt)=>Xm(ut,C,I,!0)?1:Math.max(It,It*u,wt,wt*u),xe=(ut,It,wt)=>Xm(ut,C,I,!0)?-1:Math.min(It,It*u,wt,wt*u),ke=de(0,O,q),Ae=de(xr,N,ie),Xe=xe(tr,O,q),qe=xe(tr+xr,N,ie);r=(ke-Xe)/2,l=(Ae-qe)/2,i=-(ke+Xe)/2,_=-(Ae+qe)/2}return{ratioX:r,ratioY:l,offsetX:i,offsetY:_}}var hC=(()=>{class d extends Id{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:u=>u!=="spacing",_indexable:u=>u!=="spacing"&&!u.startsWith("borderDash")&&!u.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(u){let r=u.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:l,color:i}}=u.legend.options;return r.labels.map((_,C)=>{let O=u.getDatasetMeta(0).controller.getStyle(C);return{text:_,fillStyle:O.backgroundColor,strokeStyle:O.borderColor,fontColor:i,lineWidth:O.borderWidth,pointStyle:l,hidden:!u.getDataVisibility(C),index:C}})}return[]}},onClick(u,r,l){l.chart.toggleDataVisibility(r.index),l.chart.update()}}}};constructor(u,r){super(u,r),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(u,r){let l=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=l;else{let _=O=>+l[O];if(ln(l[u])){let{key:O="value"}=this._parsing;_=N=>+Yl(l[N],O)}let C,I;for(C=u,I=u+r;C<I;++C)i._parsed[C]=_(C)}}_getRotation(){return qa(this.options.rotation-90)}_getCircumference(){return qa(this.options.circumference)}_getRotationExtents(){let u=ir,r=-ir;for(let l=0;l<this.chart.data.datasets.length;++l)if(this.chart.isDatasetVisible(l)&&this.chart.getDatasetMeta(l).type===this._type){let i=this.chart.getDatasetMeta(l).controller,_=i._getRotation(),C=i._getCircumference();u=Math.min(u,_),r=Math.max(r,_+C)}return{rotation:u,circumference:r-u}}update(u){let r=this.chart,{chartArea:l}=r,i=this._cachedMeta,_=i.data,C=this.getMaxBorderWidth()+this.getMaxOffset(_)+this.options.spacing,I=Math.max((Math.min(l.width,l.height)-C)/2,0),O=Math.min(ZT(this.options.cutout,I),1),N=this._getRingWeight(this.index),{circumference:q,rotation:ie}=this._getRotationExtents(),{ratioX:de,ratioY:xe,offsetX:ke,offsetY:Ae}=w4(ie,q,O),Xe=(l.width-C)/de,qe=(l.height-C)/xe,ut=Math.max(Math.min(Xe,qe)/2,0),It=lw(this.options.radius,ut),wt=Math.max(It*O,0),Et=(It-wt)/this._getVisibleDatasetWeightTotal();this.offsetX=ke*It,this.offsetY=Ae*It,i.total=this.calculateTotal(),this.outerRadius=It-Et*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Et*N,0),this.updateElements(_,0,_.length,u)}_circumference(u,r){let l=this.options,i=this._cachedMeta,_=this._getCircumference();return r&&l.animation.animateRotate||!this.chart.getDataVisibility(u)||i._parsed[u]===null||i.data[u].hidden?0:this.calculateCircumference(i._parsed[u]*_/ir)}updateElements(u,r,l,i){let _=i==="reset",C=this.chart,I=C.chartArea,N=C.options.animation,q=(I.left+I.right)/2,ie=(I.top+I.bottom)/2,de=_&&N.animateScale,xe=de?0:this.innerRadius,ke=de?0:this.outerRadius,{sharedOptions:Ae,includeOptions:Xe}=this._getSharedOptions(r,i),qe=this._getRotation(),ut;for(ut=0;ut<r;++ut)qe+=this._circumference(ut,_);for(ut=r;ut<r+l;++ut){let It=this._circumference(ut,_),wt=u[ut],Et={x:q+this.offsetX,y:ie+this.offsetY,startAngle:qe,endAngle:qe+It,circumference:It,outerRadius:ke,innerRadius:xe};Xe&&(Et.options=Ae||this.resolveDataElementOptions(ut,wt.active?"active":i)),qe+=It,this.updateElement(wt,ut,Et,i)}}calculateTotal(){let u=this._cachedMeta,r=u.data,l=0,i;for(i=0;i<r.length;i++){let _=u._parsed[i];_!==null&&!isNaN(_)&&this.chart.getDataVisibility(i)&&!r[i].hidden&&(l+=Math.abs(_))}return l}calculateCircumference(u){let r=this._cachedMeta.total;return r>0&&!isNaN(u)?ir*(Math.abs(u)/r):0}getLabelAndValue(u){let r=this._cachedMeta,l=this.chart,i=l.data.labels||[],_=Qm(r._parsed[u],l.options.locale);return{label:i[u]||"",value:_}}getMaxBorderWidth(u){let r=0,l=this.chart,i,_,C,I,O;if(!u){for(i=0,_=l.data.datasets.length;i<_;++i)if(l.isDatasetVisible(i)){C=l.getDatasetMeta(i),u=C.data,I=C.controller;break}}if(!u)return 0;for(i=0,_=u.length;i<_;++i)O=I.resolveDataElementOptions(i),O.borderAlign!=="inner"&&(r=Math.max(r,O.borderWidth||0,O.hoverBorderWidth||0));return r}getMaxOffset(u){let r=0;for(let l=0,i=u.length;l<i;++l){let _=this.resolveDataElementOptions(l);r=Math.max(r,_.offset||0,_.hoverOffset||0)}return r}_getRingWeightOffset(u){let r=0;for(let l=0;l<u;++l)this.chart.isDatasetVisible(l)&&(r+=this._getRingWeight(l));return r}_getRingWeight(u){return Math.max(Yi(this.chart.data.datasets[u].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return d})(),C4=(()=>{class d extends Id{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(u){let r=this._cachedMeta,{dataset:l,data:i=[],_dataset:_}=r,C=this.chart._animationsDisabled,{start:I,count:O}=bw(r,i,C);this._drawStart=I,this._drawCount=O,yw(r)&&(I=0,O=i.length),l._chart=this.chart,l._datasetIndex=this.index,l._decimated=!!_._decimated,l.points=i;let N=this.resolveDatasetElementOptions(u);this.options.showLine||(N.borderWidth=0),N.segment=this.options.segment,this.updateElement(l,void 0,{animated:!C,options:N},u),this.updateElements(i,I,O,u)}updateElements(u,r,l,i){let _=i==="reset",{iScale:C,vScale:I,_stacked:O,_dataset:N}=this._cachedMeta,{sharedOptions:q,includeOptions:ie}=this._getSharedOptions(r,i),de=C.axis,xe=I.axis,{spanGaps:ke,segment:Ae}=this.options,Xe=Qh(ke)?ke:Number.POSITIVE_INFINITY,qe=this.chart._animationsDisabled||_||i==="none",ut=r+l,It=u.length,wt=r>0&&this.getParsed(r-1);for(let Et=0;Et<It;++Et){let Ht=u[Et],Ct=qe?Ht:{};if(Et<r||Et>=ut){Ct.skip=!0;continue}let Yt=this.getParsed(Et),zt=vn(Yt[xe]),ki=Ct[de]=C.getPixelForValue(Yt[de],Et),Hi=Ct[xe]=_||zt?I.getBasePixel():I.getPixelForValue(O?this.applyStack(I,Yt,O):Yt[xe],Et);Ct.skip=isNaN(ki)||isNaN(Hi)||zt,Ct.stop=Et>0&&Math.abs(Yt[de]-wt[de])>Xe,Ae&&(Ct.parsed=Yt,Ct.raw=N.data[Et]),ie&&(Ct.options=q||this.resolveDataElementOptions(Et,Ht.active?"active":i)),qe||this.updateElement(Ht,Et,Ct,i),wt=Yt}}getMaxOverflow(){let u=this._cachedMeta,r=u.dataset,l=r.options&&r.options.borderWidth||0,i=u.data||[];if(!i.length)return l;let _=i[0].size(this.resolveDataElementOptions(0)),C=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(l,_,C)/2}draw(){let u=this._cachedMeta;u.dataset.updateControlPoints(this.chart.chartArea,u.iScale.axis),super.draw()}}return d})(),kD=(()=>{class d extends Id{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(u){let r=u.data;if(r.labels.length&&r.datasets.length){let{labels:{pointStyle:l,color:i}}=u.legend.options;return r.labels.map((_,C)=>{let O=u.getDatasetMeta(0).controller.getStyle(C);return{text:_,fillStyle:O.backgroundColor,strokeStyle:O.borderColor,fontColor:i,lineWidth:O.borderWidth,pointStyle:l,hidden:!u.getDataVisibility(C),index:C}})}return[]}},onClick(u,r,l){l.chart.toggleDataVisibility(r.index),l.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(u,r){super(u,r),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(u){let r=this._cachedMeta,l=this.chart,i=l.data.labels||[],_=Qm(r._parsed[u].r,l.options.locale);return{label:i[u]||"",value:_}}parseObjectData(u,r,l,i){return Tw.bind(this)(u,r,l,i)}update(u){let r=this._cachedMeta.data;this._updateRadius(),this.updateElements(r,0,r.length,u)}getMinMax(){let u=this._cachedMeta,r={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return u.data.forEach((l,i)=>{let _=this.getParsed(i).r;!isNaN(_)&&this.chart.getDataVisibility(i)&&(_<r.min&&(r.min=_),_>r.max&&(r.max=_))}),r}_updateRadius(){let u=this.chart,r=u.chartArea,l=u.options,i=Math.min(r.right-r.left,r.bottom-r.top),_=Math.max(i/2,0),C=Math.max(l.cutoutPercentage?_/100*l.cutoutPercentage:1,0),I=(_-C)/u.getVisibleDatasetCount();this.outerRadius=_-I*this.index,this.innerRadius=this.outerRadius-I}updateElements(u,r,l,i){let _=i==="reset",C=this.chart,O=C.options.animation,N=this._cachedMeta.rScale,q=N.xCenter,ie=N.yCenter,de=N.getIndexAngle(0)-.5*tr,xe=de,ke,Ae=360/this.countVisibleElements();for(ke=0;ke<r;++ke)xe+=this._computeAngle(ke,i,Ae);for(ke=r;ke<r+l;ke++){let Xe=u[ke],qe=xe,ut=xe+this._computeAngle(ke,i,Ae),It=C.getDataVisibility(ke)?N.getDistanceFromCenterForValue(this.getParsed(ke).r):0;xe=ut,_&&(O.animateScale&&(It=0),O.animateRotate&&(qe=ut=de));let wt={x:q,y:ie,innerRadius:0,outerRadius:It,startAngle:qe,endAngle:ut,options:this.resolveDataElementOptions(ke,Xe.active?"active":i)};this.updateElement(Xe,ke,wt,i)}}countVisibleElements(){let u=this._cachedMeta,r=0;return u.data.forEach((l,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&r++}),r}_computeAngle(u,r,l){return this.chart.getDataVisibility(u)?qa(this.resolveDataElementOptions(u,r).angle||l):0}}return d})(),S4=(()=>{class d extends hC{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}return d})(),M4=(()=>{class d extends Id{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(u){let r=this._cachedMeta.vScale,l=this.getParsed(u);return{label:r.getLabels()[u],value:""+r.getLabelForValue(l[r.axis])}}parseObjectData(u,r,l,i){return Tw.bind(this)(u,r,l,i)}update(u){let r=this._cachedMeta,l=r.dataset,i=r.data||[],_=r.iScale.getLabels();if(l.points=i,u!=="resize"){let C=this.resolveDatasetElementOptions(u);this.options.showLine||(C.borderWidth=0);let I={_loop:!0,_fullLoop:_.length===i.length,options:C};this.updateElement(l,void 0,I,u)}this.updateElements(i,0,i.length,u)}updateElements(u,r,l,i){let _=this._cachedMeta.rScale,C=i==="reset";for(let I=r;I<r+l;I++){let O=u[I],N=this.resolveDataElementOptions(I,O.active?"active":i),q=_.getPointPositionForValue(I,this.getParsed(I).r),ie=C?_.xCenter:q.x,de=C?_.yCenter:q.y,xe={x:ie,y:de,angle:q.angle,skip:isNaN(ie)||isNaN(de),options:N};this.updateElement(O,I,xe,i)}}}return d})(),k4=(()=>{class d extends Id{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(u){let r=this._cachedMeta,l=this.chart.data.labels||[],{xScale:i,yScale:_}=r,C=this.getParsed(u),I=i.getLabelForValue(C.x),O=_.getLabelForValue(C.y);return{label:l[u]||"",value:"("+I+", "+O+")"}}update(u){let r=this._cachedMeta,{data:l=[]}=r,i=this.chart._animationsDisabled,{start:_,count:C}=bw(r,l,i);if(this._drawStart=_,this._drawCount=C,yw(r)&&(_=0,C=l.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:I,_dataset:O}=r;I._chart=this.chart,I._datasetIndex=this.index,I._decimated=!!O._decimated,I.points=l;let N=this.resolveDatasetElementOptions(u);N.segment=this.options.segment,this.updateElement(I,void 0,{animated:!i,options:N},u)}else this.datasetElementType&&(delete r.dataset,this.datasetElementType=!1);this.updateElements(l,_,C,u)}addElements(){let{showLine:u}=this.options;!this.datasetElementType&&u&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(u,r,l,i){let _=i==="reset",{iScale:C,vScale:I,_stacked:O,_dataset:N}=this._cachedMeta,q=this.resolveDataElementOptions(r,i),ie=this.getSharedOptions(q),de=this.includeOptions(i,ie),xe=C.axis,ke=I.axis,{spanGaps:Ae,segment:Xe}=this.options,qe=Qh(Ae)?Ae:Number.POSITIVE_INFINITY,ut=this.chart._animationsDisabled||_||i==="none",It=r>0&&this.getParsed(r-1);for(let wt=r;wt<r+l;++wt){let Et=u[wt],Ht=this.getParsed(wt),Ct=ut?Et:{},Yt=vn(Ht[ke]),zt=Ct[xe]=C.getPixelForValue(Ht[xe],wt),ki=Ct[ke]=_||Yt?I.getBasePixel():I.getPixelForValue(O?this.applyStack(I,Ht,O):Ht[ke],wt);Ct.skip=isNaN(zt)||isNaN(ki)||Yt,Ct.stop=wt>0&&Math.abs(Ht[xe]-It[xe])>qe,Xe&&(Ct.parsed=Ht,Ct.raw=N.data[wt]),de&&(Ct.options=ie||this.resolveDataElementOptions(wt,Et.active?"active":i)),ut||this.updateElement(Et,wt,Ct,i),It=Ht}this.updateSharedOptions(ie,i,q)}getMaxOverflow(){let u=this._cachedMeta,r=u.data||[];if(!this.options.showLine){let I=0;for(let O=r.length-1;O>=0;--O)I=Math.max(I,r[O].size(this.resolveDataElementOptions(O))/2);return I>0&&I}let l=u.dataset,i=l.options&&l.options.borderWidth||0;if(!r.length)return i;let _=r[0].size(this.resolveDataElementOptions(0)),C=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(i,_,C)/2}}return d})(),I4=Object.freeze({__proto__:null,BarController:v4,BubbleController:x4,DoughnutController:hC,LineController:C4,PieController:S4,PolarAreaController:kD,RadarController:M4,ScatterController:k4});function Jh(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var qw=class d{static override(s){Object.assign(d.prototype,s)}options;constructor(s){this.options=s||{}}init(){}formats(){return Jh()}parse(){return Jh()}format(){return Jh()}add(){return Jh()}diff(){return Jh()}startOf(){return Jh()}endOf(){return Jh()}},T4={_date:qw};function E4(d,s,u,r){let{controller:l,data:i,_sorted:_}=d,C=l._cachedMeta.iScale;if(C&&s===C.axis&&s!=="r"&&_&&i.length){let I=C._reversePixels?tE:Ks;if(r){if(l._sharedOptions){let O=i[0],N=typeof O.getRange=="function"&&O.getRange(s);if(N){let q=I(i,s,u-N),ie=I(i,s,u+N);return{lo:q.lo,hi:ie.hi}}}}else return I(i,s,u)}return{lo:0,hi:i.length-1}}function Bg(d,s,u,r,l){let i=d.getSortedVisibleDatasetMetas(),_=u[s];for(let C=0,I=i.length;C<I;++C){let{index:O,data:N}=i[C],{lo:q,hi:ie}=E4(i[C],s,_,l);for(let de=q;de<=ie;++de){let xe=N[de];xe.skip||r(xe,O,de)}}}function D4(d){let s=d.indexOf("x")!==-1,u=d.indexOf("y")!==-1;return function(r,l){let i=s?Math.abs(r.x-l.x):0,_=u?Math.abs(r.y-l.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(_,2))}}function Bw(d,s,u,r,l){let i=[];return!l&&!d.isPointInArea(s)||Bg(d,u,s,function(C,I,O){!l&&!Js(C,d.chartArea,0)||C.inRange(s.x,s.y,r)&&i.push({element:C,datasetIndex:I,index:O})},!0),i}function A4(d,s,u,r){let l=[];function i(_,C,I){let{startAngle:O,endAngle:N}=_.getProps(["startAngle","endAngle"],r),{angle:q}=mw(_,{x:s.x,y:s.y});Xm(q,O,N)&&l.push({element:_,datasetIndex:C,index:I})}return Bg(d,u,s,i),l}function P4(d,s,u,r,l,i){let _=[],C=D4(u),I=Number.POSITIVE_INFINITY;function O(N,q,ie){let de=N.inRange(s.x,s.y,l);if(r&&!de)return;let xe=N.getCenterPoint(l);if(!(!!i||d.isPointInArea(xe))&&!de)return;let Ae=C(s,xe);Ae<I?(_=[{element:N,datasetIndex:q,index:ie}],I=Ae):Ae===I&&_.push({element:N,datasetIndex:q,index:ie})}return Bg(d,u,s,O),_}function Nw(d,s,u,r,l,i){return!i&&!d.isPointInArea(s)?[]:u==="r"&&!r?A4(d,s,u,l):P4(d,s,u,r,l,i)}function OE(d,s,u,r,l){let i=[],_=u==="x"?"inXRange":"inYRange",C=!1;return Bg(d,u,s,(I,O,N)=>{I[_](s[u],l)&&(i.push({element:I,datasetIndex:O,index:N}),C=C||I.inRange(s.x,s.y,l))}),r&&!C?[]:i}var O4={evaluateInteractionItems:Bg,modes:{index(d,s,u,r){let l=Md(s,d),i=u.axis||"x",_=u.includeInvisible||!1,C=u.intersect?Bw(d,l,i,r,_):Nw(d,l,i,!1,r,_),I=[];return C.length?(d.getSortedVisibleDatasetMetas().forEach(O=>{let N=C[0].index,q=O.data[N];q&&!q.skip&&I.push({element:q,datasetIndex:O.index,index:N})}),I):[]},dataset(d,s,u,r){let l=Md(s,d),i=u.axis||"xy",_=u.includeInvisible||!1,C=u.intersect?Bw(d,l,i,r,_):Nw(d,l,i,!1,r,_);if(C.length>0){let I=C[0].datasetIndex,O=d.getDatasetMeta(I).data;C=[];for(let N=0;N<O.length;++N)C.push({element:O[N],datasetIndex:I,index:N})}return C},point(d,s,u,r){let l=Md(s,d),i=u.axis||"xy",_=u.includeInvisible||!1;return Bw(d,l,i,r,_)},nearest(d,s,u,r){let l=Md(s,d),i=u.axis||"xy",_=u.includeInvisible||!1;return Nw(d,l,i,u.intersect,r,_)},x(d,s,u,r){let l=Md(s,d);return OE(d,l,"x",u.intersect,r)},y(d,s,u,r){let l=Md(s,d);return OE(d,l,"y",u.intersect,r)}}},ID=["left","top","right","bottom"];function Eg(d,s){return d.filter(u=>u.pos===s)}function RE(d,s){return d.filter(u=>ID.indexOf(u.pos)===-1&&u.box.axis===s)}function Dg(d,s){return d.sort((u,r)=>{let l=s?r:u,i=s?u:r;return l.weight===i.weight?l.index-i.index:l.weight-i.weight})}function R4(d){let s=[],u,r,l,i,_,C;for(u=0,r=(d||[]).length;u<r;++u)l=d[u],{position:i,options:{stack:_,stackWeight:C=1}}=l,s.push({index:u,box:l,pos:i,horizontal:l.isHorizontal(),weight:l.weight,stack:_&&i+_,stackWeight:C});return s}function L4(d){let s={};for(let u of d){let{stack:r,pos:l,stackWeight:i}=u;if(!r||!ID.includes(l))continue;let _=s[r]||(s[r]={count:0,placed:0,weight:0,size:0});_.count++,_.weight+=i}return s}function F4(d,s){let u=L4(d),{vBoxMaxWidth:r,hBoxMaxHeight:l}=s,i,_,C;for(i=0,_=d.length;i<_;++i){C=d[i];let{fullSize:I}=C.box,O=u[C.stack],N=O&&C.stackWeight/O.weight;C.horizontal?(C.width=N?N*r:I&&s.availableWidth,C.height=l):(C.width=r,C.height=N?N*l:I&&s.availableHeight)}return u}function z4(d){let s=R4(d),u=Dg(s.filter(O=>O.box.fullSize),!0),r=Dg(Eg(s,"left"),!0),l=Dg(Eg(s,"right")),i=Dg(Eg(s,"top"),!0),_=Dg(Eg(s,"bottom")),C=RE(s,"x"),I=RE(s,"y");return{fullSize:u,leftAndTop:r.concat(i),rightAndBottom:l.concat(I).concat(_).concat(C),chartArea:Eg(s,"chartArea"),vertical:r.concat(l).concat(I),horizontal:i.concat(_).concat(C)}}function LE(d,s,u,r){return Math.max(d[u],s[u])+Math.max(d[r],s[r])}function TD(d,s){d.top=Math.max(d.top,s.top),d.left=Math.max(d.left,s.left),d.bottom=Math.max(d.bottom,s.bottom),d.right=Math.max(d.right,s.right)}function B4(d,s,u,r){let{pos:l,box:i}=u,_=d.maxPadding;if(!ln(l)){u.size&&(d[l]-=u.size);let q=r[u.stack]||{size:0,count:1};q.size=Math.max(q.size,u.horizontal?i.height:i.width),u.size=q.size/q.count,d[l]+=u.size}i.getPadding&&TD(_,i.getPadding());let C=Math.max(0,s.outerWidth-LE(_,d,"left","right")),I=Math.max(0,s.outerHeight-LE(_,d,"top","bottom")),O=C!==d.w,N=I!==d.h;return d.w=C,d.h=I,u.horizontal?{same:O,other:N}:{same:N,other:O}}function N4(d){let s=d.maxPadding;function u(r){let l=Math.max(s[r]-d[r],0);return d[r]+=l,l}d.y+=u("top"),d.x+=u("left"),u("right"),u("bottom")}function V4(d,s){let u=s.maxPadding;function r(l){let i={left:0,top:0,right:0,bottom:0};return l.forEach(_=>{i[_]=Math.max(s[_],u[_])}),i}return r(d?["left","right"]:["top","bottom"])}function Og(d,s,u,r){let l=[],i,_,C,I,O,N;for(i=0,_=d.length,O=0;i<_;++i){C=d[i],I=C.box,I.update(C.width||s.w,C.height||s.h,V4(C.horizontal,s));let{same:q,other:ie}=B4(s,u,C,r);O|=q&&l.length,N=N||ie,I.fullSize||l.push(C)}return O&&Og(l,s,u,r)||N}function ny(d,s,u,r,l){d.top=u,d.left=s,d.right=s+r,d.bottom=u+l,d.width=r,d.height=l}function FE(d,s,u,r){let l=u.padding,{x:i,y:_}=s;for(let C of d){let I=C.box,O=r[C.stack]||{count:1,placed:0,weight:1},N=C.stackWeight/O.weight||1;if(C.horizontal){let q=s.w*N,ie=O.size||I.height;Ym(O.start)&&(_=O.start),I.fullSize?ny(I,l.left,_,u.outerWidth-l.right-l.left,ie):ny(I,s.left+O.placed,_,q,ie),O.start=_,O.placed+=q,_=I.bottom}else{let q=s.h*N,ie=O.size||I.width;Ym(O.start)&&(i=O.start),I.fullSize?ny(I,i,l.top,ie,u.outerHeight-l.bottom-l.top):ny(I,i,s.top+O.placed,ie,q),O.start=i,O.placed+=q,i=I.right}}s.x=i,s.y=_}var To={addBox(d,s){d.boxes||(d.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(u){s.draw(u)}}]},d.boxes.push(s)},removeBox(d,s){let u=d.boxes?d.boxes.indexOf(s):-1;u!==-1&&d.boxes.splice(u,1)},configure(d,s,u){s.fullSize=u.fullSize,s.position=u.position,s.weight=u.weight},update(d,s,u,r){if(!d)return;let l=po(d.options.layout.padding),i=Math.max(s-l.width,0),_=Math.max(u-l.height,0),C=z4(d.boxes),I=C.vertical,O=C.horizontal;Ln(d.boxes,ke=>{typeof ke.beforeLayout=="function"&&ke.beforeLayout()});let N=I.reduce((ke,Ae)=>Ae.box.options&&Ae.box.options.display===!1?ke:ke+1,0)||1,q=Object.freeze({outerWidth:s,outerHeight:u,padding:l,availableWidth:i,availableHeight:_,vBoxMaxWidth:i/2/N,hBoxMaxHeight:_/2}),ie=Object.assign({},l);TD(ie,po(r));let de=Object.assign({maxPadding:ie,w:i,h:_,x:l.left,y:l.top},l),xe=F4(I.concat(O),q);Og(C.fullSize,de,q,xe),Og(I,de,q,xe),Og(O,de,q,xe)&&Og(I,de,q,xe),N4(de),FE(C.leftAndTop,de,q,xe),de.x+=de.w,de.y+=de.h,FE(C.rightAndBottom,de,q,xe),d.chartArea={left:de.left,top:de.top,right:de.left+de.w,bottom:de.top+de.h,height:de.h,width:de.w},Ln(C.chartArea,ke=>{let Ae=ke.box;Object.assign(Ae,d.chartArea),Ae.update(de.w,de.h,{left:0,top:0,right:0,bottom:0})})}},my=class{acquireContext(s,u){}releaseContext(s){return!1}addEventListener(s,u,r){}removeEventListener(s,u,r){}getDevicePixelRatio(){return 1}getMaximumSize(s,u,r,l){return u=Math.max(0,u||s.width),r=r||s.height,{width:u,height:Math.max(0,l?Math.floor(u/l):r)}}isAttached(s){return!0}updateConfig(s){}},$w=class extends my{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}},dy="$chartjs",j4={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},zE=d=>d===null||d==="";function U4(d,s){let u=d.style,r=d.getAttribute("height"),l=d.getAttribute("width");if(d[dy]={initial:{height:r,width:l,style:{display:u.display,height:u.height,width:u.width}}},u.display=u.display||"block",u.boxSizing=u.boxSizing||"border-box",zE(l)){let i=Dw(d,"width");i!==void 0&&(d.width=i)}if(zE(r))if(d.style.height==="")d.height=d.width/(s||2);else{let i=Dw(d,"height");i!==void 0&&(d.height=i)}return d}var ED=bE?{passive:!0}:!1;function H4(d,s,u){d&&d.addEventListener(s,u,ED)}function W4(d,s,u){d&&d.canvas&&d.canvas.removeEventListener(s,u,ED)}function G4(d,s){let u=j4[d.type]||d.type,{x:r,y:l}=Md(d,s);return{type:u,chart:s,native:d,x:r!==void 0?r:null,y:l!==void 0?l:null}}function py(d,s){for(let u of d)if(u===s||u.contains(s))return!0}function q4(d,s,u){let r=d.canvas,l=new MutationObserver(i=>{let _=!1;for(let C of i)_=_||py(C.addedNodes,r),_=_&&!py(C.removedNodes,r);_&&u()});return l.observe(document,{childList:!0,subtree:!0}),l}function $4(d,s,u){let r=d.canvas,l=new MutationObserver(i=>{let _=!1;for(let C of i)_=_||py(C.removedNodes,r),_=_&&!py(C.addedNodes,r);_&&u()});return l.observe(document,{childList:!0,subtree:!0}),l}var Lg=new Map,BE=0;function DD(){let d=window.devicePixelRatio;d!==BE&&(BE=d,Lg.forEach((s,u)=>{u.currentDevicePixelRatio!==d&&s()}))}function Y4(d,s){Lg.size||window.addEventListener("resize",DD),Lg.set(d,s)}function Z4(d){Lg.delete(d),Lg.size||window.removeEventListener("resize",DD)}function X4(d,s,u){let r=d.canvas,l=r&&ty(r);if(!l)return;let i=_w((C,I)=>{let O=l.clientWidth;u(C,I),O<l.clientWidth&&u()},window),_=new ResizeObserver(C=>{let I=C[0],O=I.contentRect.width,N=I.contentRect.height;O===0&&N===0||i(O,N)});return _.observe(l),Y4(d,i),_}function Vw(d,s,u){u&&u.disconnect(),s==="resize"&&Z4(d)}function Q4(d,s,u){let r=d.canvas,l=_w(i=>{d.ctx!==null&&u(G4(i,d))},d);return H4(r,s,l),l}var Yw=class extends my{acquireContext(s,u){let r=s&&s.getContext&&s.getContext("2d");return r&&r.canvas===s?(U4(s,u),r):null}releaseContext(s){let u=s.canvas;if(!u[dy])return!1;let r=u[dy].initial;["height","width"].forEach(i=>{let _=r[i];vn(_)?u.removeAttribute(i):u.setAttribute(i,_)});let l=r.style||{};return Object.keys(l).forEach(i=>{u.style[i]=l[i]}),u.width=u.width,delete u[dy],!0}addEventListener(s,u,r){this.removeEventListener(s,u);let l=s.$proxies||(s.$proxies={}),_={attach:q4,detach:$4,resize:X4}[u]||Q4;l[u]=_(s,u,r)}removeEventListener(s,u){let r=s.$proxies||(s.$proxies={}),l=r[u];if(!l)return;({attach:Vw,detach:Vw,resize:Vw}[u]||W4)(s,u,l),r[u]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,u,r,l){return _E(s,u,r,l)}isAttached(s){let u=s&&ty(s);return!!(u&&u.isConnected)}};function K4(d){return!ey()||typeof OffscreenCanvas<"u"&&d instanceof OffscreenCanvas?$w:Yw}var Cs=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(s){let{x:u,y:r}=this.getProps(["x","y"],s);return{x:u,y:r}}hasValue(){return Qh(this.x)&&Qh(this.y)}getProps(s,u){let r=this.$animations;if(!u||!r)return this;let l={};return s.forEach(i=>{l[i]=r[i]&&r[i].active()?r[i]._to:this[i]}),l}};function J4(d,s){let u=d.options.ticks,r=eB(d),l=Math.min(u.maxTicksLimit||r,r),i=u.major.enabled?iB(s):[],_=i.length,C=i[0],I=i[_-1],O=[];if(_>l)return nB(s,O,i,_/l),O;let N=tB(i,s,l);if(_>0){let q,ie,de=_>1?Math.round((I-C)/(_-1)):null;for(ry(s,O,N,vn(de)?0:C-de,C),q=0,ie=_-1;q<ie;q++)ry(s,O,N,i[q],i[q+1]);return ry(s,O,N,I,vn(de)?s.length:I+de),O}return ry(s,O,N),O}function eB(d){let s=d.options.offset,u=d._tickSize(),r=d._length/u+(s?0:1),l=d._maxLength/u;return Math.floor(Math.min(r,l))}function tB(d,s,u){let r=rB(d),l=s.length/u;if(!r)return Math.max(l,1);let i=KT(r);for(let _=0,C=i.length-1;_<C;_++){let I=i[_];if(I>l)return I}return Math.max(l,1)}function iB(d){let s=[],u,r;for(u=0,r=d.length;u<r;u++)d[u].major&&s.push(u);return s}function nB(d,s,u,r){let l=0,i=u[0],_;for(r=Math.ceil(r),_=0;_<d.length;_++)_===i&&(s.push(d[_]),l++,i=u[l*r])}function ry(d,s,u,r,l){let i=Yi(r,0),_=Math.min(Yi(l,d.length),d.length),C=0,I,O,N;for(u=Math.ceil(u),l&&(I=l-r,u=I/Math.floor(I/u)),N=i;N<0;)C++,N=Math.round(i+C*u);for(O=Math.max(i,0);O<_;O++)O===N&&(s.push(d[O]),C++,N=Math.round(i+C*u))}function rB(d){let s=d.length,u,r;if(s<2)return!1;for(r=d[0],u=1;u<s;++u)if(d[u]-d[u-1]!==r)return!1;return r}var oB=d=>d==="left"?"right":d==="right"?"left":d,NE=(d,s,u)=>s==="top"||s==="left"?d[s]+u:d[s]-u,VE=(d,s)=>Math.min(s||d,d);function jE(d,s){let u=[],r=d.length/s,l=d.length,i=0;for(;i<l;i+=r)u.push(d[Math.floor(i)]);return u}function aB(d,s,u){let r=d.ticks.length,l=Math.min(s,r-1),i=d._startPixel,_=d._endPixel,C=1e-6,I=d.getPixelForTick(l),O;if(!(u&&(r===1?O=Math.max(I-i,_-I):s===0?O=(d.getPixelForTick(1)-I)/2:O=(I-d.getPixelForTick(l-1))/2,I+=l<s?O:-O,I<i-C||I>_+C)))return I}function sB(d,s){Ln(d,u=>{let r=u.gc,l=r.length/2,i;if(l>s){for(i=0;i<l;++i)delete u.data[r[i]];r.splice(0,l)}})}function Ag(d){return d.drawTicks?d.tickLength:0}function UE(d,s){if(!d.display)return 0;let u=Br(d.font,s),r=po(d.padding);return(er(d.text)?d.text.length:1)*u.lineHeight+r.height}function lB(d,s){return Zl(d,{scale:s,type:"scale"})}function cB(d,s,u){return Zl(d,{tick:u,index:s,type:"tick"})}function dB(d,s,u){let r=Zb(d);return(u&&s!=="right"||!u&&s==="right")&&(r=oB(r)),r}function hB(d,s,u,r){let{top:l,left:i,bottom:_,right:C,chart:I}=d,{chartArea:O,scales:N}=I,q=0,ie,de,xe,ke=_-l,Ae=C-i;if(d.isHorizontal()){if(de=mo(r,i,C),ln(u)){let Xe=Object.keys(u)[0],qe=u[Xe];xe=N[Xe].getPixelForValue(qe)+ke-s}else u==="center"?xe=(O.bottom+O.top)/2+ke-s:xe=NE(d,u,s);ie=C-i}else{if(ln(u)){let Xe=Object.keys(u)[0],qe=u[Xe];de=N[Xe].getPixelForValue(qe)-Ae+s}else u==="center"?de=(O.left+O.right)/2-Ae+s:de=NE(d,u,s);xe=mo(r,_,l),q=u==="left"?-xr:xr}return{titleX:de,titleY:xe,maxWidth:ie,rotation:q}}var tu=class d extends Cs{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,u){return s}getUserBounds(){let{_userMin:s,_userMax:u,_suggestedMin:r,_suggestedMax:l}=this;return s=ea(s,Number.POSITIVE_INFINITY),u=ea(u,Number.NEGATIVE_INFINITY),r=ea(r,Number.POSITIVE_INFINITY),l=ea(l,Number.NEGATIVE_INFINITY),{min:ea(s,r),max:ea(u,l),minDefined:pr(s),maxDefined:pr(u)}}getMinMax(s){let{min:u,max:r,minDefined:l,maxDefined:i}=this.getUserBounds(),_;if(l&&i)return{min:u,max:r};let C=this.getMatchingVisibleMetas();for(let I=0,O=C.length;I<O;++I)_=C[I].controller.getMinMax(this,s),l||(u=Math.min(u,_.min)),i||(r=Math.max(r,_.max));return u=i&&u>r?r:u,r=l&&u>r?u:r,{min:ea(u,ea(r,u)),max:ea(r,ea(u,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}getLabelItems(s=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(s))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Gn(this.options.beforeUpdate,[this])}update(s,u,r){let{beginAtZero:l,grace:i,ticks:_}=this.options,C=_.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=u,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=hE(this,i,l),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let I=C<this.ticks.length;this._convertTicksToLabels(I?jE(this.ticks,C):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),_.display&&(_.autoSkip||_.source==="auto")&&(this.ticks=J4(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),I&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let s=this.options.reverse,u,r;this.isHorizontal()?(u=this.left,r=this.right):(u=this.top,r=this.bottom,s=!s),this._startPixel=u,this._endPixel=r,this._reversePixels=s,this._length=r-u,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Gn(this.options.afterUpdate,[this])}beforeSetDimensions(){Gn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Gn(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),Gn(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Gn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){let u=this.options.ticks,r,l,i;for(r=0,l=s.length;r<l;r++)i=s[r],i.label=Gn(u.callback,[i.value,r,s],this)}afterTickToLabelConversion(){Gn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Gn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let s=this.options,u=s.ticks,r=VE(this.ticks.length,s.ticks.maxTicksLimit),l=u.minRotation||0,i=u.maxRotation,_=l,C,I,O;if(!this._isVisible()||!u.display||l>=i||r<=1||!this.isHorizontal()){this.labelRotation=l;return}let N=this._getLabelSizes(),q=N.widest.width,ie=N.highest.height,de=Zr(this.chart.width-q,0,this.maxWidth);C=s.offset?this.maxWidth/r:de/(r-1),q+6>C&&(C=de/(r-(s.offset?.5:1)),I=this.maxHeight-Ag(s.grid)-u.padding-UE(s.title,this.chart.options.font),O=Math.sqrt(q*q+ie*ie),_=$b(Math.min(Math.asin(Zr((N.highest.height+6)/C,-1,1)),Math.asin(Zr(I/O,-1,1))-Math.asin(Zr(ie/O,-1,1)))),_=Math.max(l,Math.min(i,_))),this.labelRotation=_}afterCalculateLabelRotation(){Gn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Gn(this.options.beforeFit,[this])}fit(){let s={width:0,height:0},{chart:u,options:{ticks:r,title:l,grid:i}}=this,_=this._isVisible(),C=this.isHorizontal();if(_){let I=UE(l,u.options.font);if(C?(s.width=this.maxWidth,s.height=Ag(i)+I):(s.height=this.maxHeight,s.width=Ag(i)+I),r.display&&this.ticks.length){let{first:O,last:N,widest:q,highest:ie}=this._getLabelSizes(),de=r.padding*2,xe=qa(this.labelRotation),ke=Math.cos(xe),Ae=Math.sin(xe);if(C){let Xe=r.mirror?0:Ae*q.width+ke*ie.height;s.height=Math.min(this.maxHeight,s.height+Xe+de)}else{let Xe=r.mirror?0:ke*q.width+Ae*ie.height;s.width=Math.min(this.maxWidth,s.width+Xe+de)}this._calculatePadding(O,N,Ae,ke)}}this._handleMargins(),C?(this.width=this._length=u.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=u.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,u,r,l){let{ticks:{align:i,padding:_},position:C}=this.options,I=this.labelRotation!==0,O=C!=="top"&&this.axis==="x";if(this.isHorizontal()){let N=this.getPixelForTick(0)-this.left,q=this.right-this.getPixelForTick(this.ticks.length-1),ie=0,de=0;I?O?(ie=l*s.width,de=r*u.height):(ie=r*s.height,de=l*u.width):i==="start"?de=u.width:i==="end"?ie=s.width:i!=="inner"&&(ie=s.width/2,de=u.width/2),this.paddingLeft=Math.max((ie-N+_)*this.width/(this.width-N),0),this.paddingRight=Math.max((de-q+_)*this.width/(this.width-q),0)}else{let N=u.height/2,q=s.height/2;i==="start"?(N=0,q=s.height):i==="end"&&(N=u.height,q=0),this.paddingTop=N+_,this.paddingBottom=q+_}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Gn(this.options.afterFit,[this])}isHorizontal(){let{axis:s,position:u}=this.options;return u==="top"||u==="bottom"||s==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){this.beforeTickToLabelConversion(),this.generateTickLabels(s);let u,r;for(u=0,r=s.length;u<r;u++)vn(s[u].label)&&(s.splice(u,1),r--,u--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){let u=this.options.ticks.sampleSize,r=this.ticks;u<r.length&&(r=jE(r,u)),this._labelSizes=s=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return s}_computeLabelSizes(s,u,r){let{ctx:l,_longestTextCache:i}=this,_=[],C=[],I=Math.floor(u/VE(u,r)),O=0,N=0,q,ie,de,xe,ke,Ae,Xe,qe,ut,It,wt;for(q=0;q<u;q+=I){if(xe=s[q].label,ke=this._resolveTickFontOptions(q),l.font=Ae=ke.string,Xe=i[Ae]=i[Ae]||{data:{},gc:[]},qe=ke.lineHeight,ut=It=0,!vn(xe)&&!er(xe))ut=Cg(l,Xe.data,Xe.gc,ut,xe),It=qe;else if(er(xe))for(ie=0,de=xe.length;ie<de;++ie)wt=xe[ie],!vn(wt)&&!er(wt)&&(ut=Cg(l,Xe.data,Xe.gc,ut,wt),It+=qe);_.push(ut),C.push(It),O=Math.max(ut,O),N=Math.max(It,N)}sB(i,u);let Et=_.indexOf(O),Ht=C.indexOf(N),Ct=Yt=>({width:_[Yt]||0,height:C[Yt]||0});return{first:Ct(0),last:Ct(u-1),widest:Ct(Et),highest:Ct(Ht),widths:_,heights:C}}getLabelForValue(s){return s}getPixelForValue(s,u){return NaN}getValueForPixel(s){}getPixelForTick(s){let u=this.ticks;return s<0||s>u.length-1?null:this.getPixelForValue(u[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);let u=this._startPixel+s*this._length;return eE(this._alignToPixels?wd(this.chart,u,0):u)}getDecimalForPixel(s){let u=(s-this._startPixel)/this._length;return this._reversePixels?1-u:u}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:s,max:u}=this;return s<0&&u<0?u:s>0&&u>0?s:0}getContext(s){let u=this.ticks||[];if(s>=0&&s<u.length){let r=u[s];return r.$context||(r.$context=cB(this.getContext(),s,r))}return this.$context||(this.$context=lB(this.chart.getContext(),this))}_tickSize(){let s=this.options.ticks,u=qa(this.labelRotation),r=Math.abs(Math.cos(u)),l=Math.abs(Math.sin(u)),i=this._getLabelSizes(),_=s.autoSkipPadding||0,C=i?i.widest.width+_:0,I=i?i.highest.height+_:0;return this.isHorizontal()?I*r>C*l?C/r:I/l:I*l<C*r?I/r:C/l}_isVisible(){let s=this.options.display;return s!=="auto"?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){let u=this.axis,r=this.chart,l=this.options,{grid:i,position:_,border:C}=l,I=i.offset,O=this.isHorizontal(),q=this.ticks.length+(I?1:0),ie=Ag(i),de=[],xe=C.setContext(this.getContext()),ke=xe.display?xe.width:0,Ae=ke/2,Xe=function(tn){return wd(r,tn,ke)},qe,ut,It,wt,Et,Ht,Ct,Yt,zt,ki,Hi,or;if(_==="top")qe=Xe(this.bottom),Ht=this.bottom-ie,Yt=qe-Ae,ki=Xe(s.top)+Ae,or=s.bottom;else if(_==="bottom")qe=Xe(this.top),ki=s.top,or=Xe(s.bottom)-Ae,Ht=qe+Ae,Yt=this.top+ie;else if(_==="left")qe=Xe(this.right),Et=this.right-ie,Ct=qe-Ae,zt=Xe(s.left)+Ae,Hi=s.right;else if(_==="right")qe=Xe(this.left),zt=s.left,Hi=Xe(s.right)-Ae,Et=qe+Ae,Ct=this.left+ie;else if(u==="x"){if(_==="center")qe=Xe((s.top+s.bottom)/2+.5);else if(ln(_)){let tn=Object.keys(_)[0],Bn=_[tn];qe=Xe(this.chart.scales[tn].getPixelForValue(Bn))}ki=s.top,or=s.bottom,Ht=qe+Ae,Yt=Ht+ie}else if(u==="y"){if(_==="center")qe=Xe((s.left+s.right)/2);else if(ln(_)){let tn=Object.keys(_)[0],Bn=_[tn];qe=Xe(this.chart.scales[tn].getPixelForValue(Bn))}Et=qe-Ae,Ct=Et-ie,zt=s.left,Hi=s.right}let wi=Yi(l.ticks.maxTicksLimit,q),cn=Math.max(1,Math.ceil(q/wi));for(ut=0;ut<q;ut+=cn){let tn=this.getContext(ut),Bn=i.setContext(tn),Nr=C.setContext(tn),qn=Bn.lineWidth,Ii=Bn.color,na=Nr.dash||[],$n=Nr.dashOffset,ba=Bn.tickWidth,Fo=Bn.tickColor,ya=Bn.tickBorderDash||[],Gt=Bn.tickBorderDashOffset;It=aB(this,ut,I),It!==void 0&&(wt=wd(r,It,qn),O?Et=Ct=zt=Hi=wt:Ht=Yt=ki=or=wt,de.push({tx1:Et,ty1:Ht,tx2:Ct,ty2:Yt,x1:zt,y1:ki,x2:Hi,y2:or,width:qn,color:Ii,borderDash:na,borderDashOffset:$n,tickWidth:ba,tickColor:Fo,tickBorderDash:ya,tickBorderDashOffset:Gt}))}return this._ticksLength=q,this._borderValue=qe,de}_computeLabelItems(s){let u=this.axis,r=this.options,{position:l,ticks:i}=r,_=this.isHorizontal(),C=this.ticks,{align:I,crossAlign:O,padding:N,mirror:q}=i,ie=Ag(r.grid),de=ie+N,xe=q?-N:de,ke=-qa(this.labelRotation),Ae=[],Xe,qe,ut,It,wt,Et,Ht,Ct,Yt,zt,ki,Hi,or="middle";if(l==="top")Et=this.bottom-xe,Ht=this._getXAxisLabelAlignment();else if(l==="bottom")Et=this.top+xe,Ht=this._getXAxisLabelAlignment();else if(l==="left"){let cn=this._getYAxisLabelAlignment(ie);Ht=cn.textAlign,wt=cn.x}else if(l==="right"){let cn=this._getYAxisLabelAlignment(ie);Ht=cn.textAlign,wt=cn.x}else if(u==="x"){if(l==="center")Et=(s.top+s.bottom)/2+de;else if(ln(l)){let cn=Object.keys(l)[0],tn=l[cn];Et=this.chart.scales[cn].getPixelForValue(tn)+de}Ht=this._getXAxisLabelAlignment()}else if(u==="y"){if(l==="center")wt=(s.left+s.right)/2-de;else if(ln(l)){let cn=Object.keys(l)[0],tn=l[cn];wt=this.chart.scales[cn].getPixelForValue(tn)}Ht=this._getYAxisLabelAlignment(ie).textAlign}u==="y"&&(I==="start"?or="top":I==="end"&&(or="bottom"));let wi=this._getLabelSizes();for(Xe=0,qe=C.length;Xe<qe;++Xe){ut=C[Xe],It=ut.label;let cn=i.setContext(this.getContext(Xe));Ct=this.getPixelForTick(Xe)+i.labelOffset,Yt=this._resolveTickFontOptions(Xe),zt=Yt.lineHeight,ki=er(It)?It.length:1;let tn=ki/2,Bn=cn.color,Nr=cn.textStrokeColor,qn=cn.textStrokeWidth,Ii=Ht;_?(wt=Ct,Ht==="inner"&&(Xe===qe-1?Ii=this.options.reverse?"left":"right":Xe===0?Ii=this.options.reverse?"right":"left":Ii="center"),l==="top"?O==="near"||ke!==0?Hi=-ki*zt+zt/2:O==="center"?Hi=-wi.highest.height/2-tn*zt+zt:Hi=-wi.highest.height+zt/2:O==="near"||ke!==0?Hi=zt/2:O==="center"?Hi=wi.highest.height/2-tn*zt:Hi=wi.highest.height-ki*zt,q&&(Hi*=-1),ke!==0&&!cn.showLabelBackdrop&&(wt+=zt/2*Math.sin(ke))):(Et=Ct,Hi=(1-ki)*zt/2);let na;if(cn.showLabelBackdrop){let $n=po(cn.backdropPadding),ba=wi.heights[Xe],Fo=wi.widths[Xe],ya=Hi-$n.top,Gt=0-$n.left;switch(or){case"middle":ya-=ba/2;break;case"bottom":ya-=ba;break}switch(Ht){case"center":Gt-=Fo/2;break;case"right":Gt-=Fo;break;case"inner":Xe===qe-1?Gt-=Fo:Xe>0&&(Gt-=Fo/2);break}na={left:Gt,top:ya,width:Fo+$n.width,height:ba+$n.height,color:cn.backdropColor}}Ae.push({label:It,font:Yt,textOffset:Hi,options:{rotation:ke,color:Bn,strokeColor:Nr,strokeWidth:qn,textAlign:Ii,textBaseline:or,translation:[wt,Et],backdrop:na}})}return Ae}_getXAxisLabelAlignment(){let{position:s,ticks:u}=this.options;if(-qa(this.labelRotation))return s==="top"?"left":"right";let l="center";return u.align==="start"?l="left":u.align==="end"?l="right":u.align==="inner"&&(l="inner"),l}_getYAxisLabelAlignment(s){let{position:u,ticks:{crossAlign:r,mirror:l,padding:i}}=this.options,_=this._getLabelSizes(),C=s+i,I=_.widest.width,O,N;return u==="left"?l?(N=this.right+i,r==="near"?O="left":r==="center"?(O="center",N+=I/2):(O="right",N+=I)):(N=this.right-C,r==="near"?O="right":r==="center"?(O="center",N-=I/2):(O="left",N=this.left)):u==="right"?l?(N=this.left+i,r==="near"?O="right":r==="center"?(O="center",N-=I/2):(O="left",N-=I)):(N=this.left+C,r==="near"?O="left":r==="center"?(O="center",N+=I/2):(O="right",N=this.right)):O="right",{textAlign:O,x:N}}_computeLabelArea(){if(this.options.ticks.mirror)return;let s=this.chart,u=this.options.position;if(u==="left"||u==="right")return{top:0,left:this.left,bottom:s.height,right:this.right};if(u==="top"||u==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:s.width}}drawBackground(){let{ctx:s,options:{backgroundColor:u},left:r,top:l,width:i,height:_}=this;u&&(s.save(),s.fillStyle=u,s.fillRect(r,l,i,_),s.restore())}getLineWidthForValue(s){let u=this.options.grid;if(!this._isVisible()||!u.display)return 0;let l=this.ticks.findIndex(i=>i.value===s);return l>=0?u.setContext(this.getContext(l)).lineWidth:0}drawGrid(s){let u=this.options.grid,r=this.ctx,l=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s)),i,_,C=(I,O,N)=>{!N.width||!N.color||(r.save(),r.lineWidth=N.width,r.strokeStyle=N.color,r.setLineDash(N.borderDash||[]),r.lineDashOffset=N.borderDashOffset,r.beginPath(),r.moveTo(I.x,I.y),r.lineTo(O.x,O.y),r.stroke(),r.restore())};if(u.display)for(i=0,_=l.length;i<_;++i){let I=l[i];u.drawOnChartArea&&C({x:I.x1,y:I.y1},{x:I.x2,y:I.y2},I),u.drawTicks&&C({x:I.tx1,y:I.ty1},{x:I.tx2,y:I.ty2},{color:I.tickColor,width:I.tickWidth,borderDash:I.tickBorderDash,borderDashOffset:I.tickBorderDashOffset})}}drawBorder(){let{chart:s,ctx:u,options:{border:r,grid:l}}=this,i=r.setContext(this.getContext()),_=r.display?i.width:0;if(!_)return;let C=l.setContext(this.getContext(0)).lineWidth,I=this._borderValue,O,N,q,ie;this.isHorizontal()?(O=wd(s,this.left,_)-_/2,N=wd(s,this.right,C)+C/2,q=ie=I):(q=wd(s,this.top,_)-_/2,ie=wd(s,this.bottom,C)+C/2,O=N=I),u.save(),u.lineWidth=i.width,u.strokeStyle=i.color,u.beginPath(),u.moveTo(O,q),u.lineTo(N,ie),u.stroke(),u.restore()}drawLabels(s){if(!this.options.ticks.display)return;let r=this.ctx,l=this._computeLabelArea();l&&kg(r,l);let i=this.getLabelItems(s);for(let _ of i){let C=_.options,I=_.font,O=_.label,N=_.textOffset;Cd(r,O,0,N,I,C)}l&&Ig(r)}drawTitle(){let{ctx:s,options:{position:u,title:r,reverse:l}}=this;if(!r.display)return;let i=Br(r.font),_=po(r.padding),C=r.align,I=i.lineHeight/2;u==="bottom"||u==="center"||ln(u)?(I+=_.bottom,er(r.text)&&(I+=i.lineHeight*(r.text.length-1))):I+=_.top;let{titleX:O,titleY:N,maxWidth:q,rotation:ie}=hB(this,I,u,C);Cd(s,r.text,0,0,i,{color:r.color,maxWidth:q,rotation:ie,textAlign:dB(C,u,l),textBaseline:"middle",translation:[O,N]})}draw(s){this._isVisible()&&(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){let s=this.options,u=s.ticks&&s.ticks.z||0,r=Yi(s.grid&&s.grid.z,-1),l=Yi(s.border&&s.border.z,0);return!this._isVisible()||this.draw!==d.prototype.draw?[{z:u,draw:i=>{this.draw(i)}}]:[{z:r,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:l,draw:()=>{this.drawBorder()}},{z:u,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(s){let u=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",l=[],i,_;for(i=0,_=u.length;i<_;++i){let C=u[i];C[r]===this.id&&(!s||C.type===s)&&l.push(C)}return l}_resolveTickFontOptions(s){let u=this.options.ticks.setContext(this.getContext(s));return Br(u.font)}_maxDigits(){let s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}},tp=class{constructor(s,u,r){this.type=s,this.scope=u,this.override=r,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){let u=Object.getPrototypeOf(s),r;pB(u)&&(r=this.register(u));let l=this.items,i=s.id,_=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+s);return i in l||(l[i]=s,uB(s,_,r),this.override&&fr.override(s.id,s.overrides)),_}get(s){return this.items[s]}unregister(s){let u=this.items,r=s.id,l=this.scope;r in u&&delete u[r],l&&r in fr[l]&&(delete fr[l][r],this.override&&delete xd[r])}};function uB(d,s,u){let r=Gm(Object.create(null),[u?fr.get(u):{},fr.get(s),d.defaults]);fr.set(s,r),d.defaultRoutes&&mB(s,d.defaultRoutes),d.descriptors&&fr.describe(s,d.descriptors)}function mB(d,s){Object.keys(s).forEach(u=>{let r=u.split("."),l=r.pop(),i=[d].concat(r).join("."),_=s[u].split("."),C=_.pop(),I=_.join(".");fr.route(i,l,I,C)})}function pB(d){return"id"in d&&"defaults"in d}var Zw=class{constructor(){this.controllers=new tp(Id,"datasets",!0),this.elements=new tp(Cs,"elements"),this.plugins=new tp(Object,"plugins"),this.scales=new tp(tu,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,u,r){[...u].forEach(l=>{let i=r||this._getRegistryForType(l);r||i.isForType(l)||i===this.plugins&&l.id?this._exec(s,i,l):Ln(l,_=>{let C=r||this._getRegistryForType(_);this._exec(s,C,_)})})}_exec(s,u,r){let l=qb(s);Gn(r["before"+l],[],r),u[s](r),Gn(r["after"+l],[],r)}_getRegistryForType(s){for(let u=0;u<this._typedRegistries.length;u++){let r=this._typedRegistries[u];if(r.isForType(s))return r}return this.plugins}_get(s,u,r){let l=u.get(s);if(l===void 0)throw new Error('"'+s+'" is not a registered '+r+".");return l}},nl=new Zw,Xw=class{constructor(){this._init=[]}notify(s,u,r,l){u==="beforeInit"&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install"));let i=l?this._descriptors(s).filter(l):this._descriptors(s),_=this._notify(i,s,u,r);return u==="afterDestroy"&&(this._notify(i,s,"stop"),this._notify(this._init,s,"uninstall")),_}_notify(s,u,r,l){l=l||{};for(let i of s){let _=i.plugin,C=_[r],I=[u,l,i.options];if(Gn(C,I,_)===!1&&l.cancelable)return!1}return!0}invalidate(){vn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;let u=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),u}_createDescriptors(s,u){let r=s&&s.config,l=Yi(r.options&&r.options.plugins,{}),i=fB(r);return l===!1&&!u?[]:_B(s,i,l,u)}_notifyStateChanges(s){let u=this._oldCache||[],r=this._cache,l=(i,_)=>i.filter(C=>!_.some(I=>C.plugin.id===I.plugin.id));this._notify(l(u,r),s,"stop"),this._notify(l(r,u),s,"start")}};function fB(d){let s={},u=[],r=Object.keys(nl.plugins.items);for(let i=0;i<r.length;i++)u.push(nl.getPlugin(r[i]));let l=d.plugins||[];for(let i=0;i<l.length;i++){let _=l[i];u.indexOf(_)===-1&&(u.push(_),s[_.id]=!0)}return{plugins:u,localIds:s}}function gB(d,s){return!s&&d===!1?null:d===!0?{}:d}function _B(d,{plugins:s,localIds:u},r,l){let i=[],_=d.getContext();for(let C of s){let I=C.id,O=gB(r[I],l);O!==null&&i.push({plugin:C,options:bB(d.config,{plugin:C,local:u[I]},O,_)})}return i}function bB(d,{plugin:s,local:u},r,l){let i=d.pluginScopeKeys(s),_=d.getOptionScopes(r,i);return u&&s.defaults&&_.push(s.defaults),d.createResolver(_,l,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Qw(d,s){let u=fr.datasets[d]||{};return((s.datasets||{})[d]||{}).indexAxis||s.indexAxis||u.indexAxis||"x"}function yB(d,s){let u=d;return d==="_index_"?u=s:d==="_value_"&&(u=s==="x"?"y":"x"),u}function vB(d,s){return d===s?"_index_":"_value_"}function HE(d){if(d==="x"||d==="y"||d==="r")return d}function xB(d){if(d==="top"||d==="bottom")return"x";if(d==="left"||d==="right")return"y"}function Kw(d,...s){if(HE(d))return d;for(let u of s){let r=u.axis||xB(u.position)||d.length>1&&HE(d[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${d}' axis. Please provide 'axis' or 'position' option.`)}function WE(d,s,u){if(u[s+"AxisID"]===d)return{axis:s}}function wB(d,s){if(s.data&&s.data.datasets){let u=s.data.datasets.filter(r=>r.xAxisID===d||r.yAxisID===d);if(u.length)return WE(d,"x",u[0])||WE(d,"y",u[0])}return{}}function CB(d,s){let u=xd[d.type]||{scales:{}},r=s.scales||{},l=Qw(d.type,s),i=Object.create(null);return Object.keys(r).forEach(_=>{let C=r[_];if(!ln(C))return console.error(`Invalid scale configuration for scale: ${_}`);if(C._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${_}`);let I=Kw(_,C,wB(_,d),fr.scales[C.type]),O=vB(I,l),N=u.scales||{};i[_]=$m(Object.create(null),[{axis:I},C,N[I],N[O]])}),d.data.datasets.forEach(_=>{let C=_.type||d.type,I=_.indexAxis||Qw(C,s),N=(xd[C]||{}).scales||{};Object.keys(N).forEach(q=>{let ie=yB(q,I),de=_[ie+"AxisID"]||ie;i[de]=i[de]||Object.create(null),$m(i[de],[{axis:ie},r[de],N[q]])})}),Object.keys(i).forEach(_=>{let C=i[_];$m(C,[fr.scales[C.type],fr.scale])}),i}function AD(d){let s=d.options||(d.options={});s.plugins=Yi(s.plugins,{}),s.scales=CB(d,s)}function PD(d){return d=d||{},d.datasets=d.datasets||[],d.labels=d.labels||[],d}function SB(d){return d=d||{},d.data=PD(d.data),AD(d),d}var GE=new Map,OD=new Set;function oy(d,s){let u=GE.get(d);return u||(u=s(),GE.set(d,u),OD.add(u)),u}var Pg=(d,s,u)=>{let r=Yl(s,u);r!==void 0&&d.add(r)},Jw=class{constructor(s){this._config=SB(s),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=PD(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){let s=this._config;this.clearCache(),AD(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return oy(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,u){return oy(`${s}.transition.${u}`,()=>[[`datasets.${s}.transitions.${u}`,`transitions.${u}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,u){return oy(`${s}-${u}`,()=>[[`datasets.${s}.elements.${u}`,`datasets.${s}`,`elements.${u}`,""]])}pluginScopeKeys(s){let u=s.id,r=this.type;return oy(`${r}-plugin-${u}`,()=>[[`plugins.${u}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,u){let r=this._scopeCache,l=r.get(s);return(!l||u)&&(l=new Map,r.set(s,l)),l}getOptionScopes(s,u,r){let{options:l,type:i}=this,_=this._cachedScopes(s,r),C=_.get(u);if(C)return C;let I=new Set;u.forEach(N=>{s&&(I.add(s),N.forEach(q=>Pg(I,s,q))),N.forEach(q=>Pg(I,l,q)),N.forEach(q=>Pg(I,xd[i]||{},q)),N.forEach(q=>Pg(I,fr,q)),N.forEach(q=>Pg(I,Xb,q))});let O=Array.from(I);return O.length===0&&O.push(Object.create(null)),OD.has(u)&&_.set(u,O),O}chartOptionScopes(){let{options:s,type:u}=this;return[s,xd[u]||{},fr.datasets[u]||{},{type:u},fr,Xb]}resolveNamedOptions(s,u,r,l=[""]){let i={$shared:!0},{resolver:_,subPrefixes:C}=qE(this._resolverCache,s,l),I=_;if(kB(_,u)){i.$shared=!1,r=ql(r)?r():r;let O=this.createResolver(s,r,C);I=Xh(_,r,O)}for(let O of u)i[O]=I[O];return i}createResolver(s,u,r=[""],l){let{resolver:i}=qE(this._resolverCache,s,r);return ln(u)?Xh(i,u,void 0,l):i}};function qE(d,s,u){let r=d.get(s);r||(r=new Map,d.set(s,r));let l=u.join(),i=r.get(l);return i||(i={resolver:Jb(s,u),subPrefixes:u.filter(C=>!C.toLowerCase().includes("hover"))},r.set(l,i)),i}var MB=d=>ln(d)&&Object.getOwnPropertyNames(d).some(s=>ql(d[s]));function kB(d,s){let{isScriptable:u,isIndexable:r}=Mw(d);for(let l of s){let i=u(l),_=r(l),C=(_||i)&&d[l];if(i&&(ql(C)||MB(C))||_&&er(C))return!0}return!1}var IB="4.4.3",TB=["top","bottom","left","right","chartArea"];function $E(d,s){return d==="top"||d==="bottom"||TB.indexOf(d)===-1&&s==="x"}function YE(d,s){return function(u,r){return u[d]===r[d]?u[s]-r[s]:u[d]-r[d]}}function ZE(d){let s=d.chart,u=s.options.animation;s.notifyPlugins("afterRender"),Gn(u&&u.onComplete,[d],s)}function EB(d){let s=d.chart,u=s.options.animation;Gn(u&&u.onProgress,[d],s)}function RD(d){return ey()&&typeof d=="string"?d=document.getElementById(d):d&&d.length&&(d=d[0]),d&&d.canvas&&(d=d.canvas),d}var hy={},XE=d=>{let s=RD(d);return Object.values(hy).filter(u=>u.canvas===s).pop()};function DB(d,s,u){let r=Object.keys(d);for(let l of r){let i=+l;if(i>=s){let _=d[l];delete d[l],(u>0||i>s)&&(d[i+u]=_)}}}function AB(d,s,u,r){return!u||d.type==="mouseout"?null:r?s:d}function ay(d,s,u){return d.options.clip?d[u]:s[u]}function PB(d,s){let{xScale:u,yScale:r}=d;return u&&r?{left:ay(u,s,"left"),right:ay(u,s,"right"),top:ay(r,s,"top"),bottom:ay(r,s,"bottom")}:s}var np=(()=>{class d{static defaults=fr;static instances=hy;static overrides=xd;static registry=nl;static version=IB;static getChart=XE;static register(...u){nl.add(...u),QE()}static unregister(...u){nl.remove(...u),QE()}constructor(u,r){let l=this.config=new Jw(r),i=RD(u),_=XE(i);if(_)throw new Error("Canvas is already in use. Chart with ID '"+_.id+"' must be destroyed before the canvas with ID '"+_.canvas.id+"' can be reused.");let C=l.createResolver(l.chartOptionScopes(),this.getContext());this.platform=new(l.platform||K4(i)),this.platform.updateConfig(l);let I=this.platform.acquireContext(i,C.aspectRatio),O=I&&I.canvas,N=O&&O.height,q=O&&O.width;if(this.id=YT(),this.ctx=I,this.canvas=O,this.width=q,this.height=N,this._options=C,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Xw,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=oE(ie=>this.update(ie),C.resizeDelay||0),this._dataChanges=[],hy[this.id]=this,!I||!O){console.error("Failed to create chart: can't acquire context from the given item");return}Xl.listen(this,"complete",ZE),Xl.listen(this,"progress",EB),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:u,maintainAspectRatio:r},width:l,height:i,_aspectRatio:_}=this;return vn(u)?r&&_?_:i?l/i:null:u}get data(){return this.config.data}set data(u){this.config.data=u}get options(){return this._options}set options(u){this.config.options=u}get registry(){return nl}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Ew(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return ww(this.canvas,this.ctx),this}stop(){return Xl.stop(this),this}resize(u,r){Xl.running(this)?this._resizeBeforeDraw={width:u,height:r}:this._resize(u,r)}_resize(u,r){let l=this.options,i=this.canvas,_=l.maintainAspectRatio&&this.aspectRatio,C=this.platform.getMaximumSize(i,u,r,_),I=l.devicePixelRatio||this.platform.getDevicePixelRatio(),O=this.width?"resize":"attach";this.width=C.width,this.height=C.height,this._aspectRatio=this.aspectRatio,Ew(this,I,!0)&&(this.notifyPlugins("resize",{size:C}),Gn(l.onResize,[this,C],this),this.attached&&this._doResize(O)&&this.render())}ensureScalesHaveIDs(){let r=this.options.scales||{};Ln(r,(l,i)=>{l.id=i})}buildOrUpdateScales(){let u=this.options,r=u.scales,l=this.scales,i=Object.keys(l).reduce((C,I)=>(C[I]=!1,C),{}),_=[];r&&(_=_.concat(Object.keys(r).map(C=>{let I=r[C],O=Kw(C,I),N=O==="r",q=O==="x";return{options:I,dposition:N?"chartArea":q?"bottom":"left",dtype:N?"radialLinear":q?"category":"linear"}}))),Ln(_,C=>{let I=C.options,O=I.id,N=Kw(O,I),q=Yi(I.type,C.dtype);(I.position===void 0||$E(I.position,N)!==$E(C.dposition))&&(I.position=C.dposition),i[O]=!0;let ie=null;if(O in l&&l[O].type===q)ie=l[O];else{let de=nl.getScale(q);ie=new de({id:O,type:q,ctx:this.ctx,chart:this}),l[ie.id]=ie}ie.init(I,u)}),Ln(i,(C,I)=>{C||delete l[I]}),Ln(l,C=>{To.configure(this,C,C.options),To.addBox(this,C)})}_updateMetasets(){let u=this._metasets,r=this.data.datasets.length,l=u.length;if(u.sort((i,_)=>i.index-_.index),l>r){for(let i=r;i<l;++i)this._destroyDatasetMeta(i);u.splice(r,l-r)}this._sortedMetasets=u.slice(0).sort(YE("order","index"))}_removeUnreferencedMetasets(){let{_metasets:u,data:{datasets:r}}=this;u.length>r.length&&delete this._stacks,u.forEach((l,i)=>{r.filter(_=>_===l._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){let u=[],r=this.data.datasets,l,i;for(this._removeUnreferencedMetasets(),l=0,i=r.length;l<i;l++){let _=r[l],C=this.getDatasetMeta(l),I=_.type||this.config.type;if(C.type&&C.type!==I&&(this._destroyDatasetMeta(l),C=this.getDatasetMeta(l)),C.type=I,C.indexAxis=_.indexAxis||Qw(I,this.options),C.order=_.order||0,C.index=l,C.label=""+_.label,C.visible=this.isDatasetVisible(l),C.controller)C.controller.updateIndex(l),C.controller.linkScales();else{let O=nl.getController(I),{datasetElementType:N,dataElementType:q}=fr.datasets[I];Object.assign(O,{dataElementType:nl.getElement(q),datasetElementType:N&&nl.getElement(N)}),C.controller=new O(this,l),u.push(C.controller)}}return this._updateMetasets(),u}_resetElements(){Ln(this.data.datasets,(u,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(u){let r=this.config;r.update();let l=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!l.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:u,cancelable:!0})===!1)return;let _=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let C=0;for(let N=0,q=this.data.datasets.length;N<q;N++){let{controller:ie}=this.getDatasetMeta(N),de=!i&&_.indexOf(ie)===-1;ie.buildOrUpdateElements(de),C=Math.max(+ie.getMaxOverflow(),C)}C=this._minPadding=l.layout.autoPadding?C:0,this._updateLayout(C),i||Ln(_,N=>{N.reset()}),this._updateDatasets(u),this.notifyPlugins("afterUpdate",{mode:u}),this._layers.sort(YE("z","_idx"));let{_active:I,_lastEvent:O}=this;O?this._eventHandler(O,!0):I.length&&this._updateHoverStyles(I,I,!0),this.render()}_updateScales(){Ln(this.scales,u=>{To.removeBox(this,u)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let u=this.options,r=new Set(Object.keys(this._listeners)),l=new Set(u.events);(!cw(r,l)||!!this._responsiveListeners!==u.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:u}=this,r=this._getUniformDataChanges()||[];for(let{method:l,start:i,count:_}of r){let C=l==="_removeElements"?-_:_;DB(u,i,C)}}_getUniformDataChanges(){let u=this._dataChanges;if(!u||!u.length)return;this._dataChanges=[];let r=this.data.datasets.length,l=_=>new Set(u.filter(C=>C[0]===_).map((C,I)=>I+","+C.splice(1).join(","))),i=l(0);for(let _=1;_<r;_++)if(!cw(i,l(_)))return;return Array.from(i).map(_=>_.split(",")).map(_=>({method:_[1],start:+_[2],count:+_[3]}))}_updateLayout(u){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;To.update(this,this.width,this.height,u);let r=this.chartArea,l=r.width<=0||r.height<=0;this._layers=[],Ln(this.boxes,i=>{l&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,_)=>{i._idx=_}),this.notifyPlugins("afterLayout")}_updateDatasets(u){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:u,cancelable:!0})!==!1){for(let r=0,l=this.data.datasets.length;r<l;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,l=this.data.datasets.length;r<l;++r)this._updateDataset(r,ql(u)?u({datasetIndex:r}):u);this.notifyPlugins("afterDatasetsUpdate",{mode:u})}}_updateDataset(u,r){let l=this.getDatasetMeta(u),i={meta:l,index:u,mode:r,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(l.controller._update(r),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Xl.has(this)?this.attached&&!Xl.running(this)&&Xl.start(this):(this.draw(),ZE({chart:this})))}draw(){let u;if(this._resizeBeforeDraw){let{width:l,height:i}=this._resizeBeforeDraw;this._resize(l,i),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let r=this._layers;for(u=0;u<r.length&&r[u].z<=0;++u)r[u].draw(this.chartArea);for(this._drawDatasets();u<r.length;++u)r[u].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(u){let r=this._sortedMetasets,l=[],i,_;for(i=0,_=r.length;i<_;++i){let C=r[i];(!u||C.visible)&&l.push(C)}return l}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let u=this.getSortedVisibleDatasetMetas();for(let r=u.length-1;r>=0;--r)this._drawDataset(u[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(u){let r=this.ctx,l=u._clip,i=!l.disabled,_=PB(u,this.chartArea),C={meta:u,index:u.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",C)!==!1&&(i&&kg(r,{left:l.left===!1?0:_.left-l.left,right:l.right===!1?this.width:_.right+l.right,top:l.top===!1?0:_.top-l.top,bottom:l.bottom===!1?this.height:_.bottom+l.bottom}),u.controller.draw(),i&&Ig(r),C.cancelable=!1,this.notifyPlugins("afterDatasetDraw",C))}isPointInArea(u){return Js(u,this.chartArea,this._minPadding)}getElementsAtEventForMode(u,r,l,i){let _=O4.modes[r];return typeof _=="function"?_(this,u,l,i):[]}getDatasetMeta(u){let r=this.data.datasets[u],l=this._metasets,i=l.filter(_=>_&&_._dataset===r).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:u,_dataset:r,_parsed:[],_sorted:!1},l.push(i)),i}getContext(){return this.$context||(this.$context=Zl(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(u){let r=this.data.datasets[u];if(!r)return!1;let l=this.getDatasetMeta(u);return typeof l.hidden=="boolean"?!l.hidden:!r.hidden}setDatasetVisibility(u,r){let l=this.getDatasetMeta(u);l.hidden=!r}toggleDataVisibility(u){this._hiddenIndices[u]=!this._hiddenIndices[u]}getDataVisibility(u){return!this._hiddenIndices[u]}_updateVisibility(u,r,l){let i=l?"show":"hide",_=this.getDatasetMeta(u),C=_.controller._resolveAnimations(void 0,i);Ym(r)?(_.data[r].hidden=!l,this.update()):(this.setDatasetVisibility(u,l),C.update(_,{visible:l}),this.update(I=>I.datasetIndex===u?i:void 0))}hide(u,r){this._updateVisibility(u,r,!1)}show(u,r){this._updateVisibility(u,r,!0)}_destroyDatasetMeta(u){let r=this._metasets[u];r&&r.controller&&r.controller._destroy(),delete this._metasets[u]}_stop(){let u,r;for(this.stop(),Xl.remove(this),u=0,r=this.data.datasets.length;u<r;++u)this._destroyDatasetMeta(u)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:u,ctx:r}=this;this._stop(),this.config.clearCache(),u&&(this.unbindEvents(),ww(u,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),delete hy[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...u){return this.canvas.toDataURL(...u)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let u=this._listeners,r=this.platform,l=(_,C)=>{r.addEventListener(this,_,C),u[_]=C},i=(_,C,I)=>{_.offsetX=C,_.offsetY=I,this._eventHandler(_)};Ln(this.options.events,_=>l(_,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let u=this._responsiveListeners,r=this.platform,l=(O,N)=>{r.addEventListener(this,O,N),u[O]=N},i=(O,N)=>{u[O]&&(r.removeEventListener(this,O,N),delete u[O])},_=(O,N)=>{this.canvas&&this.resize(O,N)},C,I=()=>{i("attach",I),this.attached=!0,this.resize(),l("resize",_),l("detach",C)};C=()=>{this.attached=!1,i("resize",_),this._stop(),this._resize(0,0),l("attach",I)},r.isAttached(this.canvas)?I():C()}unbindEvents(){Ln(this._listeners,(u,r)=>{this.platform.removeEventListener(this,r,u)}),this._listeners={},Ln(this._responsiveListeners,(u,r)=>{this.platform.removeEventListener(this,r,u)}),this._responsiveListeners=void 0}updateHoverStyle(u,r,l){let i=l?"set":"remove",_,C,I,O;for(r==="dataset"&&(_=this.getDatasetMeta(u[0].datasetIndex),_.controller["_"+i+"DatasetHoverStyle"]()),I=0,O=u.length;I<O;++I){C=u[I];let N=C&&this.getDatasetMeta(C.datasetIndex).controller;N&&N[i+"HoverStyle"](C.element,C.datasetIndex,C.index)}}getActiveElements(){return this._active||[]}setActiveElements(u){let r=this._active||[],l=u.map(({datasetIndex:_,index:C})=>{let I=this.getDatasetMeta(_);if(!I)throw new Error("No dataset found at index "+_);return{datasetIndex:_,element:I.data[C],index:C}});!Sg(l,r)&&(this._active=l,this._lastEvent=null,this._updateHoverStyles(l,r))}notifyPlugins(u,r,l){return this._plugins.notify(this,u,r,l)}isPluginEnabled(u){return this._plugins._cache.filter(r=>r.plugin.id===u).length===1}_updateHoverStyles(u,r,l){let i=this.options.hover,_=(O,N)=>O.filter(q=>!N.some(ie=>q.datasetIndex===ie.datasetIndex&&q.index===ie.index)),C=_(r,u),I=l?u:_(u,r);C.length&&this.updateHoverStyle(C,i.mode,!1),I.length&&i.mode&&this.updateHoverStyle(I,i.mode,!0)}_eventHandler(u,r){let l={event:u,replay:r,cancelable:!0,inChartArea:this.isPointInArea(u)},i=C=>(C.options.events||this.options.events).includes(u.native.type);if(this.notifyPlugins("beforeEvent",l,i)===!1)return;let _=this._handleEvent(u,r,l.inChartArea);return l.cancelable=!1,this.notifyPlugins("afterEvent",l,i),(_||l.changed)&&this.render(),this}_handleEvent(u,r,l){let{_active:i=[],options:_}=this,C=r,I=this._getActiveElements(u,i,l,C),O=QT(u),N=AB(u,this._lastEvent,l,O);l&&(this._lastEvent=null,Gn(_.onHover,[u,I,this],this),O&&Gn(_.onClick,[u,I,this],this));let q=!Sg(I,i);return(q||r)&&(this._active=I,this._updateHoverStyles(I,i,r)),this._lastEvent=N,q}_getActiveElements(u,r,l,i){if(u.type==="mouseout")return[];if(!l)return r;let _=this.options.hover;return this.getElementsAtEventForMode(u,_.mode,_,i)}}return d})();function QE(){return Ln(np.instances,d=>d._plugins.invalidate())}function OB(d,s,u){let{startAngle:r,pixelMargin:l,x:i,y:_,outerRadius:C,innerRadius:I}=s,O=l/C;d.beginPath(),d.arc(i,_,C,r-O,u+O),I>l?(O=l/I,d.arc(i,_,I,u+O,r-O,!0)):d.arc(i,_,l,u+xr,r-xr),d.closePath(),d.clip()}function RB(d){return Kb(d,["outerStart","outerEnd","innerStart","innerEnd"])}function LB(d,s,u,r){let l=RB(d.options.borderRadius),i=(u-s)/2,_=Math.min(i,r*s/2),C=I=>{let O=(u-Math.min(i,I))*r/2;return Zr(I,0,Math.min(i,O))};return{outerStart:C(l.outerStart),outerEnd:C(l.outerEnd),innerStart:Zr(l.innerStart,0,_),innerEnd:Zr(l.innerEnd,0,_)}}function ep(d,s,u,r){return{x:u+d*Math.cos(s),y:r+d*Math.sin(s)}}function fy(d,s,u,r,l,i){let{x:_,y:C,startAngle:I,pixelMargin:O,innerRadius:N}=s,q=Math.max(s.outerRadius+r+u-O,0),ie=N>0?N+r+u+O:0,de=0,xe=l-I;if(r){let cn=N>0?N-r:0,tn=q>0?q-r:0,Bn=(cn+tn)/2,Nr=Bn!==0?xe*Bn/(Bn+r):xe;de=(xe-Nr)/2}let ke=Math.max(.001,xe*q-u/tr)/q,Ae=(xe-ke)/2,Xe=I+Ae+de,qe=l-Ae-de,{outerStart:ut,outerEnd:It,innerStart:wt,innerEnd:Et}=LB(s,ie,q,qe-Xe),Ht=q-ut,Ct=q-It,Yt=Xe+ut/Ht,zt=qe-It/Ct,ki=ie+wt,Hi=ie+Et,or=Xe+wt/ki,wi=qe-Et/Hi;if(d.beginPath(),i){let cn=(Yt+zt)/2;if(d.arc(_,C,q,Yt,cn),d.arc(_,C,q,cn,zt),It>0){let qn=ep(Ct,zt,_,C);d.arc(qn.x,qn.y,It,zt,qe+xr)}let tn=ep(Hi,qe,_,C);if(d.lineTo(tn.x,tn.y),Et>0){let qn=ep(Hi,wi,_,C);d.arc(qn.x,qn.y,Et,qe+xr,wi+Math.PI)}let Bn=(qe-Et/ie+(Xe+wt/ie))/2;if(d.arc(_,C,ie,qe-Et/ie,Bn,!0),d.arc(_,C,ie,Bn,Xe+wt/ie,!0),wt>0){let qn=ep(ki,or,_,C);d.arc(qn.x,qn.y,wt,or+Math.PI,Xe-xr)}let Nr=ep(Ht,Xe,_,C);if(d.lineTo(Nr.x,Nr.y),ut>0){let qn=ep(Ht,Yt,_,C);d.arc(qn.x,qn.y,ut,Xe-xr,Yt)}}else{d.moveTo(_,C);let cn=Math.cos(Yt)*q+_,tn=Math.sin(Yt)*q+C;d.lineTo(cn,tn);let Bn=Math.cos(zt)*q+_,Nr=Math.sin(zt)*q+C;d.lineTo(Bn,Nr)}d.closePath()}function FB(d,s,u,r,l){let{fullCircles:i,startAngle:_,circumference:C}=s,I=s.endAngle;if(i){fy(d,s,u,r,I,l);for(let O=0;O<i;++O)d.fill();isNaN(C)||(I=_+(C%ir||ir))}return fy(d,s,u,r,I,l),d.fill(),I}function zB(d,s,u,r,l){let{fullCircles:i,startAngle:_,circumference:C,options:I}=s,{borderWidth:O,borderJoinStyle:N,borderDash:q,borderDashOffset:ie}=I,de=I.borderAlign==="inner";if(!O)return;d.setLineDash(q||[]),d.lineDashOffset=ie,de?(d.lineWidth=O*2,d.lineJoin=N||"round"):(d.lineWidth=O,d.lineJoin=N||"bevel");let xe=s.endAngle;if(i){fy(d,s,u,r,xe,l);for(let ke=0;ke<i;++ke)d.stroke();isNaN(C)||(xe=_+(C%ir||ir))}de&&OB(d,s,xe),i||(fy(d,s,u,r,xe,l),d.stroke())}var eC=class extends Cs{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:s=>s!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(s){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,s&&Object.assign(this,s)}inRange(s,u,r){let l=this.getProps(["x","y"],r),{angle:i,distance:_}=mw(l,{x:s,y:u}),{startAngle:C,endAngle:I,innerRadius:O,outerRadius:N,circumference:q}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],r),ie=(this.options.spacing+this.options.borderWidth)/2,xe=Yi(q,I-C)>=ir||Xm(i,C,I),ke=tl(_,O+ie,N+ie);return xe&&ke}getCenterPoint(s){let{x:u,y:r,startAngle:l,endAngle:i,innerRadius:_,outerRadius:C}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],s),{offset:I,spacing:O}=this.options,N=(l+i)/2,q=(_+C+O+I)/2;return{x:u+Math.cos(N)*q,y:r+Math.sin(N)*q}}tooltipPosition(s){return this.getCenterPoint(s)}draw(s){let{options:u,circumference:r}=this,l=(u.offset||0)/4,i=(u.spacing||0)/2,_=u.circular;if(this.pixelMargin=u.borderAlign==="inner"?.33:0,this.fullCircles=r>ir?Math.floor(r/ir):0,r===0||this.innerRadius<0||this.outerRadius<0)return;s.save();let C=(this.startAngle+this.endAngle)/2;s.translate(Math.cos(C)*l,Math.sin(C)*l);let I=1-Math.sin(Math.min(tr,r||0)),O=l*I;s.fillStyle=u.backgroundColor,s.strokeStyle=u.borderColor,FB(s,this,O,i,_),zB(s,this,O,i,_),s.restore()}};function LD(d,s,u=s){d.lineCap=Yi(u.borderCapStyle,s.borderCapStyle),d.setLineDash(Yi(u.borderDash,s.borderDash)),d.lineDashOffset=Yi(u.borderDashOffset,s.borderDashOffset),d.lineJoin=Yi(u.borderJoinStyle,s.borderJoinStyle),d.lineWidth=Yi(u.borderWidth,s.borderWidth),d.strokeStyle=Yi(u.borderColor,s.borderColor)}function BB(d,s,u){d.lineTo(u.x,u.y)}function NB(d){return d.stepped?cE:d.tension||d.cubicInterpolationMode==="monotone"?dE:BB}function FD(d,s,u={}){let r=d.length,{start:l=0,end:i=r-1}=u,{start:_,end:C}=s,I=Math.max(l,_),O=Math.min(i,C),N=l<_&&i<_||l>C&&i>C;return{count:r,start:I,loop:s.loop,ilen:O<I&&!N?r+O-I:O-I}}function VB(d,s,u,r){let{points:l,options:i}=s,{count:_,start:C,loop:I,ilen:O}=FD(l,u,r),N=NB(i),{move:q=!0,reverse:ie}=r||{},de,xe,ke;for(de=0;de<=O;++de)xe=l[(C+(ie?O-de:de))%_],!xe.skip&&(q?(d.moveTo(xe.x,xe.y),q=!1):N(d,ke,xe,ie,i.stepped),ke=xe);return I&&(xe=l[(C+(ie?O:0))%_],N(d,ke,xe,ie,i.stepped)),!!I}function jB(d,s,u,r){let l=s.points,{count:i,start:_,ilen:C}=FD(l,u,r),{move:I=!0,reverse:O}=r||{},N=0,q=0,ie,de,xe,ke,Ae,Xe,qe=It=>(_+(O?C-It:It))%i,ut=()=>{ke!==Ae&&(d.lineTo(N,Ae),d.lineTo(N,ke),d.lineTo(N,Xe))};for(I&&(de=l[qe(0)],d.moveTo(de.x,de.y)),ie=0;ie<=C;++ie){if(de=l[qe(ie)],de.skip)continue;let It=de.x,wt=de.y,Et=It|0;Et===xe?(wt<ke?ke=wt:wt>Ae&&(Ae=wt),N=(q*N+It)/++q):(ut(),d.lineTo(It,wt),xe=Et,q=0,ke=Ae=wt),Xe=wt}ut()}function tC(d){let s=d.options,u=s.borderDash&&s.borderDash.length;return!d._decimated&&!d._loop&&!s.tension&&s.cubicInterpolationMode!=="monotone"&&!s.stepped&&!u?jB:VB}function UB(d){return d.stepped?yE:d.tension||d.cubicInterpolationMode==="monotone"?vE:vd}function HB(d,s,u,r){let l=s._path;l||(l=s._path=new Path2D,s.path(l,u,r)&&l.closePath()),LD(d,s.options),d.stroke(l)}function WB(d,s,u,r){let{segments:l,options:i}=s,_=tC(s);for(let C of l)LD(d,i,C.style),d.beginPath(),_(d,s,C,{start:u,end:u+r-1})&&d.closePath(),d.stroke()}var GB=typeof Path2D=="function";function qB(d,s,u,r){GB&&!s.options.segment?HB(d,s,u,r):WB(d,s,u,r)}var by=(()=>{class d extends Cs{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:u=>u!=="borderDash"&&u!=="fill"};constructor(u){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,u&&Object.assign(this,u)}updateControlPoints(u,r){let l=this.options;if((l.tension||l.cubicInterpolationMode==="monotone")&&!l.stepped&&!this._pointsUpdated){let i=l.spanGaps?this._loop:this._fullLoop;gE(this._points,l,u,i,r),this._pointsUpdated=!0}}set points(u){this._points=u,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=wE(this,this.options.segment))}first(){let u=this.segments,r=this.points;return u.length&&r[u[0].start]}last(){let u=this.segments,r=this.points,l=u.length;return l&&r[u[l-1].end]}interpolate(u,r){let l=this.options,i=u[r],_=this.points,C=Rw(this,{property:r,start:i,end:i});if(!C.length)return;let I=[],O=UB(l),N,q;for(N=0,q=C.length;N<q;++N){let{start:ie,end:de}=C[N],xe=_[ie],ke=_[de];if(xe===ke){I.push(xe);continue}let Ae=Math.abs((i-xe[r])/(ke[r]-xe[r])),Xe=O(xe,ke,Ae,l.stepped);Xe[r]=u[r],I.push(Xe)}return I.length===1?I[0]:I}pathSegment(u,r,l){return tC(this)(u,this,r,l)}path(u,r,l){let i=this.segments,_=tC(this),C=this._loop;r=r||0,l=l||this.points.length-r;for(let I of i)C&=_(u,this,I,{start:r,end:r+l-1});return!!C}draw(u,r,l,i){let _=this.options||{};(this.points||[]).length&&_.borderWidth&&(u.save(),qB(u,this,l,i),u.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return d})();function KE(d,s,u,r){let l=d.options,{[u]:i}=d.getProps([u],r);return Math.abs(s-i)<l.radius+l.hitRadius}var $B=(()=>{class d extends Cs{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(u){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,u&&Object.assign(this,u)}inRange(u,r,l){let i=this.options,{x:_,y:C}=this.getProps(["x","y"],l);return Math.pow(u-_,2)+Math.pow(r-C,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(u,r){return KE(this,u,"x",r)}inYRange(u,r){return KE(this,u,"y",r)}getCenterPoint(u){let{x:r,y:l}=this.getProps(["x","y"],u);return{x:r,y:l}}size(u){u=u||this.options||{};let r=u.radius||0;r=Math.max(r,r&&u.hoverRadius||0);let l=r&&u.borderWidth||0;return(r+l)*2}draw(u,r){let l=this.options;this.skip||l.radius<.1||!Js(this,r,this.size(l)/2)||(u.strokeStyle=l.borderColor,u.lineWidth=l.borderWidth,u.fillStyle=l.backgroundColor,Qb(u,l,this.x,this.y))}getRange(){let u=this.options||{};return u.radius+u.hitRadius}}return d})();function zD(d,s){let{x:u,y:r,base:l,width:i,height:_}=d.getProps(["x","y","base","width","height"],s),C,I,O,N,q;return d.horizontal?(q=_/2,C=Math.min(u,l),I=Math.max(u,l),O=r-q,N=r+q):(q=i/2,C=u-q,I=u+q,O=Math.min(r,l),N=Math.max(r,l)),{left:C,top:O,right:I,bottom:N}}function kd(d,s,u,r){return d?0:Zr(s,u,r)}function YB(d,s,u){let r=d.options.borderWidth,l=d.borderSkipped,i=Sw(r);return{t:kd(l.top,i.top,0,u),r:kd(l.right,i.right,0,s),b:kd(l.bottom,i.bottom,0,u),l:kd(l.left,i.left,0,s)}}function ZB(d,s,u){let{enableBorderRadius:r}=d.getProps(["enableBorderRadius"]),l=d.options.borderRadius,i=Sd(l),_=Math.min(s,u),C=d.borderSkipped,I=r||ln(l);return{topLeft:kd(!I||C.top||C.left,i.topLeft,0,_),topRight:kd(!I||C.top||C.right,i.topRight,0,_),bottomLeft:kd(!I||C.bottom||C.left,i.bottomLeft,0,_),bottomRight:kd(!I||C.bottom||C.right,i.bottomRight,0,_)}}function XB(d){let s=zD(d),u=s.right-s.left,r=s.bottom-s.top,l=YB(d,u/2,r/2),i=ZB(d,u/2,r/2);return{outer:{x:s.left,y:s.top,w:u,h:r,radius:i},inner:{x:s.left+l.l,y:s.top+l.t,w:u-l.l-l.r,h:r-l.t-l.b,radius:{topLeft:Math.max(0,i.topLeft-Math.max(l.t,l.l)),topRight:Math.max(0,i.topRight-Math.max(l.t,l.r)),bottomLeft:Math.max(0,i.bottomLeft-Math.max(l.b,l.l)),bottomRight:Math.max(0,i.bottomRight-Math.max(l.b,l.r))}}}}function jw(d,s,u,r){let l=s===null,i=u===null,C=d&&!(l&&i)&&zD(d,r);return C&&(l||tl(s,C.left,C.right))&&(i||tl(u,C.top,C.bottom))}function QB(d){return d.topLeft||d.topRight||d.bottomLeft||d.bottomRight}function KB(d,s){d.rect(s.x,s.y,s.w,s.h)}function Uw(d,s,u={}){let r=d.x!==u.x?-s:0,l=d.y!==u.y?-s:0,i=(d.x+d.w!==u.x+u.w?s:0)-r,_=(d.y+d.h!==u.y+u.h?s:0)-l;return{x:d.x+r,y:d.y+l,w:d.w+i,h:d.h+_,radius:d.radius}}var iC=class extends Cs{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){let{inflateAmount:u,options:{borderColor:r,backgroundColor:l}}=this,{inner:i,outer:_}=XB(this),C=QB(_.radius)?Km:KB;s.save(),(_.w!==i.w||_.h!==i.h)&&(s.beginPath(),C(s,Uw(_,u,i)),s.clip(),C(s,Uw(i,-u,_)),s.fillStyle=r,s.fill("evenodd")),s.beginPath(),C(s,Uw(i,u)),s.fillStyle=l,s.fill(),s.restore()}inRange(s,u,r){return jw(this,s,u,r)}inXRange(s,u){return jw(this,s,null,u)}inYRange(s,u){return jw(this,null,s,u)}getCenterPoint(s){let{x:u,y:r,base:l,horizontal:i}=this.getProps(["x","y","base","horizontal"],s);return{x:i?(u+l)/2:u,y:i?r:(r+l)/2}}getRange(s){return s==="x"?this.width/2:this.height/2}},JB=Object.freeze({__proto__:null,ArcElement:eC,BarElement:iC,LineElement:by,PointElement:$B}),nC=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],JE=nC.map(d=>d.replace("rgb(","rgba(").replace(")",", 0.5)"));function BD(d){return nC[d%nC.length]}function ND(d){return JE[d%JE.length]}function eN(d,s){return d.borderColor=BD(s),d.backgroundColor=ND(s),++s}function tN(d,s){return d.backgroundColor=d.data.map(()=>BD(s++)),s}function iN(d,s){return d.backgroundColor=d.data.map(()=>ND(s++)),s}function nN(d){let s=0;return(u,r)=>{let l=d.getDatasetMeta(r).controller;l instanceof hC?s=tN(u,s):l instanceof kD?s=iN(u,s):l&&(s=eN(u,s))}}function eD(d){let s;for(s in d)if(d[s].borderColor||d[s].backgroundColor)return!0;return!1}function rN(d){return d&&(d.borderColor||d.backgroundColor)}var oN={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(d,s,u){if(!u.enabled)return;let{data:{datasets:r},options:l}=d.config,{elements:i}=l;if(!u.forceOverride&&(eD(r)||rN(l)||i&&eD(i)))return;let _=nN(d);r.forEach(_)}};function aN(d,s,u,r,l){let i=l.samples||r;if(i>=u)return d.slice(s,s+u);let _=[],C=(u-2)/(i-2),I=0,O=s+u-1,N=s,q,ie,de,xe,ke;for(_[I++]=d[N],q=0;q<i-2;q++){let Ae=0,Xe=0,qe,ut=Math.floor((q+1)*C)+1+s,It=Math.min(Math.floor((q+2)*C)+1,u)+s,wt=It-ut;for(qe=ut;qe<It;qe++)Ae+=d[qe].x,Xe+=d[qe].y;Ae/=wt,Xe/=wt;let Et=Math.floor(q*C)+1+s,Ht=Math.min(Math.floor((q+1)*C)+1,u)+s,{x:Ct,y:Yt}=d[N];for(de=xe=-1,qe=Et;qe<Ht;qe++)xe=.5*Math.abs((Ct-Ae)*(d[qe].y-Yt)-(Ct-d[qe].x)*(Xe-Yt)),xe>de&&(de=xe,ie=d[qe],ke=qe);_[I++]=ie,N=ke}return _[I++]=d[O],_}function sN(d,s,u,r){let l=0,i=0,_,C,I,O,N,q,ie,de,xe,ke,Ae=[],Xe=s+u-1,qe=d[s].x,It=d[Xe].x-qe;for(_=s;_<s+u;++_){C=d[_],I=(C.x-qe)/It*r,O=C.y;let wt=I|0;if(wt===N)O<xe?(xe=O,q=_):O>ke&&(ke=O,ie=_),l=(i*l+C.x)/++i;else{let Et=_-1;if(!vn(q)&&!vn(ie)){let Ht=Math.min(q,ie),Ct=Math.max(q,ie);Ht!==de&&Ht!==Et&&Ae.push(Ra(Zi({},d[Ht]),{x:l})),Ct!==de&&Ct!==Et&&Ae.push(Ra(Zi({},d[Ct]),{x:l}))}_>0&&Et!==de&&Ae.push(d[Et]),Ae.push(C),N=wt,i=0,xe=ke=O,q=ie=de=_}}return Ae}function VD(d){if(d._decimated){let s=d._data;delete d._decimated,delete d._data,Object.defineProperty(d,"data",{configurable:!0,enumerable:!0,writable:!0,value:s})}}function tD(d){d.data.datasets.forEach(s=>{VD(s)})}function lN(d,s){let u=s.length,r=0,l,{iScale:i}=d,{min:_,max:C,minDefined:I,maxDefined:O}=i.getUserBounds();return I&&(r=Zr(Ks(s,i.axis,_).lo,0,u-1)),O?l=Zr(Ks(s,i.axis,C).hi+1,r,u)-r:l=u-r,{start:r,count:l}}var cN={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(d,s,u)=>{if(!u.enabled){tD(d);return}let r=d.width;d.data.datasets.forEach((l,i)=>{let{_data:_,indexAxis:C}=l,I=d.getDatasetMeta(i),O=_||l.data;if(Jm([C,d.options.indexAxis])==="y"||!I.controller.supportsDecimation)return;let N=d.scales[I.xAxisID];if(N.type!=="linear"&&N.type!=="time"||d.options.parsing)return;let{start:q,count:ie}=lN(I,O),de=u.threshold||4*r;if(ie<=de){VD(l);return}vn(_)&&(l._data=O,delete l.data,Object.defineProperty(l,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(ke){this._data=ke}}));let xe;switch(u.algorithm){case"lttb":xe=aN(O,q,ie,r,u);break;case"min-max":xe=sN(O,q,ie,r);break;default:throw new Error(`Unsupported decimation algorithm '${u.algorithm}'`)}l._decimated=xe})},destroy(d){tD(d)}};function dN(d,s,u){let r=d.segments,l=d.points,i=s.points,_=[];for(let C of r){let{start:I,end:O}=C;O=uC(I,O,l);let N=rC(u,l[I],l[O],C.loop);if(!s.segments){_.push({source:C,target:N,start:l[I],end:l[O]});continue}let q=Rw(s,N);for(let ie of q){let de=rC(u,i[ie.start],i[ie.end],ie.loop),xe=Ow(C,l,de);for(let ke of xe)_.push({source:ke,target:ie,start:{[u]:iD(N,de,"start",Math.max)},end:{[u]:iD(N,de,"end",Math.min)}})}}return _}function rC(d,s,u,r){if(r)return;let l=s[d],i=u[d];return d==="angle"&&(l=Jo(l),i=Jo(i)),{property:d,start:l,end:i}}function hN(d,s){let{x:u=null,y:r=null}=d||{},l=s.points,i=[];return s.segments.forEach(({start:_,end:C})=>{C=uC(_,C,l);let I=l[_],O=l[C];r!==null?(i.push({x:I.x,y:r}),i.push({x:O.x,y:r})):u!==null&&(i.push({x:u,y:I.y}),i.push({x:u,y:O.y}))}),i}function uC(d,s,u){for(;s>d;s--){let r=u[s];if(!isNaN(r.x)&&!isNaN(r.y))break}return s}function iD(d,s,u,r){return d&&s?r(d[u],s[u]):d?d[u]:s?s[u]:0}function jD(d,s){let u=[],r=!1;return er(d)?(r=!0,u=d):u=hN(d,s),u.length?new by({points:u,options:{tension:0},_loop:r,_fullLoop:r}):null}function nD(d){return d&&d.fill!==!1}function uN(d,s,u){let l=d[s].fill,i=[s],_;if(!u)return l;for(;l!==!1&&i.indexOf(l)===-1;){if(!pr(l))return l;if(_=d[l],!_)return!1;if(_.visible)return l;i.push(l),l=_.fill}return!1}function mN(d,s,u){let r=_N(d);if(ln(r))return isNaN(r.value)?!1:r;let l=parseFloat(r);return pr(l)&&Math.floor(l)===l?pN(r[0],s,l,u):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function pN(d,s,u,r){return(d==="-"||d==="+")&&(u=s+u),u===s||u<0||u>=r?!1:u}function fN(d,s){let u=null;return d==="start"?u=s.bottom:d==="end"?u=s.top:ln(d)?u=s.getPixelForValue(d.value):s.getBasePixel&&(u=s.getBasePixel()),u}function gN(d,s,u){let r;return d==="start"?r=u:d==="end"?r=s.options.reverse?s.min:s.max:ln(d)?r=d.value:r=s.getBaseValue(),r}function _N(d){let s=d.options,u=s.fill,r=Yi(u&&u.target,u);return r===void 0&&(r=!!s.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function bN(d){let{scale:s,index:u,line:r}=d,l=[],i=r.segments,_=r.points,C=yN(s,u);C.push(jD({x:null,y:s.bottom},r));for(let I=0;I<i.length;I++){let O=i[I];for(let N=O.start;N<=O.end;N++)vN(l,_[N],C)}return new by({points:l,options:{}})}function yN(d,s){let u=[],r=d.getMatchingVisibleMetas("line");for(let l=0;l<r.length;l++){let i=r[l];if(i.index===s)break;i.hidden||u.unshift(i.dataset)}return u}function vN(d,s,u){let r=[];for(let l=0;l<u.length;l++){let i=u[l],{first:_,last:C,point:I}=xN(i,s,"x");if(!(!I||_&&C)){if(_)r.unshift(I);else if(d.push(I),!C)break}}d.push(...r)}function xN(d,s,u){let r=d.interpolate(s,u);if(!r)return{};let l=r[u],i=d.segments,_=d.points,C=!1,I=!1;for(let O=0;O<i.length;O++){let N=i[O],q=_[N.start][u],ie=_[N.end][u];if(tl(l,q,ie)){C=l===q,I=l===ie;break}}return{first:C,last:I,point:r}}var gy=class{constructor(s){this.x=s.x,this.y=s.y,this.radius=s.radius}pathSegment(s,u,r){let{x:l,y:i,radius:_}=this;return u=u||{start:0,end:ir},s.arc(l,i,_,u.end,u.start,!0),!r.bounds}interpolate(s){let{x:u,y:r,radius:l}=this,i=s.angle;return{x:u+Math.cos(i)*l,y:r+Math.sin(i)*l,angle:i}}};function wN(d){let{chart:s,fill:u,line:r}=d;if(pr(u))return CN(s,u);if(u==="stack")return bN(d);if(u==="shape")return!0;let l=SN(d);return l instanceof gy?l:jD(l,r)}function CN(d,s){let u=d.getDatasetMeta(s);return u&&d.isDatasetVisible(s)?u.dataset:null}function SN(d){return(d.scale||{}).getPointPositionForValue?kN(d):MN(d)}function MN(d){let{scale:s={},fill:u}=d,r=fN(u,s);if(pr(r)){let l=s.isHorizontal();return{x:l?r:null,y:l?null:r}}return null}function kN(d){let{scale:s,fill:u}=d,r=s.options,l=s.getLabels().length,i=r.reverse?s.max:s.min,_=gN(u,s,i),C=[];if(r.grid.circular){let I=s.getPointPositionForValue(0,i);return new gy({x:I.x,y:I.y,radius:s.getDistanceFromCenterForValue(_)})}for(let I=0;I<l;++I)C.push(s.getPointPositionForValue(I,_));return C}function Hw(d,s,u){let r=wN(s),{line:l,scale:i,axis:_}=s,C=l.options,I=C.fill,O=C.backgroundColor,{above:N=O,below:q=O}=I||{};r&&l.points.length&&(kg(d,u),IN(d,{line:l,target:r,above:N,below:q,area:u,scale:i,axis:_}),Ig(d))}function IN(d,s){let{line:u,target:r,above:l,below:i,area:_,scale:C}=s,I=u._loop?"angle":s.axis;d.save(),I==="x"&&i!==l&&(rD(d,r,_.top),oD(d,{line:u,target:r,color:l,scale:C,property:I}),d.restore(),d.save(),rD(d,r,_.bottom)),oD(d,{line:u,target:r,color:i,scale:C,property:I}),d.restore()}function rD(d,s,u){let{segments:r,points:l}=s,i=!0,_=!1;d.beginPath();for(let C of r){let{start:I,end:O}=C,N=l[I],q=l[uC(I,O,l)];i?(d.moveTo(N.x,N.y),i=!1):(d.lineTo(N.x,u),d.lineTo(N.x,N.y)),_=!!s.pathSegment(d,C,{move:_}),_?d.closePath():d.lineTo(q.x,u)}d.lineTo(s.first().x,u),d.closePath(),d.clip()}function oD(d,s){let{line:u,target:r,property:l,color:i,scale:_}=s,C=dN(u,r,l);for(let{source:I,target:O,start:N,end:q}of C){let{style:{backgroundColor:ie=i}={}}=I,de=r!==!0;d.save(),d.fillStyle=ie,TN(d,_,de&&rC(l,N,q)),d.beginPath();let xe=!!u.pathSegment(d,I),ke;if(de){xe?d.closePath():aD(d,r,q,l);let Ae=!!r.pathSegment(d,O,{move:xe,reverse:!0});ke=xe&&Ae,ke||aD(d,r,N,l)}d.closePath(),d.fill(ke?"evenodd":"nonzero"),d.restore()}}function TN(d,s,u){let{top:r,bottom:l}=s.chart.chartArea,{property:i,start:_,end:C}=u||{};i==="x"&&(d.beginPath(),d.rect(_,r,C-_,l-r),d.clip())}function aD(d,s,u,r){let l=s.interpolate(u,r);l&&d.lineTo(l.x,l.y)}var EN={id:"filler",afterDatasetsUpdate(d,s,u){let r=(d.data.datasets||[]).length,l=[],i,_,C,I;for(_=0;_<r;++_)i=d.getDatasetMeta(_),C=i.dataset,I=null,C&&C.options&&C instanceof by&&(I={visible:d.isDatasetVisible(_),index:_,fill:mN(C,_,r),chart:d,axis:i.controller.options.indexAxis,scale:i.vScale,line:C}),i.$filler=I,l.push(I);for(_=0;_<r;++_)I=l[_],!(!I||I.fill===!1)&&(I.fill=uN(l,_,u.propagate))},beforeDraw(d,s,u){let r=u.drawTime==="beforeDraw",l=d.getSortedVisibleDatasetMetas(),i=d.chartArea;for(let _=l.length-1;_>=0;--_){let C=l[_].$filler;C&&(C.line.updateControlPoints(i,C.axis),r&&C.fill&&Hw(d.ctx,C,i))}},beforeDatasetsDraw(d,s,u){if(u.drawTime!=="beforeDatasetsDraw")return;let r=d.getSortedVisibleDatasetMetas();for(let l=r.length-1;l>=0;--l){let i=r[l].$filler;nD(i)&&Hw(d.ctx,i,d.chartArea)}},beforeDatasetDraw(d,s,u){let r=s.meta.$filler;!nD(r)||u.drawTime!=="beforeDatasetDraw"||Hw(d.ctx,r,d.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},sD=(d,s)=>{let{boxHeight:u=s,boxWidth:r=s}=d;return d.usePointStyle&&(u=Math.min(u,s),r=d.pointStyleWidth||Math.min(r,s)),{boxWidth:r,boxHeight:u,itemHeight:Math.max(s,u)}},DN=(d,s)=>d!==null&&s!==null&&d.datasetIndex===s.datasetIndex&&d.index===s.index,_y=class extends Cs{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,u,r){this.maxWidth=s,this.maxHeight=u,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let s=this.options.labels||{},u=Gn(s.generateLabels,[this.chart],this)||[];s.filter&&(u=u.filter(r=>s.filter(r,this.chart.data))),s.sort&&(u=u.sort((r,l)=>s.sort(r,l,this.chart.data))),this.options.reverse&&u.reverse(),this.legendItems=u}fit(){let{options:s,ctx:u}=this;if(!s.display){this.width=this.height=0;return}let r=s.labels,l=Br(r.font),i=l.size,_=this._computeTitleHeight(),{boxWidth:C,itemHeight:I}=sD(r,i),O,N;u.font=l.string,this.isHorizontal()?(O=this.maxWidth,N=this._fitRows(_,i,C,I)+10):(N=this.maxHeight,O=this._fitCols(_,l,C,I)+10),this.width=Math.min(O,s.maxWidth||this.maxWidth),this.height=Math.min(N,s.maxHeight||this.maxHeight)}_fitRows(s,u,r,l){let{ctx:i,maxWidth:_,options:{labels:{padding:C}}}=this,I=this.legendHitBoxes=[],O=this.lineWidths=[0],N=l+C,q=s;i.textAlign="left",i.textBaseline="middle";let ie=-1,de=-N;return this.legendItems.forEach((xe,ke)=>{let Ae=r+u/2+i.measureText(xe.text).width;(ke===0||O[O.length-1]+Ae+2*C>_)&&(q+=N,O[O.length-(ke>0?0:1)]=0,de+=N,ie++),I[ke]={left:0,top:de,row:ie,width:Ae,height:l},O[O.length-1]+=Ae+C}),q}_fitCols(s,u,r,l){let{ctx:i,maxHeight:_,options:{labels:{padding:C}}}=this,I=this.legendHitBoxes=[],O=this.columnSizes=[],N=_-s,q=C,ie=0,de=0,xe=0,ke=0;return this.legendItems.forEach((Ae,Xe)=>{let{itemWidth:qe,itemHeight:ut}=AN(r,u,i,Ae,l);Xe>0&&de+ut+2*C>N&&(q+=ie+C,O.push({width:ie,height:de}),xe+=ie+C,ke++,ie=de=0),I[Xe]={left:xe,top:de,col:ke,width:qe,height:ut},ie=Math.max(ie,qe),de+=ut+C}),q+=ie,O.push({width:ie,height:de}),q}adjustHitBoxes(){if(!this.options.display)return;let s=this._computeTitleHeight(),{legendHitBoxes:u,options:{align:r,labels:{padding:l},rtl:i}}=this,_=Kh(i,this.left,this.width);if(this.isHorizontal()){let C=0,I=mo(r,this.left+l,this.right-this.lineWidths[C]);for(let O of u)C!==O.row&&(C=O.row,I=mo(r,this.left+l,this.right-this.lineWidths[C])),O.top+=this.top+s+l,O.left=_.leftForLtr(_.x(I),O.width),I+=O.width+l}else{let C=0,I=mo(r,this.top+s+l,this.bottom-this.columnSizes[C].height);for(let O of u)O.col!==C&&(C=O.col,I=mo(r,this.top+s+l,this.bottom-this.columnSizes[C].height)),O.top=I,O.left+=this.left+l,O.left=_.leftForLtr(_.x(O.left),O.width),I+=O.height+l}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let s=this.ctx;kg(s,this),this._draw(),Ig(s)}}_draw(){let{options:s,columnSizes:u,lineWidths:r,ctx:l}=this,{align:i,labels:_}=s,C=fr.color,I=Kh(s.rtl,this.left,this.width),O=Br(_.font),{padding:N}=_,q=O.size,ie=q/2,de;this.drawTitle(),l.textAlign=I.textAlign("left"),l.textBaseline="middle",l.lineWidth=.5,l.font=O.string;let{boxWidth:xe,boxHeight:ke,itemHeight:Ae}=sD(_,q),Xe=function(Et,Ht,Ct){if(isNaN(xe)||xe<=0||isNaN(ke)||ke<0)return;l.save();let Yt=Yi(Ct.lineWidth,1);if(l.fillStyle=Yi(Ct.fillStyle,C),l.lineCap=Yi(Ct.lineCap,"butt"),l.lineDashOffset=Yi(Ct.lineDashOffset,0),l.lineJoin=Yi(Ct.lineJoin,"miter"),l.lineWidth=Yt,l.strokeStyle=Yi(Ct.strokeStyle,C),l.setLineDash(Yi(Ct.lineDash,[])),_.usePointStyle){let zt={radius:ke*Math.SQRT2/2,pointStyle:Ct.pointStyle,rotation:Ct.rotation,borderWidth:Yt},ki=I.xPlus(Et,xe/2),Hi=Ht+ie;Cw(l,zt,ki,Hi,_.pointStyleWidth&&xe)}else{let zt=Ht+Math.max((q-ke)/2,0),ki=I.leftForLtr(Et,xe),Hi=Sd(Ct.borderRadius);l.beginPath(),Object.values(Hi).some(or=>or!==0)?Km(l,{x:ki,y:zt,w:xe,h:ke,radius:Hi}):l.rect(ki,zt,xe,ke),l.fill(),Yt!==0&&l.stroke()}l.restore()},qe=function(Et,Ht,Ct){Cd(l,Ct.text,Et,Ht+Ae/2,O,{strikethrough:Ct.hidden,textAlign:I.textAlign(Ct.textAlign)})},ut=this.isHorizontal(),It=this._computeTitleHeight();ut?de={x:mo(i,this.left+N,this.right-r[0]),y:this.top+N+It,line:0}:de={x:this.left+N,y:mo(i,this.top+It+N,this.bottom-u[0].height),line:0},Aw(this.ctx,s.textDirection);let wt=Ae+N;this.legendItems.forEach((Et,Ht)=>{l.strokeStyle=Et.fontColor,l.fillStyle=Et.fontColor;let Ct=l.measureText(Et.text).width,Yt=I.textAlign(Et.textAlign||(Et.textAlign=_.textAlign)),zt=xe+ie+Ct,ki=de.x,Hi=de.y;I.setWidth(this.width),ut?Ht>0&&ki+zt+N>this.right&&(Hi=de.y+=wt,de.line++,ki=de.x=mo(i,this.left+N,this.right-r[de.line])):Ht>0&&Hi+wt>this.bottom&&(ki=de.x=ki+u[de.line].width+N,de.line++,Hi=de.y=mo(i,this.top+It+N,this.bottom-u[de.line].height));let or=I.x(ki);if(Xe(or,Hi,Et),ki=aE(Yt,ki+xe+ie,ut?ki+zt:this.right,s.rtl),qe(I.x(ki),Hi,Et),ut)de.x+=zt+N;else if(typeof Et.text!="string"){let wi=O.lineHeight;de.y+=UD(Et,wi)+N}else de.y+=wt}),Pw(this.ctx,s.textDirection)}drawTitle(){let s=this.options,u=s.title,r=Br(u.font),l=po(u.padding);if(!u.display)return;let i=Kh(s.rtl,this.left,this.width),_=this.ctx,C=u.position,I=r.size/2,O=l.top+I,N,q=this.left,ie=this.width;if(this.isHorizontal())ie=Math.max(...this.lineWidths),N=this.top+O,q=mo(s.align,q,this.right-ie);else{let xe=this.columnSizes.reduce((ke,Ae)=>Math.max(ke,Ae.height),0);N=O+mo(s.align,this.top,this.bottom-xe-s.labels.padding-this._computeTitleHeight())}let de=mo(C,q,q+ie);_.textAlign=i.textAlign(Zb(C)),_.textBaseline="middle",_.strokeStyle=u.color,_.fillStyle=u.color,_.font=r.string,Cd(_,u.text,de,N,r)}_computeTitleHeight(){let s=this.options.title,u=Br(s.font),r=po(s.padding);return s.display?u.lineHeight+r.height:0}_getLegendItemAt(s,u){let r,l,i;if(tl(s,this.left,this.right)&&tl(u,this.top,this.bottom)){for(i=this.legendHitBoxes,r=0;r<i.length;++r)if(l=i[r],tl(s,l.left,l.left+l.width)&&tl(u,l.top,l.top+l.height))return this.legendItems[r]}return null}handleEvent(s){let u=this.options;if(!RN(s.type,u))return;let r=this._getLegendItemAt(s.x,s.y);if(s.type==="mousemove"||s.type==="mouseout"){let l=this._hoveredItem,i=DN(l,r);l&&!i&&Gn(u.onLeave,[s,l,this],this),this._hoveredItem=r,r&&!i&&Gn(u.onHover,[s,r,this],this)}else r&&Gn(u.onClick,[s,r,this],this)}};function AN(d,s,u,r,l){let i=PN(r,d,s,u),_=ON(l,r,s.lineHeight);return{itemWidth:i,itemHeight:_}}function PN(d,s,u,r){let l=d.text;return l&&typeof l!="string"&&(l=l.reduce((i,_)=>i.length>_.length?i:_)),s+u.size/2+r.measureText(l).width}function ON(d,s,u){let r=d;return typeof s.text!="string"&&(r=UD(s,u)),r}function UD(d,s){let u=d.text?d.text.length:0;return s*u}function RN(d,s){return!!((d==="mousemove"||d==="mouseout")&&(s.onHover||s.onLeave)||s.onClick&&(d==="click"||d==="mouseup"))}var LN={id:"legend",_element:_y,start(d,s,u){let r=d.legend=new _y({ctx:d.ctx,options:u,chart:d});To.configure(d,r,u),To.addBox(d,r)},stop(d){To.removeBox(d,d.legend),delete d.legend},beforeUpdate(d,s,u){let r=d.legend;To.configure(d,r,u),r.options=u},afterUpdate(d){let s=d.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(d,s){s.replay||d.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(d,s,u){let r=s.datasetIndex,l=u.chart;l.isDatasetVisible(r)?(l.hide(r),s.hidden=!0):(l.show(r),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:d=>d.chart.options.color,boxWidth:40,padding:10,generateLabels(d){let s=d.data.datasets,{labels:{usePointStyle:u,pointStyle:r,textAlign:l,color:i,useBorderRadius:_,borderRadius:C}}=d.legend.options;return d._getSortedDatasetMetas().map(I=>{let O=I.controller.getStyle(u?0:void 0),N=po(O.borderWidth);return{text:s[I.index].label,fillStyle:O.backgroundColor,fontColor:i,hidden:!I.visible,lineCap:O.borderCapStyle,lineDash:O.borderDash,lineDashOffset:O.borderDashOffset,lineJoin:O.borderJoinStyle,lineWidth:(N.width+N.height)/4,strokeStyle:O.borderColor,pointStyle:r||O.pointStyle,rotation:O.rotation,textAlign:l||O.textAlign,borderRadius:_&&(C||O.borderRadius),datasetIndex:I.index}},this)}},title:{color:d=>d.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:d=>!d.startsWith("on"),labels:{_scriptable:d=>!["generateLabels","filter","sort"].includes(d)}}},Fg=class extends Cs{constructor(s){super(),this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,u){let r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=s,this.height=this.bottom=u;let l=er(r.text)?r.text.length:1;this._padding=po(r.padding);let i=l*Br(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){let s=this.options.position;return s==="top"||s==="bottom"}_drawArgs(s){let{top:u,left:r,bottom:l,right:i,options:_}=this,C=_.align,I=0,O,N,q;return this.isHorizontal()?(N=mo(C,r,i),q=u+s,O=i-r):(_.position==="left"?(N=r+s,q=mo(C,l,u),I=tr*-.5):(N=i-s,q=mo(C,u,l),I=tr*.5),O=l-u),{titleX:N,titleY:q,maxWidth:O,rotation:I}}draw(){let s=this.ctx,u=this.options;if(!u.display)return;let r=Br(u.font),i=r.lineHeight/2+this._padding.top,{titleX:_,titleY:C,maxWidth:I,rotation:O}=this._drawArgs(i);Cd(s,u.text,0,0,r,{color:u.color,maxWidth:I,rotation:O,textAlign:Zb(u.align),textBaseline:"middle",translation:[_,C]})}};function FN(d,s){let u=new Fg({ctx:d.ctx,options:s,chart:d});To.configure(d,u,s),To.addBox(d,u),d.titleBlock=u}var zN={id:"title",_element:Fg,start(d,s,u){FN(d,u)},stop(d){let s=d.titleBlock;To.removeBox(d,s),delete d.titleBlock},beforeUpdate(d,s,u){let r=d.titleBlock;To.configure(d,r,u),r.options=u},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},sy=new WeakMap,BN={id:"subtitle",start(d,s,u){let r=new Fg({ctx:d.ctx,options:u,chart:d});To.configure(d,r,u),To.addBox(d,r),sy.set(d,r)},stop(d){To.removeBox(d,sy.get(d)),sy.delete(d)},beforeUpdate(d,s,u){let r=sy.get(d);To.configure(d,r,u),r.options=u},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Rg={average(d){if(!d.length)return!1;let s,u,r=new Set,l=0,i=0;for(s=0,u=d.length;s<u;++s){let C=d[s].element;if(C&&C.hasValue()){let I=C.tooltipPosition();r.add(I.x),l+=I.y,++i}}return{x:[...r].reduce((C,I)=>C+I)/r.size,y:l/i}},nearest(d,s){if(!d.length)return!1;let u=s.x,r=s.y,l=Number.POSITIVE_INFINITY,i,_,C;for(i=0,_=d.length;i<_;++i){let I=d[i].element;if(I&&I.hasValue()){let O=I.getCenterPoint(),N=Wb(s,O);N<l&&(l=N,C=I)}}if(C){let I=C.tooltipPosition();u=I.x,r=I.y}return{x:u,y:r}}};function il(d,s){return s&&(er(s)?Array.prototype.push.apply(d,s):d.push(s)),d}function Ql(d){return(typeof d=="string"||d instanceof String)&&d.indexOf(`
`)>-1?d.split(`
`):d}function NN(d,s){let{element:u,datasetIndex:r,index:l}=s,i=d.getDatasetMeta(r).controller,{label:_,value:C}=i.getLabelAndValue(l);return{chart:d,label:_,parsed:i.getParsed(l),raw:d.data.datasets[r].data[l],formattedValue:C,dataset:i.getDataset(),dataIndex:l,datasetIndex:r,element:u}}function lD(d,s){let u=d.chart.ctx,{body:r,footer:l,title:i}=d,{boxWidth:_,boxHeight:C}=s,I=Br(s.bodyFont),O=Br(s.titleFont),N=Br(s.footerFont),q=i.length,ie=l.length,de=r.length,xe=po(s.padding),ke=xe.height,Ae=0,Xe=r.reduce((It,wt)=>It+wt.before.length+wt.lines.length+wt.after.length,0);if(Xe+=d.beforeBody.length+d.afterBody.length,q&&(ke+=q*O.lineHeight+(q-1)*s.titleSpacing+s.titleMarginBottom),Xe){let It=s.displayColors?Math.max(C,I.lineHeight):I.lineHeight;ke+=de*It+(Xe-de)*I.lineHeight+(Xe-1)*s.bodySpacing}ie&&(ke+=s.footerMarginTop+ie*N.lineHeight+(ie-1)*s.footerSpacing);let qe=0,ut=function(It){Ae=Math.max(Ae,u.measureText(It).width+qe)};return u.save(),u.font=O.string,Ln(d.title,ut),u.font=I.string,Ln(d.beforeBody.concat(d.afterBody),ut),qe=s.displayColors?_+2+s.boxPadding:0,Ln(r,It=>{Ln(It.before,ut),Ln(It.lines,ut),Ln(It.after,ut)}),qe=0,u.font=N.string,Ln(d.footer,ut),u.restore(),Ae+=xe.width,{width:Ae,height:ke}}function VN(d,s){let{y:u,height:r}=s;return u<r/2?"top":u>d.height-r/2?"bottom":"center"}function jN(d,s,u,r){let{x:l,width:i}=r,_=u.caretSize+u.caretPadding;if(d==="left"&&l+i+_>s.width||d==="right"&&l-i-_<0)return!0}function UN(d,s,u,r){let{x:l,width:i}=u,{width:_,chartArea:{left:C,right:I}}=d,O="center";return r==="center"?O=l<=(C+I)/2?"left":"right":l<=i/2?O="left":l>=_-i/2&&(O="right"),jN(O,d,s,u)&&(O="center"),O}function cD(d,s,u){let r=u.yAlign||s.yAlign||VN(d,u);return{xAlign:u.xAlign||s.xAlign||UN(d,s,u,r),yAlign:r}}function HN(d,s){let{x:u,width:r}=d;return s==="right"?u-=r:s==="center"&&(u-=r/2),u}function WN(d,s,u){let{y:r,height:l}=d;return s==="top"?r+=u:s==="bottom"?r-=l+u:r-=l/2,r}function dD(d,s,u,r){let{caretSize:l,caretPadding:i,cornerRadius:_}=d,{xAlign:C,yAlign:I}=u,O=l+i,{topLeft:N,topRight:q,bottomLeft:ie,bottomRight:de}=Sd(_),xe=HN(s,C),ke=WN(s,I,O);return I==="center"?C==="left"?xe+=O:C==="right"&&(xe-=O):C==="left"?xe-=Math.max(N,ie)+l:C==="right"&&(xe+=Math.max(q,de)+l),{x:Zr(xe,0,r.width-s.width),y:Zr(ke,0,r.height-s.height)}}function ly(d,s,u){let r=po(u.padding);return s==="center"?d.x+d.width/2:s==="right"?d.x+d.width-r.right:d.x+r.left}function hD(d){return il([],Ql(d))}function GN(d,s,u){return Zl(d,{tooltip:s,tooltipItems:u,type:"tooltip"})}function uD(d,s){let u=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return u?d.override(u):d}var HD={beforeTitle:el,title(d){if(d.length>0){let s=d[0],u=s.chart.data.labels,r=u?u.length:0;if(this&&this.options&&this.options.mode==="dataset")return s.dataset.label||"";if(s.label)return s.label;if(r>0&&s.dataIndex<r)return u[s.dataIndex]}return""},afterTitle:el,beforeBody:el,beforeLabel:el,label(d){if(this&&this.options&&this.options.mode==="dataset")return d.label+": "+d.formattedValue||d.formattedValue;let s=d.dataset.label||"";s&&(s+=": ");let u=d.formattedValue;return vn(u)||(s+=u),s},labelColor(d){let u=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{borderColor:u.borderColor,backgroundColor:u.backgroundColor,borderWidth:u.borderWidth,borderDash:u.borderDash,borderDashOffset:u.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(d){let u=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{pointStyle:u.pointStyle,rotation:u.rotation}},afterLabel:el,afterBody:el,beforeFooter:el,footer:el,afterFooter:el};function ta(d,s,u,r){let l=d[s].call(u,r);return typeof l>"u"?HD[s].call(u,r):l}var mD=(()=>{class d extends Cs{static positioners=Rg;constructor(u){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=u.chart,this.options=u.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(u){this.options=u,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let u=this._cachedAnimations;if(u)return u;let r=this.chart,l=this.options.setContext(this.getContext()),i=l.enabled&&r.options.animation&&l.animations,_=new uy(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(_)),_}getContext(){return this.$context||(this.$context=GN(this.chart.getContext(),this,this._tooltipItems))}getTitle(u,r){let{callbacks:l}=r,i=ta(l,"beforeTitle",this,u),_=ta(l,"title",this,u),C=ta(l,"afterTitle",this,u),I=[];return I=il(I,Ql(i)),I=il(I,Ql(_)),I=il(I,Ql(C)),I}getBeforeBody(u,r){return hD(ta(r.callbacks,"beforeBody",this,u))}getBody(u,r){let{callbacks:l}=r,i=[];return Ln(u,_=>{let C={before:[],lines:[],after:[]},I=uD(l,_);il(C.before,Ql(ta(I,"beforeLabel",this,_))),il(C.lines,ta(I,"label",this,_)),il(C.after,Ql(ta(I,"afterLabel",this,_))),i.push(C)}),i}getAfterBody(u,r){return hD(ta(r.callbacks,"afterBody",this,u))}getFooter(u,r){let{callbacks:l}=r,i=ta(l,"beforeFooter",this,u),_=ta(l,"footer",this,u),C=ta(l,"afterFooter",this,u),I=[];return I=il(I,Ql(i)),I=il(I,Ql(_)),I=il(I,Ql(C)),I}_createItems(u){let r=this._active,l=this.chart.data,i=[],_=[],C=[],I=[],O,N;for(O=0,N=r.length;O<N;++O)I.push(NN(this.chart,r[O]));return u.filter&&(I=I.filter((q,ie,de)=>u.filter(q,ie,de,l))),u.itemSort&&(I=I.sort((q,ie)=>u.itemSort(q,ie,l))),Ln(I,q=>{let ie=uD(u.callbacks,q);i.push(ta(ie,"labelColor",this,q)),_.push(ta(ie,"labelPointStyle",this,q)),C.push(ta(ie,"labelTextColor",this,q))}),this.labelColors=i,this.labelPointStyles=_,this.labelTextColors=C,this.dataPoints=I,I}update(u,r){let l=this.options.setContext(this.getContext()),i=this._active,_,C=[];if(!i.length)this.opacity!==0&&(_={opacity:0});else{let I=Rg[l.position].call(this,i,this._eventPosition);C=this._createItems(l),this.title=this.getTitle(C,l),this.beforeBody=this.getBeforeBody(C,l),this.body=this.getBody(C,l),this.afterBody=this.getAfterBody(C,l),this.footer=this.getFooter(C,l);let O=this._size=lD(this,l),N=Object.assign({},I,O),q=cD(this.chart,l,N),ie=dD(l,N,q,this.chart);this.xAlign=q.xAlign,this.yAlign=q.yAlign,_={opacity:1,x:ie.x,y:ie.y,width:O.width,height:O.height,caretX:I.x,caretY:I.y}}this._tooltipItems=C,this.$context=void 0,_&&this._resolveAnimations().update(this,_),u&&l.external&&l.external.call(this,{chart:this.chart,tooltip:this,replay:r})}drawCaret(u,r,l,i){let _=this.getCaretPosition(u,l,i);r.lineTo(_.x1,_.y1),r.lineTo(_.x2,_.y2),r.lineTo(_.x3,_.y3)}getCaretPosition(u,r,l){let{xAlign:i,yAlign:_}=this,{caretSize:C,cornerRadius:I}=l,{topLeft:O,topRight:N,bottomLeft:q,bottomRight:ie}=Sd(I),{x:de,y:xe}=u,{width:ke,height:Ae}=r,Xe,qe,ut,It,wt,Et;return _==="center"?(wt=xe+Ae/2,i==="left"?(Xe=de,qe=Xe-C,It=wt+C,Et=wt-C):(Xe=de+ke,qe=Xe+C,It=wt-C,Et=wt+C),ut=Xe):(i==="left"?qe=de+Math.max(O,q)+C:i==="right"?qe=de+ke-Math.max(N,ie)-C:qe=this.caretX,_==="top"?(It=xe,wt=It-C,Xe=qe-C,ut=qe+C):(It=xe+Ae,wt=It+C,Xe=qe+C,ut=qe-C),Et=It),{x1:Xe,x2:qe,x3:ut,y1:It,y2:wt,y3:Et}}drawTitle(u,r,l){let i=this.title,_=i.length,C,I,O;if(_){let N=Kh(l.rtl,this.x,this.width);for(u.x=ly(this,l.titleAlign,l),r.textAlign=N.textAlign(l.titleAlign),r.textBaseline="middle",C=Br(l.titleFont),I=l.titleSpacing,r.fillStyle=l.titleColor,r.font=C.string,O=0;O<_;++O)r.fillText(i[O],N.x(u.x),u.y+C.lineHeight/2),u.y+=C.lineHeight+I,O+1===_&&(u.y+=l.titleMarginBottom-I)}}_drawColorBox(u,r,l,i,_){let C=this.labelColors[l],I=this.labelPointStyles[l],{boxHeight:O,boxWidth:N}=_,q=Br(_.bodyFont),ie=ly(this,"left",_),de=i.x(ie),xe=O<q.lineHeight?(q.lineHeight-O)/2:0,ke=r.y+xe;if(_.usePointStyle){let Ae={radius:Math.min(N,O)/2,pointStyle:I.pointStyle,rotation:I.rotation,borderWidth:1},Xe=i.leftForLtr(de,N)+N/2,qe=ke+O/2;u.strokeStyle=_.multiKeyBackground,u.fillStyle=_.multiKeyBackground,Qb(u,Ae,Xe,qe),u.strokeStyle=C.borderColor,u.fillStyle=C.backgroundColor,Qb(u,Ae,Xe,qe)}else{u.lineWidth=ln(C.borderWidth)?Math.max(...Object.values(C.borderWidth)):C.borderWidth||1,u.strokeStyle=C.borderColor,u.setLineDash(C.borderDash||[]),u.lineDashOffset=C.borderDashOffset||0;let Ae=i.leftForLtr(de,N),Xe=i.leftForLtr(i.xPlus(de,1),N-2),qe=Sd(C.borderRadius);Object.values(qe).some(ut=>ut!==0)?(u.beginPath(),u.fillStyle=_.multiKeyBackground,Km(u,{x:Ae,y:ke,w:N,h:O,radius:qe}),u.fill(),u.stroke(),u.fillStyle=C.backgroundColor,u.beginPath(),Km(u,{x:Xe,y:ke+1,w:N-2,h:O-2,radius:qe}),u.fill()):(u.fillStyle=_.multiKeyBackground,u.fillRect(Ae,ke,N,O),u.strokeRect(Ae,ke,N,O),u.fillStyle=C.backgroundColor,u.fillRect(Xe,ke+1,N-2,O-2))}u.fillStyle=this.labelTextColors[l]}drawBody(u,r,l){let{body:i}=this,{bodySpacing:_,bodyAlign:C,displayColors:I,boxHeight:O,boxWidth:N,boxPadding:q}=l,ie=Br(l.bodyFont),de=ie.lineHeight,xe=0,ke=Kh(l.rtl,this.x,this.width),Ae=function(Yt){r.fillText(Yt,ke.x(u.x+xe),u.y+de/2),u.y+=de+_},Xe=ke.textAlign(C),qe,ut,It,wt,Et,Ht,Ct;for(r.textAlign=C,r.textBaseline="middle",r.font=ie.string,u.x=ly(this,Xe,l),r.fillStyle=l.bodyColor,Ln(this.beforeBody,Ae),xe=I&&Xe!=="right"?C==="center"?N/2+q:N+2+q:0,wt=0,Ht=i.length;wt<Ht;++wt){for(qe=i[wt],ut=this.labelTextColors[wt],r.fillStyle=ut,Ln(qe.before,Ae),It=qe.lines,I&&It.length&&(this._drawColorBox(r,u,wt,ke,l),de=Math.max(ie.lineHeight,O)),Et=0,Ct=It.length;Et<Ct;++Et)Ae(It[Et]),de=ie.lineHeight;Ln(qe.after,Ae)}xe=0,de=ie.lineHeight,Ln(this.afterBody,Ae),u.y-=_}drawFooter(u,r,l){let i=this.footer,_=i.length,C,I;if(_){let O=Kh(l.rtl,this.x,this.width);for(u.x=ly(this,l.footerAlign,l),u.y+=l.footerMarginTop,r.textAlign=O.textAlign(l.footerAlign),r.textBaseline="middle",C=Br(l.footerFont),r.fillStyle=l.footerColor,r.font=C.string,I=0;I<_;++I)r.fillText(i[I],O.x(u.x),u.y+C.lineHeight/2),u.y+=C.lineHeight+l.footerSpacing}}drawBackground(u,r,l,i){let{xAlign:_,yAlign:C}=this,{x:I,y:O}=u,{width:N,height:q}=l,{topLeft:ie,topRight:de,bottomLeft:xe,bottomRight:ke}=Sd(i.cornerRadius);r.fillStyle=i.backgroundColor,r.strokeStyle=i.borderColor,r.lineWidth=i.borderWidth,r.beginPath(),r.moveTo(I+ie,O),C==="top"&&this.drawCaret(u,r,l,i),r.lineTo(I+N-de,O),r.quadraticCurveTo(I+N,O,I+N,O+de),C==="center"&&_==="right"&&this.drawCaret(u,r,l,i),r.lineTo(I+N,O+q-ke),r.quadraticCurveTo(I+N,O+q,I+N-ke,O+q),C==="bottom"&&this.drawCaret(u,r,l,i),r.lineTo(I+xe,O+q),r.quadraticCurveTo(I,O+q,I,O+q-xe),C==="center"&&_==="left"&&this.drawCaret(u,r,l,i),r.lineTo(I,O+ie),r.quadraticCurveTo(I,O,I+ie,O),r.closePath(),r.fill(),i.borderWidth>0&&r.stroke()}_updateAnimationTarget(u){let r=this.chart,l=this.$animations,i=l&&l.x,_=l&&l.y;if(i||_){let C=Rg[u.position].call(this,this._active,this._eventPosition);if(!C)return;let I=this._size=lD(this,u),O=Object.assign({},C,this._size),N=cD(r,u,O),q=dD(u,O,N,r);(i._to!==q.x||_._to!==q.y)&&(this.xAlign=N.xAlign,this.yAlign=N.yAlign,this.width=I.width,this.height=I.height,this.caretX=C.x,this.caretY=C.y,this._resolveAnimations().update(this,q))}}_willRender(){return!!this.opacity}draw(u){let r=this.options.setContext(this.getContext()),l=this.opacity;if(!l)return;this._updateAnimationTarget(r);let i={width:this.width,height:this.height},_={x:this.x,y:this.y};l=Math.abs(l)<.001?0:l;let C=po(r.padding),I=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;r.enabled&&I&&(u.save(),u.globalAlpha=l,this.drawBackground(_,u,i,r),Aw(u,r.textDirection),_.y+=C.top,this.drawTitle(_,u,r),this.drawBody(_,u,r),this.drawFooter(_,u,r),Pw(u,r.textDirection),u.restore())}getActiveElements(){return this._active||[]}setActiveElements(u,r){let l=this._active,i=u.map(({datasetIndex:I,index:O})=>{let N=this.chart.getDatasetMeta(I);if(!N)throw new Error("Cannot find a dataset at index "+I);return{datasetIndex:I,element:N.data[O],index:O}}),_=!Sg(l,i),C=this._positionChanged(i,r);(_||C)&&(this._active=i,this._eventPosition=r,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(u,r,l=!0){if(r&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let i=this.options,_=this._active||[],C=this._getActiveElements(u,_,r,l),I=this._positionChanged(C,u),O=r||!Sg(C,_)||I;return O&&(this._active=C,(i.enabled||i.external)&&(this._eventPosition={x:u.x,y:u.y},this.update(!0,r))),O}_getActiveElements(u,r,l,i){let _=this.options;if(u.type==="mouseout")return[];if(!i)return r.filter(I=>this.chart.data.datasets[I.datasetIndex]&&this.chart.getDatasetMeta(I.datasetIndex).controller.getParsed(I.index)!==void 0);let C=this.chart.getElementsAtEventForMode(u,_.mode,_,l);return _.reverse&&C.reverse(),C}_positionChanged(u,r){let{caretX:l,caretY:i,options:_}=this,C=Rg[_.position].call(this,u,r);return C!==!1&&(l!==C.x||i!==C.y)}}return d})(),qN={id:"tooltip",_element:mD,positioners:Rg,afterInit(d,s,u){u&&(d.tooltip=new mD({chart:d,options:u}))},beforeUpdate(d,s,u){d.tooltip&&d.tooltip.initialize(u)},reset(d,s,u){d.tooltip&&d.tooltip.initialize(u)},afterDraw(d){let s=d.tooltip;if(s&&s._willRender()){let u={tooltip:s};if(d.notifyPlugins("beforeTooltipDraw",Ra(Zi({},u),{cancelable:!0}))===!1)return;s.draw(d.ctx),d.notifyPlugins("afterTooltipDraw",u)}},afterEvent(d,s){if(d.tooltip){let u=s.replay;d.tooltip.handleEvent(s.event,u,s.inChartArea)&&(s.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(d,s)=>s.bodyFont.size,boxWidth:(d,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:HD},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:d=>d!=="filter"&&d!=="itemSort"&&d!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},$N=Object.freeze({__proto__:null,Colors:oN,Decimation:cN,Filler:EN,Legend:LN,SubTitle:BN,Title:zN,Tooltip:qN}),YN=(d,s,u,r)=>(typeof s=="string"?(u=d.push(s)-1,r.unshift({index:u,label:s})):isNaN(s)&&(u=null),u);function ZN(d,s,u,r){let l=d.indexOf(s);if(l===-1)return YN(d,s,u,r);let i=d.lastIndexOf(s);return l!==i?u:l}var XN=(d,s)=>d===null?null:Zr(Math.round(d),0,s);function pD(d){let s=this.getLabels();return d>=0&&d<s.length?s[d]:d}var QN=(()=>{class d extends tu{static id="category";static defaults={ticks:{callback:pD}};constructor(u){super(u),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(u){let r=this._addedLabels;if(r.length){let l=this.getLabels();for(let{index:i,label:_}of r)l[i]===_&&l.splice(i,1);this._addedLabels=[]}super.init(u)}parse(u,r){if(vn(u))return null;let l=this.getLabels();return r=isFinite(r)&&l[r]===u?r:ZN(l,u,Yi(r,u),this._addedLabels),XN(r,l.length-1)}determineDataLimits(){let{minDefined:u,maxDefined:r}=this.getUserBounds(),{min:l,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(u||(l=0),r||(i=this.getLabels().length-1)),this.min=l,this.max=i}buildTicks(){let u=this.min,r=this.max,l=this.options.offset,i=[],_=this.getLabels();_=u===0&&r===_.length-1?_:_.slice(u,r+1),this._valueRange=Math.max(_.length-(l?0:1),1),this._startValue=this.min-(l?.5:0);for(let C=u;C<=r;C++)i.push({value:C});return i}getLabelForValue(u){return pD.call(this,u)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(u){return typeof u!="number"&&(u=this.parse(u)),u===null?NaN:this.getPixelForDecimal((u-this._startValue)/this._valueRange)}getPixelForTick(u){let r=this.ticks;return u<0||u>r.length-1?null:this.getPixelForValue(r[u].value)}getValueForPixel(u){return Math.round(this._startValue+this.getDecimalForPixel(u)*this._valueRange)}getBasePixel(){return this.bottom}}return d})();function KN(d,s){let u=[],{bounds:l,step:i,min:_,max:C,precision:I,count:O,maxTicks:N,maxDigits:q,includeBounds:ie}=d,de=i||1,xe=N-1,{min:ke,max:Ae}=s,Xe=!vn(_),qe=!vn(C),ut=!vn(O),It=(Ae-ke)/(q+1),wt=dw((Ae-ke)/xe/de)*de,Et,Ht,Ct,Yt;if(wt<1e-14&&!Xe&&!qe)return[{value:ke},{value:Ae}];Yt=Math.ceil(Ae/wt)-Math.floor(ke/wt),Yt>xe&&(wt=dw(Yt*wt/xe/de)*de),vn(I)||(Et=Math.pow(10,I),wt=Math.ceil(wt*Et)/Et),l==="ticks"?(Ht=Math.floor(ke/wt)*wt,Ct=Math.ceil(Ae/wt)*wt):(Ht=ke,Ct=Ae),Xe&&qe&&i&&JT((C-_)/i,wt/1e3)?(Yt=Math.round(Math.min((C-_)/wt,N)),wt=(C-_)/Yt,Ht=_,Ct=C):ut?(Ht=Xe?_:Ht,Ct=qe?C:Ct,Yt=O-1,wt=(Ct-Ht)/Yt):(Yt=(Ct-Ht)/wt,Zm(Yt,Math.round(Yt),wt/1e3)?Yt=Math.round(Yt):Yt=Math.ceil(Yt));let zt=Math.max(uw(wt),uw(Ht));Et=Math.pow(10,vn(I)?zt:I),Ht=Math.round(Ht*Et)/Et,Ct=Math.round(Ct*Et)/Et;let ki=0;for(Xe&&(ie&&Ht!==_?(u.push({value:_}),Ht<_&&ki++,Zm(Math.round((Ht+ki*wt)*Et)/Et,_,fD(_,It,d))&&ki++):Ht<_&&ki++);ki<Yt;++ki){let Hi=Math.round((Ht+ki*wt)*Et)/Et;if(qe&&Hi>C)break;u.push({value:Hi})}return qe&&ie&&Ct!==C?u.length&&Zm(u[u.length-1].value,C,fD(C,It,d))?u[u.length-1].value=C:u.push({value:C}):(!qe||Ct===C)&&u.push({value:Ct}),u}function fD(d,s,{horizontal:u,minRotation:r}){let l=qa(r),i=(u?Math.sin(l):Math.cos(l))||.001,_=.75*s*(""+d).length;return Math.min(s/i,_)}var ip=class extends tu{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,u){return vn(s)||(typeof s=="number"||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){let{beginAtZero:s}=this.options,{minDefined:u,maxDefined:r}=this.getUserBounds(),{min:l,max:i}=this,_=I=>l=u?l:I,C=I=>i=r?i:I;if(s){let I=ws(l),O=ws(i);I<0&&O<0?C(0):I>0&&O>0&&_(0)}if(l===i){let I=i===0?1:Math.abs(i*.05);C(i+I),s||_(l-I)}this.min=l,this.max=i}getTickLimit(){let s=this.options.ticks,{maxTicksLimit:u,stepSize:r}=s,l;return r?(l=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,l>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${l} ticks. Limiting to 1000.`),l=1e3)):(l=this.computeTickLimit(),u=u||11),u&&(l=Math.min(u,l)),l}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let s=this.options,u=s.ticks,r=this.getTickLimit();r=Math.max(2,r);let l={maxTicks:r,bounds:s.bounds,min:s.min,max:s.max,precision:u.precision,step:u.stepSize,count:u.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:u.minRotation||0,includeBounds:u.includeBounds!==!1},i=this._range||this,_=KN(l,i);return s.bounds==="ticks"&&hw(_,this,"value"),s.reverse?(_.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),_}configure(){let s=this.ticks,u=this.min,r=this.max;if(super.configure(),this.options.offset&&s.length){let l=(r-u)/Math.max(s.length-1,1)/2;u-=l,r+=l}this._startValue=u,this._endValue=r,this._valueRange=r-u}getLabelForValue(s){return Qm(s,this.chart.options.locale,this.options.ticks.format)}},oC=class extends ip{static id="linear";static defaults={ticks:{callback:Mg.formatters.numeric}};determineDataLimits(){let{min:s,max:u}=this.getMinMax(!0);this.min=pr(s)?s:0,this.max=pr(u)?u:1,this.handleTickRangeOptions()}computeTickLimit(){let s=this.isHorizontal(),u=s?this.width:this.height,r=qa(this.options.ticks.minRotation),l=(s?Math.sin(r):Math.cos(r))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(u/Math.min(40,i.lineHeight/l))}getPixelForValue(s){return s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}},zg=d=>Math.floor($l(d)),eu=(d,s)=>Math.pow(10,zg(d)+s);function gD(d){return d/Math.pow(10,zg(d))===1}function _D(d,s,u){let r=Math.pow(10,u),l=Math.floor(d/r);return Math.ceil(s/r)-l}function JN(d,s){let u=s-d,r=zg(u);for(;_D(d,s,r)>10;)r++;for(;_D(d,s,r)<10;)r--;return Math.min(r,zg(d))}function eV(d,{min:s,max:u}){s=ea(d.min,s);let r=[],l=zg(s),i=JN(s,u),_=i<0?Math.pow(10,Math.abs(i)):1,C=Math.pow(10,i),I=l>i?Math.pow(10,l):0,O=Math.round((s-I)*_)/_,N=Math.floor((s-I)/C/10)*C*10,q=Math.floor((O-N)/Math.pow(10,i)),ie=ea(d.min,Math.round((I+N+q*Math.pow(10,i))*_)/_);for(;ie<u;)r.push({value:ie,major:gD(ie),significand:q}),q>=10?q=q<15?15:20:q++,q>=20&&(i++,q=2,_=i>=0?1:_),ie=Math.round((I+N+q*Math.pow(10,i))*_)/_;let de=ea(d.max,ie);return r.push({value:de,major:gD(de),significand:q}),r}var aC=class extends tu{static id="logarithmic";static defaults={ticks:{callback:Mg.formatters.logarithmic,major:{enabled:!0}}};constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(s,u){let r=ip.prototype.parse.apply(this,[s,u]);if(r===0){this._zero=!0;return}return pr(r)&&r>0?r:null}determineDataLimits(){let{min:s,max:u}=this.getMinMax(!0);this.min=pr(s)?Math.max(0,s):null,this.max=pr(u)?Math.max(0,u):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!pr(this._userMin)&&(this.min=s===eu(this.min,0)?eu(this.min,-1):eu(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:s,maxDefined:u}=this.getUserBounds(),r=this.min,l=this.max,i=C=>r=s?r:C,_=C=>l=u?l:C;r===l&&(r<=0?(i(1),_(10)):(i(eu(r,-1)),_(eu(l,1)))),r<=0&&i(eu(l,-1)),l<=0&&_(eu(r,1)),this.min=r,this.max=l}buildTicks(){let s=this.options,u={min:this._userMin,max:this._userMax},r=eV(u,this);return s.bounds==="ticks"&&hw(r,this,"value"),s.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(s){return s===void 0?"0":Qm(s,this.chart.options.locale,this.options.ticks.format)}configure(){let s=this.min;super.configure(),this._startValue=$l(s),this._valueRange=$l(this.max)-$l(s)}getPixelForValue(s){return(s===void 0||s===0)&&(s=this.min),s===null||isNaN(s)?NaN:this.getPixelForDecimal(s===this.min?0:($l(s)-this._startValue)/this._valueRange)}getValueForPixel(s){let u=this.getDecimalForPixel(s);return Math.pow(10,this._startValue+u*this._valueRange)}};function sC(d){let s=d.ticks;if(s.display&&d.display){let u=po(s.backdropPadding);return Yi(s.font&&s.font.size,fr.font.size)+u.height}return 0}function tV(d,s,u){return u=er(u)?u:[u],{w:lE(d,s.string,u),h:u.length*s.lineHeight}}function bD(d,s,u,r,l){return d===r||d===l?{start:s-u/2,end:s+u/2}:d<r||d>l?{start:s-u,end:s}:{start:s,end:s+u}}function iV(d){let s={l:d.left+d._padding.left,r:d.right-d._padding.right,t:d.top+d._padding.top,b:d.bottom-d._padding.bottom},u=Object.assign({},s),r=[],l=[],i=d._pointLabels.length,_=d.options.pointLabels,C=_.centerPointLabels?tr/i:0;for(let I=0;I<i;I++){let O=_.setContext(d.getPointLabelContext(I));l[I]=O.padding;let N=d.getPointPosition(I,d.drawingArea+l[I],C),q=Br(O.font),ie=tV(d.ctx,q,d._pointLabels[I]);r[I]=ie;let de=Jo(d.getIndexAngle(I)+C),xe=Math.round($b(de)),ke=bD(xe,N.x,ie.w,0,180),Ae=bD(xe,N.y,ie.h,90,270);nV(u,s,de,ke,Ae)}d.setCenterPoint(s.l-u.l,u.r-s.r,s.t-u.t,u.b-s.b),d._pointLabelItems=aV(d,r,l)}function nV(d,s,u,r,l){let i=Math.abs(Math.sin(u)),_=Math.abs(Math.cos(u)),C=0,I=0;r.start<s.l?(C=(s.l-r.start)/i,d.l=Math.min(d.l,s.l-C)):r.end>s.r&&(C=(r.end-s.r)/i,d.r=Math.max(d.r,s.r+C)),l.start<s.t?(I=(s.t-l.start)/_,d.t=Math.min(d.t,s.t-I)):l.end>s.b&&(I=(l.end-s.b)/_,d.b=Math.max(d.b,s.b+I))}function rV(d,s,u){let r=d.drawingArea,{extra:l,additionalAngle:i,padding:_,size:C}=u,I=d.getPointPosition(s,r+l+_,i),O=Math.round($b(Jo(I.angle+xr))),N=cV(I.y,C.h,O),q=sV(O),ie=lV(I.x,C.w,q);return{visible:!0,x:I.x,y:N,textAlign:q,left:ie,top:N,right:ie+C.w,bottom:N+C.h}}function oV(d,s){if(!s)return!0;let{left:u,top:r,right:l,bottom:i}=d;return!(Js({x:u,y:r},s)||Js({x:u,y:i},s)||Js({x:l,y:r},s)||Js({x:l,y:i},s))}function aV(d,s,u){let r=[],l=d._pointLabels.length,i=d.options,{centerPointLabels:_,display:C}=i.pointLabels,I={extra:sC(i)/2,additionalAngle:_?tr/l:0},O;for(let N=0;N<l;N++){I.padding=u[N],I.size=s[N];let q=rV(d,N,I);r.push(q),C==="auto"&&(q.visible=oV(q,O),q.visible&&(O=q))}return r}function sV(d){return d===0||d===180?"center":d<180?"left":"right"}function lV(d,s,u){return u==="right"?d-=s:u==="center"&&(d-=s/2),d}function cV(d,s,u){return u===90||u===270?d-=s/2:(u>270||u<90)&&(d-=s),d}function dV(d,s,u){let{left:r,top:l,right:i,bottom:_}=u,{backdropColor:C}=s;if(!vn(C)){let I=Sd(s.borderRadius),O=po(s.backdropPadding);d.fillStyle=C;let N=r-O.left,q=l-O.top,ie=i-r+O.width,de=_-l+O.height;Object.values(I).some(xe=>xe!==0)?(d.beginPath(),Km(d,{x:N,y:q,w:ie,h:de,radius:I}),d.fill()):d.fillRect(N,q,ie,de)}}function hV(d,s){let{ctx:u,options:{pointLabels:r}}=d;for(let l=s-1;l>=0;l--){let i=d._pointLabelItems[l];if(!i.visible)continue;let _=r.setContext(d.getPointLabelContext(l));dV(u,_,i);let C=Br(_.font),{x:I,y:O,textAlign:N}=i;Cd(u,d._pointLabels[l],I,O+C.lineHeight/2,C,{color:_.color,textAlign:N,textBaseline:"middle"})}}function WD(d,s,u,r){let{ctx:l}=d;if(u)l.arc(d.xCenter,d.yCenter,s,0,ir);else{let i=d.getPointPosition(0,s);l.moveTo(i.x,i.y);for(let _=1;_<r;_++)i=d.getPointPosition(_,s),l.lineTo(i.x,i.y)}}function uV(d,s,u,r,l){let i=d.ctx,_=s.circular,{color:C,lineWidth:I}=s;!_&&!r||!C||!I||u<0||(i.save(),i.strokeStyle=C,i.lineWidth=I,i.setLineDash(l.dash),i.lineDashOffset=l.dashOffset,i.beginPath(),WD(d,u,_,r),i.closePath(),i.stroke(),i.restore())}function mV(d,s,u){return Zl(d,{label:u,index:s,type:"pointLabel"})}var lC=class extends ip{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Mg.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(s){return s},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(s){super(s),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let s=this._padding=po(sC(this.options)/2),u=this.width=this.maxWidth-s.width,r=this.height=this.maxHeight-s.height;this.xCenter=Math.floor(this.left+u/2+s.left),this.yCenter=Math.floor(this.top+r/2+s.top),this.drawingArea=Math.floor(Math.min(u,r)/2)}determineDataLimits(){let{min:s,max:u}=this.getMinMax(!1);this.min=pr(s)&&!isNaN(s)?s:0,this.max=pr(u)&&!isNaN(u)?u:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/sC(this.options))}generateTickLabels(s){ip.prototype.generateTickLabels.call(this,s),this._pointLabels=this.getLabels().map((u,r)=>{let l=Gn(this.options.pointLabels.callback,[u,r],this);return l||l===0?l:""}).filter((u,r)=>this.chart.getDataVisibility(r))}fit(){let s=this.options;s.display&&s.pointLabels.display?iV(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(s,u,r,l){this.xCenter+=Math.floor((s-u)/2),this.yCenter+=Math.floor((r-l)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(s,u,r,l))}getIndexAngle(s){let u=ir/(this._pointLabels.length||1),r=this.options.startAngle||0;return Jo(s*u+qa(r))}getDistanceFromCenterForValue(s){if(vn(s))return NaN;let u=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-s)*u:(s-this.min)*u}getValueForDistanceFromCenter(s){if(vn(s))return NaN;let u=s/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-u:this.min+u}getPointLabelContext(s){let u=this._pointLabels||[];if(s>=0&&s<u.length){let r=u[s];return mV(this.getContext(),s,r)}}getPointPosition(s,u,r=0){let l=this.getIndexAngle(s)-xr+r;return{x:Math.cos(l)*u+this.xCenter,y:Math.sin(l)*u+this.yCenter,angle:l}}getPointPositionForValue(s,u){return this.getPointPosition(s,this.getDistanceFromCenterForValue(u))}getBasePosition(s){return this.getPointPositionForValue(s||0,this.getBaseValue())}getPointLabelPosition(s){let{left:u,top:r,right:l,bottom:i}=this._pointLabelItems[s];return{left:u,top:r,right:l,bottom:i}}drawBackground(){let{backgroundColor:s,grid:{circular:u}}=this.options;if(s){let r=this.ctx;r.save(),r.beginPath(),WD(this,this.getDistanceFromCenterForValue(this._endValue),u,this._pointLabels.length),r.closePath(),r.fillStyle=s,r.fill(),r.restore()}}drawGrid(){let s=this.ctx,u=this.options,{angleLines:r,grid:l,border:i}=u,_=this._pointLabels.length,C,I,O;if(u.pointLabels.display&&hV(this,_),l.display&&this.ticks.forEach((N,q)=>{if(q!==0||q===0&&this.min<0){I=this.getDistanceFromCenterForValue(N.value);let ie=this.getContext(q),de=l.setContext(ie),xe=i.setContext(ie);uV(this,de,I,_,xe)}}),r.display){for(s.save(),C=_-1;C>=0;C--){let N=r.setContext(this.getPointLabelContext(C)),{color:q,lineWidth:ie}=N;!ie||!q||(s.lineWidth=ie,s.strokeStyle=q,s.setLineDash(N.borderDash),s.lineDashOffset=N.borderDashOffset,I=this.getDistanceFromCenterForValue(u.ticks.reverse?this.min:this.max),O=this.getPointPosition(C,I),s.beginPath(),s.moveTo(this.xCenter,this.yCenter),s.lineTo(O.x,O.y),s.stroke())}s.restore()}}drawBorder(){}drawLabels(){let s=this.ctx,u=this.options,r=u.ticks;if(!r.display)return;let l=this.getIndexAngle(0),i,_;s.save(),s.translate(this.xCenter,this.yCenter),s.rotate(l),s.textAlign="center",s.textBaseline="middle",this.ticks.forEach((C,I)=>{if(I===0&&this.min>=0&&!u.reverse)return;let O=r.setContext(this.getContext(I)),N=Br(O.font);if(i=this.getDistanceFromCenterForValue(this.ticks[I].value),O.showLabelBackdrop){s.font=N.string,_=s.measureText(C.label).width,s.fillStyle=O.backdropColor;let q=po(O.backdropPadding);s.fillRect(-_/2-q.left,-i-N.size/2-q.top,_+q.width,N.size+q.height)}Cd(s,C.label,0,-i,N,{color:O.color,strokeColor:O.textStrokeColor,strokeWidth:O.textStrokeWidth})}),s.restore()}drawTitle(){}},yy={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ia=Object.keys(yy);function yD(d,s){return d-s}function vD(d,s){if(vn(s))return null;let u=d._adapter,{parser:r,round:l,isoWeekday:i}=d._parseOpts,_=s;return typeof r=="function"&&(_=r(_)),pr(_)||(_=typeof r=="string"?u.parse(_,r):u.parse(_)),_===null?null:(l&&(_=l==="week"&&(Qh(i)||i===!0)?u.startOf(_,"isoWeek",i):u.startOf(_,l)),+_)}function xD(d,s,u,r){let l=ia.length;for(let i=ia.indexOf(d);i<l-1;++i){let _=yy[ia[i]],C=_.steps?_.steps:Number.MAX_SAFE_INTEGER;if(_.common&&Math.ceil((u-s)/(C*_.size))<=r)return ia[i]}return ia[l-1]}function pV(d,s,u,r,l){for(let i=ia.length-1;i>=ia.indexOf(u);i--){let _=ia[i];if(yy[_].common&&d._adapter.diff(l,r,_)>=s-1)return _}return ia[u?ia.indexOf(u):0]}function fV(d){for(let s=ia.indexOf(d)+1,u=ia.length;s<u;++s)if(yy[ia[s]].common)return ia[s]}function wD(d,s,u){if(!u)d[s]=!0;else if(u.length){let{lo:r,hi:l}=Yb(u,s),i=u[r]>=s?u[r]:u[l];d[i]=!0}}function gV(d,s,u,r){let l=d._adapter,i=+l.startOf(s[0].value,r),_=s[s.length-1].value,C,I;for(C=i;C<=_;C=+l.add(C,1,r))I=u[C],I>=0&&(s[I].major=!0);return s}function CD(d,s,u){let r=[],l={},i=s.length,_,C;for(_=0;_<i;++_)C=s[_],l[C]=_,r.push({value:C,major:!1});return i===0||!u?r:gV(d,r,l,u)}var cC=(()=>{class d extends tu{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(u){super(u),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(u,r={}){let l=u.time||(u.time={}),i=this._adapter=new T4._date(u.adapters.date);i.init(r),$m(l.displayFormats,i.formats()),this._parseOpts={parser:l.parser,round:l.round,isoWeekday:l.isoWeekday},super.init(u),this._normalized=r.normalized}parse(u,r){return u===void 0?null:vD(this,u)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let u=this.options,r=this._adapter,l=u.time.unit||"day",{min:i,max:_,minDefined:C,maxDefined:I}=this.getUserBounds();function O(N){!C&&!isNaN(N.min)&&(i=Math.min(i,N.min)),!I&&!isNaN(N.max)&&(_=Math.max(_,N.max))}(!C||!I)&&(O(this._getLabelBounds()),(u.bounds!=="ticks"||u.ticks.source!=="labels")&&O(this.getMinMax(!1))),i=pr(i)&&!isNaN(i)?i:+r.startOf(Date.now(),l),_=pr(_)&&!isNaN(_)?_:+r.endOf(Date.now(),l)+1,this.min=Math.min(i,_-1),this.max=Math.max(i+1,_)}_getLabelBounds(){let u=this.getLabelTimestamps(),r=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return u.length&&(r=u[0],l=u[u.length-1]),{min:r,max:l}}buildTicks(){let u=this.options,r=u.time,l=u.ticks,i=l.source==="labels"?this.getLabelTimestamps():this._generate();u.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);let _=this.min,C=this.max,I=iE(i,_,C);return this._unit=r.unit||(l.autoSkip?xD(r.minUnit,this.min,this.max,this._getLabelCapacity(_)):pV(this,I.length,r.minUnit,this.min,this.max)),this._majorUnit=!l.major.enabled||this._unit==="year"?void 0:fV(this._unit),this.initOffsets(i),u.reverse&&I.reverse(),CD(this,I,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(u=>+u.value))}initOffsets(u=[]){let r=0,l=0,i,_;this.options.offset&&u.length&&(i=this.getDecimalForValue(u[0]),u.length===1?r=1-i:r=(this.getDecimalForValue(u[1])-i)/2,_=this.getDecimalForValue(u[u.length-1]),u.length===1?l=_:l=(_-this.getDecimalForValue(u[u.length-2]))/2);let C=u.length<3?.5:.25;r=Zr(r,0,C),l=Zr(l,0,C),this._offsets={start:r,end:l,factor:1/(r+1+l)}}_generate(){let u=this._adapter,r=this.min,l=this.max,i=this.options,_=i.time,C=_.unit||xD(_.minUnit,r,l,this._getLabelCapacity(r)),I=Yi(i.ticks.stepSize,1),O=C==="week"?_.isoWeekday:!1,N=Qh(O)||O===!0,q={},ie=r,de,xe;if(N&&(ie=+u.startOf(ie,"isoWeek",O)),ie=+u.startOf(ie,N?"day":C),u.diff(l,r,C)>1e5*I)throw new Error(r+" and "+l+" are too far apart with stepSize of "+I+" "+C);let ke=i.ticks.source==="data"&&this.getDataTimestamps();for(de=ie,xe=0;de<l;de=+u.add(de,I,C),xe++)wD(q,de,ke);return(de===l||i.bounds==="ticks"||xe===1)&&wD(q,de,ke),Object.keys(q).sort(yD).map(Ae=>+Ae)}getLabelForValue(u){let r=this._adapter,l=this.options.time;return l.tooltipFormat?r.format(u,l.tooltipFormat):r.format(u,l.displayFormats.datetime)}format(u,r){let i=this.options.time.displayFormats,_=this._unit,C=r||i[_];return this._adapter.format(u,C)}_tickFormatFunction(u,r,l,i){let _=this.options,C=_.ticks.callback;if(C)return Gn(C,[u,r,l],this);let I=_.time.displayFormats,O=this._unit,N=this._majorUnit,q=O&&I[O],ie=N&&I[N],de=l[r],xe=N&&ie&&de&&de.major;return this._adapter.format(u,i||(xe?ie:q))}generateTickLabels(u){let r,l,i;for(r=0,l=u.length;r<l;++r)i=u[r],i.label=this._tickFormatFunction(i.value,r,u)}getDecimalForValue(u){return u===null?NaN:(u-this.min)/(this.max-this.min)}getPixelForValue(u){let r=this._offsets,l=this.getDecimalForValue(u);return this.getPixelForDecimal((r.start+l)*r.factor)}getValueForPixel(u){let r=this._offsets,l=this.getDecimalForPixel(u)/r.factor-r.end;return this.min+l*(this.max-this.min)}_getLabelSize(u){let r=this.options.ticks,l=this.ctx.measureText(u).width,i=qa(this.isHorizontal()?r.maxRotation:r.minRotation),_=Math.cos(i),C=Math.sin(i),I=this._resolveTickFontOptions(0).size;return{w:l*_+I*C,h:l*C+I*_}}_getLabelCapacity(u){let r=this.options.time,l=r.displayFormats,i=l[r.unit]||l.millisecond,_=this._tickFormatFunction(u,0,CD(this,[u],this._majorUnit),i),C=this._getLabelSize(_),I=Math.floor(this.isHorizontal()?this.width/C.w:this.height/C.h)-1;return I>0?I:1}getDataTimestamps(){let u=this._cache.data||[],r,l;if(u.length)return u;let i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(r=0,l=i.length;r<l;++r)u=u.concat(i[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(u)}getLabelTimestamps(){let u=this._cache.labels||[],r,l;if(u.length)return u;let i=this.getLabels();for(r=0,l=i.length;r<l;++r)u.push(vD(this,i[r]));return this._cache.labels=this._normalized?u:this.normalize(u)}normalize(u){return fw(u.sort(yD))}}return d})();function cy(d,s,u){let r=0,l=d.length-1,i,_,C,I;u?(s>=d[r].pos&&s<=d[l].pos&&({lo:r,hi:l}=Ks(d,"pos",s)),{pos:i,time:C}=d[r],{pos:_,time:I}=d[l]):(s>=d[r].time&&s<=d[l].time&&({lo:r,hi:l}=Ks(d,"time",s)),{time:i,pos:C}=d[r],{time:_,pos:I}=d[l]);let O=_-i;return O?C+(I-C)*(s-i)/O:C}var dC=class extends cC{static id="timeseries";static defaults=cC.defaults;constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let s=this._getTimestampsForTable(),u=this._table=this.buildLookupTable(s);this._minPos=cy(u,this.min),this._tableRange=cy(u,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){let{min:u,max:r}=this,l=[],i=[],_,C,I,O,N;for(_=0,C=s.length;_<C;++_)O=s[_],O>=u&&O<=r&&l.push(O);if(l.length<2)return[{time:u,pos:0},{time:r,pos:1}];for(_=0,C=l.length;_<C;++_)N=l[_+1],I=l[_-1],O=l[_],Math.round((N+I)/2)!==O&&i.push({time:O,pos:_/(C-1)});return i}_generate(){let s=this.min,u=this.max,r=super.getDataTimestamps();return(!r.includes(s)||!r.length)&&r.splice(0,0,s),(!r.includes(u)||r.length===1)&&r.push(u),r.sort((l,i)=>l-i)}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;let u=this.getDataTimestamps(),r=this.getLabelTimestamps();return u.length&&r.length?s=this.normalize(u.concat(r)):s=u.length?u:r,s=this._cache.all=s,s}getDecimalForValue(s){return(cy(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){let u=this._offsets,r=this.getDecimalForPixel(s)/u.factor-u.end;return cy(this._table,r*this._tableRange+this._minPos,!0)}},_V=Object.freeze({__proto__:null,CategoryScale:QN,LinearScale:oC,LogarithmicScale:aC,RadialLinearScale:lC,TimeScale:cC,TimeSeriesScale:dC}),vy=[I4,JB,$N,_V];np.register(...vy);var bV=["chartContainer"];np.register(...vy);var GD=(()=>{let s=class s{constructor(r,l,i){this.http=r,this.router=l,this.razorpayService=i,this.apiUrl=yn,this.earn=null,this.years=[],this.selectedYear=0,this.selectedMonth=0,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.currentWeek=0,this.totalWeeks=0,this.allChartData=[],this.allLabelsData=[],this.dateRange="";for(let _=2022;_<=2030;_++)this.years.push(_)}ngOnInit(){this.initializeChart(),this.loadDefaultEarnings(),this.getCredits()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}initializeChart(){let r=document.getElementById("MyChart");this.chart=new np(r,{type:"bar",data:{labels:[],datasets:[{data:[],backgroundColor:"limegreen",barPercentage:.8,categoryPercentage:.8}]},options:{aspectRatio:1.8,plugins:{tooltip:{enabled:!1}},scales:{y:{display:!1},x:{display:!0,grid:{display:!1}}}}}),this.chart.canvas.addEventListener("click",l=>{let i=this.chart.getElementsAtEventForMode(l,"nearest",{intersect:!0},!1);if(i.length>0){let _=i[0],C=this.chart.data.labels[_.index],I=this.chart.data.datasets[_.datasetIndex].data[_.index];this.earn=I}})}loadDefaultEarnings(){let r=new Date;this.selectedYear=r.getFullYear(),this.selectedMonth=r.getMonth(),this.updateChartData(this.selectedYear,this.selectedMonth)}onYearMonthChange(){this.selectedYear!==0&&this.selectedMonth!==0&&this.updateChartData(this.selectedYear,this.selectedMonth)}updateChartData(r,l){let i=localStorage.getItem("providerId"),_=`${this.apiUrl}providers/earnings/get-earnings/${i}`;this.http.get(_).subscribe(C=>{console.log("API Response:",C);let O=C.sort((q,ie)=>{let de=new Date(q.date),xe=new Date(ie.date);return de.getTime()-xe.getTime()}).filter(q=>{let ie=new Date(q.date);return ie.getFullYear()===r&&ie.getMonth()===l});console.log("Filtered Data:",O);let N=this.transformData(O,r,l);this.allChartData=N.data,this.allLabelsData=N.labels,this.totalWeeks=Math.ceil(this.allChartData.length/7),this.currentWeek=0,this.displayCurrentWeek()},C=>{console.error(C)})}transformData(r,l,i){let _=new Date(l,i+1,0).getDate(),C=Array.from({length:_},(O,N)=>(N+1).toString()),I=new Array(_).fill(0);return r.forEach(O=>{let q=new Date(O.date).getDate();I[q-1]+=O.amount}),console.log("Transformed Data:",{labels:C,amounts:I}),{labels:C,data:I}}displayCurrentWeek(){let r=this.currentWeek*7,l=r+7,i=this.allLabelsData.slice(r,l),_=this.allChartData.slice(r,l);console.log("Week Labels:",i),console.log("Week Data:",_),this.chart.data.labels=i,this.chart.data.datasets[0].data=_,this.chart.update(),this.updateDateRange(i)}updateDateRange(r){if(r.length>0){let l=this.selectedYear,i=this.selectedMonth,_=new Date(l,i,parseInt(r[0])),C=new Date(l,i,parseInt(r[r.length-1]));this.dateRange=`${_.toDateString()} - ${C.toDateString()}`}else this.dateRange=""}previousWeek(){this.currentWeek>0?this.currentWeek--:this.navigateMonth("previous"),this.displayCurrentWeek()}nextWeek(){this.currentWeek<this.totalWeeks-1?this.currentWeek++:this.navigateMonth("next"),this.displayCurrentWeek()}navigateMonth(r){r==="previous"?this.selectedMonth===0?Number(this.selectedYear)>this.years[0]&&(this.selectedYear--,this.selectedMonth=11):this.selectedMonth--:this.selectedMonth===11?this.selectedYear<this.years[this.years.length-1]&&(this.selectedYear++,this.selectedMonth=0):this.selectedMonth++,this.updateChartData(this.selectedYear,this.selectedMonth)}navToCredit(){this.router.navigate(["credits"])}navToMenu(){this.router.navigate(["menu"])}navToPackage(){this.router.navigate(["packages"])}};s.\u0275fac=function(l){return new(l||s)(_e(Wi),_e(Nt),_e(Ko))},s.\u0275cmp=ft({type:s,selectors:[["app-earnings"]],viewQuery:function(l,i){if(l&1&&bi(bV,5),l&2){let _;fi(_=gi())&&(i.chartContainer=_.first)}},decls:76,vars:5,consts:[["chartContainer",""],[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"chart-container"],[1,"chart-navigation"],[2,"font-size","36px",3,"click"],[1,"date-range"],[1,"scroll-container"],[1,"icon2"],["id","MyChart"],[1,"bank-transfer"],[1,"middle-text"],[1,"withdraw-div"],[1,"big-text"],[1,"credit-div"],[1,"icon-credit"],[1,"icon"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"credit1"],[1,"title"],[1,"material-symbols-outlined",3,"click"],[1,"credit-div",3,"click"],[1,"package"],["src","assets/packages/silver coin 1.png",1,"package-img"],[2,"height","5rem"]],template:function(l,i){if(l&1){let _=Kt();V(0,"div",1)(1,"div",2),Oe("click",function(){return _t(_),bt(i.navToMenu())}),$(2,"\u2630"),j(),V(3,"div",3)(4,"div",4),Oe("click",function(){return _t(_),bt(i.navToCredit())}),Me(5,"img",5),V(6,"pre"),$(7),j()(),V(8,"div",6)(9,"span",7),$(10,"notifications"),j()()(),V(11,"div",8)(12,"div",9)(13,"div",10)(14,"span",11),Oe("click",function(){return _t(_),bt(i.previousWeek())}),$(15,"	<"),j(),V(16,"p",12),$(17),j(),V(18,"span",11),Oe("click",function(){return _t(_),bt(i.nextWeek())}),$(19,">"),j()(),V(20,"div",13,0)(22,"span",14),$(23,"\u20B9 \xA0"),V(24,"span"),$(25),j()(),Me(26,"br")(27,"br"),V(28,"canvas",15),$(29),j()()(),V(30,"div")(31,"div",16)(32,"span",17),$(33,"Bank transfer"),j(),V(34,"span",7),$(35,"chevron_right"),j()(),Me(36,"br"),V(37,"div",18)(38,"div")(39,"span",19),$(40,"\u20B9 1897"),j(),V(41,"span",17),$(42,"28-29 Mar"),j(),V(43,"span",17),$(44,"Upcoming"),j()(),V(45,"div")(46,"span",19),$(47,"\u20B9 176"),j(),V(48,"span",17),$(49,"26-27 Mar"),j(),V(50,"span",17),$(51,"Success"),j()()()(),V(52,"div",20)(53,"div",21)(54,"div",22)(55,"span",23),$(56,"poker_chip"),j()(),$(57," \xA0 \xA0 "),V(58,"div",24)(59,"span",25),$(60,"Credits"),j(),V(61,"span",25),$(62),j()()(),V(63,"span",26),Oe("click",function(){return _t(_),bt(i.navToCredit())}),$(64,"chevron_right"),j()(),V(65,"div",27),Oe("click",function(){return _t(_),bt(i.navToPackage())}),V(66,"div",21)(67,"span",28),Me(68,"img",29),$(69,"\xA0 "),V(70,"pre"),$(71,"Silver"),j()()(),V(72,"span",26),Oe("click",function(){return _t(_),bt(i.navToPackage())}),$(73,"chevron_right"),j()()()(),Me(74,"div",30)(75,"app-fotter")}l&2&&(ue(7),Rt(i.credits),ue(10),Rt(i.dateRange),ue(8),Rt(i.earn),ue(4),Rt(i.chart),ue(33),Rt(i.credits))},dependencies:[Qs],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100%;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh;display:grid;row-gap:2rem}.chart-container[_ngcontent-%COMP%]{width:100%;height:fit-content;display:grid;row-gap:1rem;box-shadow:0 5px 5px #00000080;border-radius:.5rem}.scroll-container[_ngcontent-%COMP%]{position:relative;width:100%;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none}#MyChart[_ngcontent-%COMP%]{background-color:#d6ffdf3b;width:100%;display:inline-block;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;scrollbar-width:none;min-width:100%}.chart-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .chart-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{float:left;text-align:left}.icon2[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.8rem;font-weight:500;line-height:24.2px;color:#49a010;float:left;text-align:left;display:flex;margin-left:1rem}.earning-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:24.2px;float:left;text-align:left}.bank-transfer[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.withdraw-div[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:49% 49%;column-gap:2%}.withdraw-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:grid;padding:1rem;row-gap:0;height:120px;border:.25px solid black;border-radius:.5rem}.credit-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;height:2rem}.icon[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:.4rem;border:.25px solid black}.icon-credit[_ngcontent-%COMP%]{display:flex;width:30%;height:2rem}.credit1[_ngcontent-%COMP%]{display:grid;border:none;justify-content:space-around}.rank[_ngcontent-%COMP%]{display:grid;float:left;text-align:left}.title[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:22.94px}.middle-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px}.big-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:20px;font-weight:600;line-height:19.36px}.date-div[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:.5rem}.date-div[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:10rem;height:2rem;border:.25px solid black}.chart-navigation[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.date-range[_ngcontent-%COMP%]{font-size:1.2rem;font-family:"inter" sans-serif;font-weight:500}.package[_ngcontent-%COMP%]{width:max-content;height:2rem;padding:0 .3rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black;border-radius:.4rem}.package-img[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem}.package[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7rem}']});let d=s;return d})();var qD=(()=>{let s=class s{constructor(r){this.router=r}navToHome(){this.router.navigate(["home"])}};s.\u0275fac=function(l){return new(l||s)(_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-waiting-page"]],decls:10,vars:0,consts:[[1,"container"],[1,"sub-container"],["src","assets/new/Man playing Basketball.gif"],[3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div"),Me(3,"img",2)(4,"br")(5,"br"),V(6,"p"),$(7,"Thanks for uploading your documents, your documents are under review. We will let you once you ready to work."),j()()(),V(8,"button",3),Oe("click",function(){return i.navToHome()}),$(9,"Next"),j()())},styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:3rem}.sub-container[_ngcontent-%COMP%]{width:80%;margin-top:-5rem;height:max-content;display:grid;align-items:center}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column}.sub-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60%;height:60%}p[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:16.94px;text-align:center;color:#00000080}button[_ngcontent-%COMP%]{width:90%;height:2.5rem;background:#d16611;color:#f0f8ff;font-size:1.1rem;font-weight:400;line-height:16.94px;border:none;border-radius:.5rem}']});let d=s;return d})();var $D=(()=>{let s=class s{constructor(r){this.router=r}};s.\u0275fac=function(l){return new(l||s)(_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-notification"]],decls:2,vars:0,template:function(l,i){l&1&&(V(0,"p"),$(1,"notification works!"),j())}});let d=s;return d})();var yV=["dialogTemplate"],vV=d=>({selected:d});function xV(d,s){if(d&1){let u=Kt();cd(0),V(1,"div")(2,"p",3),Oe("click",function(){_t(u);let l=dt();return bt(l.extend())}),$(3,"expand_circle_right"),j()(),dd()}}function wV(d,s){if(d&1){let u=Kt();cd(0),V(1,"span",17)(2,"input",18),Oe("change",function(){_t(u);let l=dt().$implicit,i=dt();return bt(i.availabilityService(l.nameOfService))}),j(),$(3,"\xA0 "),V(4,"span",19),$(5),j()(),dd()}if(d&2){let u=dt().$implicit,r=dt();ue(2),Fe("checked",r.selectedService===u.nameOfService),ue(3),Rt(u.nameOfService)}}function CV(d,s){if(d&1){let u=Kt();cd(0),V(1,"span",3),Oe("click",function(){_t(u);let l=dt(2);return bt(l.openServiceDialog())}),$(2,"expand_circle_down"),j(),dd()}}function SV(d,s){if(d&1){let u=Kt();V(0,"div",20)(1,"span",21)(2,"input",18),Oe("change",function(){_t(u);let l=dt().$implicit,i=dt();return bt(i.availabilityService(l.nameOfService))}),j(),V(3,"span",19),$(4),j()()()}if(d&2){let u=dt().$implicit,r=dt();ue(2),Fe("checked",r.selectedService===u.nameOfService),ue(2),Rt(u.nameOfService)}}function MV(d,s){if(d&1&&(cd(0),Bt(1,wV,6,2,"ng-container",4)(2,CV,3,0,"ng-container",4)(3,SV,5,2,"div",16),dd()),d&2){let u=s.index,r=dt();ue(),Fe("ngIf",u<=1&&!r.extendServices),ue(),Fe("ngIf",u===2&&!r.extendServices),ue(),Fe("ngIf",r.extendServices)}}function kV(d,s){if(d&1){let u=Kt();cd(0),V(1,"div",22),Oe("click",function(){let l=_t(u),i=l.$implicit,_=l.index,C=dt();return bt(C.selected(i,_))}),V(2,"p"),$(3),j(),V(4,"p"),$(5),j(),V(6,"span",23),$(7),j()(),dd()}if(d&2){let u=s.$implicit,r=s.index,l=dt();ue(),Fe("ngClass",li(4,vV,l.selectedIndex===r)),ue(2),Rt(u.day.substring(0,3).toUpperCase()),ue(2),Rt(u.date.split("-")[0]),ue(2),Rt(u.workingStaus?"check":"close")}}function IV(d,s){if(d&1){let u=Kt();V(0,"div",28)(1,"span"),$(2),j(),V(3,"p")(4,"mat-slide-toggle",29),Yr("ngModelChange",function(l){let i=_t(u).$implicit;return $r(i.isSelected,l)||(i.isSelected=l),bt(l)}),Oe("change",function(l){let i=_t(u).$implicit,_=dt(2);return bt(_.onToggleChange(l,i))}),j()()()}if(d&2){let u=s.$implicit;ue(2),Rt(u.time),ue(2),qr("ngModel",u.isSelected)}}function TV(d,s){if(d&1&&(V(0,"div",24)(1,"div",25)(2,"span",12),$(3,"check"),j(),V(4,"p"),$(5,"confirmation your working hours"),j(),V(6,"span",12),$(7,"expand_circle_up"),j()(),Me(8,"br")(9,"div",26),Bt(10,IV,5,2,"div",27),j()),d&2){let u=dt();ue(10),Fe("ngForOf",u.nextDaysOfIndex.timming)}}function EV(d,s){if(d&1){let u=Kt();V(0,"div")(1,"div",34)(2,"input",18),Oe("change",function(){let l=_t(u).$implicit,i=dt(2);return bt(i.availabilityService(l.nameOfService))}),j(),$(3," \xA0"),V(4,"span",35),$(5),j()()()}if(d&2){let u=s.$implicit,r=dt(2);ue(2),Fe("checked",r.selectedService===u.nameOfService),ue(3),Rt(u.nameOfService)}}function DV(d,s){if(d&1){let u=Kt();V(0,"h1",30),$(1,"Select Services"),j(),V(2,"div",31)(3,"form"),Bt(4,EV,6,2,"div",5),j()(),V(5,"div",32)(6,"button",33),Oe("click",function(){_t(u);let l=dt();return bt(l.onCancel())}),$(7,"Cancel"),j(),V(8,"button",33),Oe("click",function(){_t(u);let l=dt();return bt(l.onSubmit())}),$(9,"Submit"),j()()}if(d&2){let u=dt();ue(4),Fe("ngForOf",u.services)}}var YD=(()=>{let s=class s{constructor(r,l,i,_,C,I,O){this.location=r,this.renderer=l,this.el=i,this.http=_,this.dialog=C,this.jobDetailsService=I,this.userService=O,this.date=new Date,this.userId=localStorage.getItem("providerId"),this.apiUrl=yn,this.defaultMonth=this.date.toLocaleDateString("default",{month:"long"}),this.daySelected=String(this.date.getDate()).padStart(2,"0"),this.monthSelected=this.defaultMonth.substring(0,3),this.dateSelected=this.date.getDate(),this.isChecked=!1,this.working=!1,this.extendServices=!1,this.services=[],this.nextFourDays=[],this.nextDaysOfIndex=[],this.selectedService="",this.timing=[{time:"07:00AM - 10:00AM",isSelected:!1},{time:"10:00AM - 01:00PM",isSelected:!1},{time:"01:00PM - 04:00PM",isSelected:!1},{time:"04:00PM - 07:00PM",isSelected:!1}],this.selectedIndex=0,this.api="",this.availabilityResponse=[]}extend(){this.extendServices=!this.extendServices}openServiceDialog(){this.dialogRef=this.dialog.open(this.dialogTemplate),this.dialogRef.afterClosed().subscribe(r=>{r&&(this.services=r)})}onCancel(){this.dialogRef.close()}onSubmit(){this.dialogRef.close(this.services)}ngOnInit(){this.getDetails(),this.getNextFourDays();let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];this.daySelected=r[this.date.getDay()],this.getSelectedService()}getSelectedService(){this.userService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.services=r[0].works},r=>{console.log(r)})}availabilityService(r){this.selectedService=r,this.showAvailabilityForService(r)}getNextFourDays(){let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=new Date;for(let i=0;i<10;i++){let _=new Date(l);_.setDate(l.getDate()+i);let C=this.formatDate(_);this.nextFourDays.push({date:C,day:r[_.getDay()],workingStaus:!1,timming:this.timing.map(I=>Zi({},I))})}this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex]}formatDate(r){let l=String(r.getDate()).padStart(2,"0"),i=r.getFullYear(),_=r.toLocaleDateString("default",{month:"long"});return`${l}-${_}-${i}`}selected(r,l){console.log(r),this.isChecked=!1,r.workingStaus?this.working=!0:this.working=!1,this.selectedIndex=l,this.dateSelected=r.date.toString().split("-")[0],this.daySelected=r.day,this.monthSelected=r.date.toString().split("-")[1],this.yearSelected=r.date.toString().split("-")[2],this.nextDaysOfIndex=this.nextFourDays[this.selectedIndex],console.log(this.nextDaysOfIndex),console.log(this.monthSelected),this.timing.forEach(i=>i.isSelected=!1)}workingChange(){this.nextFourDays[this.selectedIndex].workingStaus=!this.nextFourDays[this.selectedIndex].workingStaus}onToggleChange(r,l){this.nextDaysOfIndex.timming.forEach(q=>{q.time===l.time&&(q.isSelected=r.checked)}),this.timeSelected=r.checked?l.time:"",console.log(this.dateSelected);let i=new Date(`${this.monthSelected} ${this.dateSelected} ${this.yearSelected}`);i.setDate(this.dateSelected);let _=i.getDate(),C=i.getMonth()+1,I=_<10?`0${_}`:_,O=C<10?`0${C}`:C,N=this.yearSelected;this.fullDate=`${N}-${O}-${I}`,console.log(O)}submitAllData(){console.log(this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)),this.checkDuplicate(this.fullDate,this.timeSelected,this.selectedService)?alert("The same time slot on the selected date for the selected service is already taken."):this.sendingData()}sendingData(){this.timeSelected!=""?this.api=`${this.apiUrl}providers/provider-date`:this.api=`${this.apiUrl}providers/provider-date/delete`;let r={providerId:this.userId,service:this.selectedService,date:this.fullDate,availability:this.working,time:this.timeSelected};console.log(r),console.log(this.api),this.http.post(this.api,r).subscribe(l=>{console.log(l),alert("Availability added successfully"),this.timing.forEach(i=>i.isSelected=!1),console.log(this.timing),this.getDetails()},l=>{console.log(l),alert("Something went wrong")})}getDetails(){let r=`${this.apiUrl}providers/provider-date/${this.userId}`;this.http.get(r).subscribe(l=>{console.log(l),this.availabilityResponse=l,this.showAvailability(this.availabilityResponse)},l=>{console.log(l)})}deleteData(){}showAvailability(r){console.log(this.services),r.forEach(l=>{let i=l.date,_=new Date(i),C=_.getDate(),I=_.toLocaleDateString("default",{month:"long"}),O=`${String(C).padStart(2,"0")}-${I}-${_.getFullYear()}`;this.nextFourDays.forEach(N=>{N.date===O&&(N.workingStaus=l.work,N.timming.forEach(q=>{q.time===l.time&&(q.isSelected=!0)}))})}),console.log(this.nextFourDays)}checkDuplicate(r,l,i){return this.availabilityResponse.some(_=>_.date===r&&_.time===l&&_.service===i)}navToBack(){this.location.back()}showAvailabilityForService(r){console.log("new called"),this.nextFourDays.forEach(l=>{l.workingStaus=!1,l.timming.forEach(i=>{i.isSelected=!1})}),console.log(this.availabilityResponse),this.availabilityResponse.forEach(l=>{if(l.service===r){let i=l.date,_=new Date(i),C=_.getDate(),I=_.toLocaleDateString("default",{month:"long"}),O=`${String(C).padStart(2,"0")}-${I}-${_.getFullYear()}`;this.nextFourDays.forEach(N=>{O===N.date&&(N.workingStaus=!0,N.timming.forEach(q=>{q.time===l.time&&(q.isSelected=!0)}))})}})}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(dk),_e(sn),_e(Wi),_e(Vm),_e(Fr),_e(vr))},s.\u0275cmp=ft({type:s,selectors:[["app-calender"]],viewQuery:function(l,i){if(l&1&&bi(yV,5),l&2){let _;fi(_=gi())&&(i.dialogTemplate=_.first)}},decls:27,vars:12,consts:[["dialogTemplate",""],[1,"container"],[1,"headers"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"sub-container"],[1,"working-dates"],[1,"selected-date"],[1,"update"],[1,"custom-checkbox"],["type","checkbox",3,"change","ngModelChange","checked","ngModel"],[1,"material-symbols-outlined",2,"font-size","28px"],["class","confirmation-div",4,"ngIf"],[3,"click"],[2,"width","300px"],["class","extended",4,"ngIf"],[2,"display","flex","align-items","center","justify-content","center"],["type","checkbox",3,"change","checked"],[1,"service-tittle"],[1,"extended"],[1,"service"],[1,"datess",3,"click","ngClass"],[1,"material-symbols-outlined"],[1,"confirmation-div"],[1,"conformation"],[1,"line"],["class","time-confirm",4,"ngFor","ngForOf"],[1,"time-confirm"],["color","accent",3,"ngModelChange","change","ngModel"],["mat-dialog-title",""],["mat-dialog-content","",2,"width","300px"],["mat-dialog-actions","",2,"display","flex","justify-content","space-evenly"],["mat-button","",2,"width","30%","height","2rem",3,"click"],[2,"display","flex","align-items","center","width","100%","height","3rem"],[2,"color","black"]],template:function(l,i){if(l&1){let _=Kt();V(0,"div",1)(1,"div",2)(2,"span",3),Oe("click",function(){return _t(_),bt(i.navToBack())}),$(3,"arrow_back"),j(),Bt(4,xV,4,0,"ng-container",4)(5,MV,4,3,"ng-container",5),j(),Me(6,"br")(7,"br"),V(8,"div",6)(9,"div",7),Bt(10,kV,8,6,"ng-container",5),j(),V(11,"div",8)(12,"span"),$(13),j()(),V(14,"div",9)(15,"div")(16,"label",10)(17,"input",11),Oe("change",function(){return _t(_),bt(i.workingChange())}),Yr("ngModelChange",function(I){return _t(_),$r(i.working,I)||(i.working=I),bt(I)}),j()(),V(18,"span"),$(19,"Working"),j()(),V(20,"span",12),$(21),j()(),Bt(22,TV,11,1,"div",13),V(23,"button",14),Oe("click",function(){return _t(_),bt(i.submitAllData())}),$(24,"submit"),j()()(),Bt(25,DV,10,1,"ng-template",15,0,tb)}l&2&&(ue(4),Fe("ngIf",i.extendServices),ue(),Fe("ngForOf",i.services),ue(5),Fe("ngForOf",i.nextFourDays),ue(3),J0("",i.daySelected,",",i.monthSelected," ",i.dateSelected,""),ue(3),Si("checked",i.isChecked),ue(),Fe("checked",i.isChecked),qr("ngModel",i.working),ue(4),Rt(i.working?"expand_circle_right":"expand_circle_down"),ue(),Fe("ngIf",i.working))},dependencies:[So,yr,cr,ko,hd,dr,Mo,Ba,Ik,KI,eT,JI,Sb],styles:['.container[_ngcontent-%COMP%]{width:90%;height:100vh;padding:1rem}.headers[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.service[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.service-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1.2rem;font-weight:400;line-height:16.94px;text-align:left}.extended[_ngcontent-%COMP%]{border:1px solid red}.sub-container[_ngcontent-%COMP%]{width:95%;position:relative;left:2.5%;display:grid;row-gap:3rem}.working-dates[_ngcontent-%COMP%]{width:100%;display:flex;column-gap:2rem;justify-content:space-between;overflow-x:auto;scroll-snap-type:x;scroll-behavior:smooth;flex-direction:row;-ms-overflow-style:none;scrollbar-width:none}.datess[_ngcontent-%COMP%]{width:5rem;height:5rem;display:flex;text-align:center;flex-direction:column;border:1px solid black;border-radius:.5rem;flex:0 0 20%;padding-top:1rem;padding-bottom:1rem}.datess.selected[_ngcontent-%COMP%]{background-color:#72d388;border:none;color:#fff}.selected-date[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.07em}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:#72d388;border:0}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}.btn[_ngcontent-%COMP%]{width:100%;align-items:center}button[_ngcontent-%COMP%]{width:100%;height:3.3rem;background-color:#d16611;border-radius:1rem;color:#fff;border:none;font-size:1rem;font-weight:500}.update[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-around;border:.25px solid black;border-radius:.4rem;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%;display:flex;justify-content:space-around;text-align:center;align-items:center}.update[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;letter-spacing:.07em;text-align:center;align-items:center}.confirmation-div[_ngcontent-%COMP%]{background:#fcf5fc;border:.25px solid rgba(0,0,0,1);border-radius:.4rem;padding:1rem}.conformation[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.line[_ngcontent-%COMP%]{height:1rem;border-bottom:.2px solid transparent;border-top:.25px dashed black}.time-confirm[_ngcontent-%COMP%]{display:flex;justify-content:space-between}']});let d=s;return d})();function AV(d,s){if(d&1){let u=Kt();V(0,"div",5),Oe("click",function(){let l=_t(u).$implicit,i=dt();return bt(i.selectedJob(l))}),V(1,"div")(2,"p")(3,"span",6),$(4),j()(),V(5,"p")(6,"span",7),Oe("click",function(){_t(u);let l=dt();return bt(l.navToBack())}),$(7,"account_balance_wallet"),j(),$(8,"\xA0 "),V(9,"span",8),$(10),j()(),V(11,"p")(12,"span",7),Oe("click",function(){_t(u);let l=dt();return bt(l.navToBack())}),$(13,"description"),j(),$(14,"\xA0 "),V(15,"span",8),$(16),j()()(),V(17,"div")(18,"p",6),$(19),j(),V(20,"p",8),$(21),j()()(),Me(22,"br")}if(d&2){let u=s.$implicit;ue(4),Rt(u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].serviceId.name),ue(6),zi("Job value:",u.orderId==null?null:u.orderId.totalAmount,""),ue(6),zi("Online Payments:",u.orderId==null?null:u.orderId.totalAmount,""),ue(3),Rt(u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].selectedTime),ue(2),gs("",u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].selectedDate," - ",u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].selectedMonth,"")}}var ZD=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r,l,i,_){this.location=r,this.jobDetailsService=l,this.router=i,this.orderService=_,this.jobs=[{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"},{date:"12/02/122",name:"anil",value:"100",paymentDone:"100"}]}ngOnInit(){this.getOrderDetails()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r),this.jobs=r,this.filterOrder()},error:r=>{console.log(r)}})}filterOrder(){this.filteredJobs=this.jobs.filter(r=>r.status&&r.status.toLowerCase()==="completed"),console.log(this.filteredJobs),this.jobs=this.filteredJobs}selectedJob(r){console.log(r),this.jobDetailsService.selectedJobDetails(r),this.router.navigate(["jobDetails"])}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(Fr),_e(Nt),_e(zr))},s.\u0275cmp=ft({type:s,selectors:[["app-job-history"]],decls:11,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","24px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"section",3,"click"],[1,"main-text"],[1,"material-symbols-outlined",2,"font-size","1rem",3,"click"],[1,"text"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return i.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0"),V(5,"span",3),$(6,"Job History"),j()(),V(7,"div",4)(8,"div"),Or(9,AV,23,6,null,null,Lo),j()()()),l&2&&(ue(9),Rr(i.jobs))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%}.section[_ngcontent-%COMP%]{width:100%;height:7rem;border:.25px solid black;border-radius:.5rem;display:flex;justify-content:space-between;align-items:center;text-align:center}.section[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:.5rem;display:flexbox;text-align:left}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px}.main-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:400;line-height:19.36px}.text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:14.52px}']});let d=s;return d})();function PV(d,s){if(d&1){let u=Kt();V(0,"div",16),Oe("click",function(){let l=_t(u).$implicit,i=dt();return bt(i.selected(l))}),$(1),j()}if(d&2){let u=s.$implicit;ue(),Rt(u)}}var XD=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r,l,i){this.location=r,this.http=l,this.razorPayService=i,this.credits=[20,50,100,250],this.selectedValue=0,this.AmountToPay=0,this.payOnline=!1,this.deductNextPayout=!1}entredAmount(){this.AmountToPay=this.selectedValue}selected(r){this.selectedValue=r,this.AmountToPay=this.selectedValue}togglePayOnline(r){this.payOnline=!this.payOnline,this.payOnline&&(this.deductNextPayout=!1,this.makePayment())}toggleDeductNextPayout(){this.deductNextPayout=!this.deductNextPayout,this.deductNextPayout&&(this.payOnline=!1)}makePayment(){let r=this.AmountToPay;this.razorPayService.payWithRazorpay(r,"order_id_from_backend","INR")}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(Wi),_e(Ko))},s.\u0275cmp=ft({type:s,selectors:[["app-add-credit"]],decls:32,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","32px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"credit-input"],["src","assets/logo/credit12.png"],["type","number","placeholder","Enter number of credits",3,"ngModelChange","input","value","ngModel"],[1,"quickSelect-div"],[1,"maintext"],[1,"selec-div"],["class","maintext",3,"click",4,"ngFor","ngForOf"],[1,"Amount-div"],[1,"selecPayment-div"],[1,"minText"],["type","checkbox",3,"change","checked"],[1,"maintext",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return i.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Add credits"),j()(),V(7,"div",4)(8,"div",5),Me(9,"img",6),V(10,"input",7),Yr("ngModelChange",function(C){return $r(i.selectedValue,C)||(i.selectedValue=C),C}),Oe("input",function(){return i.entredAmount()}),j()(),V(11,"div",8)(12,"span",9),$(13,"Quick select"),j(),V(14,"div",10),Bt(15,PV,2,1,"div",11),j()(),V(16,"div",12)(17,"span",9),$(18,"Amount to pay"),j(),V(19,"p",9),$(20),j()(),V(21,"div",13)(22,"span",9),$(23,"Select payment method"),j(),Me(24,"br")(25,"br"),V(26,"p",14)(27,"input",15),Oe("change",function(C){return i.togglePayOnline(C)}),j(),$(28,"\xA0Pay Online "),j(),V(29,"p",14)(30,"input",15),Oe("change",function(){return i.toggleDeductNextPayout()}),j(),$(31,"\xA0Deduct from next payout "),j()()()()),l&2&&(ue(10),Fe("value",i.selectedValue),qr("ngModel",i.selectedValue),ue(5),Fe("ngForOf",i.credits),ue(5),zi("\u20B9\xA0 ",i.AmountToPay,""),ue(7),Fe("checked",i.payOnline),ue(3),Fe("checked",i.deductNextPayout))},dependencies:[yr,no,ab,dr,Ba],styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.6rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:2rem}.maintext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.minText[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:19.36px}.credit-input[_ngcontent-%COMP%]{height:3rem;width:100%;border:.25px solid black;border-radius:.4rem;display:flex;align-items:center;justify-content:space-around}.credit-input[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1rem;height:1rem}.credit-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80%;height:2.5rem;outline:0;border-width:0;font-size:1.2rem}.quickSelect-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:grid;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]{width:100%;height:max-content;display:flex;flex-wrap:wrap;column-gap:3rem;row-gap:1.5rem}.selec-div[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{border:.25px solid black;width:4.8rem;height:2.5rem;display:flex;border-radius:.5rem;align-items:center;justify-content:center}.Amount-div[_ngcontent-%COMP%]{width:90%;height:4rem;display:flex;align-items:center;text-align:center;padding-left:5%;padding-right:5%;justify-content:space-between;border:.25px solid black;border-radius:.5rem}.minText[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1rem;height:1rem}']});let d=s;return d})();var QD=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r,l){this.location=r,this.userDetails=l,this.bankDetails=[],this.getUserDetails()}getUserDetails(){this.userDetails.getFinancialDetails().subscribe(r=>{console.log(r),this.bankDetails=r},r=>{console.log(r)})}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(vr))},s.\u0275cmp=ft({type:s,selectors:[["app-financial-details"]],decls:61,vars:6,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"gst-div"],[1,"largetext"],[1,"panDetails"],[1,"edit"],[1,"bankdetails"],[1,"normaltext"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return i.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Financial details"),j()(),V(7,"div",4)(8,"div",5)(9,"span",6),$(10,"GST Details"),j(),V(11,"span",6),$(12,"Add+"),j()(),V(13,"div",7)(14,"p")(15,"span",6),$(16,"Aadhar Card details"),j(),V(17,"span",8),$(18,"Edit"),j()(),V(19,"p")(20,"span",6),$(21,"Aadhar "),j(),V(22,"span",6),$(23),j()()(),V(24,"div",7)(25,"p")(26,"span",6),$(27,"PAN Card details"),j(),V(28,"span",8),$(29,"Edit"),j()(),V(30,"p")(31,"span",6),$(32,"PAN "),j(),V(33,"span",6),$(34),j()()(),V(35,"div",9)(36,"p")(37,"span",6),$(38,"Bank account details"),j(),V(39,"span",8),$(40,"Edit"),j()(),V(41,"p")(42,"span",10),$(43,"Account number"),j(),V(44,"span",6),$(45),j()(),V(46,"p")(47,"span",10),$(48,"Bank name"),j(),V(49,"span",6),$(50),j()(),V(51,"p")(52,"span",10),$(53,"IFSC code"),j(),V(54,"span",6),$(55),j()(),V(56,"p")(57,"span",10),$(58,"Name in account"),j(),V(59,"span",6),$(60),j()()()()()),l&2&&(ue(23),Rt(i.bankDetails.aadhaarNumber),ue(11),Rt(i.bankDetails.pan),ue(11),Rt(i.bankDetails.accountNumber),ue(5),Rt(i.bankDetails.bankName),ue(5),Rt(i.bankDetails.ifscCode),ue(5),Rt(i.bankDetails.accountName))},styles:['.container[_ngcontent-%COMP%]{width:93vw;height:100vh;padding:1rem .5rem 0 1rem}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}.sub-container[_ngcontent-%COMP%]{width:97%;position:relative;top:3.5%;display:grid;row-gap:2rem}.gst-div[_ngcontent-%COMP%]{width:90%;height:4rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center;text-align:center;padding:5%;border-radius:.5rem}.panDetails[_ngcontent-%COMP%]{width:90%;height:5rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}p[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;text-align:center}.bankdetails[_ngcontent-%COMP%]{width:90%;height:13rem;border:.25px solid black;display:flex;flex-direction:column;row-gap:1rem;padding:5%;border-radius:.5rem}.largetext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px}.edit[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:500;line-height:19.36px;color:#00000080}.normaltext[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px}']});let d=s;return d})();var KD=(()=>{let s=class s{navToBack(){this.location.back()}navToHelp(){this.router.navigate(["help"])}constructor(r,l,i){this.jobDetailsService=r,this.location=l,this.router=i,this.jobDetailsService.getSelectedJob(),console.log(this.jobDetailsService.getSelectedJob())}ngOnInit(){this.orderDetails=this.jobDetailsService.getSelectedJob()}};s.\u0275fac=function(l){return new(l||s)(_e(Fr),_e(_i),_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-job-details"]],decls:65,vars:11,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","24px",3,"click"],[1,"help",3,"click"],[1,"sub-container"],[1,"name"],[1,"tittle"],[1,"customer-details"],[1,"sub-tittle"],[1,"Details"],[1,"para-section"],[1,"highlight-text"],[1,"line"],[1,"time-div"],[1,"summary"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return i.navToBack()}),$(3,"arrow_back"),j(),V(4,"div",3),Oe("click",function(){return i.navToHelp()}),$(5,"Help?"),j()(),V(6,"div",4)(7,"div",5)(8,"span",6),$(9),j(),V(10,"span"),$(11),j()(),V(12,"div",7)(13,"span",8),$(14,"Customers Details"),j(),V(15,"div",9)(16,"p",10)(17,"span",11),$(18,"Location"),j(),V(19,"span"),$(20),j()(),Me(21,"div",12)(22,"br"),V(23,"div",13)(24,"p",10)(25,"span",11),$(26,"Job start"),j(),V(27,"span"),$(28," 12 Apr 06:30 PM "),j()(),V(29,"p",10)(30,"span",11),$(31,"Job End"),j(),V(32,"span"),$(33,"12 Apr 07:30 PM"),j()()()()(),V(34,"div",14)(35,"span",8),$(36,"Summary"),j(),V(37,"div",9)(38,"div",13)(39,"span",11),$(40),j(),V(41,"span",8),$(42),j()(),Me(43,"div",12)(44,"br"),V(45,"div",13)(46,"p")(47,"span"),$(48,"Others"),j(),Me(49,"br"),V(50,"span",11),$(51,"Convenience Fee"),j()(),V(52,"p",8),$(53,"69"),j()(),Me(54,"div",12)(55,"br"),V(56,"div",13)(57,"p")(58,"span",11),$(59,"Total value"),j(),Me(60,"br"),V(61,"span"),$(62,"commission 5 credits"),j()(),V(63,"p",8),$(64),j()()()()()()),l&2&&(ue(9),Rt(i.orderDetails.orderId.addressId.username),ue(2),Rt(i.orderDetails.orderId.items[0].scheduledDate),ue(9),pk(" ",i.orderDetails.orderId.addressId.address,",",i.orderDetails.orderId.addressId.landmark,", ",i.orderDetails.orderId.addressId.city,", ",i.orderDetails.orderId.addressId.state,", ",i.orderDetails.orderId.addressId.pincode," "),ue(20),gs("",i.orderDetails.orderId.items[0].quantity," \xA0 X \xA0 ",i.orderDetails.orderId.categoryIds[0].name,""),ue(2),zi("\u20B9 \xA0",i.orderDetails.orderId.totalAmount,""),ue(22),Rt(i.orderDetails.orderId.totalAmount))},styles:['.container[_ngcontent-%COMP%]{width:100vw;height:100vh}.arrow[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:space-between;align-items:center}.help[_ngcontent-%COMP%]{width:4rem;height:2.5rem;border:none;background:#20193f;border-radius:1.3rem;color:#fff;display:flex;justify-content:center;align-items:center}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.3rem;font-weight:500;line-height:19.36px;margin-bottom:1rem}.sub-container[_ngcontent-%COMP%]{width:93%;position:relative;top:3.5%;left:3.5%;display:grid;row-gap:1.5rem}.name[_ngcontent-%COMP%]{position:relative;left:5%;display:flex;flex-direction:column}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter"sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;padding:0 0 1rem 1rem;margin-bottom:.5rem}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:600;line-height:16.94px;margin-bottom:.5rem}.customer-details[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;padding:1rem;border:.25px solid black;border-radius:.5rem}.summary[_ngcontent-%COMP%]{padding-top:1rem;display:grid;row-gap:1rem}.line[_ngcontent-%COMP%]{border:0;border-bottom:1px dashed rgb(45,44,44)}.para-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}']});let d=s;return d})();function OV(d,s){if(d&1&&(V(0,"div")(1,"label",6),Me(2,"input",7),j(),$(3," \xA0 "),V(4,"span",3),$(5),j()(),Me(6,"br")),d&2){let u=s.$implicit;ue(),Si("checked",u.checked),ue(),Fe("checked",u.checked),ue(3),Rt(u.name)}}var JD=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r){this.location=r,this.items=[{name:"Contact Details",checked:!0},{name:"Aadhar card",checked:!0},{name:"Bank Details",checked:!0},{name:"Professional documents",checked:!1}]}toggleCheckbox(){}};s.\u0275fac=function(l){return new(l||s)(_e(_i))},s.\u0275cmp=ft({type:s,selectors:[["app-identity-verification"]],decls:13,vars:0,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"para"],[1,"verify-div"],[1,"custom-checkbox"],["type","checkbox","disabled","",3,"checked"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return i.navToBack()}),$(3,"arrow_back"),j(),$(4,"\xA0 "),V(5,"span",3),$(6,"Identity Verification"),j()(),V(7,"div",4)(8,"p"),$(9,"We were to successfully verify your details . As a part of our quality process we will request you to re-verify the information every 5months "),j()(),V(10,"div",5),Or(11,OV,7,4,null,null,Lo),j()()),l&2&&(ue(11),Rr(i.items))},styles:['.container[_ngcontent-%COMP%]{width:92vw;padding:1rem;display:grid;row-gap:2rem}.para[_ngcontent-%COMP%]{background-color:#ef8c534d;width:90%;padding:1rem;border-radius:.5rem;color:#ffa800}input[type=checkbox][_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;width:22px;height:22px;border:.25px solid #000;border-radius:50%;outline:none;cursor:pointer;position:relative}input[type=checkbox][_ngcontent-%COMP%]:before{content:"";width:100%;height:100%;background-color:#fff;display:block;border-radius:50%;transition:background-color .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:before{background-color:green}input[type=checkbox][_ngcontent-%COMP%]:after{content:"";position:absolute;top:3px;left:6px;width:5px;height:9px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);opacity:0;transition:opacity .3s}input[type=checkbox][_ngcontent-%COMP%]:checked:after{opacity:1}input[type=checkbox][disabled][_ngcontent-%COMP%]{cursor:not-allowed;background-color:#f0f0f0}.tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.5rem;font-weight:500;line-height:19.36px}']});let d=s;return d})();var RV=["footer"],LV=d=>({active:d});function FV(d,s){if(d&1){let u=Kt();V(0,"button",13),Oe("click",function(){let l=_t(u).$implicit,i=dt();return bt(i.setActiveButton(l))}),$(1),j()}if(d&2){let u=s.$implicit,r=dt();Fe("ngClass",li(2,LV,r.activeButton===u)),ue(),zi(" ",u," ")}}function zV(d,s){if(d&1){let u=Kt();V(0,"span",20)(1,"a",21)(2,"span",6),$(3," call "),j()(),V(4,"span",22),Oe("click",function(){_t(u);let l=dt().$implicit,i=dt();return bt(i.navToChat(l.userId))}),$(5," chat "),j(),V(6,"span",22),Oe("click",function(){_t(u);let l=dt().$implicit,i=dt();return bt(i.navToArrived(l))}),$(7," directions "),j()()}}function BV(d,s){if(d&1&&(V(0,"div",14)(1,"span",15)(2,"span",16),$(3),j(),Bt(4,zV,8,0,"span",17),j(),V(5,"span",16),$(6),j(),V(7,"span",18),$(8),j(),V(9,"span",19)(10,"span",18),$(11),j(),V(12,"span",16),$(13),j()(),V(14,"span",18),$(15),j()()),d&2){let u=s.$implicit;ue(3),Rt(u.orderId==null||u.orderId.addressId==null?null:u.orderId.addressId.username),ue(),Fe("ngIf",u.status==="Accepted"||u.status==="InProgress"),ue(2),Rt(u.orderId==null||u.orderId.categoryIds[0]==null?null:u.orderId.categoryIds[0].name),ue(2),Rt(u.orderId==null||u.orderId.subCategoryIds[0]==null?null:u.orderId.subCategoryIds[0].name),ue(3),Rt(u.orderId==null||u.orderId.items[0]==null?null:u.orderId.items[0].scheduledDate),ue(2),zi(" \u20B9 ",u.orderId.totalAmount,""),ue(2),mk("",u.orderId.addressId==null?null:u.orderId.addressId.address," ",u.orderId.addressId.city," ",u.orderId.addressId.state," ",u.orderId.addressId.pincode,"")}}var eA=(()=>{let s=class s{constructor(r,l,i,_){this.location=r,this.router=l,this.razorpayService=i,this.orderService=_,this.buttons=["Ongoing","Pending","Completed","Cancelled"],this.activeButton="Ongoing",this.text=this.activeButton,this.filterStatus="InProgress",this.order=[],this.filteredOrder=[],this.getCredits(),this.getOrderDetails()}getCredits(){this.razorpayService.getCredits().subscribe({next:r=>{console.log(r),this.credits=r.credits},error:r=>{console.log(r)}})}navBack(){this.location.back()}getOrderDetails(){this.orderService.orderHistory().subscribe({next:r=>{console.log(r),this.order=r,this.filterOrder()},error:r=>{console.log(r)}})}setActiveButton(r){this.activeButton=r,this.text=r,this.assignOrder()}assignOrder(){switch(this.activeButton){case"Ongoing":this.filterStatus="InProgress";break;case"Pending":this.filterStatus="Accepted";break;case"Completed":this.filterStatus="Completed";break;case"Cancelled":this.filterStatus="Cancelled";break}this.filterOrder()}filterOrder(){console.log(this.order),this.filteredOrder=this.order.filter(r=>r.status&&r.status.toLowerCase()===this.filterStatus.toLowerCase()),console.log(this.filteredOrder)}navTo(r){switch(r){case"credit":this.router.navigate(["credits"]);break;case"notification":this.router.navigate(["notification"]);break;case"menu":this.router.navigate(["menu"]);break}}navToArrived(r){this.activeButton==="Ongoing"?this.router.navigate(["completeWork",r._id]):this.activeButton==="Pending"&&this.router.navigate(["arrived",r._id])}navToChat(r){let l={role:"user",id:r};this.router.navigate(["help/chatbot"],{queryParams:l})}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(Nt),_e(Ko),_e(zr))},s.\u0275cmp=ft({type:s,selectors:[["app-ongoing"]],viewQuery:function(l,i){if(l&1&&bi(RV,5),l&2){let _;fi(_=gi())&&(i.footer=_.first)}},decls:20,vars:3,consts:[[1,"container"],["id","menu-button",3,"click"],[1,"bell-credit"],[1,"credit",3,"click"],["src","assets\\logo\\credit.png"],[1,"bell",3,"click"],[1,"material-symbols-outlined"],[1,"sub-container"],[1,"cat"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"content-container"],["class","content",4,"ngFor","ngForOf"],[2,"height","5rem"],[3,"click","ngClass"],[1,"content"],[1,"icons-div"],[1,"highlight-text"],["class","iconsss",4,"ngIf"],[1,"normal-text"],[1,"service-div"],[1,"iconsss"],["href","'tel:'+ item.orderId.address.mobileNumber"],[1,"material-symbols-outlined",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Oe("click",function(){return i.navTo("menu")}),$(2,"\u2630"),j(),V(3,"div",2)(4,"div",3),Oe("click",function(){return i.navTo("credit")}),Me(5,"img",4),V(6,"pre"),$(7),j()(),V(8,"div",5),Oe("click",function(){return i.navTo("notification")}),V(9,"span",6),$(10,"notifications"),j()()(),V(11,"div",7)(12,"div",8),Bt(13,FV,2,4,"button",9),j(),V(14,"div",10),Me(15,"br"),Bt(16,BV,16,10,"div",11),j(),Me(17,"br"),j()(),Me(18,"div",12)(19,"app-fotter")),l&2&&(ue(7),Rt(i.credits),ue(6),Fe("ngForOf",i.buttons),ue(3),Fe("ngForOf",i.filteredOrder))},dependencies:[So,yr,cr,Qs],styles:['.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:column;width:100vw;height:100%}#menu-button[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;cursor:pointer;z-index:2;color:#d16611;font-size:24px}.bell-credit[_ngcontent-%COMP%]{width:8rem;height:2.5rem;display:flex;justify-content:space-between;position:relative;float:right;right:-28%;top:-6%}.credit[_ngcontent-%COMP%]{width:5rem;border-radius:.4rem;display:flex;justify-content:space-evenly;align-items:center;border:1px solid black}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem}.credit[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.7rem}.bell[_ngcontent-%COMP%]{border-radius:.4rem;border:1px solid black;width:2.3rem;display:flex;justify-content:center;align-items:center}.sub-container[_ngcontent-%COMP%]{width:95%;height:80vh}.cat[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px;border-bottom:2px solid transparent;cursor:pointer}.cat[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%], .cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-bottom:1px solid #D70D09}.cat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:border-bottom .3s}.content-container[_ngcontent-%COMP%]{width:100%;height:92%;overflow-y:auto;scroll-snap-type:y;scrollbar-width:none;display:flex;flex-direction:column;gap:2rem}.content[_ngcontent-%COMP%]{width:85%;height:max-content;display:flex;flex-direction:column;gap:.8rem 5% 0 5%;padding:.8rem 1.2rem;border:.25px solid rgb(127,126,126);border-radius:.5rem}.icons-div[_ngcontent-%COMP%]{width:100%;display:flex;gap:1rem;justify-content:space-between}.iconsss[_ngcontent-%COMP%]{display:flex;gap:1rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:21.94px;text-align:left;color:#000}.normal-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:300;line-height:19.73px;text-align:left;color:#000}']});let d=s;return d})();var NV=["videoPlayer"],VV=["activeVideo"];function jV(d,s){if(d&1){let u=Kt();V(0,"div",10),Oe("click",function(){let l=_t(u).index,i=dt();return bt(i.getVideoUrl(l))}),V(1,"div",11),Oe("click",function(){let l=_t(u).index,i=dt();return bt(i.getVideoUrl(l))}),Me(2,"img",12),j(),Me(3,"br"),j()}}function UV(d,s){if(d&1){let u=Kt();V(0,"div",13),Oe("click",function(){_t(u);let l=dt();return bt(l.stopVideo())}),V(1,"video",14,0),Oe("ended",function(){_t(u);let l=dt();return bt(l.onVideoEnded())})("timeupdate",function(){_t(u);let l=fs(2),i=dt();return bt(i.preventSeek(l))})("loadedmetadata",function(){_t(u);let l=fs(2),i=dt();return bt(i.onVideoLoaded(l))}),j()()}if(d&2){let u=dt();ue(),Fe("src",u.getVideoUrl(u.currentVideoIndex),Hn)}}function HV(d,s){if(d&1){let u=Kt();V(0,"div")(1,"button",15),Oe("click",function(){_t(u);let l=dt();return bt(l.navigateWaiting())}),$(2,"Go to Home"),j()()}}var tA=(()=>{let s=class s{navBack(){}constructor(r,l,i){this.http=r,this.tranningService=l,this.router=i,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1,this.showNavigationButton=!1}ngOnInit(){this.gettingVideos()}gettingVideos(){this.tranningService.gettingInductionVeideos().subscribe(r=>{console.log(r),this.videos=r},r=>{console.log(r)})}playVideo(r){this.pupUp=!0,this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){this.pupUp=!1,this.playNextVideo()}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):(this.isVideoPlaying=!1,alert("Congrats you have completed the traning"),this.navigateWaiting(),this.showNavigationButton=!0)}getVideoUrl(r){return this.pupUp=!0,`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[r].videoKey}`}navigateWaiting(){this.router.navigate(["waiting"])}};s.\u0275fac=function(l){return new(l||s)(_e(Wi),_e(jm),_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-induction"]],viewQuery:function(l,i){if(l&1&&(bi(NV,5),bi(VV,5)),l&2){let _;fi(_=gi())&&(i.videoPlayer=_.first),fi(_=gi())&&(i.activeVideo=_.first)}},decls:15,vars:5,consts:[["activeVideo",""],[1,"tittle-div"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-tittle-div"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"],[3,"click"]],template:function(l,i){l&1&&(V(0,"div",1)(1,"span",2),Oe("click",function(){return i.navBack()}),$(2,"arrow_back"),j(),V(3,"span",3),$(4,"Induction videos"),j()(),V(5,"div",4)(6,"span"),$(7," Complete the Training session!! "),j(),V(8,"span"),$(9," You will be moved to next process "),j()(),V(10,"div",5)(11,"div",6),Bt(12,jV,4,0,"div",7),j()(),Bt(13,UV,3,1,"div",8)(14,HV,3,0,"div",9)),l&2&&(ue(10),Si("blur",i.isVideoPlaying),ue(2),Fe("ngForOf",i.videos),ue(),Fe("ngIf",i.pupUp),ue(),Fe("ngIf",i.showNavigationButton))},dependencies:[yr,cr],styles:['.tittle-div[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin:1rem 0 2rem 1rem}.tittle[_ngcontent-%COMP%]{font-size:1.3rem;font-family:"inter" sans-serif;font-weight:500}.sub-tittle-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem;justify-content:center;text-align:center;margin-bottom:1rem}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:500;color:red}.sub-tittle-div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-family:"inter" sans-serif;font-weight:400;color:#0009}#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}']});let d=s;return d})();var iA=(()=>{let s=class s{constructor(r,l){this.logInService=r,this.router=l}navTo(){console.log(localStorage.getItem("providerId")),localStorage.getItem("providerId")?this.router.navigate(["home"]):this.router.navigate(["selectAccount"])}};s.\u0275fac=function(l){return new(l||s)(_e(Jn),_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-start"]],decls:18,vars:0,consts:[["id","main"],[1,"container"],[1,"logo"],["src","assets/logo/logo png1.png","alt","Coolie No. 1"],[1,"check"],[1,"content"],["src","assets/location/login-home-services-image.png","alt","Worker",1,"worker-image"],[1,"text"],[1,"cta-button",3,"click"],[1,"material-symbols-outlined"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2),Me(3,"img",3),j()(),V(4,"div",4)(5,"div",5),Me(6,"img",6),V(7,"div",7)(8,"span"),$(9,"Home "),V(10,"span"),$(11,"SERVICES"),j()(),V(12,"span"),$(13,"at your Door Step"),j(),V(14,"button",8),Oe("click",function(){return i.navTo()}),$(15,"Let's Go \xA0 "),V(16,"span",9),$(17," arrow_forward "),j()()()()()())},styles:["#main[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100vh;background:radial-gradient(circle at bottom right,#cd2e28 60%,#fff 40%)}.container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;flex:0 0 40%}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80%;max-width:300px;margin-bottom:20px}.content[_ngcontent-%COMP%]{width:100%;position:relative;display:flex;flex-direction:column;align-items:center}.worker-image[_ngcontent-%COMP%]{width:50%;height:50%}.check[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;flex:0 0 60%}.text[_ngcontent-%COMP%]{margin-top:5%;text-align:center;display:flex;flex-direction:column}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Roboto;font-size:1.5rem;color:#fff}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-weight:300;line-height:1.6rem}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1)   span[_ngcontent-%COMP%]{font-weight:500}.text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1.1rem;font-weight:300;line-height:1.4rem}.cta-button[_ngcontent-%COMP%]{background-color:transparent;color:#ffffffde;border:none;padding:22px 30px;font-size:1.5rem;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border-radius:5px}.cta-button[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{margin-left:10px;font-size:24px}"]});let d=s;return d})();function WV(d,s){d&1&&(V(0,"span"),$(1,"\u2192"),j())}function GV(d,s){d&1&&(V(0,"span"),$(1,"\u2714"),j())}function qV(d,s){d&1&&(V(0,"span"),$(1,"\u2192"),j())}function $V(d,s){d&1&&(V(0,"span"),$(1,"\u2714"),j())}var nA=(()=>{let s=class s{constructor(r,l,i){this.loginService=r,this.router=l,this.jobDetailsService=i,this.isExistingActive=!1,this.isNewActive=!1,this.startX=0,this.currentX=0,this.sliderPosition=5,this.isDragging=!1;let _=localStorage.getItem("providerId");this.jobDetailsService.getUserDetails(_)}onTouchStart(r,l){this.startX=r.touches[0].clientX,this.isDragging=!0}onTouchMove(r,l){this.isDragging&&(this.currentX=r.touches[0].clientX-this.startX,this.updateSliderPosition(this.currentX,l))}onTouchEnd(r){this.isDragging=!1,this.checkFinalPosition(r)}onMouseDown(r,l){this.startX=r.clientX,this.isDragging=!0}onMouseMove(r,l){this.isDragging&&(this.currentX=r.clientX-this.startX,this.updateSliderPosition(this.currentX,l))}onMouseUp(r){this.isDragging=!1,this.checkFinalPosition(r)}updateSliderPosition(r,l){if(l==="existing"){let C=Math.min(Math.max(5,5+r),240);this.sliderPosition=C}else if(l==="new"){let C=Math.min(Math.max(5,5+r),240);this.sliderPosition=C}}checkFinalPosition(r){r==="existing"?this.sliderPosition>150&&!this.isExistingActive?(this.isExistingActive=!0,this.sliderPosition=240,this.onToggleChange("existing")):(this.sliderPosition=5,this.isExistingActive=!1):r==="new"&&(this.sliderPosition>150&&!this.isNewActive?(this.isNewActive=!0,this.sliderPosition=240,this.onToggleChange("new")):(this.sliderPosition=5,this.isNewActive=!1))}onToggleChange(r){r==="existing"?(this.loginService.setLogInApi(),this.navigateBasedOnAccount()):r==="new"&&(this.loginService.setSignUpApi(),setTimeout(()=>{this.router.navigate(["log-in"])},1e3))}navigateBasedOnAccount(){localStorage.getItem("providerId")?this.jobDetailsService.userDetails?setTimeout(()=>{this.router.navigate(["home"])},1e3):setTimeout(()=>{this.router.navigate(["aboutUser"])},1e3):setTimeout(()=>{this.router.navigate(["log-in"])},1e3)}};s.\u0275fac=function(l){return new(l||s)(_e(Jn),_e(Nt),_e(Fr))},s.\u0275cmp=ft({type:s,selectors:[["app-select-account"]],decls:23,vars:8,consts:[[1,"container"],[1,"sub-container"],[1,"sp-div"],[1,"img-div"],["src","assets/logo/start2.png","alt","Logo"],[1,"slide-container",3,"touchstart","touchmove","touchend","mousedown","mousemove","mouseup"],[1,"placehlder"],[1,"slider"],[4,"ngIf"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),$(4,"Hey!"),j(),V(5,"span"),$(6,"Join now"),j()(),V(7,"div",3),Me(8,"img",4),j(),V(9,"div",5),Oe("touchstart",function(C){return i.onTouchStart(C,"existing")})("touchmove",function(C){return i.onTouchMove(C,"existing")})("touchend",function(){return i.onTouchEnd("existing")})("mousedown",function(C){return i.onMouseDown(C,"existing")})("mousemove",function(C){return i.onMouseMove(C,"existing")})("mouseup",function(){return i.onMouseUp("existing")}),V(10,"div",6)(11,"span"),$(12,"Existing Provider"),j()(),V(13,"div",7),Bt(14,WV,2,0,"span",8)(15,GV,2,0,"span",8),j()(),V(16,"div",5),Oe("touchstart",function(C){return i.onTouchStart(C,"new")})("touchmove",function(C){return i.onTouchMove(C,"new")})("touchend",function(){return i.onTouchEnd("new")})("mousedown",function(C){return i.onMouseDown(C,"new")})("mousemove",function(C){return i.onMouseMove(C,"new")})("mouseup",function(){return i.onMouseUp("new")}),V(17,"div",6)(18,"span"),$(19,"New Provider"),j()(),V(20,"div",7),Bt(21,qV,2,0,"span",8)(22,$V,2,0,"span",8),j()()()()),l&2&&(ue(13),Si("active",i.isExistingActive),ue(),Fe("ngIf",!i.isExistingActive),ue(),Fe("ngIf",i.isExistingActive),ue(5),Si("active",i.isNewActive),ue(),Fe("ngIf",!i.isNewActive),ue(),Fe("ngIf",i.isNewActive))},dependencies:[cr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;background-color:#f5f5f5}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:400px;display:flex;flex-direction:column;align-items:center;row-gap:1rem}.sp-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:left}span[_ngcontent-%COMP%]{float:left;font-family:Poppins,sans-serif;font-size:24px;font-weight:600;line-height:36px;text-align:left}.img-div[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.img-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.slide-container[_ngcontent-%COMP%]{width:100%;height:50px;background-color:#d16611;border-radius:25px;position:relative;display:flex;align-items:center}.slider[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-size:14px;font-weight:200;position:absolute;left:calc(var(--sliderPosition, 5px));transition:left .3s}.slider.active[_ngcontent-%COMP%]{left:80%}.placehlder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:50px;font-family:"Poppins" sans-serif;font-size:16px;font-weight:400;color:#fff}']});let d=s;return d})();var rA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=ft({type:s,selectors:[["app-congrats"]],decls:14,vars:0,consts:[[1,"main"],[1,"container"],["src","assets/new/congrats.png"],[1,"text"],[1,"arrow-container"],["src","assets/new/round arrow.png"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div"),Me(3,"img",2),j(),Me(4,"br"),V(5,"div",3)(6,"p"),$(7,"congratulations"),j(),V(8,"p"),$(9,"You have completed induction videos"),j(),V(10,"p"),$(11,"you are now. Partner of Coolieno1! You are successfully on boarded."),j()()(),V(12,"div",4),Me(13,"img",5),j()())},styles:['.main[_ngcontent-%COMP%]{width:100%;height:100vh}.container[_ngcontent-%COMP%]{width:100%;display:grid;row-gap:1rem;align-items:center;justify-content:center;text-align:center;position:relative;top:15%}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;height:max-content}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){width:100%;display:flex;align-items:center;justify-content:center}.container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:130px;height:130px}.arrow-container[_ngcontent-%COMP%]{position:fixed;bottom:10%;left:40%;display:flex;align-items:center;justify-content:center}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(1){font-family:"Archivo" sans-serif Black;font-size:1.2rem;font-weight:600;line-height:17.41px;letter-spacing:.04em}.text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:nth-child(2){font-family:"inter" sans-serif;font-size:1.2rem;font-weight:400;line-height:19.36px;letter-spacing:.04em}']});let d=s;return d})();var YV=d=>({"first-package":d,package:!0});function ZV(d,s){d&1&&(V(0,"span"),$(1,"Amount Payable"),j())}function XV(d,s){if(d&1&&(V(0,"div",6),Me(1,"br"),V(2,"div")(3,"p",7)(4,"span"),$(5,"UPGRADE TO"),j(),V(6,"button"),$(7),j()(),V(8,"p",8),Me(9,"img",9),$(10," \xA0"),V(11,"span"),$(12),j()(),V(13,"p",7)(14,"span")(15,"span",10),$(16,"Current"),j(),$(17," \xA0 "),V(18,"span",11),$(19,"lock_open"),j()(),V(20,"span"),$(21),j()(),V(22,"ul")(23,"li"),$(24),j(),V(25,"li"),$(26),j()(),V(27,"p",7),Bt(28,ZV,2,0,"span",12),V(29,"span"),$(30),j()()()()),d&2){let u=s.$implicit,r=dt();Fe("ngClass",li(9,YV,u.packageName==="silver")),ue(7),zi("validity :",u.validity,""),ue(2),Fe("src",u.image,Hn),ue(3),Rt(u.packageName),ue(9),zi("Validity : ",u.validity,""),ue(3),zi("",u.noOfJobOffers," jobs "),ue(2),zi("",u.discountPlatformCom," % discount on platform commision"),ue(2),Fe("ngIf",!r.isEnrolled),ue(2),zi("\u20B9 ",u.priceRs,"")}}var oA=(()=>{let s=class s{navToBack(){this.location.back()}constructor(r,l){this.userDetails=r,this.location=l,this.isEnrolled=!0,this.packages=[],this.getPackage()}getPackage(){this.userDetails.getPackages().subscribe(r=>{console.log(r),this.packages=r},r=>{console.log(r)})}};s.\u0275fac=function(l){return new(l||s)(_e(vr),_e(_i))},s.\u0275cmp=ft({type:s,selectors:[["app-packages"]],decls:8,vars:1,consts:[[1,"container"],[1,"sub-container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"upgrade"],[1,"package-name"],[3,"src"],[1,"Current"],[1,"material-symbols-outlined",2,"font-size","1rem"],[4,"ngIf"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),Oe("click",function(){return i.navToBack()}),$(4,"arrow_back"),j(),V(5,"span",4),$(6,"Packages"),j()(),Bt(7,XV,31,11,"div",5),j()()),l&2&&(ue(7),Fe("ngForOf",i.packages))},dependencies:[So,yr,cr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:2rem}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.package[_ngcontent-%COMP%]{border-radius:.6rem;background-color:#414141}.first-package[_ngcontent-%COMP%]{background:#605c5c}.package[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{position:relative;width:90%;left:5%;top:5%;display:flex;flex-direction:column;gap:.5rem}.upgrade[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.package-name[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center}.package-name[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.package-name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], li[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:16px;font-weight:500;line-height:19.36px;text-align:left;color:#fff}.upgrade[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.Current[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:18px;font-weight:500;line-height:21.78px;text-align:left;color:#fff}.material-symbols-outlined[_ngcontent-%COMP%]{font-variation-settings:"FILL" 0,"wght" 400,"GRAD" 0,"opsz" 20}button[_ngcontent-%COMP%]{background-color:transparent;border:1px solid rgba(212,175,55,1);color:#d4af37;border-radius:.2rem}ul[_ngcontent-%COMP%]{float:left}']});let d=s;return d})();var QV=["videoPlayer"],KV=["activeVideo"];function JV(d,s){if(d&1){let u=Kt();V(0,"div",6),Oe("click",function(){let l=_t(u).index,i=dt();return bt(i.getVideoUrl(l))}),V(1,"div",7),Oe("click",function(){let l=_t(u).index,i=dt();return bt(i.getVideoUrl(l))}),Me(2,"img",8),j(),Me(3,"br"),j()}}function ej(d,s){if(d&1){let u=Kt();V(0,"div",9),Oe("click",function(){_t(u);let l=dt();return bt(l.stopVideo())}),V(1,"video",10,0),Oe("ended",function(){_t(u);let l=dt();return bt(l.onVideoEnded())})("timeupdate",function(){_t(u);let l=fs(2),i=dt();return bt(i.preventSeek(l))})("loadedmetadata",function(){_t(u);let l=fs(2),i=dt();return bt(i.onVideoLoaded(l))}),j()()}if(d&2){let u=dt();ue(),Fe("src",u.getVideoUrl(u.currentVideoIndex),Hn)}}var aA=(()=>{let s=class s{navBack(){this.location.back()}constructor(r,l,i){this.http=r,this.tranningService=l,this.location=i,this.videos=[],this.pupUp=!1,this.bucketName="coolie1-dev",this.region="ap-south-1",this.currentVideoIndex=0,this.lastTime=0,this.isVideoPlaying=!1}ngOnInit(){this.gettingVideos()}gettingVideos(){this.tranningService.getingVideos().subscribe(r=>{console.log(r),this.videos=r},r=>{console.log(r)})}playVideo(r){this.pupUp=!0,console.log(this.pupUp),this.currentVideoIndex=r,this.isVideoPlaying=!0,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())}stopVideo(){this.isVideoPlaying=!1,this.activeVideo&&this.activeVideo.nativeElement&&this.activeVideo.nativeElement.pause()}skipVideo(){this.playNextVideo()}onVideoEnded(){console.log("ended"),this.pupUp=!1}onVideoLoaded(r){r.play()}preventSeek(r){r.currentTime>this.lastTime+1?r.currentTime=this.lastTime:this.lastTime=r.currentTime}playNextVideo(){this.currentVideoIndex<this.videos.length-1?(this.currentVideoIndex++,this.lastTime=0,this.activeVideo&&this.activeVideo.nativeElement&&(this.activeVideo.nativeElement.src=this.getVideoUrl(this.currentVideoIndex),this.activeVideo.nativeElement.play())):this.isVideoPlaying=!1}getVideoUrl(r){return this.pupUp=!0,console.log(this.pupUp),`https://${this.bucketName}.s3.${this.region}.amazonaws.com/${this.videos[r].videoKey}`}};s.\u0275fac=function(l){return new(l||s)(_e(Wi),_e(jm),_e(_i))},s.\u0275cmp=ft({type:s,selectors:[["app-training"]],viewQuery:function(l,i){if(l&1&&(bi(QV,5),bi(KV,5)),l&2){let _;fi(_=gi())&&(i.videoPlayer=_.first),fi(_=gi())&&(i.activeVideo=_.first)}},decls:11,vars:4,consts:[["activeVideo",""],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"container"],[1,"sub-container"],["class","videoss",3,"click",4,"ngFor","ngForOf"],["class","overlay",3,"click",4,"ngIf"],[1,"videoss",3,"click"],[1,"dummy-video",3,"click"],["src","assets/demo/video.png"],[1,"overlay",3,"click"],["controls","","autoplay","","type","video/mp4",1,"active-video",3,"ended","timeupdate","loadedmetadata","src"]],template:function(l,i){l&1&&(Me(0,"br")(1,"br"),$(2,"\xA0\xA0 \xA0"),V(3,"span",1),Oe("click",function(){return i.navBack()}),$(4,"arrow_back"),j(),Me(5,"br")(6,"br"),V(7,"div",2)(8,"div",3),Bt(9,JV,4,0,"div",4),j()(),Bt(10,ej,3,1,"div",5)),l&2&&(ue(7),Si("blur",i.isVideoPlaying),ue(2),Fe("ngForOf",i.videos),ue(),Fe("ngIf",i.pupUp))},dependencies:[yr,cr],styles:["#video[_ngcontent-%COMP%]{width:100%}video[_ngcontent-%COMP%]{width:90%;height:360px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin-top:10px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sub-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:space-around;align-items:center;text-align:center}.blur[_ngcontent-%COMP%]{filter:blur(5px)}video[_ngcontent-%COMP%]{width:300px;height:200px;margin:10px;cursor:pointer}.videoss[_ngcontent-%COMP%]{width:90%;display:grid;row-gap:2rem}.dummy-video[_ngcontent-%COMP%]{width:100%}.dummy-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:fixed;top:0%;width:100%;height:100%;background:#000c;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}.overlay[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.active-video[_ngcontent-%COMP%]{width:640px;height:360px}button[_ngcontent-%COMP%]{margin-top:10px;cursor:pointer}.material-symbols-outlined[_ngcontent-%COMP%]{cursor:pointer}"]});let d=s;return d})();var Eo=(()=>{let s=class s{constructor(r){this.http=r,this.apiUrl=yn}getOrderDetails(r){let l=`${this.apiUrl}users/order-history/${r}`;return this.http.get(l)}getOrderFromOrderId(r){let l=`${this.apiUrl}users/order/order/${r}`;return this.http.get(l)}uploadBeforeWorkImage(r){let l=`${this.apiUrl}users/order-history/before-work-upload-image`;return this.http.post(l,r)}feedBack(r){let l=`${this.apiUrl}users/user-feedback`;return this.http.post(l,r)}};s.\u0275fac=function(l){return new(l||s)(st(Wi))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var rp=md("PushNotifications",{});var tj="firebase",ij="10.12.4";Vk(tj,ij,"app");var Ng=new Yx("ANGULARFIRE2_VERSION");var xy=class{zone;delegate;constructor(s,u=KM){this.zone=s,this.delegate=u}now(){return this.delegate.now()}schedule(s,u,r){let l=this.zone,i=function(_){l.runGuarded(()=>{s.apply(this,[_])})};return this.delegate.schedule(i,u,r)}};var sA=(()=>{class d{ngZone;outsideAngular;insideAngular;constructor(u){this.ngZone=u,this.outsideAngular=u.runOutsideAngular(()=>new xy(Zone.current)),this.insideAngular=u.run(()=>new xy(Zone.current,QM)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||d)(st(Fi))};static \u0275prov=Ut({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})();var rj="firebase",oj="10.12.4";bs.registerVersion(rj,oj,"app-compat");var aj=["ngOnDestroy"],cA=(d,s,u,r={})=>new Proxy(d,{get:(l,i)=>u.runOutsideAngular(()=>{if(d[i])return r?.spy?.get&&r.spy.get(i,d[i]),d[i];if(aj.indexOf(i)>-1)return()=>{};let _=s.toPromise().then(C=>{let I=C?.[i];return typeof I=="function"?I.bind(C):I?.then?I.then(O=>u.run(()=>O)):u.run(()=>I)});return new Proxy(()=>{},{get:(C,I)=>_[I],apply:(C,I,O)=>_.then(N=>{let q=N?.(...O);return r?.spy?.apply&&r.spy.apply(i,O,q),q})})})});var wy=class{constructor(s){return s}},Cy=new pn("angularfire2.app.options"),Sy=new pn("angularfire2.app.name");function mC(d,s,u){let r=typeof u=="string"&&u||"[DEFAULT]",l=typeof u=="object"&&u||{};l.name=l.name||r;let _=bs.apps.filter(C=>C&&C.name===l.name)[0]||s.runOutsideAngular(()=>bs.initializeApp(d,l));try{if(JSON.stringify(d)!==JSON.stringify(_.options)){let C=!!module.hot;sj("error",`${_.name} Firebase App already initialized with different options${C?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new wy(_)}var sj=(d,...s)=>{Zx()&&typeof console<"u"&&console[d](...s)},lj={provide:wy,useFactory:mC,deps:[Cy,Fi,[new Z0,Sy]]},dA=(()=>{class d{static initializeApp(u,r){return{ngModule:d,providers:[{provide:Cy,useValue:u},{provide:Sy,useValue:r}]}}constructor(u){bs.registerVersion("angularfire",Ng.full,"core"),bs.registerVersion("angularfire",Ng.full,"app-compat"),bs.registerVersion("angular",gk.full,u.toString())}static \u0275fac=function(r){return new(r||d)(st(ld))};static \u0275mod=ui({type:d});static \u0275inj=hi({providers:[lj]})}return d})();function hA(d,s,u,r,l){let[,i,_]=globalThis.\u0275AngularfireInstanceCache.find(C=>C[0]===d)||[];if(i)return cj(l,_)||(lA("error",`${s} was already initialized on the ${u} Firebase App with different settings.${dj?" You may need to reload as Firebase is not HMR aware.":""}`),lA("warn",{is:l,was:_})),i;{let C=r();return globalThis.\u0275AngularfireInstanceCache.push([d,C,l]),C}}function cj(d,s){try{return d.toString()===s.toString()}catch{return d===s}}var dj=typeof module<"u"&&!!module.hot,lA=(d,...s)=>{Zx()&&typeof console<"u"&&console[d](...s)};globalThis.\u0275AngularfireInstanceCache||=[];var hj=new pn("angularfire2.messaging.vapid-key"),uj=new pn("angularfire2.messaging.service-worker-registeration"),pC=(()=>{class d{requestPermission;getToken;tokenChanges;messages;requestToken;deleteToken;constructor(u,r,l,i,_,C,I){let O=I,N=br(void 0).pipe(zl(_.outsideAngular),Fl(_.insideAngular),ms(jk),ms(de=>de?import("./chunk-WCJOXY6X.js"):JM),xm(()=>mC(u,i,r)),ms(de=>hA(`${de.name}.messaging`,"AngularFireMessaging",de.name,()=>br(de.messaging()),[])),Ux({bufferSize:1,refCount:!1}));this.requestPermission=N.pipe(zl(_.outsideAngular),Fl(_.insideAngular),ms(()=>Notification.requestPermission())),this.getToken=N.pipe(zl(_.outsideAngular),Fl(_.insideAngular),ms(de=>Rn(this,null,function*(){if(Notification.permission==="granted"){let xe=O?yield O:null;return yield de.getToken({vapidKey:C,serviceWorkerRegistration:xe})}else return null})));let q=new ho(de=>{navigator.permissions.query({name:"notifications"}).then(xe=>{xe.onchange=()=>de.next()})}),ie=N.pipe(zl(_.outsideAngular),Fl(_.insideAngular),Hx(q),Hx(this.getToken));return this.tokenChanges=N.pipe(zl(_.outsideAngular),Fl(_.insideAngular),ms(()=>W0(this.getToken,ie))),this.messages=N.pipe(zl(_.outsideAngular),Fl(_.insideAngular),ms(de=>new ho(xe=>de.onMessage(xe)))),this.requestToken=N.pipe(zl(_.outsideAngular),Fl(_.insideAngular),ms(()=>this.requestPermission),q0(()=>br(null)),ik(()=>this.tokenChanges)),this.deleteToken=()=>N.pipe(zl(_.outsideAngular),Fl(_.insideAngular),ms(de=>de.deleteToken()),rk(!1)),cA(this,N,i)}static \u0275fac=function(r){return new(r||d)(st(Cy),st(Sy,8),st(ld),st(Fi),st(sA),st(hj,8),st(uj,8))};static \u0275prov=Ut({token:d,factory:d.\u0275fac,providedIn:"any"})}return d})(),uA=(()=>{class d{constructor(){bs.registerVersion("angularfire",Ng.full,"fcm-compat")}static \u0275fac=function(r){return new(r||d)};static \u0275mod=ui({type:d});static \u0275inj=hi({providers:[pC]})}return d})();var My=(()=>{let s=class s{constructor(r,l,i,_){this.afMessaging=r,this.http=l,this.router=i,this.location=_,this.apiUrl=yn,this.listenForMessages()}requestPermission(){Bk.isNativePlatform()?rp.requestPermissions().then(r=>{r.receive==="granted"&&(rp.register(),rp.addListener("registration",l=>{console.log("Push registration success, token: "+l.value),this.token=l.value,this.sendTokenToBackend(l.value)}),rp.addListener("pushNotificationReceived",l=>{this.handleInAppNotification(l),console.log("Push received: ",l)}),rp.addListener("pushNotificationActionPerformed",l=>{console.log("Push action performed: ",l),this.handleNotificationClick(l)}))}):this.afMessaging.requestToken.subscribe({next:r=>{console.log("FCM token:",r),this.token=r,this.sendTokenToBackend(r)},error:r=>{console.error("Error getting token",r)}})}listenForMessages(){this.afMessaging.messages.subscribe(r=>{console.log(r);let l=r.notification?.title,i=r.data?.orderId;l==="New Order"&&i?this.router.navigate(["getOrder",i],{replaceUrl:!0}).then(()=>{this.location.replaceState("home")}):console.warn("Order ID missing or title mismatch")},r=>{console.log(r)})}sendTokenToBackend(r){alert(r);let l=this.apiUrl+"providers/provider-token",i={providerId:localStorage.getItem("providerId"),token:r};alert(i.providerId),alert(i.token),this.http.post(l,i).subscribe({next:_=>{console.log(_),alert("token send sucessfully")},error:_=>{console.log(_),alert("error"),alert(_.error.message)}})}handleInAppNotification(r){alert("inapp notification");let l=r.notification?.title||r.title,i=r.notification?.body||r.body,_=r.data;l&&i&&(alert(l),l==="New Order"&&(alert(_.orderId),setTimeout(()=>{this.router.navigate(["getOrder",_.orderId]).then(()=>{this.location.replaceState("home")})},3e3)))}handleNotificationClick(r){let l=r.data,i=r.notification?.title,_=r.notification?.body;alert(l.orderId),l&&l.orderId&&i&&i==="New Order"&&(alert("inside nav"),setTimeout(()=>{this.router.navigate(["getOrder",l.orderId]).then(()=>{this.location.replaceState("home")})},2e3))}};s.\u0275fac=function(l){return new(l||s)(st(pC),st(Wi),st(Nt),st(_i))},s.\u0275prov=Ut({token:s,factory:s.\u0275fac,providedIn:"root"});let d=s;return d})();var pA=(()=>{let s=class s{constructor(r,l,i,_,C,I,O,N,q){this.router=r,this.jobDetailsService=l,this.orderService=i,this.mapboxService=_,this.routerParam=C,this.location=I,this.afterOrderService=O,this.googleMapService=N,this.getOrderService=q,this.timeLeft=120,this.providerCurrentLocationPlace="",this.current=0,this.max=120,this.radius=100,this.color="rgba(255, 0, 0, 1)",this.background="rgba(253, 5, 0, 0.4)",this.cancelRate=0,this.workingHours=0,this.credits=0,this.userAddress="",this.userCoordinates=[0,0],this.orderIds=[],this.orderId="",this.extractedDetails=[],this.serviceName=[{name:"cleaning"},{name:"tank cleaning"},{name:"tankcleaning"}],this.workSeleceted=this.jobDetailsService.workDetails}ngOnInit(){this.getProvderLocation(),this.startTimer(),this.getOrderId()}startTimer(){this.interval=setInterval(()=>{this.timeLeft>0?(this.timeLeft--,this.current=this.timeLeft):(clearInterval(this.interval),this.router.navigate(["home"]))},1e3)}ngOnDestroy(){clearInterval(this.interval)}get minutes(){return Math.floor(this.timeLeft/60)}get seconds(){return this.timeLeft%60}getCartId(r){let l=this.order._id,i=_=>{let C=setInterval(()=>{if(this.acceptStatus)if(clearInterval(C),this.acceptStatus){this.acceptStatus=!1,this.acceptedOrder(),console.log("User accepted, exiting the loop");return}else console.log("User declined, moving to the next item"),this.acceptStatus=!1,i(_+1)},1e3);setTimeout(()=>{this.acceptStatus===null&&(clearInterval(C),console.log("Automatically moving to the next item"),i(_+1))},12e4)};i(0)}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{console.log(r);let l=r.get("id");this.getOrderDetails(l)},error:r=>{console.log(r)}})}getOrderDetails(r){r&&(this.orderId=r,console.log(r),this.afterOrderService.getOrderFromOrderId(r).subscribe({next:l=>{console.log(l),this.order=l,this.getUserLocation()},error:l=>{console.log(l)}}))}accepted(){this.acceptStatus=!0,this.acceptedOrder()}declined(){this.acceptStatus=!1,console.log("declined"),this.acceptStatus=!1,this.timeLeft=120,this.router.navigate(["home"])}acceptedOrder(){console.log("order accepted"),this.orderService.accept(this.orderId,this.order.totalAmount,this.order.userId._id).subscribe(r=>{console.log(r),this.orderService.orderIds=r.orderHistoryId,this.router.navigate(["arrived",r.orderHistory._id])},r=>{console.log(r)})}getProvderLocation(){this.googleMapService.getCoordinates().subscribe({next:r=>{console.log(r),this.providerCurrentLocation=r,this.getPlaceNameFromCorr(this.providerCurrentLocation,"provider")},error:r=>{console.log(r)}})}getUserLocation(){console.log("cing user");let r="user",l=this.order.addressId;console.log(this.order);let i={lat:l.latitude,lng:l.longitude};this.getPlaceNameFromCorr(i,r)}getPlaceNameFromCorr(r,l){this.googleMapService.getPlaceNameFromCoordinates(r.lat,r.lng).pipe(ek(1e4),ok(2),q0(i=>(console.error("Failed to get place name:",i),br({results:[{formatted_address:"Unknown Location"}]})))).subscribe({next:i=>{let _=i.results[0].formatted_address||"Unknown Location";l==="provider"?(this.providerCurrentLocationPlace=_,console.log("Provider location:",_)):l==="user"&&(this.userAddress=_,console.log("User location:",_))},error:i=>{console.error("Error fetching place name:",i)}})}};s.\u0275fac=function(l){return new(l||s)(_e(Nt),_e(Fr),_e(zr),_e(Um),_e(Io),_e(_i),_e(Eo),_e(Zs),_e(My))},s.\u0275cmp=ft({type:s,selectors:[["app-get-order"]],decls:60,vars:16,consts:[[1,"container"],[1,"timer"],[3,"current","max","color","background","radius","rounded","stroke"],[1,"timer-container"],[1,"time"],[1,"location-container"],[1,"material-symbols-outlined",2,"font-size","28px"],[1,"line"],[1,"address"],[1,"location-txt"],[1,"location"],[1,"service-details"],[1,"main-Text"],[1,"value-Text"],[1,"acc-rej-btns"],[3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1),Me(2,"round-progress",2),V(3,"div",3)(4,"p",4)(5,"span"),$(6),j(),V(7,"span"),$(8,"Time left"),j()()()(),V(9,"div",5)(10,"div")(11,"span",6),$(12," location_on "),j(),Me(13,"div",7),V(14,"span",6),$(15," location_on "),j()(),V(16,"div",8)(17,"p")(18,"span",9),$(19,"My location"),j(),V(20,"span",10),$(21),j()(),Me(22,"br")(23,"br"),V(24,"p")(25,"span",9),$(26,"User location"),j(),V(27,"span",10),$(28),j()()()(),V(29,"div",11)(30,"span")(31,"span",12),$(32,"Category Type :"),j(),V(33,"span",13),$(34),j()(),V(35,"span")(36,"span",12),$(37,"SubService Type :"),j(),V(38,"span",13),$(39),j()(),V(40,"span")(41,"span",12),$(42,"Service Name :"),j(),V(43,"span",13),$(44),j()(),V(45,"span")(46,"span",12),$(47,"Price :"),j(),V(48,"span",13),$(49),j()(),V(50,"span")(51,"span",12),$(52,"Schedule :"),j(),V(53,"span",13),$(54),j()()(),V(55,"div",14)(56,"button",15),Oe("click",function(){return i.declined()}),$(57,"Reject"),j(),V(58,"button",15),Oe("click",function(){return i.accepted()}),$(59,"Accept"),j()()()),l&2&&(ue(2),Fe("current",i.current)("max",i.max)("color",i.color)("background",i.background)("radius",i.radius)("rounded",!0)("stroke",10),ue(4),gs("",i.minutes,":",i.seconds<10?"0"+i.seconds:i.seconds,""),ue(15),Rt(i.providerCurrentLocationPlace),ue(7),Rt(i.userAddress),ue(6),Rt(i.order==null||i.order.categoryIds[0]==null?null:i.order.categoryIds[0].name),ue(5),Rt(i.order==null||i.order.subCategoryIds[0]==null?null:i.order.subCategoryIds[0].name),ue(5),Rt(i.order==null||i.order.subCategoryIds[0]==null?null:i.order.subCategoryIds[0].name),ue(5),Rt(i.order==null?null:i.order.totalAmount),ue(5),Rt(i.order==null||i.order.items[0]==null?null:i.order.items[0].scheduledDate))},dependencies:[Lb],styles:[".container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;top:5%;left:2.5%;display:flex;flex-direction:column;gap:2rem}.timer[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.timer-container[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center}.time[_ngcontent-%COMP%]{font-size:2em;text-align:center;display:flex;flex-direction:column;gap:.5rem}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-size:1rem}.location-container[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:10% 80%}.location-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){display:flex;flex-direction:column;align-items:center;justify-content:center}.line[_ngcontent-%COMP%]{width:1px;height:6rem;border-left:.25px dashed black}.address[_ngcontent-%COMP%], .address[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:left}.location-txt[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500}.location[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:.9rem;font-weight:400;color:#b8b8b8}.service-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.main-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:500;color:#5a5a5a80}.value-Text[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-size:1.1rem;font-weight:400;color:#515151}.acc-rej-btns[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-around}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:150px;height:50px;border:none;border-radius:.4rem;font-family:Inter,sans-serif;font-size:1rem;font-weight:500;letter-spacing:1px;color:#fff;text-align:center}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#d70d09}.acc-rej-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:#409000}"]});let d=s;return d})();var pj=["map"],fA=(()=>{let s=class s{constructor(r,l,i,_,C,I,O,N){this.router=r,this.routerParam=l,this.mapboxService=i,this.orderService=_,this.location=C,this.googleMapsService=I,this.dailogeBoxService=O,this.afterOrderService=N,this.toggleChecked=!1,this.distanceThreshold=200,this.orderHistoryId=""}ngOnInit(){this.userFullAddress=this.orderService.userFullAddress,this.getOrderId()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l.orderId,this.getUserLocation()},error:l=>{console.log(l)}}))}getUserLocation(){console.log("cing user");let r="user",l=this.order?.addressId;console.log(this.order);let i={lat:l?.latitude,lng:l?.longitude};this.userCoordinates=i,this.initializeMap()}initializeMap(){this.googleMapsService.getCoordinates().subscribe({next:r=>{if(!r){console.error("Provider coordinates are null");return}if(this.providerCoordinates=r,!this.userCoordinates){console.error("User coordinates are null");return}this.googleMapsService.initializeMap(this.providerCoordinates,this.mapElement.nativeElement),this.googleMapsService.addProviderMarker(this.providerCoordinates),this.googleMapsService.addUserMarker(this.userCoordinates),this.googleMapsService.showDirections(this.userCoordinates,this.providerCoordinates),this.trackProviderAndCheckArrival(),this.getUserFullAddress()},error:r=>{console.error("Error fetching provider coordinates:",r)}})}getUserFullAddress(){let r=this.userCoordinates.lat,l=this.userCoordinates.lng;this.googleMapsService.getPlaceNameFromCoordinates(r,l).subscribe({next:i=>{console.log("user full address",i),console.log(i.results[0].formatted_address),this.userFullAddress=i.results[0].formatted_address}})}trackProviderAndCheckArrival(){this.locationTrackingSubscription=this.googleMapsService.trackProviderLocation().subscribe(r=>{this.providerCoordinates=r,this.googleMapsService.updateProviderMarker(this.providerCoordinates);let l=this.googleMapsService.calculateDistance(this.userCoordinates.lat,this.userCoordinates.lng,this.providerCoordinates.lat,this.providerCoordinates.lng);console.log("Distance between user and provider:",l),this.googleMapsService.showDirections(this.userCoordinates,this.providerCoordinates),l<=this.distanceThreshold&&(this.toggleChecked=!0)})}navTOBack(){this.location.back()}toggleDisplay(r){this.toggleChecked&&(console.log("Arrived at user location"),this.router.navigate(["startWork",this.orderHistoryId])),console.log("Arrived at user location"),this.router.navigate(["startWork",this.orderHistoryId])}handleDisabledClick(){console.log("insideeeeeeee"),this.toggleChecked||this.dailogeBoxService.openDialog("You are not arrives at location.")}cancel(){this.orderService.cancelOrder().subscribe(r=>{console.log(r),this.router.navigate(["home"])},r=>{console.log(r)})}ngOnDestroy(){this.locationTrackingSubscription&&(this.locationTrackingSubscription.unsubscribe(),console.log("Stopped tracking provider\u2019s location."))}};s.\u0275fac=function(l){return new(l||s)(_e(Nt),_e(Io),_e(Um),_e(zr),_e(_i),_e(Zs),_e(Lr),_e(Eo))},s.\u0275cmp=ft({type:s,selectors:[["app-arvied"]],viewQuery:function(l,i){if(l&1&&bi(pj,7),l&2){let _;fi(_=gi())&&(i.mapElement=_.first)}},decls:18,vars:1,consts:[["map",""],[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"arival-status"],[3,"click"],["id","map",2,"height","500px","width","100%"],[1,"location"],[1,"material-symbols-outlined"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"click","change"],["for","toggle",1,"already-label"]],template:function(l,i){if(l&1){let _=Kt();V(0,"section",1)(1,"span",2),Oe("click",function(){return _t(_),bt(i.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",3)(4,"span"),$(5,"On the way "),j(),V(6,"button",4),Oe("click",function(){return _t(_),bt(i.cancel())}),$(7,"Cancel"),j()(),Me(8,"div",5,0),V(10,"div",6)(11,"span",7),$(12," near_me "),j(),V(13,"span"),$(14),j()(),V(15,"div",8)(16,"input",9),Oe("click",function(){return _t(_),bt(i.handleDisabledClick())})("change",function(I){return _t(_),bt(i.toggleDisplay(I))}),j(),Me(17,"label",10),j()()}l&2&&(ue(14),zi(" ",i.userFullAddress," "))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;top:2.5%;display:flex;flex-direction:column;gap:2rem}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}.arival-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:6rem;height:2.5rem;color:#fff;background-color:transparent;border:.25px solid #ffff;font-family:"Poppins" sans-serif;font-size:1.1rem;font-weight:500;border-radius:.4rem;margin-right:1rem}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:46px;left:2%;bottom:5%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Arrived";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let d=s;return d})();var fj=["map"],gA=(()=>{let s=class s{constructor(r,l,i,_,C,I){this.router=r,this.routerParam=l,this.orderService=i,this.googleMapsService=_,this.location=C,this.afterOrderService=I,this.toggleChecked=!1,this.orderHistoryId=""}ngAfterViewInit(){this.getOrderId()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l.orderId,this.getUserLocationCoordinates()},error:l=>{console.log(l)}}))}initializeMap(r){return Rn(this,null,function*(){let l=r;this.getUserFullAddress(l),this.locationTrackingSubscription=this.googleMapsService.getCoordinates().subscribe(i=>{if(!i){console.error("Provider coordinates are null");return}this.googleMapsService.initializeMap(i,this.mapElement.nativeElement),this.googleMapsService.addProviderMarker(i),this.googleMapsService.addUserMarker(l),this.googleMapsService.showDirections(i,l)})})}getUserLocationCoordinates(){return Rn(this,null,function*(){console.log("inside user location");let r=this.order?.addressId;if(r){let l={lat:r.latitude,lng:r.longitude};return console.log("user coordinates",l),this.initializeMap(l),l}else{let l={lat:0,lng:0};return this.initializeMap(l),l}})}getUserFullAddress(r){let l=r.lat,i=r.lng;this.googleMapsService.getPlaceNameFromCoordinates(l,i).subscribe({next:_=>{console.log("user full address",_),console.log(_.results[0].formatted_address),this.userFullAddress=_.results[0].formatted_address}})}navTOBack(){this.location.back()}toggleDisplay(r){this.toggleChecked=!this.toggleChecked,this.router.navigate(["work/otp",this.orderHistoryId])}navToChat(){let r={role:"user",id:this.order.userId};this.router.navigate(["help/chatbot"],{queryParams:r})}ngOnDestroy(){this.locationTrackingSubscription&&(this.locationTrackingSubscription.unsubscribe(),console.log("Stopped tracking provider\u2019s location."))}};s.\u0275fac=function(l){return new(l||s)(_e(Nt),_e(Io),_e(zr),_e(Zs),_e(_i),_e(Eo))},s.\u0275cmp=ft({type:s,selectors:[["app-start-work"]],viewQuery:function(l,i){if(l&1&&bi(fj,5),l&2){let _;fi(_=gi())&&(i.mapElement=_.first)}},decls:21,vars:1,consts:[["map",""],[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"arival-status"],[1,"material-symbols-outlined",2,"font-size","24px","margin-right","1.5rem"],[1,"material-symbols-outlined",2,"font-size","24px","margin-right","1.5rem",3,"click"],["id","map",2,"height","500px","width","100%"],[1,"location"],[1,"material-symbols-outlined"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"change"],["for","toggle",1,"already-label"]],template:function(l,i){if(l&1){let _=Kt();V(0,"section",1)(1,"span",2),Oe("click",function(){return _t(_),bt(i.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",3)(4,"span"),$(5,"Reached customer location"),j(),V(6,"div")(7,"span",4),$(8,"call"),j(),V(9,"span",5),Oe("click",function(){return _t(_),bt(i.navToChat())}),$(10,"forum"),j()()(),Me(11,"div",6,0),V(13,"div",7)(14,"span",8),$(15,"near_me"),j(),V(16,"span"),$(17),j()(),V(18,"div",9)(19,"input",10),Oe("change",function(I){return _t(_),bt(i.toggleDisplay(I))}),j(),Me(20,"label",11),j()()}l&2&&(ue(17),Rt(i.userFullAddress))},styles:['.container[_ngcontent-%COMP%]{width:95%;height:100%;position:relative;left:2.5%;display:flex;flex-direction:column;gap:2rem;margin-top:2.5%}.arival-status[_ngcontent-%COMP%]{width:100%;height:5rem;display:flex;justify-content:space-between;border-radius:.5rem;align-items:center;background-color:#d70d09}.arival-status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.arival-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Poppins" sans-serif;margin-left:1.5rem;font-size:1.1rem;font-weight:500;line-height:24px;text-align:left;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:20rem}.map[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.location[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:20% 80%}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){display:flex;justify-content:center;align-items:center}.location[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){font-family:"Poppins" sans-serif;font-size:14px;font-weight:400;line-height:25px;letter-spacing:.05em;text-align:left}.slide-toggle[_ngcontent-%COMP%]{position:fixed;width:95%;height:60px;left:2%;bottom:5%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Arrived";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#409000;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:10px;left:15px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;content:"Start working";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:14px;pointer-events:none}']});let d=s;return d})();var gj=["input1"],_j=["input2"],bj=["input3"],yj=["input4"],_A=(()=>{let s=class s{navTOBack(){this.location.back()}constructor(r,l,i,_,C,I,O){this.form=r,this.orderService=l,this.routerParam=i,this.afterOrderService=_,this.router=C,this.dialougeBOxService=I,this.location=O,this.orderHistoryId=""}ngOnInit(){this.getOrderId(),this.getOtp(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,l){if(r.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l},error:l=>{console.log(l)}}))}getOtp(){}verifyOtp(){let r=this.otp.value,l=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(l);let i={orderHistoryId:this.orderHistoryId,uniqueNumber:l,userId:this.order.userId};console.log(i),this.orderService.verifyStartOrder(i).subscribe({next:_=>{console.log(_),this.dialougeBOxService.openDialog("OTP verified sucessfully"),this.router.navigate(["workImage",this.orderHistoryId])},error:_=>{console.log(_),this.dialougeBOxService.openDialog(_.error.message)}})}};s.\u0275fac=function(l){return new(l||s)(_e(Zo),_e(zr),_e(Io),_e(Eo),_e(Nt),_e(Lr),_e(_i))},s.\u0275cmp=ft({type:s,selectors:[["app-work-otp"]],viewQuery:function(l,i){if(l&1&&(bi(gj,5),bi(_j,5),bi(bj,5),bi(yj,5)),l&2){let _;fi(_=gi())&&(i.input1=_.first),fi(_=gi())&&(i.input2=_.first),fi(_=gi())&&(i.input3=_.first),fi(_=gi())&&(i.input4=_.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){if(l&1){let _=Kt();V(0,"div",4)(1,"span",5),Oe("click",function(){return _t(_),bt(i.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),Me(5,"img",8),j(),V(6,"span")(7,"span",9),$(8,"Before start the work"),j(),Me(9,"br"),V(10,"span",10),$(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Oe("input",function(I){return _t(_),bt(i.onInput(I,1))}),j(),V(16,"input",14,1),Oe("input",function(I){return _t(_),bt(i.onInput(I,2))}),j(),V(18,"input",15,2),Oe("input",function(I){return _t(_),bt(i.onInput(I,3))}),j(),V(20,"input",16,3),Oe("input",function(I){return _t(_),bt(i.onInput(I,4))}),j()(),V(22,"button",17),Oe("click",function(){return _t(_),bt(i.verifyOtp())}),$(23,"Confirm"),j()()()()}l&2&&(ue(12),Fe("formGroup",i.otp))},dependencies:[ko,no,dr,Mo,km,Yo,Na],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;margin-top:2.5%}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;margin-left:5%}"]});let d=s;return d})();var bA=(()=>{let s=class s{constructor(r,l,i,_,C){this.orderService=r,this.router=l,this.location=i,this.routerParam=_,this.afterOrderService=C,this.total=0,this.orderHistoryId="",this.work={},this.alreadyHasAccount=!1}ngOnInit(){this.getOrderId()}navTOBack(){this.location.back()}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{let l=r.get("id");l&&(this.orderHistoryId=l,this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{console.log(l),this.order=l,this.work=this.order,console.log("work",this.work)},error:l=>{console.log(l)}})}toggleDisplay(){let r=this.work.userId;this.orderService.completeOrder(this.orderHistoryId,r).subscribe(l=>{console.log(l),this.router.navigate(["verifyAfterWork",this.orderHistoryId],{replaceUrl:!0}).then(()=>{this.location.replaceState("home")})},l=>{console.log(l)})}};s.\u0275fac=function(l){return new(l||s)(_e(zr),_e(Nt),_e(_i),_e(Io),_e(Eo))},s.\u0275cmp=ft({type:s,selectors:[["app-work-complete"]],decls:36,vars:6,consts:[[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"image"],["src","assets/new/Man washing hand.png"],[1,"details"],[1,"details-div"],[1,"about"],[1,"highlight-text"],[1,"sub-title"],[1,"line"],[1,"time-div"],[1,"slide-toggle"],["type","checkbox","id","toggle",3,"ngModelChange","change","ngModel"],["for","toggle",1,"already-label"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"span",1),Oe("click",function(){return i.navTOBack()}),$(2," arrow_back "),j(),V(3,"div",2),Me(4,"img",3),j(),V(5,"section",4)(6,"div",5)(7,"span",6)(8,"span",7),$(9),j()(),V(10,"span",8),$(11),j(),Me(12,"div",9),j(),V(13,"div",10)(14,"p")(15,"span"),$(16,"Others"),j(),Me(17,"br"),V(18,"span",7),$(19,"Convenience Fee"),j()(),V(20,"p",7),$(21,"69"),j()(),Me(22,"div",9)(23,"br"),V(24,"div",10)(25,"p")(26,"span",7),$(27,"Total value"),j(),Me(28,"br"),V(29,"span"),$(30,"commission credits"),j()(),V(31,"p",7),$(32),j()()(),V(33,"div",11)(34,"input",12),Yr("ngModelChange",function(C){return $r(i.alreadyHasAccount,C)||(i.alreadyHasAccount=C),C}),Oe("change",function(){return i.toggleDisplay()}),j(),Me(35,"label",13),j()()),l&2&&(ue(9),gs("",i.work==null||i.work.orderId==null||i.work.orderId.items[0]==null?null:i.work.orderId.items[0].quantity," X ",i.work==null||i.work.orderId==null||i.work.orderId.categoryIds[0]==null?null:i.work.orderId.categoryIds[0].name,""),ue(2),gs("",i.work==null||i.work.orderId==null||i.work.orderId.items[0]==null?null:i.work.orderId.items[0].quantity," X ",i.work==null||i.work.orderId==null||i.work.orderId.subCategoryIds[0]==null?null:i.work.orderId.subCategoryIds[0].name,""),ue(21),Rt(i.work==null||i.work.orderId==null?null:i.work.orderId.totalAmount),ue(2),qr("ngModel",i.alreadyHasAccount))},dependencies:[hd,dr,Ba],styles:['.container[_ngcontent-%COMP%]{width:95vw;height:100%;display:flex;flex-direction:column;gap:1rem;position:relative;left:2.5%;right:2.5%;top:2.5%}.image[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.details[_ngcontent-%COMP%], .details-div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem}.about[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.slide-toggle[_ngcontent-%COMP%]{position:relative;width:95%;height:46px;left:2%}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{content:"Placeholder Text";position:absolute;top:0;left:0rem;width:100%;height:100%;background-color:#bb0e0e;border-radius:1.5rem;cursor:pointer;transition:background-color .3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{background-color:green}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{float:left;content:"";position:absolute;top:2px;left:2px;width:40px;height:40px;background-color:#fff;background-image:url("./media/arrow-FITP57Z3.png");background-repeat:no-repeat;background-position:center;border-radius:50%;transition:.3s}.slide-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 48px)}.slide-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:before{font-family:Poppins;font-size:1.5rem;font-weight:500;line-height:22.82px;text-align:left;color:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-size:14px;pointer-events:none}.slide-toggle[_ngcontent-%COMP%]   label.already-label[_ngcontent-%COMP%]:before{content:"Swipe to Complete";color:#fff;font-family:Poppins;font-size:1.1rem;font-weight:500;line-height:22.82px;text-align:left}.time-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.Details[_ngcontent-%COMP%]{width:90%;border:.25px solid black;border-radius:.5rem}.line[_ngcontent-%COMP%]{width:100%;height:0;border:0;border-bottom:1px dashed rgb(45,44,44)}.sub-tittle[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:.9rem;font-weight:400;line-height:14.52px;text-align:left}.highlight-text[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1.1rem;font-weight:600;line-height:16.94px;text-align:left}']});let d=s;return d})();var vj=["input1"],xj=["input2"],wj=["input3"],Cj=["input4"],yA=(()=>{let s=class s{navTOBack(){this.location.back()}constructor(r,l,i,_,C,I){this.form=r,this.orderService=l,this.router=i,this.afterOrderService=_,this.routerParam=C,this.location=I,this.orderHistoryId="",this.getOrderId(),this.otp=this.form.group({inputOne:"",inputTwo:"",inputThree:"",inputFour:""})}onInput(r,l){if(r.target.value.length===1)switch(l){case 1:this.input2.nativeElement.focus();break;case 2:this.input3.nativeElement.focus();break;case 3:this.input4.nativeElement.focus();break;case 4:break;default:break}}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{let l=r.get("id");l&&(this.orderHistoryId=l,this.getOrderDetails(l))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{this.order=l},error:l=>{console.error(l)}}))}login(){let r=this.otp.value,l=r.inputOne+r.inputTwo+r.inputThree+r.inputFour;console.log(l),this.orderService.verifyAfterComplete(l,this.orderHistoryId).subscribe(i=>{console.log(i);let _={userId:this.order.userId,orderHistoryId:this.orderHistoryId};this.router.navigate(["feedback"],{queryParams:_})},i=>{console.log(i)})}};s.\u0275fac=function(l){return new(l||s)(_e(Zo),_e(zr),_e(Nt),_e(Eo),_e(Io),_e(_i))},s.\u0275cmp=ft({type:s,selectors:[["app-verify-after-work"]],viewQuery:function(l,i){if(l&1&&(bi(vj,5),bi(xj,5),bi(wj,5),bi(Cj,5)),l&2){let _;fi(_=gi())&&(i.input1=_.first),fi(_=gi())&&(i.input2=_.first),fi(_=gi())&&(i.input3=_.first),fi(_=gi())&&(i.input4=_.first)}},decls:24,vars:1,consts:[["input1",""],["input2",""],["input3",""],["input4",""],[1,"container"],[1,"material-symbols-outlined",3,"click"],[1,"sub-container"],[1,"image-div"],["src","assets/demo/Stylist doing haircut.png"],[1,"info-text"],[1,"numberss"],[3,"formGroup"],[1,"input-div"],["type","text","maxlength","1","formControlName","inputOne",3,"input"],["type","text","maxlength","1","formControlName","inputTwo",3,"input"],["type","text","maxlength","1","formControlName","inputThree",3,"input"],["type","text","maxlength","1","formControlName","inputFour",3,"input"],["type","submit",1,"login-btn",3,"click"]],template:function(l,i){if(l&1){let _=Kt();V(0,"div",4)(1,"span",5),Oe("click",function(){return _t(_),bt(i.navTOBack())}),$(2," arrow_back "),j(),V(3,"div",6)(4,"div",7),Me(5,"img",8),j(),V(6,"span")(7,"span",9),$(8,"Before start the work"),j(),Me(9,"br"),V(10,"span",10),$(11,"Enter OTP from user"),j()(),V(12,"form",11)(13,"div",12)(14,"input",13,0),Oe("input",function(I){return _t(_),bt(i.onInput(I,1))}),j(),V(16,"input",14,1),Oe("input",function(I){return _t(_),bt(i.onInput(I,2))}),j(),V(18,"input",15,2),Oe("input",function(I){return _t(_),bt(i.onInput(I,3))}),j(),V(20,"input",16,3),Oe("input",function(I){return _t(_),bt(i.onInput(I,4))}),j()(),V(22,"button",17),Oe("click",function(){return _t(_),bt(i.login())}),$(23,"Confirm"),j()()()()}l&2&&(ue(12),Fe("formGroup",i.otp))},dependencies:[ko,no,dr,Mo,km,Yo,Na],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;margin-top:2.5%;align-items:center}.material-symbols-outlined[_ngcontent-%COMP%]{width:max-content;margin-left:2.5%}.sub-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;text-align:center}.image-div[_ngcontent-%COMP%]{width:100%;height:25rem}.image-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.tittle[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-size:2rem;font-weight:500;line-height:42px;color:#414141}.info-text[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1rem;font-weight:400;line-height:42px;margin:0;color:#414141}.numberss[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.5rem;font-weight:600;line-height:42px;margin:0}.input-div[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.input-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;width:4rem;height:4rem;border:none;border-radius:.4rem;outline:0;border-width:0 0 0 0;box-shadow:1px 1px 0 1.5px #807e7e80;font-size:3rem;align-items:center}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:Roboto,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#cd2e28;margin-left:5%}"]});let d=s;return d})();function Sj(d,s){if(d&1){let u=Kt();V(0,"div",4)(1,"div",6),Me(2,"img",7),$(3),j(),V(4,"div")(5,"input",8),Yr("ngModelChange",function(l){let i=_t(u).$implicit;return $r(i.checked,l)||(i.checked=l),bt(l)}),Oe("change",function(l){let i=_t(u).$implicit,_=dt();return bt(_.onChange(l,i))}),j()()()}if(d&2){let u=s.$implicit;ue(2),Fe("src",u.imageKey,Hn),ue(),Rt(u.name),ue(2),qr("ngModel",u.checked)}}var vA=(()=>{let s=class s{constructor(r,l,i,_){this.loginService=r,this.logInService=l,this.router=i,this.userDetailsService=_,this.workSeleceted=[],this.items=[]}ngOnInit(){this.getSubServices()}getSubServices(){this.loginService.getSubCategory().subscribe(r=>{console.log(r),this.items=r,this.getWork()},r=>{console.log(r)})}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe(r=>{console.log(r),this.workSeleceted=r.works,this.autoCheckServices()},r=>{console.log(r)})}autoCheckServices(){this.workSeleceted.forEach(r=>{let l=this.items.filter(i=>i.categoryId===r.categoryId._id);l.length>0&&r.subcategoryId.forEach(i=>{l.forEach(_=>{_._id===i._id&&(_.checked=!0,console.log(`Checked subcategory: ${_.name}`))})})})}send(){this.logInService.selectedSubCategories.length>0?this.router.navigate(["aboutWork"]):alert("Please select atleat one sub-category ")}onChange(r,l){let i=r.target;if(console.log(l),i&&i.checked){let C=this.items.indexOf(l);console.log("categoryId",l._),this.logInService.setSubCat(l._id)}}};s.\u0275fac=function(l){return new(l||s)(_e(Jn),_e(Jn),_e(Nt),_e(vr))},s.\u0275cmp=ft({type:s,selectors:[["app-sub-services"]],decls:10,vars:0,consts:[[1,"container"],[1,"sub-container"],[1,"tittle"],[1,"serivce"],[1,"service-div"],["type","submit",1,"login-btn",3,"click"],[1,"names"],[3,"src"],["type","checkbox",1,"checkbox",3,"ngModelChange","change","ngModel"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),$(3,"Select Sub-Services"),j(),Me(4,"br"),V(5,"div",3),Or(6,Sj,6,3,"div",4,Lo),j()(),V(8,"button",5),Oe("click",function(){return i.send()}),$(9,"Continue"),j()()),l&2&&(ue(6),Rr(i.items))},dependencies:[hd,dr,Ba],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh;align-items:center;text-align:center}.sub-container[_ngcontent-%COMP%]{width:90%;height:87vh;position:relative;top:5%;left:5%;align-items:center;display:grid;grid-gap:.5rem}.tittle[_ngcontent-%COMP%]{font-family:inter,sans-serif;font-size:1.4rem;font-weight:500;line-height:24px}.material-symbols-outlined[_ngcontent-%COMP%]{margin-top:1rem;margin-left:1rem;font-size:28px}.search-input[_ngcontent-%COMP%]{padding-left:3.5rem}.serivce[_ngcontent-%COMP%]{height:78vh;overflow-y:auto;scroll-behavior:smooth;scrollbar-width:none;display:flex;flex-direction:column;gap:.5rem}.service-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.names[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-size:1rem;font-family:"inter" sans-serif;font-weight:400;line-height:16.3px}.names[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:2rem;height:2rem}.checkbox[_ngcontent-%COMP%]{width:1rem;height:1rem;border:1px solid red;border-radius:50%}.login-btn[_ngcontent-%COMP%]{height:3.4rem;width:90%;font-size:1.5rem;font-family:inter,sans-serif;font-weight:500;color:#fff;border-radius:4rem;border:none;background-color:#d16611;position:fixed;top:92%;left:5%}']});let d=s;return d})();var xA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=ft({type:s,selectors:[["app-not-found"]],decls:11,vars:0,consts:[[1,"container"],[1,"material-symbols-outlined"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"span",1),$(2," wifi_off "),j(),V(3,"span"),$(4,"You're offline"),j(),V(5,"span"),$(6,"Please connect to internet and try again"),j(),V(7,"button")(8,"span",1),$(9," refresh "),j(),$(10," Retry "),j()())},styles:[".container[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}.material-symbols-outlined[_ngcontent-%COMP%]{font-weight:300}"]});let d=s;return d})();var wA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275cmp=ft({type:s,selectors:[["app-location"]],decls:2,vars:0,template:function(l,i){l&1&&(V(0,"p"),$(1,"location works!"),j())}});let d=s;return d})();function Mj(d,s){if(d&1){let u=Kt();V(0,"li"),$(1),V(2,"span",11),Oe("click",function(){let l=_t(u).$implicit,i=dt(2).$implicit,_=dt();return bt(_.removeSubcategory(i._id,l._id))}),$(3," delete "),j()()}if(d&2){let u=s.$implicit;ue(),zi(" ",u.name," ")}}function kj(d,s){if(d&1&&(V(0,"div")(1,"ul"),Bt(2,Mj,4,1,"li",10),j()()),d&2){let u=dt().$implicit;ue(2),Fe("ngForOf",u.subcategoryId)}}function Ij(d,s){d&1&&(V(0,"p"),$(1,"No subcategories available"),j())}function Tj(d,s){if(d&1&&(V(0,"div",8)(1,"h3"),$(2),j(),Bt(3,kj,3,1,"div",9)(4,Ij,2,0,"p",9),V(5,"p"),$(6),j()()),d&2){let u=s.$implicit;ue(2),Rt(u.categoryId.name),ue(),Fe("ngIf",u.subcategoryId.length>0),ue(),Fe("ngIf",u.subcategoryId.length===0),ue(2),zi("Experience: ",u.experience,"")}}var CA=(()=>{let s=class s{constructor(r,l,i){this.location=r,this.userDetailsService=l,this.router=i,this.works=[]}ngOnInit(){this.getWork()}getWork(){this.userDetailsService.getWork(localStorage.getItem("providerId")).subscribe({next:r=>{console.log(r),this.works=r.works},error:r=>{console.log(r)}})}removeSubcategory(r,l){console.log(r,"subCat",l),this.userDetailsService.deleteWork(r,l).subscribe({next:i=>{console.log(i),this.getWork()},error:i=>{console.log(i)}})}navToSelectWork(){this.router.navigate(["selectWork"])}navToBack(){console.log("back"),this.location.back()}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(vr),_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-manage-services"]],decls:14,vars:1,consts:[[1,"container"],[1,"arrow"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"tittle"],[1,"sub-container"],[1,"new-address",3,"click"],[1,"material-symbols-outlined","notranslate"],["class","work-div",4,"ngFor","ngForOf"],[1,"work-div"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"material-icons",3,"click"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"div",1)(2,"span",2),Oe("click",function(){return i.navToBack()}),$(3,"arrow_back"),j(),V(4,"span",3),$(5,"Manage Services"),j()(),V(6,"div",4)(7,"div",5),Oe("click",function(){return i.navToSelectWork()}),V(8,"div")(9,"span",6),$(10," add "),j(),V(11,"span"),$(12,"Add new Services"),j()()(),Bt(13,Tj,7,4,"div",7),j()()),l&2&&(ue(13),Fe("ngForOf",i.works))},dependencies:[yr,cr],styles:['.container[_ngcontent-%COMP%]{width:100%;height:100vh}.sub-container[_ngcontent-%COMP%]{width:90%;max-width:670px;position:relative;top:2%;left:5%;display:flex;flex-direction:column;gap:1rem}.new-address[_ngcontent-%COMP%]{width:100%;height:2.5rem;border-radius:.6rem;border:.25px solid black;display:flex;justify-content:space-between;align-items:center}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:60%;display:flex;align-items:center;gap:.5rem;padding-left:.5rem}.new-address[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:"Inter" sans-serif;font-size:1rem;font-weight:400;line-height:16.94px;color:#f9a600}.arrow[_ngcontent-%COMP%]{width:100%;display:flex;text-align:center;margin:1rem 0 0 1rem}.tittle[_ngcontent-%COMP%]{width:80%;font-family:"Inter" sans-serif;font-size:22px;font-weight:500;line-height:26.63px;text-align:center}.work-div[_ngcontent-%COMP%]{margin-bottom:20px;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:2px 2px 10px #0000001a}h3[_ngcontent-%COMP%]{margin:0;color:#2c3e50}ul[_ngcontent-%COMP%]{list-style:none;padding:0}li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:5px 0;padding:5px;border:1px solid #ddd;border-radius:4px;background-color:#f9f9f9}p[_ngcontent-%COMP%]{color:#7f8c8d;font-size:14px;margin:5px 0}.material-icons[_ngcontent-%COMP%]{cursor:pointer;color:#e74c3c;font-size:24px;transition:color .2s ease}.material-icons[_ngcontent-%COMP%]:hover{color:#c0392b}p[ngIf][_ngcontent-%COMP%]{color:#95a5a6;font-style:italic}']});let d=s;return d})();var SA=(()=>{let s=class s{constructor(r,l,i,_,C){this.location=r,this.routerParam=l,this.afterOrderService=i,this.dailougeBoxService=_,this.router=C,this.rating=0,this.userFeedback="",this.userId="",this.orderHistoryId="",this.getUser()}getUser(){this.routerParam.queryParams.subscribe({next:r=>{this.userId=r.userId,this.orderHistoryId=r.orderHistoryId}})}rate(r){this.rating=r}submitFeedback(){if(this.rating===0){alert("Please provide a rating before submitting.");return}if(this.userFeedback.trim()===""){alert("Please provide your feedback before submitting.");return}console.log("Rating:",this.rating),console.log("Feedback:",this.userFeedback);let r={userId:this.userId,providerId:localStorage.getItem("providerId"),orderHistoryId:this.orderHistoryId,rating:this.rating};console.log(r),this.afterOrderService.feedBack(r).subscribe({next:l=>{console.log(l),this.dailougeBoxService.openDialog("feedback send sucessfully"),this.router.navigate(["home"])},error:l=>{console.log(l)}}),this.rating=0,this.userFeedback=""}navToBack(){this.location.back()}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(Io),_e(Eo),_e(Lr),_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-feedback"]],decls:21,vars:11,consts:[[1,"feedback-container"],[1,"material-symbols-outlined",2,"font-size","28px",3,"click"],[1,"star-div"],[1,"star-rating"],[1,"star",3,"click"],[1,"feedback-text"],["placeholder","Write your feedback here...","rows","5",3,"ngModelChange","ngModel"],[1,"submit-btn",3,"click"]],template:function(l,i){l&1&&(V(0,"section",0)(1,"span",1),Oe("click",function(){return i.navToBack()}),$(2,"arrow_back"),j(),V(3,"div",2)(4,"h2"),$(5,"Give Your Feedback"),j(),V(6,"div",3)(7,"span",4),Oe("click",function(){return i.rate(1)}),$(8,"\u2605"),j(),V(9,"span",4),Oe("click",function(){return i.rate(2)}),$(10,"\u2605"),j(),V(11,"span",4),Oe("click",function(){return i.rate(3)}),$(12,"\u2605"),j(),V(13,"span",4),Oe("click",function(){return i.rate(4)}),$(14,"\u2605"),j(),V(15,"span",4),Oe("click",function(){return i.rate(5)}),$(16,"\u2605"),j()(),V(17,"div",5)(18,"textarea",6),Yr("ngModelChange",function(C){return $r(i.userFeedback,C)||(i.userFeedback=C),C}),j()(),V(19,"button",7),Oe("click",function(){return i.submitFeedback()}),$(20,"Submit Feedback"),j()()()),l&2&&(ue(7),Si("filled",i.rating>=1),ue(2),Si("filled",i.rating>=2),ue(2),Si("filled",i.rating>=3),ue(2),Si("filled",i.rating>=4),ue(2),Si("filled",i.rating>=5),ue(3),qr("ngModel",i.userFeedback))},dependencies:[no,dr,Ba],styles:[".feedback-container[_ngcontent-%COMP%]{width:90%;max-width:500px;margin:1rem 5% 0;font-family:Arial,sans-serif}.star-div[_ngcontent-%COMP%]{text-align:center;display:flex;flex-direction:column;justify-content:center;align-items:center}h2[_ngcontent-%COMP%]{margin-bottom:20px;color:#333}.star-rating[_ngcontent-%COMP%]{margin-bottom:20px}.star[_ngcontent-%COMP%]{font-size:40px;color:#ccc;cursor:pointer;transition:color .2s}.star.filled[_ngcontent-%COMP%]{color:#ff0}.feedback-text[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}textarea[_ngcontent-%COMP%]{width:90%;padding:10px;font-size:16px;border-radius:4px;border:1px solid #ccc}.submit-btn[_ngcontent-%COMP%]{width:max-content;padding:10px 20px;font-size:16px;color:#fff;background-color:#4caf50;border:none;border-radius:4px;cursor:pointer}.submit-btn[_ngcontent-%COMP%]:hover{background-color:#45a049}"]});let d=s;return d})();var Ed=function(d){return d.Prompt="PROMPT",d.Camera="CAMERA",d.Photos="PHOTOS",d}(Ed||{}),Vg=function(d){return d.Rear="REAR",d.Front="FRONT",d}(Vg||{}),fC=function(d){return d.Uri="uri",d.Base64="base64",d.DataUrl="dataUrl",d}(fC||{});var jg=class extends Nk{getPhoto(s){return Rn(this,null,function*(){return new Promise((u,r)=>Rn(this,null,function*(){if(s.webUseInput||s.source===Ed.Photos)this.fileInputExperience(s,u,r);else if(s.source===Ed.Prompt){let l=document.querySelector("pwa-action-sheet");l||(l=document.createElement("pwa-action-sheet"),document.body.appendChild(l)),l.header=s.promptLabelHeader||"Photo",l.cancelable=!1,l.options=[{title:s.promptLabelPhoto||"From Photos"},{title:s.promptLabelPicture||"Take Picture"}],l.addEventListener("onSelection",i=>Rn(this,null,function*(){i.detail===0?this.fileInputExperience(s,u,r):this.cameraExperience(s,u,r)}))}else this.cameraExperience(s,u,r)}))})}pickImages(s){return Rn(this,null,function*(){return new Promise((u,r)=>Rn(this,null,function*(){this.multipleFileInputExperience(u,r)}))})}cameraExperience(s,u,r){return Rn(this,null,function*(){if(customElements.get("pwa-camera-modal")){let l=document.createElement("pwa-camera-modal");l.facingMode=s.direction===Vg.Front?"user":"environment",document.body.appendChild(l);try{yield l.componentOnReady(),l.addEventListener("onPhoto",i=>Rn(this,null,function*(){let _=i.detail;_===null?r(new mb("User cancelled photos app")):_ instanceof Error?r(_):u(yield this._getCameraPhoto(_,s)),l.dismiss(),document.body.removeChild(l)})),l.present()}catch{this.fileInputExperience(s,u,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(s,u,r)})}fileInputExperience(s,u,r){let l=document.querySelector("#_capacitor-camera-input"),i=()=>{var _;(_=l.parentNode)===null||_===void 0||_.removeChild(l)};l||(l=document.createElement("input"),l.id="_capacitor-camera-input",l.type="file",l.hidden=!0,document.body.appendChild(l),l.addEventListener("change",_=>{let C=l.files[0],I="jpeg";if(C.type==="image/png"?I="png":C.type==="image/gif"&&(I="gif"),s.resultType==="dataUrl"||s.resultType==="base64"){let O=new FileReader;O.addEventListener("load",()=>{if(s.resultType==="dataUrl")u({dataUrl:O.result,format:I});else if(s.resultType==="base64"){let N=O.result.split(",")[1];u({base64String:N,format:I})}i()}),O.readAsDataURL(C)}else u({webPath:URL.createObjectURL(C),format:I}),i()}),l.addEventListener("cancel",_=>{r(new mb("User cancelled photos app")),i()})),l.accept="image/*",l.capture=!0,s.source===Ed.Photos||s.source===Ed.Prompt?l.removeAttribute("capture"):s.direction===Vg.Front?l.capture="user":s.direction===Vg.Rear&&(l.capture="environment"),l.click()}multipleFileInputExperience(s,u){let r=document.querySelector("#_capacitor-camera-input-multiple"),l=()=>{var i;(i=r.parentNode)===null||i===void 0||i.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",i=>{let _=[];for(let C=0;C<r.files.length;C++){let I=r.files[C],O="jpeg";I.type==="image/png"?O="png":I.type==="image/gif"&&(O="gif"),_.push({webPath:URL.createObjectURL(I),format:O})}s({photos:_}),l()}),r.addEventListener("cancel",i=>{u(new mb("User cancelled photos app")),l()})),r.accept="image/*",r.click()}_getCameraPhoto(s,u){return new Promise((r,l)=>{let i=new FileReader,_=s.type.split("/")[1];u.resultType==="uri"?r({webPath:URL.createObjectURL(s),format:_,saved:!1}):(i.readAsDataURL(s),i.onloadend=()=>{let C=i.result;u.resultType==="dataUrl"?r({dataUrl:C,format:_,saved:!1}):r({base64String:C.split(",")[1],format:_,saved:!1})},i.onerror=C=>{l(C)})})}checkPermissions(){return Rn(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return Rn(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return Rn(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return Rn(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},zG=new jg;var MA=md("Camera",{web:()=>new jg});var Ej=["imageElement"];function Dj(d,s){if(d&1){let u=Kt();V(0,"div",3),Me(1,"img",4),j(),V(2,"button",2),Oe("click",function(){_t(u);let l=dt();return bt(l.submit())}),$(3,"Submit"),j()}if(d&2){let u=dt();ue(),Fe("src",u.imageUrl,Hn)}}var kA=(()=>{let s=class s{constructor(r,l,i,_){this.location=r,this.routerParam=l,this.afterOrderService=i,this.router=_,this.orderHistoryId="",this.orderId=""}ngOnInit(){this.takePicture(),this.getOrderId()}takePicture(){return Rn(this,null,function*(){try{let r=yield MA.getPhoto({quality:100,allowEditing:!1,resultType:fC.Uri,source:Ed.Camera});this.imageUrl=r.webPath}catch(r){console.error("Error capturing image:",r)}})}getOrderId(){this.routerParam.paramMap.subscribe({next:r=>{r.get("id")&&(this.orderHistoryId=r.get("id"),this.getOrderDetails(this.orderHistoryId))}})}getOrderDetails(r){r&&(this.orderHistoryId=r,this.afterOrderService.getOrderDetails(r).subscribe({next:l=>{this.order=l,this.orderId=l.orderId?._id},error:l=>{console.error(l)}}))}submit(){return Rn(this,null,function*(){let r=localStorage.getItem("providerId");if(!r||!this.orderId||!this.imageUrl||!this.order?.userId){console.error("Required data is missing");return}try{let i=yield(yield fetch(this.imageUrl)).blob(),_=new FormData;_.append("providerId",r),_.append("orderId",this.orderId),_.append("userId",this.order.userId),_.append("image",i,"work-image.jpg"),this.afterOrderService.uploadBeforeWorkImage(_).subscribe(C=>{console.log("Data submitted successfully:",C),this.navToCompleteWork()},C=>{console.error("Error submitting data:",C)})}catch(l){console.error("Error fetching and submitting image:",l)}})}navTOBack(){this.location.back()}navToCompleteWork(){this.router.navigate(["completeWork",this.orderHistoryId])}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(Io),_e(Eo),_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-work-image"]],viewQuery:function(l,i){if(l&1&&bi(Ej,5),l&2){let _;fi(_=gi())&&(i.imageElement=_.first)}},decls:6,vars:1,consts:[[1,"container"],[1,"material-symbols-outlined",3,"click"],[3,"click"],[1,"image"],["alt","Captured Image",3,"src"]],template:function(l,i){l&1&&(V(0,"div",0)(1,"span",1),Oe("click",function(){return i.navTOBack()}),$(2," arrow_back "),j(),V(3,"button",2),Oe("click",function(){return i.takePicture()}),$(4,"Take Picture"),j(),Bt(5,Dj,4,1),j()),l&2&&(ue(5),Vn(5,i.imageUrl?5:-1))},styles:[".container[_ngcontent-%COMP%]{width:90%;margin:1rem 5% 0}.mage[_ngcontent-%COMP%]{width:100%;height:auto}"]});let d=s;return d})();var Aj=[{path:"",component:iT},{path:"language",component:nT},{path:"log-in",component:lT},{path:"location",component:wA},{path:"verify",component:cT},{path:"aboutUser",component:dT},{path:"selectWork",component:uT},{path:"aboutWork",component:mT},{path:"workExperiance",component:pT},{path:"aadharVerify",component:fT},{path:"pancard",component:gT},{path:"bankDetails",component:_T},{path:"waiting",component:qD},{path:"home",component:yT},{path:"fotter",component:Qs},{path:"credits",component:vT},{path:"notification",component:$D},{path:"menu",component:xT},{path:"visitingCard",component:wT},{path:"referAndEarn",component:CT},{path:"awards",component:ST},{path:"help",loadChildren:()=>import("./chunk-DJBEZXGD.js").then(d=>d.HelpModule)},{path:"target",component:DT},{path:"earnings",component:GD},{path:"calender",component:YD},{path:"jobHistory",component:ZD},{path:"jobDetails",component:KD},{path:"addCredit",component:XD},{path:"financialDetails",component:QD},{path:"identityVerification",component:JD},{path:"ongoing",component:eA},{path:"demo",component:Db},{path:"induction",component:tA},{path:"started",component:iA},{path:"selectAccount",component:nA},{path:"congrats",component:rA},{path:"packages",component:oA},{path:"training",component:aA},{path:"getOrder/:id",component:pA},{path:"arrived/:id",component:fA},{path:"startWork/:id",component:gA},{path:"work/otp/:id",component:_A},{path:"completeWork/:id",component:bA},{path:"verifyAfterWork/:id",component:yA},{path:"subServices",component:vA},{path:"notFound",component:xA},{path:"manageServices",component:CA},{path:"feedback",component:SA},{path:"workImage/:id",component:kA}],IA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s}),s.\u0275inj=hi({imports:[e1.forRoot(Aj),e1]});let d=s;return d})();var gC=md("App",{web:()=>import("./chunk-EGBBIWLX.js").then(d=>new d.AppWeb)});var _C=md("Network",{web:()=>import("./chunk-YLNCHRU7.js").then(d=>new d.NetworkWeb)});var TA=(()=>{let s=class s{constructor(r,l,i){this.location=r,this.messagingService=l,this.router=i,this.title="CoolieNo.1_Provider",this.myObject={}}ngOnInit(){this.messagingService.requestPermission(),setTimeout(()=>{this.myObject=this.messagingService.token?{token:this.messagingService.token}:{}},5e3),this.messagingService.listenForMessages(),this.monitorNetworkStatus(),this.registerBackButtonListener()}registerBackButtonListener(){gC.addListener("backButton",r=>{r.canGoBack?(this.location.back(),console.log("Back button pressed, navigating back")):(console.log("Back button pressed, exiting app"),gC.exitApp())})}monitorNetworkStatus(){return Rn(this,null,function*(){(yield _C.getStatus()).connected||this.router.navigate(["not-found"]),_C.addListener("networkStatusChange",l=>{l.connected||this.router.navigate(["not-found"])})})}};s.\u0275fac=function(l){return new(l||s)(_e(_i),_e(My),_e(Nt))},s.\u0275cmp=ft({type:s,selectors:[["app-root"]],decls:1,vars:0,template:function(l,i){l&1&&Me(0,"router-outlet")},dependencies:[db]});let d=s;return d})();var Pj="@",Oj=(()=>{let s=class s{constructor(r,l,i,_,C){this.doc=r,this.delegate=l,this.zone=i,this.animationType=_,this.moduleImpl=C,this._rendererFactoryPromise=null,this.scheduler=wn(X0,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-TDEQPBRY.js")).catch(l=>{throw new ak(5300,!1)}).then(({\u0275createEngine:l,\u0275AnimationRendererFactory:i})=>{this._engine=l(this.animationType,this.doc,this.scheduler);let _=new i(this.delegate,this._engine,this.zone);return this.delegate=_,_})}createRenderer(r,l){let i=this.delegate.createRenderer(r,l);if(i.\u0275type===0)return i;typeof i.throwOnSyntheticProps=="boolean"&&(i.throwOnSyntheticProps=!1);let _=new bC(i);return l?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(C=>{let I=C.createRenderer(r,l);_.use(I)}).catch(C=>{_.use(i)}),_}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};s.\u0275fac=function(l){Sm()},s.\u0275prov=Ut({token:s,factory:s.\u0275fac});let d=s;return d})(),bC=class{constructor(s){this.delegate=s,this.replay=[],this.\u0275type=1}use(s){if(this.delegate=s,this.replay!==null){for(let u of this.replay)u(s);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(s,u){return this.delegate.createElement(s,u)}createComment(s){return this.delegate.createComment(s)}createText(s){return this.delegate.createText(s)}get destroyNode(){return this.delegate.destroyNode}appendChild(s,u){this.delegate.appendChild(s,u)}insertBefore(s,u,r,l){this.delegate.insertBefore(s,u,r,l)}removeChild(s,u,r){this.delegate.removeChild(s,u,r)}selectRootElement(s,u){return this.delegate.selectRootElement(s,u)}parentNode(s){return this.delegate.parentNode(s)}nextSibling(s){return this.delegate.nextSibling(s)}setAttribute(s,u,r,l){this.delegate.setAttribute(s,u,r,l)}removeAttribute(s,u,r){this.delegate.removeAttribute(s,u,r)}addClass(s,u){this.delegate.addClass(s,u)}removeClass(s,u){this.delegate.removeClass(s,u)}setStyle(s,u,r,l){this.delegate.setStyle(s,u,r,l)}removeStyle(s,u,r){this.delegate.removeStyle(s,u,r)}setProperty(s,u,r){this.shouldReplay(u)&&this.replay.push(l=>l.setProperty(s,u,r)),this.delegate.setProperty(s,u,r)}setValue(s,u){this.delegate.setValue(s,u)}listen(s,u,r){return this.shouldReplay(u)&&this.replay.push(l=>l.listen(s,u,r)),this.delegate.listen(s,u,r)}shouldReplay(s){return this.replay!==null&&s.startsWith(Pj)}};function EA(d="animations"){return Gx("NgAsyncAnimations"),lk([{provide:Q0,useFactory:(s,u,r)=>new Oj(s,u,r,d),deps:[un,rb,Fi]},{provide:to,useValue:d==="noop"?"NoopAnimations":"BrowserAnimations"}])}var Rj=XM(K1());var ky={production:!1,firebase:{apiKey:"AIzaSyAcziwgDyx2SxCSeuGbgFDr9_94R2tpDfk",authDomain:"coolie-9cc38.firebaseapp.com",projectId:"coolie-9cc38",storageBucket:"coolie-9cc38.appspot.com",messagingSenderId:"425618348845",appId:"1:425618348845:android:dfb682ab264340b4f611a4",measurementId:"G-X6752VX6L5",vapidKey:"BFLySRIkI2i4ZrxUJjrsCDeG921cCUs-9zLhyulNlP7HUawhIVFefo8GFfxxgnpTWV9zgiKJ9m9Vx8C39MRgPYA"}};var DA=(()=>{let s=class s{};s.\u0275fac=function(l){return new(l||s)},s.\u0275mod=ui({type:s,bootstrap:[TA]}),s.\u0275inj=hi({providers:[EA(),Lr],imports:[ob,IA,Pk,Ok,Ck,Wk,_I,yI,vI,xI,CI,tT,SI,IT,GI,mI,dA.initializeApp(ky.firebase),uA,aT]});let d=s;return d})();ky.production&&void 0;Sk().bootstrapModule(DA).catch(d=>console.error(d));"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(d=>{console.log("Service Worker registered with scope:",d.scope)}).catch(d=>{console.log("Service Worker registration failed:",d)});
